<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 25 - Exception Handling</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Color for check mark icons */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            /* Colors for lang switcher */
            --lang-select-border: var(--check-color);
            --lang-option-bg: var(--background-card);
            --lang-option-text: var(--text-dark);
            --lang-arrow-color: var(--check-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header Styles --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1.5rem 1.5rem; /* Reduced padding */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between title and lang */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 1rem; /* Gap between items */
        }
        .header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-grow: 1; /* Allow title to take space */
        }

        .return-button {
            color: var(--text-light);
            font-size: 1.5rem;
            text-decoration: none;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 0.8rem;
            border-radius: 50%;
            transition: background-color var(--transition-speed) ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text-light);
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem; /* Slightly smaller */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            line-height: 1.3;
        }
        .kc-header .module-number {
             font-size: 1rem;
             font-weight: 400;
             background-color: rgba(255,255,255,0.15);
             padding: 3px 8px;
             border-radius: 4px;
             margin-right: 8px;
             vertical-align: middle;
        }

        /* Language Switcher Styles */
        .language-switcher { margin-top: 0; min-width: 150px; /* Give it some min width */ }
        #languageSelect {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 8px 35px 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--check-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease;
        }
        #languageSelect:hover { border-color: var(--text-light); }
        #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
        #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
        }


        /* --- Main Content Area --- */
        .kc-main {
            flex-grow: 1;
            padding: 2rem 1.5rem;
            max-width: 800px; /* Limit width for readability */
            margin: 0 auto; /* Center content */
            width: 100%;
        }

        /* --- Quiz Container Styling --- */
        .quiz-container {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2rem;
            border: 1px solid var(--border-color);
        }

        .question-counter {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            font-weight: 500;
            text-align: right;
        }

        #question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
            line-height: 1.5;
        }
        #question-text code {
             font-size: 0.95em;
             background: #eee;
             padding: 2px 5px;
             border-radius: 4px;
             color: #c7254e;
             font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        }
        #question-text pre code { /* Style code blocks */
            display: block;
            background-color: #f5f5f5;
            padding: 1em;
            margin-top: 0.5em;
            border-radius: var(--border-radius);
            overflow-x: auto; /* Allow horizontal scrolling for long code */
            white-space: pre; /* Preserve whitespace */
            font-size: 0.9em;
            border: 1px solid #ddd;
        }


        #answer-options {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem; /* Space between options */
        }

        #answer-options label {
            display: block;
            background-color: var(--background-page);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative; /* For pseudo-elements */
        }
        #answer-options label:hover {
            border-color: var(--primary-color);
            background-color: #e7f1ff;
        }

        #answer-options input[type="radio"] {
            opacity: 0; /* Hide the actual radio button */
            position: absolute;
            width: 0;
            height: 0;
        }

        #answer-options label.selected {
            border-color: var(--primary-color);
            background-color: #ddeeff;
            font-weight: 500;
        }

        /* Feedback Styles */
        #answer-options label.correct {
            border-color: var(--success-color);
            background-color: #d1e7dd; /* Light green */
            color: #0a3622;
            font-weight: 500;
        }
        #answer-options label.correct::before {
            content: '\f00c'; /* Font Awesome check */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--success-color);
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
        }

        #answer-options label.incorrect {
            border-color: var(--error-color);
            background-color: #f8d7da; /* Light red */
            color: #58151c;
        }
        #answer-options label.incorrect::before {
             content: '\f00d'; /* Font Awesome times */
             font-family: 'Font Awesome 6 Free';
             font-weight: 900;
             color: var(--error-color);
             position: absolute;
             right: 1rem;
             top: 50%;
             transform: translateY(-50%);
             font-size: 1.1rem;
        }

         #answer-options label.disabled {
             cursor: not-allowed;
             opacity: 0.8;
         }
         #answer-options label.disabled:hover {
             border-color: var(--border-color); /* Prevent hover effect when disabled */
             background-color: var(--background-page);
         }
         #answer-options label.correct.disabled:hover { background-color: #d1e7dd; border-color: var(--success-color); }
         #answer-options label.incorrect.disabled:hover { background-color: #f8d7da; border-color: var(--error-color); }


        #feedback-area {
            margin-top: 1rem;
            padding: 0.8rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            display: none; /* Initially hidden */
            border: 1px solid;
        }
        #feedback-area.correct {
            background-color: #d1e7dd;
            color: #0a3622;
            border-color: var(--success-color);
            display: block;
        }
        #feedback-area.incorrect {
            background-color: #f8d7da;
            color: #58151c;
            border-color: var(--error-color);
            display: block;
        }

        /* --- Button Styles --- */
        .button-area {
            margin-top: 2rem;
            display: flex;
            justify-content: flex-end; /* Align buttons to the right */
            gap: 1rem;
        }
        .quiz-button {
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            text-decoration: none; /* For potential link buttons */
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quiz-button:disabled {
            background-color: var(--secondary-color);
            opacity: 0.6;
            cursor: not-allowed;
        }

        #submit-button {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        #submit-button:not(:disabled):hover {
            background-color: #0b5ed7;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #next-button, #results-button, #retry-button {
            background-color: var(--check-color);
            color: var(--text-light);
        }
        #next-button:not(:disabled):hover,
        #results-button:not(:disabled):hover,
        #retry-button:not(:disabled):hover {
            background-color: #5a3b9a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* --- Results Area --- */
        #results-area {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2rem;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        #results-area h2 {
            font-family: var(--font-title);
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        #score-text {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
         #score-text .final-score { color: var(--check-color); }
        #pass-fail-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }
        #pass-fail-text.passed { color: var(--success-color); }
        #pass-fail-text.failed { color: var(--error-color); }
        #pass-fail-text i { margin-right: 8px; }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
             .kc-header { padding: 1rem; flex-direction: column; align-items: flex-start;}
             .kc-header h1 { font-size: 1.4rem; }
             .language-switcher { width: 100%; } /* Make switcher full width */
             .kc-main { padding: 1.5rem 1rem; }
             .quiz-container, #results-area { padding: 1.5rem; }
             #question-text { font-size: 1.1rem; }
             #answer-options label { padding: 0.8rem; }
             .button-area { justify-content: center; } /* Center buttons on small screens */
        }
        @media (max-width: 576px) {
             html { font-size: 14px; }
             .kc-header h1 { font-size: 1.3rem; }
             #question-text { font-size: 1rem; }
             .quiz-button { padding: 0.6rem 1.2rem; font-size: 0.9rem; }
             #score-text { font-size: 1.3rem; }
             #pass-fail-text { font-size: 1.1rem; }
        }

    </style>
</head>
<body>

    <header class="kc-header">
        <div class="header-content">
            <a href="ctp-dashboard.html" class="return-button" data-translate-aria-label="return_button_aria" aria-label="Return to Dashboard">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 data-translate="header_title"><span class="module-number">25</span> Exception Handling Check</h1>
        </div>
         <!-- Language Switcher -->
         <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="kc-main">

        <div id="quiz-area">
            <div class="quiz-container">
                <div class="question-counter" id="question-counter-text" data-translate="question_counter">Question 1 of 10</div>
                <div id="question-text">
                    <!-- Question text loaded by JS -->
                </div>
                <div id="answer-options">
                    <!-- Answer options loaded by JS -->
                </div>
                <div id="feedback-area">
                    <!-- Feedback text loaded by JS -->
                </div>
                <div class="button-area">
                    <button id="submit-button" class="quiz-button" disabled data-translate="submit_button">Submit Answer</button>
                    <button id="next-button" class="quiz-button" style="display: none;" data-translate="next_button">Next Question</button>
                    <button id="results-button" class="quiz-button" style="display: none;" data-translate="results_button">See Results</button>
                </div>
            </div>
        </div>

        <div id="results-area" style="display: none;">
             <h2 data-translate="results_title">Quiz Results</h2>
             <p id="score-text">Your score: <span class="final-score">0</span>/10</p>
             <p id="pass-fail-text">
                 <!-- Pass/Fail message loaded by JS -->
             </p>
             <div class="button-area">
                <button id="retry-button" class="quiz-button" data-translate="retry_button">Retry Quiz</button>
                <a href="ctp-dashboard.html" class="quiz-button" data-translate="return_dashboard_button" style="background-color: var(--secondary-color);"><i class="fas fa-arrow-left"></i> Return to Dashboard</a>
             </div>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 25; // <<< --- Set the Module ID here
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';
        const PASSING_SCORE = 6; // Need 6 out of 10 to pass

        // --- Quiz Questions Data ---
        const quizQuestionsData = [
            {
                question_key: "q1_text",
                options_key: "q1_options",
                correct_option_index: 1
            },
            {
                question_key: "q2_text",
                options_key: "q2_options",
                correct_option_index: 0
            },
            {
                question_key: "q3_text",
                options_key: "q3_options",
                correct_option_index: 2
            },
            {
                question_key: "q4_text",
                options_key: "q4_options",
                correct_option_index: 3
            },
            {
                question_key: "q5_text",
                options_key: "q5_options",
                correct_option_index: 0
            },
            {
                question_key: "q6_text",
                options_key: "q6_options",
                correct_option_index: 1
            },
            {
                question_key: "q7_text",
                options_key: "q7_options",
                correct_option_index: 3
            },
            {
                question_key: "q8_text",
                options_key: "q8_options",
                correct_option_index: 0
            },
            {
                question_key: "q9_text",
                options_key: "q9_options",
                correct_option_index: 2
            },
            {
                question_key: "q10_text",
                options_key: "q10_options",
                correct_option_index: 1
            }
        ];

        // --- Translations Object ---
        const translations = {
            en: {
                "page_title": `Knowledge Check: Module ${MODULE_ID} - Exception Handling`,
                "header_title": `<span class="module-number">${MODULE_ID}</span> Exception Handling Check`,
                "return_button_aria": "Return to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                "question_counter": "Question {current} of {total}",
                "submit_button": "Submit Answer",
                "next_button": "Next Question",
                "results_button": "See Results",
                "feedback_correct": "Correct!",
                "feedback_incorrect": "Incorrect. The correct answer is highlighted.",
                "results_title": "Quiz Results",
                "results_score_text": "Your score: <span class=\"final-score\">{score}</span>/{total}",
                "results_passed": "<i class=\"fas fa-check-circle\"></i> Congratulations, you passed! Progress saved.",
                "results_failed": "<i class=\"fas fa-times-circle\"></i> You need {passingScore} correct answers to pass. Try again!",
                "retry_button": "Retry Quiz",
                "return_dashboard_button": "<i class=\"fas fa-arrow-left\"></i> Return to Dashboard",
                "footer_text": "Part of the Road to Free Open AGI Project",

                // --- Module 25 Questions (English) ---
                "q1_text": "What is the primary purpose of a `try...except` block in Python?",
                "q1_options": [
                    "To speed up code execution.",
                    "To handle potential errors gracefully without crashing the program.",
                    "To define reusable functions.",
                    "To loop through a sequence of items."
                ],
                "q2_text": "Which keyword is used to catch *any* type of exception?",
                "q2_options": [
                    "`except:` (without specifying an exception type)",
                    "`catch all:`",
                    "`except Error:`",
                    "`try all:`"
                ],
                "q3_text": "Consider this code:\n<pre><code>try:\n    num = int('abc')\nexcept ValueError:\n    print('Invalid number')\nexcept TypeError:\n    print('Type mismatch')</code></pre>\nWhat will be printed?",
                "q3_options": [
                    "Nothing will be printed.",
                    "Type mismatch",
                    "Invalid number",
                    "An unhandled error will occur."
                ],
                "q4_text": "What does the `finally` block in a `try...except...finally` structure guarantee?",
                "q4_options": [
                    "It only runs if an exception occurs in the `try` block.",
                    "It only runs if no exception occurs in the `try` block.",
                    "It runs only if a specific type of exception is caught.",
                    "It always runs, regardless of whether an exception occurred or was handled."
                ],
                "q5_text": "Which built-in exception is typically raised when you try to open a file that doesn't exist using `open(filename, 'r')`?",
                "q5_options": [
                    "`FileNotFoundError`",
                    "`IOError` (less common in Python 3)",
                    "`FileExistsError`",
                    "`ValueError`"
                ],
                "q6_text": "How can you manually trigger an exception in Python?",
                "q6_options": [
                    "Using the `trigger Exception()` function.",
                    "Using the `raise` keyword followed by an Exception object (e.g., `raise ValueError('My error')`).",
                    "Using the `throw new Exception()` syntax.",
                    "By dividing by zero implicitly."
                ],
                "q7_text": "What happens if an exception occurs inside an `except` block?",
                "q7_options": [
                    "The `finally` block handles it automatically.",
                    "Python ignores the second exception.",
                    "The program immediately terminates.",
                    "The exception propagates outwards, potentially crashing the program unless handled by an outer `try...except`."
                ],
                "q8_text": "Consider:\n<pre><code>try:\n    result = 10 / 0\nexcept ZeroDivisionError:\n    print('Cannot divide by zero')\nfinally:\n    print('Finished')</code></pre>\nWhat is the output?",
                "q8_options": [
                    "Cannot divide by zero\nFinished",
                    "Cannot divide by zero",
                    "Finished",
                    "An unhandled ZeroDivisionError occurs."
                ],
                "q9_text": "Why is it generally better to catch specific exceptions (e.g., `except ValueError:`) rather than using a bare `except:`?",
                "q9_options": [
                    "It makes the code run faster.",
                    "Bare `except:` is deprecated and will be removed.",
                    "It prevents you from accidentally catching unexpected errors (like `SystemExit` or `KeyboardInterrupt`) and makes debugging easier.",
                    "There is no difference; bare `except:` is preferred for simplicity."
                ],
                "q10_text": "What is the purpose of the `else` block in a `try...except...else...finally` structure?",
                "q10_options": [
                    "It's an alternative way to write `finally`.",
                    "It executes only if the `try` block completes *without* raising any exceptions.",
                    "It executes only if *any* exception is caught by an `except` block.",
                    "It's used to define custom exception types."
                ]
            },
            pt: {
                "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Tratamento de Exceções`,
                "header_title": `<span class="module-number">${MODULE_ID}</span> Verificação de Tratamento de Exceções`,
                "return_button_aria": "Voltar ao Painel",
                "lang_select_aria": "Selecionar Idioma",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                "question_counter": "Questão {current} de {total}",
                "submit_button": "Enviar Resposta",
                "next_button": "Próxima Questão",
                "results_button": "Ver Resultados",
                "feedback_correct": "Correto!",
                "feedback_incorrect": "Incorreto. A resposta correta está destacada.",
                "results_title": "Resultados do Quiz",
                "results_score_text": "Sua pontuação: <span class=\"final-score\">{score}</span>/{total}",
                "results_passed": "<i class=\"fas fa-check-circle\"></i> Parabéns, você passou! Progresso salvo.",
                "results_failed": "<i class=\"fas fa-times-circle\"></i> Você precisa de {passingScore} respostas corretas para passar. Tente novamente!",
                "retry_button": "Tentar Novamente",
                "return_dashboard_button": "<i class=\"fas fa-arrow-left\"></i> Voltar ao Painel",
                "footer_text": "Parte do Projeto Road to Free Open AGI",

                 // --- Module 25 Questions (Portuguese) ---
                 "q1_text": "Qual é o propósito principal de um bloco `try...except` em Python?",
                 "q1_options": [
                     "Acelerar a execução do código.",
                     "Tratar erros potenciais de forma elegante sem travar o programa.",
                     "Definir funções reutilizáveis.",
                     "Iterar sobre uma sequência de itens."
                 ],
                 "q2_text": "Qual palavra-chave é usada para capturar *qualquer* tipo de exceção?",
                 "q2_options": [
                     "`except:` (sem especificar um tipo de exceção)",
                     "`catch all:`",
                     "`except Error:`",
                     "`try all:`"
                 ],
                 "q3_text": "Considere este código:\n<pre><code>try:\n    num = int('abc')\nexcept ValueError:\n    print('Número inválido')\nexcept TypeError:\n    print('Incompatibilidade de tipo')</code></pre>\nO que será impresso?",
                 "q3_options": [
                     "Nada será impresso.",
                     "Incompatibilidade de tipo",
                     "Número inválido",
                     "Ocorrerá um erro não tratado."
                 ],
                 "q4_text": "O que o bloco `finally` em uma estrutura `try...except...finally` garante?",
                 "q4_options": [
                     "Ele só executa se ocorrer uma exceção no bloco `try`.",
                     "Ele só executa if nenhuma exceção ocorrer no bloco `try`.",
                     "Ele executa apenas se um tipo específico de exceção for capturado.",
                     "Ele sempre executa, independentemente de uma exceção ter ocorrido ou sido tratada."
                 ],
                 "q5_text": "Qual exceção embutida é tipicamente levantada quando você tenta abrir um arquivo que não existe usando `open(filename, 'r')`?",
                 "q5_options": [
                     "`FileNotFoundError`",
                     "`IOError` (menos comum no Python 3)",
                     "`FileExistsError`",
                     "`ValueError`"
                 ],
                 "q6_text": "Como você pode disparar manualmente uma exceção em Python?",
                 "q6_options": [
                     "Usando a função `trigger Exception()`.",
                     "Usando a palavra-chave `raise` seguida por um objeto Exception (ex: `raise ValueError('Meu erro')`).",
                     "Usando a sintaxe `throw new Exception()`.",
                     "Dividindo por zero implicitamente."
                 ],
                 "q7_text": "O que acontece se uma exceção ocorrer dentro de um bloco `except`?",
                 "q7_options": [
                     "O bloco `finally` a trata automaticamente.",
                     "Python ignora a segunda exceção.",
                     "O programa termina imediatamente.",
                     "A exceção se propaga para fora, potencialmente travando o programa, a menos que tratada por um `try...except` externo."
                 ],
                 "q8_text": "Considere:\n<pre><code>try:\n    result = 10 / 0\nexcept ZeroDivisionError:\n    print('Não pode dividir por zero')\nfinally:\n    print('Finalizado')</code></pre>\nQual é a saída?",
                 "q8_options": [
                     "Não pode dividir por zero\nFinalizado",
                     "Não pode dividir por zero",
                     "Finalizado",
                     "Ocorre um ZeroDivisionError não tratado."
                 ],
                 "q9_text": "Por que geralmente é melhor capturar exceções específicas (ex: `except ValueError:`) em vez de usar um `except:` vazio?",
                 "q9_options": [
                     "Isso faz o código rodar mais rápido.",
                     "`except:` vazio está obsoleto e será removido.",
                     "Isso impede que você capture acidentalmente erros inesperados (como `SystemExit` ou `KeyboardInterrupt`) e facilita a depuração.",
                     "Não há diferença; `except:` vazio é preferível por simplicidade."
                 ],
                 "q10_text": "Qual é o propósito do bloco `else` em uma estrutura `try...except...else...finally`?",
                 "q10_options": [
                     "É uma forma alternativa de escrever `finally`.",
                     "Ele executa apenas se o bloco `try` for concluído *sem* levantar nenhuma exceção.",
                     "Ele executa apenas se *qualquer* exceção for capturada por um bloco `except`.",
                     "É usado para definir tipos de exceção personalizados."
                 ]
            },
            zh: {
                "page_title": `知识测验：模块 ${MODULE_ID} - 异常处理`,
                "header_title": `<span class="module-number">${MODULE_ID}</span> 异常处理测验`,
                "return_button_aria": "返回仪表板",
                "lang_select_aria": "选择语言",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                "question_counter": "问题 {current} / {total}",
                "submit_button": "提交答案",
                "next_button": "下一题",
                "results_button": "查看结果",
                "feedback_correct": "正确!",
                "feedback_incorrect": "错误。正确答案已高亮显示。",
                "results_title": "测验结果",
                "results_score_text": "你的得分: <span class=\"final-score\">{score}</span>/{total}",
                "results_passed": "<i class=\"fas fa-check-circle\"></i> 恭喜，你通过了！进度已保存。",
                "results_failed": "<i class=\"fas fa-times-circle\"></i> 你需要答对 {passingScore} 题才能通过。再试一次吧！",
                "retry_button": "重新测验",
                "return_dashboard_button": "<i class=\"fas fa-arrow-left\"></i> 返回仪表板",
                "footer_text": "通往自由开放AGI之路项目的一部分",

                // --- Module 25 Questions (Chinese) ---
                "q1_text": "Python 中 `try...except` 块的主要目的是什么？",
                "q1_options": [
                    "加快代码执行速度。",
                    "优雅地处理潜在错误，避免程序崩溃。",
                    "定义可重用的函数。",
                    "循环遍历一个项目序列。"
                ],
                "q2_text": "哪个关键字用于捕获*任何*类型的异常？",
                "q2_options": [
                    "`except:` (不指定异常类型)",
                    "`catch all:`",
                    "`except Error:`",
                    "`try all:`"
                ],
                "q3_text": "考虑这段代码:\n<pre><code>try:\n    num = int('abc')\nexcept ValueError:\n    print('无效数字')\nexcept TypeError:\n    print('类型不匹配')</code></pre>\n将打印什么？",
                "q3_options": [
                    "什么都不会打印。",
                    "类型不匹配",
                    "无效数字",
                    "将发生未处理的错误。"
                ],
                "q4_text": "`try...except...finally` 结构中的 `finally` 块保证了什么？",
                "q4_options": [
                    "它仅在 `try` 块中发生异常时运行。",
                    "它仅在 `try` 块中没有发生异常时运行。",
                    "它仅在捕获到特定类型的异常时运行。",
                    "无论是否发生异常或是否被处理，它总是运行。"
                ],
                "q5_text": "当你尝试使用 `open(filename, 'r')` 打开一个不存在的文件时，通常会引发哪个内置异常？",
                "q5_options": [
                    "`FileNotFoundError`",
                    "`IOError` (在 Python 3 中不太常见)",
                    "`FileExistsError`",
                    "`ValueError`"
                ],
                "q6_text": "在 Python 中，你如何手动触发一个异常？",
                "q6_options": [
                    "使用 `trigger Exception()` 函数。",
                    "使用 `raise` 关键字后跟一个 Exception 对象 (例如 `raise ValueError('我的错误')`)。",
                    "使用 `throw new Exception()` 语法。",
                    "通过隐式地除以零。"
                ],
                "q7_text": "如果在 `except` 块内部发生异常会怎样？",
                "q7_options": [
                    "`finally` 块会自动处理它。",
                    "Python 会忽略第二个异常。",
                    "程序立即终止。",
                    "该异常向外传播，除非被外部的 `try...except` 处理，否则可能导致程序崩溃。"
                ],
                "q8_text": "考虑:\n<pre><code>try:\n    result = 10 / 0\nexcept ZeroDivisionError:\n    print('不能除以零')\nfinally:\n    print('完成')</code></pre>\n输出是什么？",
                "q8_options": [
                    "不能除以零\n完成",
                    "不能除以零",
                    "完成",
                    "发生未处理的 ZeroDivisionError。"
                ],
                "q9_text": "为什么通常最好捕获特定的异常 (例如 `except ValueError:`) 而不是使用裸露的 `except:`？",
                "q9_options": [
                    "它使代码运行更快。",
                    "裸露的 `except:` 已被弃用，并将被移除。",
                    "它可以防止意外捕获不期望的错误 (如 `SystemExit` 或 `KeyboardInterrupt`)，并使调试更容易。",
                    "没有区别；为了简单起见，首选裸露的 `except:`。"
                ],
                "q10_text": "`try...except...else...finally` 结构中的 `else` 块有什么用途？",
                "q10_options": [
                    "它是编写 `finally` 的另一种方式。",
                    "它仅在 `try` 块完成且*没有*引发任何异常时执行。",
                    "它仅在*任何*异常被 `except` 块捕获时执行。",
                    "它用于定义自定义异常类型。"
                ]
            }
        };

        // --- Quiz Logic ---
        let currentQuestionIndex = 0;
        let score = 0;
        let questions = []; // Will hold the shuffled questions for the current attempt
        let selectedAnswerIndex = null; // Track which answer is selected

        const questionTextElement = document.getElementById('question-text');
        const answerOptionsElement = document.getElementById('answer-options');
        const feedbackAreaElement = document.getElementById('feedback-area');
        const submitButton = document.getElementById('submit-button');
        const nextButton = document.getElementById('next-button');
        const resultsButton = document.getElementById('results-button');
        const questionCounterElement = document.getElementById('question-counter-text');
        const quizAreaElement = document.getElementById('quiz-area');
        const resultsAreaElement = document.getElementById('results-area');
        const scoreTextElement = document.getElementById('score-text');
        const passFailTextElement = document.getElementById('pass-fail-text');
        const retryButton = document.getElementById('retry-button');
        const languageSelectElement = document.getElementById('languageSelect');

        // --- Translation Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) {
             if (!translations[lang]) lang = 'en'; // Fallback
             localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
             document.documentElement.lang = lang;
             if (languageSelectElement) languageSelectElement.value = lang;
             translatePage(lang);
             // Re-display current state with new language if quiz is active
             if (quizAreaElement.style.display !== 'none') {
                 displayQuestion(); // Re-render question and options
                 updateButtonStates(); // Update button text
                 // If feedback is shown, re-render it
                 if (feedbackAreaElement.style.display !== 'none') {
                    const isCorrect = feedbackAreaElement.classList.contains('correct');
                    showFeedback(isCorrect, questions[currentQuestionIndex].correct_option_index);
                 }
             } else if (resultsAreaElement.style.display !== 'none') {
                 showResults(); // Re-render results page
             }
         }

         function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang, {
                    current: currentQuestionIndex + 1,
                    total: questions.length,
                    score: score,
                    passingScore: PASSING_SCORE
                 });
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (translation.includes('<') && translation.includes('>')) { // Check for HTML
                    el.innerHTML = translation;
                 } else { el.textContent = translation; }
            });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
             });
             // Update question counter specifically
             updateQuestionCounter();
        }

         // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {};
            }
        }

        function saveKnowledgeCheckStatus(moduleId, status) {
            try {
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[moduleId] = status; // true for passed
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                console.log(`Knowledge check status saved for module ${moduleId}: ${status}`);
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }

        // --- Quiz Core Functions ---

        // Fisher-Yates (Knuth) Shuffle
        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswerIndex = null;
            questions = shuffleArray([...quizQuestionsData]); // Shuffle a copy
            resultsAreaElement.style.display = 'none';
            quizAreaElement.style.display = 'block';
            feedbackAreaElement.style.display = 'none'; // Hide feedback
            displayQuestion();
            updateButtonStates();
             // Ensure initial translation is applied
             translatePage(getStoredLanguage());
        }

         function updateQuestionCounter() {
             const lang = getStoredLanguage();
             if (questionCounterElement) {
                 questionCounterElement.textContent = getTranslation('question_counter', lang, {
                     current: currentQuestionIndex + 1,
                     total: questions.length
                 });
             }
         }

        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const lang = getStoredLanguage();
            const currentQuestion = questions[currentQuestionIndex];
            selectedAnswerIndex = null; // Reset selection for the new question

            updateQuestionCounter();
            questionTextElement.innerHTML = getTranslation(currentQuestion.question_key, lang); // Use innerHTML for <pre><code>
            answerOptionsElement.innerHTML = ''; // Clear previous options

            const options = getTranslation(currentQuestion.options_key, lang); // This should return the array
            if (Array.isArray(options)) {
                options.forEach((optionText, index) => {
                    const label = document.createElement('label');
                    label.htmlFor = `option${index}`;

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = `option${index}`;
                    radio.name = 'answer';
                    radio.value = index;
                    radio.addEventListener('change', () => {
                        handleSelection(index, label);
                    });

                    const span = document.createElement('span');
                    span.textContent = optionText;

                    label.appendChild(radio);
                    label.appendChild(span);
                    answerOptionsElement.appendChild(label);
                });
            } else {
                 console.error(`Options for key ${currentQuestion.options_key} are not an array in language ${lang}`);
                 answerOptionsElement.innerHTML = 'Error loading options.';
            }


            feedbackAreaElement.style.display = 'none'; // Hide feedback
            feedbackAreaElement.className = ''; // Reset feedback class
            updateButtonStates();
        }

        function handleSelection(index, selectedLabel) {
            selectedAnswerIndex = index;
            // Remove 'selected' class from all labels
            answerOptionsElement.querySelectorAll('label').forEach(lbl => lbl.classList.remove('selected'));
            // Add 'selected' class to the clicked label
            selectedLabel.classList.add('selected');
            submitButton.disabled = false; // Enable submit button
        }

        function submitAnswer() {
            if (selectedAnswerIndex === null) return; // Do nothing if no answer selected

            const currentQuestion = questions[currentQuestionIndex];
            const correctIndex = currentQuestion.correct_option_index;
            const isCorrect = (selectedAnswerIndex === correctIndex);

            if (isCorrect) {
                score++;
            }

            showFeedback(isCorrect, correctIndex);
            updateButtonStates(true); // Update buttons after submitting
        }

        function showFeedback(isCorrect, correctIndex) {
            const lang = getStoredLanguage();
            const labels = answerOptionsElement.querySelectorAll('label');

            // Disable all options and remove selection ability
            labels.forEach((label, index) => {
                label.classList.add('disabled'); // Make visually disabled
                label.querySelector('input').disabled = true; // Disable radio button

                 // Remove hover effects that might conflict
                 label.classList.remove('selected');

                if (index === correctIndex) {
                    label.classList.add('correct'); // Always highlight the correct one
                }
                 if (index === selectedAnswerIndex && !isCorrect) {
                    label.classList.add('incorrect'); // Mark the selected wrong answer
                }
            });

            // Display feedback message
            feedbackAreaElement.textContent = getTranslation(isCorrect ? 'feedback_correct' : 'feedback_incorrect', lang);
            feedbackAreaElement.className = isCorrect ? 'correct' : 'incorrect'; // Set class for styling
            feedbackAreaElement.style.display = 'block';
        }


        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function showResults() {
            quizAreaElement.style.display = 'none';
            resultsAreaElement.style.display = 'block';

            const lang = getStoredLanguage();
            const hasPassed = score >= PASSING_SCORE;

            scoreTextElement.innerHTML = getTranslation('results_score_text', lang, { score: score, total: questions.length });
            passFailTextElement.innerHTML = getTranslation(hasPassed ? 'results_passed' : 'results_failed', lang, { passingScore: PASSING_SCORE });
            passFailTextElement.className = hasPassed ? 'passed' : 'failed';

            if (hasPassed) {
                saveKnowledgeCheckStatus(MODULE_ID, true); // Save progress only if passed
            }
             // Translate retry and return buttons specifically as they are in results area
             retryButton.innerHTML = getTranslation('retry_button', lang);
             const returnDashboardButton = resultsAreaElement.querySelector('a.quiz-button');
             if (returnDashboardButton) {
                 returnDashboardButton.innerHTML = getTranslation('return_dashboard_button', lang);
             }
        }

        function updateButtonStates(answerSubmitted = false) {
            const lang = getStoredLanguage();

             // Translate button texts every time state changes
            submitButton.innerHTML = getTranslation('submit_button', lang);
            nextButton.innerHTML = getTranslation('next_button', lang);
            resultsButton.innerHTML = getTranslation('results_button', lang);

            if (answerSubmitted) {
                submitButton.style.display = 'none'; // Hide submit after answering
                submitButton.disabled = true;

                if (currentQuestionIndex < questions.length - 1) {
                    nextButton.style.display = 'inline-flex';
                    nextButton.disabled = false;
                    resultsButton.style.display = 'none';
                    resultsButton.disabled = true;
                } else {
                    // Last question answered
                    nextButton.style.display = 'none';
                    nextButton.disabled = true;
                    resultsButton.style.display = 'inline-flex';
                    resultsButton.disabled = false;
                }
            } else {
                // Before submitting answer
                 submitButton.style.display = 'inline-flex';
                 submitButton.disabled = (selectedAnswerIndex === null); // Enable only if an answer is selected
                 nextButton.style.display = 'none';
                 nextButton.disabled = true;
                 resultsButton.style.display = 'none';
                 resultsButton.disabled = true;
            }
        }


        // --- Event Listeners ---
        submitButton.addEventListener('click', submitAnswer);
        nextButton.addEventListener('click', nextQuestion);
        resultsButton.addEventListener('click', showResults);
        retryButton.addEventListener('click', startQuiz);
        languageSelectElement.addEventListener('change', (e) => {
            setLanguage(e.target.value);
        });

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            setLanguage(initialLang); // Set language and translate initially
            startQuiz(); // Start the quiz
        });

    </script>

</body>
</html>
