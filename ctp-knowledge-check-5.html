<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="kc_page_title">Knowledge Check - Module 5</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Knowledge Check color */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--check-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-bottom: 4rem; /* Ensure space for footer */
        }

        /* --- Header --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .return-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
            margin-right: 1rem; /* Space between button and title */
            margin-bottom: 0.5rem; /* Space below on wrap */
        }
        .return-link i { margin-right: 6px; }
        .return-link:hover { background-color: rgba(255,255,255,0.1); border-color: var(--text-light); }

        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.8rem; /* Slightly smaller than dashboard title */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            flex-grow: 1; /* Allow title to take remaining space */
             margin-bottom: 0.5rem; /* Space below on wrap */
             text-align: center; /* Center on small screens */
        }

        /* Language Switcher Styles */
         .language-switcher { margin-left: auto; /* Pushes switcher to the right */ }
         #languageSelect {
            min-width: 130px;
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--check-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 9px auto;
            transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: #543294; }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option {
              background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px;
         }

        /* --- Main Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto 2rem auto; /* Center horizontally, add bottom margin */
            background-color: var(--background-card);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .quiz-instructions {
            background-color: #eef6ff; /* Light blue info background */
            border: 1px solid #b8d8f8;
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            font-size: 0.95rem;
            color: #0a58ca; /* Darker blue text */
        }
        .quiz-instructions p { margin-bottom: 0.5rem; }
        .quiz-instructions p:last-child { margin-bottom: 0; }
        .quiz-instructions i { margin-right: 8px; color: var(--primary-color); }
        .quiz-instructions strong { color: var(--text-dark); font-weight: 500; }

        /* --- Question Styling --- */
        .question-block {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .question-block:last-of-type {
             margin-bottom: 2rem; /* Less margin after last question */
             padding-bottom: 0;
             border-bottom: none;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }
        .question-text .q-number {
            display: inline-block;
            background-color: var(--check-color);
            color: var(--text-light);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 700;
            margin-right: 10px;
        }

        .answer-options label {
            display: block; /* Each option on a new line */
            margin-bottom: 0.8rem;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            position: relative; /* For feedback icons */
        }
        .answer-options label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }
        .answer-options input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
             /* Hiding default radio, but keeping accessible */
             opacity: 0;
             position: absolute;
             width: 1px;
             height: 1px;
        }

        /* Custom radio button appearance */
        .answer-options label::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary-color);
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
            background-color: white;
            transition: border-color 0.2s, background-color 0.2s;
            position: relative;
            top: -1px; /* Align better */
        }

         .answer-options input[type="radio"]:checked + span::before {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            box-shadow: inset 0 0 0 3px white;
        }
         .answer-options input[type="radio"]:focus + span::before {
             outline: 2px solid var(--primary-color);
             outline-offset: 2px;
         }

         .answer-options label span { /* The text content */
            vertical-align: middle;
         }

         /* Feedback styles (added via JS) */
        .answer-options label.correct {
            background-color: #d1e7dd;
            border-color: var(--success-color);
            color: var(--success-color);
            font-weight: 500;
        }
         .answer-options label.incorrect {
            background-color: #f8d7da;
            border-color: var(--error-color);
            color: var(--error-color);
         }
        .answer-options label.correct::after,
        .answer-options label.incorrect::after {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
        }
        .answer-options label.correct::after {
            content: '\f00c'; /* Check */
            color: var(--success-color);
        }
        .answer-options label.incorrect::after {
            content: '\f00d'; /* Times */
            color: var(--error-color);
        }

        /* --- Submit/Retry Buttons --- */
        .button-area {
            text-align: center;
            margin-top: 2.5rem;
        }
        .button-area button {
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            min-width: 150px;
        }
        #submit-button {
            background-color: var(--check-color);
            color: var(--text-light);
        }
        #submit-button:hover { background-color: #5a35a1; transform: translateY(-2px); }
        #submit-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; transform: none; }
        #retry-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
            display: none; /* Hidden initially */
            margin-left: 1rem;
        }
        #retry-button:hover { background-color: #5a6268; transform: translateY(-2px); }


        /* --- Result Area --- */
        #result-area {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            display: none; /* Hidden initially */
        }
        #result-area.passed {
            background-color: #d1e7dd; /* Light green */
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        #result-area.failed {
            background-color: #f8d7da; /* Light red */
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }
        #result-area i { margin-right: 8px; }
        #result-message { display: block; margin-bottom: 0.5rem; font-size: 1.2rem; }
        #score-display { display: block; font-size: 1rem; font-weight: 400; color: var(--text-dark); }

        /* --- Footer --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header { padding: 1rem; }
            .kc-header h1 { font-size: 1.5rem; }
            .quiz-container { padding: 1.5rem; }
            .question-text { font-size: 1rem; }
            .answer-options label { padding: 0.7rem 0.9rem; }
            .button-area button { font-size: 1rem; padding: 0.7rem 1.5rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
             .kc-header { flex-direction: column; align-items: stretch; }
             .return-link { margin-right: 0; margin-bottom: 0.8rem; text-align: center; justify-content: center;}
             .kc-header h1 { margin-bottom: 0.8rem; text-align: center; }
             .language-switcher { margin-left: 0; text-align: center; }
             #languageSelect { width: 100%; max-width: 250px; margin: 0 auto; }
            .quiz-container { padding: 1rem; }
            .quiz-instructions { padding: 0.8rem 1rem; font-size: 0.9rem; }
            .question-block { margin-bottom: 2rem; padding-bottom: 1rem;}
            .question-text .q-number { width: 24px; height: 24px; line-height: 24px; font-size: 0.8rem; margin-right: 8px;}
            .answer-options label { font-size: 0.95rem; }
            .button-area button { width: 100%; max-width: 250px; display: block; margin: 0 auto 1rem auto; }
             #retry-button { margin-left: auto; } /* Center retry button when stacked */
             #result-area { font-size: 1rem; padding: 1rem; }
             #result-message { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="kc_return_button">Return to Dashboard</span>
        </a>
        <h1 data-translate="kc_title">Knowledge Check: Module 5</h1>
         <!-- Language Switcher -->
         <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="quiz-container">
        <div class="quiz-instructions">
            <p><i class="fas fa-info-circle"></i> <span data-translate="kc_instructions">Check your understanding of the concepts covered in this module.</span></p>
            <p><i class="fas fa-check-circle"></i> <span data-translate="kc_pass_mark">You need to answer at least <strong>6 out of 10</strong> questions correctly to pass.</span></p>
            <p><i class="fas fa-redo-alt"></i> <span data-translate="kc_attempts">You can attempt this check as many times as you like. Passing will update your progress on the dashboard.</span></p>
        </div>

        <form id="quiz-form">
            <!-- Questions will be dynamically inserted here by JavaScript -->
            <div class="loader" style="text-align:center; padding: 2rem; color: var(--text-muted);">Loading questions...</div>
        </form>

        <div id="result-area" role="alert">
            <span id="result-message"></span>
            <span id="score-display"></span>
        </div>

        <div class="button-area">
            <button type="submit" id="submit-button" form="quiz-form" data-translate="kc_submit_button">Submit Answers</button>
            <button type="button" id="retry-button" data-translate="kc_retry_button">Retry Quiz</button>
        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 5; // <-- *** Identifies this specific knowledge check ***
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Quiz Data for Module 5: Comparisons & Booleans ---
        const quizData = [
            {
                question_key: "m5_q1_text", // "Which operator checks if two values are NOT equal?"
                options_keys: ["m5_q1_opt1", "m5_q1_opt2", "m5_q1_opt3", "m5_q1_opt4"], // ==, !=, <>, =!=
                correct_index: 1
            },
            {
                question_key: "m5_q2_text", // "What is the result of the expression `10 > 5`?"
                options_keys: ["m5_q2_opt1", "m5_q2_opt2", "m5_q2_opt3", "m5_q2_opt4"], // True, False, 10, 5
                correct_index: 0
            },
            {
                question_key: "m5_q3_text", // "What data type does a comparison operation like `<` or `==` return?"
                options_keys: ["m5_q3_opt1", "m5_q3_opt2", "m5_q3_opt3", "m5_q3_opt4"], // int, float, str, bool
                correct_index: 3
            },
            {
                question_key: "m5_q4_text", // "Evaluate the expression: `(5 + 3) == 8`"
                options_keys: ["m5_q4_opt1", "m5_q4_opt2", "m5_q4_opt3", "m5_q4_opt4"], // True, False, 8, Error
                correct_index: 0
            },
            {
                question_key: "m5_q5_text", // "Which expression evaluates to `False`?"
                options_keys: ["m5_q5_opt1", "m5_q5_opt2", "m5_q5_opt3", "m5_q5_opt4"], // `10 <= 10`, `7 != 7`, `"apple" == "apple"`, `0 < 1`
                correct_index: 1
            },
            {
                question_key: "m5_q6_text", // "What will `print(type(True))` output?"
                options_keys: ["m5_q6_opt1", "m5_q6_opt2", "m5_q6_opt3", "m5_q6_opt4"], // True, bool, <class 'bool'>, <type 'bool'>
                correct_index: 2 // Python 3 output
            },
            {
                question_key: "m5_q7_text", // "Consider `x = 15`. Which statement is `True`?"
                options_keys: ["m5_q7_opt1", "m5_q7_opt2", "m5_q7_opt3", "m5_q7_opt4"], // `x < 10`, `x == 15.0`, `x > 20`, `x != 15`
                correct_index: 1 // Integer 15 equals float 15.0
            },
            {
                question_key: "m5_q8_text", // "What is the result of `'hello' > 'goodbye'`?"
                options_keys: ["m5_q8_opt1", "m5_q8_opt2", "m5_q8_opt3", "m5_q8_opt4"], // True, False, Error, Depends on encoding
                correct_index: 0 // Strings are compared lexicographically ('h' > 'g')
            },
            {
                question_key: "m5_q9_text", // "Which value is considered 'falsy' in a boolean context?"
                options_keys: ["m5_q9_opt1", "m5_q9_opt2", "m5_q9_opt3", "m5_q9_opt4"], // 1, "False", 0, -1
                correct_index: 2 // 0 is falsy, others are truthy
            },
            {
                question_key: "m5_q10_text", // "If `a = True` and `b = False`, what is `a == b`?"
                options_keys: ["m5_q10_opt1", "m5_q10_opt2", "m5_q10_opt3", "m5_q10_opt4"], // True, False, Error, None
                correct_index: 1
            }
        ];

        // --- Translations Object ---
        const translations = {
             en: {
                 "kc_page_title": "Knowledge Check - Module 5: Comparisons & Booleans",
                 "kc_return_button": "Return to Dashboard",
                 "kc_title": "Knowledge Check: Module 5",
                 "kc_instructions": "Check your understanding of the concepts covered in this module.",
                 "kc_pass_mark": "You need to answer at least <strong>{score} out of {total}</strong> questions correctly to pass.",
                 "kc_attempts": "You can attempt this check as many times as you like. Passing will update your progress on the dashboard.",
                 "m5_q1_text": "Which operator checks if two values are NOT equal?",
                 "m5_q1_opt1": "`==`", "m5_q1_opt2": "`!=`", "m5_q1_opt3": "`<>`", "m5_q1_opt4": "`=!=`",
                 "m5_q2_text": "What is the result of the expression `10 > 5`?",
                 "m5_q2_opt1": "`True`", "m5_q2_opt2": "`False`", "m5_q2_opt3": "`10`", "m5_q2_opt4": "`5`",
                 "m5_q3_text": "What data type does a comparison operation like `<` or `==` return?",
                 "m5_q3_opt1": "`int`", "m5_q3_opt2": "`float`", "m5_q3_opt3": "`str`", "m5_q3_opt4": "`bool`",
                 "m5_q4_text": "Evaluate the expression: `(5 + 3) == 8`",
                 "m5_q4_opt1": "`True`", "m5_q4_opt2": "`False`", "m5_q4_opt3": "`8`", "m5_q4_opt4": "Error",
                 "m5_q5_text": "Which expression evaluates to `False`?",
                 "m5_q5_opt1": "`10 <= 10`", "m5_q5_opt2": "`7 != 7`", "m5_q5_opt3": "`\"apple\" == \"apple\"`", "m5_q5_opt4": "`0 < 1`",
                 "m5_q6_text": "What will `print(type(True))` output?",
                 "m5_q6_opt1": "`True`", "m5_q6_opt2": "`bool`", "m5_q6_opt3": "`<class 'bool'>`", "m5_q6_opt4": "`<type 'bool'>`",
                 "m5_q7_text": "Consider `x = 15`. Which statement is `True`?",
                 "m5_q7_opt1": "`x < 10`", "m5_q7_opt2": "`x == 15.0`", "m5_q7_opt3": "`x > 20`", "m5_q7_opt4": "`x != 15`",
                 "m5_q8_text": "What is the result of `'hello' > 'goodbye'`?",
                 "m5_q8_opt1": "`True`", "m5_q8_opt2": "`False`", "m5_q8_opt3": "Error", "m5_q8_opt4": "Depends on encoding",
                 "m5_q9_text": "Which value is considered 'falsy' in a boolean context (meaning it evaluates to `False` when used in a condition)?",
                 "m5_q9_opt1": "`1`", "m5_q9_opt2": "`\"False\"`", "m5_q9_opt3": "`0`", "m5_q9_opt4": "`-1`",
                 "m5_q10_text": "If `a = True` and `b = False`, what is `a == b`?",
                 "m5_q10_opt1": "`True`", "m5_q10_opt2": "`False`", "m5_q10_opt3": "Error", "m5_q10_opt4": "`None`",
                 "kc_submit_button": "Submit Answers",
                 "kc_retry_button": "Retry Quiz",
                 "kc_result_passed": "<i class='fas fa-check-circle'></i> Congratulations, you passed!",
                 "kc_result_failed": "<i class='fas fa-times-circle'></i> Keep trying! You need {required} correct answers to pass.",
                 "kc_score_display": "Your score: {score} out of {total}",
                 "kc_feedback_correct": "Correct!",
                 "kc_feedback_incorrect": "Incorrect.",
                 "kc_feedback_your_answer": "Your answer:",
                 "kc_feedback_correct_answer": "Correct answer:",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "Part of the Road to Free Open AGI Project"
             },
             pt: {
                 "kc_page_title": "Verificação de Conhecimento - Módulo 5: Comparações & Booleanos",
                 "kc_return_button": "Voltar ao Painel",
                 "kc_title": "Verificação: Módulo 5",
                 "kc_instructions": "Verifique seu entendimento dos conceitos abordados neste módulo.",
                 "kc_pass_mark": "Você precisa acertar pelo menos <strong>{score} de {total}</strong> questões para passar.",
                 "kc_attempts": "Você pode tentar esta verificação quantas vezes quiser. Passar atualizará seu progresso no painel.",
                 "m5_q1_text": "Qual operador verifica se dois valores NÃO são iguais?",
                 "m5_q1_opt1": "`==`", "m5_q1_opt2": "`!=`", "m5_q1_opt3": "`<>`", "m5_q1_opt4": "`=!=`",
                 "m5_q2_text": "Qual é o resultado da expressão `10 > 5`?",
                 "m5_q2_opt1": "`True`", "m5_q2_opt2": "`False`", "m5_q2_opt3": "`10`", "m5_q2_opt4": "`5`",
                 "m5_q3_text": "Qual tipo de dado uma operação de comparação como `<` ou `==` retorna?",
                 "m5_q3_opt1": "`int`", "m5_q3_opt2": "`float`", "m5_q3_opt3": "`str`", "m5_q3_opt4": "`bool`",
                 "m5_q4_text": "Avalie a expressão: `(5 + 3) == 8`",
                 "m5_q4_opt1": "`True`", "m5_q4_opt2": "`False`", "m5_q4_opt3": "`8`", "m5_q4_opt4": "Erro",
                 "m5_q5_text": "Qual expressão avalia para `False`?",
                 "m5_q5_opt1": "`10 <= 10`", "m5_q5_opt2": "`7 != 7`", "m5_q5_opt3": "`\"apple\" == \"apple\"`", "m5_q5_opt4": "`0 < 1`",
                 "m5_q6_text": "O que `print(type(True))` exibirá?",
                 "m5_q6_opt1": "`True`", "m5_q6_opt2": "`bool`", "m5_q6_opt3": "`<class 'bool'>`", "m5_q6_opt4": "`<type 'bool'>`",
                 "m5_q7_text": "Considere `x = 15`. Qual afirmação é `True`?",
                 "m5_q7_opt1": "`x < 10`", "m5_q7_opt2": "`x == 15.0`", "m5_q7_opt3": "`x > 20`", "m5_q7_opt4": "`x != 15`",
                 "m5_q8_text": "Qual é o resultado de `'hello' > 'goodbye'`?",
                 "m5_q8_opt1": "`True`", "m5_q8_opt2": "`False`", "m5_q8_opt3": "Erro", "m5_q8_opt4": "Depende da codificação",
                 "m5_q9_text": "Qual valor é considerado 'falsy' em um contexto booleano (ou seja, avalia para `False` quando usado em uma condição)?",
                 "m5_q9_opt1": "`1`", "m5_q9_opt2": "`\"False\"`", "m5_q9_opt3": "`0`", "m5_q9_opt4": "`-1`",
                 "m5_q10_text": "Se `a = True` e `b = False`, qual é o valor de `a == b`?",
                 "m5_q10_opt1": "`True`", "m5_q10_opt2": "`False`", "m5_q10_opt3": "Erro", "m5_q10_opt4": "`None`",
                 "kc_submit_button": "Enviar Respostas",
                 "kc_retry_button": "Tentar Novamente",
                 "kc_result_passed": "<i class='fas fa-check-circle'></i> Parabéns, você passou!",
                 "kc_result_failed": "<i class='fas fa-times-circle'></i> Continue tentando! Você precisa de {required} respostas corretas para passar.",
                 "kc_score_display": "Sua pontuação: {score} de {total}",
                 "kc_feedback_correct": "Correto!",
                 "kc_feedback_incorrect": "Incorreto.",
                 "kc_feedback_your_answer": "Sua resposta:",
                 "kc_feedback_correct_answer": "Resposta correta:",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "Parte do Projeto Road to Free Open AGI"
             },
             zh: {
                 "kc_page_title": "知识测验 - 模块 5: 比较与布尔值",
                 "kc_return_button": "返回仪表板",
                 "kc_title": "知识测验: 模块 5",
                 "kc_instructions": "检查您对本模块所涵盖概念的理解。",
                 "kc_pass_mark": "您需要正确回答 <strong>{total} 个问题中的至少 {score} 个</strong> 才能通过。",
                 "kc_attempts": "您可以根据需要多次尝试此测验。通过后将在仪表板上更新您的进度。",
                 "m5_q1_text": "哪个运算符检查两个值是否不相等？",
                 "m5_q1_opt1": "`==`", "m5_q1_opt2": "`!=`", "m5_q1_opt3": "`<>`", "m5_q1_opt4": "`=!=`",
                 "m5_q2_text": "表达式 `10 > 5` 的结果是什么？",
                 "m5_q2_opt1": "`True`", "m5_q2_opt2": "`False`", "m5_q2_opt3": "`10`", "m5_q2_opt4": "`5`",
                 "m5_q3_text": "像 `<` 或 `==` 这样的比较运算返回什么数据类型？",
                 "m5_q3_opt1": "`int`", "m5_q3_opt2": "`float`", "m5_q3_opt3": "`str`", "m5_q3_opt4": "`bool`",
                 "m5_q4_text": "评估表达式：`(5 + 3) == 8`",
                 "m5_q4_opt1": "`True`", "m5_q4_opt2": "`False`", "m5_q4_opt3": "`8`", "m5_q4_opt4": "错误",
                 "m5_q5_text": "哪个表达式的计算结果为 `False`？",
                 "m5_q5_opt1": "`10 <= 10`", "m5_q5_opt2": "`7 != 7`", "m5_q5_opt3": "`\"apple\" == \"apple\"`", "m5_q5_opt4": "`0 < 1`",
                 "m5_q6_text": "`print(type(True))` 会输出什么？",
                 "m5_q6_opt1": "`True`", "m5_q6_opt2": "`bool`", "m5_q6_opt3": "`<class 'bool'>`", "m5_q6_opt4": "`<type 'bool'>`",
                 "m5_q7_text": "假设 `x = 15`。哪个语句是 `True`？",
                 "m5_q7_opt1": "`x < 10`", "m5_q7_opt2": "`x == 15.0`", "m5_q7_opt3": "`x > 20`", "m5_q7_opt4": "`x != 15`",
                 "m5_q8_text": "`'hello' > 'goodbye'` 的结果是什么？",
                 "m5_q8_opt1": "`True`", "m5_q8_opt2": "`False`", "m5_q8_opt3": "错误", "m5_q8_opt4": "取决于编码",
                 "m5_q9_text": "在布尔上下文中，哪个值被认为是 'falsy'（即在条件判断中计算为 `False`）？",
                 "m5_q9_opt1": "`1`", "m5_q9_opt2": "`\"False\"`", "m5_q9_opt3": "`0`", "m5_q9_opt4": "`-1`",
                 "m5_q10_text": "如果 `a = True` 且 `b = False`，那么 `a == b` 的结果是什么？",
                 "m5_q10_opt1": "`True`", "m5_q10_opt2": "`False`", "m5_q10_opt3": "错误", "m5_q10_opt4": "`None`",
                 "kc_submit_button": "提交答案",
                 "kc_retry_button": "重试测验",
                 "kc_result_passed": "<i class='fas fa-check-circle'></i> 恭喜，您已通过！",
                 "kc_result_failed": "<i class='fas fa-times-circle'></i> 继续努力！您需要答对 {required} 题才能通过。",
                 "kc_score_display": "您的得分：{total} 题中答对 {score} 题",
                 "kc_feedback_correct": "正确！",
                 "kc_feedback_incorrect": "错误。",
                 "kc_feedback_your_answer": "您的答案：",
                 "kc_feedback_correct_answer": "正确答案：",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "通往自由开放AGI之路项目的一部分"
             }
         };


        document.addEventListener('DOMContentLoaded', () => {
            const quizForm = document.getElementById('quiz-form');
            const resultArea = document.getElementById('result-area');
            const resultMessage = document.getElementById('result-message');
            const scoreDisplay = document.getElementById('score-display');
            const submitButton = document.getElementById('submit-button');
            const retryButton = document.getElementById('retry-button');
            const languageSelect = document.getElementById('languageSelect');

            let currentLang = getStoredLanguage();
            let userAnswers = {}; // Store user selections for feedback

            // --- Translation Functions ---
            function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); return (storedLang && translations[storedLang]) ? storedLang : 'en'; }
            function setLanguage(lang) { if (!translations[lang]) lang = 'en'; localStorage.setItem(LANGUAGE_STORAGE_KEY, lang); document.documentElement.lang = lang; if (languageSelect) languageSelect.value = lang; translatePage(lang); displayQuiz(lang); resetQuizState(); /* Reset results on lang change */ }
            function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
            function translatePage(lang) { document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const replacements = (key === 'kc_pass_mark' || key === 'kc_score_display') ? { score: PASSING_SCORE, total: quizData.length } : {}; const translation = getTranslation(key, lang, replacements); if (el.tagName === 'TITLE') { document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } }); document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); }); document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); }); }

            // --- Quiz Logic ---
            function displayQuiz(lang) {
                quizForm.innerHTML = ''; // Clear previous questions
                userAnswers = {}; // Reset answers
                quizData.forEach((item, index) => {
                    const questionBlock = document.createElement('div');
                    questionBlock.classList.add('question-block');
                    questionBlock.setAttribute('data-question-index', index);

                    const questionText = document.createElement('p');
                    questionText.classList.add('question-text');
                    questionText.innerHTML = `<span class="q-number">${index + 1}</span> ${getTranslation(item.question_key, lang)}`;
                    questionBlock.appendChild(questionText);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.classList.add('answer-options');

                    // Randomize options order - Optional but good practice
                    const optionIndices = item.options_keys.map((_, i) => i);
                    // Fisher-Yates shuffle (optional - keep simple for now if preferred)
                    // for (let i = optionIndices.length - 1; i > 0; i--) {
                    //     const j = Math.floor(Math.random() * (i + 1));
                    //     [optionIndices[i], optionIndices[j]] = [optionIndices[j], optionIndices[i]];
                    // }

                    optionIndices.forEach(optionIndex => {
                        const optionKey = item.options_keys[optionIndex];
                        const optionId = `q${index}_opt${optionIndex}`;

                        const label = document.createElement('label');
                        label.htmlFor = optionId;

                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = `q${index}`;
                        radio.value = optionIndex; // Store the original index
                        radio.id = optionId;
                        radio.required = true; // Ensure an answer is selected

                        const span = document.createElement('span');
                        // Use textContent for options to prevent accidental HTML injection if keys somehow contain it
                        span.textContent = ` ${getTranslation(optionKey, lang)}`;

                         label.appendChild(radio);
                         label.appendChild(span); // Wrap text in span for ::before styling
                         optionsDiv.appendChild(label);
                    });

                    questionBlock.appendChild(optionsDiv);
                    quizForm.appendChild(questionBlock);
                });
            }

            function checkAnswers(lang) {
                let score = 0;
                userAnswers = {}; // Clear previous answers before checking
                quizData.forEach((item, index) => {
                    const selectedOption = quizForm.elements[`q${index}`]?.value;
                    const correctAnswerIndex = item.correct_index;
                    const questionBlock = quizForm.querySelector(`.question-block[data-question-index="${index}"]`);
                    const labels = questionBlock.querySelectorAll('.answer-options label');

                    userAnswers[index] = selectedOption ? parseInt(selectedOption) : null; // Store user choice

                    labels.forEach(label => {
                         const radio = label.querySelector('input[type="radio"]');
                         radio.disabled = true; // Disable options after submission
                         label.classList.remove('correct', 'incorrect'); // Clear previous feedback
                     });


                    if (selectedOption !== undefined && parseInt(selectedOption) === correctAnswerIndex) {
                        score++;
                         const correctLabel = questionBlock.querySelector(`input[value="${correctAnswerIndex}"]`).closest('label');
                         if(correctLabel) correctLabel.classList.add('correct');
                    } else {
                        // Highlight incorrect selection (if any)
                        if (selectedOption !== undefined) {
                             const incorrectLabel = questionBlock.querySelector(`input[value="${selectedOption}"]`).closest('label');
                             if(incorrectLabel) incorrectLabel.classList.add('incorrect');
                        }
                        // Always highlight the correct answer
                         const correctLabel = questionBlock.querySelector(`input[value="${correctAnswerIndex}"]`).closest('label');
                         if(correctLabel) correctLabel.classList.add('correct'); // Show correct even if user missed it
                    }
                });
                return score;
            }

             function displayResults(score, lang) {
                const passed = score >= PASSING_SCORE;
                resultArea.style.display = 'block';
                resultArea.className = passed ? 'passed' : 'failed'; // Add class for styling

                if (passed) {
                    resultMessage.innerHTML = getTranslation('kc_result_passed', lang);
                    saveKnowledgeCheckStatus(MODULE_ID, true);
                } else {
                     resultMessage.innerHTML = getTranslation('kc_result_failed', lang, { required: PASSING_SCORE });
                }
                 scoreDisplay.textContent = getTranslation('kc_score_display', lang, { score: score, total: quizData.length });

                 // Scroll to results smoothly
                 resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            function resetQuizState() {
                resultArea.style.display = 'none';
                submitButton.disabled = false;
                retryButton.style.display = 'none';
                // Re-enable radio buttons and clear feedback styles if retry is clicked
                quizForm.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = false);
                quizForm.querySelectorAll('.answer-options label').forEach(label => {
                     label.classList.remove('correct', 'incorrect');
                });
                 quizForm.reset(); // Clear selections
                 userAnswers = {};
            }

            // --- LocalStorage Functions ---
            function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
            function saveKnowledgeCheckStatus(moduleId, status) { try { const currentStatus = loadKnowledgeCheckStatus(); if (status === true || !(moduleId in currentStatus)) { // Only save 'true' or if not previously saved currentStatus[moduleId] = status; localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus)); } } catch (e) { console.error("Error saving KC status to localStorage:", e); } }

            // --- Event Listeners ---
            quizForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const lang = getStoredLanguage();
                const score = checkAnswers(lang);
                displayResults(score, lang);
                submitButton.disabled = true;
                retryButton.style.display = 'inline-block'; // Show retry button
            });

            retryButton.addEventListener('click', () => {
                 resetQuizState();
                 // Scroll back to the top of the quiz smoothly
                 quizForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });

            languageSelect.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            // --- Initial Load ---
            setLanguage(currentLang); // Sets language, translates static text, displays quiz
        });
    </script>

</body>
</html>