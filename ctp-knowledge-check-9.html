<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 9 Check - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for check icon color */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-top: 80px; /* Adjust for fixed header */
        }

        /* --- Header / Navigation --- */
        .quiz-header {
            background: linear-gradient(135deg, #6f42c1, #4a2a8a); /* Gradient using check color */
            color: var(--text-light);
            padding: 1rem 1.5rem;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .return-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed);
        }
        .return-link:hover {
             background-color: rgba(255, 255, 255, 0.1);
        }
        .return-link i {
            margin-right: 8px;
        }
        .language-switcher { margin-left: auto; padding-right: 1rem; }
         #languageSelect {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 1px solid var(--text-light);
            border-radius: 5px;
            padding: 6px 30px 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: var(--accent-color); }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        .quiz-container h1 {
            font-family: var(--font-title);
            font-size: 1.8rem;
            color: var(--check-color);
            margin-bottom: 0.5rem;
            text-align: center;
            border-bottom: 2px solid var(--check-color);
            padding-bottom: 0.5rem;
        }
         .quiz-container h1 i {
             margin-right: 10px;
         }
        .quiz-instructions {
            font-size: 0.95rem;
            color: var(--text-muted);
            background-color: #f8f9fa;
            padding: 0.8rem 1rem;
            border-radius: 5px;
            margin-bottom: 2rem;
            border: 1px dashed var(--border-color);
            text-align: center;
        }
        .quiz-instructions strong {
            color: var(--check-color);
        }

        /* --- Questions Styling --- */
        #quiz-questions { margin-bottom: 2rem; }
        .question-block {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fdfdff; /* Slightly off-white */
        }
        .question-block:last-child { margin-bottom: 0; }
        .question-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
         .question-text code {
            background-color: #e9ecef;
            padding: 0.1em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
            color: #c7254e;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
         }
         .question-text pre { /* For multi-line code in questions */
            background-color: #e9ecef;
            padding: 0.8rem;
            border-radius: 5px;
            margin-top: 0.5rem;
            white-space: pre-wrap; /* Wrap long lines */
            word-wrap: break-word;
            font-size: 0.9em;
         }
        .options { display: flex; flex-direction: column; gap: 0.75rem; }
        .options label {
            display: block;
            background-color: var(--background-page);
            padding: 0.8rem 1rem;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all var(--transition-speed);
            position: relative;
            font-size: 0.95rem;
        }
        .options input[type="radio"] {
            display: none; /* Hide the actual radio button */
        }
        .options label:hover {
            background-color: #e7f1ff;
            border-color: var(--primary-color);
        }
        .options input[type="radio"]:checked + label {
            background-color: #ddeeff;
            border-color: var(--primary-color);
            font-weight: 500;
            color: var(--primary-color);
        }
        .options input[type="radio"]:disabled + label { /* Style for disabled options after check */
            cursor: not-allowed;
            opacity: 0.7;
            background-color: #e9ecef;
            border-color: var(--border-color);
            color: var(--text-muted);
        }
        .options input[type="radio"]:disabled:checked + label { /* Keep checked style distinct */
             background-color: #d1e7ff;
             border-color: var(--primary-color);
             color: var(--primary-color);
             font-weight: 500;
             opacity: 1; /* Full opacity for the selected one */
        }
         /* Styling for correct/incorrect label after check */
         .options label.correct {
             border-color: var(--success-color);
             background-color: #d1e7dd;
             color: #0f5132;
             font-weight: bold;
         }
         .options label.incorrect {
             border-color: var(--error-color);
             background-color: #f8d7da;
             color: #842029;
             font-weight: bold;
         }
        .feedback {
            margin-top: 0.8rem;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: none; /* Initially hidden */
        }
        .feedback.correct {
            color: var(--success-color);
            background-color: #e6f9ef;
            border: 1px solid #b3e0c8;
            display: block;
        }
        .feedback.incorrect {
            color: var(--error-color);
            background-color: #fdedee;
            border: 1px solid #f5c6cb;
            display: block;
        }
        .feedback.unanswered {
            color: var(--accent-color); /* Use warning color */
            background-color: #fff9e6;
            border: 1px solid #ffe58f;
            display: block;
        }

        /* --- Results & Buttons --- */
        #quiz-results {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.2rem;
            display: none; /* Initially hidden */
        }
        #quiz-results.pass {
            background-color: #e6f9ef;
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        #quiz-results.fail {
            background-color: #fdedee;
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }
        #quiz-results .score { font-weight: bold; display: block; margin-bottom: 0.5rem; font-size: 1.3rem; }
        #quiz-results .message { font-weight: 500; }

        .quiz-buttons {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        .quiz-buttons button {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
        }
        .quiz-buttons button:hover { transform: translateY(-2px); }
        #submit-button {
            background-color: var(--check-color);
            color: var(--text-light);
        }
        #submit-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.7;
        }
        #retry-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
            display: none; /* Initially hidden */
        }
        #retry-button:hover { background-color: #5a6268; }
        #submit-button:hover:not(:disabled) { background-color: #5a3d9e; }


        /* --- Responsive --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            body { padding-top: 70px; }
            .quiz-container { padding: 1.5rem; margin: 1.5rem; }
             .quiz-header { padding: 0.8rem 1rem; }
             .return-link { font-size: 0.9rem; padding: 0.4rem 0.8rem;}
             #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
            .quiz-container h1 { font-size: 1.6rem; }
            .question-block { padding: 1rem; }
        }
        @media (max-width: 576px) {
             html { font-size: 14px; }
             body { padding-top: 60px; }
             .quiz-header { flex-direction: column; align-items: flex-start; padding: 0.5rem 1rem; height: auto; position: static; } /* Adjust header */
             body { padding-top: 0; } /* Remove padding if header is static */
             .language-switcher { margin-left: 0; margin-top: 0.5rem; width: 100%; padding-right: 0;}
             #languageSelect { width: 100%; text-align: center; background-position: right 50% center; }
             .return-link { margin-bottom: 0.5rem; }
             .quiz-container { padding: 1rem; margin: 1rem; }
             .quiz-container h1 { font-size: 1.4rem; }
             .question-text { font-size: 1rem; }
             .options label { padding: 0.7rem 0.8rem; font-size: 0.9rem; }
             .quiz-buttons { flex-direction: column; }
             .quiz-buttons button { width: 100%; }
         }

    </style>
</head>
<body>

    <header class="quiz-header">
        <a href="ctp-dashboard.html" class="return-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
        </a>
        <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="quiz-container">
        <h1 data-translate="quiz_title"><i class="fas fa-check-double"></i> Module 9: Knowledge Check</h1>

        <div class="quiz-instructions">
             <span data-translate="quiz_instructions_text">Select the best answer for each question. You need <strong data-translate="passing_score_num">6</strong> out of 10 correct answers to pass. You can retry as many times as you like.</span>
        </div>

        <form id="quiz-form">
            <div id="quiz-questions">
                <!-- Questions will be loaded here by JavaScript -->
            </div>

            <div class="quiz-buttons">
                <button type="submit" id="submit-button" data-translate="submit_button">Check Answers</button>
                <button type="button" id="retry-button" data-translate="retry_button">Retry Quiz</button>
            </div>
        </form>

        <div id="quiz-results">
            <span class="score">Score: <span id="score-value">0</span> / 10</span>
            <span class="message" id="result-message"></span>
        </div>

    </main>


    <script>
        // --- Constants ---
        const MODULE_ID = 9;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;

        // --- Translations Object (including questions) ---
        const translations = {
            en: {
                "page_title": "Module 9 Check - Combining Conditions",
                "return_button": "Return to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "quiz_title": "Module 9: Combining Conditions",
                "quiz_instructions_text": "Select the best answer for each question. You need {score} out of {total} correct answers to pass. You can retry as many times as you like.",
                "passing_score_num": "6", // Keep separate for easy reference if needed elsewhere
                "submit_button": "Check Answers",
                "retry_button": "Retry Quiz",
                "feedback_correct": "Correct!",
                "feedback_incorrect": "Incorrect. The correct answer was {correct_answer}.",
                "feedback_unanswered": "Please select an answer.",
                "result_pass": "Congratulations! You passed! Your progress has been updated.",
                "result_fail": "Keep trying! You need {score_needed} more correct answers to pass.",
                // --- Questions & Answers ---
                "q1_text": "What is the result of the following expression: `True and False`?",
                "q1_opt_a": "`True`", "q1_opt_b": "`False`", "q1_opt_c": "`None`", "q1_opt_d": "Error",
                "q2_text": "What is the result of the following expression: `False or True`?",
                "q2_opt_a": "`True`", "q2_opt_b": "`False`", "q2_opt_c": "`None`", "q2_opt_d": "Error",
                "q3_text": "What does the `not` operator do?",
                "q3_opt_a": "Combines two conditions, requiring both to be true.", "q3_opt_b": "Combines two conditions, requiring at least one to be true.", "q3_opt_c": "Inverts the boolean value of a condition.", "q3_opt_d": "Checks if two values are not equal.",
                "q4_text": "Consider `x = 10`. What is the result of `(x > 5) and (x < 15)`?",
                "q4_opt_a": "`True`", "q4_opt_b": "`False`", "q4_opt_c": "`10`", "q4_opt_d": "Error",
                "q5_text": "Consider `age = 25`. What is the result of `(age < 18) or (age > 65)`?",
                "q5_opt_a": "`True`", "q5_opt_b": "`False`", "q5_opt_c": "`25`", "q5_opt_d": "Error",
                "q6_text": "What is the value of `not (10 == 10)`?",
                "q6_opt_a": "`True`", "q6_opt_b": "`False`", "q6_opt_c": "`None`", "q6_opt_d": "`0`",
                "q7_text": "Which operator has the highest precedence (is evaluated first) among `and`, `or`, `not`?",
                "q7_opt_a": "`and`", "q7_opt_b": "`or`", "q7_opt_c": "`not`", "q7_opt_d": "They have equal precedence.",
                "q8_text": "What is the result of `True or False and False`?",
                "q8_opt_a": "`True`", "q8_opt_b": "`False`", "q8_opt_c": "`None`", "q8_opt_d": "Error",
                "q9_text": "Consider the code: <pre><code>is_valid = True\nhas_permission = False\n\nresult = is_valid and not has_permission</code></pre> What is the value of `result`?",
                "q9_opt_a": "`True`", "q9_opt_b": "`False`", "q9_opt_c": "`None`", "q9_opt_d": "The code has an error.",
                "q10_text": "If you want an `if` statement to execute only when `score` is *not* between 50 and 100 (inclusive), which condition should you use?",
                "q10_opt_a": "`score >= 50 and score <= 100`", "q10_opt_b": "`score < 50 and score > 100`", "q10_opt_c": "`not (score >= 50 and score <= 100)`", "q10_opt_d": "`score < 50 and not score > 100`",
            },
            pt: {
                "page_title": "Módulo 9 Check - Combinando Condições",
                "return_button": "Voltar ao Painel",
                "lang_select_aria": "Selecionar Idioma",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "quiz_title": "Módulo 9: Combinando Condições",
                "quiz_instructions_text": "Selecione a melhor resposta para cada pergunta. Você precisa de {score} de {total} respostas corretas para passar. Você pode tentar quantas vezes quiser.",
                "passing_score_num": "6",
                "submit_button": "Verificar Respostas",
                "retry_button": "Tentar Novamente",
                "feedback_correct": "Correto!",
                "feedback_incorrect": "Incorreto. A resposta correta era {correct_answer}.",
                "feedback_unanswered": "Por favor, selecione uma resposta.",
                "result_pass": "Parabéns! Você passou! Seu progresso foi atualizado.",
                "result_fail": "Continue tentando! Você precisa de mais {score_needed} respostas corretas para passar.",
                // --- Questions & Answers ---
                "q1_text": "Qual é o resultado da seguinte expressão: `True and False`?",
                "q1_opt_a": "`True`", "q1_opt_b": "`False`", "q1_opt_c": "`None`", "q1_opt_d": "Erro",
                "q2_text": "Qual é o resultado da seguinte expressão: `False or True`?",
                "q2_opt_a": "`True`", "q2_opt_b": "`False`", "q2_opt_c": "`None`", "q2_opt_d": "Erro",
                "q3_text": "O que o operador `not` faz?",
                "q3_opt_a": "Combina duas condições, exigindo que ambas sejam verdadeiras.", "q3_opt_b": "Combina duas condições, exigindo que pelo menos uma seja verdadeira.", "q3_opt_c": "Inverte o valor booleano de uma condição.", "q3_opt_d": "Verifica se dois valores não são iguais.",
                "q4_text": "Considere `x = 10`. Qual é o resultado de `(x > 5) and (x < 15)`?",
                "q4_opt_a": "`True`", "q4_opt_b": "`False`", "q4_opt_c": "`10`", "q4_opt_d": "Erro",
                "q5_text": "Considere `idade = 25`. Qual é o resultado de `(idade < 18) or (idade > 65)`?",
                "q5_opt_a": "`True`", "q5_opt_b": "`False`", "q5_opt_c": "`25`", "q5_opt_d": "Erro",
                "q6_text": "Qual é o valor de `not (10 == 10)`?",
                "q6_opt_a": "`True`", "q6_opt_b": "`False`", "q6_opt_c": "`None`", "q6_opt_d": "`0`",
                "q7_text": "Qual operador tem a maior precedência (é avaliado primeiro) entre `and`, `or`, `not`?",
                "q7_opt_a": "`and`", "q7_opt_b": "`or`", "q7_opt_c": "`not`", "q7_opt_d": "Eles têm precedência igual.",
                "q8_text": "Qual é o resultado de `True or False and False`?",
                "q8_opt_a": "`True`", "q8_opt_b": "`False`", "q8_opt_c": "`None`", "q8_opt_d": "Erro",
                "q9_text": "Considere o código: <pre><code>e_valido = True\ntem_permissao = False\n\nresultado = e_valido and not tem_permissao</code></pre> Qual é o valor de `resultado`?",
                "q9_opt_a": "`True`", "q9_opt_b": "`False`", "q9_opt_c": "`None`", "q9_opt_d": "O código tem um erro.",
                "q10_text": "Se você quer que uma instrução `if` execute apenas quando `pontos` *não* está entre 50 e 100 (inclusive), qual condição você deve usar?",
                "q10_opt_a": "`pontos >= 50 and pontos <= 100`", "q10_opt_b": "`pontos < 50 and pontos > 100`", "q10_opt_c": "`not (pontos >= 50 and pontos <= 100)`", "q10_opt_d": "`pontos < 50 and not pontos > 100`",
            },
            zh: {
                "page_title": "模块 9 测验 - 组合条件",
                "return_button": "返回仪表板",
                "lang_select_aria": "选择语言",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "quiz_title": "模块 9: 组合条件",
                "quiz_instructions_text": "为每个问题选择最佳答案。您需要答对 {total} 题中的 {score} 题才能通过。您可以无限次重试。",
                "passing_score_num": "6",
                "submit_button": "检查答案",
                "retry_button": "重新测验",
                "feedback_correct": "正确!",
                "feedback_incorrect": "错误。 正确答案是 {correct_answer}。",
                "feedback_unanswered": "请选择一个答案。",
                "result_pass": "恭喜！您已通过！您的进度已更新。",
                "result_fail": "请继续努力！您还需要答对 {score_needed} 题才能通过。",
                // --- Questions & Answers ---
                "q1_text": "以下表达式的结果是什么：`True and False`?",
                "q1_opt_a": "`True`", "q1_opt_b": "`False`", "q1_opt_c": "`None`", "q1_opt_d": "错误",
                "q2_text": "以下表达式的结果是什么：`False or True`?",
                "q2_opt_a": "`True`", "q2_opt_b": "`False`", "q2_opt_c": "`None`", "q2_opt_d": "错误",
                "q3_text": "`not` 运算符的作用是什么？",
                "q3_opt_a": "组合两个条件，要求两者都为真。", "q3_opt_b": "组合两个条件，要求至少一个为真。", "q3_opt_c": "反转条件的布尔值。", "q3_opt_d": "检查两个值是否不相等。",
                "q4_text": "假设 `x = 10`。 `(x > 5) and (x < 15)` 的结果是什么？",
                "q4_opt_a": "`True`", "q4_opt_b": "`False`", "q4_opt_c": "`10`", "q4_opt_d": "错误",
                "q5_text": "假设 `age = 25`。 `(age < 18) or (age > 65)` 的结果是什么？",
                "q5_opt_a": "`True`", "q5_opt_b": "`False`", "q5_opt_c": "`25`", "q5_opt_d": "错误",
                "q6_text": "`not (10 == 10)` 的值是什么？",
                "q6_opt_a": "`True`", "q6_opt_b": "`False`", "q6_opt_c": "`None`", "q6_opt_d": "`0`",
                "q7_text": "在 `and`, `or`, `not` 中，哪个运算符的优先级最高（首先计算）？",
                "q7_opt_a": "`and`", "q7_opt_b": "`or`", "q7_opt_c": "`not`", "q7_opt_d": "它们的优先级相同。",
                "q8_text": "`True or False and False` 的结果是什么？",
                "q8_opt_a": "`True`", "q8_opt_b": "`False`", "q8_opt_c": "`None`", "q8_opt_d": "错误",
                "q9_text": "考虑以下代码：<pre><code>is_valid = True\nhas_permission = False\n\nresult = is_valid and not has_permission</code></pre> `result` 的值是什么？",
                "q9_opt_a": "`True`", "q9_opt_b": "`False`", "q9_opt_c": "`None`", "q9_opt_d": "代码有错误。",
                "q10_text": "如果您希望 `if` 语句仅在 `score` *不* 在 50 和 100 之间（含）时执行，您应该使用哪个条件？",
                "q10_opt_a": "`score >= 50 and score <= 100`", "q10_opt_b": "`score < 50 and score > 100`", "q10_opt_c": "`not (score >= 50 and score <= 100)`", "q10_opt_d": "`score < 50 and not score > 100`",
            }
        };

        // --- Correct Answers ---
        // Stored separately for easier checking
        const correctAnswers = {
            q1: 'b', q2: 'a', q3: 'c', q4: 'a', q5: 'b',
            q6: 'b', q7: 'c', q8: 'a', q9: 'a', q10: 'c'
        };

        // --- Language and Translation Functions (Mostly from Dashboard) ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            document.documentElement.lang = lang;
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;
             translatePage(lang); // Translate static text
             loadQuiz(lang);      // Reload quiz content in the new language
        }

        function getTranslation(key, lang, replacements = {}) {
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             // Handle replacements (e.g., for score/total in instructions)
             text = text.replace('{score}', PASSING_SCORE.toString())
                        .replace('{total}', TOTAL_QUESTIONS.toString());
             // Handle dynamic replacements passed in
             for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
        }

        function translatePage(lang) {
             document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                 // Special handling for instructions needing score replacement
                 if (key === 'quiz_instructions_text') {
                     el.innerHTML = getTranslation(key, lang); // Use innerHTML for strong tag
                 } else if (key === 'passing_score_num') {
                     el.textContent = getTranslation(key, lang); // Simple text replacement
                 } else {
                    const translation = getTranslation(key, lang);
                    if (el.tagName === 'TITLE') { document.title = translation; }
                    else if (el.tagName === 'BUTTON' || el.tagName === 'OPTION' || key === 'return_button') { el.textContent = translation; }
                    else { el.innerHTML = translation; } // Allow HTML in translations (like title icon)
                 }
             });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
             });
        }

        // --- Quiz Logic ---
        const quizForm = document.getElementById('quiz-form');
        const questionsContainer = document.getElementById('quiz-questions');
        const resultsContainer = document.getElementById('quiz-results');
        const scoreValueEl = document.getElementById('score-value');
        const resultMessageEl = document.getElementById('result-message');
        const submitButton = document.getElementById('submit-button');
        const retryButton = document.getElementById('retry-button');
        const languageSelect = document.getElementById('languageSelect');

        function loadQuiz(lang) {
            questionsContainer.innerHTML = ''; // Clear previous questions
            resultsContainer.style.display = 'none'; // Hide results
            submitButton.disabled = false; // Enable submit button
            submitButton.style.display = 'inline-block';
            retryButton.style.display = 'none'; // Hide retry button

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const questionKey = `q${i}_text`;
                const questionText = getTranslation(questionKey, lang);

                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.setAttribute('data-question-id', `q${i}`);

                const textElement = document.createElement('p');
                textElement.classList.add('question-text');
                textElement.innerHTML = `${i}. ${questionText}`; // Use innerHTML to render code/pre tags
                questionBlock.appendChild(textElement);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options');

                for (let opt of ['a', 'b', 'c', 'd']) {
                    const optionKey = `q${i}_opt_${opt}`;
                    const optionText = getTranslation(optionKey, lang);

                    if (optionText.startsWith('[')) continue; // Skip if translation missing for an option

                    const inputId = `q${i}_${opt}`;

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = inputId;
                    input.name = `q${i}`;
                    input.value = opt;

                    const label = document.createElement('label');
                    label.htmlFor = inputId;
                    label.innerHTML = optionText; // Use innerHTML for potential code tags in options

                    optionsDiv.appendChild(input);
                    optionsDiv.appendChild(label);
                }
                questionBlock.appendChild(optionsDiv);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.classList.add('feedback');
                questionBlock.appendChild(feedbackDiv);

                questionsContainer.appendChild(questionBlock);
            }
        }

        function checkAnswers(event) {
            event.preventDefault(); // Prevent form from submitting normally
            const lang = getStoredLanguage();
            let score = 0;
            const questionBlocks = questionsContainer.querySelectorAll('.question-block');

            questionBlocks.forEach(block => {
                const questionId = block.getAttribute('data-question-id'); // e.g., "q1"
                const feedbackDiv = block.querySelector('.feedback');
                const selectedInput = block.querySelector(`input[name="${questionId}"]:checked`);
                const correctAnswer = correctAnswers[questionId]; // e.g., 'b'
                const allLabels = block.querySelectorAll('.options label');
                const allInputs = block.querySelectorAll('.options input');

                 // Clear previous feedback styles from labels
                 allLabels.forEach(lbl => lbl.classList.remove('correct', 'incorrect'));
                 // Disable all inputs for this question
                 allInputs.forEach(inp => inp.disabled = true);

                if (selectedInput) {
                    const selectedAnswer = selectedInput.value; // e.g., 'a'
                    const correctLabel = block.querySelector(`label[for="${questionId}_${correctAnswer}"]`);
                    const selectedLabel = block.querySelector(`label[for="${selectedInput.id}"]`);

                    if (selectedAnswer === correctAnswer) {
                        score++;
                        feedbackDiv.textContent = getTranslation('feedback_correct', lang);
                        feedbackDiv.className = 'feedback correct';
                        if (selectedLabel) selectedLabel.classList.add('correct');
                    } else {
                        const correctAnswerText = correctLabel ? correctLabel.textContent : `(${correctAnswer.toUpperCase()})`;
                        feedbackDiv.innerHTML = getTranslation('feedback_incorrect', lang, { correct_answer: `<strong>${correctAnswerText}</strong>` });
                        feedbackDiv.className = 'feedback incorrect';
                        if (selectedLabel) selectedLabel.classList.add('incorrect');
                         // Also highlight the correct one if it exists and wasn't selected
                         if (correctLabel) correctLabel.classList.add('correct');
                    }
                } else {
                    feedbackDiv.textContent = getTranslation('feedback_unanswered', lang);
                    feedbackDiv.className = 'feedback unanswered';
                }
                feedbackDiv.style.display = 'block'; // Show feedback
            });

            // Display overall results
            scoreValueEl.textContent = score;
            resultsContainer.style.display = 'block';
            submitButton.disabled = true; // Disable submit after checking
            submitButton.style.display = 'none';
            retryButton.style.display = 'inline-block'; // Show retry button

            if (score >= PASSING_SCORE) {
                resultsContainer.className = 'pass'; // Use class for styling pass/fail
                resultMessageEl.textContent = getTranslation('result_pass', lang);
                // Save progress to localStorage
                try {
                    const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                    const knowledgeCheckStatus = storedStatus ? JSON.parse(storedStatus) : {};
                    knowledgeCheckStatus[MODULE_ID] = true; // Mark this module as passed
                    localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(knowledgeCheckStatus));
                } catch (e) {
                    console.error("Error updating KC status in localStorage:", e);
                }
            } else {
                resultsContainer.className = 'fail';
                 const scoreNeeded = PASSING_SCORE - score;
                 resultMessageEl.textContent = getTranslation('result_fail', lang, { score_needed: scoreNeeded });
            }

             // Scroll to results
             resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
             const initialLang = getStoredLanguage();
             if (languageSelect) languageSelect.value = initialLang;
             translatePage(initialLang); // Translate static text
             loadQuiz(initialLang);      // Load initial quiz content

             // Event Listeners
             if (quizForm) quizForm.addEventListener('submit', checkAnswers);
             if (retryButton) retryButton.addEventListener('click', () => setLanguage(getStoredLanguage())); // Reload quiz in current language
             if (languageSelect) languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));
        });

    </script>

</body>
</html>
