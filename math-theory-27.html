<!DOCTYPE html>
<!-- Language set to Portuguese BR -->
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">M√≥dulo 27: Aplica√ß√µes em L√≥gica e Algoritmos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Reset & Base Styles --- */
        :root {
            --primary-color: #007bff; /* Azul Prim√°rio */
            --secondary-color: #6c757d; /* Cinza Secund√°rio */
            --background-light: #f8f9fa; /* Fundo Claro */
            --background-dark: #343a40; /* Fundo Escuro */
            --text-light: #f8f9fa; /* Texto Claro */
            --text-dark: #212529; /* Texto Escuro */
            --accent-color: #ffc107; /* Amarelo Acento */
            --success-color: #28a745; /* Verde Sucesso */
            --error-color: #dc3545; /* Vermelho Erro */
            --info-color: #17a2b8; /* Azul Informa√ß√£o */
            --set-op-color: #6f42c1; /* Roxo para Opera√ß√µes de Conjunto */
            --logic-op-color: #fd7e14; /* Laranja para Opera√ß√µes L√≥gicas */
            --algo-color: #20c997; /* Verde-azulado para Algoritmos */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --animation-speed: 0.6s; /* Control fade-in speed */
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
            --footer-border-color: #495057;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh;
        }
        main { flex-grow: 1; }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-inline {
            font-family: 'Courier New', Courier, monospace;
            background-color: #e9ecef;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--set-op-color);
            border: 1px solid #ced4da;
        }

        /* Elements to be animated by observer */
        .fade-in-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out;
        }
        .fade-in-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Add delays for staggering */
        .delay-1.visible { transition-delay: 0.1s; }
        .delay-2.visible { transition-delay: 0.2s; }
        .delay-3.visible { transition-delay: 0.3s; }
        .delay-4.visible { transition-delay: 0.4s; }
        .delay-5.visible { transition-delay: 0.5s; }
        .delay-6.visible { transition-delay: 0.6s; }
        .delay-7.visible { transition-delay: 0.7s; }


        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
        .action-button {
             display: inline-flex; align-items: center; justify-content: center; gap: 0.5em;
             padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed), opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out; /* Add animation transition */
             margin-top: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none; line-height: 1.2;
             opacity: 0; /* Start hidden if animated */
             transform: translateY(20px); /* Start offset if animated */
        }
        .action-button.visible { /* Make visible via observer */
            opacity: 1;
            transform: translateY(0);
        }
        .action-button i.fas {}
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px) !important; box-shadow: 0 4px 8px rgba(0,0,0,0.15); } /* Use !important to override initial transform */
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none !important; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98) !important; filter: brightness(0.95); }

        /* --- Animations --- */
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); } 50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); } 100% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); } }
        @keyframes tada { from { transform: scale3d(1, 1, 1); } 10%, 20% { transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg); } 30%, 50%, 70%, 90% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg); } 40%, 60%, 80% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg); } to { transform: scale3d(1, 1, 1); } }
        .tada-anim { animation: tada 1s ease; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }

        /* --- Minimal Retractable Nav --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }

        /* --- Header --- */
        .main-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 4rem 0 6rem; text-align: center; position: relative; overflow: hidden; }
        .main-header .container { /* Start visible */ }
        .main-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .main-header p { font-size: 1.2rem; font-weight: 300; opacity: 0.9; }
        .header-shape { position: absolute; border-radius: 50%; background-color: rgba(255, 255, 255, 0.1); animation: pulse 5s infinite ease-in-out alternate; }
        .shape1 { width: 150px; height: 150px; bottom: -50px; left: 10%; animation-duration: 6s; }
        .shape2 { width: 80px; height: 80px; top: 50px; right: 15%; animation-duration: 4s; }
        .shape3 { width: 50px; height: 50px; bottom: 20px; right: 30%; animation-duration: 7s; }

        /* --- Section Styling --- */
        section { padding: 4rem 0; border-bottom: 1px solid #eee; }
        main section:last-of-type { border-bottom: none; padding-bottom: 0;}
        section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); margin-bottom: 2rem; text-align: center; position: relative; padding-bottom: 10px; }
        section h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 60px; height: 4px; background-color: var(--accent-color); border-radius: 2px; }

        /* --- Welcome Section --- */
        #welcome p { font-size: 1.1rem; max-width: 750px; margin: 0 auto 1rem; text-align: center; }

        /* --- Sets & Logic Section --- */
        #sets-logic .logic-mapping {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem; margin-top: 2rem;
        }
        .map-item { /* Animated by observer */
            background-color: #fff; padding: 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 4px 10px rgba(0,0,0,0.07); text-align: center;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out;
            opacity: 0; transform: translateY(20px); /* Start state */
            border-top: 4px solid transparent;
        }
        .map-item.visible { opacity: 1; transform: translateY(0); }
        .map-item:nth-child(1) { border-top-color: var(--set-op-color); } /* Union/OR */
        .map-item:nth-child(2) { border-top-color: var(--logic-op-color); } /* Intersection/AND */
        .map-item:nth-child(3) { border-top-color: var(--secondary-color); } /* Complement/NOT */
        .map-item:hover { transform: translateY(-5px) scale(1.02) !important; box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .map-icon { font-size: 2.5rem; margin-bottom: 1rem; }
        #map-union .map-icon { color: var(--set-op-color); }
        #map-intersection .map-icon { color: var(--logic-op-color); }
        #map-complement .map-icon { color: var(--secondary-color); }
        .map-item h3 { font-family: var(--font-body); font-weight: 700; font-size: 1.3rem; margin-bottom: 0.8rem; color: var(--text-dark); }
        .map-details {
             font-size: 1rem; color: var(--secondary-color); margin-top: 1rem; line-height: 1.6;
        }
        .map-example {
            font-family: 'Courier New', Courier, monospace; background-color: #e9ecef;
            padding: 0.5rem 0.8rem; border-radius: 4px; margin-top: 1rem;
            font-size: 0.95rem; color: var(--text-dark); display: block;
            border: 1px solid #ced4da; margin-left: auto; margin-right: auto; max-width: 90%;
            text-align: left;
        }
        .placeholder-image {
            background-color: #e9ecef; border: 1px dashed var(--secondary-color);
            padding: 2rem; text-align: center; color: var(--secondary-color);
            border-radius: var(--border-radius); margin-top: 1.5rem; font-style: italic;
        }

        /* --- Sets in Programming Section --- */
        #sets-programming .implementation-cards {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem; margin-top: 2rem;
        }
        .impl-card { /* Animated by observer */
            background-color: #fff; padding: 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 4px 10px rgba(0,0,0,0.07);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out;
            opacity: 0; transform: translateY(20px); /* Start state */
            border-left: 4px solid var(--info-color);
        }
        .impl-card.visible { opacity: 1; transform: translateY(0); }
        .impl-card:hover { transform: translateY(-5px) scale(1.02) !important; box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .impl-card h3 { font-family: var(--font-body); font-weight: 700; font-size: 1.3rem; margin-bottom: 0.8rem; color: var(--info-color); display: flex; align-items: center; gap: 0.5em;}
        .impl-card h3 i { font-size: 1.1em; opacity: 0.8;}
        .impl-details {
             font-size: 1rem; color: var(--secondary-color); margin-top: 1rem; line-height: 1.6;
        }
        .impl-pros-cons { margin-top: 1rem; font-size: 0.95rem; }
        .impl-pros-cons strong { display: block; margin-bottom: 0.3rem; }
        .impl-pros { color: var(--success-color); }
        .impl-cons { color: var(--error-color); }
        .impl-example {
            font-family: 'Courier New', Courier, monospace; background-color: #343a40; color: #f8f9fa;
            padding: 1rem; border-radius: 4px; margin-top: 1.5rem;
            font-size: 0.9rem; border: 1px solid #495057; overflow-x: auto;
        }

        /* --- Sets in Algorithms Section --- */
        #sets-algorithms .algo-examples {
            display: flex; flex-direction: column; gap: 2.5rem; margin-top: 2rem;
        }
        .algo-item { /* Animated by observer */
            display: flex; gap: 2rem; align-items: flex-start;
            background-color: #fff; padding: 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            opacity: 0; transform: translateX(-20px); /* Start state - slide in from left */
            transition: opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out;
        }
        .algo-item:nth-child(even) { transform: translateX(20px); /* Start state - slide in from right */ }
        .algo-item.visible { opacity: 1; transform: translateX(0); }
        .algo-icon {
            font-size: 2.5rem; color: var(--algo-color); flex-shrink: 0;
            padding-top: 0.5rem; width: 50px; text-align: center;
        }
        .algo-content h3 { font-family: var(--font-body); font-weight: 700; font-size: 1.4rem; margin-bottom: 0.8rem; color: var(--algo-color); }
        .algo-content p { font-size: 1rem; line-height: 1.7; margin-bottom: 1rem; }
        .algo-code {
            font-family: 'Courier New', Courier, monospace; background-color: #e9ecef;
            padding: 0.8rem 1rem; border-radius: 4px; margin-top: 1rem;
            font-size: 0.95rem; color: var(--text-dark); display: block;
            border: 1px solid #ced4da; overflow-x: auto;
        }


        /* --- Putting It Together Section --- */
        #putting-it-together-m27 .explanation { display: flex; gap: 2rem; align-items: flex-start; margin-top: 2rem; flex-wrap: wrap; }
        .code-demo { /* Animated by observer */
            flex-basis: 55%; background-color: var(--background-dark); color: #eee;
            padding: 1.5rem; border-radius: var(--border-radius); font-family: 'Courier New', Courier, monospace;
            position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 0.9rem; line-height: 1.6;
            opacity: 0; transition: opacity var(--animation-speed) ease-out; /* Only fade opacity */
            min-height: 350px; /* Adjust height as needed */
        }
        .code-demo.visible { opacity: 1; }
        .code-demo .code-line { margin-bottom: 0.7rem; display: block; white-space: pre; overflow-wrap: break-word; }
        .code-explanation { /* Animated by observer */
            flex-basis: 40%; font-size: 1.05rem;
             opacity: 0; transition: opacity var(--animation-speed) ease-out; /* Only fade opacity */
        }
        .code-explanation.visible { opacity: 1; }
        .code-explanation p { margin-bottom: 1rem; }
        .code-highlight {
            background-color: rgba(0, 123, 255, 0.1); color: #0056b3; padding: 0.2em 0.4em;
            border-radius: 4px; font-family: 'Courier New', Courier, monospace; font-weight: bold;
            cursor: pointer; transition: background-color var(--transition-speed);
            display: inline-block; position: relative;
        }
        .code-highlight:hover { background-color: rgba(0, 123, 255, 0.2); }
        .tooltip {
            visibility: hidden; width: 220px; background-color: var(--background-dark);
            color: var(--text-light); text-align: center; border-radius: 6px; padding: 8px 5px;
            position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -110px;
            opacity: 0; transition: opacity 0.3s; font-family: var(--font-body);
            font-size: 0.9rem; font-weight: normal; pointer-events: none; line-height: 1.3;
        }
        .tooltip::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--background-dark) transparent transparent transparent; }
        .code-highlight:hover .tooltip { visibility: visible; opacity: 1; }
        .code-variable { color: #9cdcfe; }
        .code-operator { color: var(--set-op-color); font-weight: bold;}
        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-comment { color: #6a9955; font-style: italic;}
        .code-function { color: #dcdcaa; }
        .code-number { color: #b5cea8; }
        .code-brackets { color: var(--logic-op-color); font-weight: bold; }
        .code-set-literal { color: #4ec9b0; } /* Teal-like color for set literals */


        /* --- Knowledge Check Section --- */
        #knowledge-check { background-color: #e9ecef; }
        .quiz-container { /* Animated by observer */
             background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 700px; margin: 2rem auto 0;
             opacity: 0; transition: opacity var(--animation-speed) ease-out; /* Only fade opacity */
        }
        .quiz-container.visible { opacity: 1; }
        .quiz-question { font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; color: var(--text-dark); }
        .quiz-options button { display: block; width: 100%; padding: 1rem; margin-bottom: 1rem; text-align: left; font-size: 1rem; background-color: #f8f9fa; border: 1px solid #ced4da; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), border-color var(--transition-speed), transform var(--transition-speed); }
        .quiz-options button:not(:disabled):hover { background-color: #e2e6ea; border-color: #adb5bd; transform: translateX(5px); }
        .quiz-options button:disabled { cursor: default; opacity: 0.7; }
        .quiz-options button.correct { background-color: #d4edda; border-color: var(--success-color); color: #155724; font-weight: bold; }
        .quiz-options button.incorrect { background-color: #f8d7da; border-color: var(--error-color); color: #721c24; font-weight: bold; }
        .quiz-options button.incorrect.shake { animation: shake 0.5s ease; }
        .quiz-feedback { margin-top: 1.5rem; padding: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; transition: opacity 0.5s ease, height 0.5s ease, margin-bottom 0.5s ease; height: 0; overflow: hidden; margin-bottom: 0;}
        .quiz-feedback.visible { opacity: 1; height: auto; margin-bottom: 1rem; }
        .quiz-feedback.correct { background-color: #d4edda; color: #155724; }
        .quiz-feedback.incorrect { background-color: #f8d7da; color: #721c24; }
        #next-question-btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; margin: 1.5rem auto 0; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.3s, visibility 0.3s; opacity: 0; visibility: hidden; }
        #next-question-btn:hover:not(:disabled) { background-color: #0056b3; transform: scale(1.05); }
        #next-question-btn.visible { opacity: 1; visibility: visible; }
        #next-question-btn:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; opacity: 0.7; }


        /* --- Completion Section Styling --- */
        .completion-section { padding: 4rem 0; text-align: center; background-color: var(--background-light); }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; animation: iconAppearCorrect 1s ease-out 0.5s forwards; opacity: 0; /* Initial state for animation */}
        /* Ensure completion elements are targeted by observer */
        .completion-section h2, .completion-section p {
            opacity: 0; transform: translateY(20px);
            transition: opacity var(--animation-speed) ease-out, transform var(--animation-speed) ease-out;
        }
        .completion-section h2.visible, .completion-section p.visible {
            opacity: 1; transform: translateY(0);
        }
        .completion-section .button-group { margin-top: 2.5rem; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); margin-bottom: 1rem; }
        .completion-section h2::after { display: none; }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); max-width: 700px; margin-left: auto; margin-right: auto; line-height: 1.8; }


        /* --- Footer Styling --- */
        .main-footer {
            background-color: var(--background-light);
            color: var(--text-light);
            text-align: center;
            padding: 2rem 0;
            font-size: 0.9rem;
            margin-top: auto;
            border-top: 1px solid var(--background-light);
            opacity: 0.85;
        }
        .main-footer p { margin: 0; line-height: 1.5; }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .main-header h1 { font-size: 2.3rem; } .main-header p { font-size: 1.1rem; }
            section h2 { font-size: 1.8rem; }
            #sets-logic .logic-mapping { grid-template-columns: 1fr; }
            #sets-programming .implementation-cards { grid-template-columns: 1fr; }
            #sets-algorithms .algo-item { flex-direction: column; align-items: center; text-align: center; }
            #sets-algorithms .algo-icon { margin-bottom: 1rem; width: auto; }
            #putting-it-together-m27 .explanation { flex-direction: column; }
            .code-demo, .code-explanation { flex-basis: 100%; }
            .minimal-nav { min-width: 180px; } .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            .completion-section h2 { font-size: 2rem; }
            .completion-section .button-group { flex-direction: column; align-items: center; gap: 0.8rem; }
            .completion-section .action-button { width: 80%; max-width: 350px; margin-top: 0; }
            .main-footer { padding: 1.5rem 0; }
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .main-header h1 { font-size: 2rem; } .main-header p { font-size: 1rem; }
            section h2 { font-size: 1.6rem; }
            .quiz-options button { padding: 0.8rem; font-size: 0.95rem; }
            .tooltip { width: 160px; margin-left: -80px; font-size: 0.8rem;}
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            .completion-section .icon { font-size: 3.5rem; }
            .completion-section h2 { font-size: 1.8rem; } .completion-section p { font-size: 1rem; }
            .completion-section .action-button { width: 90%; max-width: 300px; }
            .code-demo { font-size: 0.85rem; }
            .main-footer { padding: 1rem 0; font-size: 0.85rem; }
        }

    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Alternar Menu de Navega√ß√£o" aria-expanded="false">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- IMPORTANT: Links updated to math- prefix and module number 27 -->
            <li><a href="math-practice-27.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_practice">Iniciar Pr√°tica</span></a></li>
            <li><a href="math-practice-advanced-27.html"><i class="fas fa-flask fa-fw"></i> <span data-translate="nav_advanced">Pr√°tica Avan√ßada</span></a></li>
            <li><a href="math-exercise-27.html"><i class="fas fa-book-open fa-fw"></i> <span data-translate="nav_exercises">Exerc√≠cios</span></a></li> <!-- Added Exercise Link -->
            <li><a href="math-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Menu do Curso</span></a></li>
             <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
             <!-- Module specific navigation -->
             <li><a href="#welcome"><i class="fas fa-door-open fa-fw"></i> <span data-translate="nav_welcome_m27">Boas-vindas M27</span></a></li>
             <li><a href="#sets-logic"><i class="fas fa-project-diagram fa-fw"></i> <span data-translate="nav_sets_logic">Conjuntos e L√≥gica</span></a></li>
             <li><a href="#sets-programming"><i class="fas fa-code fa-fw"></i> <span data-translate="nav_sets_prog">Conjuntos em C√≥digo</span></a></li>
             <li><a href="#sets-algorithms"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_sets_algo">Conjuntos em Algoritmos</span></a></li>
             <li><a href="#putting-it-together-m27"><i class="fas fa-puzzle-piece fa-fw"></i> <span data-translate="nav_putting_together_m27">Aplica√ß√£o Pr√°tica</span></a></li>
             <li><a href="#knowledge-check"><i class="fas fa-check-double fa-fw"></i> <span data-translate="nav_quiz">Teste R√°pido</span></a></li>
             <li><a href="#completion"><i class="fas fa-flag-checkered fa-fw"></i> <span data-translate="completion_theory_title_m27">Conclus√£o</span></a></li>
        </ul>
    </nav>

    <header class="main-header">
        <div class="header-shape shape1"></div>
        <div class="header-shape shape2"></div>
        <div class="header-shape shape3"></div>
        <div class="container">
            <!-- IMPORTANT: Title updated for Module 27 -->
            <h1 data-translate="header_title_m27">M√≥dulo 27: Aplica√ß√µes em L√≥gica e Algoritmos</h1>
            <p data-translate="header_subtitle_m27">Conectando a Teoria dos Conjuntos com a l√≥gica computacional e estruturas de dados eficientes.</p>
        </div>
    </header>

    <main>
        <!-- ========= Welcome Section ========= -->
        <section id="welcome">
            <div class="container">
                <h2 class="fade-in-on-scroll" data-translate="welcome_title_m27">üß© Conjuntos: A Base da L√≥gica e Efici√™ncia</h2>
                <p class="fade-in-on-scroll delay-1" data-translate="welcome_p1_m27">
                    Bem-vindo ao M√≥dulo 27! J√° exploramos as opera√ß√µes b√°sicas de conjuntos. Agora, vamos ver como esses conceitos s√£o <span class="highlight">fundamentais</span> no mundo da computa√ß√£o, especialmente em <span class="highlight">IA</span>.
                </p>
                <p class="fade-in-on-scroll delay-2" data-translate="welcome_p2_m27">
                    A teoria dos conjuntos fornece uma base s√≥lida para a <span class="highlight">l√≥gica booleana</span> (verdadeiro/falso, E/OU/N√ÉO) que sustenta toda a computa√ß√£o. Al√©m disso, a estrutura de dados "conjunto" (<code class="code-inline">set</code> em Python) permite <span class="highlight">opera√ß√µes extremamente eficientes</span> para verificar pertencimento, encontrar elementos √∫nicos e comparar cole√ß√µes.
                </p>
                 <p class="fade-in-on-scroll delay-3" data-translate="welcome_p3_m27">
                    Neste m√≥dulo, conectaremos as opera√ß√µes de conjunto com a l√≥gica, exploraremos como os conjuntos s√£o implementados em programa√ß√£o e veremos exemplos pr√°ticos de como eles otimizam algoritmos, inclusive em cen√°rios de IA como processamento de dados e sistemas de recomenda√ß√£o.
                </p>
            </div>
        </section>

        <!-- ========= Sets & Logic Section ========= -->
        <section id="sets-logic">
            <div class="container">
                <h2 class="fade-in-on-scroll" data-translate="sets_logic_title">üîó Conjuntos como L√≥gica</h2>
                <p class="text-center fade-in-on-scroll delay-1" data-translate="sets_logic_subtitle">As opera√ß√µes de conjuntos mapeiam diretamente para operadores l√≥gicos booleanos.</p>

                <div class="logic-mapping">
                    <div class="map-item fade-in-on-scroll delay-2" id="map-union">
                        <span class="map-icon"><i class="fas fa-lightbulb"></i></span> <!-- Icon suggests combining ideas/OR -->
                        <h3 data-translate="map_union_title">Uni√£o (‚à™) ‚áî OU L√≥gico (OR)</h3>
                        <div class="map-details">
                            <p data-translate="map_union_text">A uni√£o de dois conjuntos A e B (<code class="code-inline">A ‚à™ B</code>) cont√©m elementos que est√£o em A <span class="highlight">OU</span> em B <span class="highlight">OU</span> em ambos. Corresponde ao <code class="code-inline">OR</code> l√≥gico: o resultado √© verdadeiro se pelo menos uma condi√ß√£o for verdadeira.</p>
                            <div class="placeholder-image" data-translate="map_union_diagram">Diagrama de Venn: Uni√£o (A ‚à™ B) Hachurado</div>
                        </div>
                    </div>
                    <div class="map-item fade-in-on-scroll delay-3" id="map-intersection">
                        <span class="map-icon"><i class="fas fa-search-plus"></i></span> <!-- Icon suggests finding commonality/AND -->
                        <h3 data-translate="map_intersection_title">Interse√ß√£o (‚à©) ‚áî E L√≥gico (AND)</h3>
                        <div class="map-details">
                            <p data-translate="map_intersection_text">A interse√ß√£o de A e B (<code class="code-inline">A ‚à© B</code>) cont√©m apenas elementos que est√£o <span class="highlight">TANTO</span> em A <span class="highlight">QUANTO</span> em B. Corresponde ao <code class="code-inline">AND</code> l√≥gico: o resultado √© verdadeiro apenas se ambas as condi√ß√µes forem verdadeiras.</p>
                             <div class="placeholder-image" data-translate="map_intersection_diagram">Diagrama de Venn: Interse√ß√£o (A ‚à© B) Hachurada</div>
                        </div>
                    </div>
                    <div class="map-item fade-in-on-scroll delay-4" id="map-complement">
                        <span class="map-icon"><i class="fas fa-times-circle"></i></span> <!-- Icon suggests exclusion/NOT -->
                        <h3 data-translate="map_complement_title">Complementar (A') ‚áî N√ÉO L√≥gico (NOT)</h3>
                        <div class="map-details">
                            <p data-translate="map_complement_text">O complementar de um conjunto A (<code class="code-inline">A'</code> ou <code class="code-inline">A·∂ú</code>) cont√©m todos os elementos do conjunto universo que <span class="highlight">N√ÉO</span> est√£o em A. Corresponde ao <code class="code-inline">NOT</code> l√≥gico: inverte o valor de verdade de uma condi√ß√£o.</p>
                             <div class="placeholder-image" data-translate="map_complement_diagram">Diagrama de Venn: Complementar (A') Hachurado</div>
                        </div>
                    </div>
                </div>
                 <p class="text-center fade-in-on-scroll delay-5" data-translate="sets_logic_conclusion">Essa correspond√™ncia permite usar a teoria dos conjuntos para raciocinar sobre condi√ß√µes l√≥gicas complexas, o que √© vital em programa√ß√£o e design de algoritmos.</p>
            </div>
        </section>

        <!-- ========= Sets in Programming Section ========= -->
        <section id="sets-programming">
            <div class="container">
                <h2 class="fade-in-on-scroll" data-translate="sets_prog_title">üíª Conjuntos em Estruturas de Dados</h2>
                <p class="text-center fade-in-on-scroll delay-1" data-translate="sets_prog_subtitle">Como os conjuntos s√£o implementados e por que s√£o eficientes.</p>

                <div class="implementation-cards">
                    <div class="impl-card fade-in-on-scroll delay-2">
                        <h3><i class="fab fa-python"></i> <span data-translate="impl_py_set_title">Python `set` (Baseado em Hash)</span></h3>
                        <div class="impl-details">
                            <p data-translate="impl_py_set_desc">A implementa√ß√£o mais comum em Python usa uma <span class="highlight">tabela hash</span> (semelhante a dicion√°rios, mas sem valores associados √†s chaves). Isso permite opera√ß√µes muito r√°pidas.</p>
                            <div class="impl-pros-cons">
                                <strong class="impl-pros" data-translate="impl_py_set_pros_title">Vantagens:</strong>
                                <ul class="impl-pros">
                                    <li data-translate="impl_py_set_pros1">Verifica√ß√£o de pertencimento (<code class="code-inline">in</code>) em tempo m√©dio O(1) - muito r√°pido!</li>
                                    <li data-translate="impl_py_set_pros2">Adi√ß√£o e remo√ß√£o em tempo m√©dio O(1).</li>
                                    <li data-translate="impl_py_set_pros3">Garante unicidade dos elementos automaticamente.</li>
                                    <li data-translate="impl_py_set_pros4">Opera√ß√µes como uni√£o, interse√ß√£o, diferen√ßa s√£o otimizadas.</li>
                                </ul>
                                <strong class="impl-cons" data-translate="impl_py_set_cons_title">Desvantagens:</strong>
                                <ul class="impl-cons">
                                    <li data-translate="impl_py_set_cons1">N√£o mant√©m ordem de inser√ß√£o (em vers√µes mais antigas do Python; agora mant√©m, mas n√£o confie nisso para l√≥gica).</li>
                                    <li data-translate="impl_py_set_cons2">Elementos precisam ser "hashable" (imut√°veis como n√∫meros, strings, tuplas). Listas ou outros sets n√£o podem ser elementos diretos.</li>
                                     <li data-translate="impl_py_set_cons3">Consome um pouco mais de mem√≥ria que listas para o mesmo n√∫mero de itens devido √† tabela hash.</li>
                                </ul>
                            </div>
                            <div class="impl-example">
                                <code class="code-comment"># Exemplo em Python</code><br>
                                <code class="code-variable">numeros_pares</code> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-number">2</code><code class="code-operator">,</code> <code class="code-number">4</code><code class="code-operator">,</code> <code class="code-number">6</code><code class="code-operator">,</code> <code class="code-number">8</code><code class="code-set-literal">}</code><br>
                                <code class="code-variable">numeros_primos</code> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-number">2</code><code class="code-operator">,</code> <code class="code-number">3</code><code class="code-operator">,</code> <code class="code-number">5</code><code class="code-operator">,</code> <code class="code-number">7</code><code class="code-set-literal">}</code><br><br>
                                <code class="code-keyword">print</code>(<code class="code-number">4</code> <code class="code-keyword">in</code> <code class="code-variable">numeros_pares</code>) <code class="code-comment"># True (O(1) em m√©dia)</code><br>
                                <code class="code-variable">uniao</code> <code class="code-operator">=</code> <code class="code-variable">numeros_pares</code> <code class="code-operator">|</code> <code class="code-variable">numeros_primos</code> <code class="code-comment"># {2, 3, 4, 5, 6, 7, 8}</code><br>
                                <code class="code-variable">intersecao</code> <code class="code-operator">=</code> <code class="code-variable">numeros_pares</code> <code class="code-operator">&</code> <code class="code-variable">numeros_primos</code> <code class="code-comment"># {2}</code><br>
                                <code class="code-variable">diferenca</code> <code class="code-operator">=</code> <code class="code-variable">numeros_pares</code> <code class="code-operator">-</code> <code class="code-variable">numeros_primos</code> <code class="code-comment"># {4, 6, 8}</code><br>
                            </div>
                        </div>
                    </div>
                     <div class="impl-card fade-in-on-scroll delay-3">
                        <h3><i class="fas fa-puzzle-piece"></i> <span data-translate="impl_bitset_title">Bitsets / Bitmasks</span></h3>
                        <div class="impl-details">
                            <p data-translate="impl_bitset_desc">Uma representa√ß√£o alternativa onde cada poss√≠vel elemento do universo corresponde a um bit (0 ou 1) em um n√∫mero inteiro. Um bit '1' significa que o elemento pertence ao conjunto.</p>
                             <div class="impl-pros-cons">
                                <strong class="impl-pros" data-translate="impl_bitset_pros_title">Vantagens:</strong>
                                <ul class="impl-pros">
                                    <li data-translate="impl_bitset_pros1">Extremamente eficiente em termos de mem√≥ria para universos pequenos e densos.</li>
                                    <li data-translate="impl_bitset_pros2">Opera√ß√µes de conjunto (uni√£o, interse√ß√£o, etc.) podem ser feitas com opera√ß√µes bitwise (|, &, ^, ~) que s√£o muito r√°pidas.</li>
                                </ul>
                                <strong class="impl-cons" data-translate="impl_bitset_cons_title">Desvantagens:</strong>
                                <ul class="impl-cons">
                                    <li data-translate="impl_bitset_cons1">Pr√°tico apenas para universos pequenos e pr√©-definidos (geralmente de inteiros come√ßando em 0).</li>
                                    <li data-translate="impl_bitset_cons2">N√£o √© flex√≠vel para elementos arbitr√°rios (como strings ou objetos complexos).</li>
                                    <li data-translate="impl_bitset_cons3">Pode se tornar ineficiente se o universo for grande, mas os conjuntos forem esparsos (poucos elementos).</li>
                                </ul>
                            </div>
                            <div class="impl-example">
                                <code class="code-comment"># Conceito (Python n√£o tem bitset nativo f√°cil, mas a ideia √© essa)</code><br>
                                <code class="code-comment"># Universo {0, 1, 2, 3}. Conjunto A = {0, 2}, Conjunto B = {1, 2}</code><br>
                                <code class="code-variable">set_A_bits</code> <code class="code-operator">=</code> <code class="code-number">0b1010</code> <code class="code-comment"># Bit 0 e 2 est√£o ligados (da direita para esquerda)</code><br>
                                <code class="code-variable">set_B_bits</code> <code class="code-operator">=</code> <code class="code-number">0b0110</code> <code class="code-comment"># Bit 1 e 2 est√£o ligados</code><br><br>
                                <code class="code-variable">intersecao_bits</code> <code class="code-operator">=</code> <code class="code-variable">set_A_bits</code> <code class="code-operator">&</code> <code class="code-variable">set_B_bits</code> <code class="code-comment"># 0b0010 (S√≥ bit 2) -> {2}</code><br>
                                <code class="code-variable">uniao_bits</code> <code class="code-operator">=</code> <code class="code-variable">set_A_bits</code> <code class="code-operator">|</code> <code class="code-variable">set_B_bits</code> <code class="code-comment"># 0b1110 (Bits 0, 1, 2) -> {0, 1, 2}</code><br>
                            </div>
                        </div>
                    </div>
                </div>
                 <p class="text-center fade-in-on-scroll delay-4" data-translate="sets_prog_conclusion">A escolha da implementa√ß√£o depende do caso de uso, mas para a maioria das tarefas de programa√ß√£o geral e an√°lise de dados em Python, <code class="code-inline">set</code> √© a ferramenta ideal devido √† sua efici√™ncia e flexibilidade.</p>
            </div>
        section>

         <!-- ========= Sets in Algorithms Section ========= -->
        <section id="sets-algorithms">
            <div class="container">
                <h2 class="fade-in-on-scroll" data-translate="sets_algo_title">‚öôÔ∏è Conjuntos Otimizando Algoritmos</h2>
                <p class="text-center fade-in-on-scroll delay-1" data-translate="sets_algo_subtitle">Exemplos de como conjuntos tornam tarefas comuns mais r√°pidas.</p>

                <div class="algo-examples">
                    <div class="algo-item fade-in-on-scroll delay-2">
                        <div class="algo-icon"><i class="fas fa-stream"></i></div>
                        <div class="algo-content">
                            <h3 data-translate="algo_unique_title">Encontrar Elementos √önicos</h3>
                            <p data-translate="algo_unique_desc">Dada uma lista com poss√≠veis duplicatas, como obter apenas os elementos √∫nicos? Converter para um conjunto faz isso automaticamente e de forma eficiente.</p>
                            <div class="algo-code">
                                <code class="code-variable">dados_brutos</code> <code class="code-operator">=</code> [<code class="code-number">1</code>, <code class="code-number">2</code>, <code class="code-string">'a'</code>, <code class="code-number">2</code>, <code class="code-number">3</code>, <code class="code-string">'a'</code>, <code class="code-number">1</code>, <code class="code-number">4</code>]<br>
                                <code class="code-variable">elementos_unicos</code> <code class="code-operator">=</code> <code class="code-function">set</code>(<code class="code-variable">dados_brutos</code>)<br>
                                <code class="code-keyword">print</code>(<code class="code-variable">elementos_unicos</code>) <code class="code-comment"># Output: {1, 2, 3, 4, 'a'} (ordem n√£o garantida em Python antigo)</code>
                            </div>
                        </div>
                    </div>

                    <div class="algo-item fade-in-on-scroll delay-3">
                         <div class="algo-icon"><i class="fas fa-search"></i></div>
                         <div class="algo-content">
                            <h3 data-translate="algo_membership_title">Teste de Pertencimento R√°pido</h3>
                            <p data-translate="algo_membership_desc">Precisa verificar repetidamente se um item existe em uma grande cole√ß√£o? Usar um conjunto (<code class="code-inline">item in meu_conjunto</code>) √© muito mais r√°pido (O(1) em m√©dia) do que procurar em uma lista (<code class="code-inline">item in minha_lista</code>, que √© O(n)). Crucial em filtros e valida√ß√µes.</p>
                            <div class="algo-code">
                                <code class="code-variable">palavras_validas</code> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-string">"ol√°"</code>, <code class="code-string">"mundo"</code>, <code class="code-string">"python"</code>, <code class="code-string">"ia"</code><code class="code-set-literal">}</code> <code class="code-comment"># Conjunto para busca r√°pida</code><br>
                                <code class="code-variable">texto_usuario</code> <code class="code-operator">=</code> <code class="code-string">"ol√°, python!"</code><br>
                                <code class="code-keyword">for</code> <code class="code-variable">palavra</code> <code class="code-keyword">in</code> <code class="code-variable">texto_usuario</code>.<code class="code-function">split</code>(<code class="code-string">','</code>)[<code class="code-number">0</code>].<code class="code-function">split</code>(): <code class="code-comment"># Simplificado</code><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;<code class="code-keyword">if</code> <code class="code-variable">palavra</code> <code class="code-keyword">in</code> <code class="code-variable">palavras_validas</code>:<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code class="code-keyword">print</code>(<code class="code-string">f"'{palavra}' √© v√°lida."</code>)<br>
                                <code class="code-comment"># Output: 'ol√°' √© v√°lida. 'python' √© v√°lida.</code>
                             </div>
                         </div>
                    </div>

                    <div class="algo-item fade-in-on-scroll delay-4">
                         <div class="algo-icon"><i class="fas fa-exchange-alt"></i></div>
                         <div class="algo-content">
                            <h3 data-translate="algo_comparison_title">Compara√ß√£o entre Cole√ß√µes</h3>
                            <p data-translate="algo_comparison_desc">Encontrar elementos comuns (interse√ß√£o), elementos √∫nicos em cada cole√ß√£o (diferen√ßa) ou todos os elementos combinados (uni√£o) √© trivial e eficiente com opera√ß√µes de conjunto. √ötil para comparar caracter√≠sticas de usu√°rios, produtos, etc.</p>
                            <div class="algo-code">
                                <code class="code-variable">interesses_user_A</code> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-string">'ia'</code>, <code class="code-string">'python'</code>, <code class="code-string">'dados'</code><code class="code-set-literal">}</code><br>
                                <code class="code-variable">interesses_user_B</code> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-string">'python'</code>, <code class="code-string">'web'</code>, <code class="code-string">'ia'</code><code class="code-set-literal">}</code><br>
                                <code class="code-variable">comuns</code> <code class="code-operator">=</code> <code class="code-variable">interesses_user_A</code> <code class="code-operator">&</code> <code class="code-variable">interesses_user_B</code><br>
                                <code class="code-variable">apenas_A</code> <code class="code-operator">=</code> <code class="code-variable">interesses_user_A</code> <code class="code-operator">-</code> <code class="code-variable">interesses_user_B</code><br>
                                <code class="code-keyword">print</code>(<code class="code-string">f"Interesses comuns: {comuns}"</code>) <code class="code-comment"># Output: {'ia', 'python'}</code><br>
                                <code class="code-keyword">print</code>(<code class="code-string">f"Interesses s√≥ de A: {apenas_A}"</code>) <code class="code-comment"># Output: {'dados'}</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========= Putting It Together Section ========= -->
        <section id="putting-it-together-m27">
             <div class="container">
                 <h2 class="fade-in-on-scroll" data-translate="putting_together_title_m27">‚öôÔ∏è Conjuntos em A√ß√£o: Filtrando Dados</h2>
                 <p class="text-center fade-in-on-scroll delay-1" data-translate="putting_together_subtitle_m27">Vamos usar conjuntos para processar e filtrar dados, uma tarefa comum em pipelines de IA.</p>

                 <div class="explanation">
                     <div class="code-demo fade-in-on-scroll delay-2"> <!-- Observe container -->
                        <span class="code-line"><span class="code-comment"># IDs de usu√°rios que clicaram em um an√∫ncio de IA</span></span>
                        <span class="code-line"><span class="code-variable">clicaram_anuncio_ia</span> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-number">101</code><code class="code-operator">,</code> <code class="code-number">105</code><code class="code-operator">,</code> <code class="code-number">210</code><code class="code-operator">,</code> <code class="code-number">315</code><code class="code-operator">,</code> <code class="code-number">101</code><code class="code-operator">,</code> <code class="code-number">404</code><code class="code-set-literal">}</code></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># IDs de usu√°rios que compraram um produto de IA</span></span>
                        <span class="code-line"><span class="code-variable">compraram_produto_ia</span> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-number">210</code><code class="code-operator">,</code> <code class="code-number">404</code><code class="code-operator">,</code> <code class="code-number">500</code><code class="code-set-literal">}</code></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># IDs de usu√°rios atualmente ativos no sistema</span></span>
                        <span class="code-line"><span class="code-variable">usuarios_ativos</span> <code class="code-operator">=</code> <code class="code-set-literal">{</code><code class="code-number">100</code><code class="code-operator">,</code> <code class="code-number">101</code><code class="code-operator">,</code> <code class="code-number">210</code><code class="code-operator">,</code> <code class="code-number">315</code><code class="code-operator">,</code> <code class="code-number">404</code><code class="code-operator">,</code> <code class="code-number">600</code><code class="code-set-literal">}</code></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># 1. Quem clicou mas N√ÉO comprou? (Diferen√ßa)</span></span>
                        <span class="code-line"><span class="code-variable">clicaram_nao_compraram</span> <code class="code-operator">=</code> <span class="code-variable">clicaram_anuncio_ia</span> <code class="code-operator">-</code> <span class="code-variable">compraram_produto_ia</span></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># 2. Quem clicou E comprou? (Interse√ß√£o)</span></span>
                        <span class="code-line"><span class="code-variable">clicaram_e_compraram</span> <code class="code-operator">=</code> <span class="code-variable">clicaram_anuncio_ia</span> <code class="code-operator">&</code> <span class="code-variable">compraram_produto_ia</span></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># 3. Quem clicou E comprou E est√° ativo? (Interse√ß√£o m√∫ltipla)</span></span>
                        <span class="code-line"><span class="code-variable">ativos_converteram</span> <code class="code-operator">=</code> <span class="code-variable">clicaram_anuncio_ia</span> <code class="code-operator">&</code> <span class="code-variable">compraram_produto_ia</span> <code class="code-operator">&</code> <span class="code-variable">usuarios_ativos</span></span>
                        <span class="code-line"><span class="code-comment">#   Alternativa: (clicaram_e_compraram & usuarios_ativos)</span></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-comment"># 4. Todos os usu√°rios √∫nicos envolvidos (clicaram OU compraram)</span></span>
                        <span class="code-line"><span class="code-variable">todos_envolvidos_ia</span> <code class="code-operator">=</code> <span class="code-variable">clicaram_anuncio_ia</span> <code class="code-operator">|</code> <span class="code-variable">compraram_produto_ia</span></span>
                        <span class="code-line"></span>
                        <span class="code-line"><span class="code-keyword">print</span>(<span class="code-string">f"Clicaram, n√£o compraram: {clicaram_nao_compraram}"</span>)</span>
                        <span class="code-line"><span class="code-keyword">print</span>(<span class="code-string">f"Clicaram e compraram: {clicaram_e_compraram}"</span>)</span>
                        <span class="code-line"><span class="code-keyword">print</span>(<span class="code-string">f"Ativos que converteram: {ativos_converteram}"</span>)</span>
                        <span class="code-line"><span class="code-keyword">print</span>(<span class="code-string">f"Total envolvidos: {len(todos_envolvidos_ia)} usu√°rios √∫nicos"</span>)</span>
                     </div>
                     <div class="code-explanation fade-in-on-scroll delay-3"> <!-- Observe container -->
                         <p data-translate="putting_together_p1_m27">Imagine que temos IDs de usu√°rios de diferentes fontes (cliques, compras, status ativo). Usar conjuntos (<code class="code-inline">set</code>) √© ideal aqui.</p>
                         <p data-translate="putting_together_p2_m27">Primeiro, criamos conjuntos a partir das listas de IDs. Note que a duplicata <code class="code-inline">101</code> em <code class="code-variable">clicaram_anuncio_ia</code> √© automaticamente removida.</p>
                         <p data-translate="putting_together_p3_m27">Para encontrar quem clicou mas n√£o comprou, usamos a <span class="code-highlight" data-translate-tooltip="tooltip_difference"><span class="code-operator">-</span> (diferen√ßa)<span class="tooltip">Retorna elementos do primeiro conjunto que N√ÉO est√£o no segundo.</span></span>.</p>
                         <p data-translate="putting_together_p4_m27">Para encontrar quem fez as duas a√ß√µes (clicou E comprou), usamos a <span class="code-highlight" data-translate-tooltip="tooltip_intersection"><span class="code-operator">&</span> (interse√ß√£o)<span class="tooltip">Retorna elementos COMUNS a ambos os conjuntos.</span></span>.</p>
                          <p data-translate="putting_together_p5_m27">Podemos encadear interse√ß√µes para encontrar usu√°rios que satisfazem m√∫ltiplas condi√ß√µes (clicaram E compraram E est√£o ativos).</p>
                          <p data-translate="putting_together_p6_m27">A <span class="code-highlight" data-translate-tooltip="tooltip_union"><span class="code-operator">|</span> (uni√£o)<span class="tooltip">Retorna TODOS os elementos √∫nicos de ambos os conjuntos combinados.</span></span> nos d√° o grupo total de usu√°rios que interagiram com a campanha de IA de alguma forma.</p>
                         <p data-translate="putting_together_p7_m27">Finalmente, usamos <code class="code-function">len()</code> no conjunto uni√£o para contar quantos usu√°rios √∫nicos totais foram envolvidos.</p>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Knowledge Check Section ========= -->
        <section id="knowledge-check">
            <div class="container">
                <h2 class="fade-in-on-scroll" data-translate="quiz_title">üß† Teste R√°pido!</h2>
                <div class="quiz-container fade-in-on-scroll delay-1"> <!-- Observe container -->
                    <div id="quiz-area">
                         <p style="text-align: center; padding: 2rem 0;">Carregando quiz...</p>
                    </div>
                    <div id="quiz-feedback" class="quiz-feedback"></div>
                    <button id="next-question-btn" data-translate="quiz_next_button">Pr√≥xima Pergunta</button>
                </div>
            </div>
        </section>

        <!-- ========= Completion Section ========= -->
        <section id="completion" class="completion-section"> <!-- Added ID for nav link -->
            <div class="container">
                 <div class="icon">
                    <i class="fas fa-check-double"></i>
                    <i class="fas fa-brain"></i> <!-- Icon for logic/AI -->
                    <i class="fas fa-star"></i>
                </div>
                 <!-- IMPORTANT: Title updated for Module 27 -->
                <h2 class="fade-in-on-scroll delay-1" data-translate="completion_theory_title_m27">Teoria do M√≥dulo 27 Completa!</h2>
                <p class="fade-in-on-scroll delay-2" data-translate="completion_theory_desc_m27">
                    Excelente! Voc√™ conectou a teoria dos conjuntos com a l√≥gica booleana e viu como a estrutura de dados <code class="code-inline">set</code> em Python oferece efici√™ncia para algoritmos comuns em computa√ß√£o e IA. <br>
                    Compreender essas aplica√ß√µes √© crucial para escrever c√≥digo mais limpo, r√°pido e l√≥gico.
                </p>
                <p class="fade-in-on-scroll delay-3" data-translate="completion_next_steps">
                     Pronto para consolidar seu aprendizado? Siga para os exerc√≠cios ou explore os desafios na pr√°tica avan√ßada!
                </p>
                <div class="button-group">
                    <!-- IMPORTANT: Links updated to math- prefix and module number 27 -->
                    <a href="math-dashboard.html" class="action-button secondary fade-in-on-scroll delay-4"><i class="fas fa-list"></i> <span data-translate="nav_menu">Menu do Curso</span></a>
                    <a href="math-exercise-27.html" class="action-button fade-in-on-scroll delay-5"><i class="fas fa-book-open"></i> <span data-translate="nav_exercises">Ver Exerc√≠cios</span></a> <!-- Added Exercise Button -->
                    <a href="math-practice-27.html" class="action-button success fade-in-on-scroll delay-6"><i class="fas fa-pencil-alt"></i> <span data-translate="nav_practice">Iniciar Pr√°tica</span></a>
                    <a href="math-practice-advanced-27.html" class="action-button secondary fade-in-on-scroll delay-7"><i class="fas fa-flask"></i> <span data-translate="nav_advanced">Pr√°tica Avan√ßada</span></a>
                </div>
            </div>
        </section>

    </main>

    <footer class="main-footer">
        <div class="container">
            <p data-translate="footer_copyright"></p>
        </div>
    </footer>

    <script>
    // --- Translations Object (Portuguese Only) ---
    const translations = {
        pt: {
            // Meta & Generic Nav
            "page_title": "M√≥dulo 27: Aplica√ß√µes em L√≥gica e Algoritmos",
            "nav_practice": "Iniciar Pr√°tica",
            "nav_advanced": "Pr√°tica Avan√ßada",
            "nav_exercises": "Exerc√≠cios", // Added
            "nav_menu": "Menu do Curso",
            "lang_pt": "üáßüá∑ Portugu√™s",
            "footer_copyright": "¬© 2024 Matem√°tica Aplicada para IA. Todos os direitos reservados.",

            // Module 27 Specific Nav
            "nav_welcome_m27": "Boas-vindas M27",
            "nav_sets_logic": "Conjuntos e L√≥gica",
            "nav_sets_prog": "Conjuntos em C√≥digo",
            "nav_sets_algo": "Conjuntos em Algoritmos",
            "nav_putting_together_m27": "Aplica√ß√£o Pr√°tica",
            "nav_quiz": "Teste R√°pido",
            "completion_theory_title_m27": "Conclus√£o", // Keep short for nav

            // Header M27
            "header_title_m27": "M√≥dulo 27: Aplica√ß√µes em L√≥gica e Algoritmos",
            "header_subtitle_m27": "Conectando a Teoria dos Conjuntos com a l√≥gica computacional e estruturas de dados eficientes.",

            // Welcome M27
            "welcome_title_m27": "üß© Conjuntos: A Base da L√≥gica e Efici√™ncia",
            "welcome_p1_m27": "Bem-vindo ao M√≥dulo 27! J√° exploramos as opera√ß√µes b√°sicas de conjuntos. Agora, vamos ver como esses conceitos s√£o <span class=\"highlight\">fundamentais</span> no mundo da computa√ß√£o, especialmente em <span class=\"highlight\">IA</span>.",
            "welcome_p2_m27": "A teoria dos conjuntos fornece uma base s√≥lida para a <span class=\"highlight\">l√≥gica booleana</span> (verdadeiro/falso, E/OU/N√ÉO) que sustenta toda a computa√ß√£o. Al√©m disso, a estrutura de dados \"conjunto\" (<code class=\"code-inline\">set</code> em Python) permite <span class=\"highlight\">opera√ß√µes extremamente eficientes</span> para verificar pertencimento, encontrar elementos √∫nicos e comparar cole√ß√µes.",
            "welcome_p3_m27": "Neste m√≥dulo, conectaremos as opera√ß√µes de conjunto com a l√≥gica, exploraremos como os conjuntos s√£o implementados em programa√ß√£o e veremos exemplos pr√°ticos de como eles otimizam algoritmos, inclusive em cen√°rios de IA como processamento de dados e sistemas de recomenda√ß√£o.",

            // Sets & Logic M27
            "sets_logic_title": "üîó Conjuntos como L√≥gica",
            "sets_logic_subtitle": "As opera√ß√µes de conjuntos mapeiam diretamente para operadores l√≥gicos booleanos.",
            "map_union_title": "Uni√£o (‚à™) ‚áî OU L√≥gico (OR)",
            "map_union_text": "A uni√£o de dois conjuntos A e B (<code class=\"code-inline\">A ‚à™ B</code>) cont√©m elementos que est√£o em A <span class=\"highlight\">OU</span> em B <span class=\"highlight\">OU</span> em ambos. Corresponde ao <code class=\"code-inline\">OR</code> l√≥gico: o resultado √© verdadeiro se pelo menos uma condi√ß√£o for verdadeira.",
            "map_union_diagram": "Diagrama de Venn: Uni√£o (A ‚à™ B) Hachurado",
            "map_intersection_title": "Interse√ß√£o (‚à©) ‚áî E L√≥gico (AND)",
            "map_intersection_text": "A interse√ß√£o de A e B (<code class=\"code-inline\">A ‚à© B</code>) cont√©m apenas elementos que est√£o <span class=\"highlight\">TANTO</span> em A <span class=\"highlight\">QUANTO</span> em B. Corresponde ao <code class=\"code-inline\">AND</code> l√≥gico: o resultado √© verdadeiro apenas se ambas as condi√ß√µes forem verdadeiras.",
            "map_intersection_diagram": "Diagrama de Venn: Interse√ß√£o (A ‚à© B) Hachurada",
            "map_complement_title": "Complementar (A') ‚áî N√ÉO L√≥gico (NOT)",
            "map_complement_text": "O complementar de um conjunto A (<code class=\"code-inline\">A'</code> ou <code class=\"code-inline\">A·∂ú</code>) cont√©m todos os elementos do conjunto universo que <span class=\"highlight\">N√ÉO</span> est√£o em A. Corresponde ao <code class=\"code-inline\">NOT</code> l√≥gico: inverte o valor de verdade de uma condi√ß√£o.",
            "map_complement_diagram": "Diagrama de Venn: Complementar (A') Hachurado",
            "sets_logic_conclusion": "Essa correspond√™ncia permite usar a teoria dos conjuntos para raciocinar sobre condi√ß√µes l√≥gicas complexas, o que √© vital em programa√ß√£o e design de algoritmos.",

            // Sets in Programming M27
            "sets_prog_title": "üíª Conjuntos em Estruturas de Dados",
            "sets_prog_subtitle": "Como os conjuntos s√£o implementados e por que s√£o eficientes.",
            "impl_py_set_title": "Python `set` (Baseado em Hash)",
            "impl_py_set_desc": "A implementa√ß√£o mais comum em Python usa uma <span class=\"highlight\">tabela hash</span> (semelhante a dicion√°rios, mas sem valores associados √†s chaves). Isso permite opera√ß√µes muito r√°pidas.",
            "impl_py_set_pros_title": "Vantagens:",
            "impl_py_set_pros1": "Verifica√ß√£o de pertencimento (<code class=\"code-inline\">in</code>) em tempo m√©dio O(1) - muito r√°pido!",
            "impl_py_set_pros2": "Adi√ß√£o e remo√ß√£o em tempo m√©dio O(1).",
            "impl_py_set_pros3": "Garante unicidade dos elementos automaticamente.",
            "impl_py_set_pros4": "Opera√ß√µes como uni√£o, interse√ß√£o, diferen√ßa s√£o otimizadas.",
            "impl_py_set_cons_title": "Desvantagens:",
            "impl_py_set_cons1": "N√£o mant√©m ordem de inser√ß√£o (em vers√µes mais antigas do Python; agora mant√©m, mas n√£o confie nisso para l√≥gica).",
            "impl_py_set_cons2": "Elementos precisam ser \"hashable\" (imut√°veis como n√∫meros, strings, tuplas). Listas ou outros sets n√£o podem ser elementos diretos.",
            "impl_py_set_cons3": "Consome um pouco mais de mem√≥ria que listas para o mesmo n√∫mero de itens devido √† tabela hash.",
            "impl_bitset_title": "Bitsets / Bitmasks",
            "impl_bitset_desc": "Uma representa√ß√£o alternativa onde cada poss√≠vel elemento do universo corresponde a um bit (0 ou 1) em um n√∫mero inteiro. Um bit '1' significa que o elemento pertence ao conjunto.",
            "impl_bitset_pros_title": "Vantagens:",
            "impl_bitset_pros1": "Extremamente eficiente em termos de mem√≥ria para universos pequenos e densos.",
            "impl_bitset_pros2": "Opera√ß√µes de conjunto (uni√£o, interse√ß√£o, etc.) podem ser feitas com opera√ß√µes bitwise (|, &, ^, ~) que s√£o muito r√°pidas.",
            "impl_bitset_cons_title": "Desvantagens:",
            "impl_bitset_cons1": "Pr√°tico apenas para universos pequenos e pr√©-definidos (geralmente de inteiros come√ßando em 0).",
            "impl_bitset_cons2": "N√£o √© flex√≠vel para elementos arbitr√°rios (como strings ou objetos complexos).",
            "impl_bitset_cons3": "Pode se tornar ineficiente se o universo for grande, mas os conjuntos forem esparsos (poucos elementos).",
            "sets_prog_conclusion": "A escolha da implementa√ß√£o depende do caso de uso, mas para a maioria das tarefas de programa√ß√£o geral e an√°lise de dados em Python, <code class=\"code-inline\">set</code> √© a ferramenta ideal devido √† sua efici√™ncia e flexibilidade.",

            // Sets in Algorithms M27
            "sets_algo_title": "‚öôÔ∏è Conjuntos Otimizando Algoritmos",
            "sets_algo_subtitle": "Exemplos de como conjuntos tornam tarefas comuns mais r√°pidas.",
            "algo_unique_title": "Encontrar Elementos √önicos",
            "algo_unique_desc": "Dada uma lista com poss√≠veis duplicatas, como obter apenas os elementos √∫nicos? Converter para um conjunto faz isso automaticamente e de forma eficiente.",
            "algo_membership_title": "Teste de Pertencimento R√°pido",
            "algo_membership_desc": "Precisa verificar repetidamente se um item existe em uma grande cole√ß√£o? Usar um conjunto (<code class=\"code-inline\">item in meu_conjunto</code>) √© muito mais r√°pido (O(1) em m√©dia) do que procurar em uma lista (<code class=\"code-inline\">item in minha_lista</code>, que √© O(n)). Crucial em filtros e valida√ß√µes.",
            "algo_comparison_title": "Compara√ß√£o entre Cole√ß√µes",
            "algo_comparison_desc": "Encontrar elementos comuns (interse√ß√£o), elementos √∫nicos em cada cole√ß√£o (diferen√ßa) ou todos os elementos combinados (uni√£o) √© trivial e eficiente com opera√ß√µes de conjunto. √ötil para comparar caracter√≠sticas de usu√°rios, produtos, etc.",

            // Putting it Together M27
            "putting_together_title_m27": "‚öôÔ∏è Conjuntos em A√ß√£o: Filtrando Dados",
            "putting_together_subtitle_m27": "Vamos usar conjuntos para processar e filtrar dados, uma tarefa comum em pipelines de IA.",
            "putting_together_p1_m27": "Imagine que temos IDs de usu√°rios de diferentes fontes (cliques, compras, status ativo). Usar conjuntos (<code class=\"code-inline\">set</code>) √© ideal aqui.",
            "putting_together_p2_m27": "Primeiro, criamos conjuntos a partir das listas de IDs. Note que a duplicata <code class=\"code-inline\">101</code> em <code class=\"code-variable\">clicaram_anuncio_ia</code> √© automaticamente removida.",
            "putting_together_p3_m27": "Para encontrar quem clicou mas n√£o comprou, usamos a <span class=\"code-highlight\" data-translate-tooltip=\"tooltip_difference\"><span class=\"code-operator\">-</span> (diferen√ßa)<span class=\"tooltip\">Retorna elementos do primeiro conjunto que N√ÉO est√£o no segundo.</span></span>.",
            "putting_together_p4_m27": "Para encontrar quem fez as duas a√ß√µes (clicou E comprou), usamos a <span class=\"code-highlight\" data-translate-tooltip=\"tooltip_intersection\"><span class=\"code-operator\">&</span> (interse√ß√£o)<span class=\"tooltip\">Retorna elementos COMUNS a ambos os conjuntos.</span></span>.",
            "putting_together_p5_m27": "Podemos encadear interse√ß√µes para encontrar usu√°rios que satisfazem m√∫ltiplas condi√ß√µes (clicaram E compraram E est√£o ativos).",
            "putting_together_p6_m27": "A <span class=\"code-highlight\" data-translate-tooltip=\"tooltip_union\"><span class=\"code-operator\">|</span> (uni√£o)<span class=\"tooltip\">Retorna TODOS os elementos √∫nicos de ambos os conjuntos combinados.</span></span> nos d√° o grupo total de usu√°rios que interagiram com a campanha de IA de alguma forma.",
            "putting_together_p7_m27": "Finalmente, usamos <code class=\"code-function\">len()</code> no conjunto uni√£o para contar quantos usu√°rios √∫nicos totais foram envolvidos.",
            "tooltip_difference": "Retorna elementos do primeiro conjunto que N√ÉO est√£o no segundo.",
            "tooltip_intersection": "Retorna elementos COMUNS a ambos os conjuntos.",
            "tooltip_union": "Retorna TODOS os elementos √∫nicos de ambos os conjuntos combinados.",

            // Knowledge Check M27
            "quiz_title": "üß† Teste R√°pido!",
            "quiz_next_button": "Pr√≥xima Pergunta",
            "quiz_q1_m27": "Qual opera√ß√£o de conjunto corresponde ao operador l√≥gico `AND` (E)?",
            "quiz_q1_m27_opt1": "Uni√£o (|)", "quiz_q1_m27_opt2": "Interse√ß√£o (&)", "quiz_q1_m27_opt3": "Diferen√ßa (-)", "quiz_q1_m27_opt4": "Complementar",
            "quiz_q2_m27": "Qual a principal vantagem de usar um `set` em Python para verificar se um elemento `x` pertence a uma grande cole√ß√£o `C`?",
            "quiz_q2_m27_opt1": "Garante a ordem dos elementos.", "quiz_q2_m27_opt2": "Permite elementos duplicados.", "quiz_q2_m27_opt3": "A verifica√ß√£o (`x in C`) √© muito r√°pida (O(1) em m√©dia).", "quiz_q2_m27_opt4": "Usa menos mem√≥ria que uma lista.",
            "quiz_q3_m27": "Se `A = {1, 2, 3}` e `B = {3, 4, 5}`, qual o resultado de `A - B` (diferen√ßa)?",
            "quiz_q3_m27_opt1": "`{3}`", "quiz_q3_m27_opt2": "`{1, 2}`", "quiz_q3_m27_opt3": "`{4, 5}`", "quiz_q3_m27_opt4": "`{1, 2, 3, 4, 5}`",
            "quiz_q4_m27": "Para qual cen√°rio a implementa√ß√£o de conjuntos usando `bitsets` √© mais adequada?",
            "quiz_q4_m27_opt1": "Conjuntos com elementos de texto (strings).", "quiz_q4_m27_opt2": "Conjuntos muito grandes e esparsos (poucos elementos presentes).", "quiz_q4_m27_opt3": "Conjuntos de n√∫meros inteiros dentro de um universo pequeno e pr√©-definido.", "quiz_q4_m27_opt4": "Quando a ordem de inser√ß√£o dos elementos √© importante.",
            "quiz_feedback_correct": "Correto! üéâ",
            "quiz_feedback_incorrect": "N√£o foi bem assim! A resposta correta era: {correctAnswerText}",
            "quiz_final_score_title": "Teste R√°pido Completo!",
            "quiz_final_score_summary": "Voc√™ respondeu {score} de {total} perguntas corretamente.",
            "quiz_final_score_perfect": "Excelente! Voc√™ compreendeu bem as aplica√ß√µes de conjuntos.",
            "quiz_final_score_good": "Bom trabalho! Continue praticando para solidificar esses conceitos.",

            // Completion M27
            "completion_theory_title_m27": "Teoria do M√≥dulo 27 Completa!", // Full title for section
            "completion_theory_desc_m27": "Excelente! Voc√™ conectou a teoria dos conjuntos com a l√≥gica booleana e viu como a estrutura de dados <code class=\"code-inline\">set</code> em Python oferece efici√™ncia para algoritmos comuns em computa√ß√£o e IA. <br> Compreender essas aplica√ß√µes √© crucial para escrever c√≥digo mais limpo, r√°pido e l√≥gico.",
            "completion_next_steps": "Pronto para consolidar seu aprendizado? Siga para os exerc√≠cios ou explore os desafios na pr√°tica avan√ßada!"
        }
    };

    // --- Global Variables ---
    let currentQuestionIndex = 0;
    let score = 0;
    const lang = 'pt'; // Hardcoded language

    // --- DOM Elements (Get them once) ---
    const navToggleButton = document.getElementById('minimal-nav-toggle');
    const navPanel = document.getElementById('minimal-nav-panel');
    const body = document.body;
    const quizArea = document.getElementById('quiz-area');
    const feedbackArea = document.getElementById('quiz-feedback');
    const nextButton = document.getElementById('next-question-btn');
    // Removed textDemoBox and codeOutputArea as the example simulation isn't directly applicable here.

    // --- Functions ---

    function getTranslation(key, replacements = {}) {
         let text = translations[lang]?.[key] ?? `[${key}]`; // Default to key if not found
         for (const placeholder in replacements) {
             // Use a more robust regex to avoid issues with keys containing special characters
             const regex = new RegExp(`\\{${placeholder.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\}`, 'g');
             text = text.replace(regex, replacements[placeholder]);
         }
         return text;
    }

     function translatePage() {
         document.querySelectorAll('[data-translate]').forEach(el => {
             const key = el.getAttribute('data-translate');
             let translation = getTranslation(key);

              if (el.tagName === 'TITLE') { document.title = translation; }
              else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Skip form elements */ }
               else {
                   // Allow specific HTML tags safely within translations
                   // Updated list to include more common formatting tags
                  const safeHtmlRegex = /<\/?(code|strong|span|br|i|b|em|ul|li|div|p|a|mark|small|sub|sup)>/gi;
                  let containsSafeHtml = safeHtmlRegex.test(translation);

                  // Allow innerHTML if it contains only safe tags OR if it's in an explicitly allowed container class
                   // Added more classes where HTML is expected/safe
                  const allowedContainers = ['.op-example', '.info-example', '.info-details', '.map-details', '.impl-details', '.algo-content', '.code-explanation', '.footer p', '.quiz-feedback', '.completion-section p', '#welcome p', 'section p.text-center'];
                  let inAllowedContainer = false;
                   if (el.closest) { // Check if closest method exists
                        inAllowedContainer = allowedContainers.some(selector => el.closest(selector));
                   }


                   if (containsSafeHtml || inAllowedContainer) {
                      // Sanitize slightly - very basic example, real sanitization is complex
                       // translation = translation.replace(/<script.*?>.*?<\/script>/gi, ''); // Remove script tags
                      el.innerHTML = translation;
                   } else {
                      el.textContent = translation; // Safer default
                   }
              }
         });

          // Tooltip translation (assuming structure remains the same)
          document.querySelectorAll('.code-highlight[data-translate-tooltip]').forEach(el => {
              const tooltipKey = el.getAttribute('data-translate-tooltip');
              const tooltipSpan = el.querySelector('.tooltip');
              if(tooltipSpan && tooltipKey) {
                 tooltipSpan.innerHTML = getTranslation(tooltipKey); // Tooltips often need simple HTML
              }
          });

           // Code comment translation (ensure '#' prefix is handled)
           document.querySelectorAll('.code-comment[data-translate]').forEach(commentSpan => {
               const key = commentSpan.getAttribute('data-translate');
               let translatedText = getTranslation(key);
               // Ensure it starts with # and a space for readability
               let commentContent = translatedText.startsWith('#') ? translatedText.substring(1).trim() : translatedText.trim();
               commentSpan.textContent = '# ' + commentContent;
           });
    }


    // --- Quiz Data & Functions (Module 27) ---
    const quizData = [
         { questionKey: "quiz_q1_m27", optionKeys: ["quiz_q1_m27_opt1", "quiz_q1_m27_opt2", "quiz_q1_m27_opt3", "quiz_q1_m27_opt4"], correctAnswer: 1 }, // Intersection -> AND
         { questionKey: "quiz_q2_m27", optionKeys: ["quiz_q2_m27_opt1", "quiz_q2_m27_opt2", "quiz_q2_m27_opt3", "quiz_q2_m27_opt4"], correctAnswer: 2 }, // O(1) membership test
         { questionKey: "quiz_q3_m27", optionKeys: ["quiz_q3_m27_opt1", "quiz_q3_m27_opt2", "quiz_q3_m27_opt3", "quiz_q3_m27_opt4"], correctAnswer: 1 }, // A - B = {1, 2}
         { questionKey: "quiz_q4_m27", optionKeys: ["quiz_q4_m27_opt1", "quiz_q4_m27_opt2", "quiz_q4_m27_opt3", "quiz_q4_m27_opt4"], correctAnswer: 2 }  // Bitsets -> small, predefined integer universe
    ];

    function loadQuestion() {
          if (!quizArea) return; // Ensure quizArea exists

          // If we reached the end, show score
          if (currentQuestionIndex >= quizData.length) {
              if (!quizArea.querySelector('[data-translate="quiz_final_score_title"]')) { // Avoid re-rendering score
                 showFinalScore();
              }
              return;
          }

          const currentQuiz = quizData[currentQuestionIndex];
          const questionText = getTranslation(currentQuiz.questionKey);
          // Generate HTML for question and options, allowing code tags via translation
          quizArea.innerHTML = `
              <div class="quiz-question">${currentQuestionIndex + 1}. ${questionText}</div>
              <div class="quiz-options">
                  ${currentQuiz.optionKeys.map((optionKey, index) => `
                      <button class="quiz-option-btn" data-index="${index}">${getTranslation(optionKey)}</button>
                  `).join('')}
              </div>
          `;

          // Reset feedback and next button
          if (feedbackArea) {
            feedbackArea.classList.remove('visible', 'correct', 'incorrect');
            feedbackArea.textContent = '';
            feedbackArea.style.height = '0'; // Reset height
            feedbackArea.style.marginBottom = '0'; // Reset margin
          }
          if (nextButton) {
            nextButton.classList.remove('visible');
            nextButton.disabled = true;
          }

          // Add event listeners to the new buttons
          quizArea.querySelectorAll('.quiz-option-btn').forEach(button => {
              button.addEventListener('click', handleAnswer);
          });
    }

    function handleAnswer(event) {
         const selectedButton = event.target;
         const selectedIndex = parseInt(selectedButton.dataset.index);
         const correctIndex = quizData[currentQuestionIndex].correctAnswer;
         const correctOptionKey = quizData[currentQuestionIndex].optionKeys[correctIndex];

         // Disable all options
         quizArea.querySelectorAll('.quiz-option-btn').forEach(btn => {
            btn.disabled = true;
            btn.classList.remove('shake'); // Remove shake if present from previous incorrect
         });

         if (!feedbackArea || !nextButton) return; // Ensure elements exist

         feedbackArea.classList.add('visible');

         if (selectedIndex === correctIndex) {
             selectedButton.classList.add('correct');
             feedbackArea.innerHTML = getTranslation('quiz_feedback_correct'); // Allows potential icons/HTML in feedback
             feedbackArea.classList.add('correct');
             feedbackArea.classList.remove('incorrect');
             score++;
             selectedButton.classList.add('tada-anim');
         } else {
             selectedButton.classList.add('incorrect');
             // Get translated correct answer text, allowing code tags
             const formattedCorrectAnswer = getTranslation(correctOptionKey);
             feedbackArea.innerHTML = getTranslation('quiz_feedback_incorrect', { correctAnswerText: `<strong>${formattedCorrectAnswer}</strong>` });
             feedbackArea.classList.add('incorrect');
             feedbackArea.classList.remove('correct');
             // Highlight the correct button as well
             const correctButton = quizArea.querySelector(`.quiz-option-btn[data-index="${correctIndex}"]`);
             if(correctButton) correctButton.classList.add('correct');
             selectedButton.classList.add('shake');
         }

         // Remove animation classes after they finish
          selectedButton.addEventListener('animationend', () => {
               selectedButton.classList.remove('tada-anim', 'shake');
          }, { once: true });

         // Make feedback area adjust height and margin smoothly
         feedbackArea.style.height = feedbackArea.scrollHeight + 'px';
         feedbackArea.style.marginBottom = '1rem';


         // Show and enable next button
         nextButton.classList.add('visible');
         nextButton.disabled = false;
     }

     function showFinalScore() {
            if (!quizArea) return;
            const totalQuestions = quizData.length;
            // Determine message based on score percentage
            let resultMessageKey = (score / totalQuestions) >= 0.75 ? 'quiz_final_score_perfect' : 'quiz_final_score_good'; // 75% threshold

            quizArea.innerHTML = `
               <div class="quiz-question text-center" data-translate="quiz_final_score_title" style="font-size: 1.5rem;">${getTranslation('quiz_final_score_title')}</div>
               <p class="text-center" style="font-size: 1.2rem; margin-bottom: 1rem;">${getTranslation('quiz_final_score_summary', { score: score, total: totalQuestions })}</p>
               <p class="text-center" style="color: ${score === totalQuestions ? 'var(--success-color)' : 'var(--primary-color)'}; font-weight: bold;">${getTranslation(resultMessageKey)}</p>
            `;
            if (feedbackArea) feedbackArea.classList.remove('visible'); // Hide feedback area
            if (nextButton) nextButton.style.display = 'none'; // Hide next button
            quizArea.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Scroll score into view
     }


    // --- Intersection Observer Setup ---
    function setupObservers() {
        const observerOptions = {
            root: null, // relative to viewport
            rootMargin: '0px',
            threshold: 0.1 // Trigger when 10% of the element is visible
        };

        const observerCallback = (entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    // Optional: Unobserve after it becomes visible to save resources
                    // observer.unobserve(entry.target);
                }
                // Optional: Remove 'visible' if it scrolls out of view
                // else {
                //     entry.target.classList.remove('visible');
                // }
            });
        };

        const animationObserver = new IntersectionObserver(observerCallback, observerOptions);

        // Observe elements with the fade-in class
        document.querySelectorAll('.fade-in-on-scroll').forEach(el => {
            animationObserver.observe(el);
        });

        // No specific code output simulation needed for this module like in the example
    }

    // --- Event Listeners Setup ---
    function setupEventListeners() {
        // Navbar Toggle
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => {
                event.stopPropagation();
                body.classList.toggle('nav-active');
                navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
            });

            // Close nav if clicking outside
            document.addEventListener('click', (event) => {
                if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target)) {
                    body.classList.remove('nav-active');
                    navToggleButton.setAttribute('aria-expanded', 'false');
                }
            });

            // Close nav on link click
            navPanel.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    // Check if it's an internal link
                    if (link.getAttribute('href').startsWith('#')) {
                         // Allow default scroll behavior
                        // Close panel slightly delayed
                        setTimeout(() => {
                            body.classList.remove('nav-active');
                            navToggleButton.setAttribute('aria-expanded', 'false');
                        }, 150);
                    }
                    // External links will navigate away anyway
                });
            });

            // Close nav on Escape key
            document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape' && body.classList.contains('nav-active')) {
                     body.classList.remove('nav-active');
                     navToggleButton.setAttribute('aria-expanded', 'false');
                 }
             });
        }

        // Quiz Next Button
        if (nextButton) {
            nextButton.addEventListener('click', () => {
                if (!nextButton.disabled) {
                    currentQuestionIndex++;
                    loadQuestion(); // Load the next question
                }
            });
        } else {
            console.error("Elemento #next-question-btn n√£o encontrado.");
        }
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Check if elements needed for quiz exist before proceeding
        if (!quizArea) console.error("Elemento #quiz-area n√£o encontrado.");
        if (!feedbackArea) console.error("Elemento #quiz-feedback n√£o encontrado.");

        translatePage();        // Apply translations first
        setupEventListeners();  // Set up interactive elements
        setupObservers();       // Set up animations

        if (quizArea) {
            loadQuestion();     // Load the first quiz question if container exists
        }
    });

    </script>

</body>
</html>