<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check - Module 4</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Not used directly here, but kept for consistency */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Using this for quiz elements */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color);
             --lang-select-bg: var(--background-card);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--check-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
            padding-bottom: 3rem; /* Space for footer */
        }

        /* --- Page Header --- */
        .page-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1.5rem 1.5rem 1rem 1.5rem; /* Slightly less padding than dashboard */
            margin-bottom: 2rem;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-content {
            flex-grow: 1;
            text-align: center; /* Center title */
            padding: 0 1rem; /* Padding around title */
        }
        .page-header h1 {
            font-family: var(--font-title);
            font-size: 1.8rem; /* Slightly smaller title */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center; /* Center icon and text */
        }
         .page-header h1 i {
            margin-right: 10px;
            opacity: 0.8;
            font-size: 1.6rem;
         }

        .return-button {
             background-color: rgba(255, 255, 255, 0.15);
             color: var(--text-light);
             border: none;
             border-radius: 50%;
             width: 45px;
             height: 45px;
             font-size: 1.2rem;
             cursor: pointer;
             transition: background-color var(--transition-speed);
             display: inline-flex;
             align-items: center;
             justify-content: center;
             text-decoration: none; /* For <a> tag */
             flex-shrink: 0; /* Prevent shrinking */
        }
        .return-button:hover { background-color: rgba(255, 255, 255, 0.25); }

        /* Language Switcher Styles (Adapted for header) */
        .language-switcher { margin: 0; /* Reset margin */ width: 150px; flex-shrink: 0; /* Prevent shrinking */ }
        #languageSelect {
            width: 100%;
            background: var(--lang-select-bg);
            color: var(--text-dark);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 8px 30px 8px 12px; /* Adjusted padding */
            cursor: pointer;
            font-size: 0.9rem; /* Smaller font */
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--check-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center; /* Adjusted position */
            background-size: 8px auto; /* Smaller arrow */
            transition: border-color 0.3s ease;
        }
        #languageSelect:hover { border-color: var(--primary-color); }
        #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
        #languageSelect option { background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px; }

        /* --- Main Content Area --- */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* --- Quiz Card Styling --- */
        .quiz-card {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            padding: 2rem 2.5rem;
        }

        .quiz-instructions {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            text-align: center;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1.5rem;
        }

        /* --- Question Styling --- */
        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee; /* Lighter border between questions */
        }
        .question-block:last-of-type {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
         .question-text code {
             font-size: 0.95em;
             background: #e9ecef;
             padding: 2px 5px;
             border-radius: 4px;
             color: #c7254e;
             font-family: monospace;
         }
        .options label {
            display: block;
            margin-bottom: 0.75rem;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            position: relative;
            font-size: 0.95rem;
        }
        .options label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }
        .options input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
             accent-color: var(--check-color); /* Style the radio button itself */
        }
        .options span { /* The text part of the option */
            vertical-align: middle;
        }

        /* Styles applied after submission */
        .options label.selected {
            border-color: var(--check-color);
            background-color: #f0eaff; /* Light purple */
        }
        .options label.correct {
            border-color: var(--success-color);
            background-color: #d1e7dd; /* Light green */
        }
        .options label.incorrect.selected {
            border-color: var(--error-color);
            background-color: #f8d7da; /* Light red */
            text-decoration: line-through;
        }

        /* Feedback Icons */
         .options label .feedback-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
            display: none; /* Hidden by default */
         }
         .options label.correct .feedback-icon.fa-check { display: inline-block; color: var(--success-color); }
         .options label.incorrect.selected .feedback-icon.fa-times { display: inline-block; color: var(--error-color); }

        /* --- Submit Button --- */
        .submit-button {
            display: block;
            width: 100%;
            padding: 0.9rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-light);
            background-color: var(--check-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            margin-top: 2.5rem;
            font-family: var(--font-title);
        }
        .submit-button:hover {
            background-color: #5a35a1; /* Darker purple */
            transform: translateY(-2px);
        }
         .submit-button:disabled {
             background-color: var(--secondary-color);
             cursor: not-allowed;
             transform: none;
         }
         .submit-button i { margin-right: 8px; }

        /* --- Results Area --- */
        #results-area {
            margin-top: 2.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden initially */
        }
        #results-area.result-pass {
            background-color: #d1e7dd; /* Light green */
            border: 1px solid var(--success-color);
            color: #0a3622; /* Darker green text */
        }
        #results-area.result-fail {
            background-color: #f8d7da; /* Light red */
            border: 1px solid var(--error-color);
            color: #58151c; /* Darker red text */
        }
        .score-display {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
             font-family: var(--font-title);
        }
         .score-display span {
             font-weight: 400;
             font-size: 1rem;
             font-family: var(--font-body);
         }
        .result-message {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        .retry-button {
            display: inline-block;
            padding: 0.7rem 1.2rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-light);
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        .retry-button:hover { background-color: #5a6268; }
        .retry-button i { margin-right: 6px; }

         /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem;
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
         }


        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .page-header { flex-direction: column; align-items: stretch; padding: 1rem; }
            .header-content { text-align: center; order: 2; margin-top: 0.5rem; padding: 0;}
            .page-header h1 { font-size: 1.6rem; }
             .return-button { position: absolute; top: 10px; left: 10px; }
             .language-switcher { order: 3; width: 100%; margin-top: 1rem; }
             #languageSelect { padding: 6px 25px 6px 10px; }
            .quiz-container { padding: 0 1rem; }
            .quiz-card { padding: 1.5rem; }
            .question-text { font-size: 1rem; }
            .options label { padding: 0.7rem 0.8rem; font-size: 0.9rem;}
             .options label .feedback-icon { right: 10px; }
            .submit-button { padding: 0.8rem 1rem; font-size: 1rem;}
            #results-area { padding: 1rem; }
            .score-display { font-size: 1.2rem; }
            .result-message { font-size: 1rem; }
        }
         @media (max-width: 480px) {
             html { font-size: 14px; }
             .page-header h1 { font-size: 1.4rem; }
             .page-header h1 i { font-size: 1.3rem; margin-right: 6px;}
             .return-button { width: 40px; height: 40px; font-size: 1rem;}
             #languageSelect { font-size: 0.85rem; }
             .quiz-card { padding: 1rem 1.2rem; }
             .quiz-instructions { font-size: 0.9rem; padding-bottom: 1rem; margin-bottom: 1.5rem; }
             .question-block { margin-bottom: 1.5rem; padding-bottom: 1rem; }
             .question-text { margin-bottom: 0.8rem; }
             .options label { margin-bottom: 0.6rem; }
             .submit-button { margin-top: 2rem; }
             #results-area { margin-top: 2rem; }
         }

    </style>
</head>
<body>

    <header class="page-header">
        <a href="ctp-dashboard.html" class="return-button" data-translate-aria-label="return_button_aria" aria-label="Return to Dashboard">
            <i class="fas fa-arrow-left"></i>
        </a>
        <div class="header-content">
             <h1 data-translate="header_title"><i class="fas fa-keyboard"></i> Module 4: Getting User Input</h1>
        </div>
         <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="quiz-container">
        <div class="quiz-card">
            <p class="quiz-instructions" data-translate="quiz_instructions">
                Answer the following 10 questions. You need at least 6 correct answers to pass. You can retry as many times as you need.
            </p>

            <form id="quiz-form">
                <!-- Questions will be dynamically inserted here by JavaScript -->
                 <div id="questions-container"></div>

                <button type="submit" class="submit-button" id="submit-button">
                    <i class="fas fa-check"></i> <span data-translate="submit_button">Submit Answers</span>
                </button>
            </form>

            <div id="results-area">
                <div class="score-display" id="score-display"></div>
                <p class="result-message" id="result-message"></p>
                <button class="retry-button" id="retry-button" style="display: none;">
                    <i class="fas fa-redo"></i> <span data-translate="retry_button">Retry Quiz</span>
                </button>
            </div>

        </div>
    </main>

     <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 4; // Specific to this knowledge check
        const PASSING_SCORE = 6;
        const TOTAL_QUESTIONS = 10;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": "Knowledge Check - Module 4: User Input",
                 "header_title": "Module 4: Getting User Input",
                 "quiz_instructions": "Answer the following 10 questions. You need at least 6 correct answers to pass. You can retry as many times as you need.",
                 "submit_button": "Submit Answers",
                 "retry_button": "Retry Quiz",
                 "result_pass_message": "Congratulations! You passed! Your progress for this module is saved.",
                 "result_fail_message": "You didn't pass this time. Keep practicing and try again!",
                 "score_text": "Your score: {score}/{total}",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "Select Language", "return_button_aria": "Return to Dashboard",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 // Module 4 Questions
                 "kc4_q1": "1. What data type does the `input()` function always return?",
                 "kc4_q1_a": "Integer (`int`)", "kc4_q1_b": "String (`str`)", "kc4_q1_c": "Float (`float`)", "kc4_q1_d": "Boolean (`bool`)",
                 "kc4_q2": "2. Which function is used to convert a string value obtained from `input()` into a whole number?",
                 "kc4_q2_a": "`str()`", "kc4_q2_b": "`convert()`", "kc4_q2_c": "`int()`", "kc4_q2_d": "`number()`",
                 "kc4_q3": "3. Consider the code: `name = input('Enter name: ')`. What does the text 'Enter name: ' represent?",
                 "kc4_q3_a": "The value stored in the `name` variable", "kc4_q3_b": "A comment explaining the code", "kc4_q3_c": "The prompt displayed to the user", "kc4_q3_d": "An error message",
                 "kc4_q4": "4. If a user enters `12.5` when prompted by `num_str = input('Enter number: ')`, what is the value of `type(num_str)`?",
                 "kc4_q4_a": "`<class 'int'>`", "kc4_q4_b": "`<class 'float'>`", "kc4_q4_c": "`<class 'str'>`", "kc4_q4_d": "`<class 'number'>`",
                 "kc4_q5": "5. What will happen if you run `value = int(input('Enter text: '))` and the user types `hello`?",
                 "kc4_q5_a": "The program continues normally, `value` becomes 0", "kc4_q5_b": "`value` stores the string `'hello'`", "kc4_q5_c": "A `TypeError` occurs", "kc4_q5_d": "A `ValueError` occurs",
                 "kc4_q6": "6. You want to get the user's age (a whole number) and add 1 to it. Which code snippet is correct?",
                 "kc4_q6_a": "`age = input('Age: '); new_age = age + 1`", "kc4_q6_b": "`age = int(input('Age: ')); new_age = age + 1`", "kc4_q6_c": "`age = str(input('Age: ')); new_age = age + 1`", "kc4_q6_d": "`age = input('Age: '); new_age = int(age + 1)`",
                 "kc4_q7": "7. Which function converts a value (like a number) into its string representation?",
                 "kc4_q7_a": "`input()`", "kc4_q7_b": "`int()`", "kc4_q7_c": "`float()`", "kc4_q7_d": "`str()`",
                 "kc4_q8": "8. Consider this code: `num1 = input('First: '); num2 = input('Second: ')`. If the user enters `10` and then `5`, what is the result of `print(num1 + num2)`?",
                 "kc4_q8_a": "`15` (integer)", "kc4_q8_b": "`105` (string)", "kc4_q8_c": "`10 5` (string with space)", "kc4_q8_d": "An error occurs",
                 "kc4_q9": "9. To get a number that might have a decimal part (like price) from the user, which conversion function should you use?",
                 "kc4_q9_a": "`int()`", "kc4_q9_b": "`str()`", "kc4_q9_c": "`float()`", "kc4_q9_d": "`decimal()`",
                 "kc4_q10": "10. True or False: The `input()` function automatically figures out if the user typed a number or text.",
                 "kc4_q10_a": "True", "kc4_q10_b": "False"
             },
             pt: {
                 "page_title": "Verificação de Conhecimento - Módulo 4: Entrada do Usuário",
                 "header_title": "Módulo 4: Obtendo Entrada do Usuário",
                 "quiz_instructions": "Responda às 10 perguntas seguintes. Você precisa de pelo menos 6 respostas corretas para passar. Pode tentar quantas vezes precisar.",
                 "submit_button": "Enviar Respostas",
                 "retry_button": "Tentar Novamente",
                 "result_pass_message": "Parabéns! Você passou! Seu progresso para este módulo foi salvo.",
                 "result_fail_message": "Você não passou desta vez. Continue praticando e tente novamente!",
                 "score_text": "Sua pontuação: {score}/{total}",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "Selecionar Idioma", "return_button_aria": "Retornar ao Painel",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // Module 4 Questions PT
                 "kc4_q1": "1. Qual tipo de dado a função `input()` sempre retorna?",
                 "kc4_q1_a": "Inteiro (`int`)", "kc4_q1_b": "String (`str`)", "kc4_q1_c": "Float (`float`)", "kc4_q1_d": "Booleano (`bool`)",
                 "kc4_q2": "2. Qual função é usada para converter um valor string obtido do `input()` em um número inteiro?",
                 "kc4_q2_a": "`str()`", "kc4_q2_b": "`convert()`", "kc4_q2_c": "`int()`", "kc4_q2_d": "`number()`",
                 "kc4_q3": "3. Considere o código: `nome = input('Digite o nome: ')`. O que o texto 'Digite o nome: ' representa?",
                 "kc4_q3_a": "O valor armazenado na variável `nome`", "kc4_q3_b": "Um comentário explicando o código", "kc4_q3_c": "A mensagem exibida para o usuário", "kc4_q3_d": "Uma mensagem de erro",
                 "kc4_q4": "4. Se um usuário digitar `12.5` quando solicitado por `num_str = input('Digite número: ')`, qual é o valor de `type(num_str)`?",
                 "kc4_q4_a": "`<class 'int'>`", "kc4_q4_b": "`<class 'float'>`", "kc4_q4_c": "`<class 'str'>`", "kc4_q4_d": "`<class 'number'>`",
                 "kc4_q5": "5. O que acontecerá se você executar `valor = int(input('Digite texto: '))` e o usuário digitar `ola`?",
                 "kc4_q5_a": "O programa continua normalmente, `valor` se torna 0", "kc4_q5_b": "`valor` armazena a string `'ola'`", "kc4_q5_c": "Ocorre um `TypeError`", "kc4_q5_d": "Ocorre um `ValueError`",
                 "kc4_q6": "6. Você quer obter a idade do usuário (um número inteiro) e adicionar 1 a ela. Qual trecho de código está correto?",
                 "kc4_q6_a": "`idade = input('Idade: '); nova_idade = idade + 1`", "kc4_q6_b": "`idade = int(input('Idade: ')); nova_idade = idade + 1`", "kc4_q6_c": "`idade = str(input('Idade: ')); nova_idade = idade + 1`", "kc4_q6_d": "`idade = input('Idade: '); nova_idade = int(idade + 1)`",
                 "kc4_q7": "7. Qual função converte um valor (como um número) para sua representação em string?",
                 "kc4_q7_a": "`input()`", "kc4_q7_b": "`int()`", "kc4_q7_c": "`float()`", "kc4_q7_d": "`str()`",
                 "kc4_q8": "8. Considere este código: `num1 = input('Primeiro: '); num2 = input('Segundo: ')`. Se o usuário digitar `10` e depois `5`, qual é o resultado de `print(num1 + num2)`?",
                 "kc4_q8_a": "`15` (inteiro)", "kc4_q8_b": "`105` (string)", "kc4_q8_c": "`10 5` (string com espaço)", "kc4_q8_d": "Ocorre um erro",
                 "kc4_q9": "9. Para obter um número do usuário que pode ter parte decimal (como preço), qual função de conversão você deve usar?",
                 "kc4_q9_a": "`int()`", "kc4_q9_b": "`str()`", "kc4_q9_c": "`float()`", "kc4_q9_d": "`decimal()`",
                 "kc4_q10": "10. Verdadeiro ou Falso: A função `input()` descobre automaticamente se o usuário digitou um número ou texto.",
                 "kc4_q10_a": "Verdadeiro", "kc4_q10_b": "Falso"
             },
             zh: {
                 "page_title": "知识测验 - 模块 4：用户输入",
                 "header_title": "模块 4：获取用户输入",
                 "quiz_instructions": "回答以下 10 个问题。您需要至少答对 6 题才能通过。您可以根据需要重试任意次数。",
                 "submit_button": "提交答案",
                 "retry_button": "重新测验",
                 "result_pass_message": "恭喜！您已通过！本模块的进度已保存。",
                 "result_fail_message": "这次您没有通过。继续练习并重试！",
                 "score_text": "您的得分：{score}/{total}",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "选择语言", "return_button_aria": "返回仪表板",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 // Module 4 Questions ZH
                 "kc4_q1": "1. `input()` 函数总是返回什么数据类型？",
                 "kc4_q1_a": "整数 (`int`)", "kc4_q1_b": "字符串 (`str`)", "kc4_q1_c": "浮点数 (`float`)", "kc4_q1_d": "布尔值 (`bool`)",
                 "kc4_q2": "2. 哪个函数用于将从 `input()` 获取的字符串值转换为整数？",
                 "kc4_q2_a": "`str()`", "kc4_q2_b": "`convert()`", "kc4_q2_c": "`int()`", "kc4_q2_d": "`number()`",
                 "kc4_q3": "3. 考虑代码：`name = input('输入姓名：')`。文本 '输入姓名：' 代表什么？",
                 "kc4_q3_a": "存储在 `name` 变量中的值", "kc4_q3_b": "解释代码的注释", "kc4_q3_c": "显示给用户的提示信息", "kc4_q3_d": "一条错误消息",
                 "kc4_q4": "4. 如果用户在 `num_str = input('输入数字：')` 的提示下输入 `12.5`，`type(num_str)` 的值是什么？",
                 "kc4_q4_a": "`<class 'int'>`", "kc4_q4_b": "`<class 'float'>`", "kc4_q4_c": "`<class 'str'>`", "kc4_q4_d": "`<class 'number'>`",
                 "kc4_q5": "5. 如果您运行 `value = int(input('输入文本：'))` 并且用户输入 `hello`，会发生什么？",
                 "kc4_q5_a": "程序正常继续，`value` 变为 0", "kc4_q5_b": "`value` 存储字符串 `'hello'`", "kc4_q5_c": "发生 `TypeError` 错误", "kc4_q5_d": "发生 `ValueError` 错误",
                 "kc4_q6": "6. 您想获取用户的年龄（整数）并将其加 1。哪个代码片段是正确的？",
                 "kc4_q6_a": "`age = input('年龄：'); new_age = age + 1`", "kc4_q6_b": "`age = int(input('年龄：')); new_age = age + 1`", "kc4_q6_c": "`age = str(input('年龄：')); new_age = age + 1`", "kc4_q6_d": "`age = input('年龄：'); new_age = int(age + 1)`",
                 "kc4_q7": "7. 哪个函数将一个值（例如数字）转换为其字符串表示形式？",
                 "kc4_q7_a": "`input()`", "kc4_q7_b": "`int()`", "kc4_q7_c": "`float()`", "kc4_q7_d": "`str()`",
                 "kc4_q8": "8. 考虑这段代码：`num1 = input('第一个：'); num2 = input('第二个：')`。如果用户输入 `10` 然后输入 `5`，`print(num1 + num2)` 的结果是什么？",
                 "kc4_q8_a": "`15` (整数)", "kc4_q8_b": "`105` (字符串)", "kc4_q8_c": "`10 5` (带空格的字符串)", "kc4_q8_d": "发生错误",
                 "kc4_q9": "9. 要从用户那里获取可能带有小数部分的数字（如价格），您应该使用哪个转换函数？",
                 "kc4_q9_a": "`int()`", "kc4_q9_b": "`str()`", "kc4_q9_c": "`float()`", "kc4_q9_d": "`decimal()`",
                 "kc4_q10": "10. 正确还是错误：`input()` 函数会自动判断用户输入的是数字还是文本。",
                 "kc4_q10_a": "正确", "kc4_q10_b": "错误"
             }
         };

         // --- Quiz Questions Data ---
         const questions = [
            { id: 'q1', key: 'kc4_q1', options: { A: 'kc4_q1_a', B: 'kc4_q1_b', C: 'kc4_q1_c', D: 'kc4_q1_d' }, answer: 'B' },
            { id: 'q2', key: 'kc4_q2', options: { A: 'kc4_q2_a', B: 'kc4_q2_b', C: 'kc4_q2_c', D: 'kc4_q2_d' }, answer: 'C' },
            { id: 'q3', key: 'kc4_q3', options: { A: 'kc4_q3_a', B: 'kc4_q3_b', C: 'kc4_q3_c', D: 'kc4_q3_d' }, answer: 'C' },
            { id: 'q4', key: 'kc4_q4', options: { A: 'kc4_q4_a', B: 'kc4_q4_b', C: 'kc4_q4_c', D: 'kc4_q4_d' }, answer: 'C' },
            { id: 'q5', key: 'kc4_q5', options: { A: 'kc4_q5_a', B: 'kc4_q5_b', C: 'kc4_q5_c', D: 'kc4_q5_d' }, answer: 'D' },
            { id: 'q6', key: 'kc4_q6', options: { A: 'kc4_q6_a', B: 'kc4_q6_b', C: 'kc4_q6_c', D: 'kc4_q6_d' }, answer: 'B' },
            { id: 'q7', key: 'kc4_q7', options: { A: 'kc4_q7_a', B: 'kc4_q7_b', C: 'kc4_q7_c', D: 'kc4_q7_d' }, answer: 'D' },
            { id: 'q8', key: 'kc4_q8', options: { A: 'kc4_q8_a', B: 'kc4_q8_b', C: 'kc4_q8_c', D: 'kc4_q8_d' }, answer: 'B' },
            { id: 'q9', key: 'kc4_q9', options: { A: 'kc4_q9_a', B: 'kc4_q9_b', C: 'kc4_q9_c', D: 'kc4_q9_d' }, answer: 'C' },
            { id: 'q10', key: 'kc4_q10', options: { A: 'kc4_q10_a', B: 'kc4_q10_b'}, answer: 'B' } // True/False
        ];

        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const questionsContainer = document.getElementById('questions-container');
        const submitButton = document.getElementById('submit-button');
        const resultsArea = document.getElementById('results-area');
        const scoreDisplay = document.getElementById('score-display');
        const resultMessage = document.getElementById('result-message');
        const retryButton = document.getElementById('retry-button');
        const languageSelectElement = document.getElementById('languageSelect');

        // --- Utility Functions ---
        function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); return (storedLang && translations[storedLang]) ? storedLang : 'en'; }
        function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
        function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status:", e); return {}; } }
        function saveKnowledgeCheckStatus(statusObject) { try { localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject)); } catch (e) { console.error("Error saving KC status:", e); } }

        // --- Translation Logic ---
        function translatePage(lang) {
             if (!translations[lang]) lang = 'en';
             document.documentElement.lang = lang;
             document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang); if (el.tagName === 'TITLE') { document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } });
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); });
             // Re-render quiz questions with the new language
             renderQuiz(lang);
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en';
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            languageSelectElement.value = lang; // Update dropdown
            translatePage(lang); // Translate static text and re-render quiz
             // If results are showing, update result text language too
             if (resultsArea.style.display !== 'none') {
                 const score = parseInt(scoreDisplay.dataset.score || '0');
                 const passed = score >= PASSING_SCORE;
                 updateResultsText(score, passed, lang);
             }
        }

        // --- Quiz Rendering ---
        function renderQuiz(lang) {
            questionsContainer.innerHTML = ''; // Clear previous questions
            questions.forEach(q => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.setAttribute('data-question-id', q.id);

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                // Use innerHTML for potential <code> tags in questions
                questionText.innerHTML = getTranslation(q.key, lang);
                questionBlock.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options');

                // Randomize option order? Optional, but good practice.
                // const optionKeys = Object.keys(q.options).sort(() => Math.random() - 0.5);

                for (const optionKey in q.options) {
                // Object.keys(q.options).forEach(optionKey => { // Use this if randomizing
                    const optionValue = optionKey; // e.g., 'A', 'B'
                    const optionTextKey = q.options[optionKey]; // e.g., 'kc4_q1_a'

                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id; // Group radios by question ID
                    input.value = optionValue;
                    input.required = true; // Make sure an option is selected

                    const span = document.createElement('span');
                     // Use innerHTML for potential <code> tags in options
                    span.innerHTML = ` ${getTranslation(optionTextKey, lang)}`; // Add space before text

                     // Add hidden feedback icons
                     const correctIcon = document.createElement('i');
                     correctIcon.className = 'fas fa-check feedback-icon';
                     const incorrectIcon = document.createElement('i');
                     incorrectIcon.className = 'fas fa-times feedback-icon';

                    label.appendChild(input);
                    label.appendChild(span);
                    label.appendChild(correctIcon);
                    label.appendChild(incorrectIcon);
                    optionsDiv.appendChild(label);
                // }); // End forEach if randomizing
                } // End for..in loop

                questionBlock.appendChild(optionsDiv);
                questionsContainer.appendChild(questionBlock);
            });
            // Reset form state if it was previously submitted
            resetQuizAppearance();
        }

        // --- Quiz Submission and Grading ---
        function handleSubmit(event) {
            event.preventDefault();
            const formData = new FormData(quizForm);
            let score = 0;
            let selectedAnswers = {};

            questions.forEach(q => {
                const selectedValue = formData.get(q.id);
                selectedAnswers[q.id] = selectedValue;
                if (selectedValue === q.answer) {
                    score++;
                }
            });

            displayResults(score, selectedAnswers);
        }

        function displayResults(score, selectedAnswers) {
            const passed = score >= PASSING_SCORE;
            const lang = getStoredLanguage();

             // 1. Update result text content
             updateResultsText(score, passed, lang);

            // 2. Style results area
            resultsArea.classList.remove('result-pass', 'result-fail');
            resultsArea.classList.add(passed ? 'result-pass' : 'result-fail');
            resultsArea.style.display = 'block';

            // 3. Store score for potential language switching update
            scoreDisplay.dataset.score = score;

             // 4. Highlight answers
             highlightAnswers(selectedAnswers);

            // 5. Disable form elements
            submitButton.disabled = true;
            questionsContainer.querySelectorAll('input[type="radio"]').forEach(input => {
                input.disabled = true;
            });

            // 6. Show retry button
            retryButton.style.display = 'inline-block';

            // 7. Update localStorage if passed
            if (passed) {
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[MODULE_ID] = true; // Mark this module as complete
                saveKnowledgeCheckStatus(currentStatus);
            }

            // Scroll to results
            resultsArea.scrollIntoView({ behavior: 'smooth' });
        }

         function updateResultsText(score, passed, lang) {
            scoreDisplay.innerHTML = getTranslation('score_text', lang, { score: score, total: TOTAL_QUESTIONS });
            resultMessage.textContent = getTranslation(passed ? 'result_pass_message' : 'result_fail_message', lang);
         }

         function highlightAnswers(selectedAnswers) {
             questions.forEach(q => {
                 const questionBlock = questionsContainer.querySelector(`.question-block[data-question-id="${q.id}"]`);
                 if (!questionBlock) return;

                 const labels = questionBlock.querySelectorAll('.options label');
                 labels.forEach(label => {
                     const input = label.querySelector('input[type="radio"]');
                     const optionValue = input.value;

                     // Remove previous classes
                     label.classList.remove('selected', 'correct', 'incorrect');

                     // Mark the selected answer
                     if (optionValue === selectedAnswers[q.id]) {
                         label.classList.add('selected');
                     }

                     // Mark correct/incorrect
                     if (optionValue === q.answer) {
                         label.classList.add('correct');
                     } else if (optionValue === selectedAnswers[q.id]) {
                         label.classList.add('incorrect');
                     }
                 });
             });
         }


        // --- Retry Logic ---
         function resetQuizAppearance() {
             // Remove result styling
             resultsArea.style.display = 'none';
             resultsArea.classList.remove('result-pass', 'result-fail');
             // Hide retry button
             retryButton.style.display = 'none';
             // Re-enable submit button
             submitButton.disabled = false;
              // Re-enable radio buttons and remove highlighting
             questionsContainer.querySelectorAll('input[type="radio"]').forEach(input => {
                 input.disabled = false;
                 input.checked = false; // Uncheck
                 input.closest('label').classList.remove('selected', 'correct', 'incorrect');
             });
             // Clear score dataset
             scoreDisplay.removeAttribute('data-score');
         }

        function handleRetry() {
             resetQuizAppearance();
             // Optional: Re-render to shuffle or just reset state
             // renderQuiz(getStoredLanguage()); // Uncomment if you want to re-render/shuffle
             quizForm.reset(); // Clear selections
             window.scrollTo({ top: quizForm.offsetTop - 30, behavior: 'smooth' }); // Scroll back up
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            languageSelectElement.value = initialLang;
            translatePage(initialLang); // Render initial language and questions

            quizForm.addEventListener('submit', handleSubmit);
            retryButton.addEventListener('click', handleRetry);
            languageSelectElement.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });
        });

    </script>

</body>
</html>