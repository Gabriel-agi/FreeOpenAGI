<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 3: Advanced Python Practice - Text!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --string-color: #ce9178; /* Orange-brown for strings */
            --operator-color: #d4d4d4; /* Light grey for operators */
            --number-color: #b5cea8;  /* Light green for numbers */
            --method-color: #9cdcfe; /* Light blue for methods */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            /* Colors matching news.html for consistency in switcher potentially */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { /* For navigation buttons */
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
        }

        /* --- Advanced Animations --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon {
            0% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
            50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); }
            100% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
        }
        @keyframes successGlow {
             0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
             50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); }
             100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
        }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); }
        }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            60% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearIncorrect {
             0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
             50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
             70% { transform: scale(0.9) rotate(-5deg); }
             100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearMissed { /* Reusing from Module 0 */
             0% { transform: scale(0.8) rotateY(90deg); opacity: 0; }
             100% { transform: scale(1) rotateY(0deg); opacity: 0.8; }
        }
        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.95);
        }


        /* --- Minimal Retractable Nav (with Language Switcher Integration) --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001;
            background-color: rgba(52, 58, 64, 0.75); color: var(--text-light);
            border: none; border-radius: var(--border-radius); padding: 8px 12px;
            cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark);
            border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem;
            opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right;
            pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-width: 200px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; } .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light); text-decoration: none;
            padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success);
            border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none;
            -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto;
            transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }
        /* --- End Minimal Retractable Nav --- */


        /* --- Practice Header --- */
        /* Using Teal/Info color for Module 3 header - kept consistent */
        .practice-header { background: linear-gradient(135deg, var(--info-color), #0d6775); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        /* Using slightly different icons for advanced? Or keep same? Keep same for now */
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; font-size: 3.5rem; opacity: 0.08;} /* Slightly smaller/dimmer */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; font-size: 4.5rem; opacity: 0.12; } /* Slightly larger/brighter */


        /* --- Practice Section Styling --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; } /* Spacing for icons in feedback */
        .action-button {
             display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none; /* For <a> tags styled as buttons */
        }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button.accent { background-color: var(--accent-color); color: var(--text-dark); } /* Yellow button */
        .action-button.accent:hover:not(:disabled) { background-color: #e0a800; }

        /* Code styling */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; }
        .code-string { color: var(--string-color); }
        .code-operator { color: var(--operator-color); font-weight: bold; }
        .code-number { color: var(--number-color); }
        .code-paren { color: #ffd700; }
        .code-function { color: #dcdcaa; }
        .code-comment { color: #6a9955; }
        .code-method { color: var(--method-color); } /* New style for methods */
        .code-fstring { color: var(--string-color); } /* Same as regular string for now */
        .code-fstring-brace { color: #ffd700; font-weight: bold; } /* Highlight braces in f-strings */

        /* --- Form Input Styling for Simulators --- */
        .sim-input-group { margin-bottom: 1rem; display: flex; flex-direction: column; }
        .sim-input-group label { font-weight: bold; margin-bottom: 0.5rem; color: var(--secondary-color); font-size: 0.95rem;}
        .sim-input-group input[type="text"],
        .sim-input-group input[type="number"] {
            padding: 0.6rem 0.8rem; border: 1px solid #ced4da; border-radius: var(--border-radius);
            font-family: var(--font-body); font-size: 1rem;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        .sim-input-group input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25); }
        /* Specific styling for multiple inputs per row */
        .input-row { display: flex; gap: 1rem; align-items: flex-end; }
        .input-row .sim-input-group { flex: 1; margin-bottom: 0; } /* Allow inputs to share space */
        @media (max-width: 576px) { .input-row { flex-direction: column; align-items: stretch; gap: 0.5rem; } .input-row .sim-input-group { margin-bottom: 1rem; } }


        /* --- Simulated Output Area --- */
        .sim-output-area { margin-top: 1.5rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        .sim-output-area .output-line { display: block; }
        .sim-output-area .output-value { color: var(--text-light); font-weight: bold; } /* For highlighting results */
        .sim-output-area .error-msg { color: var(--error-color); font-style: italic; } /* Style for errors in output */

        /* --- Activity Specific Styles --- */
        /* Activity 1: Slicing (uses .input-row) */
        /* Activity 2: Methods (Button group) */
        #string-methods .method-button-group { display: flex; gap: 1rem; justify-content: center; margin-top: 1rem; flex-wrap: wrap;}

        /* Activity 3: F-Strings */
        /* Uses standard input groups */

        /* --- Activity 4: Advanced Mini Missions --- */
        /* Reusing styles from practice page, no major changes needed */
        #advanced-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #advanced-mini-missions .mission-editor { /* Use a textarea for multi-line code */
            width: 100%; min-height: 100px; background-color: var(--background-dark);
            color: var(--text-light); border: 1px solid var(--secondary-color);
            border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font);
            font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem;
        }
        #advanced-mini-missions .mission-output { /* Reusing sim-output-area styling */
            margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444;
            border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color);
            font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word;
        }
        #advanced-mini-missions .mission-output .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }

        /* --- Final Section --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon {
            font-size: 4rem; color: var(--success-color); margin-bottom: 1rem;
            display: inline-block;
            opacity: 0; /* Start hidden for animation */
            animation: iconAppearCorrect 1s ease-out 0.5s forwards; /* Use icon animation */
        }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .sim-output-area { font-size: 1rem; }
            #advanced-mini-missions .mission-editor { font-size: 0.95rem; }
            #advanced-mini-missions .mission-output { font-size: 0.95rem; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            .sim-output-area { font-size: 0.9rem; }
            #advanced-mini-missions .mission-editor { min-height: 90px; font-size: 0.9rem;}
            #advanced-mini-missions .mission-output { font-size: 0.9rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
             .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
             .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
             .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
             .minimal-nav ul li a i.fas { margin-right: 8px; }
             #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
             #string-methods .method-button-group .action-button { width: auto; max-width: none; } /* Fix method buttons on mobile */
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** MODIFIED: Links for Advanced Practice Nav *** -->
            <li><a href="ctp-practice-3.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_practice">Standard Practice</span></a></li>
            <li><a href="ctp-video-3.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video">Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** MODIFIED: Links to new section IDs *** -->
            <li><a href="#string-slicing"><i class="fas fa-cut fa-fw"></i> <span data-translate="nav_slice">Slicing</span></a></li>
            <li><a href="#string-methods"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_methods">Methods</span></a></li>
            <li><a href="#f-strings"><i class="fas fa-magic fa-fw"></i> <span data-translate="nav_fstrings">F-Strings</span></a></li>
            <li><a href="#advanced-mini-missions"><i class="fas fa-space-shuttle fa-fw"></i> <span data-translate="nav_adv_missions">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- Keeping icons consistent with Module 3 theme -->
        <i class="fas fa-font header-icon icon1"></i>
        <i class="fas fa-terminal header-icon icon2"></i>
        <div class="container">
            <!-- *** MODIFIED: Title for Module 3 - Advanced *** -->
            <h1 data-translate="header_title">Module 3: Advanced Practice - Text Power</h1>
            <p data-translate="header_subtitle">Dive deeper into string manipulation with slicing, methods, and formatting!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: String Slicing ========= -->
        <section id="string-slicing" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-cut"></i> <span data-translate="slice_title">String Slicing</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="slice_desc">
                     Extract parts of a string (substrings) using slicing: <code class="code-font">string[start:end]</code>. The `start` index is included, but the `end` index is excluded. Omitting `start` defaults to 0, omitting `end` defaults to the string's length.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="sim-input-group">
                         <label for="slice-string-input" data-translate="slice_label_string">String to Slice:</label>
                         <input type="text" id="slice-string-input" class="code-font" value="Artificial Intelligence" data-translate-placeholder="slice_placeholder_string" placeholder="e.g., Artificial Intelligence">
                     </div>
                     <div class="input-row">
                         <div class="sim-input-group">
                             <label for="slice-start-input" data-translate="slice_label_start">Start Index (optional):</label>
                             <input type="number" id="slice-start-input" step="1" data-translate-placeholder="slice_placeholder_start" placeholder="e.g., 0">
                         </div>
                         <div class="sim-input-group">
                              <label for="slice-end-input" data-translate="slice_label_end">End Index (optional):</label>
                              <input type="number" id="slice-end-input" step="1" data-translate-placeholder="slice_placeholder_end" placeholder="e.g., 10">
                         </div>
                     </div>
                     <div class="text-center">
                          <button id="run-slice-btn" class="action-button" data-translate="button_run_slice">Get Slice</button>
                     </div>
                     <label for="slice-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="slice_output_label">Resulting Slice:</label>
                     <div id="slice-output" class="sim-output-area">
                         <span class="placeholder" data-translate="slice_output_placeholder">Slice appears here...</span>
                     </div>
                     <div id="slice-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: String Methods ========= -->
        <section id="string-methods" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-cogs"></i> <span data-translate="methods_title">String Methods</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="methods_desc">
                     Strings have built-in functions called <strong class="code-font code-method">methods</strong> (like <code class="code-font code-method">.upper()</code>, <code class="code-font code-method">.lower()</code>) that perform actions or return new strings. Note: Methods don't change the original string; they return a modified copy.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="sim-input-group">
                         <label for="method-string-input" data-translate="methods_label_string">Enter a String:</label>
                         <input type="text" id="method-string-input" class="code-font" value="Applied AI" data-translate-placeholder="methods_placeholder_string" placeholder="e.g., Applied AI">
                     </div>
                     <div class="text-center method-button-group">
                          <button id="run-upper-btn" class="action-button" data-translate="button_run_upper">Convert to UPPERCASE</button>
                          <button id="run-lower-btn" class="action-button secondary" data-translate="button_run_lower">Convert to lowercase</button>
                          <!-- Add more method buttons here if desired, e.g., find, replace -->
                     </div>
                     <label for="method-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="methods_output_label">Result:</label>
                     <div id="method-output" class="sim-output-area">
                         <span class="placeholder" data-translate="methods_output_placeholder">Result appears here...</span>
                     </div>
                     <div id="method-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: F-Strings (Formatted String Literals) ========= -->
        <section id="f-strings" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-magic"></i> <span data-translate="fstrings_title">F-Strings (Formatting)</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="fstrings_desc">
                    F-strings (formatted string literals), starting with <code class="code-font">f"..."</code>, provide a clean way to embed expressions and variables directly inside strings using curly braces <code class="code-font code-fstring-brace">{}</code>. This is essential for creating dynamic text output.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="input-row">
                         <div class="sim-input-group">
                             <label for="fstring-name-input" data-translate="fstrings_label_name">Enter a Name:</label>
                             <input type="text" id="fstring-name-input" value="AI Learner" data-translate-placeholder="fstrings_placeholder_name" placeholder="e.g., AI Learner">
                         </div>
                         <div class="sim-input-group">
                              <label for="fstring-module-input" data-translate="fstrings_label_module">Module Number:</label>
                              <input type="number" id="fstring-module-input" step="1" min="1" value="3" data-translate-placeholder="fstrings_placeholder_module" placeholder="e.g., 3">
                         </div>
                     </div>
                     <p style="margin-top: 1rem; margin-bottom: 0.5rem; font-size: 0.95rem; text-align:center;" data-translate="fstrings_code_example">Example f-string code: <code class="code-font">f"Hello, {name}! Welcome to Module {module_num}."</code></p>
                     <div class="text-center">
                          <button id="run-fstring-btn" class="action-button" data-translate="button_run_fstring">Generate Greeting</button>
                     </div>
                     <label for="fstring-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="fstrings_output_label">Formatted Output:</label>
                     <div id="fstring-output" class="sim-output-area">
                         <span class="placeholder" data-translate="fstrings_output_placeholder">Output appears here...</span>
                     </div>
                     <div id="fstring-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 4: Advanced Mini Missions ========= -->
        <section id="advanced-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-space-shuttle"></i> <span data-translate="adv_missions_title">Advanced String Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="adv_missions_desc">
                    Time to combine slicing, methods, and maybe even f-strings! Complete these tasks using `print()` in the editors.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1: Slice and Uppercase -->
                     <div class="mission" id="adv-mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission1_title">Mission 1: Slice and Shout</h4>
                         <p data-translate="adv_mission1_desc">Given the string `"python"`, write a command to `print` the first 3 characters (`"pyt"`) converted to uppercase (`"PYT"`).</p>
                         <textarea class="sim-editor mission-editor" rows="3" data-translate-placeholder="adv_mission1_placeholder" placeholder='my_word = "python"\nprint(my_word[0:3].upper())'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_adv_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"><span class="placeholder" data-translate="mission_output_placeholder">Output...</span></div>
                         <div id="adv-mission-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2: F-String Greeting -->
                     <div class="mission" id="adv-mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission2_title">Mission 2: Formatted Intro</h4>
                         <p data-translate="adv_mission2_desc">Create two variables: `subject = "AI"` and `level = 3`. Then, use an f-string with `print()` to output the exact text: `Subject: AI, Level: 3`.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission2_placeholder" placeholder='subject = "AI"\nlevel = 3\nprint(f"Subject: {subject}, Level: {level}")'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_adv_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"><span class="placeholder" data-translate="mission_output_placeholder">Output...</span></div>
                         <div id="adv-mission-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3: Slice from end and Lowercase -->
                     <div class="mission" id="adv-mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission3_title">Mission 3: Lower End Slice</h4>
                         <p data-translate="adv_mission3_desc">Given the string `"ADVANCED PYTHON"`, write a command to `print` the last 6 characters (`"PYTHON"`) converted to lowercase (`"python"`). Hint: Negative indices slice from the end.</p>
                         <textarea class="sim-editor mission-editor" rows="3" data-translate-placeholder="adv_mission3_placeholder" placeholder='text = "ADVANCED PYTHON"\nprint(text[-6:].lower())'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_adv_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"><span class="placeholder" data-translate="mission_output_placeholder">Output...</span></div>
                         <div id="adv-mission-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                     <i class="fas fa-graduation-cap"></i> <i class="fas fa-laptop-code"></i> <i class="fas fa-thumbs-up"></i>
                </div>
                <!-- *** MODIFIED: Text for Module 3 Advanced Completion *** -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 3 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Fantastic! You've mastered more complex string operations in Python. These skills are crucial for data processing in AI.<br>
                    Check out the <strong>Video Lesson</strong> or return to the <strong>Course Menu</strong>.
                </p>
                <div class="button-group">
                    <!-- *** MODIFIED: Links for Module 3 Advanced Completion *** -->
                    <a href="ctp-practice-3.html" class="action-button secondary fade-in delay-3"><i class="fas fa-pencil-alt"></i> <span data-translate="button_view_practice">Review Standard Practice</span></a>
                    <a href="ctp-video-3.html" class="action-button success fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_view_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 3: Advanced Python Practice - Text!",
            "nav_practice": "Standard Practice", "nav_video": "Video Lesson", "nav_menu": "Course Menu",
            "nav_slice": "Slicing", "nav_methods": "Methods", "nav_fstrings": "F-Strings", "nav_adv_missions": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 3: Advanced Practice - Text Power", "header_subtitle": "Dive deeper into string manipulation with slicing, methods, and formatting!",
            // Activity 1: String Slicing
            "slice_title": "String Slicing", "slice_desc": "Extract parts of a string (substrings) using slicing: <code class=\"code-font\">string[start:end]</code>. The `start` index is included, but the `end` index is excluded. Omitting `start` defaults to 0, omitting `end` defaults to the string's length.",
            "slice_label_string": "String to Slice:", "slice_placeholder_string": "e.g., Artificial Intelligence",
            "slice_label_start": "Start Index (optional):", "slice_placeholder_start": "e.g., 0",
            "slice_label_end": "End Index (optional):", "slice_placeholder_end": "e.g., 10",
            "button_run_slice": "Get Slice", "slice_output_label": "Resulting Slice:", "slice_output_placeholder": "Slice appears here...",
            "feedback_slice_success": "Slice extracted successfully!", "feedback_slice_no_string": "Please enter a string.", "feedback_slice_invalid_indices": "Indices must be numbers.", "feedback_slice_empty": "The resulting slice is an empty string.",
            // Activity 2: String Methods
            "methods_title": "String Methods", "methods_desc": "Strings have built-in functions called <strong class=\"code-font code-method\">methods</strong> (like <code class=\"code-font code-method\">.upper()</code>, <code class=\"code-font code-method\">.lower()</code>) that perform actions or return new strings. Note: Methods don't change the original string; they return a modified copy.",
            "methods_label_string": "Enter a String:", "methods_placeholder_string": "e.g., Applied AI",
            "button_run_upper": "Convert to UPPERCASE", "button_run_lower": "Convert to lowercase",
            "methods_output_label": "Result:", "methods_output_placeholder": "Result appears here...",
            "feedback_methods_success": "Method applied successfully!", "feedback_methods_no_string": "Please enter a string to apply the method.",
            // Activity 3: F-Strings
            "fstrings_title": "F-Strings (Formatting)", "fstrings_desc": "F-strings (formatted string literals), starting with <code class=\"code-font\">f\"...\"</code>, provide a clean way to embed expressions and variables directly inside strings using curly braces <code class=\"code-font code-fstring-brace\">{}</code>. This is essential for creating dynamic text output.",
            "fstrings_label_name": "Enter a Name:", "fstrings_placeholder_name": "e.g., AI Learner",
            "fstrings_label_module": "Module Number:", "fstrings_placeholder_module": "e.g., 3",
            "fstrings_code_example": "Example f-string code: <code class=\"code-font\">f\"Hello, {name}! Welcome to Module {module_num}.\"</code>",
            "button_run_fstring": "Generate Greeting", "fstrings_output_label": "Formatted Output:", "fstrings_output_placeholder": "Output appears here...",
            "feedback_fstring_success": "F-string generated!", "feedback_fstring_missing_input": "Please enter both a name and a valid module number.",
            // Activity 4: Advanced Mini Missions
            "adv_missions_title": "Advanced String Missions!", "adv_missions_desc": "Time to combine slicing, methods, and maybe even f-strings! Complete these tasks using `print()` in the editors.",
            "adv_mission1_title": "Mission 1: Slice and Shout", "adv_mission1_desc": "Given the string `\"python\"`, write a command to `print` the first 3 characters (`\"pyt\"`) converted to uppercase (`\"PYT\"`).", "adv_mission1_placeholder": "my_word = \"python\"\\nprint(my_word[0:3].upper())",
            "button_test_adv_mission_1": "Test Mission 1",
            "adv_mission2_title": "Mission 2: Formatted Intro", "adv_mission2_desc": "Create two variables: `subject = \"AI\"` and `level = 3`. Then, use an f-string with `print()` to output the exact text: `Subject: AI, Level: 3`.", "adv_mission2_placeholder": "subject = \"AI\"\\nlevel = 3\\nprint(f\"Subject: {subject}, Level: {level}\")",
            "button_test_adv_mission_2": "Test Mission 2",
            "adv_mission3_title": "Mission 3: Lower End Slice", "adv_mission3_desc": "Given the string `\"ADVANCED PYTHON\"`, write a command to `print` the last 6 characters (`\"PYTHON\"`) converted to lowercase (`\"python\"`). Hint: Negative indices slice from the end.", "adv_mission3_placeholder": "text = \"ADVANCED PYTHON\"\\nprint(text[-6:].lower())",
            "button_test_adv_mission_3": "Test Mission 3",
            "mission_output_placeholder": "Output...", // Reused key
            "feedback_mission_success": "Mission Accomplished!", "feedback_mission_syntax_error": "Check your code's syntax or logic.", // Reused keys
            "feedback_adv_mission1_hint": "Use slice `[0:3]` and method `.upper()`.",
            "feedback_adv_mission2_hint": "Define variables `subject` and `level`, then use `f\"...\"` with `{subject}` and `{level}`.",
            "feedback_adv_mission3_hint": "Use negative slice `[-6:]` and method `.lower()`.",
            "feedback_adv_missions_summary_all_done": "All {totalMissions} advanced missions complete! Excellent!", "feedback_adv_missions_summary_progress": "Completed {completedCount} of {totalMissions} advanced missions. Keep going!",
            // Completion Section
            "completion_title": "Module 3 Advanced Practice Complete!", "completion_desc": "Fantastic! You've mastered more complex string operations in Python. These skills are crucial for data processing in AI.<br>Check out the <strong>Video Lesson</strong> or return to the <strong>Course Menu</strong>.",
            "button_view_practice": "Review Standard Practice", "button_view_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu" // Reused key
        },
        pt: {
            "page_title": "Módulo 3: Prática Avançada Python - Texto!",
            "nav_practice": "Prática Padrão", "nav_video": "Vídeo Aula", "nav_menu": "Menu do Curso",
            "nav_slice": "Fatiamento", "nav_methods": "Métodos", "nav_fstrings": "F-Strings", "nav_adv_missions": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 3: Prática Avançada - Poder do Texto", "header_subtitle": "Aprofunde-se na manipulação de strings com fatiamento, métodos e formatação!",
            // Activity 1: String Slicing
            "slice_title": "Fatiamento de Strings (Slicing)", "slice_desc": "Extraia partes de uma string (substrings) usando fatiamento: <code class=\"code-font\">string[inicio:fim]</code>. O índice de `inicio` é incluído, mas o índice de `fim` é excluído. Omitir `inicio` assume 0, omitir `fim` assume o comprimento da string.",
            "slice_label_string": "String para Fatiar:", "slice_placeholder_string": "ex: Inteligência Artificial",
            "slice_label_start": "Índice Inicial (opcional):", "slice_placeholder_start": "ex: 0",
            "slice_label_end": "Índice Final (opcional):", "slice_placeholder_end": "ex: 12",
            "button_run_slice": "Obter Fatia", "slice_output_label": "Fatia Resultante:", "slice_output_placeholder": "Fatia aparece aqui...",
            "feedback_slice_success": "Fatia extraída com sucesso!", "feedback_slice_no_string": "Por favor, insira uma string.", "feedback_slice_invalid_indices": "Os índices devem ser números.", "feedback_slice_empty": "A fatia resultante é uma string vazia.",
            // Activity 2: String Methods
            "methods_title": "Métodos de String", "methods_desc": "Strings têm funções embutidas chamadas <strong class=\"code-font code-method\">métodos</strong> (como <code class=\"code-font code-method\">.upper()</code>, <code class=\"code-font code-method\">.lower()</code>) que realizam ações ou retornam novas strings. Nota: Métodos não alteram a string original; eles retornam uma cópia modificada.",
            "methods_label_string": "Insira uma String:", "methods_placeholder_string": "ex: IA Aplicada",
            "button_run_upper": "Converter para MAIÚSCULAS", "button_run_lower": "Converter para minúsculas",
            "methods_output_label": "Resultado:", "methods_output_placeholder": "Resultado aparece aqui...",
            "feedback_methods_success": "Método aplicado com sucesso!", "feedback_methods_no_string": "Por favor, insira uma string para aplicar o método.",
            // Activity 3: F-Strings
            "fstrings_title": "F-Strings (Formatação)", "fstrings_desc": "F-strings (literais de string formatadas), começando com <code class=\"code-font\">f\"...\"</code>, fornecem uma maneira limpa de incorporar expressões e variáveis diretamente dentro de strings usando chaves <code class=\"code-font code-fstring-brace\">{}</code>. Isso é essencial para criar saídas de texto dinâmicas.",
            "fstrings_label_name": "Insira um Nome:", "fstrings_placeholder_name": "ex: Estudante de IA",
            "fstrings_label_module": "Número do Módulo:", "fstrings_placeholder_module": "ex: 3",
            "fstrings_code_example": "Código f-string de exemplo: <code class=\"code-font\">f\"Olá, {nome}! Bem-vindo ao Módulo {num_modulo}.\"</code>",
            "button_run_fstring": "Gerar Saudação", "fstrings_output_label": "Saída Formatada:", "fstrings_output_placeholder": "Saída aparece aqui...",
            "feedback_fstring_success": "F-string gerada!", "feedback_fstring_missing_input": "Por favor, insira um nome e um número de módulo válido.",
            // Activity 4: Advanced Mini Missions
            "adv_missions_title": "Missões Avançadas de String!", "adv_missions_desc": "Hora de combinar fatiamento, métodos e talvez até f-strings! Complete estas tarefas usando `print()` nos editores.",
            "adv_mission1_title": "Missão 1: Fatie e Grite", "adv_mission1_desc": "Dada a string `\"python\"`, escreva um comando para `print`ar os primeiros 3 caracteres (`\"pyt\"`) convertidos para maiúsculas (`\"PYT\"`).", "adv_mission1_placeholder": "minha_palavra = \"python\"\\nprint(minha_palavra[0:3].upper())",
            "button_test_adv_mission_1": "Testar Missão 1",
            "adv_mission2_title": "Missão 2: Introdução Formatada", "adv_mission2_desc": "Crie duas variáveis: `assunto = \"IA\"` e `nivel = 3`. Então, use uma f-string com `print()` para exibir o texto exato: `Assunto: IA, Nivel: 3`.", "adv_mission2_placeholder": "assunto = \"IA\"\\nnivel = 3\\nprint(f\"Assunto: {assunto}, Nivel: {nivel}\")",
            "button_test_adv_mission_2": "Testar Missão 2",
            "adv_mission3_title": "Missão 3: Fatia Final Minúscula", "adv_mission3_desc": "Dada a string `\"PYTHON AVANCADO\"`, escreva um comando para `print`ar os últimos 6 caracteres (`\"ANCADO\"`) convertidos para minúsculas (`\"ancado\"`). Dica: Índices negativos fatiam do final.", "adv_mission3_placeholder": "texto = \"PYTHON AVANCADO\"\\nprint(texto[-6:].lower())", // Adjusted PT example text
            "button_test_adv_mission_3": "Testar Missão 3",
            "mission_output_placeholder": "Saída...",
            "feedback_mission_success": "Missão Cumprida!", "feedback_mission_syntax_error": "Verifique a sintaxe ou lógica do seu código.",
            "feedback_adv_mission1_hint": "Use a fatia `[0:3]` e o método `.upper()`.",
            "feedback_adv_mission2_hint": "Defina as variáveis `assunto` e `nivel`, depois use `f\"...\"` com `{assunto}` e `{nivel}`.",
            "feedback_adv_mission3_hint": "Use a fatia negativa `[-6:]` e o método `.lower()`.",
            "feedback_adv_missions_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Excelente!", "feedback_adv_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões avançadas. Continue!",
            // Completion Section
            "completion_title": "Prática Avançada do Módulo 3 Completa!", "completion_desc": "Fantástico! Você dominou operações mais complexas de string em Python. Essas habilidades são cruciais para o processamento de dados em IA.<br>Confira a <strong>Vídeo Aula</strong> ou retorne ao <strong>Menu do Curso</strong>.",
            "button_view_practice": "Revisar Prática Padrão", "button_view_video": "Assistir Vídeo Aula", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 3：高级 Python 练习 - 文本！",
            "nav_practice": "标准练习", "nav_video": "视频课程", "nav_menu": "课程菜单",
            "nav_slice": "切片", "nav_methods": "方法", "nav_fstrings": "F-字符串", "nav_adv_missions": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 3：高级练习 - 文本的力量", "header_subtitle": "通过切片、方法和格式化深入了解字符串操作！",
            // Activity 1: String Slicing
            "slice_title": "字符串切片", "slice_desc": "使用切片提取字符串的一部分（子字符串）：<code class=\"code-font\">string[start:end]</code>。包含 `start` 索引，但不包含 `end` 索引。省略 `start` 默认为 0，省略 `end` 默认为字符串长度。",
            "slice_label_string": "要切片的字符串：", "slice_placeholder_string": "例如：人工智能",
            "slice_label_start": "起始索引（可选）：", "slice_placeholder_start": "例如：0",
            "slice_label_end": "结束索引（可选）：", "slice_placeholder_end": "例如：4",
            "button_run_slice": "获取切片", "slice_output_label": "切片结果：", "slice_output_placeholder": "切片显示在此处...",
            "feedback_slice_success": "切片提取成功！", "feedback_slice_no_string": "请输入一个字符串。", "feedback_slice_invalid_indices": "索引必须是数字。", "feedback_slice_empty": "结果切片是一个空字符串。",
            // Activity 2: String Methods
            "methods_title": "字符串方法", "methods_desc": "字符串具有称为<strong class=\"code-font code-method\">方法</strong>的内置函数（例如 <code class=\"code-font code-method\">.upper()</code>、<code class=\"code-font code-method\">.lower()</code>），它们执行操作或返回新字符串。注意：方法不会更改原始字符串；它们返回修改后的副本。",
            "methods_label_string": "输入一个字符串：", "methods_placeholder_string": "例如：应用AI",
            "button_run_upper": "转换为大写", "button_run_lower": "转换为小写",
            "methods_output_label": "结果：", "methods_output_placeholder": "结果显示在此处...",
            "feedback_methods_success": "方法应用成功！", "feedback_methods_no_string": "请输入要应用方法的字符串。",
            // Activity 3: F-Strings
            "fstrings_title": "F-字符串（格式化）", "fstrings_desc": "F-字符串（格式化字符串字面量），以 <code class=\"code-font\">f\"...\"</code> 开头，提供了一种简洁的方式，使用花括号 <code class=\"code-font code-fstring-brace\">{}</code> 将表达式和变量直接嵌入字符串内部。这对于创建动态文本输出至关重要。",
            "fstrings_label_name": "输入一个名字：", "fstrings_placeholder_name": "例如：AI学习者",
            "fstrings_label_module": "模块编号：", "fstrings_placeholder_module": "例如：3",
            "fstrings_code_example": "F-字符串示例代码：<code class=\"code-font\">f\"你好, {name}! 欢迎来到模块 {module_num}。\"</code>",
            "button_run_fstring": "生成问候语", "fstrings_output_label": "格式化输出：", "fstrings_output_placeholder": "输出显示在此处...",
            "feedback_fstring_success": "F-字符串已生成！", "feedback_fstring_missing_input": "请输入名字和有效的模块编号。",
            // Activity 4: Advanced Mini Missions
            "adv_missions_title": "高级字符串任务！", "adv_missions_desc": "是时候结合切片、方法，甚至可能是 f-字符串了！使用编辑器中的 `print()` 完成这些任务。",
            "adv_mission1_title": "任务 1：切片并大写", "adv_mission1_desc": "给定字符串 `\"python\"`，编写一条命令 `print` 其前 3 个字符（`\"pyt\"`）转换为大写（`\"PYT\"`）。", "adv_mission1_placeholder": "my_word = \"python\"\\nprint(my_word[0:3].upper())",
            "button_test_adv_mission_1": "测试任务 1",
            "adv_mission2_title": "任务 2：格式化介绍", "adv_mission2_desc": "创建两个变量：`subject = \"AI\"` 和 `level = 3`。然后，使用 f-字符串和 `print()` 输出确切的文本：`Subject: AI, Level: 3`。", "adv_mission2_placeholder": "subject = \"AI\"\\nlevel = 3\\nprint(f\"Subject: {subject}, Level: {level}\")",
            "button_test_adv_mission_2": "测试任务 2",
            "adv_mission3_title": "任务 3：小写末尾切片", "adv_mission3_desc": "给定字符串 `\"ADVANCED PYTHON\"`，编写一条命令 `print` 其最后 6 个字符（`\"PYTHON\"`）转换为小写（`\"python\"`）。提示：负索引从末尾开始切片。", "adv_mission3_placeholder": "text = \"ADVANCED PYTHON\"\\nprint(text[-6:].lower())",
            "button_test_adv_mission_3": "测试任务 3",
            "mission_output_placeholder": "输出...",
            "feedback_mission_success": "任务完成！", "feedback_mission_syntax_error": "检查您的代码语法或逻辑。",
            "feedback_adv_mission1_hint": "使用切片 `[0:3]` 和方法 `.upper()`。",
            "feedback_adv_mission2_hint": "定义变量 `subject` 和 `level`，然后使用带 `{subject}` 和 `{level}` 的 `f\"...\"`。",
            "feedback_adv_mission3_hint": "使用负数切片 `[-6:]` 和方法 `.lower()`。",
            "feedback_adv_missions_summary_all_done": "所有 {totalMissions} 个高级任务已完成！太棒了！", "feedback_adv_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个高级任务。继续努力！",
            // Completion Section
            "completion_title": "模块 3 高级练习完成！", "completion_desc": "太棒了！您已经掌握了 Python 中更复杂的字符串操作。这些技能对于 AI 中的数据处理至关重要。<br>查看<strong>视频课程</strong>或返回<strong>课程菜单</strong>。",
            "button_view_practice": "复习标准练习", "button_view_video": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };

    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Identical to previous) ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
         }
        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en';
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             // Reset/Update language-dependent NEW activities
             if (document.getElementById('string-slicing')) resetSlicingSim();
             if (document.getElementById('string-methods')) resetMethodsSim();
             if (document.getElementById('f-strings')) resetFStringsSim();
             if (document.getElementById('advanced-mini-missions') && typeof updateAdvancedMissionSummary === 'function') {
                 updateAdvancedMissionSummary(); // Update summary text for new missions
             }
        }
        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }
        function translatePage(lang) {
             if (!translations[lang]) lang = 'en';
             document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                if (el.tagName === 'TITLE') { document.title = translation; }
                else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Placeholders handled below */ }
                else if (el.tagName === 'OPTION') { el.textContent = translation; }
                else {
                    // Use innerHTML only if the translation contains HTML tags
                    if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                    else { el.textContent = translation; }
                }
             });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                const translation = getTranslation(key, lang);
                el.setAttribute('placeholder', translation);
            });
            document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 const translation = getTranslation(key, lang);
                 el.setAttribute('title', translation);
            });
        }
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Identical to previous) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => {
                event.stopPropagation(); body.classList.toggle('nav-active');
                navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
             });
            document.addEventListener('click', (event) => {
                if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) {
                    body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }
             });
            navPanel.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
            document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Identical to previous) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => { setLanguage(e.target.value); });
        }

        // --- Helper Function for Feedback (Identical to previous) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) {
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
            // Use innerHTML only if the translation contains HTML tags
            if (translatedMessage.includes('<') && translatedMessage.includes('>')) { feedbackEl.innerHTML = translatedMessage; }
            else { feedbackEl.textContent = translatedMessage; }
            feedbackEl.className = 'feedback-message'; feedbackEl.classList.add('visible', type);
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
            else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
        }

        // --- Helper: Clear output area and show placeholder ---
        function resetOutputArea(outputAreaElement, placeholderKey) {
            if (!outputAreaElement) return;
            outputAreaElement.innerHTML = '';
            const currentLang = getStoredLanguage();
            const placeholderSpan = document.createElement('span');
            placeholderSpan.className = 'placeholder';
            placeholderSpan.textContent = getTranslation(placeholderKey, currentLang);
            outputAreaElement.appendChild(placeholderSpan);
        }

        // --- Activity 1: String Slicing Simulator ---
        const slicingSection = document.getElementById('string-slicing');
        if (slicingSection) {
            const stringInput = document.getElementById('slice-string-input');
            const startInput = document.getElementById('slice-start-input');
            const endInput = document.getElementById('slice-end-input');
            const runBtn = document.getElementById('run-slice-btn');
            const outputArea = document.getElementById('slice-output');
            const feedbackDivId = 'slice-feedback';

            function resetSlicingSim() {
                 if (stringInput) stringInput.value = 'Artificial Intelligence'; // Default
                 if (startInput) startInput.value = '';
                 if (endInput) endInput.value = '';
                 resetOutputArea(outputArea, 'slice_output_placeholder');
                 const feedbackEl = document.getElementById(feedbackDivId);
                 if (feedbackEl) feedbackEl.classList.remove('visible');
            }

            runBtn.addEventListener('click', () => {
                 const str = stringInput.value;
                 let start = startInput.value === '' ? null : parseInt(startInput.value, 10);
                 let end = endInput.value === '' ? null : parseInt(endInput.value, 10);

                 resetOutputArea(outputArea, 'slice_output_placeholder'); // Clear previous output

                 if (str === '') {
                     showFeedback(feedbackDivId, 'feedback_slice_no_string', 'incorrect');
                     return;
                 }
                 if ((startInput.value !== '' && isNaN(start)) || (endInput.value !== '' && isNaN(end))) {
                      showFeedback(feedbackDivId, 'feedback_slice_invalid_indices', 'incorrect');
                      return;
                 }

                 try {
                     // JavaScript slice handles null correctly for defaults
                     const result = str.slice(start, end); // Use null if empty, JS slice handles it

                     outputArea.innerHTML = ''; // Clear placeholder
                     const outputLine = document.createElement('span');
                     outputLine.classList.add('output-line', 'output-value');
                     outputLine.textContent = `> "${result}"`; // Show result in quotes
                     outputArea.appendChild(outputLine);

                     if (result === '') {
                        showFeedback(feedbackDivId, 'feedback_slice_empty', 'info');
                     } else {
                        showFeedback(feedbackDivId, 'feedback_slice_success', 'correct');
                     }
                 } catch (e) { // Should not happen with slice but good practice
                     console.error("Slicing error:", e);
                     showFeedback(feedbackDivId, 'feedback_mission_syntax_error', 'incorrect');
                     outputArea.innerHTML = `<span class="error-msg">Error during slicing.</span>`;
                 }
             });
             resetSlicingSim(); // Initial setup
        }

        // --- Activity 2: String Methods Simulator ---
        const methodsSection = document.getElementById('string-methods');
        if (methodsSection) {
            const stringInput = document.getElementById('method-string-input');
            const upperBtn = document.getElementById('run-upper-btn');
            const lowerBtn = document.getElementById('run-lower-btn');
            const outputArea = document.getElementById('method-output');
            const feedbackDivId = 'method-feedback';

             function resetMethodsSim() {
                 if (stringInput) stringInput.value = 'Applied AI';
                 resetOutputArea(outputArea, 'methods_output_placeholder');
                 const feedbackEl = document.getElementById(feedbackDivId);
                 if (feedbackEl) feedbackEl.classList.remove('visible');
            }

            function applyMethod(method) {
                 const str = stringInput.value;
                 resetOutputArea(outputArea, 'methods_output_placeholder'); // Clear previous

                 if (str === '') {
                     showFeedback(feedbackDivId, 'feedback_methods_no_string', 'incorrect');
                     return;
                 }

                 let result = '';
                 try {
                    if (method === 'upper') {
                        result = str.toUpperCase();
                    } else if (method === 'lower') {
                        result = str.toLowerCase();
                    }
                    // Add other methods here with else if

                    outputArea.innerHTML = ''; // Clear placeholder
                    const outputLine = document.createElement('span');
                    outputLine.classList.add('output-line', 'output-value');
                    outputLine.textContent = `> "${result}"`; // Show result in quotes
                    outputArea.appendChild(outputLine);
                    showFeedback(feedbackDivId, 'feedback_methods_success', 'correct');

                 } catch (e) {
                     console.error("Method error:", e);
                     showFeedback(feedbackDivId, 'feedback_mission_syntax_error', 'incorrect');
                     outputArea.innerHTML = `<span class="error-msg">Error applying method.</span>`;
                 }
            }

            upperBtn.addEventListener('click', () => applyMethod('upper'));
            lowerBtn.addEventListener('click', () => applyMethod('lower'));

            resetMethodsSim(); // Initial setup
        }

         // --- Activity 3: F-Strings Simulator ---
        const fstringsSection = document.getElementById('f-strings');
        if (fstringsSection) {
            const nameInput = document.getElementById('fstring-name-input');
            const moduleInput = document.getElementById('fstring-module-input');
            const runBtn = document.getElementById('run-fstring-btn');
            const outputArea = document.getElementById('fstring-output');
            const feedbackDivId = 'fstring-feedback';

            function resetFStringsSim() {
                 if (nameInput) nameInput.value = 'AI Learner';
                 if (moduleInput) moduleInput.value = '3';
                 resetOutputArea(outputArea, 'fstrings_output_placeholder');
                 const feedbackEl = document.getElementById(feedbackDivId);
                 if (feedbackEl) feedbackEl.classList.remove('visible');
            }

            runBtn.addEventListener('click', () => {
                 const name = nameInput.value.trim();
                 const moduleNum = moduleInput.value.trim(); // Keep as string for check
                 const moduleInt = parseInt(moduleNum, 10);

                 resetOutputArea(outputArea, 'fstrings_output_placeholder');

                 if (name === '' || moduleNum === '' || isNaN(moduleInt) || moduleInt < 1) {
                     showFeedback(feedbackDivId, 'feedback_fstring_missing_input', 'incorrect');
                     return;
                 }

                 try {
                     // Simulate f-string generation in JavaScript
                     const result = `Hello, ${name}! Welcome to Module ${moduleInt}.`;

                     outputArea.innerHTML = ''; // Clear placeholder
                     const outputLine = document.createElement('span');
                     outputLine.classList.add('output-line', 'output-value');
                     outputLine.textContent = `> "${result}"`; // Show result in quotes
                     outputArea.appendChild(outputLine);
                     showFeedback(feedbackDivId, 'feedback_fstring_success', 'correct');

                 } catch (e) {
                     console.error("F-string sim error:", e);
                     showFeedback(feedbackDivId, 'feedback_mission_syntax_error', 'incorrect');
                     outputArea.innerHTML = `<span class="error-msg">Error generating output.</span>`;
                 }
             });
            resetFStringsSim(); // Initial setup
        }

        // --- Activity 4: Advanced Mini Missions ---
        const advMissionsSection = document.getElementById('advanced-mini-missions');
        let updateAdvancedMissionSummary; // Define function scope
        if (advMissionsSection) {
            const missionRunButtons = advMissionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('adv-missions-summary-feedback');
            const allMissions = advMissionsSection.querySelectorAll('.mission');
            const totalMissions = allMissions.length;

            updateAdvancedMissionSummary = function() { // Assign function
                 const completedMissionsCount = advMissionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_adv_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_adv_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible', 'correct', 'incorrect', 'info');
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`adv-mission-${missionId}`); // Adjusted ID prefix
                    if (!missionDiv) return;
                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `adv-mission-feedback-${missionId}`; // Adjusted ID prefix
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();
                    const currentLang = getStoredLanguage();

                    resetOutputArea(outputArea, 'mission_output_placeholder'); // Reset output
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error'; // Default error
                    let feedbackType = 'incorrect';
                    let expectedOutput = [];
                    let simulatedOutput = []; // Store simulated output lines

                    /* NEW Validation Logic for Advanced Missions */
                    try {
                        // Basic simulation: Look for expected print patterns
                        const lines = code.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));

                        // Very simplified simulation - check final print() or specific patterns
                        const lastPrintLine = lines.filter(l => l.startsWith('print(')).pop(); // Get the last print statement

                        if (missionId === '1') {
                             expectedOutput = ["PYT"];
                             // Check common ways: variable assignment then print, or direct print
                             const directMatch = lastPrintLine?.match(/^print\s*\(\s*(["'])python(["'])\[0:3\]\.upper\(\s*\)\s*\)/);
                             const varMatch = code.includes('my_word = "python"') && lastPrintLine?.match(/^print\s*\(\s*my_word\[0:3\]\.upper\(\s*\)\s*\)/);
                             if(directMatch || varMatch) simulatedOutput.push("PYT");
                             else feedbackMessageKey = 'feedback_adv_mission1_hint';
                        } else if (missionId === '2') {
                            expectedOutput = ["Subject: AI, Level: 3"];
                            // Check variable definition and f-string print
                            const hasSubjectVar = code.match(/subject\s*=\s*(["'])AI(["'])/);
                            const hasLevelVar = code.match(/level\s*=\s*3/);
                            // Allow slight variations in spacing within f-string
                            const fstringMatch = lastPrintLine?.match(/^print\s*\(\s*f(["'])Subject:\s*{subject},\s*Level:\s*{level}(["'])\s*\)/);
                            if(hasSubjectVar && hasLevelVar && fstringMatch) simulatedOutput.push("Subject: AI, Level: 3");
                             else feedbackMessageKey = 'feedback_adv_mission2_hint';
                        } else if (missionId === '3') {
                            expectedOutput = ["python"];
                            const directMatch = lastPrintLine?.match(/^print\s*\(\s*(["'])ADVANCED PYTHON(["'])\[-6:\]\.lower\(\s*\)\s*\)/);
                            const varMatch = code.includes('text = "ADVANCED PYTHON"') && lastPrintLine?.match(/^print\s*\(\s*text\[-6:\]\.lower\(\s*\)\s*\)/);
                             if(directMatch || varMatch) simulatedOutput.push("python");
                             else feedbackMessageKey = 'feedback_adv_mission3_hint';
                        }

                        // Compare final simulated output to expected
                        if (simulatedOutput.length === expectedOutput.length &&
                            simulatedOutput.every((val, index) => val === expectedOutput[index]))
                        {
                             success = true;
                             outputArea.innerHTML = simulatedOutput.map(line => `<span class="output-line output-value">> ${line}</span>`).join('');
                        } else {
                            // If output wasn't produced but no specific hint triggered, use generic error
                            if (feedbackMessageKey === 'feedback_mission_syntax_error' && simulatedOutput.length === 0 && code !== '') {
                                 // Keep the default syntax error hint if simulation didn't produce anything specific
                            }
                        }

                    } catch (error) {
                        console.error("Adv Mission validation error:", error);
                        feedbackMessageKey = 'feedback_mission_syntax_error';
                    }
                    /* End Validation */

                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                        // Only show hint if the feedback key was changed from the default syntax error
                        if(feedbackMessageKey !== 'feedback_mission_syntax_error') {
                             showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                        } else {
                             // Otherwise show the generic syntax/logic error
                             showFeedback(feedbackDivId, 'feedback_mission_syntax_error', 'incorrect');
                        }
                    }
                     // Only show success message explicitly if successful
                     if(success) {
                           showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                     }

                    updateAdvancedMissionSummary();
                });
            });

             // Initial placeholder text setup for advanced missions
            allMissions.forEach(mission => {
                 const outputArea = mission.querySelector('.mission-output');
                 resetOutputArea(outputArea, 'mission_output_placeholder'); // Use helper
                 const feedbackDiv = mission.querySelector('.mission-feedback');
                 if(feedbackDiv) feedbackDiv.classList.remove('visible');
             });
            updateAdvancedMissionSummary(); // Initial call
        }

        // --- Fade-in animations on scroll (Identical to previous) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return; // Already visible
                 const rect = el.getBoundingClientRect();
                 // Adjust trigger point slightly if needed
                 if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                     el.style.opacity = '1';
                     el.style.transform = 'translateY(0)';
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST, which also calls NEW activity resets/setups
        animateOnScroll(); // Trigger initial animation check

    }); // End DOMContentLoaded
    </script>

</body>
</html>