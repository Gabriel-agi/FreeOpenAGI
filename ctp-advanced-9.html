<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title_adv">Module 9: Advanced Python Practice!</title>
    <!-- Fonts & Icons (Same as practice) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff; /* Keeping same theme */
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --logic-and-color: #e85d04; /* Orange for AND */
            --logic-or-color: #9d4edd;  /* Purple for OR */
            --logic-not-color: #00b4d8; /* Cyan for NOT */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
        .flex-center { display: flex; justify-content: center; align-items: center; gap: 1rem;}

        /* --- Advanced Animations --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { /* Keeping same pulse */
            0% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
            50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); }
            100% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
        }
        @keyframes successGlow {
             0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
             50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); }
             100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
        }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); }
        }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            60% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearIncorrect {
             0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
             50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
             70% { transform: scale(0.9) rotate(-5deg); }
             100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.95);
        }


        /* --- Minimal Retractable Nav (with Language Switcher Integration) --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001;
            background-color: rgba(52, 58, 64, 0.75); color: var(--text-light);
            border: none; border-radius: var(--border-radius); padding: 8px 12px;
            cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000;
            background-color: var(--background-dark); border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0;
            transform: translateY(-15px) scale(0.95); transform-origin: top right;
            pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-width: 200px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light);
            text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white;
            border: 1px solid var(--nav-success); border-radius: 5px;
            padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto;
            transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }
        /* --- End Minimal Retractable Nav --- */


        /* --- Practice Header --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); } /* Same header style */
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; }
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; }

        /* --- Practice Section Styling --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(even) { background-color: var(--background-light); } /* Alternating bg */
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Reused) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease, padding var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; padding: 0.8rem 1rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button {
             display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none;
        }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button.error { background-color: var(--error-color); } /* Added for incorrect prediction */
        .action-button.error:hover:not(:disabled) { background-color: #c82333; }
        /* Code styling (Reused) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; text-align: left; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; } .code-boolean { color: #569cd6; font-weight: bold; } .code-operator { color: #b5cea8; } .code-number { color: #b5cea8; } .code-variable { color: #9cdcfe; }


        /* --- Activity: Advanced Truth Evaluator --- */
        /* Using same styles as practice, just new content */
        #truth-evaluator-adv .expression-display { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; font-family: var(--code-font); font-size: 1.3rem; text-align: center; line-height: 1.6;}
        #truth-evaluator-adv .eval-choices button { font-size: 1.1rem; padding: 0.8rem 2rem; min-width: 100px; }
        #truth-evaluator-adv #adv-evaluator-status { margin-top: 1.5rem; font-weight: bold; color: var(--secondary-color); }

        /* --- Activity: Complex Scenario to Code --- */
        /* Using same styles as practice, just new content */
        #scenario-code-adv .scenario-text { background-color: var(--background-medium); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; border-left: 5px solid var(--info-color); font-size: 1.1rem; }
        #scenario-code-adv .scenario-editor { width: 100%; min-height: 80px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #scenario-code-adv .simulated-condition { margin-top: 1rem; font-family: var(--code-font); font-size: 1rem; background-color: #1a1a1a; color: var(--accent-color); padding: 0.5rem 1rem; border-radius: 4px; display: inline-block; min-height: 1.5em; }

        /* --- Activity: Predict Complex Output --- */
        /* Using same styles as practice, just new content */
        #predict-output-adv .prediction-choices button { margin: 5px; font-size: 1rem; }
        #predict-output-adv .prediction-status { margin-top: 1.5rem; font-weight: bold; color: var(--secondary-color); }

        /* --- Activity: Precedence Challenge --- */
        #precedence-challenge .expression-display { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; font-family: var(--code-font); font-size: 1.3rem; text-align: center; line-height: 1.6;}
        #precedence-challenge .eval-choices button { font-size: 1.1rem; padding: 0.8rem 2rem; min-width: 100px; }
        #precedence-challenge #precedence-status { margin-top: 1.5rem; font-weight: bold; color: var(--secondary-color); }

        /* --- Activity: Advanced Mini Missions --- */
        /* **** ID UPDATED **** */
        #mini-missions-9-adv .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #mini-missions-9-adv .mission-editor { width: 100%; min-height: 140px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #mini-missions-9-adv .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; text-align: left; }
        #mini-missions-9-adv .mission-output .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }

        /* --- Final Section --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon {
            font-size: 4rem; color: var(--success-color); margin-bottom: 1rem;
            display: inline-block;
            opacity: 0;
            animation: iconAppearCorrect 1s ease-out 0.5s forwards;
        }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Reused, may need minor tweaks if layout changes significantly) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            /* Adjust evaluator font size for potentially longer expressions */
            #truth-evaluator-adv .expression-display, #precedence-challenge .expression-display { font-size: 1.1rem; padding: 1rem; }
            #truth-evaluator-adv .eval-choices button, #precedence-challenge .eval-choices button { font-size: 1rem; padding: 0.7rem 1.5rem; }
            .button-group { flex-direction: column; align-items: center; }
             .minimal-nav { min-width: 180px; }
             .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
             #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
             #truth-evaluator-adv .expression-display, #precedence-challenge .expression-display { font-size: 1rem; }
             #truth-evaluator-adv .eval-choices button, #precedence-challenge .eval-choices button { font-size: 0.9rem; padding: 0.6rem 1rem; min-width: 80px; }
             #scenario-code-adv .scenario-editor { font-size: 0.9rem; min-height: 70px;}
             #predict-output-adv .code-block { font-size: 0.9rem; padding: 1rem; }
             #predict-output-adv .prediction-choices button { font-size: 0.9rem; margin: 3px; }
             #mini-missions-9-adv .mission-editor { min-height: 120px; font-size: 0.95rem;} /* Slightly taller for complex code */
             #mini-missions-9-adv .mission-output { font-size: 0.95rem;}
             .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
             /* Adjust Nav */
              .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
              .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
              .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
              .minimal-nav ul li a i.fas { margin-right: 8px; }
              #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }

    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- **** UPDATED FOR MODULE 9 ADVANCED **** -->
            <li><a href="ctp-practice-9.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_practice_std">View Practice</span></a></li>
            <li><a href="ctp-video-9.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video">Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- Links to sections within this advanced page -->
            <li><a href="#truth-evaluator-adv"><i class="fas fa-check-double fa-fw"></i> <span data-translate="nav_evaluator_adv">Evaluator</span></a></li>
            <li><a href="#scenario-code-adv"><i class="fas fa-comments fa-fw"></i> <span data-translate="nav_scenario_adv">Scenario</span></a></li>
            <li><a href="#predict-output-adv"><i class="fas fa-eye fa-fw"></i> <span data-translate="nav_predict_adv">Predict</span></a></li>
            <li><a href="#precedence-challenge"><i class="fas fa-sort-amount-down fa-fw"></i> <span data-translate="nav_precedence">Precedence</span></a></li>
            <li><a href="#mini-missions-9-adv"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_missions_adv">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- Using same icons for consistency -->
        <i class="fas fa-project-diagram header-icon icon1"></i>
        <i class="fas fa-laptop-code header-icon icon2"></i>
        <div class="container">
            <!-- **** UPDATED FOR MODULE 9 ADVANCED **** -->
            <h1 data-translate="header_title_adv">Module 9: Advanced Practice</h1>
            <p data-translate="header_subtitle_adv">Challenge your logic skills with more complex conditions!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>

        <!-- ========= Activity 1: Advanced Truth Evaluator ========= -->
        <section id="truth-evaluator-adv" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-check-double"></i> <span data-translate="evaluator_title_adv">Advanced Truth Evaluator</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="evaluator_desc_adv">
                     Time for trickier expressions! Evaluate these combined logical operations, paying attention to parentheses and operator precedence.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                    <div id="adv-evaluator-expression-display" class="expression-display">
                        <!-- Expression loaded by JS -->
                        <span class="placeholder" data-translate="evaluator_loading_adv">Loading complex expression...</span>
                    </div>
                    <div class="eval-choices flex-center">
                        <button id="adv-eval-choice-true" class="action-button success" data-choice="true">True</button>
                        <button id="adv-eval-choice-false" class="action-button error" data-choice="false">False</button>
                    </div>
                    <div class="text-center">
                        <button id="adv-next-expression-btn" class="action-button secondary hidden" data-translate="button_next_expression_adv">Next Expression</button>
                    </div>
                    <p id="adv-evaluator-status" class="text-center"></p>
                    <div id="adv-evaluator-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 2: Complex Scenario to Code ========= -->
        <section id="scenario-code-adv" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-comments"></i> <span data-translate="scenario_title_adv">Complex Scenario to Code</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="scenario_desc_adv">
                     Translate these more detailed scenarios into Python `if` conditions. Focus on grouping conditions correctly with parentheses when needed. Remember decomposition!
                 </p>
                 <div class="interactive-area fade-in delay-2">
                    <div id="adv-scenario-text-display" class="scenario-text">
                        <!-- Scenario loaded by JS -->
                        <span class="placeholder" data-translate="scenario_loading_adv">Loading complex scenario...</span>
                    </div>
                    <label for="adv-scenario-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="scenario_editor_label_adv">Your `if` Condition:</label>
                    <textarea id="adv-scenario-editor-input" class="scenario-editor" rows="3" data-translate-placeholder="scenario_editor_placeholder_adv" placeholder="e.g., is_admin or (is_editor and not is_locked)"></textarea>
                    <div class="text-center">
                         <button id="adv-check-scenario-btn" class="action-button" data-translate="button_check_condition_adv">Check Condition</button>
                         <button id="adv-next-scenario-btn" class="action-button secondary hidden" data-translate="button_next_scenario_adv">Next Scenario</button>
                    </div>
                    <div class="text-center" style="margin-top: 1rem;">
                        <span style="font-weight:bold;" data-translate="scenario_output_label_adv">Simulated Check:</span> <code class="simulated-condition" id="adv-scenario-output">...</code>
                    </div>
                    <div id="adv-scenario-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Predict Complex Output ========= -->
        <section id="predict-output-adv" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-eye"></i> <span data-translate="predict_title_adv">Predict Complex Output</span></h2>
                <p class="section-description fade-in delay-1" data-translate="predict_desc_adv">
                    Analyze these Python snippets featuring more complex logical conditions. Predict the final printed output. Trace the logic flow carefully.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="adv-predict-code-display" class="code-block">
                        <!-- Code snippet loaded by JS -->
                        <span class="placeholder" data-translate="predict_loading_adv">Loading complex code...</span>
                    </div>
                    <label style="font-weight: bold; display:block; margin-bottom: 8px; text-align: center;" data-translate="predict_question_adv">What will be printed?</label>
                    <div id="adv-prediction-choices" class="prediction-choices text-center">
                        <!-- Buttons loaded by JS -->
                    </div>
                    <div class="text-center">
                         <button id="adv-next-predict-btn" class="action-button secondary hidden" data-translate="button_next_snippet_adv">Next Snippet</button>
                    </div>
                    <p id="adv-prediction-status" class="text-center"></p>
                    <div id="adv-predict-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 4: Precedence Challenge ========= -->
        <section id="precedence-challenge" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-sort-amount-down"></i> <span data-translate="precedence_title">Precedence Challenge</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="precedence_desc">
                     Python evaluates logical operators in a specific order: `not`, then `and`, then `or`. Evaluate these expressions without parentheses to test your understanding of this precedence.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                    <div id="precedence-expression-display" class="expression-display">
                        <!-- Expression loaded by JS -->
                        <span class="placeholder" data-translate="precedence_loading">Loading precedence expression...</span>
                    </div>
                    <div class="eval-choices flex-center">
                        <button id="precedence-choice-true" class="action-button success" data-choice="true">True</button>
                        <button id="precedence-choice-false" class="action-button error" data-choice="false">False</button>
                    </div>
                    <div class="text-center">
                        <button id="next-precedence-btn" class="action-button secondary hidden" data-translate="button_next_precedence">Next Challenge</button>
                    </div>
                    <p id="precedence-status" class="text-center"></p>
                    <div id="precedence-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 5: Advanced Mini Missions ========= -->
         <!-- **** ID UPDATED **** -->
        <section id="mini-missions-9-adv" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="missions_title_adv">Advanced Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_desc_adv">
                     Apply your skills! Write Python code to solve these challenges, using combined logical operators and potentially parentheses for clarity and correctness.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission Adv 1 -->
                     <div class="mission" id="mission-adv-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv1_title">Adv. Mission 1: Combined Approval</h4>
                         <p data-translate="mission_adv1_desc">Variables: `score = 75`, `attended_workshop = False`, `extra_credit = 5`. Print "Approved" if the score is above 70 <strong class="highlight">AND</strong> (<strong class="highlight">EITHER</strong> `attended_workshop` is True <strong class="highlight">OR</strong> `extra_credit` is greater than 0).</p>
                         <textarea class="sim-editor mission-editor" rows="6" data-translate-placeholder="mission_adv1_placeholder" placeholder='score = 75\nattended_workshop = False\nextra_credit = 5\n\nif ... :\n    print("Approved")'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-1" data-translate="button_test_mission_adv_1">Test Adv. Mission 1</button> </div>
                         <div class="mission-output"><span class="placeholder" data-translate="missions_output_placeholder_adv">Output appears here...</span></div>
                         <div id="mission-feedback-adv-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission Adv 2 -->
                     <div class="mission" id="mission-adv-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv2_title">Adv. Mission 2: Access Control</h4>
                         <p data-translate="mission_adv2_desc">Variables: `user_level = "guest"`, `is_verified = True`, `account_active = True`. Print "Full Access" if `account_active` is True <strong class="highlight">AND</strong> (<strong class="highlight">EITHER</strong> `user_level` is "admin" <strong class="highlight">OR</strong> (`user_level` is "editor" <strong class="highlight">AND</strong> `is_verified` is True)). Otherwise, print "Limited Access".</p>
                         <textarea class="sim-editor mission-editor" rows="7" data-translate-placeholder="mission_adv2_placeholder" placeholder='user_level = "guest"\nis_verified = True\naccount_active = True\n\nif ... :\n    print("Full Access")\nelse:\n    print("Limited Access")'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-2" data-translate="button_test_mission_adv_2">Test Adv. Mission 2</button> </div>
                         <div class="mission-output"><span class="placeholder" data-translate="missions_output_placeholder_adv">Output appears here...</span></div>
                         <div id="mission-feedback-adv-2" class="feedback-message mission-feedback"></div>
                     </div>
                      <!-- Mission Adv 3 -->
                     <div class="mission" id="mission-adv-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv3_title">Adv. Mission 3: Eligibility Check</h4>
                         <p data-translate="mission_adv3_desc">Variables: `age = 25`, `is_citizen = True`, `has_felony = False`. Print "Eligible to Vote" if the person is 18 or older, <strong class="highlight">AND</strong> is a citizen, <strong class="highlight">AND</strong> does <strong class="highlight">NOT</strong> have a felony.</p>
                         <textarea class="sim-editor mission-editor" rows="6" data-translate-placeholder="mission_adv3_placeholder" placeholder='age = 25\nis_citizen = True\nhas_felony = False\n\nif ... :\n    print("Eligible to Vote")'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-3" data-translate="button_test_mission_adv_3">Test Adv. Mission 3</button> </div>
                         <div class="mission-output"><span class="placeholder" data-translate="missions_output_placeholder_adv">Output appears here...</span></div>
                         <div id="mission-feedback-adv-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                    <!-- Slightly different icons for variety -->
                    <i class="fas fa-graduation-cap"></i> <i class="fas fa-cogs"></i> <i class="fas fa-check"></i>
                </div>
                 <!-- **** UPDATED FOR MODULE 9 ADVANCED **** -->
                <h2 class="fade-in delay-1" data-translate="completion_title_adv">Module 9 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc_adv">
                    Fantastic job navigating complex logic! You're truly mastering conditional control flow.<br>
                    Review the standard practice or watch the video lesson for reinforcement.
                </p>
                <div class="button-group">
                    <!-- **** UPDATED FOR MODULE 9 ADVANCED **** -->
                    <a href="ctp-practice-9.html" class="action-button secondary fade-in delay-3"><i class="fas fa-pencil-alt"></i> <span data-translate="button_view_practice">View Standard Practice</span></a>
                    <a href="ctp-video-9.html" class="action-button success fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_watch_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    // *** POPULATED FOR MODULE 9 ADVANCED ***
    const translations = {
        en: {
            // Page & Nav
            "page_title_adv": "Module 9: Advanced Python Practice!",
            "nav_practice_std": "View Practice", "nav_video": "Video Lesson", "nav_menu": "Course Menu",
            "nav_evaluator_adv": "Evaluator", "nav_scenario_adv": "Scenario", "nav_predict_adv": "Predict", "nav_precedence": "Precedence", "nav_missions_adv": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title_adv": "Module 9: Advanced Practice", "header_subtitle_adv": "Challenge your logic skills with more complex conditions!",
            // Advanced Truth Evaluator
            "evaluator_title_adv": "Advanced Truth Evaluator", "evaluator_desc_adv": "Time for trickier expressions! Evaluate these combined logical operations, paying attention to parentheses and operator precedence.",
            "evaluator_loading_adv": "Loading complex expression...",
            "button_next_expression_adv": "Next Expression",
            "feedback_eval_correct_adv": "Perfect! <i class='fas fa-check'></i> You nailed the complex logic.",
            "feedback_eval_incorrect_adv": "Not quite. The result is {correctResult}. Review parentheses and operator order (`not` > `and` > `or`).",
            "evaluator_status_report_adv": "Correct: {correctCount} / Total: {totalCount}", "evaluator_status_final_adv": "Advanced Evaluation Complete! Score: {correctCount} out of {totalCount}.",
            // Complex Scenario to Code
            "scenario_title_adv": "Complex Scenario to Code", "scenario_desc_adv": "Translate these more detailed scenarios into Python `if` conditions. Focus on grouping conditions correctly with parentheses when needed. Remember decomposition!",
            "scenario_loading_adv": "Loading complex scenario...",
            "scenario_editor_label_adv": "Your `if` Condition:", "scenario_editor_placeholder_adv": "e.g., is_admin or (is_editor and not is_locked)",
            "button_check_condition_adv": "Check Condition", "button_next_scenario_adv": "Next Scenario",
            "scenario_output_label_adv": "Simulated Check:",
            "feedback_scenario_correct_adv": "Excellent! Your condition accurately reflects the complex scenario.",
            "feedback_scenario_incorrect_adv": "Hmm, review the logic. Did you use parentheses correctly to group conditions with `and`/`or`?",
            "feedback_scenario_missing_op_adv": "Hint: Ensure all required logical operators (`and`, `or`, `not`) and parentheses `()` are used as needed.",
            "feedback_scenario_vars_missing_adv": "Hint: Check if all variables mentioned in the scenario are included in your condition.",
             // Translations for Adv Scenarios (used in JS)
             "scenario_adv1_text": "Grant special access if the user is an 'admin' <strong class='highlight'>OR</strong> (they are an 'editor' <strong class='highlight'>AND</strong> the document status `is_unlocked` is True).",
             "scenario_adv2_text": "Send an alert if (`temperature` < 5 <strong class='highlight'>AND</strong> `is_icy` is True) <strong class='highlight'>OR</strong> (`wind_speed` > 50 <strong class='highlight'>AND</strong> `alert_level` is <strong class='highlight'>NOT</strong> 'low').",
             "scenario_adv3_text": "Qualify for promotion if (`years_experience` >= 5 <strong class='highlight'>AND</strong> `performance_rating` > 8) <strong class='highlight'>OR</strong> (`is_manager` is True <strong class='highlight'>AND</strong> `team_size` > 10).",
            // Predict Complex Output
            "predict_title_adv": "Predict Complex Output", "predict_desc_adv": "Analyze these Python snippets featuring more complex logical conditions. Predict the final printed output. Trace the logic flow carefully.",
            "predict_loading_adv": "Loading complex code...", "predict_question_adv": "What will be printed?",
            "button_next_snippet_adv": "Next Snippet",
            "feedback_predict_correct_adv": "Spot on! You accurately traced the complex conditional logic.",
            "feedback_predict_incorrect_adv": "Not quite. The actual output is '{correctAnswer}'. Double-check the conditions and operator precedence.",
            "predict_status_report_adv": "Correct: {correctCount} / Total: {totalCount}", "predict_status_final_adv": "Prediction Challenge Complete! Score: {correctCount} out of {totalCount}.",
             // Precedence Challenge
             "precedence_title": "Precedence Challenge", "precedence_desc": "Python evaluates logical operators in a specific order: `not`, then `and`, then `or`. Evaluate these expressions without parentheses to test your understanding of this precedence.",
             "precedence_loading": "Loading precedence expression...",
             "button_next_precedence": "Next Challenge",
             "feedback_prec_correct": "Correct! You understand operator precedence (`not` > `and` > `or`).",
             "feedback_prec_incorrect": "Incorrect. Remember the order: `not` first, then `and`, then `or`. The result is {correctResult}.",
             "precedence_status_report": "Correct: {correctCount} / Total: {totalCount}", "precedence_status_final": "Precedence Challenge Finished! Score: {correctCount} out of {totalCount}.",
             // Advanced Mini Missions
            "missions_title_adv": "Advanced Mini Missions!", "missions_desc_adv": "Apply your skills! Write Python code to solve these challenges, using combined logical operators and potentially parentheses for clarity and correctness.",
            "missions_output_placeholder_adv": "Output appears here...",
            "mission_adv1_title": "Adv. Mission 1: Combined Approval", "mission_adv1_desc": "Variables: `score = 75`, `attended_workshop = False`, `extra_credit = 5`. Print \"Approved\" if the score is above 70 <strong class='highlight'>AND</strong> (<strong class='highlight'>EITHER</strong> `attended_workshop` is True <strong class='highlight'>OR</strong> `extra_credit` is greater than 0).", "mission_adv1_placeholder": 'score = 75\nattended_workshop = False\nextra_credit = 5\n\nif ... :\n    print("Approved")',
            "button_test_mission_adv_1": "Test Adv. Mission 1",
            "mission_adv2_title": "Adv. Mission 2: Access Control", "mission_adv2_desc": "Variables: `user_level = \"guest\"`, `is_verified = True`, `account_active = True`. Print \"Full Access\" if `account_active` is True <strong class='highlight'>AND</strong> (<strong class='highlight'>EITHER</strong> `user_level` is \"admin\" <strong class='highlight'>OR</strong> (`user_level` is \"editor\" <strong class='highlight'>AND</strong> `is_verified` is True)). Otherwise, print \"Limited Access\".", "mission_adv2_placeholder": 'user_level = "guest"\nis_verified = True\naccount_active = True\n\nif ... :\n    print("Full Access")\nelse:\n    print("Limited Access")',
            "button_test_mission_adv_2": "Test Adv. Mission 2",
             "mission_adv3_title": "Adv. Mission 3: Eligibility Check", "mission_adv3_desc": "Variables: `age = 25`, `is_citizen = True`, `has_felony = False`. Print \"Eligible to Vote\" if the person is 18 or older, <strong class='highlight'>AND</strong> is a citizen, <strong class='highlight'>AND</strong> does <strong class='highlight'>NOT</strong> have a felony.", "mission_adv3_placeholder": 'age = 25\nis_citizen = True\nhas_felony = False\n\nif ... :\n    print("Eligible to Vote")',
             "button_test_mission_adv_3": "Test Adv. Mission 3",
            "feedback_mission_success_adv": "Mission Accomplished! Complex logic handled correctly.", "feedback_mission_syntax_error_adv": "Syntax error or condition logic is incorrect. Check parentheses `()`, `and/or/not`, and comparisons carefully.",
             "feedback_mission_adv1_hint": "Use `and` to connect `score > 70` with a grouped `(attended_workshop or extra_credit > 0)` condition.",
             "feedback_mission_adv2_hint": "Structure: `account_active and (user_level == 'admin' or (user_level == 'editor' and is_verified))`. Don't forget the `else` part.",
             "feedback_mission_adv3_hint": "A straightforward combination: `age >= 18 and is_citizen and not has_felony`.",
            "feedback_missions_summary_all_done_adv": "All {totalMissions} advanced missions complete! Logic Pro!", "feedback_missions_summary_progress_adv": "Completed {completedCount} of {totalMissions} advanced missions. Keep pushing!",
            // Completion
            "completion_title_adv": "Module 9 Advanced Practice Complete!", "completion_desc_adv": "Fantastic job navigating complex logic! You're truly mastering conditional control flow.<br> Review the standard practice or watch the video lesson for reinforcement.",
            "button_view_practice": "View Standard Practice", "button_watch_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            // Page & Nav
            "page_title_adv": "Módulo 9: Prática Avançada de Python!",
            "nav_practice_std": "Ver Prática", "nav_video": "Lição em Vídeo", "nav_menu": "Menu do Curso",
            "nav_evaluator_adv": "Avaliador", "nav_scenario_adv": "Cenário", "nav_predict_adv": "Prever", "nav_precedence": "Precedência", "nav_missions_adv": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title_adv": "Módulo 9: Prática Avançada", "header_subtitle_adv": "Desafie suas habilidades lógicas com condições mais complexas!",
            // Advanced Truth Evaluator
            "evaluator_title_adv": "Avaliador de Verdade Avançado", "evaluator_desc_adv": "Hora de expressões mais complicadas! Avalie estas operações lógicas combinadas, prestando atenção aos parênteses e à precedência dos operadores.",
            "evaluator_loading_adv": "Carregando expressão complexa...",
            "button_next_expression_adv": "Próxima Expressão",
            "feedback_eval_correct_adv": "Perfeito! <i class='fas fa-check'></i> Você dominou a lógica complexa.",
            "feedback_eval_incorrect_adv": "Não exatamente. O resultado é {correctResult}. Revise os parênteses e a ordem dos operadores (`not` > `and` > `or`).",
            "evaluator_status_report_adv": "Corretas: {correctCount} / Total: {totalCount}", "evaluator_status_final_adv": "Avaliação Avançada Concluída! Pontuação: {correctCount} de {totalCount}.",
            // Complex Scenario to Code
            "scenario_title_adv": "Cenário Complexo para Código", "scenario_desc_adv": "Traduza estes cenários mais detalhados para condições `if` em Python. Foque em agrupar as condições corretamente com parênteses quando necessário. Lembre-se da decomposição!",
            "scenario_loading_adv": "Carregando cenário complexo...",
            "scenario_editor_label_adv": "Sua Condição `if`:", "scenario_editor_placeholder_adv": "ex: eh_admin or (eh_editor and not esta_bloqueado)",
            "button_check_condition_adv": "Verificar Condição", "button_next_scenario_adv": "Próximo Cenário",
            "scenario_output_label_adv": "Verificação Simulada:",
            "feedback_scenario_correct_adv": "Excelente! Sua condição reflete precisamente o cenário complexo.",
            "feedback_scenario_incorrect_adv": "Hum, revise a lógica. Você usou parênteses corretamente para agrupar condições com `and`/`or`?",
            "feedback_scenario_missing_op_adv": "Dica: Garanta que todos os operadores lógicos (`and`, `or`, `not`) e parênteses `()` necessários foram usados conforme preciso.",
            "feedback_scenario_vars_missing_adv": "Dica: Verifique se todas as variáveis mencionadas no cenário estão incluídas na sua condição.",
             "scenario_adv1_text": "Conceder acesso especial se o usuário for 'admin' <strong class='highlight'>OU</strong> (ele for 'editor' <strong class='highlight'>E</strong> o status do documento `esta_desbloqueado` for True).",
             "scenario_adv2_text": "Enviar um alerta se (`temperatura` < 5 <strong class='highlight'>E</strong> `esta_gelado` for True) <strong class='highlight'>OU</strong> (`velocidade_vento` > 50 <strong class='highlight'>E</strong> `nivel_alerta` <strong class='highlight'>NÃO</strong> for 'baixo').",
             "scenario_adv3_text": "Qualificar para promoção se (`anos_experiencia` >= 5 <strong class='highlight'>E</strong> `avaliacao_desempenho` > 8) <strong class='highlight'>OU</strong> (`eh_gerente` for True <strong class='highlight'>E</strong> `tamanho_equipe` > 10).",
            // Predict Complex Output
            "predict_title_adv": "Prever Saída Complexa", "predict_desc_adv": "Analise estes trechos de Python com condições lógicas mais complexas. Preveja a saída final impressa. Trace o fluxo lógico cuidadosamente.",
            "predict_loading_adv": "Carregando código complexo...", "predict_question_adv": "O que será impresso?",
            "button_next_snippet_adv": "Próximo Trecho",
            "feedback_predict_correct_adv": "Na mosca! Você traçou corretamente a lógica condicional complexa.",
            "feedback_predict_incorrect_adv": "Não exatamente. A saída real é '{correctAnswer}'. Verifique novamente as condições e a precedência dos operadores.",
            "predict_status_report_adv": "Corretas: {correctCount} / Total: {totalCount}", "predict_status_final_adv": "Desafio de Predição Concluído! Pontuação: {correctCount} de {totalCount}.",
             // Precedence Challenge
             "precedence_title": "Desafio de Precedência", "precedence_desc": "Python avalia operadores lógicos em uma ordem específica: `not`, depois `and`, depois `or`. Avalie estas expressões sem parênteses para testar seu entendimento desta precedência.",
             "precedence_loading": "Carregando expressão de precedência...",
             "button_next_precedence": "Próximo Desafio",
             "feedback_prec_correct": "Correto! Você entende a precedência de operadores (`not` > `and` > `or`).",
             "feedback_prec_incorrect": "Incorreto. Lembre-se da ordem: `not` primeiro, depois `and`, depois `or`. O resultado é {correctResult}.",
             "precedence_status_report": "Corretas: {correctCount} / Total: {totalCount}", "precedence_status_final": "Desafio de Precedência Finalizado! Pontuação: {correctCount} de {totalCount}.",
             // Advanced Mini Missions
            "missions_title_adv": "Mini Missões Avançadas!", "missions_desc_adv": "Aplique suas habilidades! Escreva código Python para resolver estes desafios, usando operadores lógicos combinados e potencialmente parênteses para clareza e correção.",
            "missions_output_placeholder_adv": "A saída aparece aqui...",
            "mission_adv1_title": "Missão Avançada 1: Aprovação Combinada", "mission_adv1_desc": "Variáveis: `pontuacao = 75`, `participou_workshop = False`, `credito_extra = 5`. Imprima \"Aprovado\" se a pontuação for maior que 70 <strong class='highlight'>E</strong> (<strong class='highlight'>OU</strong> `participou_workshop` for True <strong class='highlight'>OU</strong> `credito_extra` for maior que 0).", "mission_adv1_placeholder": 'pontuacao = 75\nparticipou_workshop = False\ncredito_extra = 5\n\nif ... :\n    print("Aprovado")',
            "button_test_mission_adv_1": "Testar Missão Avançada 1",
            "mission_adv2_title": "Missão Avançada 2: Controle de Acesso", "mission_adv2_desc": "Variáveis: `nivel_usuario = \"guest\"`, `esta_verificado = True`, `conta_ativa = True`. Imprima \"Acesso Total\" se `conta_ativa` for True <strong class='highlight'>E</strong> (<strong class='highlight'>OU</strong> `nivel_usuario` for \"admin\" <strong class='highlight'>OU</strong> (`nivel_usuario` for \"editor\" <strong class='highlight'>E</strong> `esta_verificado` for True)). Caso contrário, imprima \"Acesso Limitado\".", "mission_adv2_placeholder": 'nivel_usuario = "guest"\nesta_verificado = True\nconta_ativa = True\n\nif ... :\n    print("Acesso Total")\nelse:\n    print("Acesso Limitado")',
            "button_test_mission_adv_2": "Testar Missão Avançada 2",
             "mission_adv3_title": "Missão Avançada 3: Verificação de Elegibilidade", "mission_adv3_desc": "Variáveis: `idade = 25`, `eh_cidadao = True`, `tem_crime = False`. Imprima \"Elegível para Votar\" se a pessoa tiver 18 anos ou mais, <strong class='highlight'>E</strong> for cidadão, <strong class='highlight'>E</strong> <strong class='highlight'>NÃO</strong> tiver cometido crime grave (felony).", "mission_adv3_placeholder": 'idade = 25\neh_cidadao = True\ntem_crime = False\n\nif ... :\n    print("Elegível para Votar")',
             "button_test_mission_adv_3": "Testar Missão Avançada 3",
            "feedback_mission_success_adv": "Missão Cumprida! Lógica complexa tratada corretamente.", "feedback_mission_syntax_error_adv": "Erro de sintaxe ou lógica da condição incorreta. Verifique parênteses `()`, `and/or/not` e comparações cuidadosamente.",
             "feedback_mission_adv1_hint": "Use `and` para conectar `pontuacao > 70` com uma condição agrupada `(participou_workshop or credito_extra > 0)`.",
             "feedback_mission_adv2_hint": "Estrutura: `conta_ativa and (nivel_usuario == 'admin' or (nivel_usuario == 'editor' and esta_verificado))`. Não esqueça a parte `else`.",
             "feedback_mission_adv3_hint": "Uma combinação direta: `idade >= 18 and eh_cidadao and not tem_crime`.",
            "feedback_missions_summary_all_done_adv": "Todas as {totalMissions} missões avançadas completas! Pro da Lógica!", "feedback_missions_summary_progress_adv": "Completou {completedCount} de {totalMissions} missões avançadas. Continue avançando!",
            // Completion
            "completion_title_adv": "Prática Avançada do Módulo 9 Completa!", "completion_desc_adv": "Trabalho fantástico navegando por lógica complexa! Você está realmente dominando o fluxo de controle condicional.<br> Revise a prática padrão ou assista à lição em vídeo para reforço.",
            "button_view_practice": "Ver Prática Padrão", "button_watch_video": "Assistir Lição em Vídeo", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            // Page & Nav
            "page_title_adv": "模块 9：Python 高级练习！",
            "nav_practice_std": "查看练习", "nav_video": "视频课程", "nav_menu": "课程菜单",
            "nav_evaluator_adv": "求值器", "nav_scenario_adv": "场景", "nav_predict_adv": "预测", "nav_precedence": "优先级", "nav_missions_adv": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title_adv": "模块 9：高级练习", "header_subtitle_adv": "用更复杂的条件挑战你的逻辑技能！",
            // Advanced Truth Evaluator
            "evaluator_title_adv": "高级真值求值器", "evaluator_desc_adv": "是时候处理更棘手的表达式了！评估这些组合的逻辑运算，注意括号和运算符优先级。",
            "evaluator_loading_adv": "正在加载复杂表达式...",
            "button_next_expression_adv": "下一个表达式",
            "feedback_eval_correct_adv": "完美！<i class='fas fa-check'></i> 你掌握了复杂的逻辑。",
            "feedback_eval_incorrect_adv": "不太对。结果是 {correctResult}。请检查括号和运算符顺序（`not` > `and` > `or`）。",
            "evaluator_status_report_adv": "正确：{correctCount} / 总计：{totalCount}", "evaluator_status_final_adv": "高级评估完成！得分：{totalCount} 题中答对 {correctCount} 题。",
            // Complex Scenario to Code
            "scenario_title_adv": "复杂场景到代码", "scenario_desc_adv": "将这些更详细的场景转换为 Python `if` 条件。注意在需要时使用括号正确地组合条件。记住分解！",
            "scenario_loading_adv": "正在加载复杂场景...",
            "scenario_editor_label_adv": "你的 `if` 条件：", "scenario_editor_placeholder_adv": "例如：is_admin or (is_editor and not is_locked)",
            "button_check_condition_adv": "检查条件", "button_next_scenario_adv": "下一个场景",
            "scenario_output_label_adv": "模拟检查：",
            "feedback_scenario_correct_adv": "太棒了！你的条件准确地反映了复杂的场景。",
            "feedback_scenario_incorrect_adv": "嗯，检查一下逻辑。你是否正确使用了括号来组合 `and`/`or` 条件？",
            "feedback_scenario_missing_op_adv": "提示：确保根据需要使用了所有必需的逻辑运算符（`and`、`or`、`not`）和括号 `()`。",
            "feedback_scenario_vars_missing_adv": "提示：检查场景中提到的所有变量是否都包含在你的条件中。",
             "scenario_adv1_text": "如果用户是 'admin' <strong class='highlight'>或者</strong> (他们是 'editor' <strong class='highlight'>并且</strong> 文档状态 `is_unlocked` 为 True)，则授予特殊访问权限。",
             "scenario_adv2_text": "如果 (`temperature` < 5 <strong class='highlight'>并且</strong> `is_icy` 为 True) <strong class='highlight'>或者</strong> (`wind_speed` > 50 <strong class='highlight'>并且</strong> `alert_level` <strong class='highlight'>不是</strong> 'low')，则发送警报。",
             "scenario_adv3_text": "如果 (`years_experience` >= 5 <strong class='highlight'>并且</strong> `performance_rating` > 8) <strong class='highlight'>或者</strong> (`is_manager` 为 True <strong class='highlight'>并且</strong> `team_size` > 10)，则符合晋升资格。",
            // Predict Complex Output
            "predict_title_adv": "预测复杂输出", "predict_desc_adv": "分析这些包含更复杂逻辑条件的 Python 代码片段。预测最终打印的输出。仔细追踪逻辑流程。",
            "predict_loading_adv": "正在加载复杂代码...", "predict_question_adv": "将打印什么？",
            "button_next_snippet_adv": "下一个片段",
            "feedback_predict_correct_adv": "完全正确！你准确地追踪了复杂的条件逻辑。",
            "feedback_predict_incorrect_adv": "不太对。实际输出是 '{correctAnswer}'。请仔细检查条件和运算符优先级。",
            "predict_status_report_adv": "正确：{correctCount} / 总计：{totalCount}", "predict_status_final_adv": "预测挑战完成！得分：{totalCount} 题中答对 {correctCount} 题。",
             // Precedence Challenge
             "precedence_title": "优先级挑战", "precedence_desc": "Python 按特定顺序评估逻辑运算符：`not`，然后 `and`，然后 `or`。评估这些没有括号的表达式，以测试你对该优先级的理解。",
             "precedence_loading": "正在加载优先级表达式...",
             "button_next_precedence": "下一个挑战",
             "feedback_prec_correct": "正确！你理解运算符优先级（`not` > `and` > `or`）。",
             "feedback_prec_incorrect": "不正确。请记住顺序：先 `not`，然后 `and`，然后 `or`。结果是 {correctResult}。",
             "precedence_status_report": "正确：{correctCount} / 总计：{totalCount}", "precedence_status_final": "优先级挑战完成！得分：{totalCount} 题中答对 {correctCount} 题。",
             // Advanced Mini Missions
            "missions_title_adv": "高级迷你任务！", "missions_desc_adv": "运用你的技能！编写 Python 代码来解决这些挑战，使用组合的逻辑运算符，并可能使用括号以确保清晰和正确。",
            "missions_output_placeholder_adv": "输出将显示在此处...",
            "mission_adv1_title": "高级任务 1：组合审批", "mission_adv1_desc": "变量：`score = 75`, `attended_workshop = False`, `extra_credit = 5`。如果分数高于 70 <strong class='highlight'>并且</strong> (<strong class='highlight'>要么</strong> `attended_workshop` 为 True <strong class='highlight'>要么</strong> `extra_credit` 大于 0)，则打印 \"Approved\"。", "mission_adv1_placeholder": 'score = 75\nattended_workshop = False\nextra_credit = 5\n\nif ... :\n    print("Approved")',
            "button_test_mission_adv_1": "测试高级任务 1",
            "mission_adv2_title": "高级任务 2：访问控制", "mission_adv2_desc": "变量：`user_level = \"guest\"`, `is_verified = True`, `account_active = True`。如果 `account_active` 为 True <strong class='highlight'>并且</strong> (<strong class='highlight'>要么</strong> `user_level` 是 \"admin\" <strong class='highlight'>要么</strong> (`user_level` 是 \"editor\" <strong class='highlight'>并且</strong> `is_verified` 为 True))，则打印 \"Full Access\"。否则，打印 \"Limited Access\"。", "mission_adv2_placeholder": 'user_level = "guest"\nis_verified = True\naccount_active = True\n\nif ... :\n    print("Full Access")\nelse:\n    print("Limited Access")',
            "button_test_mission_adv_2": "测试高级任务 2",
             "mission_adv3_title": "高级任务 3：资格检查", "mission_adv3_desc": "变量：`age = 25`, `is_citizen = True`, `has_felony = False`。如果年龄大于等于 18 岁，<strong class='highlight'>并且</strong>是公民，<strong class='highlight'>并且</strong><strong class='highlight'>没有</strong>重罪记录，则打印 \"Eligible to Vote\"。", "mission_adv3_placeholder": 'age = 25\nis_citizen = True\nhas_felony = False\n\nif ... :\n    print("Eligible to Vote")',
             "button_test_mission_adv_3": "测试高级任务 3",
            "feedback_mission_success_adv": "任务完成！复杂逻辑处理正确。", "feedback_mission_syntax_error_adv": "语法错误或条件逻辑不正确。请仔细检查括号 `()`、`and/or/not` 和比较。",
             "feedback_mission_adv1_hint": "使用 `and` 连接 `score > 70` 与分组的 `(attended_workshop or extra_credit > 0)` 条件。",
             "feedback_mission_adv2_hint": "结构：`account_active and (user_level == 'admin' or (user_level == 'editor' and is_verified))`。别忘了 `else` 部分。",
             "feedback_mission_adv3_hint": "一个直接的组合：`age >= 18 and is_citizen and not has_felony`。",
            "feedback_missions_summary_all_done_adv": "所有 {totalMissions} 个高级任务已完成！逻辑专家！", "feedback_missions_summary_progress_adv": "已完成 {completedCount} / {totalMissions} 个高级任务。继续努力！",
            // Completion
            "completion_title_adv": "模块 9 高级练习完成！", "completion_desc_adv": "在复杂逻辑中导航得非常出色！你真正掌握了条件控制流。<br> 复习标准练习或观看视频课程以巩固知识。",
            "button_view_practice": "查看标准练习", "button_watch_video": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Reused) ---
        function getStoredLanguage() { const storedLang = localStorage.getItem('userLanguage'); if (storedLang && translations[storedLang]) return storedLang; const browserLang = navigator.language || navigator.userLanguage; if (browserLang.startsWith('pt')) return 'pt'; if (browserLang.startsWith('zh')) return 'zh'; return 'en'; }
        function setLanguage(lang) {
             if (!translations[lang]) lang = 'en'; localStorage.setItem('userLanguage', lang); document.documentElement.lang = lang;
             translatePage(lang); const langSelect = document.getElementById('languageSelect'); if (langSelect) langSelect.value = lang;
             // Re-initialize or update language-dependent interactive content for ADVANCED activities
             if (document.getElementById('truth-evaluator-adv')) setupAdvancedTruthEvaluator();
             if (document.getElementById('scenario-code-adv')) setupAdvancedScenarioCode();
             if (document.getElementById('predict-output-adv')) setupAdvancedPredictOutput();
             if (document.getElementById('precedence-challenge')) setupPrecedenceChallenge();
             if (document.getElementById('mini-missions-9-adv')) { if (typeof updateAdvancedMissionSummary === 'function') updateAdvancedMissionSummary(); }
        }
        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text;
        }
        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {} else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else { if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); const translation = getTranslation(key, lang); el.setAttribute('placeholder', translation); });
            document.querySelectorAll('[data-translate-title]').forEach(el => { const key = el.getAttribute('data-translate-title'); const translation = getTranslation(key, lang); el.setAttribute('title', translation); });
        }
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Reused) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle'); const navPanel = document.getElementById('minimal-nav-panel'); const body = document.body;
        if (navToggleButton && navPanel) {
             navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
             document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
             navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
             document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
             navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Reused) ---
        const langSelect = document.getElementById('languageSelect'); if (langSelect) { langSelect.addEventListener('change', (e) => { setLanguage(e.target.value); }); }

        // --- Helper Function for Feedback (Reused) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) {
            const feedbackEl = document.getElementById(elementId); if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage(); const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             feedbackEl.innerHTML = translatedMessage; feedbackEl.className = 'feedback-message'; feedbackEl.classList.add('visible', type);
             const interactiveArea = feedbackEl.closest('.interactive-area'); if (!interactiveArea) return;
             interactiveArea.classList.remove('success-glow-anim', 'shake-anim'); void interactiveArea.offsetWidth;
             if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); } else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
        }

        // --- Code Highlighting Helper (Minor additions) ---
        function highlightCodeAdv(code) {
             return code
                 .replace(/\b(if|elif|else|and|or|not|in|is)\b/g, '<span class="code-keyword">$&</span>')
                 .replace(/\b(True|False|None)\b/g, '<span class="code-boolean">$&</span>')
                 .replace(/(["'])(?:(?=(\\?))\2.)*?\1/g, '<span class="code-string">$&</span>') // Strings
                 .replace(/#.*$/gm, '<span class="code-comment">$&</span>') // Comments
                 .replace(/\b\d+\.?\d*\b/g, '<span class="code-number">$&</span>') // Numbers
                 .replace(/(\(|\))/g, '<span class="code-paren">$&</span>') // Parentheses
                 .replace(/([a-zA-Z_]\w*)\s*(?=\=)/g, '<span class="code-variable">$&</span>'); // Variables before =
        }


        // --- Activity 1: Advanced Truth Evaluator ---
        function setupAdvancedTruthEvaluator() {
            const evaluatorSection = document.getElementById('truth-evaluator-adv');
            if (!evaluatorSection) return;

            const expressionDisplay = document.getElementById('adv-evaluator-expression-display');
            const choiceTrueBtn = document.getElementById('adv-eval-choice-true');
            const choiceFalseBtn = document.getElementById('adv-eval-choice-false');
            const nextBtn = document.getElementById('adv-next-expression-btn');
            const statusP = document.getElementById('adv-evaluator-status');
            const feedbackDiv = document.getElementById('adv-evaluator-feedback');

            // More complex expressions
            const expressions = [
                { expr: "(True and False) or True", result: true },
                { expr: "not (True or False)", result: false },
                { expr: "True and (False or not False)", result: true },
                { expr: "(False and True) or (True and False)", result: false },
                { expr: "not (False or False) and True", result: true },
                { expr: "True or (True and (False or not True))", result: true },
                { expr: "(not True or not False) and (True and not False)", result: true },
                { expr: "False and not (True or True)", result: false }
            ];
            let currentExpressionIndex = -1;
            let correctCount = 0;
            let totalAsked = 0;

            function loadNextExpression() {
                 currentExpressionIndex++;
                 if (currentExpressionIndex >= expressions.length) {
                     expressionDisplay.textContent = getTranslation('evaluator_status_final_adv', getStoredLanguage(), { correctCount: correctCount, totalCount: totalAsked });
                     choiceTrueBtn.disabled = true; choiceTrueBtn.classList.add('hidden');
                     choiceFalseBtn.disabled = true; choiceFalseBtn.classList.add('hidden');
                     nextBtn.classList.add('hidden');
                     feedbackDiv.classList.remove('visible');
                     statusP.textContent = '';
                     return;
                 }
                 const item = expressions[currentExpressionIndex];
                 // Use advanced highlighter for display
                 expressionDisplay.innerHTML = highlightCodeAdv(item.expr);
                 choiceTrueBtn.disabled = false; choiceTrueBtn.classList.remove('hidden');
                 choiceFalseBtn.disabled = false; choiceFalseBtn.classList.remove('hidden');
                 nextBtn.classList.add('hidden');
                 feedbackDiv.classList.remove('visible');
                 updateStatus();
            }

             function checkAnswer(userChoice) {
                 const item = expressions[currentExpressionIndex];
                 const correctResult = item.result;
                 totalAsked++;
                 if (userChoice === correctResult) {
                     correctCount++;
                     showFeedback('adv-evaluator-feedback', 'feedback_eval_correct_adv', 'correct');
                 } else {
                     showFeedback('adv-evaluator-feedback', 'feedback_eval_incorrect_adv', 'incorrect', { correctResult: correctResult ? 'True' : 'False' });
                 }
                 choiceTrueBtn.disabled = true; choiceFalseBtn.disabled = true;
                 nextBtn.classList.remove('hidden');
                 updateStatus();
             }

             function updateStatus() {
                 statusP.textContent = getTranslation('evaluator_status_report_adv', getStoredLanguage(), { correctCount: correctCount, totalCount: totalAsked });
             }

             choiceTrueBtn.onclick = () => checkAnswer(true);
             choiceFalseBtn.onclick = () => checkAnswer(false);
             nextBtn.onclick = loadNextExpression;

             currentExpressionIndex = -1; correctCount = 0; totalAsked = 0; // Reset state
             loadNextExpression(); // Initial Load
        }

        // --- Activity 2: Complex Scenario to Code ---
        function setupAdvancedScenarioCode() {
            const scenarioSection = document.getElementById('scenario-code-adv');
            if (!scenarioSection) return;

            const scenarioTextDisplay = document.getElementById('adv-scenario-text-display');
            const editor = document.getElementById('adv-scenario-editor-input');
            const checkBtn = document.getElementById('adv-check-scenario-btn');
            const nextBtn = document.getElementById('adv-next-scenario-btn');
            const outputDisplay = document.getElementById('adv-scenario-output');
            const feedbackDiv = document.getElementById('adv-scenario-feedback');

            // Complex scenarios requiring careful grouping
             const scenarios = [
                 {
                    id: 1, text_key: 'scenario_adv1_text',
                    vars: ['is_admin', 'is_editor', 'is_unlocked'], operators: ['or', 'and'],
                    // Allows variations in spacing and optional == True
                    expected_pattern: /is_admin\s*(==\s*True)?\s+or\s+\(\s*is_editor\s*(==\s*True)?\s+and\s+is_unlocked\s*(==\s*True)?\s*\)/i
                 },
                 {
                    id: 2, text_key: 'scenario_adv2_text',
                    vars: ['temperature', 'is_icy', 'wind_speed', 'alert_level'], operators: ['and', 'or', 'not', '<', '>'],
                    // Check main parts and the OR connecting them
                    expected_pattern: /\(\s*temperature\s*<\s*5\s+and\s+is_icy\s*(==\s*True)?\s*\)\s+or\s+\(\s*wind_speed\s*>\s*50\s+and\s+(not\s+alert_level\s*==\s*['"]low['"]|alert_level\s*!=\s*['"]low['"])\s*\)/i
                 },
                 {
                     id: 3, text_key: 'scenario_adv3_text',
                     vars: ['years_experience', 'performance_rating', 'is_manager', 'team_size'], operators: ['and', 'or', '>=', '>'],
                     expected_pattern: /\(\s*years_experience\s*>=\s*5\s+and\s+performance_rating\s*>\s*8\s*\)\s+or\s+\(\s*is_manager\s*(==\s*True)?\s+and\s+team_size\s*>\s*10\s*\)/i
                 }
             ];
            let currentScenarioIndex = -1;

            function loadNextScenario() {
                currentScenarioIndex++;
                if (currentScenarioIndex >= scenarios.length) {
                     scenarioTextDisplay.textContent = getTranslation('evaluator_status_final_adv', getStoredLanguage(), { correctCount: 'All', totalCount: scenarios.length }); // Reuse key
                     editor.disabled = true; checkBtn.disabled = true; checkBtn.classList.add('hidden');
                     nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible');
                     outputDisplay.textContent = '...'; return;
                }
                const scenario = scenarios[currentScenarioIndex]; const currentLang = getStoredLanguage();
                scenarioTextDisplay.innerHTML = getTranslation(scenario.text_key, currentLang);
                editor.value = ''; editor.disabled = false;
                checkBtn.disabled = false; checkBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible');
                outputDisplay.textContent = '...';
             }

             checkBtn.addEventListener('click', () => {
                const scenario = scenarios[currentScenarioIndex];
                const userCodeRaw = editor.value.trim();
                const userCodeLower = userCodeRaw.toLowerCase();
                outputDisplay.textContent = userCodeRaw || '...'; // Show user input

                let correct = false;
                let feedbackKey = 'feedback_scenario_incorrect_adv';

                const usesRequiredOperators = scenario.operators.every(op => userCodeLower.includes(op));
                const usesRequiredVars = scenario.vars.every(v => userCodeLower.includes(v.toLowerCase()));

                if (!usesRequiredOperators) { feedbackKey = 'feedback_scenario_missing_op_adv'; }
                else if (!usesRequiredVars) { feedbackKey = 'feedback_scenario_vars_missing_adv'; }
                else {
                    if (scenario.expected_pattern && scenario.expected_pattern.test(userCodeRaw)) {
                         correct = true;
                         feedbackKey = 'feedback_scenario_correct_adv';
                    }
                    // Add more specific checks for parenthesis usage if needed
                    else if (!userCodeRaw.includes('(') || !userCodeRaw.includes(')')) {
                         // Simple check if complex scenario likely needs parens but none are used
                         if (scenario.operators.includes('and') && scenario.operators.includes('or')) {
                              // Keep feedback_scenario_incorrect_adv, maybe add a specific hint later
                         }
                    }
                }
                showFeedback('adv-scenario-feedback', feedbackKey, correct ? 'correct' : 'incorrect');
                checkBtn.disabled = true; nextBtn.classList.remove('hidden');
             });
            nextBtn.addEventListener('click', loadNextScenario);
            currentScenarioIndex = -1; loadNextScenario(); // Initial Load
        }

         // --- Activity 3: Predict Complex Output ---
        function setupAdvancedPredictOutput() {
            const predictSection = document.getElementById('predict-output-adv');
            if (!predictSection) return;

            const codeDisplay = document.getElementById('adv-predict-code-display');
            const choicesDiv = document.getElementById('adv-prediction-choices');
            const nextBtn = document.getElementById('adv-next-predict-btn');
            const statusP = document.getElementById('adv-prediction-status');
            const feedbackDiv = document.getElementById('adv-predict-feedback');

            const snippets = [
                {
                    code: `a = True\nb = False\nc = True\nif a and (b or c):\n    print("Option 1")\nelse:\n    print("Option 2")`,
                    answer: "Option 1", options: ["Option 1", "Option 2", "Error"]
                },
                {
                    code: `x = 10\ny = 5\nz = 10\nif (x > y and z == x) or (y > z):\n    print("Alpha")\nelif not (x == z):\n    print("Beta")\nelse:\n    print("Gamma")`,
                    answer: "Alpha", options: ["Alpha", "Beta", "Gamma"]
                },
                {
                    code: `is_ready = False\nhas_permission = True\nis_urgent = True\nif is_ready and has_permission:\n    print("Proceed")\nelif not is_ready and (has_permission or is_urgent):\n    print("Wait")\nelse:\n    print("Stop")`,
                    answer: "Wait", options: ["Proceed", "Wait", "Stop"]
                },
                {
                    code: `val1 = 5\nval2 = 10\nif not (val1 > 0 and val2 < 5) or val1 == val2:\n    print("Check A")\nelse:\n    print("Check B")`,
                    // not (True and False) or False => not(False) or False => True or False => True
                    answer: "Check A", options: ["Check A", "Check B", "Nothing"]
                }
            ];
            let currentSnippetIndex = -1; let predictCorrect = 0; let predictTotal = 0;

             function loadNextSnippet() {
                 currentSnippetIndex++;
                 if (currentSnippetIndex >= snippets.length) {
                     codeDisplay.textContent = ''; choicesDiv.innerHTML = getTranslation('predict_status_final_adv', getStoredLanguage(), { correctCount: predictCorrect, totalCount: predictTotal });
                     nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible'); statusP.textContent = ''; return;
                 }
                 const item = snippets[currentSnippetIndex];
                 codeDisplay.innerHTML = highlightCodeAdv(item.code); choicesDiv.innerHTML = '';
                 const shuffledOptions = [...item.options].sort(() => Math.random() - 0.5);
                 shuffledOptions.forEach(option => {
                     const button = document.createElement('button'); button.classList.add('action-button', 'secondary');
                     button.textContent = option; button.onclick = () => checkPrediction(option); choicesDiv.appendChild(button);
                 });
                 nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible'); updatePredictStatus();
             }
             function checkPrediction(userChoice) {
                 const item = snippets[currentSnippetIndex]; const correctAnswer = item.answer; predictTotal++;
                 if (userChoice === correctAnswer) { predictCorrect++; showFeedback('adv-predict-feedback', 'feedback_predict_correct_adv', 'correct'); }
                 else { showFeedback('adv-predict-feedback', 'feedback_predict_incorrect_adv', 'incorrect', { correctAnswer: correctAnswer }); }
                 choicesDiv.querySelectorAll('button').forEach(btn => {
                     btn.disabled = true;
                     if (btn.textContent === correctAnswer) { btn.classList.remove('secondary'); btn.classList.add('success'); }
                     else if (btn.textContent === userChoice) { btn.classList.remove('secondary'); btn.classList.add('error'); } // Mark wrong choice red
                 });
                 nextBtn.classList.remove('hidden'); updatePredictStatus();
             }
             function updatePredictStatus() { statusP.textContent = getTranslation('predict_status_report_adv', getStoredLanguage(), { correctCount: predictCorrect, totalCount: predictTotal }); }
            nextBtn.addEventListener('click', loadNextSnippet);
            currentSnippetIndex = -1; predictCorrect = 0; predictTotal = 0; loadNextSnippet(); // Initial load
        }

         // --- Activity 4: Precedence Challenge ---
        function setupPrecedenceChallenge() {
            const challengeSection = document.getElementById('precedence-challenge');
            if (!challengeSection) return;

            const expressionDisplay = document.getElementById('precedence-expression-display');
            const choiceTrueBtn = document.getElementById('precedence-choice-true');
            const choiceFalseBtn = document.getElementById('precedence-choice-false');
            const nextBtn = document.getElementById('next-precedence-btn');
            const statusP = document.getElementById('precedence-status');
            const feedbackDiv = document.getElementById('precedence-feedback');

            // Expressions where precedence matters (not > and > or)
            const expressions = [
                { expr: "True or False and False", result: true },   // False and False is False, True or False is True
                { expr: "not False and True", result: true },       // not False is True, True and True is True
                { expr: "False or not True and False", result: false }, // not True is False, False and False is False, False or False is False
                { expr: "True and True or False", result: true },    // True and True is True, True or False is True
                { expr: "not (True and False) or False", result: true}, // Explicit parens override, but good practice. not(False) or False -> True or False -> True
                { expr: "False or True and not False", result: true}   // not False is True, True and True is True, False or True is True
            ];
            let currentExpressionIndex = -1; let correctCount = 0; let totalAsked = 0;

            function loadNextExpression() {
                 currentExpressionIndex++;
                 if (currentExpressionIndex >= expressions.length) {
                     expressionDisplay.textContent = getTranslation('precedence_status_final', getStoredLanguage(), { correctCount: correctCount, totalCount: totalAsked });
                     choiceTrueBtn.disabled = true; choiceTrueBtn.classList.add('hidden');
                     choiceFalseBtn.disabled = true; choiceFalseBtn.classList.add('hidden');
                     nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible'); statusP.textContent = ''; return;
                 }
                 const item = expressions[currentExpressionIndex];
                 expressionDisplay.innerHTML = highlightCodeAdv(item.expr);
                 choiceTrueBtn.disabled = false; choiceTrueBtn.classList.remove('hidden');
                 choiceFalseBtn.disabled = false; choiceFalseBtn.classList.remove('hidden');
                 nextBtn.classList.add('hidden'); feedbackDiv.classList.remove('visible'); updateStatus();
             }
             function checkAnswer(userChoice) {
                 const item = expressions[currentExpressionIndex]; const correctResult = item.result; totalAsked++;
                 if (userChoice === correctResult) { correctCount++; showFeedback('precedence-feedback', 'feedback_prec_correct', 'correct'); }
                 else { showFeedback('precedence-feedback', 'feedback_prec_incorrect', 'incorrect', { correctResult: correctResult ? 'True' : 'False' }); }
                 choiceTrueBtn.disabled = true; choiceFalseBtn.disabled = true; nextBtn.classList.remove('hidden'); updateStatus();
             }
             function updateStatus() { statusP.textContent = getTranslation('precedence_status_report', getStoredLanguage(), { correctCount: correctCount, totalCount: totalAsked }); }

             choiceTrueBtn.onclick = () => checkAnswer(true); choiceFalseBtn.onclick = () => checkAnswer(false); nextBtn.onclick = loadNextExpression;
             currentExpressionIndex = -1; correctCount = 0; totalAsked = 0; loadNextExpression(); // Initial Load
        }


        // --- Activity 5: Advanced Mini Missions ---
        const advMissionsSection = document.getElementById('mini-missions-9-adv');
        let updateAdvancedMissionSummary; // Define function scope

        if (advMissionsSection) {
            const missionRunButtons = advMissionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('adv-missions-summary-feedback');
            const totalMissions = advMissionsSection.querySelectorAll('.mission').length;
            let completedMissionsCount = 0;

            updateAdvancedMissionSummary = function() { // Assign function
                 completedMissionsCount = advMissionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) { showFeedback('adv-missions-summary-feedback', 'feedback_missions_summary_all_done_adv', 'correct', { totalMissions: totalMissions }); }
                 else if (completedMissionsCount > 0) { showFeedback('adv-missions-summary-feedback', 'feedback_missions_summary_progress_adv', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions }); }
                 else { summaryFeedback.classList.remove('visible', 'correct', 'incorrect', 'info'); }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId; // e.g., "adv-1"
                    const missionDiv = document.getElementById(`mission-${missionId}`); // e.g., #mission-adv-1
                    if (!missionDiv) return;

                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-feedback-${missionId}`; // e.g., #mission-feedback-adv-1
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value;

                    outputArea.innerHTML = ''; feedbackDiv.classList.remove('visible');
                    let success = false; let outputText = ''; let feedbackMessageKey = 'feedback_mission_syntax_error_adv'; let specificHintKey = '';

                    try {
                         let capturedOutput = ''; const originalLog = console.log;
                         console.log = (...args) => { capturedOutput += args.map(String).join(' ') + '\n'; };
                         // Execute the user's code including the setup variables
                         new Function(code)();
                         console.log = originalLog; outputText = capturedOutput.trim();

                        // *** Validation Logic for ADVANCED Module 9 Missions ***
                        if (missionId === 'adv-1') {
                             // Expects "Approved" if score > 70 AND (attended OR extra > 0)
                             // Simple check for output and presence of key elements
                             if (outputText === "Approved" && code.includes('score > 70') && code.includes('attended_workshop') && code.includes('extra_credit > 0') && code.includes('and') && code.includes('or') && code.includes('(') && code.includes(')')) {
                                 success = true;
                             } else { specificHintKey = 'feedback_mission_adv1_hint'; }
                        } else if (missionId === 'adv-2') {
                             // Expects "Full Access" or "Limited Access" based on complex criteria
                              if (code.includes('account_active') && code.includes('user_level') && code.includes('is_verified') && code.includes('and') && code.includes('or') && code.includes('(') && code.includes(')') && code.includes('else:')) {
                                 // Run again with known values to check output (more robust)
                                 let testOutput = '';
                                 console.log = (...args) => { testOutput += args.map(String).join(' ') + '\n'; };
                                 new Function('user_level = "guest"; is_verified = True; account_active = True\n' + code)(); // Use initial values
                                 console.log = originalLog; testOutput = testOutput.trim();

                                 if (testOutput === "Limited Access") { // Based on initial guest values
                                    success = true; // Assuming the structure is correct if it produces the expected output for the base case
                                 } else { specificHintKey = 'feedback_mission_adv2_hint'; }
                             } else { specificHintKey = 'feedback_mission_adv2_hint'; }
                        } else if (missionId === 'adv-3') {
                             // Expects "Eligible to Vote" if age>=18 AND citizen AND not felony
                             if (outputText === "Eligible to Vote" && code.includes('age >= 18') && code.includes('is_citizen') && (code.includes('not has_felony') || code.includes('has_felony == False')) && code.match(/and/g)?.length >= 2) { // Ensure two 'and's
                                 success = true;
                             } else { specificHintKey = 'feedback_mission_adv3_hint'; }
                        }

                    } catch (error) {
                         console.error("Adv Mission execution error:", error); outputText = `Error: ${error.message}`;
                         feedbackMessageKey = 'feedback_mission_syntax_error_adv';
                    }

                    if(outputText) { outputArea.textContent = `> ${outputText}`; }
                    else { outputArea.innerHTML = `<span class="placeholder">${getTranslation('missions_output_placeholder_adv', getStoredLanguage())}</span>`; }

                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success_adv';
                        showFeedback(feedbackDivId, feedbackMessageKey, 'correct');
                        statusIcon.className = 'fas fa-check-circle'; missionDiv.dataset.completed = 'true';
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey;
                        showFeedback(feedbackDivId, feedbackMessageKey, 'incorrect');
                        statusIcon.className = 'fas fa-times-circle'; missionDiv.dataset.completed = 'false';
                    }
                    updateAdvancedMissionSummary();
                });
            });
            updateAdvancedMissionSummary(); // Initial call
        }


        // --- Fade-in animations on scroll (Reused) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return;
                 const rect = el.getBoundingClientRect();
                 if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                     const computedStyle = window.getComputedStyle(el);
                     if (computedStyle.getPropertyValue('animation-name') !== 'none' && computedStyle.getPropertyValue('opacity') === '0') {} // Animation handles it
                      else if (computedStyle.getPropertyValue('opacity') === '0') { el.style.opacity = '1'; el.style.transform = 'translateY(0)'; }
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST
        animateOnScroll(); // Trigger initial animation check AFTER language potentially sets content height

        // Note: setup functions are already called within setLanguage() now

    }); // End DOMContentLoaded
    </script>

</body>
</html>