<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 27: Python Practice Zone!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Same as Module 0) --- */
        :root {
            --primary-color: #007bff; /* Blue - Keeping consistent */
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            /* Colors matching news.html for consistency in switcher potentially */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Same as Module 0) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group {
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
        }

        /* --- Advanced Animations (Same as Module 0) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon {
            0% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
            50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); }
            100% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
        }
        @keyframes successGlow {
             0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
             50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); }
             100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
        }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); }
        }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            60% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearIncorrect {
             0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
             50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
             70% { transform: scale(0.9) rotate(-5deg); }
             100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearMissed { /* Reuse for 'not found' */
             0% { transform: scale(0.8) rotateY(90deg); opacity: 0; }
             100% { transform: scale(1) rotateY(0deg); opacity: 0.8; }
        }
        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.95);
        }

        /* --- Minimal Retractable Nav (Same as Module 0, with Language Switcher) --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001;
            background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none;
            border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer;
            transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark);
            border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem;
            opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right;
            pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-width: 200px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light); text-decoration: none;
            padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success);
            border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto;
            transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }
        /* --- End Minimal Retractable Nav --- */


        /* --- Practice Header (Tweaked for Module 27) --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #004085); /* Slightly different blue */ color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* Search icon */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* List icon */

        /* --- Practice Section Styling (Same as Module 0) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Same as Module 0) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button {
             display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none;
        }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        /* Code styling */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; } .code-number { color: #b5cea8; } .code-operator { color: #d4d4d4; }

        /* --- Activity 1: Visualize Linear Search --- */
        #visualize-search .list-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--background-medium);
            border-radius: var(--border-radius);
            border: 1px solid #ccc;
            min-height: 50px;
        }
        .list-element {
            padding: 10px 15px;
            background-color: var(--secondary-color);
            color: var(--text-light);
            border-radius: 4px;
            font-family: var(--code-font);
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.4s ease, transform 0.4s ease, box-shadow 0.4s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-width: 40px; /* Ensure decent size */
            text-align: center;
        }
        .list-element.checking {
            background-color: var(--info-color);
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(23, 162, 184, 0.4);
        }
        .list-element.found {
            background-color: var(--success-color);
            transform: scale(1.15);
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.5);
            animation: iconAppearCorrect 0.6s ease-out; /* Re-use animation */
        }
        .list-element.not-found { /* For highlighting the end when not found */
            background-color: var(--error-color);
            opacity: 0.7;
        }
        #visualize-info { margin-bottom: 1.5rem; font-size: 1.1rem; }
        #visualize-info .target-value { font-weight: bold; color: var(--primary-color); font-family: var(--code-font); background: var(--background-medium); padding: 2px 6px; border-radius: 4px; }
        #visualize-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); min-height: 1.5em; }

        /* --- Activity 2: Identify Code Parts (Linear Search) --- */
        /* Reusing code-part styling from Module 0 */
        #identify-code .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #identify-code .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #identify-code .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #identify-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 3: Predict Steps (Efficiency) --- */
        #predict-steps .prediction-area { display: flex; align-items: center; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem; }
        #predict-steps .predict-label { font-weight: bold; }
        #predict-steps .predict-input {
            width: 80px; padding: 0.5rem; font-size: 1.1rem; text-align: center;
            border: 2px solid var(--secondary-color); border-radius: var(--border-radius);
            font-family: var(--code-font);
        }
        #predict-steps .predict-input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
        #predict-list-display { margin-bottom: 1rem; font-family: var(--code-font); font-size: 1.1rem; background: var(--background-light); padding: 10px; border-radius: 5px; border: 1px dashed #ccc; word-wrap: break-word; }

        /* --- Activity 4: Code Simulator (Simple Check) --- */
        /* Reusing simulator styling from Module 0 */
         #code-simulator .sim-editor { width: 100%; min-height: 80px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
         #code-simulator .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
         #code-simulator .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
         #code-simulator .sim-output-area .output-line { display: block; }
         #simulator-task-info { margin-bottom: 1rem; padding: 0.8rem; background-color: var(--background-medium); border-radius: var(--border-radius); border-left: 4px solid var(--info-color); }

        /* --- Activity 5: Conceptual Questions (Efficiency/Design) --- */
        #conceptual-questions .question-block { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .question-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .question-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .question-status .fa-times-circle { color: var(--error-color); }
        .question-status .fa-question-circle { color: var(--secondary-color); }
        .question-block[data-answered="true"] .question-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        .question-block[data-answered="true"][data-correct="false"] .question-status .fa-times-circle { animation: iconAppearIncorrect 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        #conceptual-questions .answer-textarea {
            width: 100%; min-height: 60px; background-color: #fff; color: var(--text-dark);
            border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 0.8rem;
            font-family: var(--font-body); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem;
        }
        #conceptual-summary-feedback { margin-top: 2rem; }

        /* --- Final Section (Same as Module 0) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Adjustments based on Module 0) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
            /* Activity specific */
            .list-element { padding: 8px 12px; font-size: 1rem; min-width: 35px; }
            #predict-steps .predict-input { width: 70px; font-size: 1rem; }
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            /* Nav Adjust */
             .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
             .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
             .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
             .minimal-nav ul li a i.fas { margin-right: 8px; }
             #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
             /* Activity specific */
             .list-element { padding: 6px 10px; font-size: 0.95rem; min-width: 30px; }
             #visualize-search .list-container { gap: 5px; padding: 0.8rem;}
             #predict-steps .predict-input { width: 60px; padding: 0.4rem; font-size: 0.95rem; }
             #code-simulator .sim-editor, #code-simulator .sim-output-area { font-size: 0.9rem; }
             #conceptual-questions .answer-textarea { font-size: 0.95rem; }
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle (Same as Module 0) ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher & Updated Links) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** MODIFIED: Updated hrefs for Module 27 *** -->
            <li><a href="ctp-theory-27.html"><i class="fas fa-book-open fa-fw"></i> <span data-translate="nav_theory">View Theory</span></a></li>
            <li><a href="ctp-advanced-27.html"><i class="fas fa-flask fa-fw"></i> <span data-translate="nav_advanced">Advanced Practice</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** MODIFIED: Updated links for Module 27 activities *** -->
            <li><a href="#visualize-search"><i class="fas fa-eye fa-fw"></i> <span data-translate="nav_visualize">Visualize</span></a></li>
            <li><a href="#identify-code"><i class="fas fa-code fa-fw"></i> <span data-translate="nav_identify">Identify Code</span></a></li>
            <li><a href="#predict-steps"><i class="fas fa-tachometer-alt fa-fw"></i> <span data-translate="nav_predict">Predict Steps</span></a></li>
            <li><a href="#code-simulator"><i class="fas fa-keyboard fa-fw"></i> <span data-translate="nav_simulator">Simulator</span></a></li>
            <li><a href="#conceptual-questions"><i class="fas fa-brain fa-fw"></i> <span data-translate="nav_conceptual">Conceptual</span></a></li>
            <!-- Language Switcher Item (Same) -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header (Updated for Module 27) ========= -->
    <header class="practice-header">
        <!-- *** MODIFIED: Relevant icons *** -->
        <i class="fas fa-search header-icon icon1"></i>
        <i class="fas fa-list-ol header-icon icon2"></i>
        <div class="container">
            <!-- *** MODIFIED: Title and Subtitle *** -->
            <h1 data-translate="header_title">Module 27: Practice Zone</h1>
            <p data-translate="header_subtitle">Let's practice Linear Search and think about algorithm efficiency!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Visualize Linear Search ========= -->
        <section id="visualize-search" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-eye"></i> <span data-translate="visualize_title">Visualize Linear Search</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="visualize_desc">
                     Watch how Linear Search checks each item one by one. Click "Next Step" to see the search in action.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="visualize-info" class="text-center">
                         <span data-translate="visualize_list_label">List:</span> <span id="visualize-list-display" class="code-font">[...]</span> <br>
                         <span data-translate="visualize_target_label">Target:</span> <span id="visualize-target-display" class="target-value">?</span>
                     </div>
                     <div id="list-container" class="list-container">
                         <!-- List elements generated by JS -->
                     </div>
                     <div class="text-center">
                         <button id="next-step-btn" class="action-button" data-translate="button_next_step">Next Step</button>
                         <button id="reset-vis-btn" class="action-button secondary hidden" data-translate="button_reset_vis">Reset Visualization</button>
                     </div>
                     <p id="visualize-status" class="text-center" data-translate="visualize_status_initial">Click 'Next Step' to begin.</p>
                     <div id="visualize-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Identify Linear Search Code Parts ========= -->
        <section id="identify-code" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-code"></i> <span data-translate="identify_title">Identify Code Parts</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="identify_desc">
                     This simple function performs a linear search. Click on the highlighted parts to identify their role.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
                        <pre><code><span class="code-keyword">def</span> <span class="code-function">linear_search</span>(<span class="code-variable">data</span>, <span class="code-variable">target</span>):
    <span class="code-part" data-part="loop" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">for</span> index <span class="code-keyword">in</span> <span class="code-function">range</span>(<span class="code-function">len</span>(data))</span>: <span class="code-comment"># Check each item</span>
        <span class="code-part" data-part="comparison" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">if</span> data[index] <span class="code-operator">==</span> target</span>:
            <span class="code-part" data-part="return_found" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">return</span> index</span>  <span class="code-comment"># Found it! Return position</span>
    <span class="code-part" data-part="return_not_found" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">return</span> -<span class="code-number">1</span></span>      <span class="code-comment"># Not found after checking all</span></code></pre>
                     </div>
                     <div id="identify-explanations"></div>
                     <p id="identify-status" data-translate="identify_status_initial">Identify all 4 key parts!</p>
                     <div id="identify-feedback" class="feedback-message"></div>
                     <!-- Hidden elements for storing translated explanation parts -->
                     <div id="explanation-texts" style="display: none;">
                        <span data-key="loop" data-translate="identify_exp_loop">The `for` loop: Iterates through each element's index in the list.</span>
                        <span data-key="comparison" data-translate="identify_exp_comparison">The `if` statement: Compares the current element (`data[index]`) with the `target`.</span>
                        <span data-key="return_found" data-translate="identify_exp_return_found">`return index`: Stops the search and gives back the position (index) where the target was found.</span>
                        <span data-key="return_not_found" data-translate="identify_exp_return_not_found">`return -1`: Reached only if the loop finishes without finding the target, indicating it's not in the list.</span>
                     </div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Predict Steps (Efficiency) ========= -->
        <section id="predict-steps" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-tachometer-alt"></i> <span data-translate="predict_title">Predict the Steps</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="predict_desc">
                     How many comparisons (checks) will linear search need to find the target (or know it's not there)? Enter your prediction. This relates to *efficiency*.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="predict-info" class="text-center">
                         <span data-translate="predict_list_label">List:</span>
                         <div id="predict-list-display">[...]</div>
                         <span data-translate="predict_target_label">Target:</span> <span id="predict-target-display" class="target-value">?</span>
                     </div>
                     <div class="prediction-area">
                        <label for="predict-input-field" class="predict-label" data-translate="predict_input_label">Number of comparisons:</label>
                        <input type="number" id="predict-input-field" class="predict-input" min="0">
                     </div>
                     <div class="text-center">
                          <button id="check-predict-btn" class="action-button" data-translate="button_check_prediction">Check Prediction</button>
                     </div>
                     <div id="predict-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4: Code Simulator (Simple Check) ========= -->
        <section id="code-simulator" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-keyboard"></i> <span data-translate="simulator_title">Simple Code Check</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="simulator_desc">
                     Let's practice a related concept. Use Python's `in` operator to check if a value exists in a list.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                    <div id="simulator-task-info">
                         <strong data-translate="simulator_task_label">Task:</strong> <span data-translate="simulator_task_instruction">Write a single line of Python using the <code>in</code> operator to check if the number <code class="code-number">42</code> is present in the list <code class="code-font">[10, 20, 42, 55]</code>. Print the result (which will be `True` or `False`).</span>
                     </div>
                     <label for="sim-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="simulator_editor_label">Code Editor:</label>
                     <textarea id="sim-editor-input" class="sim-editor" rows="3" data-translate-placeholder="simulator_editor_placeholder" placeholder='e.g., print(value in my_list)'></textarea>
                     <div class="text-center">
                          <button id="run-sim-btn" class="action-button" data-translate="button_run_sim">Run Simulation</button>
                     </div>
                     <label for="sim-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="simulator_output_label">Simulated Output:</label>
                     <div id="sim-output" class="sim-output-area">
                         <span class="placeholder" data-translate="simulator_output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="sim-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 5: Conceptual Questions (Efficiency/Design) ========= -->
        <section id="conceptual-questions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-brain"></i> <span data-translate="conceptual_title">Conceptual Check-in</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="conceptual_desc">
                     Think about how linear search works and its efficiency. Answer the questions below briefly.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Question 1 -->
                     <div class="question-block" id="question-1" data-answered="false" data-correct="false">
                         <span class="question-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="question1_title">Question 1: Best Case</h4>
                         <p data-translate="question1_desc">When does linear search perform the *fastest* (best-case scenario)? Briefly describe.</p>
                         <textarea class="answer-textarea" rows="2" data-translate-placeholder="question1_placeholder" placeholder="Your short answer here..."></textarea>
                         <div class="text-center"> <button class="action-button question-check-btn" data-question-id="1" data-translate="button_check_answer">Check Answer</button> </div>
                         <div id="question-feedback-1" class="feedback-message question-feedback"></div>
                     </div>
                     <!-- Question 2 -->
                     <div class="question-block" id="question-2" data-answered="false" data-correct="false">
                          <span class="question-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="question2_title">Question 2: Worst Case</h4>
                         <p data-translate="question2_desc">When does linear search perform the *slowest* (worst-case scenario)? Briefly describe.</p>
                         <textarea class="answer-textarea" rows="2" data-translate-placeholder="question2_placeholder" placeholder="Your short answer here..."></textarea>
                          <div class="text-center"> <button class="action-button question-check-btn" data-question-id="2" data-translate="button_check_answer">Check Answer</button> </div>
                         <div id="question-feedback-2" class="feedback-message question-feedback"></div>
                     </div>
                     <!-- Question 3 -->
                      <div class="question-block" id="question-3" data-answered="false" data-correct="false">
                           <span class="question-status"><i class="fas fa-question-circle"></i></span>
                          <h4 data-translate="question3_title">Question 3: Sorted Data</h4>
                          <p data-translate="question3_desc">Does linear search become faster if the list is already sorted? Why or why not?</p>
                          <textarea class="answer-textarea" rows="2" data-translate-placeholder="question3_placeholder" placeholder="Your short answer here..."></textarea>
                           <div class="text-center"> <button class="action-button question-check-btn" data-question-id="3" data-translate="button_check_answer">Check Answer</button> </div>
                          <div id="question-feedback-3" class="feedback-message question-feedback"></div>
                      </div>
                     <div id="conceptual-summary-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section (Same as Module 0, Updated Links) ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                    <i class="fas fa-star"></i> <i class="fas fa-check-double"></i> <i class="fas fa-star"></i>
                </div>
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 27 Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Great work exploring Linear Search! You've visualized it, analyzed its code, and thought about its efficiency. <br>
                    Ready for more? Tackle the <strong>Advanced Practice</strong> for Module 27!
                </p>
                <div class="button-group">
                    <!-- *** MODIFIED: Updated hrefs *** -->
                    <a href="ctp-theory-27.html" class="action-button secondary fade-in delay-3"><i class="fas fa-book-open"></i> <span data-translate="button_view_theory">View Theory Again</span></a>
                    <a href="ctp-advanced-27.html" class="action-button success fade-in delay-3"><i class="fas fa-arrow-right"></i> <span data-translate="button_start_advanced">Start Advanced Practice</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 27: Algorithm Practice - Search!",
            "tooltip_click_identify": "Click to identify this part",
            "nav_theory": "View Theory", "nav_advanced": "Advanced Practice", "nav_menu": "Course Menu",
            "nav_visualize": "Visualize", "nav_identify": "Identify Code", "nav_predict": "Predict Steps", "nav_simulator": "Simulator", "nav_conceptual": "Conceptual",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 27: Practice Zone", "header_subtitle": "Let's practice Linear Search and think about algorithm efficiency!",
            "visualize_title": "Visualize Linear Search", "visualize_desc": "Watch how Linear Search checks each item one by one. Click \"Next Step\" to see the search in action.",
            "visualize_list_label": "List:", "visualize_target_label": "Target:",
            "button_next_step": "Next Step", "button_reset_vis": "Reset Visualization",
            "visualize_status_initial": "Click 'Next Step' to begin.", "visualize_status_checking": "Checking item at index {index}...", "visualize_status_found": "Found target {target} at index {index}!", "visualize_status_not_found": "Target {target} not found after checking {count} items.",
            "feedback_vis_complete_found": "Visualization complete. Target found!", "feedback_vis_complete_not_found": "Visualization complete. Target not found.",
            "identify_title": "Identify Code Parts", "identify_desc": "This simple function performs a linear search. Click on the highlighted parts to identify their role.",
            "identify_status_initial": "Identify all 4 key parts!", "identify_status_progress": "Identified {count} of {total} parts.", "identify_status_done": "All parts identified!",
            "identify_exp_loop": "The `for` loop: Iterates through each element's index in the list.",
            "identify_exp_comparison": "The `if` statement: Compares the current element (`data[index]`) with the `target`.",
            "identify_exp_return_found": "`return index`: Stops the search and gives back the position (index) where the target was found.",
            "identify_exp_return_not_found": "`return -1`: Reached only if the loop finishes without finding the target, indicating it's not in the list.",
            "feedback_identify_correct": "Excellent! You've identified the core parts of linear search.",
            "predict_title": "Predict the Steps", "predict_desc": "How many comparisons (checks) will linear search need to find the target (or know it's not there)? Enter your prediction. This relates to *efficiency*.",
            "predict_list_label": "List:", "predict_target_label": "Target:", "predict_input_label": "Number of comparisons:",
            "button_check_prediction": "Check Prediction",
            "feedback_predict_correct": "Correct! It takes {steps} comparison(s). {reason}",
            "feedback_predict_incorrect": "Not quite. It actually takes {steps} comparison(s). {reason}",
            "predict_reason_found_at": "The target {target} is found at index {index}.",
            "predict_reason_not_found": "The target {target} is not in the list, so all {list_length} items were checked.",
            "feedback_predict_no_input": "Please enter a number prediction.",
            "simulator_title": "Simple Code Check", "simulator_desc": "Let's practice a related concept. Use Python's `in` operator to check if a value exists in a list.",
            "simulator_task_label": "Task:", "simulator_task_instruction": "Write a single line of Python using the <code>in</code> operator to check if the number <code class=\"code-number\">42</code> is present in the list <code class=\"code-font\">[10, 20, 42, 55]</code>. Print the result (which will be `True` or `False`).",
            "simulator_editor_label": "Code Editor:", "simulator_editor_placeholder": "e.g., print(value in my_list)",
            "button_run_sim": "Run Simulation", "simulator_output_label": "Simulated Output:", "simulator_output_placeholder": "Output will appear here...",
            "feedback_sim_success_correct": "Simulation successful! Output is correct.", "feedback_sim_success_incorrect": "Simulation ran, but the output is not 'True'. Did you check for 42?",
            "feedback_sim_empty": "Editor is empty.", "feedback_sim_no_print": "Code should start with `print(...)`.", "feedback_sim_no_in": "Missing the `in` operator.", "feedback_sim_syntax": "Check syntax. Expected format: `print(value in list)`.",
            "conceptual_title": "Conceptual Check-in", "conceptual_desc": "Think about how linear search works and its efficiency. Answer the questions below briefly.",
            "question1_title": "Question 1: Best Case", "question1_desc": "When does linear search perform the *fastest* (best-case scenario)? Briefly describe.", "question1_placeholder": "Your short answer here...",
            "question2_title": "Question 2: Worst Case", "question2_desc": "When does linear search perform the *slowest* (worst-case scenario)? Briefly describe.", "question2_placeholder": "Your short answer here...",
            "question3_title": "Question 3: Sorted Data", "question3_desc": "Does linear search become faster if the list is already sorted? Why or why not?", "question3_placeholder": "Your short answer here...",
            "button_check_answer": "Check Answer",
            "feedback_question_correct": "Correct!", "feedback_question_incorrect": "Needs refinement. Think about...",
            "feedback_q1_hint": "...where the target item could be located for the fewest checks.",
            "feedback_q2_hint": "...where the target item could be located (or not) for the most checks.",
            "feedback_q3_hint": "...whether linear search changes its 'check every item' behavior for sorted lists.",
            "feedback_question_empty": "Please provide an answer.",
            "feedback_conceptual_summary_all_done": "All {totalQuestions} conceptual questions answered correctly! Well done!",
            "feedback_conceptual_summary_progress": "Answered {correctCount} of {totalQuestions} correctly. Keep thinking!",
            "completion_title": "Module 27 Practice Complete!", "completion_desc": "Great work exploring Linear Search! You've visualized it, analyzed its code, and thought about its efficiency. <br> Ready for more? Tackle the <strong>Advanced Practice</strong> for Module 27!",
            "button_view_theory": "View Theory Again", "button_start_advanced": "Start Advanced Practice", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 27: Prática de Algoritmos - Busca!",
            "tooltip_click_identify": "Clique para identificar esta parte",
            "nav_theory": "Ver Teoria", "nav_advanced": "Prática Avançada", "nav_menu": "Menu do Curso",
            "nav_visualize": "Visualizar", "nav_identify": "Identificar Código", "nav_predict": "Prever Passos", "nav_simulator": "Simulador", "nav_conceptual": "Conceitual",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 27: Zona de Prática", "header_subtitle": "Vamos praticar Busca Linear e pensar sobre eficiência de algoritmos!",
            "visualize_title": "Visualizar Busca Linear", "visualize_desc": "Veja como a Busca Linear verifica cada item um por um. Clique em \"Próximo Passo\" para ver a busca em ação.",
            "visualize_list_label": "Lista:", "visualize_target_label": "Alvo:",
            "button_next_step": "Próximo Passo", "button_reset_vis": "Reiniciar Visualização",
            "visualize_status_initial": "Clique em 'Próximo Passo' para começar.", "visualize_status_checking": "Verificando item no índice {index}...", "visualize_status_found": "Alvo {target} encontrado no índice {index}!", "visualize_status_not_found": "Alvo {target} não encontrado após verificar {count} itens.",
            "feedback_vis_complete_found": "Visualização completa. Alvo encontrado!", "feedback_vis_complete_not_found": "Visualização completa. Alvo não encontrado.",
            "identify_title": "Identificar Partes do Código", "identify_desc": "Esta função simples realiza uma busca linear. Clique nas partes destacadas para identificar seu papel.",
            "identify_status_initial": "Identifique todas as 4 partes chave!", "identify_status_progress": "Identificadas {count} de {total} partes.", "identify_status_done": "Todas as partes identificadas!",
            "identify_exp_loop": "O loop `for`: Itera através do índice de cada elemento na lista.",
            "identify_exp_comparison": "A declaração `if`: Compara o elemento atual (`data[index]`) com o `target`.",
            "identify_exp_return_found": "`return index`: Para a busca e retorna a posição (índice) onde o alvo foi encontrado.",
            "identify_exp_return_not_found": "`return -1`: Alcançado apenas se o loop terminar sem encontrar o alvo, indicando que não está na lista.",
            "feedback_identify_correct": "Excelente! Você identificou as partes centrais da busca linear.",
            "predict_title": "Prever os Passos", "predict_desc": "Quantas comparações (verificações) a busca linear precisará para encontrar o alvo (ou saber que ele não está lá)? Insira sua previsão. Isso se relaciona com *eficiência*.",
            "predict_list_label": "Lista:", "predict_target_label": "Alvo:", "predict_input_label": "Número de comparações:",
            "button_check_prediction": "Verificar Previsão",
            "feedback_predict_correct": "Correto! Leva {steps} comparação(ões). {reason}",
            "feedback_predict_incorrect": "Quase lá. Na verdade, leva {steps} comparação(ões). {reason}",
            "predict_reason_found_at": "O alvo {target} foi encontrado no índice {index}.",
            "predict_reason_not_found": "O alvo {target} não está na lista, então todos os {list_length} itens foram verificados.",
            "feedback_predict_no_input": "Por favor, insira uma previsão numérica.",
            "simulator_title": "Verificação Simples de Código", "simulator_desc": "Vamos praticar um conceito relacionado. Use o operador `in` do Python para verificar se um valor existe em uma lista.",
            "simulator_task_label": "Tarefa:", "simulator_task_instruction": "Escreva uma única linha de Python usando o operador <code>in</code> para verificar se o número <code class=\"code-number\">42</code> está presente na lista <code class=\"code-font\">[10, 20, 42, 55]</code>. Imprima o resultado (que será `True` ou `False`).",
            "simulator_editor_label": "Editor de Código:", "simulator_editor_placeholder": "ex: print(valor in minha_lista)",
            "button_run_sim": "Executar Simulação", "simulator_output_label": "Saída Simulada:", "simulator_output_placeholder": "A saída aparecerá aqui...",
            "feedback_sim_success_correct": "Simulação bem-sucedida! A saída está correta.", "feedback_sim_success_incorrect": "Simulação executada, mas a saída não é 'True'. Você verificou por 42?",
            "feedback_sim_empty": "O editor está vazio.", "feedback_sim_no_print": "O código deve começar com `print(...)`.", "feedback_sim_no_in": "Faltando o operador `in`.", "feedback_sim_syntax": "Verifique a sintaxe. Formato esperado: `print(valor in lista)`.",
            "conceptual_title": "Verificação Conceitual", "conceptual_desc": "Pense sobre como a busca linear funciona e sua eficiência. Responda às perguntas abaixo brevemente.",
            "question1_title": "Pergunta 1: Melhor Caso", "question1_desc": "Quando a busca linear tem o desempenho *mais rápido* (melhor caso)? Descreva brevemente.", "question1_placeholder": "Sua resposta curta aqui...",
            "question2_title": "Pergunta 2: Pior Caso", "question2_desc": "Quando a busca linear tem o desempenho *mais lento* (pior caso)? Descreva brevemente.", "question2_placeholder": "Sua resposta curta aqui...",
            "question3_title": "Pergunta 3: Dados Ordenados", "question3_desc": "A busca linear fica mais rápida se a lista já estiver ordenada? Por que sim ou por que não?", "question3_placeholder": "Sua resposta curta aqui...",
            "button_check_answer": "Verificar Resposta",
            "feedback_question_correct": "Correto!", "feedback_question_incorrect": "Precisa refinar. Pense sobre...",
            "feedback_q1_hint": "...onde o item alvo poderia estar localizado para o mínimo de verificações.",
            "feedback_q2_hint": "...onde o item alvo poderia estar localizado (ou não) para o máximo de verificações.",
            "feedback_q3_hint": "...se a busca linear muda seu comportamento de 'verificar cada item' para listas ordenadas.",
            "feedback_question_empty": "Por favor, forneça uma resposta.",
            "feedback_conceptual_summary_all_done": "Todas as {totalQuestions} perguntas conceituais respondidas corretamente! Muito bem!",
            "feedback_conceptual_summary_progress": "Respondeu {correctCount} de {totalQuestions} corretamente. Continue pensando!",
            "completion_title": "Prática do Módulo 27 Completa!", "completion_desc": "Ótimo trabalho explorando a Busca Linear! Você a visualizou, analisou seu código e pensou sobre sua eficiência. <br> Pronto para mais? Enfrente a <strong>Prática Avançada</strong> do Módulo 27!",
            "button_view_theory": "Ver Teoria Novamente", "button_start_advanced": "Iniciar Prática Avançada", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 27：算法练习 - 搜索！",
            "tooltip_click_identify": "点击识别此部分",
            "nav_theory": "查看理论", "nav_advanced": "高级练习", "nav_menu": "课程菜单",
            "nav_visualize": "可视化", "nav_identify": "识别代码", "nav_predict": "预测步骤", "nav_simulator": "模拟器", "nav_conceptual": "概念",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 27：练习区", "header_subtitle": "让我们练习线性搜索并思考算法效率！",
            "visualize_title": "可视化线性搜索", "visualize_desc": "观察线性搜索如何逐个检查项目。点击“下一步”查看搜索过程。",
            "visualize_list_label": "列表：", "visualize_target_label": "目标：",
            "button_next_step": "下一步", "button_reset_vis": "重置可视化",
            "visualize_status_initial": "点击“下一步”开始。", "visualize_status_checking": "正在检查索引 {index} 处的项目...", "visualize_status_found": "在索引 {index} 处找到目标 {target}！", "visualize_status_not_found": "检查完 {count} 个项目后未找到目标 {target}。",
            "feedback_vis_complete_found": "可视化完成。找到目标！", "feedback_vis_complete_not_found": "可视化完成。未找到目标。",
            "identify_title": "识别代码部分", "identify_desc": "这个简单的函数执行线性搜索。点击高亮部分以识别它们的作用。",
            "identify_status_initial": "识别所有 4 个关键部分！", "identify_status_progress": "已识别 {count} / {total} 个部分。", "identify_status_done": "所有部分已识别！",
            "identify_exp_loop": "`for` 循环：遍历列表中每个元素的索引。",
            "identify_exp_comparison": "`if` 语句：将当前元素（`data[index]`）与 `target` 进行比较。",
            "identify_exp_return_found": "`return index`：停止搜索并返回找到目标的位置（索引）。",
            "identify_exp_return_not_found": "`return -1`：仅在循环完成仍未找到目标时到达，表示它不在列表中。",
            "feedback_identify_correct": "太棒了！你已经识别了线性搜索的核心部分。",
            "predict_title": "预测步骤", "predict_desc": "线性搜索需要多少次比较（检查）才能找到目标（或知道它不存在）？输入你的预测。这与*效率*有关。",
            "predict_list_label": "列表：", "predict_target_label": "目标：", "predict_input_label": "比较次数：",
            "button_check_prediction": "检查预测",
            "feedback_predict_correct": "正确！需要 {steps} 次比较。{reason}",
            "feedback_predict_incorrect": "不太对。实际上需要 {steps} 次比较。{reason}",
            "predict_reason_found_at": "目标 {target} 在索引 {index} 处找到。",
            "predict_reason_not_found": "目标 {target} 不在列表中，因此检查了所有 {list_length} 个项目。",
            "feedback_predict_no_input": "请输入一个数字预测。",
            "simulator_title": "简单代码检查", "simulator_desc": "让我们练习一个相关概念。使用 Python 的 `in` 运算符检查列表中是否存在某个值。",
            "simulator_task_label": "任务：", "simulator_task_instruction": "编写一行 Python 代码，使用 <code>in</code> 运算符检查数字 <code class=\"code-number\">42</code> 是否存在于列表 <code class=\"code-font\">[10, 20, 42, 55]</code> 中。打印结果（将是 `True` 或 `False`）。",
            "simulator_editor_label": "代码编辑器：", "simulator_editor_placeholder": "例如：print(value in my_list)",
            "button_run_sim": "运行模拟", "simulator_output_label": "模拟输出：", "simulator_output_placeholder": "输出将显示在此处...",
            "feedback_sim_success_correct": "模拟成功！输出正确。", "feedback_sim_success_incorrect": "模拟运行，但输出不是 'True'。你检查的是 42 吗？",
            "feedback_sim_empty": "编辑器是空的。", "feedback_sim_no_print": "代码应以 `print(...)` 开头。", "feedback_sim_no_in": "缺少 `in` 运算符。", "feedback_sim_syntax": "检查语法。预期格式：`print(value in list)`。",
            "conceptual_title": "概念检查", "conceptual_desc": "思考线性搜索的工作原理及其效率。简要回答以下问题。",
            "question1_title": "问题 1：最佳情况", "question1_desc": "线性搜索在什么时候执行*最快*（最佳情况）？简要描述。", "question1_placeholder": "在此处输入你的简短答案...",
            "question2_title": "问题 2：最坏情况", "question2_desc": "线性搜索在什么时候执行*最慢*（最坏情况）？简要描述。", "question2_placeholder": "在此处输入你的简短答案...",
            "question3_title": "问题 3：有序数据", "question3_desc": "如果列表已经排序，线性搜索会变得更快吗？为什么？", "question3_placeholder": "在此处输入你的简短答案...",
            "button_check_answer": "检查答案",
            "feedback_question_correct": "正确！", "feedback_question_incorrect": "需要改进。思考一下...",
            "feedback_q1_hint": "...目标项可能位于何处，以进行最少的检查。",
            "feedback_q2_hint": "...目标项可能位于（或不位于）何处，以进行最多的检查。",
            "feedback_q3_hint": "...线性搜索是否会改变其对有序列表“检查每个项目”的行为。",
            "feedback_question_empty": "请输入答案。",
            "feedback_conceptual_summary_all_done": "所有 {totalQuestions} 个概念性问题均已正确回答！做得好！",
            "feedback_conceptual_summary_progress": "已正确回答 {correctCount} / {totalQuestions} 个问题。继续思考！",
            "completion_title": "模块 27 练习完成！", "completion_desc": "探索线性搜索做得很好！你已经可视化了它，分析了它的代码，并思考了它的效率。<br> 准备好进行更多挑战了吗？开始模块 27 的<strong>高级练习</strong>吧！",
            "button_view_theory": "再次查看理论", "button_start_advanced": "开始高级练习", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Mostly Same as Module 0) ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en';
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

            // --- Re-initialize language-dependent activities ---
            // Note: Using function hoisting, definitions are below
            if (document.getElementById('visualize-search')) setupVisualizationActivity();
            if (document.getElementById('identify-code')) setupIdentifyCodeActivity();
            if (document.getElementById('predict-steps')) setupPredictStepsActivity();
            // Simulator task text is handled by translatePage
            if (document.getElementById('conceptual-questions')) setupConceptualQuestions(); // Reset text, keep state if needed or fully reset
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') document.title = translation;
                 else if (el.tagName === 'OPTION') el.textContent = translation;
                 else if (translation.includes('<') && translation.includes('>')) el.innerHTML = translation;
                 else el.textContent = translation;
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });
        }

        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Same as Module 0) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
            document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
             document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Same as Module 0) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => { setLanguage(e.target.value); });
        }

        // --- Helper Function for Feedback (Same as Module 0) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) {
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) return;
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             if (translatedMessage.includes('<') && translatedMessage.includes('>')) feedbackEl.innerHTML = translatedMessage;
             else feedbackEl.textContent = translatedMessage;
            feedbackEl.className = 'feedback-message'; // Reset classes first
            feedbackEl.classList.add('visible', type);

            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') interactiveArea.classList.add('success-glow-anim');
            else if (type === 'incorrect') interactiveArea.classList.add('shake-anim');
        }


        // --- Activity 1: Visualize Linear Search ---
        const visualizeSection = document.getElementById('visualize-search');
        let visList = [];
        let visTarget = null;
        let currentIndex = -1;
        let foundIndex = -1;
        let visInterval = null; // Not using interval, step-by-step
        let visElements = [];

        function setupVisualizationActivity() {
            if (!visualizeSection) return;
            const listContainer = document.getElementById('list-container');
            const targetDisplay = document.getElementById('visualize-target-display');
            const listDisplay = document.getElementById('visualize-list-display');
            const statusP = document.getElementById('visualize-status');
            const nextBtn = document.getElementById('next-step-btn');
            const resetBtn = document.getElementById('reset-vis-btn');
            const feedbackDiv = document.getElementById('visualize-feedback');
            const currentLang = getStoredLanguage();

            // Define a sample list and target (could be randomized later)
            visList = [15, 8, 22, 5, 19, 30, 8];
            visTarget = 19; // Element to find
            // visTarget = 99; // Element not in list (for testing)

            currentIndex = -1;
            foundIndex = -1;
            listContainer.innerHTML = '';
            visElements = [];

            // Create list elements
            visList.forEach((item) => {
                const el = document.createElement('div');
                el.classList.add('list-element');
                el.textContent = item;
                listContainer.appendChild(el);
                visElements.push(el);
            });

            targetDisplay.textContent = visTarget;
            listDisplay.textContent = `[${visList.join(', ')}]`;
            statusP.textContent = getTranslation('visualize_status_initial', currentLang);
            feedbackDiv.classList.remove('visible');
            nextBtn.disabled = false;
            resetBtn.classList.add('hidden');
            visElements.forEach(el => el.classList.remove('checking', 'found', 'not-found'));
        }

        function visualizeStep() {
            if (!visualizeSection) return;
            const statusP = document.getElementById('visualize-status');
            const nextBtn = document.getElementById('next-step-btn');
            const resetBtn = document.getElementById('reset-vis-btn');
            const feedbackDivId = 'visualize-feedback';
            const currentLang = getStoredLanguage();

            // Remove previous highlight
            if (currentIndex >= 0 && currentIndex < visElements.length) {
                visElements[currentIndex].classList.remove('checking');
            }

            // Move to next index
            currentIndex++;

            // Check if search is over
            if (currentIndex >= visList.length || foundIndex !== -1) {
                nextBtn.disabled = true;
                resetBtn.classList.remove('hidden');
                if (foundIndex !== -1) {
                     visElements[foundIndex].classList.add('found');
                     statusP.textContent = getTranslation('visualize_status_found', currentLang, { target: visTarget, index: foundIndex });
                     showFeedback(feedbackDivId, 'feedback_vis_complete_found', 'correct');
                } else {
                    statusP.textContent = getTranslation('visualize_status_not_found', currentLang, { target: visTarget, count: visList.length });
                     showFeedback(feedbackDivId, 'feedback_vis_complete_not_found', 'info');
                     // Optionally highlight all as 'not-found' visually
                     visElements.forEach(el => el.classList.add('not-found'));
                }
                return; // Stop stepping
            }

            // Highlight current element
            visElements[currentIndex].classList.add('checking');
            statusP.textContent = getTranslation('visualize_status_checking', currentLang, { index: currentIndex });

            // Check if current element is the target
            if (visList[currentIndex] === visTarget) {
                foundIndex = currentIndex;
                // Don't disable next button yet, let the final step show the 'found' state
            }
        }

        if (visualizeSection) {
            const nextBtn = document.getElementById('next-step-btn');
            const resetBtn = document.getElementById('reset-vis-btn');
            nextBtn.addEventListener('click', visualizeStep);
            resetBtn.addEventListener('click', setupVisualizationActivity);
            // setupVisualizationActivity(); // Called by setLanguage initially
        }


        // --- Activity 2: Identify Code Parts ---
        const identifyCodeSection = document.getElementById('identify-code');
        let identifyPartExplanations = {};
        const totalIdentifyParts = 4; // loop, comparison, return_found, return_not_found
        let currentIdentifyListeners = [];

        function setupIdentifyCodeActivity() {
            if (!identifyCodeSection) return;
            const currentLang = getStoredLanguage();
            identifyPartExplanations = {}; // Clear previous

            // Fetch explanations for the current language
             document.querySelectorAll('#explanation-texts span[data-key]').forEach(span => {
                const key = span.getAttribute('data-key');
                // Construct the expected translation key format
                const translationKey = `identify_exp_${key}`;
                if (translations[currentLang]?.[translationKey]) {
                     identifyPartExplanations[key] = getTranslation(translationKey, currentLang);
                 } else {
                     console.warn(`Missing translation for key: ${translationKey} in lang: ${currentLang}`);
                     // Fallback to English or default text if needed
                     identifyPartExplanations[key] = getTranslation(translationKey, 'en') || `[${translationKey}]`;
                 }
             });


            const parts = identifyCodeSection.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('identify-explanations');
            const statusP = document.getElementById('identify-status');
            const feedbackDiv = document.getElementById('identify-feedback');
            let identifiedCount = 0;

            // Remove old listeners
            currentIdentifyListeners.forEach(({element, listener}) => {
                element.removeEventListener('click', listener);
            });
            currentIdentifyListeners = [];

            // Reset visual state
            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.textContent = getTranslation('identify_status_initial', currentLang);
            feedbackDiv.classList.remove('visible');

            parts.forEach(part => {
                const partType = part.dataset.part;
                // Make sure the part type exists in our fetched explanations
                if (!identifyPartExplanations[partType]) {
                     console.warn(`Part type '${partType}' found in HTML but no explanation loaded.`);
                     // Optionally disable clicking or handle gracefully
                     part.style.cursor = 'default'; // Indicate non-interactive if explanation missing
                     part.style.borderBottom = '2px dashed rgba(255, 0, 0, 0.3)'; // Mark as problematic?
                     return; // Skip adding listener if explanation is missing
                 }

                const clickListener = () => {
                    if (!part.classList.contains('identified')) {
                        part.classList.add('identified');
                        identifiedCount++;

                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        const icon = document.createElement('i');
                        icon.className = 'fas fa-check-circle';
                        icon.style.color = 'var(--success-color)';
                        const strong = document.createElement('strong');
                        // Try to get more specific text if available, fallback to general text content
                        const specificTextElement = part.querySelector('span[class^="code-"]');
                        strong.textContent = (specificTextElement ? specificTextElement.textContent.trim() : part.textContent.trim()) + ': ';

                        p.appendChild(icon);
                        p.appendChild(document.createTextNode(' ')); // Space after icon
                        p.appendChild(strong);
                        p.appendChild(document.createTextNode(identifyPartExplanations[partType])); // Use fetched explanation
                        explanationsDiv.appendChild(p);

                        statusP.textContent = getTranslation('identify_status_progress', currentLang, { count: identifiedCount, total: totalIdentifyParts });

                        if (identifiedCount === totalIdentifyParts) {
                            statusP.textContent = getTranslation('identify_status_done', currentLang);
                            showFeedback('identify-feedback', 'feedback_identify_correct', 'correct');
                        }
                    }
                };
                part.addEventListener('click', clickListener);
                currentIdentifyListeners.push({ element: part, listener: clickListener });
            });
        }
        // setupIdentifyCodeActivity(); // Called by setLanguage

        // --- Activity 3: Predict Steps ---
        const predictStepsSection = document.getElementById('predict-steps');
        let predictList = [];
        let predictTarget = null;
        let correctSteps = 0;

        function setupPredictStepsActivity() {
            if (!predictStepsSection) return;
            const listDisplay = document.getElementById('predict-list-display');
            const targetDisplay = document.getElementById('predict-target-display');
            const inputField = document.getElementById('predict-input-field');
            const checkBtn = document.getElementById('check-predict-btn');
            const feedbackDiv = document.getElementById('predict-feedback');

            // Different list/target for variety
            predictList = [50, 20, 80, 10, 90, 30, 70];
            // predictTarget = 90; // Found later
            predictTarget = 100; // Not found
            // predictTarget = 50; // Found first

            // Calculate correct steps
            let foundAt = -1;
            for(let i = 0; i < predictList.length; i++) {
                if (predictList[i] === predictTarget) {
                    foundAt = i;
                    break;
                }
            }
            correctSteps = (foundAt !== -1) ? foundAt + 1 : predictList.length;

            // Update UI
            const currentLang = getStoredLanguage();
            listDisplay.textContent = `[${predictList.join(', ')}]`;
            targetDisplay.textContent = predictTarget;
            inputField.value = '';
            checkBtn.disabled = false;
            feedbackDiv.classList.remove('visible');
        }

        if (predictStepsSection) {
            const checkBtn = document.getElementById('check-predict-btn');
            const inputField = document.getElementById('predict-input-field');

            checkBtn.addEventListener('click', () => {
                const userAnswer = parseInt(inputField.value, 10);
                const feedbackDivId = 'predict-feedback';
                const currentLang = getStoredLanguage();

                if (isNaN(userAnswer)) {
                    showFeedback(feedbackDivId, 'feedback_predict_no_input', 'info');
                    return;
                }

                let reasonKey = '';
                let reasonReplacements = {};
                let foundIdx = predictList.indexOf(predictTarget);

                if (foundIdx !== -1) {
                    reasonKey = 'predict_reason_found_at';
                    reasonReplacements = { target: predictTarget, index: foundIdx };
                } else {
                    reasonKey = 'predict_reason_not_found';
                    reasonReplacements = { target: predictTarget, list_length: predictList.length };
                }
                const reasonText = getTranslation(reasonKey, currentLang, reasonReplacements);


                if (userAnswer === correctSteps) {
                    showFeedback(feedbackDivId, 'feedback_predict_correct', 'correct', { steps: correctSteps, reason: reasonText });
                    checkBtn.disabled = true; // Disable after correct answer
                } else {
                    showFeedback(feedbackDivId, 'feedback_predict_incorrect', 'incorrect', { steps: correctSteps, reason: reasonText });
                    // Don't disable, allow user to try again after seeing the correct answer
                }
            });
             // Add listener to re-enable button if input changes after incorrect feedback
             inputField.addEventListener('input', () => {
                 if (!checkBtn.disabled && feedbackDiv.classList.contains('incorrect')) {
                     // Or just always enable if they type something
                 }
                 // If we wanted to allow retries:
                 // checkBtn.disabled = false;
                 // feedbackDiv.classList.remove('visible');
             });

            // setupPredictStepsActivity(); // Called by setLanguage
        }


        // --- Activity 4: Code Simulator (Simple Check) ---
        const simSection = document.getElementById('code-simulator');
        if(simSection) {
            const editor = document.getElementById('sim-editor-input');
            const outputArea = document.getElementById('sim-output');
            const runBtn = document.getElementById('run-sim-btn');
            const feedbackDiv = document.getElementById('sim-feedback');
            const simTargetValue = 42;
            const simList = [10, 20, 42, 55]; // The list mentioned in the task

            runBtn.addEventListener('click', () => {
                 const code = editor.value.trim();
                 const currentLang = getStoredLanguage();
                 let placeholder = outputArea.querySelector('.placeholder');
                 outputArea.innerHTML = ''; // Clear previous output
                 if (!placeholder) {
                     placeholder = document.createElement('span');
                     placeholder.className = 'placeholder';
                     placeholder.dataset.translate = 'simulator_output_placeholder';
                 }
                 placeholder.textContent = getTranslation('simulator_output_placeholder', currentLang); // Reset placeholder text
                 feedbackDiv.classList.remove('visible'); // Clear previous feedback

                 // Basic validation logic for this specific task
                 if (code === '') {
                     outputArea.appendChild(placeholder);
                     showFeedback('sim-feedback', 'feedback_sim_empty', 'info');
                 } else if (!code.toLowerCase().startsWith('print')) {
                      outputArea.appendChild(placeholder);
                      showFeedback('sim-feedback', 'feedback_sim_no_print', 'incorrect');
                 } else if (!code.includes(' in ')) { // Check for the 'in' operator specifically
                      outputArea.appendChild(placeholder);
                      showFeedback('sim-feedback', 'feedback_sim_no_in', 'incorrect');
                 } else {
                     // Attempt a *very* basic simulation of the expected output
                     // This is fragile but avoids a full JS Python interpreter
                     let simulatedOutput = '';
                     let success = false;
                     try {
                        // Check if the code *looks* like it's checking the correct thing
                        const checkRegex = /print\s*\(\s*42\s+in\s+\[\s*10\s*,\s*20\s*,\s*42\s*,\s*55\s*\]\s*\)/;
                        const checkRegexMinimal = /print\s*\(\s*42\s+in\s+.*\[.*10.*20.*42.*55.*\]/; // More lenient
                        const checkRegexVar = /print\s*\(\s*(\w+)\s+in\s+(\w+)\s*\)/; // print(val in my_list) - too generic

                        // For this specific task, we know the answer should be True
                        const expectedOutput = "True";

                        // We can't *really* execute the Python, so we check if the *structure* seems right
                        // AND simulate the known correct output.
                        if (checkRegexMinimal.test(code.replace(/\s+/g, ' '))) { // Normalize whitespace
                            simulatedOutput = expectedOutput; // Assume it would print True if syntax is plausible
                            success = true;
                             const outputLine = document.createElement('span');
                             outputLine.classList.add('output-line');
                             outputLine.textContent = `> ${simulatedOutput}`;
                             outputArea.appendChild(outputLine);
                             showFeedback('sim-feedback', 'feedback_sim_success_correct', 'correct');
                         } else if (code.includes('print') && code.includes('in')) {
                             // It might be syntactically valid but checking wrong value/list
                             // We can still simulate *an* output, maybe 'False' or an error hint
                             simulatedOutput = "False"; // Guessing they made a mistake
                             const outputLine = document.createElement('span');
                             outputLine.classList.add('output-line');
                             outputLine.textContent = `> ${simulatedOutput}`; // Show *some* output
                             outputArea.appendChild(outputLine);
                             showFeedback('sim-feedback', 'feedback_sim_success_incorrect', 'incorrect');
                         }
                         else {
                             // General syntax error catch
                             outputArea.appendChild(placeholder);
                             showFeedback('sim-feedback', 'feedback_sim_syntax', 'incorrect');
                         }

                     } catch (e) {
                         // Fallback if regex or checks fail unexpectedly
                         console.error("Simulator check error:", e);
                         outputArea.appendChild(placeholder);
                         showFeedback('sim-feedback', 'feedback_sim_syntax', 'incorrect');
                     }
                 }
             });
        }


        // --- Activity 5: Conceptual Questions ---
        const conceptualSection = document.getElementById('conceptual-questions');
        let updateConceptualSummary; // Function scope

        function setupConceptualQuestions() {
             if (!conceptualSection) return;
             const questionBlocks = conceptualSection.querySelectorAll('.question-block');
             const summaryFeedback = document.getElementById('conceptual-summary-feedback');
             const totalQuestions = questionBlocks.length;
             let correctCount = 0;

             updateConceptualSummary = function() {
                correctCount = conceptualSection.querySelectorAll('.question-block[data-correct="true"]').length;
                const currentLang = getStoredLanguage();
                if (correctCount === totalQuestions && conceptualSection.querySelectorAll('.question-block[data-answered="true"]').length === totalQuestions) {
                    showFeedback('conceptual-summary-feedback', 'feedback_conceptual_summary_all_done', 'correct', { totalQuestions: totalQuestions });
                } else if (correctCount > 0 || conceptualSection.querySelectorAll('.question-block[data-answered="true"]').length > 0) {
                     showFeedback('conceptual-summary-feedback', 'feedback_conceptual_summary_progress', 'info', { correctCount: correctCount, totalQuestions: totalQuestions });
                 } else {
                     summaryFeedback.classList.remove('visible');
                 }
             };

             questionBlocks.forEach(block => {
                 const questionId = block.id.split('-')[1];
                 const checkBtn = block.querySelector('.question-check-btn');
                 const textarea = block.querySelector('.answer-textarea');
                 const feedbackDivId = `question-feedback-${questionId}`;
                 const statusIcon = block.querySelector('.question-status i');

                // Reset visual state potentially on language change (or keep user progress)
                 // block.dataset.answered = "false";
                 // block.dataset.correct = "false";
                 // statusIcon.className = 'fas fa-question-circle';
                 // textarea.value = '';
                 // document.getElementById(feedbackDivId).classList.remove('visible');
                 // checkBtn.disabled = false;

                 checkBtn.addEventListener('click', () => {
                     const answer = textarea.value.trim().toLowerCase();
                     const currentLang = getStoredLanguage();
                     let isCorrect = false;
                     let feedbackKey = 'feedback_question_incorrect';
                     let feedbackType = 'incorrect';
                     let hintKey = '';

                     if (answer === '') {
                         showFeedback(feedbackDivId, 'feedback_question_empty', 'info');
                         return;
                     }

                     // Simple keyword checking (adapt keywords based on language if needed)
                     if (questionId === '1') { // Best case
                         if (answer.includes('first') || answer.includes('start') || answer.includes('beginning') || answer.includes('index 0') || answer.includes('primeir') || answer.includes('início') || answer.includes('começo') || answer.includes('índice 0') || answer.includes('第一') || answer.includes('开头') || answer.includes('开始') || answer.includes('索引0')) {
                             isCorrect = true;
                         }
                         hintKey = 'feedback_q1_hint';
                     } else if (questionId === '2') { // Worst case
                          if ((answer.includes('last') || answer.includes('end') || answer.includes('not found') || answer.includes('doesn\'t exist') || answer.includes('all items') || answer.includes('whole list')) || (answer.includes('últim') || answer.includes('fim') || answer.includes('não encontr') || answer.includes('não existe') || answer.includes('todos os itens') || answer.includes('lista toda')) || (answer.includes('最后') || answer.includes('末尾') || answer.includes('未找到') || answer.includes('不存在') || answer.includes('所有项') || answer.includes('整个列表'))) {
                             isCorrect = true;
                         }
                         hintKey = 'feedback_q2_hint';
                     } else if (questionId === '3') { // Sorted data impact
                         if ((answer.includes('no') || answer.includes('doesn\'t') || answer.includes('not faster') || answer.includes('still checks') || answer.includes('same speed') ) && (answer.includes('checks all') || answer.includes('sequentially') || answer.includes('one by one')) || (answer.includes('não') || answer.includes('continua checando') || answer.includes('mesma velocidade') || answer.includes('verifica todos') || answer.includes('sequencial') || answer.includes('um por um')) || (answer.includes('不') || answer.includes('不会') || answer.includes('仍然检查') || answer.includes('相同速度') || answer.includes('检查所有') || answer.includes('顺序') || answer.includes('逐一'))) {
                            isCorrect = true;
                         }
                          hintKey = 'feedback_q3_hint';
                     }

                     block.dataset.answered = "true";
                     block.dataset.correct = isCorrect.toString();

                     if (isCorrect) {
                         feedbackKey = 'feedback_question_correct';
                         feedbackType = 'correct';
                         statusIcon.className = 'fas fa-check-circle';
                         checkBtn.disabled = true; // Disable after correct answer
                         textarea.readOnly = true; // Prevent further edits
                     } else {
                         feedbackKey = 'feedback_question_incorrect';
                         feedbackType = 'incorrect';
                         statusIcon.className = 'fas fa-times-circle';
                         // Add hint
                         const hintText = getTranslation(hintKey, currentLang);
                         showFeedback(feedbackDivId, feedbackKey, feedbackType, { hint: hintText });
                         // Allow retry: keep button enabled and textarea editable
                         // checkBtn.disabled = false;
                         // textarea.readOnly = false;
                     }
                      // If not allowing retry and showing hint:
                     if (!isCorrect) {
                         const hintText = getTranslation(hintKey, currentLang);
                         const baseMessage = getTranslation(feedbackKey, currentLang);
                         showFeedback(feedbackDivId, baseMessage + ' ' + hintText, feedbackType); // Append hint
                         checkBtn.disabled = true; // Disable even if wrong to show the hint firmly
                         textarea.readOnly = true;
                     } else {
                         showFeedback(feedbackDivId, feedbackKey, feedbackType); // Just show 'Correct!'
                     }


                     updateConceptualSummary();
                 });
             });
             // updateConceptualSummary(); // Initial call handled by setLanguage calling this setup
        }


        // --- Fade-in animations on scroll (Same as Module 0) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return; // Already visible
                 const rect = el.getBoundingClientRect();
                 // Trigger when element is partially in view
                 if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                     el.style.opacity = '1';
                     el.style.transform = 'translateY(0)';
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Setup ---
        setLanguage(initialLang); // Apply language and run initial setup functions for activities
        animateOnScroll(); // Trigger initial animation check after setup

    }); // End DOMContentLoaded
    </script>

</body>
</html>