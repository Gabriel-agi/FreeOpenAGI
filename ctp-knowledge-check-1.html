<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 1 - Variables & Data Types</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard for Consistency) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for KC icon */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--check-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        .kc-header .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .return-button {
            color: var(--text-light);
            text-decoration: none;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: background-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }
        .return-button i { opacity: 0.8; }
        /* Language Switcher Styles (Adapted) */
        .language-switcher { position: relative; }
        #languageSelect {
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--lang-arrow-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: var(--lang-select-bg-hover); border-color: var(--accent-color); }
        #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.25); }
        #languageSelect option {
             background: var(--lang-option-bg);
             color: var(--lang-option-text);
             padding: 5px;
        }

        /* --- Main Content Area --- */
        .kc-main {
            flex-grow: 1;
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .kc-intro {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .kc-intro p {
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }
        .kc-intro strong { color: var(--text-dark); }

        /* --- Quiz Form Styling --- */
        #quiz-form .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        #quiz-form .question-block:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .question-number {
            font-weight: 700;
            color: var(--primary-color);
            margin-right: 8px;
            font-size: 1.1em;
        }
        .question-text {
            font-weight: 500;
            margin-bottom: 1rem;
            display: inline; /* Keep number and text together */
        }
        .question-text code {
            font-size: 0.95em;
            background-color: #e9ecef;
            padding: 2px 5px;
            border-radius: 4px;
            color: #c7254e; /* Bootstrap code color */
        }
        .options-list {
            list-style: none;
            padding-left: 0; /* Reset padding */
            margin-top: 0.5rem;
        }
        .option-item {
            margin-bottom: 0.75rem;
        }
        .option-item label {
            display: flex; /* Use flexbox for alignment */
            align-items: center; /* Vertically align radio and text */
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .option-item label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }
        .option-item input[type="radio"] {
            margin-right: 10px;
            flex-shrink: 0; /* Prevent radio from shrinking */
            appearance: none; /* Custom radio */
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary-color);
            border-radius: 50%;
            position: relative;
            top: -1px; /* Minor alignment tweak */
            transition: border-color 0.2s ease;
        }
        .option-item input[type="radio"]:checked {
            border-color: var(--primary-color);
        }
        .option-item input[type="radio"]:checked::before {
             content: '';
             display: block;
             width: 10px;
             height: 10px;
             background-color: var(--primary-color);
             border-radius: 50%;
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
         }

        .option-item label code { /* Style code within options */
            font-size: 0.9em;
            background-color: #e0e5e9;
            padding: 1px 4px;
            border-radius: 3px;
            color: #c7254e;
        }

        /* --- Submit Button --- */
        .submit-button {
            display: inline-block;
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s ease;
            margin-top: 2rem;
        }
        .submit-button:hover {
            background-color: #5a35a1; /* Darker purple */
        }
        .submit-button:active {
            transform: scale(0.98);
        }
        .submit-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* --- Results Area --- */
        #results-area {
            margin-top: 2.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            display: none; /* Hidden initially */
        }
        #results-area.pass {
            background-color: #d1e7dd; /* Light green */
            border-color: var(--success-color);
        }
        #results-area.fail {
            background-color: #f8d7da; /* Light red */
            border-color: var(--error-color);
        }
        #results-area p {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
        }
        #results-area .score { color: var(--text-dark); }
        #results-area.pass .status { color: var(--success-color); }
        #results-area.fail .status { color: var(--error-color); }
        #results-area .status i { margin-right: 5px; }
        .result-actions { margin-top: 1.5rem; display: flex; gap: 1rem; }
        .try-again-button, .back-dashboard-button {
             display: inline-block;
             text-decoration: none;
             color: var(--text-light);
             border: none;
             padding: 0.6rem 1.2rem;
             border-radius: var(--border-radius);
             font-size: 0.95rem;
             font-weight: 500;
             cursor: pointer;
             transition: background-color var(--transition-speed);
             text-align: center;
         }
        .try-again-button { background-color: var(--secondary-color); }
        .try-again-button:hover { background-color: #5a6268; }
        .back-dashboard-button { background-color: var(--primary-color); }
        .back-dashboard-button:hover { background-color: #0b5ed7; }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: auto; /* Push footer down */
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .kc-main { max-width: 95%; padding: 1.5rem; margin: 1.5rem auto; }
            .kc-header h1 { font-size: 1.4rem; }
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
             .kc-header { flex-direction: column; gap: 1rem; padding: 1rem; }
             .kc-header h1 { text-align: center; }
             .kc-header .header-controls { width: 100%; justify-content: space-between;}
            .kc-main { padding: 1rem; margin: 1rem auto;}
            .submit-button { width: 100%; }
            .result-actions { flex-direction: column; }
             .try-again-button, .back-dashboard-button { width: 100%; }
        }
         @media (max-width: 576px) {
             html { font-size: 14px; }
             .kc-header h1 { font-size: 1.2rem; }
             .kc-header .header-controls { flex-direction: column; gap: 0.8rem; }
             .return-button { width: 100%; text-align: center; justify-content: center;}
             #languageSelect { width: 100%; }
             .option-item label { flex-direction: column; align-items: flex-start; gap: 0.5rem;}
             .option-item input[type="radio"] { margin-right: 0; margin-bottom: 5px; } /* Adjust radio position */
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-button">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
        </a>
        <h1 data-translate="header_title">KC Module 1: Variables</h1>
         <div class="header-controls">
            <!-- Language Switcher -->
            <div class="language-switcher">
                <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                    <option value="en" data-translate="lang_en">🇬🇧 English</option>
                    <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                    <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                </select>
            </div>
        </div>
    </header>

    <main class="kc-main">
        <div class="kc-intro">
            <p data-translate="intro_line1">Test your knowledge of Module 1: Variables & Data Types.</p>
            <p data-translate="intro_line2">There are <strong data-translate="intro_num_questions">10 questions</strong>. You need to answer at least <strong data-translate="intro_passing_score">6 questions</strong> correctly to pass.</p>
            <p data-translate="intro_line3">You can attempt this check as many times as you need.</p>
        </div>

        <form id="quiz-form">
            <!-- Questions will be dynamically inserted here by JavaScript -->
            <button type="submit" class="submit-button" data-translate="submit_button">Submit Answers</button>
        </form>

        <div id="results-area">
            <!-- Results will be dynamically inserted here -->
        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Constants ---
        const MODULE_ID = 1; // *** Set this for each Knowledge Check page ***
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Quiz Data for Module 1 ---
        const quizData = [
            {
                question_key: "q1_text", // What is a variable in programming?
                options_keys: ["q1_op1", "q1_op2", "q1_op3", "q1_op4"],
                correct_answer_index: 1 // A named container for storing data
            },
            {
                question_key: "q2_text", // Which symbol is used for assignment in Python?
                options_keys: ["q2_op1", "q2_op2", "q2_op3", "q2_op4"],
                correct_answer_index: 0 // =
            },
            {
                question_key: "q3_text", // What data type would you use to store a whole number like 42?
                options_keys: ["q3_op1", "q3_op2", "q3_op3", "q3_op4"],
                correct_answer_index: 1 // int
            },
            {
                question_key: "q4_text", // What data type represents text in Python?
                options_keys: ["q4_op1", "q4_op2", "q4_op3", "q4_op4"],
                correct_answer_index: 3 // str
            },
            {
                question_key: "q5_text", // What will `type(3.14)` output?
                options_keys: ["q5_op1", "q5_op2", "q5_op3", "q5_op4"],
                correct_answer_index: 2 // <class 'float'>
            },
            {
                question_key: "q6_text", // Which of the following is a VALID variable name in Python?
                options_keys: ["q6_op1", "q6_op2", "q6_op3", "q6_op4"],
                correct_answer_index: 0 // `user_age`
            },
            {
                question_key: "q7_text", // After `x = 10` then `x = "hello"`, what is the data type of `x`?
                options_keys: ["q7_op1", "q7_op2", "q7_op3", "q7_op4"],
                correct_answer_index: 3 // str
            },
            {
                question_key: "q8_text", // What does the assignment operator (`=`) do?
                options_keys: ["q8_op1", "q8_op2", "q8_op3", "q8_op4"],
                correct_answer_index: 0 // Stores the value on the right into the variable on the left
            },
             {
                question_key: "q9_text", // If `name = "Alice"`, what is `type(name)`?
                options_keys: ["q9_op1", "q9_op2", "q9_op3", "q9_op4"],
                correct_answer_index: 1 // <class 'str'>
            },
            {
                question_key: "q10_text", // Which data type would store the value `"99"` (note the quotes)?
                options_keys: ["q10_op1", "q10_op2", "q10_op3", "q10_op4"],
                correct_answer_index: 0 // str
            },
        ];

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": `Knowledge Check: Module ${MODULE_ID} - Variables & Data Types`,
                 "header_title": `Knowledge Check: Module ${MODULE_ID}`,
                 "return_button": "Return to Dashboard",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "intro_line1": "Test your knowledge of Module 1: Variables & Data Types.",
                 "intro_line2": `There are <strong>${TOTAL_QUESTIONS} questions</strong>. You need to answer at least <strong>${PASSING_SCORE} questions</strong> correctly to pass.`,
                 "intro_num_questions": `${TOTAL_QUESTIONS} questions`,
                 "intro_passing_score": `${PASSING_SCORE} questions`,
                 "intro_line3": "You can attempt this check as many times as you need.",
                 "submit_button": "Submit Answers",
                 "results_score": "Your score: {score}/{total}",
                 "results_pass": "<i class='fas fa-check-circle'></i> Congratulations! You passed.",
                 "results_pass_info": "Module completion recorded. You can return to the dashboard.",
                 "results_fail": "<i class='fas fa-times-circle'></i> Not quite there yet. You needed {passingScore} correct answers.",
                 "results_fail_info": "Don't worry, review the material and try again!",
                 "try_again_button": "Try Again",
                 "back_dashboard_button": "Back to Dashboard",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 // Module 1 Questions & Options
                 "q1_text": "What is a variable in programming?",
                 "q1_op1": "A fixed value that cannot change.",
                 "q1_op2": "A named container used for storing data values.",
                 "q1_op3": "A type of function.",
                 "q1_op4": "A mathematical operator.",
                 "q2_text": "Which symbol is used for assigning a value to a variable in Python?",
                 "q2_op1": "<code>=</code>",
                 "q2_op2": "<code>==</code>",
                 "q2_op3": "<code>:=</code>",
                 "q2_op4": "<code><-</code>",
                 "q3_text": "What data type would you typically use to store a whole number like <code>42</code>?",
                 "q3_op1": "<code>float</code>",
                 "q3_op2": "<code>int</code>",
                 "q3_op3": "<code>str</code>",
                 "q3_op4": "<code>bool</code>",
                 "q4_text": "Which data type is used to represent sequences of characters (text) in Python?",
                 "q4_op1": "<code>integer</code>",
                 "q4_op2": "<code>character</code>",
                 "q4_op3": "<code>float</code>",
                 "q4_op4": "<code>str</code>",
                 "q5_text": "If you run the code <code>type(3.14)</code>, what will be the output?",
                 "q5_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q5_op2": "<code>&lt;class 'string'&gt;</code>",
                 "q5_op3": "<code>&lt;class 'float'&gt;</code>",
                 "q5_op4": "<code>&lt;class 'number'&gt;</code>",
                 "q6_text": "Which of the following is a VALID variable name in Python?",
                 "q6_op1": "<code>user_age</code>",
                 "q6_op2": "<code>2users</code>",
                 "q6_op3": "<code>user-name</code>",
                 "q6_op4": "<code>class</code>",
                 "q7_text": "Consider the code: <code>x = 10</code> followed by <code>x = \"hello\"</code>. What is the data type of the variable <code>x</code> *after* the second line executes?",
                 "q7_op1": "<code>int</code>",
                 "q7_op2": "<code>float</code>",
                 "q7_op3": "Error, cannot change type",
                 "q7_op4": "<code>str</code>",
                 "q8_text": "What is the primary purpose of the assignment operator (<code>=</code>) in Python?",
                 "q8_op1": "To store the value on the right into the variable name on the left.",
                 "q8_op2": "To compare if two values are equal.",
                 "q8_op3": "To perform addition.",
                 "q8_op4": "To define a new function.",
                 "q9_text": "If you have the variable assignment <code>name = \"Alice\"</code>, what would <code>type(name)</code> return?",
                 "q9_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q9_op2": "<code>&lt;class 'str'&gt;</code>",
                 "q9_op3": "<code>&lt;class 'variable'&gt;</code>",
                 "q9_op4": "<code>&lt;class 'text'&gt;</code>",
                 "q10_text": "Which data type would Python use to store the value <code>\"99\"</code> (notice the double quotes)?",
                 "q10_op1": "<code>str</code>",
                 "q10_op2": "<code>int</code>",
                 "q10_op3": "<code>float</code>",
                 "q10_op4": "<code>number</code>",
             },
             pt: {
                 "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Variáveis e Tipos de Dados`,
                 "header_title": `Verificação: Módulo ${MODULE_ID}`,
                 "return_button": "Voltar ao Painel",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "intro_line1": "Teste seus conhecimentos do Módulo 1: Variáveis e Tipos de Dados.",
                 "intro_line2": `São <strong>${TOTAL_QUESTIONS} questões</strong>. Você precisa acertar pelo menos <strong>${PASSING_SCORE} questões</strong> para passar.`,
                 "intro_num_questions": `${TOTAL_QUESTIONS} questões`,
                 "intro_passing_score": `${PASSING_SCORE} questões`,
                 "intro_line3": "Você pode tentar esta verificação quantas vezes precisar.",
                 "submit_button": "Enviar Respostas",
                 "results_score": "Sua pontuação: {score}/{total}",
                 "results_pass": "<i class='fas fa-check-circle'></i> Parabéns! Você passou.",
                 "results_pass_info": "Conclusão do módulo registrada. Você pode retornar ao painel.",
                 "results_fail": "<i class='fas fa-times-circle'></i> Quase lá. Você precisava de {passingScore} respostas corretas.",
                 "results_fail_info": "Não se preocupe, revise o material e tente novamente!",
                 "try_again_button": "Tentar Novamente",
                 "back_dashboard_button": "Voltar ao Painel",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // Module 1 Questions & Options - PT
                 "q1_text": "O que é uma variável em programação?",
                 "q1_op1": "Um valor fixo que não pode mudar.",
                 "q1_op2": "Um contêiner nomeado usado para armazenar valores de dados.",
                 "q1_op3": "Um tipo de função.",
                 "q1_op4": "Um operador matemático.",
                 "q2_text": "Qual símbolo é usado para atribuir um valor a uma variável em Python?",
                 "q2_op1": "<code>=</code>",
                 "q2_op2": "<code>==</code>",
                 "q2_op3": "<code>:=</code>",
                 "q2_op4": "<code><-</code>",
                 "q3_text": "Que tipo de dado você normalmente usaria para armazenar um número inteiro como <code>42</code>?",
                 "q3_op1": "<code>float</code>",
                 "q3_op2": "<code>int</code>",
                 "q3_op3": "<code>str</code>",
                 "q3_op4": "<code>bool</code>",
                 "q4_text": "Qual tipo de dado é usado para representar sequências de caracteres (texto) em Python?",
                 "q4_op1": "<code>integer</code>",
                 "q4_op2": "<code>character</code>",
                 "q4_op3": "<code>float</code>",
                 "q4_op4": "<code>str</code>",
                 "q5_text": "Se você executar o código <code>type(3.14)</code>, qual será a saída?",
                 "q5_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q5_op2": "<code>&lt;class 'string'&gt;</code>",
                 "q5_op3": "<code>&lt;class 'float'&gt;</code>",
                 "q5_op4": "<code>&lt;class 'number'&gt;</code>",
                 "q6_text": "Qual dos seguintes é um nome de variável VÁLIDO em Python?",
                 "q6_op1": "<code>idade_usuario</code>", // (Translated user_age)
                 "q6_op2": "<code>2usuarios</code>",
                 "q6_op3": "<code>nome-usuario</code>",
                 "q6_op4": "<code>class</code>",
                 "q7_text": "Considere o código: <code>x = 10</code> seguido por <code>x = \"ola\"</code>. Qual é o tipo de dado da variável <code>x</code> *após* a execução da segunda linha?",
                 "q7_op1": "<code>int</code>",
                 "q7_op2": "<code>float</code>",
                 "q7_op3": "Erro, não pode mudar o tipo",
                 "q7_op4": "<code>str</code>",
                 "q8_text": "Qual é o propósito principal do operador de atribuição (<code>=</code>) em Python?",
                 "q8_op1": "Armazenar o valor à direita no nome da variável à esquerda.",
                 "q8_op2": "Comparar se dois valores são iguais.",
                 "q8_op3": "Realizar adição.",
                 "q8_op4": "Definir uma nova função.",
                 "q9_text": "Se você tem a atribuição de variável <code>nome = \"Alice\"</code>, o que <code>type(nome)</code> retornaria?",
                 "q9_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q9_op2": "<code>&lt;class 'str'&gt;</code>",
                 "q9_op3": "<code>&lt;class 'variable'&gt;</code>",
                 "q9_op4": "<code>&lt;class 'text'&gt;</code>",
                 "q10_text": "Qual tipo de dado o Python usaria para armazenar o valor <code>\"99\"</code> (note as aspas duplas)?",
                 "q10_op1": "<code>str</code>",
                 "q10_op2": "<code>int</code>",
                 "q10_op3": "<code>float</code>",
                 "q10_op4": "<code>number</code>",
             },
             zh: {
                 "page_title": `知识测验: 模块 ${MODULE_ID} - 变量与数据类型`,
                 "header_title": `知识测验: 模块 ${MODULE_ID}`,
                 "return_button": "返回仪表板",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "intro_line1": "测试您对模块 1: 变量与数据类型的掌握程度。",
                 "intro_line2": `共有 <strong>${TOTAL_QUESTIONS} 个问题</strong>。您需要至少答对 <strong>${PASSING_SCORE} 个问题</strong> 才能通过。`,
                 "intro_num_questions": `${TOTAL_QUESTIONS} 个问题`,
                 "intro_passing_score": `${PASSING_SCORE} 个问题`,
                 "intro_line3": "您可以根据需要多次尝试此测验。",
                 "submit_button": "提交答案",
                 "results_score": "您的得分: {score}/{total}",
                 "results_pass": "<i class='fas fa-check-circle'></i> 恭喜！您已通过。",
                 "results_pass_info": "模块完成状态已记录。您可以返回仪表板。",
                 "results_fail": "<i class='fas fa-times-circle'></i> 还需要努力。您需要答对 {passingScore} 题。",
                 "results_fail_info": "别担心，复习一下材料再试一次！",
                 "try_again_button": "再试一次",
                 "back_dashboard_button": "返回仪表板",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 // Module 1 Questions & Options - ZH
                 "q1_text": "在编程中，变量是什么？",
                 "q1_op1": "一个不能改变的固定值。",
                 "q1_op2": "一个用于存储数据值的命名容器。",
                 "q1_op3": "一种函数。",
                 "q1_op4": "一个数学运算符。",
                 "q2_text": "在 Python 中，哪个符号用于给变量赋值？",
                 "q2_op1": "<code>=</code>",
                 "q2_op2": "<code>==</code>",
                 "q2_op3": "<code>:=</code>",
                 "q2_op4": "<code><-</code>",
                 "q3_text": "您通常会使用哪种数据类型来存储像 <code>42</code> 这样的整数？",
                 "q3_op1": "<code>float</code> (浮点数)",
                 "q3_op2": "<code>int</code> (整数)",
                 "q3_op3": "<code>str</code> (字符串)",
                 "q3_op4": "<code>bool</code> (布尔值)",
                 "q4_text": "在 Python 中，哪种数据类型用于表示字符序列（文本）？",
                 "q4_op1": "<code>integer</code> (整数)",
                 "q4_op2": "<code>character</code> (字符)",
                 "q4_op3": "<code>float</code> (浮点数)",
                 "q4_op4": "<code>str</code> (字符串)",
                 "q5_text": "如果您运行代码 <code>type(3.14)</code>，输出会是什么？",
                 "q5_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q5_op2": "<code>&lt;class 'string'&gt;</code>",
                 "q5_op3": "<code>&lt;class 'float'&gt;</code>",
                 "q5_op4": "<code>&lt;class 'number'&gt;</code>",
                 "q6_text": "以下哪个是 Python 中的有效变量名？",
                 "q6_op1": "<code>user_age</code>",
                 "q6_op2": "<code>2users</code>",
                 "q6_op3": "<code>user-name</code>",
                 "q6_op4": "<code>class</code>",
                 "q7_text": "考虑代码：先执行 <code>x = 10</code>，然后执行 <code>x = \"hello\"</code>。在第二行执行后，变量 <code>x</code> 的数据类型是什么？",
                 "q7_op1": "<code>int</code>",
                 "q7_op2": "<code>float</code>",
                 "q7_op3": "错误，不能改变类型",
                 "q7_op4": "<code>str</code>",
                 "q8_text": "Python 中赋值运算符 (<code>=</code>) 的主要目的是什么？",
                 "q8_op1": "将右侧的值存储到左侧的变量名中。",
                 "q8_op2": "比较两个值是否相等。",
                 "q8_op3": "执行加法运算。",
                 "q8_op4": "定义一个新函数。",
                 "q9_text": "如果您进行了变量赋值 <code>name = \"Alice\"</code>，那么 <code>type(name)</code> 会返回什么？",
                 "q9_op1": "<code>&lt;class 'int'&gt;</code>",
                 "q9_op2": "<code>&lt;class 'str'&gt;</code>",
                 "q9_op3": "<code>&lt;class 'variable'&gt;</code>",
                 "q9_op4": "<code>&lt;class 'text'&gt;</code>",
                 "q10_text": "Python 会使用哪种数据类型来存储值 <code>\"99\"</code>（注意双引号）？",
                 "q10_op1": "<code>str</code>",
                 "q10_op2": "<code>int</code>",
                 "q10_op3": "<code>float</code>",
                 "q10_op4": "<code>number</code>",
             }
         };


        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const resultsArea = document.getElementById('results-area');
        const languageSelect = document.getElementById('languageSelect');
        const submitButton = quizForm.querySelector('.submit-button');

        // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {}; // Return empty object on error
            }
        }

        function saveKnowledgeCheckStatus(statusObject) {
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }

        // --- Translation Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            // Basic browser language detection fallback
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

         function getTranslation(key, lang, replacements = {}) {
             // Fallback chain: current lang -> English -> key name
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             // Replace placeholders like {score}
             for (const placeholder in replacements) {
                 // Use a regex to replace all occurrences globally
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }

        function translatePage(lang) {
            if (!translations[lang]) lang = 'en'; // Ensure lang exists

            // Update page lang attribute
            document.documentElement.lang = lang;

            // Translate elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang, {
                    total: TOTAL_QUESTIONS, // Make constants available if needed
                    passingScore: PASSING_SCORE
                 });

                // Handle elements potentially containing HTML (like intro line 2)
                if (el.tagName === 'TITLE') {
                    document.title = translation;
                } else if (translation.includes('<') && translation.includes('>')) {
                    el.innerHTML = translation; // Render HTML content
                } else {
                    el.textContent = translation; // Set as plain text
                }
            });

             // Translate elements with data-translate-placeholder
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });

             // Translate elements with data-translate-aria-label
            document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
            });

            // Update language selector value AFTER translations are potentially loaded
            if (languageSelect) languageSelect.value = lang;
        }

        // --- Quiz Rendering ---
        function renderQuiz(lang) {
            // Clear previous quiz content except the submit button
            const existingQuestions = quizForm.querySelectorAll('.question-block');
            existingQuestions.forEach(q => q.remove());

            quizData.forEach((item, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');

                const questionNumber = document.createElement('span');
                questionNumber.classList.add('question-number');
                questionNumber.textContent = `${index + 1}.`;

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                // Use innerHTML for question text to render potential <code> tags
                questionText.innerHTML = getTranslation(item.question_key, lang);

                const optionsList = document.createElement('ul');
                optionsList.classList.add('options-list');

                item.options_keys.forEach((optionKey, optionIndex) => {
                    const optionItem = document.createElement('li');
                    optionItem.classList.add('option-item');

                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = `q${index}`;
                    radioInput.value = optionIndex;
                    radioInput.id = `q${index}_op${optionIndex}`;

                    const label = document.createElement('label');
                    label.htmlFor = `q${index}_op${optionIndex}`;
                    // Use innerHTML for options text to render potential <code> tags
                    label.innerHTML = getTranslation(optionKey, lang);

                    // Prepend radio to label content if not using flexbox, or structure as needed
                    label.prepend(radioInput); // Prepend radio inside label for structure
                    optionItem.appendChild(label);
                    optionsList.appendChild(optionItem);
                });

                questionBlock.appendChild(questionNumber);
                questionBlock.appendChild(questionText);
                questionBlock.appendChild(optionsList);

                // Insert the question block before the submit button
                quizForm.insertBefore(questionBlock, submitButton);
            });

            // Reset form state and results
            quizForm.reset();
            submitButton.disabled = false;
            resultsArea.style.display = 'none';
            resultsArea.className = ''; // Remove pass/fail classes
            resultsArea.innerHTML = '';
        }

        // --- Quiz Submission and Results ---
        function handleSubmit(event) {
            event.preventDefault();
            let score = 0;
            const selectedAnswers = {}; // Store user's selections

            quizData.forEach((item, index) => {
                const selectedOption = quizForm.querySelector(`input[name="q${index}"]:checked`);
                if (selectedOption) {
                    const answerIndex = parseInt(selectedOption.value, 10);
                    selectedAnswers[`q${index}`] = answerIndex; // Store selection
                    if (answerIndex === item.correct_answer_index) {
                        score++;
                    }
                } else {
                     selectedAnswers[`q${index}`] = null; // Mark unanswered
                }
            });

            displayResults(score, getStoredLanguage()); // Display results in current language
        }

        function displayResults(score, lang) {
            const isPass = score >= PASSING_SCORE;
            resultsArea.innerHTML = ''; // Clear previous results
            resultsArea.className = isPass ? 'pass' : 'fail'; // Set class for styling

            const scoreText = document.createElement('p');
            scoreText.classList.add('score');
            scoreText.innerHTML = getTranslation('results_score', lang, { score: score, total: TOTAL_QUESTIONS });

            const statusText = document.createElement('p');
            statusText.classList.add('status');
            statusText.innerHTML = isPass ? getTranslation('results_pass', lang) : getTranslation('results_fail', lang, { passingScore: PASSING_SCORE });

            const infoText = document.createElement('p');
            infoText.classList.add('info');
            infoText.textContent = isPass ? getTranslation('results_pass_info', lang) : getTranslation('results_fail_info', lang);

            resultsArea.appendChild(scoreText);
            resultsArea.appendChild(statusText);
            resultsArea.appendChild(infoText);

            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('result-actions');

            if (isPass) {
                // Update LocalStorage on Pass
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[MODULE_ID] = true; // Mark this module as complete
                saveKnowledgeCheckStatus(currentStatus);

                // Add "Back to Dashboard" button
                const backButton = document.createElement('a');
                backButton.href = 'ctp-dashboard.html';
                backButton.classList.add('back-dashboard-button');
                backButton.textContent = getTranslation('back_dashboard_button', lang);
                actionsDiv.appendChild(backButton);

                submitButton.disabled = true; // Prevent resubmission after passing

            } else {
                // Add "Try Again" button
                const tryAgainButton = document.createElement('button');
                tryAgainButton.type = 'button'; // Important: prevent form submission
                tryAgainButton.classList.add('try-again-button');
                tryAgainButton.textContent = getTranslation('try_again_button', lang);
                tryAgainButton.addEventListener('click', () => {
                    renderQuiz(getStoredLanguage()); // Re-render the quiz
                });
                actionsDiv.appendChild(tryAgainButton);
            }

            resultsArea.appendChild(actionsDiv);
            resultsArea.style.display = 'block';
            resultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // --- Language Change Handler ---
        function handleLanguageChange(event) {
            const newLang = event.target.value;
            localStorage.setItem(LANGUAGE_STORAGE_KEY, newLang);
            translatePage(newLang);
            renderQuiz(newLang); // Re-render quiz with new language
             // Update language selector arrow color variable (needed if color comes from CSS var)
             const arrowColor = getComputedStyle(document.documentElement).getPropertyValue('--lang-arrow-color').trim().substring(1);
             languageSelect.style.backgroundImage = `url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(arrowColor)}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E')`;

        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            translatePage(initialLang); // Translate static elements first
            renderQuiz(initialLang);    // Then render the dynamic quiz elements

            // Attach event listeners
            quizForm.addEventListener('submit', handleSubmit);
            languageSelect.addEventListener('change', handleLanguageChange);
        });

    </script>

</body>
</html>