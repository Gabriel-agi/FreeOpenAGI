<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 27 - Search</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Using this for quiz elements too */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Return Button --- */
        .return-link {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .return-link:hover {
            background-color: rgba(255, 255, 255, 0.25);
            color: #fff;
        }
        .return-link i { margin-right: 5px; }

        /* --- Header --- */
        .quiz-header {
            background: var(--background-header); color: var(--text-light);
            padding: 2.5rem 1.5rem 1.5rem 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative; /* For return link positioning */
        }
        .quiz-header h1 {
            font-family: var(--font-title); font-size: 2rem;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        .quiz-header h1 i { margin-right: 10px; opacity: 0.8;}

        /* --- Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            width: 90%;
            margin: 0 auto 2rem auto;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2rem 2.5rem;
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Makes sure footer stays down */
        }

        .quiz-instructions {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            text-align: center;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1rem;
        }
        .quiz-instructions strong { color: var(--check-color); }

        /* --- Quiz Form --- */
        #quiz-form .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        #quiz-form .question-block:last-of-type {
            border-bottom: none;
            margin-bottom: 1rem; /* Less margin before submit */
            padding-bottom: 1rem;
        }

        .question-number {
            font-weight: 700;
            color: var(--primary-color);
            margin-right: 8px;
            font-size: 1.1em;
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
         .question-text code {
             background-color: #e9ecef; padding: 0.1em 0.4em; border-radius: 3px; font-size: 0.9em; color: #c7254e;
         }

        .options-container label {
            display: block;
            margin-bottom: 0.8rem;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            position: relative;
            padding-left: 35px; /* Space for radio */
        }
         .options-container label code {
             background-color: rgba(233, 236, 239, 0.7); padding: 0.1em 0.4em; border-radius: 3px; font-size: 0.9em; color: #c7254e;
         }

        .options-container input[type="radio"] {
           position: absolute;
           opacity: 0;
           pointer-events: none;
        }

        .options-container label::before { /* Custom radio button */
            content: '';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary-color);
            border-radius: 50%;
            transition: border-color 0.2s;
        }
        .options-container label::after { /* Custom radio button checkmark */
            content: '';
            position: absolute;
            left: 17px;
             top: 50%;
            transform: translateY(-50%) scale(0);
            width: 8px;
            height: 8px;
            background-color: var(--check-color);
            border-radius: 50%;
            transition: transform 0.2s ease-out;
        }

        .options-container input[type="radio"]:checked + label::before {
            border-color: var(--check-color);
        }
        .options-container input[type="radio"]:checked + label::after {
            transform: translateY(-50%) scale(1);
        }
        .options-container input[type="radio"]:focus + label::before {
             box-shadow: 0 0 0 2px rgba(111, 66, 193, 0.3); /* --check-color with alpha */
        }

        .options-container label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }

        .options-container input[type="radio"]:checked + label {
            border-color: var(--check-color);
            background-color: #f3effc; /* Lighter check color */
        }

        /* --- Submit Button --- */
        #submit-button {
            display: block;
            width: 100%;
            padding: 0.8rem 1.5rem;
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s;
            margin-top: 2rem;
        }
        #submit-button:hover {
            background-color: #5a37a0; /* Darker check color */
        }
         #submit-button:active {
             transform: scale(0.99);
         }
         #submit-button:disabled {
             background-color: var(--secondary-color);
             cursor: not-allowed;
             opacity: 0.7;
         }

        /* --- Result Area --- */
        #result-area {
            margin-top: 2.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden by default */
        }
        #result-area.result-pass {
            background-color: #d1e7dd; /* Light success */
            border: 1px solid #a3cfbb;
        }
        #result-area.result-fail {
            background-color: #f8d7da; /* Light error */
            border: 1px solid #f1aeb5;
        }

        #result-area h3 {
            font-family: var(--font-title);
            margin-bottom: 0.5rem;
        }
        #result-area p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }
        #result-area .score { font-weight: 700; font-size: 1.3em; }

        #result-area.result-pass h3 { color: var(--success-color); }
        #result-area.result-fail h3 { color: var(--error-color); }

        #retry-button {
            padding: 0.7rem 1.5rem;
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        #retry-button:hover {
            background-color: #0b5ed7;
        }

         /* --- Answer Highlighting --- */
         .options-container label.correct-answer {
             background-color: #d1e7dd !important; /* Light success */
             border-color: var(--success-color) !important;
             font-weight: 500;
         }
          .options-container label.correct-answer::after { /* Show checkmark */
            content: '\f00c'; /* Font Awesome check */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--success-color);
            font-size: 1.1em;
            background: none; /* Override custom radio */
            width: auto; height: auto; border-radius: 0;
         }
         .options-container label.incorrect-answer {
            background-color: #f8d7da !important; /* Light error */
            border-color: var(--error-color) !important;
         }
         /* Style for the user's WRONG selection */
         .options-container input[type="radio"]:checked + label.incorrect-answer {
             position: relative; /* Needed for the 'x' */
         }
         .options-container input[type="radio"]:checked + label.incorrect-answer::after {
            content: '\f00d'; /* Font Awesome times (X) */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--error-color);
            font-size: 1.1em;
            background: none; /* Override custom radio */
             width: auto; height: auto; border-radius: 0;
         }

         /* Hide custom radio dot when showing FA icons */
          .options-container label.correct-answer::after,
          .options-container input[type="radio"]:checked + label.incorrect-answer::after {
            transform: translateY(-50%) scale(1) !important; /* Ensure visible */
            left: auto; /* Override custom radio */
          }


        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .quiz-header h1 { font-size: 1.8rem; }
            .quiz-container { width: 95%; padding: 1.5rem; }
            .return-link { top: 10px; left: 10px; padding: 6px 12px; font-size: 0.85rem;}
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .quiz-header { padding: 2rem 1rem 1rem 1rem; }
            .quiz-header h1 { font-size: 1.6rem; }
            .quiz-container { padding: 1rem 1.2rem; }
             .options-container label { padding: 0.7rem 0.8rem; padding-left: 30px;}
             .options-container label::before { left: 8px; width: 16px; height: 16px;}
             .options-container label::after { left: 12px; width: 8px; height: 8px;}
            #submit-button, #retry-button { font-size: 1rem; padding: 0.7rem 1rem;}
            .return-link { display: none; } /* Hide on very small screens to avoid clutter */
        }
    </style>
</head>
<body>

    <header class="quiz-header">
         <a href="ctp-dashboard.html" class="return-link">
             <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
         </a>
        <h1 data-translate="header_title"><i class="fas fa-search"></i> Module 27: Search Algorithms</h1>
    </header>

    <main class="quiz-container">
        <p class="quiz-instructions" data-translate="quiz_instructions">
            Test your knowledge on Linear Search. You need <strong data-translate="passing_score">6 out of 10</strong> correct answers to pass. Good luck!
        </p>

        <form id="quiz-form">
            <!-- Questions will be loaded here by JavaScript -->
            <div id="questions-container"></div>

            <button type="submit" id="submit-button" data-translate="submit_button">Submit Answers</button>
        </form>

        <div id="result-area">
            <h3 id="result-title"></h3>
            <p><span data-translate="result_score_label">Your Score:</span> <span id="score-value" class="score">0</span> / 10</p>
            <p id="result-message"></p>
            <button id="retry-button" data-translate="retry_button">Retry Quiz</button>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const moduleId = 27;
        const passingScore = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Quiz Data for Module 27 ---
        const quizData = [
            {
                id: 0, // Unique ID for the question within this quiz
                question_key: "q27_1_text",
                options_keys: ["q27_1_op1", "q27_1_op2", "q27_1_op3", "q27_1_op4"],
                correctAnswerIndex: 0 // Index of the correct option
            },
            {
                id: 1,
                question_key: "q27_2_text",
                options_keys: ["q27_2_op1", "q27_2_op2", "q27_2_op3", "q27_2_op4"],
                correctAnswerIndex: 1
            },
             {
                id: 2,
                question_key: "q27_3_text",
                options_keys: ["q27_3_op1", "q27_3_op2", "q27_3_op3", "q27_3_op4"],
                correctAnswerIndex: 0
            },
             {
                id: 3,
                question_key: "q27_4_text",
                options_keys: ["q27_4_op1", "q27_4_op2", "q27_4_op3", "q27_4_op4"],
                correctAnswerIndex: 2
            },
             {
                id: 4,
                question_key: "q27_5_text",
                options_keys: ["q27_5_op1", "q27_5_op2", "q27_5_op3", "q27_5_op4"],
                correctAnswerIndex: 3
            },
            {
                id: 5,
                question_key: "q27_6_text",
                options_keys: ["q27_6_op1", "q27_6_op2", "q27_6_op3", "q27_6_op4"],
                correctAnswerIndex: 1
            },
             {
                id: 6,
                question_key: "q27_7_text",
                options_keys: ["q27_7_op1", "q27_7_op2", "q27_7_op3", "q27_7_op4"],
                correctAnswerIndex: 0
            },
             {
                id: 7,
                question_key: "q27_8_text",
                options_keys: ["q27_8_op1", "q27_8_op2", "q27_8_op3", "q27_8_op4"],
                correctAnswerIndex: 3
            },
             {
                id: 8,
                question_key: "q27_9_text",
                options_keys: ["q27_9_op1", "q27_9_op2", "q27_9_op3", "q27_9_op4"],
                correctAnswerIndex: 2
            },
             {
                id: 9,
                question_key: "q27_10_text",
                options_keys: ["q27_10_op1", "q27_10_op2", "q27_10_op3", "q27_10_op4"],
                correctAnswerIndex: 1
            }
        ];

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": "Knowledge Check: Module 27 - Search",
                 "return_button": "Return to Dashboard",
                 "header_title": "Module 27: Search Algorithms",
                 "quiz_instructions": "Test your knowledge on Linear Search. You need {score} out of {total} correct answers to pass. Good luck!",
                 "passing_score": "6",
                 "total_questions": "10", // Added for flexibility in instructions
                 "submit_button": "Submit Answers",
                 "retry_button": "Retry Quiz",
                 "result_score_label": "Your Score:",
                 "result_pass_title": "Congratulations!",
                 "result_fail_title": "Keep Trying!",
                 "result_pass_message": "You passed the knowledge check for Module {modId}! Your progress has been saved.",
                 "result_fail_message": "You need {passingScore} correct answers to pass. Review the material and try again!",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 // Module 27 Questions & Options (English)
                 "q27_1_text": "What is the primary characteristic of a linear search?",
                 "q27_1_op1": "It checks each element sequentially from the beginning.",
                 "q27_1_op2": "It requires the list to be sorted beforehand.",
                 "q27_1_op3": "It divides the list in half repeatedly.",
                 "q27_1_op4": "It uses a hash function to find the element.",
                 "q27_2_text": "What is the time complexity of linear search in the worst-case scenario?",
                 "q27_2_op1": "O(1) - Constant time",
                 "q27_2_op2": "O(n) - Linear time",
                 "q27_2_op3": "O(log n) - Logarithmic time",
                 "q27_2_op4": "O(n^2) - Quadratic time",
                 "q27_3_text": "Does a linear search algorithm require the data collection (e.g., list) to be sorted?",
                 "q27_3_op1": "No, it works on both sorted and unsorted lists.",
                 "q27_3_op2": "Yes, it only works correctly on sorted lists.",
                 "q27_3_op3": "It depends on the data type being searched.",
                 "q27_3_op4": "It works better on sorted lists, but doesn't require it.",
                 "q27_4_text": "When does the best-case scenario occur for a linear search?",
                 "q27_4_op1": "When the item is not found in the list.",
                 "q27_4_op2": "When the list is empty.",
                 "q27_4_op3": "When the item being searched for is the first element.",
                 "q27_4_op4": "When the item being searched for is the last element.",
                 "q27_5_text": "When does the worst-case scenario occur for a linear search (assuming the item *is* in the list)?",
                 "q27_5_op1": "When the list is very small.",
                 "q27_5_op2": "When the item being searched for is the first element.",
                 "q27_5_op3": "When the item is near the middle of the list.",
                 "q27_5_op4": "When the item being searched for is the last element.",
                 "q27_6_text": "What typically happens in a linear search function if the target item is NOT found in the list?",
                 "q27_6_op1": "The function causes an error.",
                 "q27_6_op2": "The loop completes, and it returns a special value (like -1 or False).",
                 "q27_6_op3": "The function returns the last element checked.",
                 "q27_6_op4": "The program waits for user input.",
                 "q27_7_text": "Consider the list `numbers = [10, 50, 30, 70, 20]`. How many comparisons are needed to find the value `30` using linear search?",
                 "q27_7_op1": "3 comparisons (checks 10, 50, then finds 30)",
                 "q27_7_op2": "2 comparisons (checks 10, then 50)",
                 "q27_7_op3": "5 comparisons (checks the whole list)",
                 "q27_7_op4": "1 comparison (it knows where 30 is)",
                 "q27_8_text": "Linear search is generally considered less efficient than binary search for large datasets. Why?",
                 "q27_8_op1": "Linear search uses more memory.",
                 "q27_8_op2": "Linear search code is harder to write.",
                 "q27_8_op3": "Binary search works on unsorted lists.",
                 "q27_8_op4": "Binary search reduces the search space much faster (O(log n) vs O(n)).",
                 "q27_9_text": "In which situation would linear search be a reasonable choice?",
                 "q27_9_op1": "Searching a database with millions of sorted records.",
                 "q27_9_op2": "When you need the absolute fastest search possible.",
                 "q27_9_op3": "Searching a small or unsorted list.",
                 "q27_9_op4": "When memory usage is the primary concern.",
                "q27_10_text": "If a list has `n` elements, what is the maximum number of comparisons a linear search might perform to find an element or determine it's not present?",
                 "q27_10_op1": "n / 2 comparisons",
                 "q27_10_op2": "n comparisons",
                 "q27_10_op3": "log n comparisons",
                 "q27_10_op4": "1 comparison"
             },
             pt: {
                 "page_title": "Verificação de Conhecimento: Módulo 27 - Busca",
                 "return_button": "Voltar ao Painel",
                 "header_title": "Módulo 27: Algoritmos de Busca",
                 "quiz_instructions": "Teste seus conhecimentos sobre Busca Linear. Você precisa de {score} de {total} respostas corretas para passar. Boa sorte!",
                  "passing_score": "6",
                 "total_questions": "10",
                 "submit_button": "Enviar Respostas",
                 "retry_button": "Tentar Novamente",
                 "result_score_label": "Sua Pontuação:",
                 "result_pass_title": "Parabéns!",
                 "result_fail_title": "Continue Tentando!",
                 "result_pass_message": "Você passou na verificação de conhecimento do Módulo {modId}! Seu progresso foi salvo.",
                 "result_fail_message": "Você precisa de {passingScore} respostas corretas para passar. Revise o material e tente novamente!",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // Module 27 Questions & Options (Portuguese)
                 "q27_1_text": "Qual é a característica principal de uma busca linear?",
                 "q27_1_op1": "Verifica cada elemento sequencialmente desde o início.",
                 "q27_1_op2": "Requer que a lista esteja ordenada previamente.",
                 "q27_1_op3": "Divide a lista pela metade repetidamente.",
                 "q27_1_op4": "Usa uma função hash para encontrar o elemento.",
                 "q27_2_text": "Qual é a complexidade de tempo da busca linear no pior cenário?",
                 "q27_2_op1": "O(1) - Tempo constante",
                 "q27_2_op2": "O(n) - Tempo linear",
                 "q27_2_op3": "O(log n) - Tempo logarítmico",
                 "q27_2_op4": "O(n^2) - Tempo quadrático",
                 "q27_3_text": "Um algoritmo de busca linear exige que a coleção de dados (ex: lista) esteja ordenada?",
                 "q27_3_op1": "Não, funciona tanto em listas ordenadas quanto desordenadas.",
                 "q27_3_op2": "Sim, só funciona corretamente em listas ordenadas.",
                 "q27_3_op3": "Depende do tipo de dado sendo buscado.",
                 "q27_3_op4": "Funciona melhor em listas ordenadas, mas não exige.",
                 "q27_4_text": "Quando ocorre o melhor cenário para uma busca linear?",
                 "q27_4_op1": "Quando o item não é encontrado na lista.",
                 "q27_4_op2": "Quando a lista está vazia.",
                 "q27_4_op3": "Quando o item procurado é o primeiro elemento.",
                 "q27_4_op4": "Quando o item procurado é o último elemento.",
                 "q27_5_text": "Quando ocorre o pior cenário para uma busca linear (assumindo que o item *está* na lista)?",
                 "q27_5_op1": "Quando a lista é muito pequena.",
                 "q27_5_op2": "Quando o item procurado é o primeiro elemento.",
                 "q27_5_op3": "Quando o item está perto do meio da lista.",
                 "q27_5_op4": "Quando o item procurado é o último elemento.",
                 "q27_6_text": "O que geralmente acontece em uma função de busca linear se o item alvo NÃO for encontrado na lista?",
                 "q27_6_op1": "A função causa um erro.",
                 "q27_6_op2": "O loop termina, e retorna um valor especial (como -1 ou False).",
                 "q27_6_op3": "A função retorna o último elemento verificado.",
                 "q27_6_op4": "O programa espera por entrada do usuário.",
                 "q27_7_text": "Considere a lista `numeros = [10, 50, 30, 70, 20]`. Quantas comparações são necessárias para encontrar o valor `30` usando busca linear?",
                 "q27_7_op1": "3 comparações (verifica 10, 50, então encontra 30)",
                 "q27_7_op2": "2 comparações (verifica 10, depois 50)",
                 "q27_7_op3": "5 comparações (verifica a lista toda)",
                 "q27_7_op4": "1 comparação (ele sabe onde 30 está)",
                 "q27_8_text": "A busca linear é geralmente considerada menos eficiente que a busca binária para grandes conjuntos de dados. Por quê?",
                 "q27_8_op1": "A busca linear usa mais memória.",
                 "q27_8_op2": "O código da busca linear é mais difícil de escrever.",
                 "q27_8_op3": "A busca binária funciona em listas desordenadas.",
                 "q27_8_op4": "A busca binária reduz o espaço de busca muito mais rápido (O(log n) vs O(n)).",
                 "q27_9_text": "Em qual situação a busca linear seria uma escolha razoável?",
                 "q27_9_op1": "Buscar em um banco de dados com milhões de registros ordenados.",
                 "q27_9_op2": "Quando você precisa da busca mais rápida possível.",
                 "q27_9_op3": "Buscar em uma lista pequena ou desordenada.",
                 "q27_9_op4": "Quando o uso de memória é a principal preocupação.",
                 "q27_10_text": "Se uma lista tem `n` elementos, qual é o número máximo de comparações que uma busca linear pode realizar para encontrar um elemento ou determinar que ele não está presente?",
                 "q27_10_op1": "n / 2 comparações",
                 "q27_10_op2": "n comparações",
                 "q27_10_op3": "log n comparações",
                 "q27_10_op4": "1 comparação"
             },
             zh: {
                 "page_title": "知识测验：模块 27 - 搜索",
                 "return_button": "返回仪表板",
                 "header_title": "模块 27：搜索算法",
                 "quiz_instructions": "测试您对线性搜索的了解。您需要答对 {total} 题中的 {score} 题才能通过。祝您好运！",
                  "passing_score": "6",
                 "total_questions": "10",
                 "submit_button": "提交答案",
                 "retry_button": "重试测验",
                 "result_score_label": "您的得分：",
                 "result_pass_title": "恭喜！",
                 "result_fail_title": "再接再厉！",
                 "result_pass_message": "您已通过模块 {modId} 的知识测验！您的进度已保存。",
                 "result_fail_message": "您需要答对 {passingScore} 题才能通过。请复习内容后重试！",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 // Module 27 Questions & Options (Chinese)
                 "q27_1_text": "线性搜索的主要特点是什么？",
                 "q27_1_op1": "它从头开始按顺序检查每个元素。",
                 "q27_1_op2": "它要求列表事先排序。",
                 "q27_1_op3": "它反复将列表分成两半。",
                 "q27_1_op4": "它使用哈希函数来查找元素。",
                 "q27_2_text": "在最坏情况下，线性搜索的时间复杂度是多少？",
                 "q27_2_op1": "O(1) - 常数时间",
                 "q27_2_op2": "O(n) - 线性时间",
                 "q27_2_op3": "O(log n) - 对数时间",
                 "q27_2_op4": "O(n^2) - 平方时间",
                 "q27_3_text": "线性搜索算法是否要求数据集（例如列表）已排序？",
                 "q27_3_op1": "否，它适用于排序和未排序的列表。",
                 "q27_3_op2": "是，它仅在排序列表上才能正确工作。",
                 "q27_3_op3": "这取决于被搜索的数据类型。",
                 "q27_3_op4": "它在排序列表上效果更好，但不是必需的。",
                 "q27_4_text": "线性搜索的最佳情况发生在什么时候？",
                 "q27_4_op1": "当列表中找不到该项时。",
                 "q27_4_op2": "当列表为空时。",
                 "q27_4_op3": "当要搜索的项是第一个元素时。",
                 "q27_4_op4": "当要搜索的项是最后一个元素时。",
                 "q27_5_text": "线性搜索的最坏情况发生在什么时候（假设该项*确实*在列表中）？",
                 "q27_5_op1": "当列表非常小时。",
                 "q27_5_op2": "当要搜索的项是第一个元素时。",
                 "q27_5_op3": "当该项位于列表的中间附近时。",
                 "q27_5_op4": "当要搜索的项是最后一个元素时。",
                 "q27_6_text": "如果在线性搜索函数中未找到目标项，通常会发生什么？",
                 "q27_6_op1": "函数引发错误。",
                 "q27_6_op2": "循环完成，并返回一个特殊值（如 -1 或 False）。",
                 "q27_6_op3": "函数返回检查的最后一个元素。",
                 "q27_6_op4": "程序等待用户输入。",
                 "q27_7_text": "考虑列表 `numbers = [10, 50, 30, 70, 20]`。使用线性搜索找到值 `30` 需要多少次比较？",
                 "q27_7_op1": "3 次比较（检查 10, 50，然后找到 30）",
                 "q27_7_op2": "2 次比较（检查 10，然后 50）",
                 "q27_7_op3": "5 次比较（检查整个列表）",
                 "q27_7_op4": "1 次比较（它知道 30 在哪里）",
                 "q27_8_text": "对于大型数据集，线性搜索通常被认为效率低于二分搜索。为什么？",
                 "q27_8_op1": "线性搜索使用更多内存。",
                 "q27_8_op2": "线性搜索的代码更难编写。",
                 "q27_8_op3": "二分搜索适用于未排序的列表。",
                 "q27_8_op4": "二分搜索能更快地缩小搜索范围 (O(log n) vs O(n))。",
                 "q27_9_text": "在哪种情况下，线性搜索是一个合理的选择？",
                 "q27_9_op1": "搜索包含数百万条排序记录的数据库。",
                 "q27_9_op2": "当您需要绝对最快的搜索时。",
                 "q27_9_op3": "搜索小型或未排序的列表。",
                 "q27_9_op4": "当内存使用是主要考虑因素时。",
                 "q27_10_text": "如果一个列表有 `n` 个元素，线性搜索最多可能执行多少次比较来查找一个元素或确定它不存在？",
                 "q27_10_op1": "n / 2 次比较",
                 "q27_10_op2": "n 次比较",
                 "q27_10_op3": "log n 次比较",
                 "q27_10_op4": "1 次比较"
             }
         };

        // --- Translation & Utility Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            // Basic check: Add more languages if needed in translations object
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
             if (browserLang.startsWith('pt')) return 'pt';
             if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default
        }

         function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            // Replace placeholders like {score}, {total}, {modId}, {passingScore}
            replacements.score = replacements.score !== undefined ? replacements.score : passingScore;
            replacements.total = replacements.total !== undefined ? replacements.total : quizData.length;
            replacements.modId = replacements.modId !== undefined ? replacements.modId : moduleId;
            replacements.passingScore = replacements.passingScore !== undefined ? replacements.passingScore : passingScore;

            for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }


        function translatePage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
             document.documentElement.lang = lang;

            document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const replacements = {};
                 // Check if this element has specific replacement needs based on its key or attributes
                 // (e.g., passing score in instructions)
                 if (key === 'quiz_instructions') {
                      replacements.score = getTranslation('passing_score', lang);
                      replacements.total = getTranslation('total_questions', lang);
                 }

                 const translation = getTranslation(key, lang, replacements);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'BUTTON' || el.tagName === 'A' ) { // Handle buttons/links text
                     // Only update text content, keep potential icons
                     const icon = el.querySelector('i');
                     el.textContent = translation; // Set text first
                     if (icon) { el.prepend(icon, ' '); } // Add icon back if it existed
                 }
                 else if (translation.includes('<') && translation.includes('>')) { // Allow HTML in translations
                      el.innerHTML = translation;
                 } else {
                      el.textContent = translation;
                 }
            });
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); });
        }

        // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {}; // Return empty object on error
            }
        }

        function saveKnowledgeCheckStatus(moduleIdPassed) {
            const currentStatus = loadKnowledgeCheckStatus();
            currentStatus[moduleIdPassed] = true; // Mark this module as passed
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                console.log(`Knowledge check status saved for module ${moduleIdPassed}.`);
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }


        // --- Quiz Logic ---
        const quizForm = document.getElementById('quiz-form');
        const questionsContainer = document.getElementById('questions-container');
        const submitButton = document.getElementById('submit-button');
        const resultArea = document.getElementById('result-area');
        const resultTitle = document.getElementById('result-title');
        const scoreValue = document.getElementById('score-value');
        const resultMessage = document.getElementById('result-message');
        const retryButton = document.getElementById('retry-button');

        function displayQuiz() {
             const lang = getStoredLanguage();
             questionsContainer.innerHTML = ''; // Clear previous questions if any
             resultArea.style.display = 'none'; // Hide result area
             submitButton.disabled = false; // Enable submit button
             quizForm.reset(); // Clear any previous selections

            quizData.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                 questionBlock.setAttribute('data-question-id', q.id);

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                 // Add question number dynamically
                 const qNumSpan = document.createElement('span');
                 qNumSpan.classList.add('question-number');
                 qNumSpan.textContent = `${index + 1}.`;
                 questionText.appendChild(qNumSpan);
                 // Add question text, allowing HTML from translation
                 const qTextSpan = document.createElement('span');
                 qTextSpan.innerHTML = ` ${getTranslation(q.question_key, lang)}`; // Note space after number
                 questionText.appendChild(qTextSpan);


                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options-container');

                q.options_keys.forEach((optionKey, optionIndex) => {
                    const optionId = `q${q.id}_op${optionIndex}`;

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = optionId;
                    input.name = `q${q.id}`; // Group radios for the same question
                    input.value = optionIndex; // Store the index as the value
                    input.required = true; // Make sure an option is selected

                    const label = document.createElement('label');
                    label.htmlFor = optionId;
                    // Allow HTML in option text
                     label.innerHTML = getTranslation(optionKey, lang);
                     label.setAttribute('data-option-index', optionIndex); // Store index for checking later

                    optionsDiv.appendChild(input);
                    optionsDiv.appendChild(label);
                });

                questionBlock.appendChild(questionText);
                questionBlock.appendChild(optionsDiv);
                questionsContainer.appendChild(questionBlock);
            });
        }

        function handleSubmit(event) {
            event.preventDefault(); // Prevent page reload
            const lang = getStoredLanguage();
            let score = 0;

            // Disable form elements
            submitButton.disabled = true;
            const radioButtons = quizForm.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(rb => rb.disabled = true);


            quizData.forEach(q => {
                const questionBlock = questionsContainer.querySelector(`.question-block[data-question-id="${q.id}"]`);
                 const optionsContainer = questionBlock.querySelector('.options-container');
                const selectedOption = quizForm.querySelector(`input[name="q${q.id}"]:checked`);
                 const allLabels = optionsContainer.querySelectorAll('label');

                 // Remove previous highlights if any (useful for retry without full redraw)
                 allLabels.forEach(lbl => {
                     lbl.classList.remove('correct-answer', 'incorrect-answer');
                 });


                if (selectedOption) {
                     const selectedIndex = parseInt(selectedOption.value, 10);
                     const correctIndex = q.correctAnswerIndex;
                     const selectedLabel = optionsContainer.querySelector(`label[for="${selectedOption.id}"]`);
                     const correctLabel = optionsContainer.querySelector(`label[data-option-index="${correctIndex}"]`);

                    if (selectedIndex === correctIndex) {
                        score++;
                        selectedLabel.classList.add('correct-answer');
                    } else {
                        selectedLabel.classList.add('incorrect-answer');
                         if(correctLabel) { // Highlight the correct one as well if user was wrong
                            correctLabel.classList.add('correct-answer');
                         }
                    }
                 } else {
                      // If somehow no option was selected (shouldn't happen with 'required')
                      // Optionally highlight the correct answer anyway
                       const correctLabel = optionsContainer.querySelector(`label[data-option-index="${q.correctAnswerIndex}"]`);
                       if(correctLabel) correctLabel.classList.add('correct-answer');
                 }
            });

            displayResult(score, lang);
        }

         function displayResult(score, lang) {
             const passed = score >= passingScore;
             resultArea.style.display = 'block'; // Show results
             resultArea.className = passed ? 'result-pass' : 'result-fail'; // Add class for styling
             scoreValue.textContent = score;

             if (passed) {
                 resultTitle.textContent = getTranslation('result_pass_title', lang);
                 resultMessage.textContent = getTranslation('result_pass_message', lang, { modId: moduleId });
                 saveKnowledgeCheckStatus(moduleId); // Save progress ONLY IF PASSED
             } else {
                 resultTitle.textContent = getTranslation('result_fail_title', lang);
                 resultMessage.textContent = getTranslation('result_fail_message', lang, { passingScore: passingScore });
             }
             // Scroll to results smoothly
             resultArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
         }


        function retryQuiz() {
             // Re-enable radio buttons
            const radioButtons = quizForm.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(rb => rb.disabled = false);

            // Remove highlighting
             const allLabels = questionsContainer.querySelectorAll('.options-container label');
            allLabels.forEach(lbl => {
                lbl.classList.remove('correct-answer', 'incorrect-answer');
            });

            displayQuiz(); // Redisplay (clears form, hides result)
             // Scroll back to top smoothly
             window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const currentLang = getStoredLanguage();
            translatePage(currentLang); // Translate static elements first
            displayQuiz(); // Then display the questions in the correct language

            quizForm.addEventListener('submit', handleSubmit);
            retryButton.addEventListener('click', retryQuiz);
        });

    </script>

</body>
</html>
