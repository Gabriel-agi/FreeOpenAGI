<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 27 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard, potentially prune unused) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for quiz elements */
            --certificate-color: #d63384;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Quiz Header --- */
        .quiz-page-header {
            background: var(--background-header); color: var(--text-light);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative; /* For absolute positioning of back button */
        }
        .quiz-page-header h1 {
            font-family: var(--font-title); font-size: 1.6rem; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            margin: 0; /* Reset margin */
            text-align: center;
            flex-grow: 1; /* Allow title to take space */
        }
        .back-to-dashboard {
            position: absolute; /* Position relative to header */
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.4rem 0.8rem;
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 5px;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            display: inline-flex; /* Align icon and text */
            align-items: center;
        }
        .back-to-dashboard i { margin-right: 5px; }
        .back-to-dashboard:hover { background-color: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.8); }
        .language-switcher-header {
             position: absolute; /* Position relative to header */
             right: 1.5rem;
             top: 50%;
             transform: translateY(-50%);
        }
         .language-switcher-header #languageSelect {
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         .language-switcher-header #languageSelect:hover { border-color: #e73ca8; background-color: var(--lang-select-bg-hover); }
         .language-switcher-header #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         .language-switcher-header #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto 2rem auto; /* Center and add bottom margin */
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Allow container to grow */
        }

        /* --- Quiz Elements --- */
        .quiz-instructions {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.95rem;
            color: var(--text-muted);
        }
        .quiz-instructions strong { color: var(--text-dark); }
        .quiz-instructions code { font-size: 0.9em; background: #eee; padding: 1px 4px; border-radius: 3px; }

        .already-passed-message {
            background-color: #e8f5e9; /* Light green */
            color: var(--success-color);
            border: 1px solid var(--success-color);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 500;
        }
        .already-passed-message i { margin-right: 8px; }

        #question-area { margin-bottom: 2rem; }
        #question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }
        .answer-options { list-style: none; padding: 0; margin: 0; }
        .answer-options li { margin-bottom: 0.8rem; }
        .answer-options label {
            display: block;
            padding: 0.8rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            font-size: 1rem;
        }
        .answer-options input[type="radio"] { margin-right: 10px; vertical-align: middle; }
        .answer-options label:hover { background-color: #f8f9fa; border-color: var(--secondary-color); }
        .answer-options input[type="radio"]:checked + label {
            background-color: #e7f1ff; /* Light blue */
            border-color: var(--primary-color);
            font-weight: 500;
        }
        /* Hide actual radio button, style label */
        .answer-options input[type="radio"] { position: absolute; opacity: 0; pointer-events: none; }

        #quiz-navigation { text-align: right; margin-top: 1.5rem; }
        #progress-indicator {
            font-size: 0.9rem; color: var(--text-muted);
            float: left; /* Position to the left */
            line-height: 2.5; /* Align vertically with button */
        }
        #next-button, #submit-button, #retry-button { /* Shared styles */
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), opacity var(--transition-speed);
            min-width: 120px;
        }
        #next-button:hover, #submit-button:hover, #retry-button:hover { background-color: #5a35a5; }
        #next-button:disabled, #submit-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }
        #submit-button, #retry-button { display: none; } /* Initially hidden */

        #results-area {
            display: none; /* Hidden initially */
            text-align: center;
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
        }
        #results-area h3 { font-family: var(--font-title); margin-bottom: 1rem; }
        #score-display { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        #pass-fail-message { font-size: 1.1rem; margin-bottom: 1.5rem; }
        #pass-fail-message.pass { color: var(--success-color); font-weight: 700; }
        #pass-fail-message.fail { color: var(--error-color); font-weight: 700; }
        #results-area #retry-button { display: inline-block; /* Make retry visible when results show */ margin-top: 1rem; }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Push to bottom */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design (Simplified for Quiz) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .quiz-page-header h1 { font-size: 1.4rem; text-align: left; margin-left: 60px; /* Space for back button */ margin-right: 60px; /* Space for lang switch */}
            .back-to-dashboard { left: 1rem; padding: 0.3rem 0.6rem; font-size: 0.85rem; }
            .language-switcher-header { right: 1rem; }
            .language-switcher-header #languageSelect { padding: 4px 25px 4px 8px; font-size: 0.85rem; }
            .quiz-container { padding: 1.5rem; margin-left: 1rem; margin-right: 1rem; }
            #question-text { font-size: 1.1rem; }
            .answer-options label { padding: 0.7rem 1rem; font-size: 0.95rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .quiz-page-header h1 { font-size: 1.2rem; margin-left: 50px; margin-right: 50px; }
            .quiz-container { padding: 1rem; margin-left: 0.5rem; margin-right: 0.5rem;}
            #question-text { font-size: 1rem; }
            .answer-options label { padding: 0.6rem 0.8rem; font-size: 0.9rem; }
            #next-button, #submit-button, #retry-button { padding: 0.6rem 1.2rem; font-size: 0.9rem; }
            #progress-indicator { display: block; float: none; text-align: center; margin-bottom: 0.5rem; line-height: normal;}
            #quiz-navigation { text-align: center; }
             .back-to-dashboard span { display: none; } /* Hide text on very small screens */
             .back-to-dashboard i { margin-right: 0; }
             .language-switcher-header { top: auto; bottom: 10px; transform: none; right: 1rem; } /* Move lang switch down if needed */
        }

    </style>
</head>
<body>

    <header class="quiz-page-header">
        <a href="ctp-dashboard.html" class="back-to-dashboard">
            <i class="fas fa-arrow-left"></i> <span data-translate="back_button">Back to Dashboard</span>
        </a>
        <h1 data-translate="quiz_header_title">Module 27: Linear Search</h1>
        <div class="language-switcher-header">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 EN</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 PT</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 ZH</option>
            </select>
        </div>
    </header>

    <main class="quiz-container">

        <div id="already-passed" class="already-passed-message" style="display: none;">
             <i class="fas fa-check-circle"></i> <span data-translate="already_passed_message">You have already passed this knowledge check!</span>
        </div>

        <div class="quiz-instructions">
            <p data-translate="quiz_instructions_p1">Test your knowledge of Module 27 content.</p>
            <p data-translate="quiz_instructions_p2">There are <strong>10 questions</strong>. You need to answer at least <strong>6 questions</strong> correctly to pass.</p>
            <p data-translate="quiz_instructions_p3">You can attempt this check as many times as you like. Passing will mark this module as complete on your dashboard.</p>
        </div>

        <div id="quiz-content"> <!-- Wrapper for quiz elements to hide/show easily -->
            <div id="question-area">
                <p id="question-text">Loading question...</p>
                <ul id="answer-options" class="answer-options">
                    <!-- Options will be loaded by JS -->
                </ul>
            </div>

            <div id="quiz-navigation">
                <span id="progress-indicator">Question 1 / 10</span>
                <button id="next-button" data-translate="next_button" disabled>Next Question</button>
                <button id="submit-button" data-translate="submit_button">Submit Quiz</button> <!-- Hidden initially -->
            </div>
        </div>

        <div id="results-area">
            <h3 data-translate="results_title">Quiz Results</h3>
            <p id="score-display">Your Score: 0 / 10</p>
            <p id="pass-fail-message" class="fail">Keep trying!</p>
            <button id="retry-button" data-translate="retry_button">Retry Quiz</button> <!-- Hidden initially -->
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Constants ---
        const MODULE_ID = 27; // *** IMPORTANT: Change this for each module's check ***
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Quiz Data (Module 27: Linear Search) ---
        const quizData = {
            en: [
                { question: "What is the primary goal of a linear search algorithm?", options: ["To sort a list efficiently", "To find the smallest element in a list", "To check if a specific item exists in a list", "To reverse the order of a list"], answer: 2 },
                { question: "How does linear search check for an item in a list?", options: ["It jumps to the middle element first", "It checks each element one by one from the start", "It compares elements in pairs", "It only checks elements at odd indices"], answer: 1 },
                { question: "What is the best-case scenario for linear search?", options: ["The item is not in the list", "The list is already sorted", "The item is the very first element", "The item is the last element"], answer: 2 },
                { question: "What is the worst-case scenario for linear search in terms of comparisons?", options: ["1 comparison", "log(n) comparisons", "n/2 comparisons", "n comparisons (where n is the list size)"], answer: 3 },
                { question: "What is the time complexity of linear search?", options: ["O(1)", "O(log n)", "O(n)", "O(n^2)"], answer: 2 },
                { question: "Linear search is most suitable for which type of list?", options: ["Only very large lists", "Only lists sorted in descending order", "Small lists or unsorted lists", "Lists containing only numbers"], answer: 2 },
                { question: "If the item being searched for is NOT present in the list, how many elements will linear search typically examine?", options: ["Zero", "One", "About half the elements", "All the elements"], answer: 3 },
                { question: "Consider the code: `found = False; for item in my_list: if item == target: found = True; break`. What algorithm does this represent?", options: ["Binary Search", "Bubble Sort", "Selection Sort", "Linear Search"], answer: 3 },
                { question: "What is a key disadvantage of linear search compared to binary search?", options: ["It's much harder to implement", "It only works on numbers", "It requires the list to be sorted", "It is generally slower for large, sorted lists"], answer: 3 },
                { question: "Does linear search modify the original list while searching?", options: ["Yes, it removes elements as it checks them", "Yes, it sorts the list first", "No, it only reads the elements", "Sometimes, depending on the item"], answer: 2 }
            ],
            pt: [
                 { question: "Qual é o objetivo principal de um algoritmo de busca linear?", options: ["Ordenar uma lista eficientemente", "Encontrar o menor elemento em uma lista", "Verificar se um item específico existe em uma lista", "Inverter a ordem de uma lista"], answer: 2 },
                 { question: "Como a busca linear verifica um item em uma lista?", options: ["Salta para o elemento do meio primeiro", "Verifica cada elemento um por um desde o início", "Compara elementos em pares", "Verifica apenas elementos em índices ímpares"], answer: 1 },
                 { question: "Qual é o melhor cenário para a busca linear?", options: ["O item não está na lista", "A lista já está ordenada", "O item é o primeiro elemento", "O item é o último elemento"], answer: 2 },
                 { question: "Qual é o pior cenário para a busca linear em termos de comparações?", options: ["1 comparação", "log(n) comparações", "n/2 comparações", "n comparações (onde n é o tamanho da lista)"], answer: 3 },
                 { question: "Qual é a complexidade de tempo da busca linear?", options: ["O(1)", "O(log n)", "O(n)", "O(n^2)"], answer: 2 },
                 { question: "A busca linear é mais adequada para qual tipo de lista?", options: ["Apenas listas muito grandes", "Apenas listas ordenadas em ordem decrescente", "Listas pequenas ou não ordenadas", "Listas contendo apenas números"], answer: 2 },
                 { question: "Se o item procurado NÃO estiver presente na lista, quantos elementos a busca linear normalmente examinará?", options: ["Zero", "Um", "Cerca de metade dos elementos", "Todos os elementos"], answer: 3 },
                 { question: "Considere o código: `encontrado = False; for item in minha_lista: if item == alvo: encontrado = True; break`. Que algoritmo isso representa?", options: ["Busca Binária", "Bubble Sort", "Selection Sort", "Busca Linear"], answer: 3 },
                 { question: "Qual é uma desvantagem chave da busca linear em comparação com a busca binária?", options: ["É muito mais difícil de implementar", "Funciona apenas com números", "Requer que a lista esteja ordenada", "Geralmente é mais lenta para listas grandes e ordenadas"], answer: 3 },
                 { question: "A busca linear modifica a lista original durante a busca?", options: ["Sim, remove elementos ao verificá-los", "Sim, ordena a lista primeiro", "Não, apenas lê os elementos", "Às vezes, dependendo do item"], answer: 2 }
            ],
            zh: [
                 { question: "线性搜索算法的主要目标是什么？", options: ["有效地对列表进行排序", "查找列表中的最小元素", "检查列表中是否存在特定项目", "反转列表的顺序"], answer: 2 },
                 { question: "线性搜索如何在列表中检查项目？", options: ["首先跳转到中间元素", "从头开始逐个检查每个元素", "成对比较元素", "仅检查奇数索引处的元素"], answer: 1 },
                 { question: "线性搜索的最佳情况是什么？", options: ["项目不在列表中", "列表已经排序", "项目是第一个元素", "项目是最后一个元素"], answer: 2 },
                 { question: "就比较次数而言，线性搜索的最坏情况是什么？", options: ["1 次比较", "log(n) 次比较", "n/2 次比较", "n 次比较（n是列表大小）"], answer: 3 },
                 { question: "线性搜索的时间复杂度是多少？", options: ["O(1)", "O(log n)", "O(n)", "O(n^2)"], answer: 2 },
                 { question: "线性搜索最适合哪种类型的列表？", options: ["仅限非常大的列表", "仅限降序排序的列表", "小型列表或未排序列表", "仅包含数字的列表"], answer: 2 },
                 { question: "如果要搜索的项目不在列表中，线性搜索通常会检查多少个元素？", options: ["零个", "一个", "大约一半的元素", "所有元素"], answer: 3 },
                 { question: "考虑代码：`found = False; for item in my_list: if item == target: found = True; break`。这代表了什么算法？", options: ["二分搜索", "冒泡排序", "选择排序", "线性搜索"], answer: 3 },
                 { question: "与二分搜索相比，线性搜索的一个关键缺点是什么？", options: ["实现起来困难得多", "仅适用于数字", "要求列表必须排序", "对于大型、已排序的列表通常较慢"], answer: 3 },
                 { question: "线性搜索在搜索时会修改原始列表吗？", options: ["是的，它会在检查时删除元素", "是的，它会先对列表进行排序", "不，它只读取元素", "有时会，取决于项目"], answer: 2 }
            ]
        };

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": `Knowledge Check: Module ${MODULE_ID} - Complete Python`,
                 "quiz_header_title": `Module ${MODULE_ID}: Linear Search`,
                 "back_button": "Back to Dashboard",
                 "quiz_instructions_p1": "Test your knowledge of Module 27 content.",
                 "quiz_instructions_p2": `There are <strong>${TOTAL_QUESTIONS} questions</strong>. You need to answer at least <strong>${PASSING_SCORE} questions</strong> correctly to pass.`,
                 "quiz_instructions_p3": "You can attempt this check as many times as you like. Passing will mark this module as complete on your dashboard.",
                 "question_progress": `Question {current} / ${TOTAL_QUESTIONS}`,
                 "next_button": "Next Question",
                 "submit_button": "Submit Quiz",
                 "results_title": "Quiz Results",
                 "score_display": "Your Score: {score} / {total}",
                 "pass_message": "Congratulations, you passed! <i class='fas fa-check-circle'></i> Module complete.",
                 "fail_message": "Not quite! Keep studying and try again. <i class='fas fa-times-circle'></i>",
                 "retry_button": "Retry Quiz",
                 "loading": "Loading...",
                 "already_passed_message": "You have already passed this knowledge check!",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 EN",
                 "lang_pt": "🇧🇷 PT",
                 "lang_zh": "🇨🇳 ZH",
                 "footer_text": "Part of the Road to Free Open AGI Project"
             },
             pt: {
                 "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Python Completo`,
                 "quiz_header_title": `Módulo ${MODULE_ID}: Busca Linear`,
                 "back_button": "Voltar ao Painel",
                 "quiz_instructions_p1": "Teste seus conhecimentos sobre o conteúdo do Módulo 27.",
                 "quiz_instructions_p2": `Há <strong>${TOTAL_QUESTIONS} perguntas</strong>. Você precisa responder pelo menos <strong>${PASSING_SCORE} perguntas</strong> corretamente para passar.`,
                 "quiz_instructions_p3": "Você pode tentar esta verificação quantas vezes quiser. Passar marcará este módulo como completo em seu painel.",
                 "question_progress": `Pergunta {current} / ${TOTAL_QUESTIONS}`,
                 "next_button": "Próxima Pergunta",
                 "submit_button": "Enviar Quiz",
                 "results_title": "Resultados do Quiz",
                 "score_display": "Sua Pontuação: {score} / {total}",
                 "pass_message": "Parabéns, você passou! <i class='fas fa-check-circle'></i> Módulo completo.",
                 "fail_message": "Quase lá! Continue estudando e tente novamente. <i class='fas fa-times-circle'></i>",
                 "retry_button": "Tentar Novamente",
                 "loading": "Carregando...",
                 "already_passed_message": "Você já passou nesta verificação de conhecimento!",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 EN",
                 "lang_pt": "🇧🇷 PT",
                 "lang_zh": "🇨🇳 ZH",
                 "footer_text": "Parte do Projeto Road to Free Open AGI"
             },
             zh: {
                 "page_title": `知识测验：模块 ${MODULE_ID} - Python 完全指南`,
                 "quiz_header_title": `模块 ${MODULE_ID}: 线性搜索`,
                 "back_button": "返回仪表板",
                 "quiz_instructions_p1": "测试您对模块 27 内容的掌握程度。",
                 "quiz_instructions_p2": `共有 <strong>${TOTAL_QUESTIONS} 个问题</strong>。您至少需要答对 <strong>${PASSING_SCORE} 个问题</strong> 才能通过。`,
                 "quiz_instructions_p3": "您可以根据需要多次尝试此测验。通过后，该模块将在您的仪表板上标记为完成。",
                 "question_progress": `问题 {current} / ${TOTAL_QUESTIONS}`,
                 "next_button": "下一题",
                 "submit_button": "提交测验",
                 "results_title": "测验结果",
                 "score_display": "你的分数：{score} / {total}",
                 "pass_message": "恭喜，您通过了！<i class='fas fa-check-circle'></i> 模块完成。",
                 "fail_message": "还差一点！继续学习并再试一次。 <i class='fas fa-times-circle'></i>",
                 "retry_button": "重试测验",
                 "loading": "加载中...",
                 "already_passed_message": "您已经通过了本次知识测验！",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 EN",
                 "lang_pt": "🇧🇷 PT",
                 "lang_zh": "🇨🇳 ZH",
                 "footer_text": "通往自由开放AGI之路项目的一部分"
             }
         };

        // --- DOM Elements ---
        const questionTextEl = document.getElementById('question-text');
        const answerOptionsEl = document.getElementById('answer-options');
        const nextButtonEl = document.getElementById('next-button');
        const submitButtonEl = document.getElementById('submit-button');
        const retryButtonEl = document.getElementById('retry-button');
        const progressIndicatorEl = document.getElementById('progress-indicator');
        const resultsAreaEl = document.getElementById('results-area');
        const scoreDisplayEl = document.getElementById('score-display');
        const passFailMessageEl = document.getElementById('pass-fail-message');
        const languageSelectEl = document.getElementById('languageSelect');
        const quizContentEl = document.getElementById('quiz-content');
        const alreadyPassedEl = document.getElementById('already-passed');

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let userAnswers = new Array(TOTAL_QUESTIONS).fill(null);
        let currentScore = 0;
        let currentLanguage = 'en';
        let knowledgeCheckStatus = {};
        let isPassed = false;

        // --- Functions ---

        // Load/Save Status from LocalStorage
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {};
            }
        }

        function saveKnowledgeCheckStatus(statusObject) {
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }

        // Language and Translation
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
             if (!translations[lang]) lang = 'en';
             document.documentElement.lang = lang;
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 // Handle potential HTML in translations for specific elements if needed
                 if (key === 'quiz_instructions_p2' || key === 'pass_message' || key === 'fail_message' || key === 'already_passed_message') {
                     el.innerHTML = translation;
                 } else if (el.tagName === 'BUTTON') {
                     el.textContent = translation; // Button text
                 } else if (el.tagName === 'TITLE') {
                     document.title = translation;
                 } else {
                     // Use innerHTML for elements that might contain other tags like <i>
                     if (el.children.length > 0 && el.querySelector('i')) {
                          const iconHTML = el.querySelector('i').outerHTML;
                          el.innerHTML = iconHTML + ' ' + translation; // Preserve icon
                     } else {
                          el.textContent = translation;
                     }
                 }
             });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
            });
            // Update dynamic text if quiz is active/finished
            updateProgressIndicator(lang);
            if (resultsAreaEl.style.display !== 'none') {
                 displayResults(currentScore, lang); // Re-render results text
            }
         }


        // Quiz Logic
        function loadQuestion(index, lang) {
            if (!quizData[lang] || index < 0 || index >= quizData[lang].length) {
                 questionTextEl.textContent = getTranslation('loading', lang); // Or an error message
                 answerOptionsEl.innerHTML = '';
                 return;
            }
            const questionData = quizData[lang][index];

            questionTextEl.textContent = questionData.question;
            answerOptionsEl.innerHTML = ''; // Clear previous options

            questionData.options.forEach((option, i) => {
                const li = document.createElement('li');
                const inputId = `q${index}_option${i}`;

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question_${index}`;
                input.value = i;
                input.id = inputId;
                input.checked = (userAnswers[index] === i); // Re-select if already answered

                const label = document.createElement('label');
                label.htmlFor = inputId;
                label.textContent = option;

                // Add event listener directly to label/input container if needed
                // Or check selected on "Next" click
                li.appendChild(input);
                li.appendChild(label);
                answerOptionsEl.appendChild(li);

                // Enable next button when an option is selected
                 input.addEventListener('change', () => {
                     nextButtonEl.disabled = false;
                     submitButtonEl.disabled = false; // Also enable submit if it's the button shown
                 });
            });

            updateProgressIndicator(lang);
            nextButtonEl.disabled = (userAnswers[index] === null); // Disable if not answered yet

             // Show/hide Next/Submit buttons
             if (index === TOTAL_QUESTIONS - 1) {
                 nextButtonEl.style.display = 'none';
                 submitButtonEl.style.display = 'inline-block';
                 submitButtonEl.disabled = (userAnswers[index] === null); // Disable submit if last Q not answered
             } else {
                 nextButtonEl.style.display = 'inline-block';
                 submitButtonEl.style.display = 'none';
             }
        }

        function updateProgressIndicator(lang) {
            progressIndicatorEl.textContent = getTranslation('question_progress', lang, { current: currentQuestionIndex + 1, total: TOTAL_QUESTIONS });
        }

        function recordAnswer() {
            const selectedOption = answerOptionsEl.querySelector(`input[name="question_${currentQuestionIndex}"]:checked`);
            if (selectedOption) {
                userAnswers[currentQuestionIndex] = parseInt(selectedOption.value, 10);
            } else {
                 userAnswers[currentQuestionIndex] = null; // Should ideally not happen if button enabled correctly
            }
        }

        function calculateScore(lang) {
            let score = 0;
            for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                if (userAnswers[i] === quizData[lang][i]?.answer) {
                    score++;
                }
            }
            return score;
        }

        function displayResults(score, lang) {
            currentScore = score; // Store score for potential re-translation
            resultsAreaEl.style.display = 'block';
            quizContentEl.style.display = 'none'; // Hide questions

            scoreDisplayEl.textContent = getTranslation('score_display', lang, { score: score, total: TOTAL_QUESTIONS });

            isPassed = score >= PASSING_SCORE;
            if (isPassed) {
                passFailMessageEl.innerHTML = getTranslation('pass_message', lang);
                passFailMessageEl.className = 'pass';
                // Update localStorage ONLY if passed
                knowledgeCheckStatus[MODULE_ID] = true;
                saveKnowledgeCheckStatus(knowledgeCheckStatus);
                // Show already passed message immediately if they retry *without* reloading
                alreadyPassedEl.style.display = 'block';
                 alreadyPassedEl.innerHTML = getTranslation('already_passed_message', lang); // Ensure msg is translated

            } else {
                passFailMessageEl.innerHTML = getTranslation('fail_message', lang);
                passFailMessageEl.className = 'fail';
            }
             retryButtonEl.style.display = 'inline-block'; // Ensure retry is visible
             retryButtonEl.textContent = getTranslation('retry_button', lang); // Translate button
        }

        function retryQuiz() {
             currentQuestionIndex = 0;
             userAnswers.fill(null);
             currentScore = 0;
             isPassed = knowledgeCheckStatus[MODULE_ID] === true; // Re-check if passed from storage

             resultsAreaEl.style.display = 'none';
             quizContentEl.style.display = 'block'; // Show questions again
             retryButtonEl.style.display = 'none'; // Hide retry button during quiz

             // Show/hide already passed message based on stored status
             if (isPassed) {
                 alreadyPassedEl.style.display = 'block';
                  alreadyPassedEl.innerHTML = getTranslation('already_passed_message', currentLanguage);
             } else {
                 alreadyPassedEl.style.display = 'none';
             }

             loadQuestion(currentQuestionIndex, currentLanguage);
        }

        // --- Event Listeners ---
        nextButtonEl.addEventListener('click', () => {
            recordAnswer();
            currentQuestionIndex++;
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                loadQuestion(currentQuestionIndex, currentLanguage);
            }
            // Logic to switch to submit button is handled within loadQuestion
        });

        submitButtonEl.addEventListener('click', () => {
            recordAnswer(); // Record answer for the last question
            const finalScore = calculateScore(currentLanguage);
            displayResults(finalScore, currentLanguage);
        });

        retryButtonEl.addEventListener('click', retryQuiz);

        languageSelectEl.addEventListener('change', (e) => {
            const newLang = e.target.value;
            if (newLang !== currentLanguage) {
                currentLanguage = newLang;
                localStorage.setItem(LANGUAGE_STORAGE_KEY, newLang);
                translatePage(newLang);
                 // If quiz is active, reload current question with new language
                if (quizContentEl.style.display !== 'none') {
                    loadQuestion(currentQuestionIndex, newLang);
                 }
                // If results are shown, they are re-translated by translatePage calling displayResults
            }
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            knowledgeCheckStatus = loadKnowledgeCheckStatus();
            currentLanguage = getStoredLanguage();
            languageSelectEl.value = currentLanguage;
            translatePage(currentLanguage); // Initial translation

            isPassed = knowledgeCheckStatus[MODULE_ID] === true;
             if (isPassed) {
                 alreadyPassedEl.style.display = 'block';
                 // Optionally disable the quiz start or just show the message
                 // quizContentEl.style.display = 'none'; // Uncomment to hide quiz if already passed
                 // displayResults(PASSING_SCORE, currentLanguage); // Optionally show results directly
             } else {
                 alreadyPassedEl.style.display = 'none';
             }


            // Load the first question (or handle already passed state)
            if (!isPassed || quizContentEl.style.display !== 'none') { // Only load question if not already passed OR if we decided to allow re-taking visually
                loadQuestion(currentQuestionIndex, currentLanguage);
            }
        });

    </script>

</body>
</html>
