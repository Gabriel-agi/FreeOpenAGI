<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 31 Knowledge Check - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Used for quiz card */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* KC Color */
            --certificate-color: #d63384;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-bottom: 3rem; /* Space for footer */
        }

        /* --- Reusable Button Style --- */
        .btn {
            display: inline-block;
            font-weight: 400;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            user-select: none;
            background-color: transparent;
            border: 1px solid transparent;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: var(--border-radius);
            transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }
        .btn-primary { color: #fff; background-color: var(--primary-color); border-color: var(--primary-color); }
        .btn-primary:hover { background-color: #0b5ed7; border-color: #0a58ca; }
        .btn-secondary { color: #fff; background-color: var(--secondary-color); border-color: var(--secondary-color); }
        .btn-secondary:hover { background-color: #5a6268; border-color: #545b62; }
        .btn-success { color: #fff; background-color: var(--success-color); border-color: var(--success-color); }
        .btn-success:hover { background-color: #157347; border-color: #146c43; }
        .btn-lg { padding: 0.75rem 1.25rem; font-size: 1.1rem; }
        .btn:disabled { opacity: 0.65; cursor: not-allowed; }
        .btn i { margin-right: 6px; }

        /* --- Top Navigation / Header --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; /* Keep header visible */
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .kc-header a.back-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 5px;
            transition: background-color var(--transition-speed);
        }
        .kc-header a.back-link:hover { background-color: rgba(255, 255, 255, 0.2); }
        .kc-header a.back-link i { margin-right: 8px; }

        /* Language Switcher Styles (Adapted for Header) */
        .language-switcher { position: relative; }
         #languageSelect {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px; /* Adjusted padding */
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: background-color 0.3s ease, border-color 0.3s ease;
         }
         #languageSelect:hover { background-color: rgba(255, 255, 255, 0.15); border-color: #f09ed4; }
         #languageSelect:focus { outline: none; box-shadow: 0 0 0 2px rgba(214, 51, 132, 0.3); }
         #languageSelect option { background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px; }

        /* --- Main Content Area --- */
        .kc-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .kc-card {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .kc-title {
            font-family: var(--font-title);
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        .kc-title i { color: var(--check-color); margin-right: 12px; }
        .kc-subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }
        .kc-instructions {
            background-color: #e7f1ff;
            border: 1px solid #c6dfff;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            font-size: 0.95rem;
            color: #0a58ca;
        }
        .kc-instructions p { margin-bottom: 0.5rem; }
        .kc-instructions p:last-child { margin-bottom: 0; }
        .kc-instructions strong { font-weight: 500; }
        .kc-instructions i { margin-right: 8px; opacity: 0.8; }

        /* --- Quiz Form --- */
        .kc-form {}
        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .question-block:last-of-type {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .question-number {
            display: inline-block;
            background-color: var(--check-color);
            color: white;
            font-weight: 700;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            margin-right: 10px;
            font-size: 0.9rem;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            display: inline;
        }
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-left: 40px; /* Align with question text */
        }
        .option-label {
            display: block;
            position: relative;
            padding-left: 35px;
            cursor: pointer;
            font-size: 1rem;
            user-select: none;
            line-height: 1.4;
            border: 1px solid transparent; /* Placeholder for feedback */
            padding: 10px 15px 10px 35px;
            border-radius: 6px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .option-label:hover { background-color: #f8f9fa; }
        .option-label input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }
        .option-checkmark {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            height: 20px;
            width: 20px;
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 50%;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .option-label:hover input ~ .option-checkmark { background-color: #ddd; }
        .option-label input:checked ~ .option-checkmark { background-color: var(--primary-color); border-color: var(--primary-color); }
        .option-checkmark:after {
            content: "";
            position: absolute;
            display: none;
            top: 5px;
            left: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }
        .option-label input:checked ~ .option-checkmark:after { display: block; }

        /* --- Feedback Styles --- */
        .option-label.correct {
            background-color: #d1e7dd;
            border-color: #a3cfbb;
            color: #0f5132;
            font-weight: 500;
        }
        .option-label.incorrect {
            background-color: #f8d7da;
            border-color: #f1aeb5;
            color: #842029;
        }
        .option-label.correct .option-checkmark { background-color: var(--success-color); border-color: var(--success-color); }
        .option-label.incorrect .option-checkmark { background-color: var(--error-color); border-color: var(--error-color); }

        /* --- Results Area --- */
        .kc-results {
            margin-top: 2.5rem;
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            text-align: center;
        }
        .kc-results.pass { background-color: #d1e7dd; border: 1px solid #a3cfbb; }
        .kc-results.fail { background-color: #f8d7da; border: 1px solid #f1aeb5; }

        .results-title {
            font-family: var(--font-title);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .results-title.pass { color: var(--success-color); }
        .results-title.fail { color: var(--error-color); }
        .results-title i { margin-right: 10px; }

        .results-score { font-size: 1.1rem; font-weight: 500; margin-bottom: 0.5rem; }
        .results-message { font-size: 1rem; margin-bottom: 1.5rem; }
        .results-actions { margin-top: 1rem; }

        /* --- Completion State --- */
        .kc-completed-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            border-radius: var(--border-radius);
            z-index: 5; /* Below header */
        }
         .kc-completed-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 1rem;
         }
        .kc-completed-text {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--success-color);
            margin-bottom: 1.5rem;
        }

        /* --- Footer --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header { padding: 0.8rem 1rem; flex-direction: column; align-items: flex-start; gap: 0.8rem; position: static; /* Header won't stick on mobile */ }
            .kc-container { margin: 1rem auto; padding: 0 1rem; }
            .kc-card { padding: 1.5rem; }
            .kc-title { font-size: 1.6rem; }
            .kc-subtitle { font-size: 1rem; margin-bottom: 1rem; }
            .kc-instructions { padding: 0.8rem 1rem; margin-bottom: 1.5rem; font-size: 0.9rem; }
            .question-text { font-size: 1rem; }
            .options-container { margin-left: 0; gap: 0.6rem; } /* Stack options directly below question on mobile */
            .option-label { padding: 8px 12px 8px 30px; font-size: 0.95rem; }
            .option-checkmark { left: 5px; width: 18px; height: 18px; }
            .option-checkmark:after { top: 4px; left: 4px; width: 8px; height: 8px; }
            .kc-results { padding: 1rem 1.5rem; }
            .results-title { font-size: 1.3rem; }
        }
         @media (max-width: 576px) {
            html { font-size: 14px; }
            .btn-lg { padding: 0.6rem 1rem; font-size: 1rem; }
            .kc-header a.back-link { font-size: 0.9rem; padding: 0.3rem 0.6rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="back-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="back_to_dashboard">Return to Dashboard</span>
        </a>
         <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <div class="kc-container">
        <div class="kc-card" id="kcCard" style="position: relative;"> <!-- Added position relative for overlay -->

            <!-- Completion Overlay (Initially Hidden) -->
            <div class="kc-completed-overlay" id="completionOverlay" style="display: none;">
                <div class="kc-completed-icon"><i class="fas fa-check-circle"></i></div>
                <p class="kc-completed-text" data-translate="kc_already_passed">Knowledge Check already passed!</p>
                <a href="ctp-dashboard.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> <span data-translate="back_to_dashboard">Return to Dashboard</span>
                </a>
            </div>

            <h1 class="kc-title">
                <i class="fas fa-check-double"></i> <span data-translate="kc_title">Module 31 Knowledge Check</span>
            </h1>
            <p class="kc-subtitle" data-translate="kc_subtitle">Final Project Preparation</p>

            <div class="kc-instructions">
                <p data-translate="kc_instruction_1"><i class="fas fa-question-circle"></i> There are <strong>10 questions</strong> in this knowledge check.</p>
                <p data-translate="kc_instruction_2"><i class="fas fa-star"></i> You need to answer at least <strong>6 questions correctly</strong> to pass.</p>
                <p data-translate="kc_instruction_3"><i class="fas fa-redo"></i> You can attempt this check as many times as you need.</p>
            </div>

            <form id="kcForm" class="kc-form">
                <!-- Question 1 -->
                <div class="question-block" data-question-id="1">
                    <span class="question-number">1</span>
                    <p class="question-text" data-translate="q1_text">According to Computational Thinking principles, what is typically the FIRST step when tackling a large, complex programming project?</p>
                    <div class="options-container">
                        <label class="option-label">
                            <input type="radio" name="q1" value="a"> <span class="option-checkmark"></span> <span data-translate="q1_opt_a">Immediately start writing code.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q1" value="b"> <span class="option-checkmark"></span> <span data-translate="q1_opt_b">Decompose the problem into smaller, manageable parts.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q1" value="c"> <span class="option-checkmark"></span> <span data-translate="q1_opt_c">Choose the most advanced algorithm possible.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q1" value="d"> <span class="option-checkmark"></span> <span data-translate="q1_opt_d">Optimize the code for speed before it's written.</span>
                        </label>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="question-block" data-question-id="2">
                    <span class="question-number">2</span>
                    <p class="question-text" data-translate="q2_text">How does the CT concept of 'Abstraction' primarily help during project preparation?</p>
                    <div class="options-container">
                        <label class="option-label">
                            <input type="radio" name="q2" value="a"> <span class="option-checkmark"></span> <span data-translate="q2_opt_a">By making the code run faster.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q2" value="b"> <span class="option-checkmark"></span> <span data-translate="q2_opt_b">By hiding complex details and focusing on essential features.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q2" value="c"> <span class="option-checkmark"></span> <span data-translate="q2_opt_c">By ensuring every possible error is caught initially.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q2" value="d"> <span class="option-checkmark"></span> <span data-translate="q2_opt_d">By writing all the code in a single large file.</span>
                        </label>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="question-block" data-question-id="3">
                    <span class="question-number">3</span>
                    <p class="question-text" data-translate="q3_text">Which of these activities is most associated with the 'Algorithm Design' part of project preparation?</p>
                    <div class="options-container">
                        <label class="option-label">
                            <input type="radio" name="q3" value="a"> <span class="option-checkmark"></span> <span data-translate="q3_opt_a">Choosing variable names.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q3" value="b"> <span class="option-checkmark"></span> <span data-translate="q3_opt_b">Deciding the exact colors for the user interface.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q3" value="c"> <span class="option-checkmark"></span> <span data-translate="q3_opt_c">Planning the step-by-step logic the program will follow.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q3" value="d"> <span class="option-checkmark"></span> <span data-translate="q3_opt_d">Writing comments in the code.</span>
                        </label>
                    </div>
                </div>

                <!-- Question 4 -->
                 <div class="question-block" data-question-id="4">
                    <span class="question-number">4</span>
                    <p class="question-text" data-translate="q4_text">You need to create a simple program that reads a list of names from a file, greets each person, and saves the greetings to another file. Which concepts learned earlier are MOST LIKELY to be combined?</p>
                    <div class="options-container">
                        <label class="option-label">
                            <input type="radio" name="q4" value="a"> <span class="option-checkmark"></span> <span data-translate="q4_opt_a">Dictionaries, Recursion, and Math module.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q4" value="b"> <span class="option-checkmark"></span> <span data-translate="q4_opt_b">File Reading, File Writing, Loops (for), and String manipulation.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q4" value="c"> <span class="option-checkmark"></span> <span data-translate="q4_opt_c">Exception handling, Tuples, and `while` loops only.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q4" value="d"> <span class="option-checkmark"></span> <span data-translate="q4_opt_d">Object-Oriented Programming and Importing `random`.</span>
                        </label>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="question-block" data-question-id="5">
                    <span class="question-number">5</span>
                    <p class="question-text" data-translate="q5_text">Why is the 'Evaluation' step crucial after developing a part of your project?</p>
                    <div class="options-container">
                        <label class="option-label">
                            <input type="radio" name="q5" value="a"> <span class="option-checkmark"></span> <span data-translate="q5_opt_a">To make the code look prettier.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q5" value="b"> <span class="option-checkmark"></span> <span data-translate="q5_opt_b">To immediately start the next feature.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q5" value="c"> <span class="option-checkmark"></span> <span data-translate="q5_opt_c">To test if it works correctly, find bugs, and see if it meets requirements.</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q5" value="d"> <span class="option-checkmark"></span> <span data-translate="q5_opt_d">To add more comments.</span>
                        </label>
                    </div>
                </div>

                <!-- Question 6 -->
                <div class="question-block" data-question-id="6">
                     <span class="question-number">6</span>
                     <p class="question-text" data-translate="q6_text">If your project involves storing player names and their corresponding high scores, which data structure is generally most suitable for easy lookup of a score given a name?</p>
                     <div class="options-container">
                         <label class="option-label">
                             <input type="radio" name="q6" value="a"> <span class="option-checkmark"></span> <span data-translate="q6_opt_a">A List</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q6" value="b"> <span class="option-checkmark"></span> <span data-translate="q6_opt_b">A Tuple</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q6" value="c"> <span class="option-checkmark"></span> <span data-translate="q6_opt_c">A Dictionary</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q6" value="d"> <span class="option-checkmark"></span> <span data-translate="q6_opt_d">A simple String variable</span>
                         </label>
                     </div>
                 </div>

                <!-- Question 7 -->
                <div class="question-block" data-question-id="7">
                     <span class="question-number">7</span>
                     <p class="question-text" data-translate="q7_text">During project preparation, what is the primary benefit of using functions?</p>
                     <div class="options-container">
                         <label class="option-label">
                             <input type="radio" name="q7" value="a"> <span class="option-checkmark"></span> <span data-translate="q7_opt_a">To make the program always run faster.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q7" value="b"> <span class="option-checkmark"></span> <span data-translate="q7_opt_b">To break down the code into reusable, logical blocks, improving organization and readability.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q7" value="c"> <span class="option-checkmark"></span> <span data-translate="q7_opt_c">To eliminate the need for variables.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q7" value="d"> <span class="option-checkmark"></span> <span data-translate="q7_opt_d">To automatically handle all errors.</span>
                         </label>
                     </div>
                 </div>

                <!-- Question 8 -->
                <div class="question-block" data-question-id="8">
                     <span class="question-number">8</span>
                     <p class="question-text" data-translate="q8_text">When debugging a part of your project that isn't working, what is a common and effective first step?</p>
                     <div class="options-container">
                         <label class="option-label">
                             <input type="radio" name="q8" value="a"> <span class="option-checkmark"></span> <span data-translate="q8_opt_a">Rewrite the entire section from scratch immediately.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q8" value="b"> <span class="option-checkmark"></span> <span data-translate="q8_opt_b">Add `print()` statements to check variable values at different points.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q8" value="c"> <span class="option-checkmark"></span> <span data-translate="q8_opt_c">Assume the computer made a mistake.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q8" value="d"> <span class="option-checkmark"></span> <span data-translate="q8_opt_d">Remove all comments to simplify the code.</span>
                         </label>
                     </div>
                 </div>

                <!-- Question 9 -->
                <div class="question-block" data-question-id="9">
                     <span class="question-number">9</span>
                     <p class="question-text" data-translate="q9_text">Integrating different parts of your code (like functions, loops, file handling) requires careful planning primarily related to:</p>
                     <div class="options-container">
                         <label class="option-label">
                             <input type="radio" name="q9" value="a"> <span class="option-checkmark"></span> <span data-translate="q9_opt_a">How data flows between the different parts.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q9" value="b"> <span class="option-checkmark"></span> <span data-translate="q9_opt_b">Using the shortest possible variable names.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q9" value="c"> <span class="option-checkmark"></span> <span data-translate="q9_opt_c">Ensuring every line has a comment.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q9" value="d"> <span class="option-checkmark"></span> <span data-translate="q9_opt_d">Making the code as complex as possible.</span>
                         </label>
                     </div>
                 </div>

                <!-- Question 10 -->
                <div class="question-block" data-question-id="10">
                     <span class="number">10</span>
                     <p class="question-text" data-translate="q10_text">What is the main purpose of using `import` (e.g., `import math`) when preparing a larger project?</p>
                     <div class="options-container">
                         <label class="option-label">
                             <input type="radio" name="q10" value="a"> <span class="option-checkmark"></span> <span data-translate="q10_opt_a">To make your script file smaller in size.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q10" value="b"> <span class="option-checkmark"></span> <span data-translate="q10_opt_b">To access pre-written code (functions, variables) from modules, promoting reusability.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q10" value="c"> <span class="option-checkmark"></span> <span data-translate="q10_opt_c">To automatically document your code.</span>
                         </label>
                         <label class="option-label">
                             <input type="radio" name="q10" value="d"> <span class="option-checkmark"></span> <span data-translate="q10_opt_d">To change the version of Python being used.</span>
                         </label>
                     </div>
                 </div>

                <div style="text-align: center; margin-top: 2.5rem;">
                    <button type="submit" class="btn btn-primary btn-lg" id="submitButton">
                        <i class="fas fa-paper-plane"></i> <span data-translate="submit_answers">Submit Answers</span>
                    </button>
                </div>
            </form>

            <!-- Results Area (Initially Hidden) -->
            <div id="resultsArea" class="kc-results" style="display: none;">
                <h2 class="results-title" id="resultsTitle"></h2>
                <p class="results-score" id="resultsScore"></p>
                <p class="results-message" id="resultsMessage"></p>
                <div class="results-actions">
                     <button type="button" class="btn btn-secondary" id="tryAgainButton" style="display: none;">
                        <i class="fas fa-redo"></i> <span data-translate="try_again">Try Again</span>
                     </button>
                     <a href="ctp-dashboard.html" class="btn btn-success" id="backToDashboardButton" style="display: none;">
                        <i class="fas fa-check-circle"></i> <span data-translate="kc_passed_back_dashboard">Progress Saved! Back to Dashboard</span>
                     </a>
                </div>
            </div>

        </div> <!-- /.kc-card -->
    </div> <!-- /.kc-container -->

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Configuration ---
        const MODULE_ID = 31;
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1'; // Same key as dashboard
        const LANGUAGE_STORAGE_KEY = 'userLanguage'; // Same key as dashboard

        // --- Quiz Data ---
        const quizData = {
            1: { correct: 'b' },
            2: { correct: 'b' },
            3: { correct: 'c' },
            4: { correct: 'b' },
            5: { correct: 'c' },
            6: { correct: 'c' },
            7: { correct: 'b' },
            8: { correct: 'b' },
            9: { correct: 'a' },
            10: { correct: 'b' }
        };
        const totalQuestions = Object.keys(quizData).length;

        // --- Translations Object ---
        const translations = {
             en: {
                "page_title": `Module ${MODULE_ID} Knowledge Check - Complete Python`,
                "back_to_dashboard": "Return to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "kc_title": `Module ${MODULE_ID} Knowledge Check`,
                "kc_subtitle": "Final Project Preparation",
                "kc_instruction_1": "<i class=\"fas fa-question-circle\"></i> There are <strong>{totalQuestions} questions</strong> in this knowledge check.", // Use placeholder
                "kc_instruction_2": "<i class=\"fas fa-star\"></i> You need to answer at least <strong>{passingScore} questions correctly</strong> to pass.", // Use placeholder
                "kc_instruction_3": "<i class=\"fas fa-redo\"></i> You can attempt this check as many times as you need.",
                "q1_text": "According to Computational Thinking principles, what is typically the FIRST step when tackling a large, complex programming project?",
                "q1_opt_a": "Immediately start writing code.",
                "q1_opt_b": "Decompose the problem into smaller, manageable parts.",
                "q1_opt_c": "Choose the most advanced algorithm possible.",
                "q1_opt_d": "Optimize the code for speed before it's written.",
                "q2_text": "How does the CT concept of 'Abstraction' primarily help during project preparation?",
                "q2_opt_a": "By making the code run faster.",
                "q2_opt_b": "By hiding complex details and focusing on essential features.",
                "q2_opt_c": "By ensuring every possible error is caught initially.",
                "q2_opt_d": "By writing all the code in a single large file.",
                "q3_text": "Which of these activities is most associated with the 'Algorithm Design' part of project preparation?",
                "q3_opt_a": "Choosing variable names.",
                "q3_opt_b": "Deciding the exact colors for the user interface.",
                "q3_opt_c": "Planning the step-by-step logic the program will follow.",
                "q3_opt_d": "Writing comments in the code.",
                "q4_text": "You need to create a simple program that reads a list of names from a file, greets each person, and saves the greetings to another file. Which concepts learned earlier are MOST LIKELY to be combined?",
                "q4_opt_a": "Dictionaries, Recursion, and Math module.",
                "q4_opt_b": "File Reading, File Writing, Loops (for), and String manipulation.",
                "q4_opt_c": "Exception handling, Tuples, and `while` loops only.",
                "q4_opt_d": "Object-Oriented Programming and Importing `random`.",
                "q5_text": "Why is the 'Evaluation' step crucial after developing a part of your project?",
                "q5_opt_a": "To make the code look prettier.",
                "q5_opt_b": "To immediately start the next feature.",
                "q5_opt_c": "To test if it works correctly, find bugs, and see if it meets requirements.",
                "q5_opt_d": "To add more comments.",
                "q6_text": "If your project involves storing player names and their corresponding high scores, which data structure is generally most suitable for easy lookup of a score given a name?",
                "q6_opt_a": "A List", "q6_opt_b": "A Tuple", "q6_opt_c": "A Dictionary", "q6_opt_d": "A simple String variable",
                "q7_text": "During project preparation, what is the primary benefit of using functions?",
                "q7_opt_a": "To make the program always run faster.",
                "q7_opt_b": "To break down the code into reusable, logical blocks, improving organization and readability.",
                "q7_opt_c": "To eliminate the need for variables.",
                "q7_opt_d": "To automatically handle all errors.",
                "q8_text": "When debugging a part of your project that isn't working, what is a common and effective first step?",
                "q8_opt_a": "Rewrite the entire section from scratch immediately.",
                "q8_opt_b": "Add `print()` statements to check variable values at different points.",
                "q8_opt_c": "Assume the computer made a mistake.",
                "q8_opt_d": "Remove all comments to simplify the code.",
                "q9_text": "Integrating different parts of your code (like functions, loops, file handling) requires careful planning primarily related to:",
                "q9_opt_a": "How data flows between the different parts.",
                "q9_opt_b": "Using the shortest possible variable names.",
                "q9_opt_c": "Ensuring every line has a comment.",
                "q9_opt_d": "Making the code as complex as possible.",
                "q10_text": "What is the main purpose of using `import` (e.g., `import math`) when preparing a larger project?",
                "q10_opt_a": "To make your script file smaller in size.",
                "q10_opt_b": "To access pre-written code (functions, variables) from modules, promoting reusability.",
                "q10_opt_c": "To automatically document your code.",
                "q10_opt_d": "To change the version of Python being used.",
                "submit_answers": "Submit Answers",
                "results_pass_title": "<i class=\"fas fa-check-circle\"></i> Passed!",
                "results_fail_title": "<i class=\"fas fa-times-circle\"></i> Try Again",
                "results_score_text": "Your Score: {score} out of {totalQuestions}",
                "results_pass_message": "Great job! You've successfully passed the knowledge check for this module. Your progress has been saved.",
                "results_fail_message": "Don't worry! Review the questions and concepts, then try again. You can do it!",
                "try_again": "Try Again",
                "kc_passed_back_dashboard": "Progress Saved! Back to Dashboard",
                "kc_already_passed": "Knowledge Check already passed!",
                "footer_text": "Part of the Road to Free Open AGI Project"
             },
             pt: {
                "page_title": `Módulo ${MODULE_ID} Verificação - Python Completo`,
                "back_to_dashboard": "Voltar ao Painel",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "kc_title": `Módulo ${MODULE_ID} Verificação de Conhecimento`,
                 "kc_subtitle": "Preparação para o Projeto Final",
                 "kc_instruction_1": "<i class=\"fas fa-question-circle\"></i> Existem <strong>{totalQuestions} questões</strong> nesta verificação.",
                 "kc_instruction_2": "<i class=\"fas fa-star\"></i> Você precisa responder pelo menos <strong>{passingScore} questões corretamente</strong> para passar.",
                 "kc_instruction_3": "<i class=\"fas fa-redo\"></i> Você pode tentar esta verificação quantas vezes precisar.",
                 "q1_text": "De acordo com os princípios do Pensamento Computacional, qual é tipicamente o PRIMEIRO passo ao abordar um projeto de programação grande e complexo?",
                 "q1_opt_a": "Começar imediatamente a escrever código.",
                 "q1_opt_b": "Decompor o problema em partes menores e gerenciáveis.",
                 "q1_opt_c": "Escolher o algoritmo mais avançado possível.",
                 "q1_opt_d": "Otimizar o código para velocidade antes de ser escrito.",
                 "q2_text": "Como o conceito de 'Abstração' do PC ajuda principalmente durante a preparação do projeto?",
                 "q2_opt_a": "Fazendo o código rodar mais rápido.",
                 "q2_opt_b": "Ocultando detalhes complexos e focando nas características essenciais.",
                 "q2_opt_c": "Garantindo que todos os erros possíveis sejam capturados inicialmente.",
                 "q2_opt_d": "Escrevendo todo o código em um único arquivo grande.",
                 "q3_text": "Qual destas atividades está mais associada à parte de 'Design de Algoritmo' da preparação do projeto?",
                 "q3_opt_a": "Escolher nomes de variáveis.",
                 "q3_opt_b": "Decidir as cores exatas para a interface do usuário.",
                 "q3_opt_c": "Planejar a lógica passo a passo que o programa seguirá.",
                 "q3_opt_d": "Escrever comentários no código.",
                 "q4_text": "Você precisa criar um programa simples que leia uma lista de nomes de um arquivo, cumprimente cada pessoa e salve as saudações em outro arquivo. Quais conceitos aprendidos anteriormente são MAIS prováveis de serem combinados?",
                 "q4_opt_a": "Dicionários, Recursão e módulo Math.",
                 "q4_opt_b": "Leitura de Arquivo, Escrita em Arquivo, Loops (for) e manipulação de String.",
                 "q4_opt_c": "Tratamento de exceções, Tuplas e loops `while` apenas.",
                 "q4_opt_d": "Programação Orientada a Objetos e Importação de `random`.",
                 "q5_text": "Por que a etapa de 'Avaliação' é crucial após desenvolver uma parte do seu projeto?",
                 "q5_opt_a": "Para tornar o código mais bonito.",
                 "q5_opt_b": "Para iniciar imediatamente o próximo recurso.",
                 "q5_opt_c": "Para testar se funciona corretamente, encontrar bugs e ver se atende aos requisitos.",
                 "q5_opt_d": "Para adicionar mais comentários.",
                 "q6_text": "Se seu projeto envolve armazenar nomes de jogadores e suas pontuações mais altas correspondentes, qual estrutura de dados é geralmente mais adequada para consulta fácil de uma pontuação dado um nome?",
                 "q6_opt_a": "Uma Lista", "q6_opt_b": "Uma Tupla", "q6_opt_c": "Um Dicionário", "q6_opt_d": "Uma variável String simples",
                 "q7_text": "Durante a preparação do projeto, qual é o principal benefício de usar funções?",
                 "q7_opt_a": "Fazer o programa sempre rodar mais rápido.",
                 "q7_opt_b": "Dividir o código em blocos lógicos e reutilizáveis, melhorando a organização e a legibilidade.",
                 "q7_opt_c": "Eliminar a necessidade de variáveis.",
                 "q7_opt_d": "Tratar automaticamente todos os erros.",
                 "q8_text": "Ao depurar uma parte do seu projeto que não está funcionando, qual é um primeiro passo comum e eficaz?",
                 "q8_opt_a": "Reescrever toda a seção do zero imediatamente.",
                 "q8_opt_b": "Adicionar instruções `print()` para verificar os valores das variáveis em diferentes pontos.",
                 "q8_opt_c": "Assumir que o computador cometeu um erro.",
                 "q8_opt_d": "Remover todos os comentários para simplificar o código.",
                 "q9_text": "Integrar diferentes partes do seu código (como funções, loops, manipulação de arquivos) requer planejamento cuidadoso relacionado principalmente a:",
                 "q9_opt_a": "Como os dados fluem entre as diferentes partes.",
                 "q9_opt_b": "Usar os nomes de variáveis mais curtos possíveis.",
                 "q9_opt_c": "Garantir que cada linha tenha um comentário.",
                 "q9_opt_d": "Tornar o código o mais complexo possível.",
                 "q10_text": "Qual é o principal propósito de usar `import` (por exemplo, `import math`) ao preparar um projeto maior?",
                 "q10_opt_a": "Tornar o arquivo do seu script menor em tamanho.",
                 "q10_opt_b": "Acessar código pré-escrito (funções, variáveis) de módulos, promovendo a reutilização.",
                 "q10_opt_c": "Documentar automaticamente seu código.",
                 "q10_opt_d": "Alterar a versão do Python que está sendo usada.",
                 "submit_answers": "Enviar Respostas",
                 "results_pass_title": "<i class=\"fas fa-check-circle\"></i> Aprovado!",
                 "results_fail_title": "<i class=\"fas fa-times-circle\"></i> Tente Novamente",
                 "results_score_text": "Sua Pontuação: {score} de {totalQuestions}",
                 "results_pass_message": "Ótimo trabalho! Você passou com sucesso na verificação de conhecimento para este módulo. Seu progresso foi salvo.",
                 "results_fail_message": "Não se preocupe! Revise as questões e os conceitos, depois tente novamente. Você consegue!",
                 "try_again": "Tentar Novamente",
                 "kc_passed_back_dashboard": "Progresso Salvo! Voltar ao Painel",
                 "kc_already_passed": "Verificação de conhecimento já concluída!",
                 "footer_text": "Parte do Projeto Road to Free Open AGI"
             },
             zh: {
                 "page_title": `模块 ${MODULE_ID} 知识测验 - Python 完全指南`,
                 "back_to_dashboard": "返回仪表板",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "kc_title": `模块 ${MODULE_ID} 知识测验`,
                 "kc_subtitle": "最终项目准备",
                 "kc_instruction_1": "<i class=\"fas fa-question-circle\"></i> 本知识测验包含 <strong>{totalQuestions} 个问题</strong>。",
                 "kc_instruction_2": "<i class=\"fas fa-star\"></i> 您需要至少答对 <strong>{passingScore} 个问题</strong> 才能通过。",
                 "kc_instruction_3": "<i class=\"fas fa-redo\"></i> 您可以根据需要尝试多次测验。",
                 "q1_text": "根据计算思维原则，在处理一个大型复杂的编程项目时，通常的第一个步骤是什么？",
                 "q1_opt_a": "立即开始编写代码。",
                 "q1_opt_b": "将问题分解成更小的、可管理的部分。",
                 "q1_opt_c": "选择可能的最先进的算法。",
                 "q1_opt_d": "在编写代码之前就对其进行速度优化。",
                 "q2_text": "计算思维中的“抽象”概念主要如何在项目准备中提供帮助？",
                 "q2_opt_a": "通过让代码运行得更快。",
                 "q2_opt_b": "通过隐藏复杂的细节，专注于基本特征。",
                 "q2_opt_c": "通过确保最初就捕获所有可能的错误。",
                 "q2_opt_d": "通过将所有代码写在一个大的文件里。",
                 "q3_text": "以下哪项活动与项目准备中的“算法设计”部分关联最紧密？",
                 "q3_opt_a": "选择变量名。",
                 "q3_opt_b": "决定用户界面的确切颜色。",
                 "q3_opt_c": "规划程序将遵循的逐步逻辑。",
                 "q3_opt_d": "在代码中编写注释。",
                 "q4_text": "你需要创建一个简单的程序，从文件中读取一个名字列表，问候每个人，并将问候语保存到另一个文件。之前学过的哪些概念最有可能被组合使用？",
                 "q4_opt_a": "字典、递归和 Math 模块。",
                 "q4_opt_b": "文件读取、文件写入、循环 (for) 和字符串操作。",
                 "q4_opt_c": "异常处理、元组和仅 `while` 循环。",
                 "q4_opt_d": "面向对象编程和导入 `random`。",
                 "q5_text": "为什么在开发完项目的一部分后，“评估”步骤至关重要？",
                 "q5_opt_a": "为了让代码看起来更漂亮。",
                 "q5_opt_b": "为了立即开始下一个功能。",
                 "q5_opt_c": "为了测试它是否正常工作，发现错误，并看它是否满足需求。",
                 "q5_opt_d": "为了添加更多注释。",
                 "q6_text": "如果你的项目涉及存储玩家姓名及其对应的最高分，哪种数据结构通常最适合根据姓名轻松查找分数？",
                 "q6_opt_a": "列表 (List)", "q6_opt_b": "元组 (Tuple)", "q6_opt_c": "字典 (Dictionary)", "q6_opt_d": "简单的字符串变量",
                 "q7_text": "在项目准备过程中，使用函数的主要好处是什么？",
                 "q7_opt_a": "使程序总是运行得更快。",
                 "q7_opt_b": "将代码分解成可重用、逻辑清晰的块，提高组织性和可读性。",
                 "q7_opt_c": "消除对变量的需求。",
                 "q7_opt_d": "自动处理所有错误。",
                 "q8_text": "在调试项目某部分无法正常工作时，常见且有效的第一步是什么？",
                 "q8_opt_a": "立即从头重写整个部分。",
                 "q8_opt_b": "添加 `print()` 语句来检查不同点的变量值。",
                 "q8_opt_c": "假设是计算机出了错。",
                 "q8_opt_d": "删除所有注释以简化代码。",
                 "q9_text": "整合代码的不同部分（如函数、循环、文件处理）需要仔细规划，这主要关系到：",
                 "q9_opt_a": "数据如何在不同部分之间流动。",
                 "q9_opt_b": "使用尽可能短的变量名。",
                 "q9_opt_c": "确保每一行都有注释。",
                 "q9_opt_d": "使代码尽可能复杂。",
                 "q10_text": "在准备一个较大的项目时，使用 `import`（例如 `import math`）的主要目的是什么？",
                 "q10_opt_a": "使你的脚本文件体积更小。",
                 "q10_opt_b": "访问模块中预先编写好的代码（函数、变量），促进可重用性。",
                 "q10_opt_c": "自动为你的代码生成文档。",
                 "q10_opt_d": "更改正在使用的 Python 版本。",
                 "submit_answers": "提交答案",
                 "results_pass_title": "<i class=\"fas fa-check-circle\"></i> 通过！",
                 "results_fail_title": "<i class=\"fas fa-times-circle\"></i> 再试一次",
                 "results_score_text": "你的得分：{score} / {totalQuestions}",
                 "results_pass_message": "做得好！你已成功通过本模块的知识测验。你的进度已保存。",
                 "results_fail_message": "别担心！复习一下问题和概念，然后再试一次。你可以的！",
                 "try_again": "再试一次",
                 "kc_passed_back_dashboard": "进度已保存！返回仪表板",
                 "kc_already_passed": "知识测验已通过！",
                 "footer_text": "通往自由开放AGI之路项目的一部分"
             }
        };

        // --- DOM Elements ---
        const kcForm = document.getElementById('kcForm');
        const submitButton = document.getElementById('submitButton');
        const resultsArea = document.getElementById('resultsArea');
        const resultsTitle = document.getElementById('resultsTitle');
        const resultsScore = document.getElementById('resultsScore');
        const resultsMessage = document.getElementById('resultsMessage');
        const tryAgainButton = document.getElementById('tryAgainButton');
        const backToDashboardButton = document.getElementById('backToDashboardButton');
        const languageSelect = document.getElementById('languageSelect');
        const completionOverlay = document.getElementById('completionOverlay');
        const kcCard = document.getElementById('kcCard');


        // --- Utility Functions ---
        function getStoredLanguage() { /* ... (same as dashboard) ... */
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
        }

        function getTranslation(key, lang, replacements = {}) { /* ... (same as dashboard) ... */
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) { /* ... (adapted for KC page) ... */
             if (!translations[lang]) lang = 'en';
             document.documentElement.lang = lang;

             const replacements = { // Define replacements here
                 totalQuestions: totalQuestions,
                 passingScore: PASSING_SCORE,
                 score: currentScore || 0 // Use current score if available
             };

             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang, replacements); // Pass replacements
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                 else { el.textContent = translation; }
             });
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang, replacements)); });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang, replacements)); });

             // Specifically re-translate results if they are visible
             if (resultsArea.style.display !== 'none' && typeof currentScore !== 'undefined') {
                 updateResultsText(currentScore, currentScore >= PASSING_SCORE);
             }
        }

        function setLanguage(lang) { /* ... (same as dashboard) ... */
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            languageSelect.value = lang; // Update dropdown
            translatePage(lang); // Re-translate the page
        }

        function loadKnowledgeCheckStatus() { /* ... (same as dashboard) ... */
             try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; }
        }

        function saveKnowledgeCheckStatus(moduleId, passed) { /* ... (adapted to only update current module) ... */
            const currentStatus = loadKnowledgeCheckStatus();
            currentStatus[moduleId] = passed; // Set status for this module
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }

        // --- Quiz Logic ---
        let currentScore = 0; // Keep track of the score for re-translation

        function handleSubmit(event) {
            event.preventDefault();
            currentScore = 0; // Reset score for this attempt
            let allAnswered = true;

            // Clear previous feedback
            clearFeedback();

            const formData = new FormData(kcForm);
            const userAnswers = {};

            // Check if all questions answered and collect answers
            for (let i = 1; i <= totalQuestions; i++) {
                const answer = formData.get(`q${i}`);
                if (!answer) {
                    allAnswered = false;
                    // Optional: Highlight unanswered questions
                    const qBlock = document.querySelector(`.question-block[data-question-id="${i}"]`);
                    if(qBlock) qBlock.style.borderLeft = '3px solid var(--error-color)'; // Example highlight
                } else {
                     userAnswers[i] = answer;
                     // Remove highlight if answered now
                     const qBlock = document.querySelector(`.question-block[data-question-id="${i}"]`);
                     if(qBlock) qBlock.style.borderLeft = 'none';
                }
            }

            if (!allAnswered) {
                 alert(getTranslation('alert_answer_all', getStoredLanguage())); // Simple alert, could be improved
                 // Add translations for this alert if needed:
                 // en: "Please answer all questions before submitting."
                 // pt: "Por favor, responda todas as questões antes de enviar."
                 // zh: "请在提交前回答所有问题。"
                 return;
            }


            // Calculate score and apply feedback
            for (const questionId in userAnswers) {
                const userAnswer = userAnswers[questionId];
                const correctAnswer = quizData[questionId].correct;
                const options = kcForm.querySelectorAll(`input[name="q${questionId}"]`);

                options.forEach(optionInput => {
                    const label = optionInput.closest('.option-label');
                    if (!label) return;

                    if (optionInput.value === correctAnswer) {
                        label.classList.add('correct'); // Always show correct answer
                    }

                    if (optionInput.checked) { // If this is the one the user selected
                        if (userAnswer === correctAnswer) {
                            currentScore++;
                            // Already marked as correct above
                        } else {
                            label.classList.add('incorrect'); // Mark user's incorrect choice
                        }
                    }
                });
            }

            // Display results
            displayResults(currentScore);
        }

        function clearFeedback() {
            const labels = kcForm.querySelectorAll('.option-label');
            labels.forEach(label => {
                label.classList.remove('correct', 'incorrect');
            });
             const qBlocks = document.querySelectorAll(`.question-block`);
             qBlocks.forEach(block => block.style.borderLeft = 'none'); // Clear highlight
        }

        function resetQuiz() {
            kcForm.reset();
            clearFeedback();
            resultsArea.style.display = 'none';
            submitButton.disabled = false;
            submitButton.style.display = 'inline-block';
            // Scroll back to the top might be nice
            window.scrollTo({ top: kcCard.offsetTop - 30 , behavior: 'smooth' });
        }

        function updateResultsText(score, passed) {
             const lang = getStoredLanguage();
             const replacements = { score: score, totalQuestions: totalQuestions };

             resultsScore.textContent = getTranslation('results_score_text', lang, replacements);

             if (passed) {
                 resultsTitle.innerHTML = getTranslation('results_pass_title', lang);
                 resultsMessage.textContent = getTranslation('results_pass_message', lang);
                 resultsArea.className = 'kc-results pass'; // Use class for styling
                 tryAgainButton.style.display = 'none';
                 backToDashboardButton.style.display = 'inline-block';
             } else {
                 resultsTitle.innerHTML = getTranslation('results_fail_title', lang);
                 resultsMessage.textContent = getTranslation('results_fail_message', lang);
                 resultsArea.className = 'kc-results fail'; // Use class for styling
                 tryAgainButton.style.display = 'inline-block';
                 backToDashboardButton.style.display = 'none';
             }
        }


        function displayResults(score) {
            const passed = score >= PASSING_SCORE;

            updateResultsText(score, passed); // Update text content

            resultsArea.style.display = 'block';
            submitButton.disabled = true; // Disable after submitting
            submitButton.style.display = 'none'; // Hide submit button

            if (passed) {
                saveKnowledgeCheckStatus(MODULE_ID, true);
            }

            // Scroll to results
            resultsArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function checkInitialStatus() {
             const status = loadKnowledgeCheckStatus();
             if (status[MODULE_ID] === true) {
                 completionOverlay.style.display = 'flex'; // Show overlay
                 // Optionally disable the form elements
                 kcForm.querySelectorAll('input, button').forEach(el => el.disabled = true);
                 submitButton.style.display = 'none'; // Hide submit if already passed
             } else {
                 completionOverlay.style.display = 'none'; // Hide overlay
             }
         }

        // --- Event Listeners ---
        kcForm.addEventListener('submit', handleSubmit);
        tryAgainButton.addEventListener('click', resetQuiz);
        languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            languageSelect.value = initialLang;
            translatePage(initialLang);
            checkInitialStatus(); // Check if already passed on load
        });

    </script>

</body>
</html>