<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 23: Advanced Python Practice!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #fd7e14; /* Orange - Distinguishes Advanced */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(253, 126, 20, 0.1); /* Orange highlight */
            --selection-highlight-border: rgba(253, 126, 20, 0.4); /* Orange highlight border */
            /* Nav colors */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--accent-color); font-weight: bold; } /* Use accent color */
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group {
            margin-top: 2rem; display: flex; flex-wrap: wrap;
            justify-content: center; gap: 1rem;
        }

        /* --- Advanced Animations (Same as basic) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav (Same as basic) --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; } .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Practice Header --- */
        .practice-header { background: linear-gradient(135deg, var(--accent-color), #c66a1a); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--primary-color); } /* Orange gradient */
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* fa-level-up-alt */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* fa-cogs */

        /* --- Practice Section Styling (Same as basic) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Same as basic) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button.warning { background-color: var(--accent-color); } /* Added warning style */
        .action-button.warning:hover:not(:disabled) { background-color: #d36a0d; }
        /* Code styling (Same as basic) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; } .code-variable {color: #9cdcfe;} .code-operator {color: #d4d4d4;} .code-method { color: #dcdcaa; } .code-error { color: var(--error-color); font-weight: bold;}

        /* --- Activity 1: Anatomy of File Iteration --- */
        #anatomy-loop-code .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #anatomy-loop-code .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #anatomy-loop-code .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); } /* Teal explanation */
        #anatomy-loop-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 2: Build-a-File-Loop --- */
        #build-loop .draggable-pieces { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1.5rem; padding: 1rem; background-color: var(--background-light); border: 1px dashed var(--secondary-color); border-radius: var(--border-radius); justify-content: center; user-select: none; -webkit-user-select: none; -ms-user-select: none; }
        .piece { display: inline-block; padding: 8px 12px; background-color: var(--primary-color); color: var(--text-light); border-radius: 4px; cursor: grab; font-family: var(--code-font); font-size: 1rem; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.1s ease, box-shadow var(--transition-speed); border: 1px solid #0056b3; touch-action: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .piece:active { cursor: grabbing; }
        .piece.dragging { opacity: 0.6 !important; transform: scale(1.05) rotate(3deg); position: fixed !important; pointer-events: none !important; z-index: 1000 !important; cursor: grabbing !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .piece.ghosting { opacity: 0.3; }
        .piece[data-type="keyword"] { background-color: #4a70b1; border-color:#3a5a91; }
        .piece[data-type="function"] { background-color: #b8a74f; border-color:#9a8a40; }
        .piece[data-type="string"] { background-color: #b17a62; border-color:#9d6c56; }
        .piece[data-type="variable"] { background-color: #73a8c8; border-color:#5f8da8; }
        .piece[data-type="operator"] { background-color: #9b9b9b; border-color:#7c7c7c; }
        .piece[data-type="method"] { background-color: #b8a74f; border-color:#9a8a40; }
        #drop-zone-loop { min-height: 100px; /* Taller for loop */ background-color: var(--background-dark); border: 3px dashed var(--secondary-color); border-radius: var(--border-radius); padding: 15px; display: flex; align-items: flex-start; gap: 5px; flex-wrap: wrap; transition: border-color var(--transition-speed), background-color var(--transition-speed), box-shadow var(--transition-speed); }
        #drop-zone-loop.over { border-color: var(--accent-color); background-color: #495057; box-shadow: inset 0 0 10px rgba(253, 126, 20, 0.2); } /* Orange accent */
        #drop-zone-loop .piece { cursor: default; margin: 0 2px 5px 2px; touch-action: auto; box-shadow: none; }
        #drop-zone-placeholder-loop { color: var(--secondary-color); font-style: italic; width: 100%; text-align: center;}

        /* --- Activity 3: Error Handling Simulator --- */
        #error-handling-sim .sim-controls { margin-bottom: 1.5rem; text-align: center; }
        #error-handling-sim .sim-editor { width: 100%; min-height: 120px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #error-handling-sim .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #error-handling-sim .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #error-handling-sim .sim-output-area .output-line { display: block; }
        #error-handling-sim .sim-output-area .error-line { color: var(--error-color); font-weight: bold; }
        #file-status-indicator { font-weight: bold; margin-left: 10px; }

        /* --- Activity 4: Concept Check --- */
         #concept-check .question-block { margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
         #concept-check .question-text { font-weight: bold; margin-bottom: 1rem; }
         #concept-check .choices { display: flex; flex-direction: column; gap: 10px; }
         .choice-item { display: block; padding: 10px 15px; background-color: var(--background-medium); border: 2px solid transparent; border-radius: var(--border-radius); cursor: pointer; transition: all var(--transition-speed); position: relative; }
         .choice-item:hover { background-color: #d3d9df; }
         .choice-item.selected-visual { background-color: var(--selection-highlight-bg); border-color: var(--selection-highlight-border); color: var(--text-dark); } /* Highlight selection */
         .choice-item.checked-state { cursor: default; }
         .choice-item input[type="radio"], .choice-item input[type="checkbox"] { display: none; } /* Hide default radio/checkbox */
         .choice-item label { display: flex; align-items: center; cursor: pointer; }
         .choice-item .custom-radio, .choice-item .custom-checkbox { width: 18px; height: 18px; border: 2px solid var(--secondary-color); border-radius: 50%; margin-right: 10px; display: inline-block; position: relative; transition: border-color var(--transition-speed); flex-shrink: 0; }
         .choice-item .custom-checkbox { border-radius: 4px; }
         .choice-item.selected-visual .custom-radio, .choice-item.selected-visual .custom-checkbox { border-color: var(--accent-color); }
         .choice-item .custom-radio::after, .choice-item .custom-checkbox::after { content: ''; width: 10px; height: 10px; background-color: var(--accent-color); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); transition: transform var(--transition-speed) ease-in-out; }
         .choice-item .custom-checkbox::after { border-radius: 2px; width: 8px; height: 8px; } /* Square check */
         .choice-item.selected-visual .custom-radio::after, .choice-item.selected-visual .custom-checkbox::after { transform: translate(-50%, -50%) scale(1); }
         .choice-item .feedback-icon-placeholder { width: 24px; height: 20px; margin-left: auto; /* Push icon to right */ display: inline-flex; align-items: center; justify-content: center; transition: opacity var(--transition-speed); opacity: 0; font-size: 1.1rem; }
         .choice-item .feedback-icon-placeholder.visible { opacity: 1; }
         .choice-item .feedback-icon-placeholder .fa-check { color: var(--success-color); animation: iconAppearCorrect 0.5s ease-out forwards; }
         .choice-item .feedback-icon-placeholder .fa-times { color: var(--error-color); animation: iconAppearIncorrect 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
         #reset-concepts-btn { margin-left: 10px; }

        /* --- Activity 5: Mini Missions (Advanced File I/O) --- */
        #missions-advanced .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        #missions-advanced .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        #missions-advanced .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        #missions-advanced .mission-status .fa-times-circle { color: var(--error-color); }
        #missions-advanced .mission-status .fa-question-circle { color: var(--secondary-color); }
        #missions-advanced .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #missions-advanced .mission-virtual-file { margin-top: 1rem; padding: 0.8rem; background-color: var(--background-medium); border: 1px solid #ced4da; border-radius: var(--border-radius); font-size: 0.9rem;}
        #missions-advanced .mission-virtual-file code { font-weight: bold; }
        #missions-advanced .mission-virtual-file pre { background-color: #fff; padding: 0.5rem; border-radius: 4px; margin-top: 5px; }
        #missions-advanced .mission-editor { width: 100%; min-height: 140px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #missions-advanced .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        #missions-advanced .mission-output .error-line { color: var(--error-color); }

        /* --- Final Section --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Adjustments) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            #build-loop .draggable-pieces { padding: 0.8rem; }
            .piece { padding: 6px 10px; font-size: 0.95rem; }
            #drop-zone-loop { min-height: 90px; padding: 10px; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            #error-handling-sim .sim-editor, #error-handling-sim .sim-output-area { font-size: 0.9rem; }
            #missions-advanced .mission-editor, #missions-advanced .mission-output { font-size: 0.95rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
             .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
             .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
             .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
             .minimal-nav ul li a i.fas { margin-right: 8px; }
             #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** MODIFIED Links for Advanced Page *** -->
            <li><a href="ctp-practice-23.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_basic_practice">Basic Practice</span></a></li>
            <li><a href="ctp-video-23.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video_lesson">Watch Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** MODIFIED Section Links *** -->
            <li><a href="#anatomy-loop"><i class="fas fa-sync-alt fa-fw"></i> <span data-translate="nav_anatomy_loop">Loop Anatomy</span></a></li>
            <li><a href="#build-loop"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_build_loop">Build Loop</span></a></li>
            <li><a href="#error-handling-sim"><i class="fas fa-exclamation-triangle fa-fw"></i> <span data-translate="nav_error_sim">Error Sim</span></a></li>
            <li><a href="#concept-check"><i class="fas fa-question-circle fa-fw"></i> <span data-translate="nav_concept_check">Concepts</span></a></li>
            <li><a href="#missions-advanced"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_missions_advanced">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- *** MODIFIED Icons *** -->
        <i class="fas fa-level-up-alt header-icon icon1"></i>
        <i class="fas fa-cogs header-icon icon2"></i>
        <div class="container">
            <!-- *** MODIFIED Titles *** -->
            <h1 data-translate="header_title">Module 23: Advanced Practice</h1>
            <p data-translate="header_subtitle">Let's refine our file reading skills with loops and error handling!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Anatomy of File Iteration ========= -->
        <section id="anatomy-loop" class="practice-section">
             <div class="container">
                 <!-- *** MODIFIED Title & Desc *** -->
                 <h2 class="fade-in"><i class="fas fa-sync-alt"></i> <span data-translate="anatomy_loop_title">Anatomy of File Iteration</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="anatomy_loop_desc">
                     A more Pythonic way to read lines is by iterating directly over the file object. Let's dissect this efficient pattern, including stripping whitespace. Click each part.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="anatomy-loop-code" class="code-block">
                         <pre style="margin:0; padding:0; background:none; border:none; color: inherit; font-size: inherit;"><code style="display: block; white-space: pre;"><span class="code-part" data-part="with" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">with</span></span> <span class="code-part" data-part="open" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-function">open</span></span><span class="code-paren">(</span><span class="code-part" data-part="filename" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-string">'logs.txt'</span></span><span class="code-operator">,</span> <span class="code-part" data-part="mode" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-string">'r'</span></span><span class="code-paren">)</span> <span class="code-part" data-part="as" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">as</span></span> <span class="code-part" data-part="variable" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-variable">infile</span></span><span class="code-operator">:</span>
    <span class="code-part" data-part="for" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">for</span></span> <span class="code-part" data-part="loop-var" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-variable">line</span></span> <span class="code-part" data-part="in" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">in</span></span> <span class="code-part" data-part="file-var-loop" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-variable">infile</span></span><span class="code-operator">:</span>
        <span class="code-part" data-part="process" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-function">print</span><span class="code-paren">(</span></span><span class="code-part" data-part="strip-call" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-variable">line</span><span class="code-operator">.</span><span class="code-method">strip</span><span class="code-paren">()</span></span><span class="code-part" data-part="close-paren-print" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-paren">)</span></span></code></pre>
                     </div>
                     <div id="anatomy-loop-explanations"></div>
                     <p id="anatomy-loop-status" data-translate="anatomy_loop_status_initial">Identify all parts!</p>
                     <div id="anatomy-loop-feedback" class="feedback-message"></div>
                     <!-- Hidden elements for storing translated explanation parts -->
                     <div id="explanation-texts-loop" style="display: none;">
                        <span data-key="with" data-translate="anatomy_exp_with">`with` statement: Ensures automatic file closing.</span>
                        <span data-key="open" data-translate="anatomy_exp_open">`open()` function: Opens the specified file.</span>
                        <span data-key="filename" data-translate="anatomy_exp_filename_loop">Filename: The path to the file (e.g., 'logs.txt').</span>
                        <span data-key="mode" data-translate="anatomy_exp_mode_loop">Mode: `'r'` for reading.</span>
                        <span data-key="as" data-translate="anatomy_exp_as">`as`: Assigns the file object.</span>
                        <span data-key="variable" data-translate="anatomy_exp_variable_loop">File variable (`infile`): Represents the open file.</span>
                        <span data-key="for" data-translate="anatomy_exp_for">`for` loop: Iterates over items in a sequence.</span>
                        <span data-key="loop-var" data-translate="anatomy_exp_loop_var">Loop variable (`line`): Holds the current item (line) in each iteration.</span>
                        <span data-key="in" data-translate="anatomy_exp_in">`in`: Keyword used in `for` loops to specify the sequence to iterate over.</span>
                        <span data-key="file-var-loop" data-translate="anatomy_exp_file_var_loop">Iterable (`infile`): The file object itself acts as an iterable of its lines.</span>
                        <span data-key="process" data-translate="anatomy_exp_process">Processing (`print(`): Action taken on each line (here, printing).</span>
                        <span data-key="strip-call" data-translate="anatomy_exp_strip_call">`line.strip()`: Calls the `strip()` method on the line string to remove leading/trailing whitespace (like the newline character `\n`).</span>
                        <span data-key="close-paren-print" data-translate="anatomy_exp_close_paren_print">`)`: Closes the `print()` function call.</span>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Build-a-File-Loop ========= -->
        <section id="build-loop" class="practice-section">
             <div class="container">
                 <!-- *** MODIFIED Title & Desc *** -->
                 <h2 class="fade-in"><i class="fas fa-cogs"></i> <span data-translate="build_loop_title">Build a File Loop</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="build_loop_desc">
                     Drag the pieces to construct a Python loop that opens `config.cfg`, iterates through each `line`, and prints the line <span class="highlight code-font">without</span> leading/trailing whitespace.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="draggable-pieces-loop" class="draggable-pieces">
                         <!-- Pieces populated by JS -->
                     </div>
                     <div id="drop-zone-loop" class="code-font">
                         <span id="drop-zone-placeholder-loop" data-translate="build_loop_drop_placeholder">Drop pieces here to build the loop...</span>
                     </div>
                     <div class="text-center">
                         <button id="check-build-loop-btn" class="action-button" data-translate="button_check_build">Check My Code</button>
                         <button id="reset-build-loop-btn" class="action-button secondary" data-translate="button_reset_build">Reset</button>
                     </div>
                     <div id="build-loop-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Error Handling Simulator ========= -->
        <section id="error-handling-sim" class="practice-section">
             <div class="container">
                 <!-- *** NEW Activity *** -->
                 <h2 class="fade-in"><i class="fas fa-exclamation-triangle"></i> <span data-translate="error_sim_title">Error Handling Simulator</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="error_sim_desc">
                     What happens if a file doesn't exist? Use `try...except FileNotFoundError` to handle this gracefully. Edit the code to safely read `maybe.txt` and print its content OR print an error message if it's missing. Use the button to toggle if the file "exists".
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="sim-controls">
                         <button id="toggle-file-exists-btn" class="action-button secondary" data-translate="button_toggle_file">Toggle File Existence</button>
                         <span id="file-status-indicator"></span>
                     </div>

                     <label for="sim-error-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="simulator_editor_label">Code Editor:</label>
                     <textarea id="sim-error-editor-input" class="sim-editor" rows="8" data-translate-placeholder="error_sim_placeholder" placeholder='try:\n    with open("maybe.txt", "r") as f:\n        content = f.read()\n        print("File Content:")\n        print(content)\nexcept FileNotFoundError:\n    print("Error: File not found!")'></textarea>
                     <div class="text-center">
                          <button id="run-sim-error-btn" class="action-button" data-translate="button_run_sim">Run Simulation</button>
                     </div>
                     <label for="sim-error-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="simulator_output_label">Simulated Output:</label>
                     <div id="sim-error-output" class="sim-output-area">
                         <span class="placeholder" data-translate="simulator_output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="sim-error-feedback" class="feedback-message"></div>
                     <!-- Virtual content for when file exists -->
                     <div id="error-sim-virtual-content" style="display:none;">This is the content of maybe.txt when it exists.</div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4: Concept Check ========= -->
        <section id="concept-check" class="practice-section">
            <div class="container">
                <!-- *** NEW Activity *** -->
                <h2 class="fade-in"><i class="fas fa-question-circle"></i> <span data-translate="concept_check_title">Concept Check</span></h2>
                <p class="section-description fade-in delay-1" data-translate="concept_check_desc">
                    Let's check your understanding of some key file handling concepts. Choose the best answer(s).
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="concept-questions">
                        <!-- Questions loaded by JS -->
                    </div>
                     <div class="text-center">
                         <button id="check-concepts-btn" class="action-button" data-translate="button_check_selection">Check Answers</button>
                         <button id="reset-concepts-btn" class="action-button secondary hidden" data-translate="button_try_again">Try Again</button>
                     </div>
                     <div id="concepts-feedback" class="feedback-message"></div>

                     <!-- Hidden Template for Questions -->
                     <div id="question-template" class="question-block hidden">
                         <div class="question-text" data-translate="question_text_placeholder">Question text?</div>
                         <div class="choices" data-question-id="" data-correct-answer="">
                             <!-- Choices added by JS -->
                         </div>
                     </div>
                      <!-- Hidden Template for Choices -->
                      <div id="choice-template" class="choice-item hidden" data-choice-value="">
                           <label>
                               <span class="custom-radio"></span>
                               <span class="choice-text" data-translate="choice_text_placeholder">Choice text</span>
                               <span class="feedback-icon-placeholder"></span>
                           </label>
                       </div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 5: Mini Missions (Advanced File I/O) ========= -->
        <section id="missions-advanced" class="practice-section">
             <div class="container">
                  <!-- *** MODIFIED Title & Desc *** -->
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="missions_advanced_title">Advanced Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_advanced_desc">
                     Time for some more complex tasks involving iteration, processing, and error handling.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="mission-adv-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv1_title">Mission 1: Summing Numbers</h4>
                         <p data-translate="mission_adv1_desc">Read <code>numbers.txt</code> line by line. Each line contains a number. Convert each line to an integer (after stripping whitespace!) and calculate the total sum. Print only the final sum.</p>
                         <div class="mission-virtual-file">
                             <span data-translate="mission_virtual_file_label">Virtual File: <code>numbers.txt</code></span>
                             <pre id="mission-adv-1-virtual-content"></pre>
                         </div>
                         <textarea class="sim-editor mission-editor" rows="6" data-translate-placeholder="mission_adv1_placeholder" placeholder='total = 0\nwith open("numbers.txt", "r") as f:\n    for line in f:\n        num = int(line.strip())\n        total += num\nprint(total)'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-adv-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="mission-adv-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv2_title">Mission 2: Count Specific Lines</h4>
                         <p data-translate="mission_adv2_desc">Read <code>words.txt</code> line by line. Count how many lines contain the word "AI" (case-sensitive). Print only the final count.</p>
                          <div class="mission-virtual-file">
                             <span data-translate="mission_virtual_file_label">Virtual File: <code>words.txt</code></span>
                             <pre id="mission-adv-2-virtual-content"></pre>
                         </div>
                         <textarea class="sim-editor mission-editor" rows="6" data-translate-placeholder="mission_adv2_placeholder" placeholder='count = 0\nwith open("words.txt", "r") as f:\n    for line in f:\n        if "AI" in line:\n            count += 1\nprint(count)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-adv-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="mission-adv-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv3_title">Mission 3: Safe Read</h4>
                         <p data-translate="mission_adv3_desc">Attempt to open and read the entire content of <code>secret.txt</code>. If the file exists, print its content. If it <span class="highlight">doesn't exist</span>, print the exact message: <code class="code-error">Secret file not found.</code> Use `try...except FileNotFoundError`.</p>
                         <div class="mission-virtual-file">
                             <span data-translate="mission_virtual_file_label_secret">Virtual File: <code>secret.txt</code> (Sometimes Exists!)</span>
                             <button id="toggle-secret-file-btn" class="action-button secondary" style="font-size:0.8em; padding: 4px 8px; margin-left: 10px;" data-translate="button_toggle_secret">Toggle Existence</button>
                             <pre id="mission-adv-3-virtual-content" style="opacity:0.5; margin-top: 5px;" data-translate="secret_exists_placeholder">[Content hidden unless file exists]</pre>
                         </div>
                         <textarea class="sim-editor mission-editor" rows="7" data-translate-placeholder="mission_adv3_placeholder" placeholder='try:\n    with open("secret.txt", "r") as f:\n        # ... read and print\nexcept FileNotFoundError:\n    # ... print error message'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-adv-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="missions-advanced-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in">
                     <!-- *** MODIFIED Icons *** -->
                    <i class="fas fa-check-double"></i> <i class="fas fa-file-code"></i> <i class="fas fa-star"></i>
                </div>
                 <!-- *** MODIFIED Titles *** -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 23 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Fantastic! You've tackled more advanced file reading techniques, including iteration and error handling. Persistence pays off!<br>
                    Feel free to review the <span data-translate="completion_link_video">Video Lesson</span> or head back to the <span data-translate="completion_link_dashboard">Course Menu</span>.
                </p>
                <div class="button-group">
                    <!-- *** MODIFIED Links *** -->
                    <a href="ctp-practice-23.html" class="action-button secondary fade-in delay-3"><i class="fas fa-arrow-left"></i> <span data-translate="button_back_basic">Back to Basic Practice</span></a>
                    <a href="ctp-video-23.html" class="action-button info fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_watch_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    // *** NEW Translations for Module 23 Advanced ***
    const translations = {
        en: {
            "page_title": "Module 23: Advanced Python Practice!",
            "tooltip_click_identify": "Click to identify this part",
            "nav_basic_practice": "Basic Practice", "nav_video_lesson": "Watch Video Lesson", "nav_menu": "Course Menu",
            "nav_anatomy_loop": "Loop Anatomy", "nav_build_loop": "Build Loop", "nav_error_sim": "Error Sim", "nav_concept_check": "Concepts", "nav_missions_advanced": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 23: Advanced Practice", "header_subtitle": "Let's refine our file reading skills with loops and error handling!",
            "anatomy_loop_title": "Anatomy of File Iteration", "anatomy_loop_desc": "A more Pythonic way to read lines is by iterating directly over the file object. Let's dissect this efficient pattern, including stripping whitespace. Click each part.",
            "anatomy_loop_status_initial": "Identify all 13 parts!", "anatomy_loop_status_progress": "Identified {count} of {total} parts.", "anatomy_loop_status_done": "All parts identified!",
            "anatomy_exp_with": "`with` statement: Ensures automatic file closing.", // Reused key okay
            "anatomy_exp_open": "`open()` function: Opens the specified file.", // Reused key okay
            "anatomy_exp_filename_loop": "Filename: The path to the file (e.g., 'logs.txt').", // New key for context
            "anatomy_exp_mode_loop": "Mode: `'r'` for reading.",
            "anatomy_exp_as": "`as`: Assigns the file object.", // Reused key okay
            "anatomy_exp_variable_loop": "File variable (`infile`): Represents the open file.",
            "anatomy_exp_for": "`for` loop: Iterates over items in a sequence.",
            "anatomy_exp_loop_var": "Loop variable (`line`): Holds the current item (line) in each iteration.",
            "anatomy_exp_in": "`in`: Keyword used in `for` loops to specify the sequence to iterate over.",
            "anatomy_exp_file_var_loop": "Iterable (`infile`): The file object itself acts as an iterable of its lines.",
            "anatomy_exp_process": "Processing (`print(`): Action taken on each line (here, printing).",
            "anatomy_exp_strip_call": "`line.strip()`: Calls the `strip()` method on the line string to remove leading/trailing whitespace (like the newline character `\\n`).",
            "anatomy_exp_close_paren_print": "`)`: Closes the `print()` function call.",
            "feedback_anatomy_correct": "Excellent! You've mapped out file iteration!",
            "build_loop_title": "Build a File Loop", "build_loop_desc": "Drag the pieces to construct a Python loop that opens `config.cfg`, iterates through each `line`, and prints the line <span class=\"highlight code-font\">without</span> leading/trailing whitespace.",
            "build_loop_drop_placeholder": "Drop pieces here to build the loop...",
            "build_piece_with": "with", "build_piece_open": "open(", "build_piece_filename_cfg": "'config.cfg'", "build_piece_mode": "'r'", "build_piece_close_paren": ")", "build_piece_as": "as", "build_piece_variable_f": "f", "build_piece_colon": ":", "build_piece_for": "for", "build_piece_loop_var": "line", "build_piece_in": "in", "build_piece_print_strip": "print(line.strip())", "build_piece_read": "data = f.read()", // Wrong piece
            "button_check_build": "Check My Code", "button_reset_build": "Reset",
            "feedback_build_correct": "Perfect loop structure!", "feedback_build_almost": "Very close! Check the order, indentation (conceptually), or the use of `.strip()`.", "feedback_build_incorrect": "Not quite right. Ensure you have the `with open`, `for line in`, and `print(line.strip())` parts correct.",
            "error_sim_title": "Error Handling Simulator", "error_sim_desc": "What happens if a file doesn't exist? Use `try...except FileNotFoundError` to handle this gracefully. Edit the code to safely read `maybe.txt` and print its content OR print an error message if it's missing. Use the button to toggle if the file \"exists\".",
            "button_toggle_file": "Toggle File Existence", "file_status_exists": "File 'maybe.txt' <span style='color:var(--success-color)'>Exists</span>", "file_status_missing": "File 'maybe.txt' <span style='color:var(--error-color)'>Missing</span>",
            "simulator_editor_label": "Code Editor:", "error_sim_placeholder": "try:\n    with open(\"maybe.txt\", \"r\") as f:\n        content = f.read()\n        print(\"File Content:\")\n        print(content)\nexcept FileNotFoundError:\n    print(\"Error: File not found!\")",
            "button_run_sim": "Run Simulation", "simulator_output_label": "Simulated Output:", "simulator_output_placeholder": "Output will appear here...",
            "feedback_sim_success_exists": "Simulation successful! File read correctly.", "feedback_sim_success_missing": "Simulation successful! Error handled correctly.", "feedback_sim_empty": "Editor is empty.", "feedback_sim_no_try": "Missing `try` block.", "feedback_sim_no_except": "Missing `except FileNotFoundError:` block.", "feedback_sim_wrong_exception": "Check the exception type (`FileNotFoundError`).", "feedback_sim_no_open_in_try": "The `with open(...)` should be inside the `try` block.", "feedback_sim_output_mismatch_exists": "Output doesn't match expected content when file exists.", "feedback_sim_output_mismatch_missing": "Error message in output doesn't match when file is missing.", "feedback_sim_syntax": "Check your Python syntax.",
            "concept_check_title": "Concept Check", "concept_check_desc": "Let's check your understanding of some key file handling concepts. Choose the best answer(s).",
            "question_text_placeholder": "Question text?", "choice_text_placeholder": "Choice text", // Placeholders for templates
            "concept_q1_text": "Why is iterating with `for line in file_object:` often preferred over `file_object.readlines()` for large files?",
            "concept_q1_c1": "It's faster for small files.", "concept_q1_c2": "It reads the entire file into memory at once.", "concept_q1_c3": "It reads the file line by line, saving memory.", "concept_q1_c4": "It automatically closes the file.",
            "concept_q2_text": "What does the `.strip()` string method typically remove when called without arguments?",
            "concept_q2_c1": "Only spaces.", "concept_q2_c2": "Only newline characters (`\\n`).", "concept_q2_c3": "Leading and trailing whitespace (spaces, tabs, newlines).", "concept_q2_c4": "All whitespace within the string.",
            "concept_q3_text": "Which error is specifically raised when `open()` tries to read a file that does not exist?",
            "concept_q3_c1": "IOError", "concept_q3_c2": "ValueError", "concept_q3_c3": "FileNotFoundError", "concept_q3_c4": "SystemError",
            "concept_q4_text": "Why might you specify `encoding='utf-8'` when opening a text file?",
            "concept_q4_c1": "To make the file read-only.", "concept_q4_c2": "To handle a wider range of characters correctly (like accents or emojis).", "concept_q4_c3": "To automatically compress the file.", "concept_q4_c4": "To speed up file reading.",
            "button_check_selection": "Check Answers", "button_try_again": "Try Again",
            "feedback_concepts_correct": "Perfect score! You've grasped these concepts. <i class=\"fas fa-brain\"></i>", "feedback_concepts_incorrect": "Some answers need review. Check the feedback on each question.",
            "missions_advanced_title": "Advanced Mini Missions!", "missions_advanced_desc": "Time for some more complex tasks involving iteration, processing, and error handling.",
            "mission_virtual_file_label": "Virtual File:", "mission_virtual_file_label_secret": "Virtual File: <code>secret.txt</code> (Sometimes Exists!)",
            "mission_adv1_title": "Mission 1: Summing Numbers", "mission_adv1_desc": "Read <code>numbers.txt</code> line by line. Each line contains a number. Convert each line to an integer (after stripping whitespace!) and calculate the total sum. Print only the final sum.", "mission_adv1_placeholder": "total = 0\nwith open(\"numbers.txt\", \"r\") as f:\n    for line in f:\n        num = int(line.strip())\n        total += num\nprint(total)", "mission_adv1_content": "   10   \n25\n  -5\n 100 \n", // Content with extra spaces
            "button_test_mission_1": "Test Mission 1",
            "mission_adv2_title": "Mission 2: Count Specific Lines", "mission_adv2_desc": "Read <code>words.txt</code> line by line. Count how many lines contain the word \"AI\" (case-sensitive). Print only the final count.", "mission_adv2_placeholder": "count = 0\nwith open(\"words.txt\", \"r\") as f:\n    for line in f:\n        if \"AI\" in line:\n            count += 1\nprint(count)", "mission_adv2_content": "Learning Python is fun.\nAI is transforming industries.\nWhat about Artificial Intelligence?\nMore AI examples.\nai is different.",
            "button_test_mission_2": "Test Mission 2",
            "mission_adv3_title": "Mission 3: Safe Read", "mission_adv3_desc": "Attempt to open and read the entire content of <code>secret.txt</code>. If the file exists, print its content. If it <span class=\"highlight\">doesn't exist</span>, print the exact message: <code class=\"code-error\">Secret file not found.</code> Use `try...except FileNotFoundError`.", "mission_adv3_placeholder": "try:\n    with open(\"secret.txt\", \"r\") as f:\n        # ... read and print\nexcept FileNotFoundError:\n    # ... print error message", "secret_content": "The secret code is 123!", "secret_exists_placeholder": "[Content hidden unless file exists]", "button_toggle_secret": "Toggle Existence",
            "button_test_mission_3": "Test Mission 3",
            "feedback_mission_success": "Mission Accomplished!", "feedback_mission_syntax_error": "Syntax/logic error. Check loop, conversion, condition, or try/except.",
            "feedback_mission1_hint": "Use a loop, `line.strip()`, `int()`, and accumulate a total.", "feedback_mission2_hint": "Use a loop, `in` operator for string checking, and increment a counter.", "feedback_mission3_hint_try": "Need `try...except FileNotFoundError` structure.", "feedback_mission3_hint_output_exists": "Check the output when the file exists.", "feedback_mission3_hint_output_missing": "Output must be exactly 'Secret file not found.' when missing.",
            "feedback_missions_summary_all_done": "All {totalMissions} advanced missions complete! Excellent work!", "feedback_missions_summary_progress": "Completed {completedCount} of {totalMissions} advanced missions. Keep it up!",
            "completion_title": "Module 23 Advanced Practice Complete!", "completion_desc": "Fantastic! You've tackled more advanced file reading techniques, including iteration and error handling. Persistence pays off!<br> Feel free to review the <span data-translate=\"completion_link_video\">Video Lesson</span> or head back to the <span data-translate=\"completion_link_dashboard\">Course Menu</span>.",
            "completion_link_video": "Video Lesson", "completion_link_dashboard": "Course Menu",
            "button_back_basic": "Back to Basic Practice", "button_watch_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 23: Prática Avançada de Python!",
            "tooltip_click_identify": "Clique para identificar esta parte",
            "nav_basic_practice": "Prática Básica", "nav_video_lesson": "Ver Videoaula", "nav_menu": "Menu do Curso",
            "nav_anatomy_loop": "Anatomia do Loop", "nav_build_loop": "Construir Loop", "nav_error_sim": "Simulador Erro", "nav_concept_check": "Conceitos", "nav_missions_advanced": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 23: Prática Avançada", "header_subtitle": "Vamos refinar nossas habilidades de leitura de arquivos com loops e tratamento de erros!",
            "anatomy_loop_title": "Anatomia da Iteração em Arquivos", "anatomy_loop_desc": "Uma maneira mais Pythônica de ler linhas é iterando diretamente sobre o objeto do arquivo. Vamos dissecar este padrão eficiente, incluindo a remoção de espaços em branco. Clique em cada parte.",
            "anatomy_loop_status_initial": "Identifique todas as 13 partes!", "anatomy_loop_status_progress": "Identificadas {count} de {total} partes.", "anatomy_loop_status_done": "Todas as partes identificadas!",
            "anatomy_exp_with": "Declaração `with`: Garante fechamento automático do arquivo.",
            "anatomy_exp_open": "Função `open()`: Abre o arquivo especificado.",
            "anatomy_exp_filename_loop": "Nome do arquivo: O caminho para o arquivo (ex: 'logs.txt').",
            "anatomy_exp_mode_loop": "Modo: `'r'` para leitura.",
            "anatomy_exp_as": "`as`: Atribui o objeto do arquivo.",
            "anatomy_exp_variable_loop": "Variável do arquivo (`infile`): Representa o arquivo aberto.",
            "anatomy_exp_for": "Loop `for`: Itera sobre itens em uma sequência.",
            "anatomy_exp_loop_var": "Variável do loop (`line`): Contém o item atual (linha) em cada iteração.",
            "anatomy_exp_in": "`in`: Palavra-chave usada em loops `for` para especificar a sequência a iterar.",
            "anatomy_exp_file_var_loop": "Iterável (`infile`): O próprio objeto do arquivo age como um iterável de suas linhas.",
            "anatomy_exp_process": "Processamento (`print(`): Ação realizada em cada linha (aqui, imprimir).",
            "anatomy_exp_strip_call": "`line.strip()`: Chama o método `strip()` na string da linha para remover espaços em branco no início/fim (como o caractere de nova linha `\\n`).",
            "anatomy_exp_close_paren_print": "`)`: Fecha a chamada da função `print()`.",
            "feedback_anatomy_correct": "Excelente! Você mapeou a iteração de arquivos!",
            "build_loop_title": "Construa um Loop de Arquivo", "build_loop_desc": "Arraste as peças para construir um loop Python que abre `config.cfg`, itera por cada `line` e imprime a linha <span class=\"highlight code-font\">sem</span> espaços em branco no início/fim.",
            "build_loop_drop_placeholder": "Solte as peças aqui para construir o loop...",
            "build_piece_with": "with", "build_piece_open": "open(", "build_piece_filename_cfg": "'config.cfg'", "build_piece_mode": "'r'", "build_piece_close_paren": ")", "build_piece_as": "as", "build_piece_variable_f": "f", "build_piece_colon": ":", "build_piece_for": "for", "build_piece_loop_var": "line", "build_piece_in": "in", "build_piece_print_strip": "print(line.strip())", "build_piece_read": "data = f.read()",
            "button_check_build": "Verificar Meu Código", "button_reset_build": "Reiniciar",
            "feedback_build_correct": "Estrutura de loop perfeita!", "feedback_build_almost": "Muito perto! Verifique a ordem, indentação (conceitualmente) ou o uso de `.strip()`.", "feedback_build_incorrect": "Não está certo. Garanta que você tenha as partes `with open`, `for line in` e `print(line.strip())` corretas.",
            "error_sim_title": "Simulador de Tratamento de Erros", "error_sim_desc": "O que acontece se um arquivo não existir? Use `try...except FileNotFoundError` para tratar isso graciosamente. Edite o código para ler `maybe.txt` com segurança e imprimir seu conteúdo OU imprimir uma mensagem de erro se estiver faltando. Use o botão para alternar se o arquivo \"existe\".",
            "button_toggle_file": "Alternar Existência do Arquivo", "file_status_exists": "Arquivo 'maybe.txt' <span style='color:var(--success-color)'>Existe</span>", "file_status_missing": "Arquivo 'maybe.txt' <span style='color:var(--error-color)'>Ausente</span>",
            "simulator_editor_label": "Editor de Código:", "error_sim_placeholder": "try:\n    with open(\"maybe.txt\", \"r\") as f:\n        content = f.read()\n        print(\"Conteúdo do Arquivo:\")\n        print(content)\nexcept FileNotFoundError:\n    print(\"Erro: Arquivo não encontrado!\")",
            "button_run_sim": "Executar Simulação", "simulator_output_label": "Saída Simulada:", "simulator_output_placeholder": "A saída aparecerá aqui...",
            "feedback_sim_success_exists": "Simulação bem-sucedida! Arquivo lido corretamente.", "feedback_sim_success_missing": "Simulação bem-sucedida! Erro tratado corretamente.", "feedback_sim_empty": "O editor está vazio.", "feedback_sim_no_try": "Faltando bloco `try`.", "feedback_sim_no_except": "Faltando bloco `except FileNotFoundError:`.", "feedback_sim_wrong_exception": "Verifique o tipo da exceção (`FileNotFoundError`).", "feedback_sim_no_open_in_try": "O `with open(...)` deve estar dentro do bloco `try`.", "feedback_sim_output_mismatch_exists": "A saída não corresponde ao conteúdo esperado quando o arquivo existe.", "feedback_sim_output_mismatch_missing": "A mensagem de erro na saída não corresponde quando o arquivo está ausente.", "feedback_sim_syntax": "Verifique sua sintaxe Python.",
            "concept_check_title": "Verificação de Conceitos", "concept_check_desc": "Vamos verificar sua compreensão de alguns conceitos chave de manipulação de arquivos. Escolha a(s) melhor(es) resposta(s).",
            "question_text_placeholder": "Texto da pergunta?", "choice_text_placeholder": "Texto da escolha",
            "concept_q1_text": "Por que iterar com `for line in file_object:` é frequentemente preferível a `file_object.readlines()` para arquivos grandes?",
            "concept_q1_c1": "É mais rápido para arquivos pequenos.", "concept_q1_c2": "Lê o arquivo inteiro para a memória de uma vez.", "concept_q1_c3": "Lê o arquivo linha por linha, economizando memória.", "concept_q1_c4": "Fecha o arquivo automaticamente.",
            "concept_q2_text": "O que o método de string `.strip()` normalmente remove quando chamado sem argumentos?",
            "concept_q2_c1": "Apenas espaços.", "concept_q2_c2": "Apenas caracteres de nova linha (`\\n`).", "concept_q2_c3": "Espaços em branco no início e no fim (espaços, tabs, novas linhas).", "concept_q2_c4": "Todos os espaços em branco dentro da string.",
            "concept_q3_text": "Qual erro é especificamente lançado quando `open()` tenta ler um arquivo que não existe?",
            "concept_q3_c1": "IOError", "concept_q3_c2": "ValueError", "concept_q3_c3": "FileNotFoundError", "concept_q3_c4": "SystemError",
            "concept_q4_text": "Por que você especificaria `encoding='utf-8'` ao abrir um arquivo de texto?",
            "concept_q4_c1": "Para tornar o arquivo somente leitura.", "concept_q4_c2": "Para lidar corretamente com uma gama maior de caracteres (como acentos ou emojis).", "concept_q4_c3": "Para comprimir automaticamente o arquivo.", "concept_q4_c4": "Para acelerar a leitura do arquivo.",
            "button_check_selection": "Verificar Respostas", "button_try_again": "Tentar Novamente",
            "feedback_concepts_correct": "Pontuação perfeita! Você dominou esses conceitos. <i class=\"fas fa-brain\"></i>", "feedback_concepts_incorrect": "Algumas respostas precisam de revisão. Verifique o feedback em cada questão.",
            "missions_advanced_title": "Mini Missões Avançadas!", "missions_advanced_desc": "Hora de algumas tarefas mais complexas envolvendo iteração, processamento e tratamento de erros.",
            "mission_virtual_file_label": "Arquivo Virtual:", "mission_virtual_file_label_secret": "Arquivo Virtual: <code>secret.txt</code> (Às vezes Existe!)",
            "mission_adv1_title": "Missão 1: Somando Números", "mission_adv1_desc": "Leia <code>numeros.txt</code> linha por linha. Cada linha contém um número. Converta cada linha para inteiro (após usar `strip()`) e calcule a soma total. Imprima apenas a soma final.", "mission_adv1_placeholder": "total = 0\nwith open(\"numeros.txt\", \"r\") as f:\n    for linha in f:\n        num = int(linha.strip())\n        total += num\nprint(total)", "mission_adv1_content": "   10   \n25\n  -5\n 100 \n",
            "button_test_mission_1": "Testar Missão 1",
            "mission_adv2_title": "Missão 2: Contar Linhas Específicas", "mission_adv2_desc": "Leia <code>palavras.txt</code> linha por linha. Conte quantas linhas contêm a palavra \"IA\" (sensível a maiúsculas/minúsculas). Imprima apenas a contagem final.", "mission_adv2_placeholder": "contador = 0\nwith open(\"palavras.txt\", \"r\") as f:\n    for linha in f:\n        if \"IA\" in linha:\n            contador += 1\nprint(contador)", "mission_adv2_content": "Aprender Python é divertido.\nIA está transformando indústrias.\nE sobre Inteligência Artificial?\nMais exemplos de IA.\nia é diferente.", // pt
            "button_test_mission_2": "Testar Missão 2",
            "mission_adv3_title": "Missão 3: Leitura Segura", "mission_adv3_desc": "Tente abrir e ler todo o conteúdo de <code>segredo.txt</code>. Se o arquivo existir, imprima seu conteúdo. Se <span class=\"highlight\">não existir</span>, imprima a mensagem exata: <code class=\"code-error\">Arquivo secreto não encontrado.</code> Use `try...except FileNotFoundError`.", "mission_adv3_placeholder": "try:\n    with open(\"segredo.txt\", \"r\") as f:\n        # ... ler e imprimir\nexcept FileNotFoundError:\n    # ... imprimir mensagem de erro", "secret_content": "O código secreto é 123!", "secret_exists_placeholder": "[Conteúdo oculto a menos que o arquivo exista]", "button_toggle_secret": "Alternar Existência",
            "button_test_mission_3": "Testar Missão 3",
            "feedback_mission_success": "Missão Cumprida!", "feedback_mission_syntax_error": "Erro de sintaxe/lógica. Verifique loop, conversão, condição ou try/except.",
            "feedback_mission1_hint": "Use um loop, `line.strip()`, `int()` e acumule um total.", "feedback_mission2_hint": "Use um loop, operador `in` para checar string e incremente um contador.", "feedback_mission3_hint_try": "Precisa da estrutura `try...except FileNotFoundError`.", "feedback_mission3_hint_output_exists": "Verifique a saída quando o arquivo existe.", "feedback_mission3_hint_output_missing": "A saída deve ser exatamente 'Arquivo secreto não encontrado.' quando ausente.",
            "feedback_missions_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Excelente trabalho!", "feedback_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões avançadas. Continue assim!",
            "completion_title": "Prática Avançada do Módulo 23 Completa!", "completion_desc": "Fantástico! Você lidou com técnicas mais avançadas de leitura de arquivos, incluindo iteração e tratamento de erros. Persistência compensa!<br> Sinta-se à vontade para revisar a <span data-translate=\"completion_link_video\">Videoaula</span> ou voltar ao <span data-translate=\"completion_link_dashboard\">Menu do Curso</span>.",
            "completion_link_video": "Videoaula", "completion_link_dashboard": "Menu do Curso",
            "button_back_basic": "Voltar à Prática Básica", "button_watch_video": "Ver Videoaula", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 23：Python 高级练习！",
            "tooltip_click_identify": "点击识别此部分",
            "nav_basic_practice": "基础练习", "nav_video_lesson": "观看视频课程", "nav_menu": "课程菜单",
            "nav_anatomy_loop": "循环剖析", "nav_build_loop": "构建循环", "nav_error_sim": "错误模拟", "nav_concept_check": "概念", "nav_missions_advanced": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 23：高级练习", "header_subtitle": "让我们通过循环和错误处理来提升文件读取技能！",
            "anatomy_loop_title": "文件迭代剖析", "anatomy_loop_desc": "一种更符合 Python 风格的读取行的方法是直接迭代文件对象。让我们剖析这个高效的模式，包括去除空白。点击每个部分。",
            "anatomy_loop_status_initial": "识别所有 13 个部分！", "anatomy_loop_status_progress": "已识别 {count} / {total} 个部分。", "anatomy_loop_status_done": "所有部分已识别！",
            "anatomy_exp_with": "`with` 语句：确保文件自动关闭。",
            "anatomy_exp_open": "`open()` 函数：打开指定的文件。",
            "anatomy_exp_filename_loop": "文件名：文件的路径（例如 'logs.txt'）。",
            "anatomy_exp_mode_loop": "模式：`'r'` 用于读取。",
            "anatomy_exp_as": "`as`：分配文件对象。",
            "anatomy_exp_variable_loop": "文件变量 (`infile`)：代表打开的文件。",
            "anatomy_exp_for": "`for` 循环：迭代序列中的项目。",
            "anatomy_exp_loop_var": "循环变量 (`line`)：在每次迭代中保存当前项（行）。",
            "anatomy_exp_in": "`in`：`for` 循环中用于指定要迭代的序列的关键字。",
            "anatomy_exp_file_var_loop": "可迭代对象 (`infile`)：文件对象本身充当其行的可迭代对象。",
            "anatomy_exp_process": "处理 (`print(`)：对每一行执行的操作（此处为打印）。",
            "anatomy_exp_strip_call": "`line.strip()`：调用行字符串的 `strip()` 方法以删除前导/尾随空白（如换行符 `\\n`）。",
            "anatomy_exp_close_paren_print": "`)`：关闭 `print()` 函数调用。",
            "feedback_anatomy_correct": "太棒了！你已经掌握了文件迭代！",
            "build_loop_title": "构建文件循环", "build_loop_desc": "拖动碎片以构建一个 Python 循环，该循环打开 `config.cfg`，遍历每一 `line`，并打印<span class=\"highlight code-font\">去除</span>前后空白的行。",
            "build_loop_drop_placeholder": "将碎片拖放到此处以构建循环...",
            "build_piece_with": "with", "build_piece_open": "open(", "build_piece_filename_cfg": "'config.cfg'", "build_piece_mode": "'r'", "build_piece_close_paren": ")", "build_piece_as": "as", "build_piece_variable_f": "f", "build_piece_colon": ":", "build_piece_for": "for", "build_piece_loop_var": "line", "build_piece_in": "in", "build_piece_print_strip": "print(line.strip())", "build_piece_read": "data = f.read()",
            "button_check_build": "检查我的代码", "button_reset_build": "重置",
            "feedback_build_correct": "完美的循环结构！", "feedback_build_almost": "非常接近！检查顺序、缩进（概念上）或 `.strip()` 的使用。", "feedback_build_incorrect": "不太对。确保你有正确的 `with open`、`for line in` 和 `print(line.strip())` 部分。",
            "error_sim_title": "错误处理模拟器", "error_sim_desc": "如果文件不存在会发生什么？使用 `try...except FileNotFoundError` 来优雅地处理这种情况。编辑代码以安全地读取 `maybe.txt` 并打印其内容，或者如果它丢失则打印错误消息。使用按钮切换文件是否“存在”。",
            "button_toggle_file": "切换文件存在状态", "file_status_exists": "文件 'maybe.txt' <span style='color:var(--success-color)'>存在</span>", "file_status_missing": "文件 'maybe.txt' <span style='color:var(--error-color)'>缺失</span>",
            "simulator_editor_label": "代码编辑器：", "error_sim_placeholder": "try:\n    with open(\"maybe.txt\", \"r\") as f:\n        content = f.read()\n        print(\"文件内容：\")\n        print(content)\nexcept FileNotFoundError:\n    print(\"错误：文件未找到！\")",
            "button_run_sim": "运行模拟", "simulator_output_label": "模拟输出：", "simulator_output_placeholder": "输出将显示在此处...",
            "feedback_sim_success_exists": "模拟成功！文件读取正确。", "feedback_sim_success_missing": "模拟成功！错误处理正确。", "feedback_sim_empty": "编辑器是空的。", "feedback_sim_no_try": "缺少 `try` 块。", "feedback_sim_no_except": "缺少 `except FileNotFoundError:` 块。", "feedback_sim_wrong_exception": "检查异常类型 (`FileNotFoundError`)。", "feedback_sim_no_open_in_try": "`with open(...)` 应位于 `try` 块内。", "feedback_sim_output_mismatch_exists": "文件存在时，输出与预期内容不符。", "feedback_sim_output_mismatch_missing": "文件丢失时，输出中的错误消息不匹配。", "feedback_sim_syntax": "检查你的 Python 语法。",
            "concept_check_title": "概念检查", "concept_check_desc": "让我们检查一下你对一些关键文件处理概念的理解。选择最佳答案。",
            "question_text_placeholder": "问题文本？", "choice_text_placeholder": "选项文本",
            "concept_q1_text": "对于大文件，为什么通常首选使用 `for line in file_object:` 而不是 `file_object.readlines()` 进行迭代？",
            "concept_q1_c1": "对于小文件速度更快。", "concept_q1_c2": "它一次将整个文件读入内存。", "concept_q1_c3": "它逐行读取文件，节省内存。", "concept_q1_c4": "它自动关闭文件。",
            "concept_q2_text": "字符串方法 `.strip()` 在不带参数调用时通常会删除什么？",
            "concept_q2_c1": "仅空格。", "concept_q2_c2": "仅换行符 (`\\n`)。", "concept_q2_c3": "前导和尾随的空白（空格、制表符、换行符）。", "concept_q2_c4": "字符串内的所有空白。",
            "concept_q3_text": "当 `open()` 尝试读取不存在的文件时，会具体引发哪个错误？",
            "concept_q3_c1": "IOError", "concept_q3_c2": "ValueError", "concept_q3_c3": "FileNotFoundError", "concept_q3_c4": "SystemError",
            "concept_q4_text": "打开文本文件时为什么要指定 `encoding='utf-8'`？",
            "concept_q4_c1": "使文件只读。", "concept_q4_c2": "为了正确处理更广泛的字符（如重音符号或表情符号）。", "concept_q4_c3": "自动压缩文件。", "concept_q4_c4": "加快文件读取速度。",
            "button_check_selection": "检查答案", "button_try_again": "再试一次",
            "feedback_concepts_correct": "满分！你已经掌握了这些概念。 <i class=\"fas fa-brain\"></i>", "feedback_concepts_incorrect": "有些答案需要复习。检查每个问题的反馈。",
            "missions_advanced_title": "高级迷你任务！", "missions_advanced_desc": "是时候进行一些涉及迭代、处理和错误处理的更复杂的任务了。",
            "mission_virtual_file_label": "虚拟文件：", "mission_virtual_file_label_secret": "虚拟文件：<code>secret.txt</code> (有时存在！)",
            "mission_adv1_title": "任务 1：数字求和", "mission_adv1_desc": "逐行读取 <code>numbers.txt</code>。每行包含一个数字。将每行转换为整数（去除空白后！）并计算总和。仅打印最终总和。", "mission_adv1_placeholder": "total = 0\nwith open(\"numbers.txt\", \"r\") as f:\n    for line in f:\n        num = int(line.strip())\n        total += num\nprint(total)", "mission_adv1_content": "   10   \n25\n  -5\n 100 \n",
            "button_test_mission_1": "测试任务 1",
            "mission_adv2_title": "任务 2：统计特定行", "mission_adv2_desc": "逐行读取 <code>words.txt</code>。统计包含单词 \"AI\"（区分大小写）的行数。仅打印最终计数。", "mission_adv2_placeholder": "count = 0\nwith open(\"words.txt\", \"r\") as f:\n    for line in f:\n        if \"AI\" in line:\n            count += 1\nprint(count)", "mission_adv2_content": "学习 Python 很有趣。\nAI 正在改变行业。\n人工智能怎么样？\n更多 AI 示例。\nai 是不同的。", // zh
            "button_test_mission_2": "测试任务 2",
            "mission_adv3_title": "任务 3：安全读取", "mission_adv3_desc": "尝试打开并读取 <code>secret.txt</code> 的全部内容。如果文件存在，打印其内容。如果它<span class=\"highlight\">不存在</span>，打印确切的消息：<code class=\"code-error\">Secret file not found.</code> 使用 `try...except FileNotFoundError`。", "mission_adv3_placeholder": "try:\n    with open(\"secret.txt\", \"r\") as f:\n        # ... 读取并打印\nexcept FileNotFoundError:\n    # ... 打印错误消息", "secret_content": "秘密代码是 123！", "secret_exists_placeholder": "[文件存在时内容可见]", "button_toggle_secret": "切换存在状态",
            "button_test_mission_3": "测试任务 3",
            "feedback_mission_success": "任务完成！", "feedback_mission_syntax_error": "语法/逻辑错误。检查循环、转换、条件或 try/except。",
            "feedback_mission1_hint": "使用循环、`line.strip()`、`int()` 并累加总和。", "feedback_mission2_hint": "使用循环、`in` 运算符进行字符串检查，并增加计数器。", "feedback_mission3_hint_try": "需要 `try...except FileNotFoundError` 结构。", "feedback_mission3_hint_output_exists": "检查文件存在时的输出。", "feedback_mission3_hint_output_missing": "文件丢失时，输出必须是 'Secret file not found.'。",
            "feedback_missions_summary_all_done": "所有 {totalMissions} 个高级任务已完成！干得漂亮！", "feedback_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个高级任务。继续努力！",
            "completion_title": "模块 23 高级练习完成！", "completion_desc": "太棒了！你已经掌握了更高级的文件读取技术，包括迭代和错误处理。坚持就是胜利！<br> 随时查看<span data-translate=\"completion_link_video\">视频课程</span>或返回<span data-translate=\"completion_link_dashboard\">课程菜单</span>。",
            "completion_link_video": "视频课程", "completion_link_dashboard": "课程菜单",
            "button_back_basic": "返回基础练习", "button_watch_video": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };

    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Same as basic) ---
        function getStoredLanguage() { /* ... same code ... */ }
        function setLanguage(lang) { /* ... same code, calls updates below ... */ }
        function getTranslation(key, lang, replacements = {}) { /* ... same code ... */ }
        function translatePage(lang) { /* ... same code ... */ }

        // --- Re-initialize content that depends on language ---
        // (Called within setLanguage after translatePage)
        function updateLanguageDependentContent() {
            if (anatomyLoopSection) setupAnatomyLoopActivity();
            if (buildLoopSection) setupBuildLoopListeners();
            if (errorHandlingSimSection) {
                updateErrorSimFileStatus(); // Update text based on toggle state AND lang
                resetErrorSimOutput(); // Reset output/feedback
            }
            if (conceptCheckSection) setupConceptCheckActivity(); // Rebuild questions
            if (missionsAdvancedSection) {
                updateMissionAdvancedVirtualContent();
                updateMissionAdvancedSummary(); // Update summary text
            }
        }
        // Redefine setLanguage to include the call
         function setLanguage(lang) { // Overwrite previous definition briefly
            if (!translations[lang]) lang = 'en';
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang); // Translate static elements first
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;
            updateLanguageDependentContent(); // Update dynamic/interactive elements
        }

        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Same as basic) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) { /* ... same event listeners ... */ }

        // --- Language Switcher Setup (Same as basic) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) langSelect.addEventListener('change', (e) => setLanguage(e.target.value));

        // --- Helper Function for Feedback (Same as basic) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) { /* ... same code ... */ }


        // --- Activity 1: Anatomy of File Iteration ---
        const anatomyLoopSection = document.getElementById('anatomy-loop');
        let partLoopExplanations = {};
        const totalAnatomyLoopParts = 13; // UPDATE count based on HTML parts
        let currentAnatomyLoopListeners = [];

        function setupAnatomyLoopActivity() {
            if (!anatomyLoopSection) return;
            const currentLang = getStoredLanguage();
            partLoopExplanations = {};
            document.querySelectorAll('#explanation-texts-loop span[data-key]').forEach(span => {
                const key = span.getAttribute('data-key');
                partLoopExplanations[key] = getTranslation(`anatomy_exp_${key}`, currentLang); // Get specific loop explanations
            });

            const codeBlock = document.getElementById('anatomy-loop-code');
            const parts = codeBlock.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('anatomy-loop-explanations');
            const statusP = document.getElementById('anatomy-loop-status');
            const feedbackDiv = document.getElementById('anatomy-loop-feedback');
            let identifiedCount = 0;

            currentAnatomyLoopListeners.forEach(({ element, listener }) => element.removeEventListener('click', listener));
            currentAnatomyLoopListeners = [];
            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.textContent = getTranslation('anatomy_loop_status_initial', currentLang, { total: totalAnatomyLoopParts });
            feedbackDiv.classList.remove('visible');

            parts.forEach(part => {
                const clickListener = () => {
                    const partType = part.dataset.part;
                    if (!part.classList.contains('identified') && partType && partLoopExplanations[partType]) {
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        p.innerHTML = `<i class="fas fa-check-circle" style="color:var(--success-color)"></i> <strong>${part.textContent.trim()}:</strong> ${partLoopExplanations[partType]}`;
                        explanationsDiv.appendChild(p);
                        statusP.textContent = getTranslation('anatomy_loop_status_progress', currentLang, { count: identifiedCount, total: totalAnatomyLoopParts });
                        if (identifiedCount === totalAnatomyLoopParts) {
                            statusP.textContent = getTranslation('anatomy_loop_status_done', currentLang);
                            showFeedback('anatomy-loop-feedback', 'feedback_anatomy_correct', 'correct');
                        }
                    } else if (!partLoopExplanations[partType]) { console.warn(`AnatomyLoop: Explanation missing/part identified: ${partType}`); }
                };
                part.addEventListener('click', clickListener);
                currentAnatomyLoopListeners.push({ element: part, listener: clickListener });
            });
        }


        // --- Activity 2: Build-a-File-Loop ---
        const buildLoopSection = document.getElementById('build-loop');
        let dropZoneLoop;

        if (buildLoopSection) {
            const piecesContainer = document.getElementById('draggable-pieces-loop');
            dropZoneLoop = document.getElementById('drop-zone-loop');
            const checkBtn = document.getElementById('check-build-loop-btn');
            const resetBtn = document.getElementById('reset-build-loop-btn');
            const feedbackDiv = document.getElementById('build-loop-feedback');

            const initialPiecesData = [
                 { key: 'build_piece_with', canonicalValue: 'with', type: 'keyword' },
                 { key: 'build_piece_open', canonicalValue: 'open(', type: 'function' },
                 { key: 'build_piece_filename_cfg', canonicalValue: "'config.cfg'", type: 'string' },
                 { key: 'build_piece_mode', canonicalValue: "'r'", type: 'string' },
                 { key: 'build_piece_close_paren', canonicalValue: ')', type: 'operator' },
                 { key: 'build_piece_as', canonicalValue: 'as', type: 'keyword' },
                 { key: 'build_piece_variable_f', canonicalValue: 'f', type: 'variable' },
                 { key: 'build_piece_colon', canonicalValue: ':', type: 'operator' },
                 { key: 'build_piece_for', canonicalValue: 'for', type: 'keyword' },
                 { key: 'build_piece_loop_var', canonicalValue: 'line', type: 'variable' },
                 { key: 'build_piece_in', canonicalValue: 'in', type: 'keyword' },
                 // Combine print and strip into one conceptual piece for simplicity
                 { key: 'build_piece_print_strip', canonicalValue: 'print(line.strip())', type: 'method' },
                 { key: 'build_piece_read', canonicalValue: 'data = f.read()', type: 'assignment' } // Wrong piece
             ];

            let draggedElement = null; let touchDragElement = null; let originalPiece = null; let startX, startY, offsetX, offsetY;

            function createPieceElement(pieceData, currentLang) { /* ... Same as basic, but uses correct data keys ... */ }
            function populatePieces() { /* ... Same as basic ... */ }
            function setupBuildLoopListeners() { /* ... Same as basic, uses loop IDs ... */ }
            function addDragListeners(element) { /* ... Same as basic, uses loop IDs ... */ }
            function handleTouchStart(e) { /* ... Same as basic, uses loop IDs ... */ }
            function handleTouchMove(e) { /* ... Same as basic, uses loop IDs ... */ }
            function handleTouchEnd(e) { /* ... Same as basic, uses loop IDs ... */ }
            function addTouchListeners(element) { /* ... Same as basic ... */ }
            dropZoneLoop.addEventListener('dragover', (e) => { e.preventDefault(); dropZoneLoop.classList.add('over'); });
            dropZoneLoop.addEventListener('dragleave', () => { dropZoneLoop.classList.remove('over'); });
            dropZoneLoop.addEventListener('drop', (e) => { /* ... Same as basic, uses loop IDs ... */ });

            // --- Build Loop Check Logic ---
             checkBtn.addEventListener('click', () => {
                 const droppedPieces = Array.from(dropZoneLoop.querySelectorAll('.piece'));
                 // Target: with open('config.cfg', 'r') as f: for line in f: print(line.strip())
                 const sequence = droppedPieces.map(p => p.dataset.value).join(' ');
                 const correctSequence = "with open( 'config.cfg' 'r' ) as f : for line in f : print(line.strip())"; // Canonical values

                 if (sequence === correctSequence) {
                     showFeedback('build-loop-feedback', 'feedback_build_correct', 'correct');
                     checkBtn.classList.add('success'); checkBtn.disabled = true;
                 } else if (sequence.includes('with') && sequence.includes('open(') && sequence.includes('for') && sequence.includes('in') && sequence.includes('.strip()')) {
                     showFeedback('build-loop-feedback', 'feedback_build_almost', 'incorrect');
                     checkBtn.classList.remove('success');
                 } else {
                     showFeedback('build-loop-feedback', 'feedback_build_incorrect', 'incorrect');
                     checkBtn.classList.remove('success');
                 }
             });
             resetBtn.addEventListener('click', setupBuildLoopListeners);

             // --- Replicate createPieceElement and populatePieces for Build Loop ---
             function createPieceElement(pieceData, currentLang) {
                 const piece = document.createElement('span');
                 piece.classList.add('piece', 'code-font'); piece.draggable = true;
                 const displayText = getTranslation(pieceData.key, currentLang);
                 piece.textContent = displayText;
                 piece.dataset.value = pieceData.canonicalValue;
                 piece.dataset.type = pieceData.type;
                 piece.dataset.transKey = pieceData.key;
                 addDragListeners(piece); addTouchListeners(piece);
                 return piece;
              }
             function populatePieces() {
                 const currentLang = getStoredLanguage();
                 piecesContainer.innerHTML = '';
                 const shuffledPieces = [...initialPiecesData].sort(() => Math.random() - 0.5);
                 shuffledPieces.forEach(pData => {
                     piecesContainer.appendChild(createPieceElement(pData, currentLang));
                 });
              }
             function setupBuildLoopListeners() {
                 populatePieces();
                 dropZoneLoop.innerHTML = '';
                 const placeholder = document.createElement('span');
                 placeholder.id = 'drop-zone-placeholder-loop';
                 placeholder.dataset.translate = 'build_loop_drop_placeholder';
                 placeholder.textContent = getTranslation('build_loop_drop_placeholder', getStoredLanguage());
                 dropZoneLoop.appendChild(placeholder);
                 feedbackDiv.classList.remove('visible');
                 checkBtn.classList.remove('success'); checkBtn.disabled = false;
                 dropZoneLoop.classList.remove('over');
              }
        }


        // --- Activity 3: Error Handling Simulator ---
        const errorHandlingSimSection = document.getElementById('error-handling-sim');
        let virtualFileExists = true; // Initial state
        let virtualFileContentOnErrorSim = "";

        function updateErrorSimFileStatus() {
            const indicator = document.getElementById('file-status-indicator');
            const toggleBtn = document.getElementById('toggle-file-exists-btn');
            const currentLang = getStoredLanguage();
            if (indicator) {
                indicator.innerHTML = getTranslation(virtualFileExists ? 'file_status_exists' : 'file_status_missing', currentLang);
            }
            if (toggleBtn) {
                toggleBtn.classList.toggle('warning', !virtualFileExists); // Use warning style when missing
                toggleBtn.classList.toggle('secondary', virtualFileExists);
            }
             // Update virtual content cache (needed for simulation check)
             virtualFileContentOnErrorSim = getTranslation('error-sim-virtual-content', currentLang); // Fetch content for potential use
        }

         function resetErrorSimOutput() {
             const outputArea = document.getElementById('sim-error-output');
             const feedbackDiv = document.getElementById('sim-error-feedback');
             const placeholder = outputArea?.querySelector('.placeholder') || document.createElement('span');
             if (outputArea) {
                 outputArea.innerHTML = '';
                 placeholder.className = 'placeholder';
                 placeholder.dataset.translate = 'simulator_output_placeholder';
                 placeholder.textContent = getTranslation('simulator_output_placeholder', getStoredLanguage());
                 outputArea.appendChild(placeholder);
             }
             if (feedbackDiv) feedbackDiv.classList.remove('visible');
         }


        if (errorHandlingSimSection) {
            const editor = document.getElementById('sim-error-editor-input');
            const outputArea = document.getElementById('sim-error-output');
            const runBtn = document.getElementById('run-sim-error-btn');
            const feedbackDiv = document.getElementById('sim-error-feedback');
            const toggleBtn = document.getElementById('toggle-file-exists-btn');

            toggleBtn.addEventListener('click', () => {
                virtualFileExists = !virtualFileExists;
                updateErrorSimFileStatus();
                resetErrorSimOutput(); // Clear output when toggling
            });

            runBtn.addEventListener('click', () => {
                const code = editor.value.trim();
                const currentLang = getStoredLanguage();
                let placeholder = outputArea.querySelector('.placeholder');
                 outputArea.innerHTML = ''; // Clear output
                 if (!placeholder) {
                     placeholder = document.createElement('span'); placeholder.className = 'placeholder';
                     placeholder.dataset.translate = 'simulator_output_placeholder';
                 }
                 placeholder.textContent = getTranslation('simulator_output_placeholder', currentLang);
                 feedbackDiv.classList.remove('visible');

                 // Basic Syntax Checks
                 const hasTry = code.includes('try:');
                 const hasExcept = /except\s+FileNotFoundError\s*:/.test(code); // More specific check
                 const openInTry = /try\s*:[\s\S]*with\s+open\(/.test(code); // Check if open is nested under try

                 let simulationOutput = "";
                 let success = false;
                 let feedbackKey = 'feedback_sim_syntax'; // Default feedback

                 if (code === '') { feedbackKey = 'feedback_sim_empty'; feedbackType = 'info'; }
                 else if (!hasTry) { feedbackKey = 'feedback_sim_no_try'; feedbackType = 'incorrect'; }
                 else if (!hasExcept) { feedbackKey = 'feedback_sim_no_except'; feedbackType = 'incorrect'; }
                 else if (!openInTry) { feedbackKey = 'feedback_sim_no_open_in_try'; feedbackType = 'incorrect'; }
                 else {
                     // Simulate execution
                     if (virtualFileExists) {
                         // Expect file content to be printed (approximate check)
                         if (code.includes('print(content') || code.includes('print( f.read()')) { // Basic check
                             simulationOutput = `File Content:\n${virtualFileContentOnErrorSim}`; // Simulate output
                             success = true;
                             feedbackKey = 'feedback_sim_success_exists';
                             feedbackType = 'correct';
                         } else {
                             feedbackKey = 'feedback_sim_output_mismatch_exists';
                             feedbackType = 'incorrect';
                         }
                     } else {
                         // Expect specific error message
                         const expectedErrorMsg = "Error: File not found!"; // Keep this consistent for checking
                          // Check if the except block likely prints the correct message
                          if (/except\s+FileNotFoundError\s*:[\s\S]*print\(\s*["']Error: File not found!["']\s*\)/.test(code)) {
                             simulationOutput = expectedErrorMsg;
                             success = true;
                             feedbackKey = 'feedback_sim_success_missing';
                             feedbackType = 'correct';
                         } else {
                             feedbackKey = 'feedback_sim_output_mismatch_missing';
                             feedbackType = 'incorrect';
                         }
                     }
                 }

                 if (simulationOutput) {
                    const lines = simulationOutput.split('\n');
                    lines.forEach(line => {
                        const lineSpan = document.createElement('span');
                         lineSpan.textContent = `> ${line}`;
                         lineSpan.classList.add(line === "Error: File not found!" ? 'error-line' : 'output-line');
                        outputArea.appendChild(lineSpan);
                     });
                 } else {
                     outputArea.appendChild(placeholder);
                 }
                 showFeedback('sim-error-feedback', feedbackKey, feedbackType);
            });

            updateErrorSimFileStatus(); // Initial setup
            updateErrorSimFileStatus(); // Call again to cache virtual content correctly
        }


        // --- Activity 4: Concept Check ---
        const conceptCheckSection = document.getElementById('concept-check');
        if (conceptCheckSection) {
            const questionsContainer = document.getElementById('concept-questions');
            const questionTemplate = document.getElementById('question-template');
            const choiceTemplate = document.getElementById('choice-template');
            const checkBtn = document.getElementById('check-concepts-btn');
            const resetBtn = document.getElementById('reset-concepts-btn');
            const feedbackDiv = document.getElementById('concepts-feedback');
            let currentConceptListeners = []; // To manage listeners

            const conceptQuestionsData = [
                { id: 1, key: 'concept_q1_text', choices: ['concept_q1_c1','concept_q1_c2','concept_q1_c3','concept_q1_c4'], correct: 'concept_q1_c3' },
                { id: 2, key: 'concept_q2_text', choices: ['concept_q2_c1','concept_q2_c2','concept_q2_c3','concept_q2_c4'], correct: 'concept_q2_c3' },
                { id: 3, key: 'concept_q3_text', choices: ['concept_q3_c1','concept_q3_c2','concept_q3_c3','concept_q3_c4'], correct: 'concept_q3_c3' },
                { id: 4, key: 'concept_q4_text', choices: ['concept_q4_c1','concept_q4_c2','concept_q4_c3','concept_q4_c4'], correct: 'concept_q4_c2' }
            ];

            function createChoiceElement(qData, choiceKey, currentLang) {
                const clone = choiceTemplate.cloneNode(true);
                clone.classList.remove('hidden');
                clone.dataset.choiceValue = choiceKey; // Store the key as the value
                clone.querySelector('.choice-text').textContent = getTranslation(choiceKey, currentLang);
                // Link input and label if needed, though click on parent handles it
                return clone;
            }

            function createQuestionElement(qData, currentLang) {
                const clone = questionTemplate.cloneNode(true);
                clone.id = `question-${qData.id}`;
                clone.classList.remove('hidden');
                clone.querySelector('[data-translate="question_text_placeholder"]').textContent = getTranslation(qData.key, currentLang);
                const choicesDiv = clone.querySelector('.choices');
                choicesDiv.dataset.questionId = qData.id;
                choicesDiv.dataset.correctAnswer = qData.correct; // Store correct answer key

                qData.choices.forEach(choiceKey => {
                    choicesDiv.appendChild(createChoiceElement(qData, choiceKey, currentLang));
                });

                // Add listeners to choices within this question
                const choiceItems = choicesDiv.querySelectorAll('.choice-item');
                choiceItems.forEach(item => {
                    const choiceListener = () => {
                         if (item.classList.contains('checked-state')) return;
                         // Deselect siblings
                         choiceItems.forEach(sibling => sibling.classList.remove('selected-visual'));
                         // Select current
                         item.classList.add('selected-visual');
                     };
                     item.addEventListener('click', choiceListener);
                     currentConceptListeners.push({ element: item, listener: choiceListener }); // Track listener
                 });
                return clone;
            }

            function setupConceptCheckActivity() {
                const currentLang = getStoredLanguage();
                // Cleanup previous state
                currentConceptListeners.forEach(({ element, listener }) => element.removeEventListener('click', listener));
                currentConceptListeners = [];
                questionsContainer.innerHTML = ''; // Clear old questions

                conceptQuestionsData.forEach(qData => {
                    questionsContainer.appendChild(createQuestionElement(qData, currentLang));
                });
                feedbackDiv.classList.remove('visible');
                resetBtn.classList.add('hidden');
                checkBtn.disabled = false;
                checkBtn.classList.remove('success');
            }

            checkBtn.addEventListener('click', () => {
                let allCorrect = true;
                questionsContainer.querySelectorAll('.question-block').forEach(qBlock => {
                    const choicesDiv = qBlock.querySelector('.choices');
                    const questionId = choicesDiv.dataset.questionId;
                    const correctAnswerKey = choicesDiv.dataset.correctAnswer;
                    const selectedItem = qBlock.querySelector('.choice-item.selected-visual');
                    const selectedAnswerKey = selectedItem?.dataset.choiceValue;

                    qBlock.querySelectorAll('.choice-item').forEach(item => {
                         item.classList.add('checked-state'); // Mark as checked
                         const iconPlaceholder = item.querySelector('.feedback-icon-placeholder');
                         iconPlaceholder.innerHTML = ''; // Clear old icon
                         iconPlaceholder.classList.remove('visible');

                         if (item.dataset.choiceValue === correctAnswerKey) {
                             // Mark correct answer visually, even if not selected (optional)
                             // item.style.borderColor = 'var(--success-color)';
                         }

                         if (item.classList.contains('selected-visual')) {
                             const icon = document.createElement('i');
                             if (selectedAnswerKey === correctAnswerKey) {
                                 icon.className = 'fas fa-check';
                             } else {
                                 icon.className = 'fas fa-times';
                                 allCorrect = false; // Mark overall as incorrect
                             }
                             iconPlaceholder.appendChild(icon);
                             iconPlaceholder.classList.add('visible');
                         }
                    });
                     if (!selectedItem) allCorrect = false; // Mark incorrect if nothing selected for a question
                 });

                 if (allCorrect) {
                     showFeedback('concepts-feedback', 'feedback_concepts_correct', 'correct');
                     checkBtn.classList.add('success');
                     checkBtn.disabled = true;
                     resetBtn.classList.add('hidden');
                 } else {
                     showFeedback('concepts-feedback', 'feedback_concepts_incorrect', 'incorrect');
                     checkBtn.classList.remove('success');
                     checkBtn.disabled = true;
                     resetBtn.classList.remove('hidden');
                 }
            });

            resetBtn.addEventListener('click', setupConceptCheckActivity);
        }


        // --- Activity 5: Mini Missions (Advanced File I/O) ---
        const missionsAdvancedSection = document.getElementById('missions-advanced');
        let missionAdvancedVirtualContents = {}; // { 'mission-adv-1': "...", ... }
        let mission3SecretFileExists = true; // State for mission 3 file
        let updateMissionAdvancedSummary; // Allow access globally

        function updateMissionAdvancedVirtualContent() {
             const currentLang = getStoredLanguage();
             missionAdvancedVirtualContents = {
                'mission-adv-1': getTranslation('mission_adv1_content', currentLang),
                'mission-adv-2': getTranslation('mission_adv2_content', currentLang),
                'mission-adv-3': getTranslation('secret_content', currentLang) // Use the secret content translation
             };
             for (const id in missionAdvancedVirtualContents) {
                 // Only update content for mission 1 and 2 directly
                 if (id !== 'mission-adv-3') {
                    const el = document.getElementById(`${id}-virtual-content`);
                    if (el) el.textContent = missionAdvancedVirtualContents[id];
                 }
             }
              // Update Mission 3 display based on its state
              updateMission3SecretDisplay();

               // Reset outputs and feedback on language change
               document.querySelectorAll('#missions-advanced .mission-output').forEach(out => out.innerHTML = '');
               document.querySelectorAll('#missions-advanced .mission-feedback').forEach(fb => fb.classList.remove('visible'));
        }

        function updateMission3SecretDisplay() {
             const contentPre = document.getElementById('mission-adv-3-virtual-content');
             const currentLang = getStoredLanguage();
             if (contentPre) {
                if (mission3SecretFileExists) {
                    contentPre.textContent = missionAdvancedVirtualContents['mission-adv-3'];
                    contentPre.style.opacity = '1';
                } else {
                    contentPre.textContent = getTranslation('secret_exists_placeholder', currentLang);
                    contentPre.style.opacity = '0.5';
                }
             }
        }


        if (missionsAdvancedSection) {
            const missionRunButtons = missionsAdvancedSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('missions-advanced-summary-feedback');
            const totalMissions = missionsAdvancedSection.querySelectorAll('.mission').length;
            const toggleSecretBtn = document.getElementById('toggle-secret-file-btn');

            if(toggleSecretBtn) {
                toggleSecretBtn.addEventListener('click', () => {
                    mission3SecretFileExists = !mission3SecretFileExists;
                    updateMission3SecretDisplay();
                    // Optional: reset mission 3 output/feedback if toggled
                     document.getElementById('mission-adv-3').querySelector('.mission-output').innerHTML = '';
                     document.getElementById('mission-adv-feedback-3').classList.remove('visible');
                });
            }

            updateMissionAdvancedSummary = function() {
                 const completedMissionsCount = missionsAdvancedSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('missions-advanced-summary-feedback', 'feedback_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('missions-advanced-summary-feedback', 'feedback_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible');
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId; // String '1', '2', '3'
                    const missionDiv = document.getElementById(`mission-adv-${missionId}`);
                    if (!missionDiv) return;
                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-adv-feedback-${missionId}`;
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();
                    outputArea.innerHTML = '';
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error';
                    let specificHintKey = '';
                    let simulationOutput = '';

                    // Simplified Validation Logic for Advanced Missions
                    try {
                        const virtualContent = missionAdvancedVirtualContents[`mission-adv-${missionId}`] || "";
                        const lines = virtualContent.split('\n');

                        if (missionId === '1') { // Summing numbers
                             const expectedSum = lines.reduce((sum, line) => {
                                 try { return sum + parseInt(line.trim()); } catch { return sum; }
                             }, 0);
                             // Check if code likely calculates and prints the sum
                             if (code.includes('for line in') && code.includes('.strip()') && code.includes('int(') && code.includes('+=')) {
                                 // Basic check: If the *last* print likely prints the sum
                                 const lastPrintMatch = code.match(/print\(([^)]+)\)\s*$/);
                                  if (lastPrintMatch) { // Check if last print exists
                                     simulationOutput = String(expectedSum); // Simulate output
                                     success = true;
                                 } else specificHintKey = 'feedback_mission1_hint';
                             } else { specificHintKey = 'feedback_mission1_hint'; }
                        } else if (missionId === '2') { // Count lines with "AI"
                             const expectedCount = lines.filter(line => line.includes("AI")).length;
                              if (code.includes('for line in') && code.includes('if "AI" in') && code.includes('+=')) {
                                 const lastPrintMatch = code.match(/print\(([^)]+)\)\s*$/);
                                  if (lastPrintMatch) {
                                     simulationOutput = String(expectedCount);
                                     success = true;
                                 } else specificHintKey = 'feedback_mission2_hint';
                             } else { specificHintKey = 'feedback_mission2_hint'; }
                        } else if (missionId === '3') { // Safe read
                             const hasTry = code.includes('try:');
                             const hasExcept = /except\s+FileNotFoundError\s*:/.test(code);
                             const expectedErrorMsg = "Secret file not found.";
                             const printsCorrectError = /except\s+FileNotFoundError\s*:[\s\S]*print\(\s*["']Secret file not found.["']\s*\)/.test(code);
                             const readsAndPrintsInTry = /try\s*:[\s\S]*with open\(["']secret\.txt["'],\s*["']r["']\)[\s\S]*print\(/.test(code);

                             if (!hasTry || !hasExcept) { specificHintKey = 'feedback_mission3_hint_try'; }
                             else if (mission3SecretFileExists) {
                                 if (readsAndPrintsInTry) {
                                     simulationOutput = virtualContent; success = true;
                                 } else { specificHintKey = 'feedback_mission3_hint_output_exists'; }
                             } else { // File doesn't exist
                                 if (printsCorrectError) {
                                     simulationOutput = expectedErrorMsg; success = true;
                                 } else { specificHintKey = 'feedback_mission3_hint_output_missing'; }
                             }
                        }
                    } catch (error) { console.error("Mission validation error:", error); simulationOutput="Error during simulation." }

                    // Display output
                    if (simulationOutput) {
                         const lineSpan = document.createElement('span');
                         lineSpan.textContent = `> ${simulationOutput}`;
                         if (simulationOutput === "Secret file not found.") {
                             lineSpan.classList.add('error-line');
                         } else {
                             lineSpan.classList.add('output-line');
                         }
                         outputArea.appendChild(lineSpan);
                    }

                    // Set feedback and status
                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                        showFeedback(feedbackDivId, feedbackMessageKey, 'correct');
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey;
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                        showFeedback(feedbackDivId, feedbackMessageKey, 'incorrect');
                    }
                    updateMissionAdvancedSummary();
                });
            });
            // Initial setup calls
            updateMissionAdvancedVirtualContent();
            updateMissionAdvancedSummary();
        }


        // --- Fade-in animations on scroll (Same as basic) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => { /* ... same code ... */ };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST and trigger dynamic updates
        animateOnScroll();      // Trigger initial animation check

    }); // End DOMContentLoaded
    </script>

</body>
</html>