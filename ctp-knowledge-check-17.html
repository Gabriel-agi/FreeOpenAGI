<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 17 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard for Consistency) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Purple for checks */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header & Return Button --- */
        .kc-header {
            background: linear-gradient(135deg, #0d6efd, #0a58ca);
            padding: 1rem 1.5rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .return-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
        }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        .return-button i {
            margin-right: 8px;
        }

        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem;
            text-align: right;
            flex-grow: 1;
            margin: 0;
             margin-right: 1rem; /* Add some space if return button is present */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }


        /* --- Knowledge Check Container --- */
        .knowledge-check-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem 2.5rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Takes remaining vertical space */
        }

        .kc-intro {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .kc-intro h2 {
             font-family: var(--font-title);
             font-size: 1.4rem;
             color: var(--primary-color);
             margin-bottom: 0.5rem;
             display: flex;
             align-items: center;
        }
         .kc-intro h2 i {
             margin-right: 10px;
             color: var(--check-color);
         }
        .kc-intro p {
            font-size: 0.95rem;
            color: var(--text-muted);
            line-height: 1.5;
        }
        .kc-intro strong { color: var(--text-dark); }
        .kc-intro .pass-score { color: var(--success-color); font-weight: bold; }
        .kc-intro .attempts { color: var(--info-color); font-weight: bold; }


        /* --- Quiz Form Styling --- */
        #kc-form {
            margin-bottom: 2rem;
        }

        .kc-question {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fdfdfd;
            transition: background-color 0.3s ease;
        }
        .kc-question.correct { background-color: #e6f9e6; border-left: 5px solid var(--success-color); }
        .kc-question.incorrect { background-color: #fde6e6; border-left: 5px solid var(--error-color); }


        .kc-question-text {
            font-weight: 500;
            margin-bottom: 1.2rem;
            font-size: 1.05rem;
            line-height: 1.4;
        }
        .kc-question-text code {
            font-size: 0.95em;
            background-color: #e9ecef;
            padding: 2px 5px;
            border-radius: 4px;
            color: #c7254e; /* Bootstrap code color */
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        .kc-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .kc-option {
            display: flex;
            align-items: center;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--background-card);
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }
         .kc-option:has(input:checked) {
            border-color: var(--primary-color);
            background-color: #e7f1ff;
        }
        .kc-option:hover {
             background-color: #f8f9fa;
        }

        .kc-option input[type="radio"] {
            margin-right: 10px;
             width: 18px; /* Custom radio button size */
             height: 18px;
             accent-color: var(--primary-color); /* Modern browser styling */
             cursor: pointer;
        }

        .kc-option label {
            flex-grow: 1;
            cursor: pointer;
            font-size: 0.95rem;
            line-height: 1.4;
        }
         .kc-option label code {
             font-size: 0.9em;
             background-color: #eee;
             padding: 1px 4px;
             border-radius: 3px;
             color: #c7254e;
         }
        /* Highlight correct/incorrect answers after submission */
         .kc-option.correct-answer { background-color: #d1f1d1; border-color: var(--success-color); }
         .kc-option.incorrect-answer { background-color: #f1d1d1; border-color: var(--error-color); text-decoration: line-through; }


        /* --- Submit Button --- */
        #kc-submit-button {
            display: block;
            width: 100%;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: var(--font-title);
            color: var(--text-light);
            background-color: var(--check-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
             margin-top: 1.5rem;
        }
        #kc-submit-button:hover {
            background-color: #5a35a1; /* Darker purple */
            transform: translateY(-2px);
        }
         #kc-submit-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
             transform: none;
        }

        /* --- Results Area --- */
        #kc-result {
            margin-top: 2.5rem;
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden by default */
        }
        #kc-result.pass { background-color: #e6f4ea; border: 1px solid var(--success-color); }
        #kc-result.fail { background-color: #f8d7da; border: 1px solid var(--error-color); }

        #kc-result-message {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        #kc-result.pass #kc-result-message { color: var(--success-color); }
        #kc-result.fail #kc-result-message { color: var(--error-color); }

        #kc-score {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        #kc-try-again-button {
            display: inline-block;
            padding: 0.6rem 1.2rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-light);
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        #kc-try-again-button:hover {
            background-color: #5a6268;
        }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1rem;
            margin-top: 2rem; /* Pushes footer down */
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .knowledge-check-container { margin: 1.5rem; padding: 1.5rem; }
             .kc-header h1 { font-size: 1.4rem; }
             .return-button { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .knowledge-check-container { margin: 1rem; padding: 1rem 1.2rem; }
            .kc-header { padding: 0.8rem 1rem; }
            .kc-header h1 { font-size: 1.2rem; }
            .kc-question { padding: 1rem; }
             .kc-option { padding: 0.5rem 0.8rem; }
             #kc-submit-button { padding: 0.7rem 1rem; font-size: 1rem; }
             #kc-result { padding: 1rem 1.5rem; }
             #kc-result-message { font-size: 1.1rem; }
             #kc-score { font-size: 1rem; }
        }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-button">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
        </a>
        <h1 data-translate="header_title">Module 17 Check</h1>
    </header>

    <div class="knowledge-check-container">
        <div class="kc-intro">
            <h2 data-translate="intro_title"><i class="fas fa-check-double"></i> Knowledge Check: Function Parameters</h2>
            <p data-translate="intro_desc">Test your understanding of defining functions with parameters and passing arguments. You need to answer <strong data-translate="pass_score" class="pass-score">6 out of 10</strong> questions correctly to pass.</p>
            <p data-translate="intro_attempts">You can <strong data-translate="attempts" class="attempts">try as many times as you need</strong>.</p>
        </div>

        <form id="kc-form">
            <!-- Questions will be loaded here by JavaScript -->
        </form>

        <button type="submit" id="kc-submit-button" form="kc-form" data-translate="submit_button">Submit Answers</button>

        <div id="kc-result">
            <p id="kc-result-message"></p>
            <p id="kc-score"></p>
            <button id="kc-try-again-button" data-translate="try_again_button">Try Again</button>
        </div>
    </div>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Translations Object ---
        const translations = {
            en: {
                page_title: "Knowledge Check: Module 17 - Complete Python",
                return_button: "Return to Dashboard",
                header_title: "Module 17 Check",
                intro_title: "Knowledge Check: Function Parameters",
                intro_desc: "Test your understanding of defining functions with parameters and passing arguments. You need to answer <strong data-translate=\"pass_score\" class=\"pass-score\">6 out of 10</strong> questions correctly to pass.",
                intro_attempts: "You can <strong data-translate=\"attempts\" class=\"attempts\">try as many times as you need</strong>.",
                pass_score: "6 out of 10",
                attempts: "try as many times as you need",
                submit_button: "Submit Answers",
                result_pass: "Congratulations! You Passed!",
                result_fail: "Keep Trying! You can do it.",
                result_score: "Your score: {score} out of {total}",
                try_again_button: "Try Again",
                footer_text: "Part of the Road to Free Open AGI Project",
                // Questions & Answers (Module 17)
                q1_text: "How do you define a function named `greet` that accepts one parameter called `name`?",
                q1_a: "<code>define greet(name):</code>",
                q1_b: "<code>function greet(name):</code>",
                q1_c: "<code>def greet(name):</code>",
                q1_d: "<code>def greet name:</code>",
                q2_text: "If you have a function `def add(x, y):`, how do you correctly call it to add 5 and 3?",
                q2_a: "<code>add(x=5, 3)</code>",
                q2_b: "<code>add(5, 3)</code>",
                q2_c: "<code>add(5 + 3)</code>",
                q2_d: "<code>call add(5, 3)</code>",
                q3_text: "In the context of functions, what is the difference between a 'parameter' and an 'argument'?",
                q3_a: "They are exactly the same thing.",
                q3_b: "A parameter is the variable listed inside the parentheses in the function definition; an argument is the value sent to the function when it is called.",
                q3_c: "An argument is the variable in the function definition; a parameter is the value passed when calling.",
                q3_d: "Parameters are used for numbers, arguments are used for strings.",
                q4_text: "Consider the function `def describe_pet(animal_type, pet_name):`. If you call it like `describe_pet('Fluffy', 'hamster')`, what will be the value of `animal_type` inside the function?",
                q4_a: "'hamster'",
                q4_b: "'Fluffy'",
                q4_c: "It will cause an error because the order is wrong.",
                q4_d: "<code>None</code>",
                q5_text: "Using the same `describe_pet` function, which of these calls uses keyword arguments correctly?",
                q5_a: "<code>describe_pet(pet_name='Whiskers', animal_type='cat')</code>",
                q5_b: "<code>describe_pet('cat', pet_name='Whiskers')</code>",
                q5_c: "<code>describe_pet(animal='cat', name='Whiskers')</code>",
                q5_d: "Both A and B are correct.",
                q6_text: "What is the primary benefit of using default parameter values, like `def power(base, exponent=2):`?",
                q6_a: "It makes the function run faster.",
                q6_b: "It forces the user to always provide all arguments.",
                q6_c: "It allows you to call the function with fewer arguments, using the default if an argument isn't provided.",
                q6_d: "It prevents errors when calling the function.",
                q7_text: "If you have `def greet(name, message='Hello')`, which call is valid and uses the default value for `message`?",
                q7_a: "<code>greet()</code>",
                q7_b: "<code>greet('Alice')</code>",
                q7_c: "<code>greet(name='Bob', 'Hi')</code>",
                q7_d: "<code>greet(message='Hi')</code>",
                q8_text: "When calling a function like `def info(name, age, city='Unknown'):`, can you mix positional and keyword arguments?",
                q8_a: "No, you must use either all positional or all keyword arguments.",
                q8_b: "Yes, but all positional arguments must come before any keyword arguments.",
                q8_c: "Yes, but all keyword arguments must come before any positional arguments.",
                q8_d: "Yes, you can mix them in any order.",
                q9_text: "Passing data into a function using parameters hides the internal details of how the function works. Which Computational Thinking concept does this relate most closely to?",
                q9_a: "Decomposition",
                q9_b: "Pattern Recognition",
                q9_c: "Abstraction",
                q9_d: "Algorithm Design",
                q10_text: "Breaking down a complex task into smaller, manageable parts, often implemented as separate functions (each potentially with parameters), is a key aspect of which Computational Thinking concept?",
                q10_a: "Abstraction",
                q10_b: "Decomposition",
                q10_c: "Evaluation",
                q10_d: "Data Representation",
            },
            pt: {
                 page_title: "Verificação de Conhecimento: Módulo 17 - Python Completo",
                 return_button: "Voltar ao Painel",
                 header_title: "Verificação Módulo 17",
                 intro_title: "Verificação de Conhecimento: Parâmetros de Função",
                 intro_desc: "Teste seu entendimento sobre definição de funções com parâmetros e passagem de argumentos. Você precisa acertar <strong data-translate=\"pass_score\" class=\"pass-score\">6 de 10</strong> questões para passar.",
                 intro_attempts: "Você pode <strong data-translate=\"attempts\" class=\"attempts\">tentar quantas vezes precisar</strong>.",
                 pass_score: "6 de 10",
                 attempts: "tentar quantas vezes precisar",
                 submit_button: "Enviar Respostas",
                 result_pass: "Parabéns! Você Passou!",
                 result_fail: "Continue Tentando! Você consegue.",
                 result_score: "Sua pontuação: {score} de {total}",
                 try_again_button: "Tentar Novamente",
                 footer_text: "Parte do Projeto Road to Free Open AGI",
                // Questions & Answers (Module 17 - PT)
                q1_text: "Como você define uma função chamada `greet` que aceita um parâmetro chamado `name`?",
                q1_a: "<code>define greet(name):</code>",
                q1_b: "<code>function greet(name):</code>",
                q1_c: "<code>def greet(name):</code>",
                q1_d: "<code>def greet name:</code>",
                q2_text: "Se você tem a função `def add(x, y):`, como você a chama corretamente para somar 5 e 3?",
                q2_a: "<code>add(x=5, 3)</code>",
                q2_b: "<code>add(5, 3)</code>",
                q2_c: "<code>add(5 + 3)</code>",
                q2_d: "<code>call add(5, 3)</code>",
                q3_text: "No contexto de funções, qual a diferença entre um 'parâmetro' e um 'argumento'?",
                q3_a: "São exatamente a mesma coisa.",
                q3_b: "Parâmetro é a variável listada dentro dos parênteses na definição da função; argumento é o valor enviado para a função quando ela é chamada.",
                q3_c: "Argumento é a variável na definição da função; parâmetro é o valor passado ao chamar.",
                q3_d: "Parâmetros são usados para números, argumentos para strings.",
                q4_text: "Considere a função `def describe_pet(animal_type, pet_name):`. Se você a chamar como `describe_pet('Fluffy', 'hamster')`, qual será o valor de `animal_type` dentro da função?",
                q4_a: "'hamster'",
                q4_b: "'Fluffy'",
                q4_c: "Causará um erro porque a ordem está errada.",
                q4_d: "<code>None</code>",
                q5_text: "Usando a mesma função `describe_pet`, qual destas chamadas usa argumentos nomeados (keyword) corretamente?",
                q5_a: "<code>describe_pet(pet_name='Whiskers', animal_type='cat')</code>",
                q5_b: "<code>describe_pet('cat', pet_name='Whiskers')</code>",
                q5_c: "<code>describe_pet(animal='cat', name='Whiskers')</code>",
                q5_d: "Ambas A e B estão corretas.",
                q6_text: "Qual o benefício principal de usar valores padrão para parâmetros, como em `def power(base, exponent=2):`?",
                q6_a: "Faz a função executar mais rápido.",
                q6_b: "Força o usuário a sempre fornecer todos os argumentos.",
                q6_c: "Permite chamar a função com menos argumentos, usando o valor padrão se um argumento não for fornecido.",
                q6_d: "Previne erros ao chamar a função.",
                q7_text: "Se você tem `def greet(name, message='Hello')`, qual chamada é válida e usa o valor padrão para `message`?",
                q7_a: "<code>greet()</code>",
                q7_b: "<code>greet('Alice')</code>",
                q7_c: "<code>greet(name='Bob', 'Hi')</code>",
                q7_d: "<code>greet(message='Hi')</code>",
                q8_text: "Ao chamar uma função como `def info(name, age, city='Unknown'):`, você pode misturar argumentos posicionais e nomeados (keyword)?",
                q8_a: "Não, você deve usar ou todos posicionais ou todos nomeados.",
                q8_b: "Sim, mas todos os argumentos posicionais devem vir antes de quaisquer argumentos nomeados.",
                q8_c: "Sim, mas todos os argumentos nomeados devem vir antes de quaisquer argumentos posicionais.",
                q8_d: "Sim, você pode misturá-los em qualquer ordem.",
                q9_text: "Passar dados para uma função usando parâmetros esconde os detalhes internos de como a função funciona. Com qual conceito do Pensamento Computacional isso se relaciona mais diretamente?",
                q9_a: "Decomposição",
                q9_b: "Reconhecimento de Padrões",
                q9_c: "Abstração",
                q9_d: "Design de Algoritmos",
                q10_text: "Dividir uma tarefa complexa em partes menores e gerenciáveis, frequentemente implementadas como funções separadas (cada uma potencialmente com parâmetros), é um aspecto chave de qual conceito do Pensamento Computacional?",
                q10_a: "Abstração",
                q10_b: "Decomposição",
                q10_c: "Avaliação",
                q10_d: "Representação de Dados",
            },
             zh: {
                 page_title: "知识测验：模块 17 - Python 完全指南",
                 return_button: "返回仪表板",
                 header_title: "模块 17 测验",
                 intro_title: "知识测验：函数参数",
                 intro_desc: "测试您对定义带参数的函数和传递参数的理解。您需要正确回答 <strong data-translate=\"pass_score\" class=\"pass-score\">10 个问题中的 6 个</strong> 才能通过。",
                 intro_attempts: "您可以 <strong data-translate=\"attempts\" class=\"attempts\">根据需要尝试多次</strong>。",
                 pass_score: "10 个问题中的 6 个",
                 attempts: "根据需要尝试多次",
                 submit_button: "提交答案",
                 result_pass: "恭喜！您已通过！",
                 result_fail: "继续努力！您可以做到的。",
                 result_score: "您的得分：{total} 分中的 {score} 分",
                 try_again_button: "再次尝试",
                 footer_text: "通往自由开放 AGI 之路项目的一部分",
                 // Questions & Answers (Module 17 - ZH)
                 q1_text: "如何定义一个名为 `greet` 的函数，它接受一个名为 `name` 的参数？",
                 q1_a: "<code>define greet(name):</code>",
                 q1_b: "<code>function greet(name):</code>",
                 q1_c: "<code>def greet(name):</code>",
                 q1_d: "<code>def greet name:</code>",
                 q2_text: "如果您有一个函数 `def add(x, y):`，如何正确调用它来计算 5 和 3 的和？",
                 q2_a: "<code>add(x=5, 3)</code>",
                 q2_b: "<code>add(5, 3)</code>",
                 q2_c: "<code>add(5 + 3)</code>",
                 q2_d: "<code>call add(5, 3)</code>",
                 q3_text: "在函数的上下文中，“参数”（parameter）和“参数/实参”（argument）之间有什么区别？",
                 q3_a: "它们是完全相同的东西。",
                 q3_b: "参数是在函数定义中括号内列出的变量；参数/实参是调用函数时发送给函数的值。",
                 q3_c: "参数/实参是函数定义中的变量；参数是调用时传递的值。",
                 q3_d: "参数用于数字，参数/实参用于字符串。",
                 q4_text: "考虑函数 `def describe_pet(animal_type, pet_name):`。如果您像这样调用它 `describe_pet('Fluffy', 'hamster')`，函数内部 `animal_type` 的值将是什么？",
                 q4_a: "'hamster'",
                 q4_b: "'Fluffy'",
                 q4_c: "会引发错误，因为顺序错误。",
                 q4_d: "<code>None</code>",
                 q5_text: "使用相同的 `describe_pet` 函数，以下哪个调用正确使用了关键字参数？",
                 q5_a: "<code>describe_pet(pet_name='Whiskers', animal_type='cat')</code>",
                 q5_b: "<code>describe_pet('cat', pet_name='Whiskers')</code>",
                 q5_c: "<code>describe_pet(animal='cat', name='Whiskers')</code>",
                 q5_d: "A 和 B 都正确。",
                 q6_text: "使用默认参数值（如 `def power(base, exponent=2):`）的主要好处是什么？",
                 q6_a: "它使函数运行得更快。",
                 q6_b: "它强制用户总是提供所有参数。",
                 q6_c: "它允许您使用较少的参数调用函数，如果未提供某个参数，则使用默认值。",
                 q6_d: "它可以防止调用函数时出错。",
                 q7_text: "如果您有 `def greet(name, message='Hello')`，哪个调用是有效的并且使用了 `message` 的默认值？",
                 q7_a: "<code>greet()</code>",
                 q7_b: "<code>greet('Alice')</code>",
                 q7_c: "<code>greet(name='Bob', 'Hi')</code>",
                 q7_d: "<code>greet(message='Hi')</code>",
                 q8_text: "调用像 `def info(name, age, city='Unknown'):` 这样的函数时，可以混合使用位置参数和关键字参数吗？",
                 q8_a: "不行，您必须要么全部使用位置参数，要么全部使用关键字参数。",
                 q8_b: "可以，但所有位置参数必须在任何关键字参数之前。",
                 q8_c: "可以，但所有关键字参数必须在任何位置参数之前。",
                 q8_d: "可以，您可以按任何顺序混合它们。",
                 q9_text: "使用参数将数据传递到函数中，隐藏了函数如何工作的内部细节。这与哪个计算思维概念最密切相关？",
                 q9_a: "分解 (Decomposition)",
                 q9_b: "模式识别 (Pattern Recognition)",
                 q9_c: "抽象 (Abstraction)",
                 q9_d: "算法设计 (Algorithm Design)",
                 q10_text: "将复杂的任务分解为更小、可管理的部分，通常实现为单独的函数（每个函数可能都有参数），这是哪个计算思维概念的关键方面？",
                 q10_a: "抽象 (Abstraction)",
                 q10_b: "分解 (Decomposition)",
                 q10_c: "评估 (Evaluation)",
                 q10_d: "数据表示 (Data Representation)",
             }
        };

        // --- Constants ---
        const MODULE_ID = 17;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1'; // Same key as dashboard
        const PASS_SCORE = 6;
        const TOTAL_QUESTIONS = 10;

        const questions = [
            { qKey: 'q1', correctIndex: 2 }, // def greet(name):
            { qKey: 'q2', correctIndex: 1 }, // add(5, 3)
            { qKey: 'q3', correctIndex: 1 }, // Parameter in definition, argument when called
            { qKey: 'q4', correctIndex: 1 }, // 'Fluffy' (positional)
            { qKey: 'q5', correctIndex: 3 }, // Both A and B (one full keyword, one mixed correctly)
            { qKey: 'q6', correctIndex: 2 }, // Call with fewer arguments
            { qKey: 'q7', correctIndex: 1 }, // greet('Alice')
            { qKey: 'q8', correctIndex: 1 }, // Yes, positional before keyword
            { qKey: 'q9', correctIndex: 2 }, // Abstraction
            { qKey: 'q10', correctIndex: 1 } // Decomposition
        ];

        // --- DOM Elements ---
        const formElement = document.getElementById('kc-form');
        const submitButton = document.getElementById('kc-submit-button');
        const resultElement = document.getElementById('kc-result');
        const resultMessageElement = document.getElementById('kc-result-message');
        const scoreElement = document.getElementById('kc-score');
        const tryAgainButton = document.getElementById('kc-try-again-button');

         // --- Language and Translation Functions (Copied from Dashboard) ---
         function getStoredLanguage() {
            const storedLang = localStorage.getItem('userLanguage'); // Use same key
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default
         }

         function getTranslation(key, lang, replacements = {}) {
             // Fallback logic: current lang -> english -> key itself
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             // Replace placeholders like {score}
             for (const placeholder in replacements) {
                 // Use a regex for global replacement
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }

         function translatePage(lang) {
             if (!translations[lang]) lang = 'en'; // Ensure lang exists
             document.documentElement.lang = lang; // Set lang attribute on HTML tag

             // Translate elements with data-translate attribute
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 // Special handling for title
                 if (el.tagName === 'TITLE') {
                     document.title = translation;
                 }
                 // If translation contains HTML (like the <strong> tags), use innerHTML
                 else if (translation.includes('<') && translation.includes('>')) {
                     el.innerHTML = translation;
                 }
                 // Otherwise, use textContent
                 else {
                     el.textContent = translation;
                 }
             });

             // Translate elements with data-translate-placeholder attribute
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                 const key = el.getAttribute('data-translate-placeholder');
                 el.setAttribute('placeholder', getTranslation(key, lang));
             });

              // Translate elements with data-translate-aria-label attribute
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang));
             });
         }


        // --- Quiz Logic ---
         function renderQuiz(lang) {
             formElement.innerHTML = ''; // Clear previous questions
             questions.forEach((qData, index) => {
                 const questionIndex = index + 1;
                 const questionKey = `q${questionIndex}_text`;
                 const questionText = getTranslation(questionKey, lang);

                 const questionDiv = document.createElement('div');
                 questionDiv.classList.add('kc-question');
                 questionDiv.setAttribute('data-question-index', index);

                 const questionTextElement = document.createElement('p');
                 questionTextElement.classList.add('kc-question-text');
                 questionTextElement.innerHTML = `<strong>${questionIndex}.</strong> ${questionText}`; // Use innerHTML for <code> tags
                 questionDiv.appendChild(questionTextElement);

                 const optionsDiv = document.createElement('div');
                 optionsDiv.classList.add('kc-options');

                 const options = ['a', 'b', 'c', 'd'];
                 options.forEach((optionLetter, optionIndex) => {
                     const optionKey = `q${questionIndex}_${optionLetter}`;
                     const optionText = getTranslation(optionKey, lang);
                     const optionId = `q${index}_opt${optionIndex}`;

                     const optionContainer = document.createElement('div');
                     optionContainer.classList.add('kc-option');

                     const radioInput = document.createElement('input');
                     radioInput.type = 'radio';
                     radioInput.name = `question_${index}`;
                     radioInput.value = optionIndex;
                     radioInput.id = optionId;
                     radioInput.required = true; // Make selection mandatory

                     const label = document.createElement('label');
                     label.htmlFor = optionId;
                     label.innerHTML = optionText; // Use innerHTML for <code> tags

                     optionContainer.appendChild(radioInput);
                     optionContainer.appendChild(label);
                     optionsDiv.appendChild(optionContainer);
                 });

                 questionDiv.appendChild(optionsDiv);
                 formElement.appendChild(questionDiv);
             });
         }


        function handleSubmit(event) {
            event.preventDefault();
            submitButton.disabled = true; // Prevent double submission

            let score = 0;
            const questionElements = formElement.querySelectorAll('.kc-question');

            questionElements.forEach((questionEl, index) => {
                const selectedOption = questionEl.querySelector(`input[name="question_${index}"]:checked`);
                const options = questionEl.querySelectorAll('.kc-option');
                 options.forEach(opt => opt.classList.remove('correct-answer', 'incorrect-answer')); // Clear previous highlights

                if (selectedOption) {
                    const selectedIndex = parseInt(selectedOption.value, 10);
                    const correctIndex = questions[index].correctIndex;

                     // Highlight correct answer
                    const correctOptionEl = options[correctIndex];
                    if(correctOptionEl) correctOptionEl.classList.add('correct-answer');

                    if (selectedIndex === correctIndex) {
                        score++;
                         questionEl.classList.add('correct');
                         questionEl.classList.remove('incorrect');
                    } else {
                         questionEl.classList.add('incorrect');
                          questionEl.classList.remove('correct');
                         // Highlight the user's incorrect choice
                         const incorrectOptionEl = options[selectedIndex];
                         if(incorrectOptionEl) incorrectOptionEl.classList.add('incorrect-answer');
                    }
                } else {
                     questionEl.classList.add('incorrect'); // Mark unanswered as incorrect visually
                     questionEl.classList.remove('correct');
                     // Still highlight the correct one
                     const correctOptionEl = options[questions[index].correctIndex];
                     if(correctOptionEl) correctOptionEl.classList.add('correct-answer');
                }

                 // Disable inputs after submission
                 questionEl.querySelectorAll('input[type="radio"]').forEach(input => input.disabled = true);
            });

            showResults(score);
        }

         function showResults(score) {
             const lang = getStoredLanguage();
             const passed = score >= PASS_SCORE;

             resultMessageElement.textContent = getTranslation(passed ? 'result_pass' : 'result_fail', lang);
             scoreElement.textContent = getTranslation('result_score', lang, { score: score, total: TOTAL_QUESTIONS });

             resultElement.className = ''; // Clear previous classes
             resultElement.classList.add(passed ? 'pass' : 'fail');
             resultElement.style.display = 'block'; // Show the results area

             // Scroll to results smoothly
             resultElement.scrollIntoView({ behavior: 'smooth', block: 'center' });


             if (passed) {
                 updateLocalStorageOnPass();
                 // Optionally hide "Try Again" if passed, or keep it for review
                 // tryAgainButton.style.display = 'none';
             } else {
                 tryAgainButton.style.display = 'inline-block'; // Ensure it's visible if failed
             }
         }

         function resetQuiz() {
             resultElement.style.display = 'none'; // Hide results
             submitButton.disabled = false; // Re-enable submit

             const questionElements = formElement.querySelectorAll('.kc-question');
             questionElements.forEach(questionEl => {
                 questionEl.classList.remove('correct', 'incorrect');
                  const options = questionEl.querySelectorAll('.kc-option');
                  options.forEach(opt => opt.classList.remove('correct-answer', 'incorrect-answer'));

                 const radios = questionEl.querySelectorAll('input[type="radio"]');
                 radios.forEach(radio => {
                     radio.checked = false;
                     radio.disabled = false; // Re-enable radio buttons
                 });
             });

             // Scroll back to the top
             window.scrollTo({ top: 0, behavior: 'smooth' });
         }

        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {}; // Return empty object on error
            }
        }

        function updateLocalStorageOnPass() {
            const currentStatus = loadKnowledgeCheckStatus();
            currentStatus[MODULE_ID] = true; // Mark this module as complete
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                console.log(`Knowledge Check status updated for Module ${MODULE_ID}`);
            } catch (e) {
                console.error("Error writing KC status to localStorage:", e);
                // Handle potential storage errors (e.g., quota exceeded)
            }
        }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            const currentLanguage = getStoredLanguage();
            translatePage(currentLanguage); // Translate static elements first
            renderQuiz(currentLanguage); // Then render the dynamic quiz content

            formElement.addEventListener('submit', handleSubmit);
            tryAgainButton.addEventListener('click', resetQuiz);
        });

    </script>

</body>
</html>