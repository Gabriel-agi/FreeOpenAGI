<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 22: Advanced Tuple Practice</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Mostly Identical to Basic Practice) --- */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --tuple-color: #fd7e14; /* Orange */
            --immutable-color: #6f42c1; /* Purple */
            --method-color: #20c997; /* Teal variation for methods */
            --packing-color: #e83e8c; /* Pink for packing/unpacking */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --font-code: 'Courier New', Courier, monospace;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Identical) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: var(--font-code); }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }

        /* --- Advanced Animations (Identical) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; } .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; } .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0%{transform:scale(1) rotate(0deg);opacity:.1} 50%{transform:scale(1.05) rotate(5deg);opacity:.25} 100%{transform:scale(1) rotate(0deg);opacity:.1} }
        @keyframes successGlow { 0%{box-shadow:0 0 3px rgba(40,167,69,.3)} 50%{box-shadow:0 0 12px 5px rgba(40,167,69,.5);transform:scale(1.01)} 100%{box-shadow:0 0 3px rgba(40,167,69,.3)} }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%,90%{transform:translate3d(-2px,0,0)} 20%,80%{transform:translate3d(3px,0,0)} 30%,50%,70%{transform:translate3d(-5px,0,0)} 40%,60%{transform:translate3d(5px,0,0)} }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0%{transform:scale(.5) rotate(-15deg);opacity:0} 60%{transform:scale(1.2) rotate(5deg);opacity:1} 100%{transform:scale(1) rotate(0deg);opacity:1} }
        @keyframes iconAppearIncorrect { 0%{transform:scale(.5) rotate(-15deg);opacity:0} 50%{transform:scale(1.2) rotate(10deg);opacity:1} 70%{transform:scale(.9) rotate(-5deg)} 100%{transform:scale(1) rotate(0deg);opacity:1} }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav (Identical Structure, Links Updated via JS/HTML) --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75);
            color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer;
            transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark);
            border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0;
            transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none;
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; } .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem;
            border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px;
            padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Practice Header (Slightly different gradient for Advanced) --- */
        .practice-header { background: linear-gradient(135deg, var(--immutable-color), #4a2d87); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 7s infinite ease-in-out alternate; }
        .icon1 { top: 15%; left: 12%; animation-duration: 6s; opacity: 0.15;} /* Packing icon */
        .icon2 { bottom: 20%; right: 15%; animation-duration: 8s; opacity: 0.15;} /* Slicing icon */

        /* --- Practice Section Styling (Identical) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Identical) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; /* Adjust if longer messages needed */ margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button {
             display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light);
             background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none;
        }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button.info { background-color: var(--info-color); }
        .action-button.info:hover:not(:disabled) { background-color: #138496; }
        .action-button.method { background-color: var(--method-color); } /* Specific color for method buttons */
        .action-button.method:hover:not(:disabled) { background-color: #1aa17b; }

        /* --- Code styling (Identical + method/property) --- */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--font-code); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; line-height: 1.6; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; }
        .code-paren { color: #ffd700; } .code-number { color: #b5cea8; } .code-variable { color: #9cdcfe; } .code-operator { color: #d4d4d4; }
        .code-brackets { color: var(--accent-color); } .code-method { color: var(--method-color); font-weight: bold; } .code-property { color: var(--method-color); }

        /* --- General Simulator Styles (Reusable) --- */
        .sim-editor { width: 100%; min-height: 60px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--font-code); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--text-light); font-family: var(--font-code); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        .sim-output-area .output-line.success { color: var(--accent-color); }
        .sim-output-area .output-line.error { color: var(--error-color); font-weight: bold; }
        .sim-output-area .output-line.info { color: var(--info-color); }

        /* --- Activity 1: Packing & Unpacking Anatomy --- */
        #packing-unpacking-anatomy .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; margin: 0 1px; }
        #packing-unpacking-anatomy .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #packing-unpacking-anatomy .code-part.identified { background-color: rgba(232, 62, 140, 0.2); border-bottom: 2px solid var(--packing-color); cursor: default; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #packing-unpacking-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 2: Tuple Methods Demo --- */
        #tuple-methods-demo .demo-tuple { background-color: var(--background-medium); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; font-family: var(--font-code); text-align: center; font-size: 1.1rem; }
        #tuple-methods-demo .button-group { gap: 0.5rem; justify-content: center; } /* Tighter buttons */

        /* --- Activity 3: Nested Tuples & Slicing --- */
        #nested-slicing-challenge .challenge-tuple { /* Similar to demo-tuple */ background-color: var(--background-medium); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; font-family: var(--font-code); text-align: center; font-size: 1.1rem; }

        /* --- Activity 4: Tuples in Action --- */
        #tuples-in-action .scenario { background-color: var(--background-light); border-left: 4px solid var(--info-color); padding: 1rem 1.5rem; margin-bottom: 1.5rem; border-radius: 0 var(--border-radius) var(--border-radius) 0; }
        #tuples-in-action .scenario code { background-color: var(--background-medium); padding: 2px 5px; border-radius: 3px; font-family: var(--font-code); color: var(--primary-color); }

        /* --- Activity 5: Mini Missions (Structure identical) --- */
        #mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #mini-missions .mission-editor { width: 100%; min-height: 80px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--font-code); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--font-code); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }

        /* --- Final Section (Structure identical) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Identical - should adapt) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; } .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; } .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; } .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; } .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            .sim-editor, .sim-output-area { font-size: 0.9rem; }
            #mini-missions .mission-editor, #mini-missions .mission-output { font-size: 0.95rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher & UPDATED Links) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- UPDATED Links for Advanced Page -->
            <li><a href="ctp-practice-22.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_basic_practice">Basic Practice</span></a></li>
            <li><a href="ctp-video-22.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video">Watch Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- Activity Links -->
            <li><a href="#packing-unpacking-anatomy"><i class="fas fa-boxes fa-fw"></i> <span data-translate="nav_packing">Packing/Unpacking</span></a></li>
            <li><a href="#tuple-methods-demo"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_methods">Methods</span></a></li>
            <li><a href="#nested-slicing-challenge"><i class="fas fa-layer-group fa-fw"></i> <span data-translate="nav_nested_slicing">Nested & Slicing</span></a></li>
            <li><a href="#tuples-in-action"><i class="fas fa-exchange-alt fa-fw"></i> <span data-translate="nav_action">In Action</span></a></li>
            <li><a href="#mini-missions"><i class="fas fa-tasks fa-fw"></i> <span data-translate="nav_missions">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- Icons representing packing/unpacking (boxes) and slicing (scissors) -->
        <i class="fas fa-boxes header-icon icon1"></i>
        <i class="fas fa-cut header-icon icon2"></i>
        <div class="container">
            <!-- MODULE NUMBER & TOPIC UPDATED -->
            <h1 data-translate="header_title">Module 22: Advanced Tuple Practice</h1>
            <p data-translate="header_subtitle">Deeper dive: Packing, unpacking, methods, nesting, and slicing tuples.</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Packing & Unpacking ========= -->
        <section id="packing-unpacking-anatomy" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-boxes"></i> <span data-translate="pack_unpack_title">Tuple Packing & Unpacking</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="pack_unpack_desc_anatomy">
                     Python allows creating tuples without `()` (packing) and assigning tuple elements directly to variables (unpacking). Click the parts to understand.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
                         <pre><code><span class="code-comment" data-translate="pack_unpack_code_comment1"># Packing (Parentheses optional)</span>
<span class="code-part" data-part="packed_tuple_var" data-translate-title="tooltip_click_identify" title="Click"><span class="code-variable">point</span></span> <span class="code-part" data-part="assign" data-translate-title="tooltip_click_identify" title="Click"><span class="code-operator">=</span></span> <span class="code-part" data-part="packed_value" data-translate-title="tooltip_click_identify" title="Click"><span class="code-number">10</span></span><span class="code-part" data-part="comma" data-translate-title="tooltip_click_identify" title="Click"><span class="code-operator">,</span></span> <span class="code-part" data-part="packed_value" data-translate-title="tooltip_click_identify" title="Click"><span class="code-number">20</span></span>

<span class="code-comment" data-translate="pack_unpack_code_comment2"># Unpacking (Assigning tuple elements to variables)</span>
<span class="code-part" data-part="unpacked_var" data-translate-title="tooltip_click_identify" title="Click"><span class="code-variable">x</span></span><span class="code-part" data-part="comma" data-translate-title="tooltip_click_identify" title="Click"><span class="code-operator">,</span></span> <span class="code-part" data-part="unpacked_var" data-translate-title="tooltip_click_identify" title="Click"><span class="code-variable">y</span></span> <span class="code-part" data-part="assign" data-translate-title="tooltip_click_identify" title="Click"><span class="code-operator">=</span></span> <span class="code-part" data-part="tuple_to_unpack" data-translate-title="tooltip_click_identify" title="Click"><span class="code-variable">point</span></span></code></pre>
                     </div>
                     <div id="packing-unpacking-explanations"></div>
                     <p id="packing-unpacking-status" data-translate="pack_unpack_status_initial">Identify all 8 parts!</p>
                     <div id="packing-unpacking-feedback" class="feedback-message"></div>
                     <!-- Hidden explanations -->
                     <div id="explanation-texts-pack-unpack" style="display: none;">
                         <span data-key="packed_tuple_var" data-translate="pack_unpack_exp_var">Packed Tuple Variable: Holds the tuple created via packing.</span>
                         <span data-key="assign" data-translate="pack_unpack_exp_assign">Assignment `=`: Assigns values.</span>
                         <span data-key="packed_value" data-translate="pack_unpack_exp_value">Packed Value: An element of the implicitly created tuple.</span>
                         <span data-key="comma" data-translate="pack_unpack_exp_comma">Comma `,`: Separates elements in packing/unpacking.</span>
                         <span data-key="unpacked_var" data-translate="pack_unpack_exp_unpacked_var">Unpacked Variable: Receives one element from the tuple.</span>
                         <span data-key="tuple_to_unpack" data-translate="pack_unpack_exp_tuple_name">Tuple to Unpack: The existing tuple whose elements are assigned.</span>
                      </div>
                 </div>
                 <!-- Unpacking Challenge -->
                 <p class="section-description fade-in delay-3" data-translate="pack_unpack_desc_challenge" style="margin-top: 2.5rem;">
                    Challenge: Given `data = ("Alpha", 101, True)`, write the code to unpack it into variables `name`, `id_num`, and `status`.
                 </p>
                  <div class="interactive-area fade-in delay-4">
                      <label for="unpack-editor-input" class="code-font" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="pack_unpack_editor_label">Unpacking Code:</label>
                      <textarea id="unpack-editor-input" class="sim-editor" rows="1" data-translate-placeholder="pack_unpack_editor_placeholder" placeholder='e.g., var1, var2, var3 = data'></textarea>
                      <div class="text-center">
                           <button id="check-unpack-btn" class="action-button info" data-translate="pack_unpack_button_check">Check Unpacking</button>
                      </div>
                      <div id="unpack-feedback" class="feedback-message"></div>
                  </div>
             </div>
        </section>

        <!-- ========= Activity 2: Tuple Methods ========= -->
        <section id="tuple-methods-demo" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-cogs"></i> <span data-translate="methods_title">Tuple Methods: .index() & .count()</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="methods_desc">
                     Tuples have few methods because they're immutable. Two useful ones are `.index(value)` (finds first occurrence) and `.count(value)` (counts occurrences). Try them out!
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="demo-tuple" data-translate="methods_demo_tuple">Demo Tuple: `items = ('A', 1, 'B', 2, 'A', 3, 'A')`</div>
                     <div class="button-group">
                        <button id="run-index-btn" class="action-button method" data-translate="methods_button_index">Find Index of 'B'</button>
                        <button id="run-count-btn" class="action-button method" data-translate="methods_button_count">Count Occurrences of 'A'</button>
                     </div>
                     <label for="methods-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="methods_output_label">Simulated Result:</label>
                     <div id="methods-output" class="sim-output-area">
                         <span class="placeholder" data-translate="methods_output_placeholder">Result will appear here...</span>
                     </div>
                     <div id="methods-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Nested Tuples & Slicing ========= -->
        <section id="nested-slicing-challenge" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-layer-group"></i> <span data-translate="nested_slicing_title">Nested Tuples & Slicing</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="nested_slicing_desc">
                     Tuples can contain other tuples! Access nested elements using multiple indices. Slicing (`[start:end]`) works like lists, creating a *new* tuple.
                 </p>
                  <!-- Nested Access Example (Non-interactive text) -->
                  <div class="code-block fade-in delay-2">
                    <pre><code><span class="code-variable">matrix</span> <span class="code-operator">=</span> <span class="code-paren">((</span><span class="code-number">1</span><span class="code-operator">,</span> <span class="code-number">2</span><span class="code-paren">)</span><span class="code-operator">,</span> <span class="code-paren">(</span><span class="code-number">3</span><span class="code-operator">,</span> <span class="code-number">4</span><span class="code-paren">))</span>
<span class="code-variable">element</span> <span class="code-operator">=</span> <span class="code-variable">matrix</span><span class="code-brackets">[</span><span class="code-number">1</span><span class="code-brackets">]</span><span class="code-brackets">[</span><span class="code-number">0</span><span class="code-brackets">]</span>  <span class="code-comment" data-translate="nested_slicing_code_comment"># Accesses the number 3</span></code></pre>
                  </div>
                  <!-- Slicing Challenge -->
                 <p class="section-description fade-in delay-3" data-translate="nested_slicing_challenge_desc" style="margin-top: 2.5rem;">
                    Challenge: Given `alphabet = ('a', 'b', 'c', 'd', 'e', 'f')`, write code to get a new tuple containing `('c', 'd', 'e')` using slicing.
                 </p>
                 <div class="interactive-area fade-in delay-4">
                     <label for="slice-editor-input" class="code-font" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="nested_slicing_editor_label">Slicing Code:</label>
                     <textarea id="slice-editor-input" class="sim-editor" rows="1" data-translate-placeholder="nested_slicing_editor_placeholder" placeholder='e.g., alphabet[1:4]'></textarea>
                     <div class="text-center">
                          <button id="run-slice-btn" class="action-button info" data-translate="nested_slicing_button_check">Simulate Slice</button>
                     </div>
                     <label for="slice-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="nested_slicing_output_label">Simulated Output:</label>
                     <div id="slice-output" class="sim-output-area">
                         <span class="placeholder" data-translate="nested_slicing_output_placeholder">Sliced tuple will appear here...</span>
                     </div>
                     <div id="slice-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4: Tuples in Action (Function Return) ========= -->
        <section id="tuples-in-action" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-exchange-alt"></i> <span data-translate="action_title">Tuples in Action: Function Returns</span></h2>
                <p class="section-description fade-in delay-1" data-translate="action_desc">
                    A common Python pattern is to return multiple values from a function using a tuple. Unpacking makes accessing these results clean and easy.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div class="scenario">
                        <p data-translate="action_scenario">Scenario: Imagine a function `get_coordinates()` returns a tuple `(x, y, z)`.</p>
                        <code class="code-font"># Assume function call returns a tuple
result = get_coordinates() # result might be (15, -5, 10)
                        </code>
                    </div>
                     <p class="section-description fade-in delay-3" data-translate="action_challenge_desc">
                        Challenge: Write the code to unpack the `result` tuple into variables `pos_x`, `pos_y`, and `pos_z`.
                     </p>
                     <label for="return-unpack-editor-input" class="code-font" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="action_editor_label">Unpacking Code:</label>
                     <textarea id="return-unpack-editor-input" class="sim-editor" rows="1" data-translate-placeholder="action_editor_placeholder" placeholder='var1, var2, var3 = result'></textarea>
                     <div class="text-center">
                          <button id="check-return-unpack-btn" class="action-button info" data-translate="action_button_check">Check Unpacking</button>
                     </div>
                     <div id="return-unpack-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 5: Mini Missions (Advanced) ========= -->
        <section id="mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-tasks"></i> <span data-translate="missions_title">Advanced Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_desc">
                     Combine your advanced tuple skills to complete these tasks.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission1_title">Mission 1: Pack & Unpack Coordinates</h4>
                         <p data-translate="mission1_desc">Use tuple packing to create a `location` tuple with values "City Hall" and 123. Then, unpack `location` into `place` and `address_num` variables. Print both variables.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="mission1_placeholder" placeholder='location = "City Hall", 123\nplace, address_num = location\nprint(place)\nprint(address_num)'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission2_title">Mission 2: Find and Count</h4>
                         <p data-translate="mission2_desc">Create a tuple `grades = ('B', 'A', 'C', 'A', 'B', 'A')`. First, print how many times 'A' appears using `.count()`. Second, print the index of the *first* 'B' using `.index()`.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="mission2_placeholder" placeholder='grades = (...)\nprint(grades.count(...))\nprint(grades.index(...))'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission3_title">Mission 3: Nested Access & Slicing</h4>
                         <p data-translate="mission3_desc">Create `schedule = (("Mon", "Tue"), ("Wed", "Thu"), ("Fri",))`. First, access and print "Thu". Second, create and print a *slice* containing the first two inner tuples `(("Mon", "Tue"), ("Wed", "Thu"))`.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="mission3_placeholder" placeholder='schedule = (...)\nprint(schedule[?][?])\nprint(schedule[?:?])'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in">
                    <i class="fas fa-star-half-alt"></i> <i class="fas fa-level-up-alt"></i> <i class="fas fa-star-half-alt"></i>
                </div>
                 <!-- MODULE NUMBER UPDATED -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 22 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Great job tackling these advanced tuple concepts! You're becoming proficient. <br>
                    Review the basic practice or watch the video lesson if needed, or move on to the next module!
                </p>
                <div class="button-group">
                    <!-- UPDATED Links for Advanced Page Completion -->
                    <a href="ctp-practice-22.html" class="action-button secondary fade-in delay-3"><i class="fas fa-pencil-alt"></i> <span data-translate="button_basic_practice">Review Basic Practice</span></a>
                    <a href="ctp-video-22.html" class="action-button info fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 22: Advanced Tuple Practice",
            "tooltip_click_identify": "Click to identify this part",
            "nav_basic_practice": "Basic Practice", "nav_video": "Watch Video Lesson", "nav_menu": "Course Menu", // Updated Nav
            "nav_packing": "Packing/Unpacking", "nav_methods": "Methods", "nav_nested_slicing": "Nested & Slicing", "nav_action": "In Action", "nav_missions": "Missions", // Activity Nav
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 22: Advanced Tuple Practice", "header_subtitle": "Deeper dive: Packing, unpacking, methods, nesting, and slicing tuples.",
            // Activity 1: Packing/Unpacking
            "pack_unpack_title": "Tuple Packing & Unpacking",
            "pack_unpack_desc_anatomy": "Python allows creating tuples without `()` (packing) and assigning tuple elements directly to variables (unpacking). Click the parts to understand.",
            "pack_unpack_code_comment1": "# Packing (Parentheses optional)", "pack_unpack_code_comment2": "# Unpacking (Assigning tuple elements to variables)",
            "pack_unpack_status_initial": "Identify all 8 parts!", "pack_unpack_status_progress": "Identified {count} of {total} parts.", "pack_unpack_status_done": "All parts identified!",
            "pack_unpack_exp_var": "Packed Tuple Variable: Holds the tuple created via packing.",
            "pack_unpack_exp_assign": "Assignment `=`: Assigns values.",
            "pack_unpack_exp_value": "Packed Value: An element of the implicitly created tuple.",
            "pack_unpack_exp_comma": "Comma `,`: Separates elements in packing/unpacking.",
            "pack_unpack_exp_unpacked_var": "Unpacked Variable: Receives one element from the tuple.",
            "pack_unpack_exp_tuple_name": "Tuple to Unpack: The existing tuple whose elements are assigned.",
            "feedback_pack_unpack_anatomy_correct": "Great! You've identified packing and unpacking syntax.",
            "pack_unpack_desc_challenge": "Challenge: Given `data = (\"Alpha\", 101, True)`, write the code to unpack it into variables `name`, `id_num`, and `status`.",
            "pack_unpack_editor_label": "Unpacking Code:", "pack_unpack_editor_placeholder": "e.g., var1, var2, var3 = data",
            "pack_unpack_button_check": "Check Unpacking",
            "feedback_unpack_correct": "Excellent! Correct unpacking assignment.",
            "feedback_unpack_incorrect_vars": "Almost! Make sure you use the exact variable names: `name, id_num, status`.",
            "feedback_unpack_incorrect_syntax": "Check the syntax. It should be `var1, var2, var3 = tuple_name`.",
            "feedback_unpack_empty": "Enter the unpacking code.",
            // Activity 2: Methods
            "methods_title": "Tuple Methods: .index() & .count()", "methods_desc": "Tuples have few methods because they're immutable. Two useful ones are `.index(value)` (finds first occurrence) and `.count(value)` (counts occurrences). Try them out!",
            "methods_demo_tuple": "Demo Tuple: `items = ('A', 1, 'B', 2, 'A', 3, 'A')`",
            "methods_button_index": "Find Index of 'B'", "methods_button_count": "Count Occurrences of 'A'",
            "methods_output_label": "Simulated Result:", "methods_output_placeholder": "Result will appear here...",
            "feedback_methods_index_success": "Correct! `items.index('B')` returns `2` (the index of the first 'B').",
            "feedback_methods_count_success": "Correct! `items.count('A')` returns `3` ('A' appears 3 times).",
            // Activity 3: Nested & Slicing
            "nested_slicing_title": "Nested Tuples & Slicing", "nested_slicing_desc": "Tuples can contain other tuples! Access nested elements using multiple indices. Slicing (`[start:end]`) works like lists, creating a *new* tuple.",
            "nested_slicing_code_comment": "# Accesses the number 3",
            "nested_slicing_challenge_desc": "Challenge: Given `alphabet = ('a', 'b', 'c', 'd', 'e', 'f')`, write code to get a new tuple containing `('c', 'd', 'e')` using slicing.",
            "nested_slicing_editor_label": "Slicing Code:", "nested_slicing_editor_placeholder": "e.g., alphabet[1:4]",
            "nested_slicing_button_check": "Simulate Slice", "nested_slicing_output_label": "Simulated Output:", "nested_slicing_output_placeholder": "Sliced tuple will appear here...",
            "feedback_slice_correct": "Perfect slice! Result: `('c', 'd', 'e')`",
            "feedback_slice_incorrect": "Not quite the right slice. Remember index 2 up to (but not including) index 5.",
            "feedback_slice_syntax": "Check slicing syntax: `tuple_name[start:end]`.",
            "feedback_slice_empty": "Enter the slicing code.",
            // Activity 4: Action
            "action_title": "Tuples in Action: Function Returns", "action_desc": "A common Python pattern is to return multiple values from a function using a tuple. Unpacking makes accessing these results clean and easy.",
            "action_scenario": "Scenario: Imagine a function `get_coordinates()` returns a tuple `(x, y, z)`.",
            "action_challenge_desc": "Challenge: Write the code to unpack the `result` tuple into variables `pos_x`, `pos_y`, and `pos_z`.",
            "action_editor_label": "Unpacking Code:", "action_editor_placeholder": "var1, var2, var3 = result",
            "action_button_check": "Check Unpacking",
            "feedback_action_unpack_correct": "Excellent! You correctly unpacked the returned tuple.",
            "feedback_action_unpack_incorrect_vars": "Almost! Use the exact variable names: `pos_x, pos_y, pos_z`.",
            "feedback_action_unpack_incorrect_syntax": "Check syntax: `var1, var2, var3 = tuple_name`.",
            "feedback_action_unpack_empty": "Enter the unpacking code.",
            // Activity 5: Missions
            "missions_title": "Advanced Mini Missions!", "missions_desc": "Combine your advanced tuple skills to complete these tasks.",
            "mission1_title": "Mission 1: Pack & Unpack Coordinates", "mission1_desc": "Use tuple packing to create a `location` tuple with values \"City Hall\" and 123. Then, unpack `location` into `place` and `address_num` variables. Print both variables.", "mission1_placeholder": "location = \"City Hall\", 123\nplace, address_num = location\nprint(place)\nprint(address_num)",
            "button_test_mission_1": "Test Mission 1",
            "mission2_title": "Mission 2: Find and Count", "mission2_desc": "Create a tuple `grades = ('B', 'A', 'C', 'A', 'B', 'A')`. First, print how many times 'A' appears using `.count()`. Second, print the index of the *first* 'B' using `.index()`.", "mission2_placeholder": "grades = (...)\nprint(grades.count(...))\nprint(grades.index(...))",
            "button_test_mission_2": "Test Mission 2",
            "mission3_title": "Mission 3: Nested Access & Slicing", "mission3_desc": "Create `schedule = ((\"Mon\", \"Tue\"), (\"Wed\", \"Thu\"), (\"Fri\",))`. First, access and print \"Thu\". Second, create and print a *slice* containing the first two inner tuples `((\"Mon\", \"Tue\"), (\"Wed\", \"Thu\"))`.", "mission3_placeholder": "schedule = (...)\nprint(schedule[?][?])\nprint(schedule[?:?])",
            "button_test_mission_3": "Test Mission 3",
            "feedback_mission_success": "Mission Accomplished!", "feedback_mission_syntax_error": "Syntax/logic error in code.",
            "feedback_mission1_hint": "Use packing `var = val1, val2`, unpacking `v1, v2 = var`, and `print()`.",
            "feedback_mission2_hint": "Create `grades = (...)`. Use `print(grades.count('A'))` and `print(grades.index('B'))`.",
            "feedback_mission3_hint": "Create `schedule = (...)`. Use `print(schedule[1][1])` for 'Thu' and `print(schedule[0:2])` for slice.",
            "feedback_missions_summary_all_done": "All {totalMissions} advanced missions complete! Excellent!", "feedback_missions_summary_progress": "Completed {completedCount} of {totalMissions} missions. Keep pushing!",
            // Completion
            "completion_title": "Module 22 Advanced Practice Complete!", "completion_desc": "Great job tackling these advanced tuple concepts! You're becoming proficient. <br> Review the basic practice or watch the video lesson if needed, or move on to the next module!",
            "button_basic_practice": "Review Basic Practice", "button_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu" // Updated buttons
        },
        pt: {
            "page_title": "Módulo 22: Prática Avançada de Tuplas",
            "tooltip_click_identify": "Clique para identificar esta parte",
            "nav_basic_practice": "Prática Básica", "nav_video": "Ver Videoaula", "nav_menu": "Menu do Curso", // Nav Atualizada
            "nav_packing": "Empacotar/Desempacotar", "nav_methods": "Métodos", "nav_nested_slicing": "Aninhadas & Fatiar", "nav_action": "Em Ação", "nav_missions": "Missões", // Nav Atividade
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 22: Prática Avançada de Tuplas", "header_subtitle": "Aprofundando: Empacotar, desempacotar, métodos, aninhamento e fatiamento de tuplas.",
             // Activity 1: Packing/Unpacking
            "pack_unpack_title": "Empacotamento e Desempacotamento de Tuplas",
            "pack_unpack_desc_anatomy": "Python permite criar tuplas sem `()` (empacotamento) e atribuir elementos de tupla diretamente a variáveis (desempacotamento). Clique nas partes para entender.",
            "pack_unpack_code_comment1": "# Empacotamento (Parênteses opcionais)", "pack_unpack_code_comment2": "# Desempacotamento (Atribuindo elementos da tupla a variáveis)",
            "pack_unpack_status_initial": "Identifique todas as 8 partes!", "pack_unpack_status_progress": "Identificadas {count} de {total} partes.", "pack_unpack_status_done": "Todas as partes identificadas!",
            "pack_unpack_exp_var": "Variável da Tupla Empacotada: Contém a tupla criada via empacotamento.",
            "pack_unpack_exp_assign": "Atribuição `=`: Atribui valores.",
            "pack_unpack_exp_value": "Valor Empacotado: Um elemento da tupla criada implicitamente.",
            "pack_unpack_exp_comma": "Vírgula `,`: Separa elementos no empacotamento/desempacotamento.",
            "pack_unpack_exp_unpacked_var": "Variável Desempacotada: Recebe um elemento da tupla.",
            "pack_unpack_exp_tuple_name": "Tupla a Desempacotar: A tupla existente cujos elementos são atribuídos.",
            "feedback_pack_unpack_anatomy_correct": "Ótimo! Você identificou a sintaxe de empacotamento e desempacotamento.",
            "pack_unpack_desc_challenge": "Desafio: Dada `dados = (\"Alfa\", 101, True)`, escreva o código para desempacotá-la nas variáveis `nome`, `id_num` e `status`.",
            "pack_unpack_editor_label": "Código de Desempacotamento:", "pack_unpack_editor_placeholder": "ex: var1, var2, var3 = dados",
            "pack_unpack_button_check": "Verificar Desempacotamento",
            "feedback_unpack_correct": "Excelente! Atribuição de desempacotamento correta.",
            "feedback_unpack_incorrect_vars": "Quase! Certifique-se de usar os nomes exatos das variáveis: `nome, id_num, status`.",
            "feedback_unpack_incorrect_syntax": "Verifique a sintaxe. Deve ser `var1, var2, var3 = nome_da_tupla`.",
            "feedback_unpack_empty": "Insira o código de desempacotamento.",
            // Activity 2: Methods
            "methods_title": "Métodos de Tupla: .index() & .count()", "methods_desc": "Tuplas têm poucos métodos por serem imutáveis. Dois úteis são `.index(valor)` (encontra a primeira ocorrência) e `.count(valor)` (conta ocorrências). Experimente!",
            "methods_demo_tuple": "Tupla Exemplo: `itens = ('A', 1, 'B', 2, 'A', 3, 'A')`",
            "methods_button_index": "Achar Índice de 'B'", "methods_button_count": "Contar Ocorrências de 'A'",
            "methods_output_label": "Resultado Simulado:", "methods_output_placeholder": "O resultado aparecerá aqui...",
            "feedback_methods_index_success": "Correto! `itens.index('B')` retorna `2` (o índice do primeiro 'B').",
            "feedback_methods_count_success": "Correto! `itens.count('A')` retorna `3` ('A' aparece 3 vezes).",
            // Activity 3: Nested & Slicing
            "nested_slicing_title": "Tuplas Aninhadas & Fatiamento", "nested_slicing_desc": "Tuplas podem conter outras tuplas! Acesse elementos aninhados usando múltiplos índices. Fatiamento (`[inicio:fim]`) funciona como listas, criando uma *nova* tupla.",
            "nested_slicing_code_comment": "# Acessa o número 3",
            "nested_slicing_challenge_desc": "Desafio: Dada `alfabeto = ('a', 'b', 'c', 'd', 'e', 'f')`, escreva código para obter uma nova tupla contendo `('c', 'd', 'e')` usando fatiamento.",
            "nested_slicing_editor_label": "Código de Fatiamento:", "nested_slicing_editor_placeholder": "ex: alfabeto[1:4]",
            "nested_slicing_button_check": "Simular Fatia", "nested_slicing_output_label": "Saída Simulada:", "nested_slicing_output_placeholder": "A tupla fatiada aparecerá aqui...",
            "feedback_slice_correct": "Fatia perfeita! Resultado: `('c', 'd', 'e')`",
            "feedback_slice_incorrect": "Não é a fatia correta. Lembre-se do índice 2 até (mas não incluindo) o índice 5.",
            "feedback_slice_syntax": "Verifique a sintaxe de fatiamento: `tupla[inicio:fim]`.",
            "feedback_slice_empty": "Insira o código de fatiamento.",
            // Activity 4: Action
            "action_title": "Tuplas em Ação: Retorno de Funções", "action_desc": "Um padrão comum em Python é retornar múltiplos valores de uma função usando uma tupla. O desempacotamento torna o acesso a esses resultados limpo e fácil.",
            "action_scenario": "Cenário: Imagine uma função `get_coordenadas()` que retorna uma tupla `(x, y, z)`.",
            "action_challenge_desc": "Desafio: Escreva o código para desempacotar a tupla `resultado` nas variáveis `pos_x`, `pos_y` e `pos_z`.",
            "action_editor_label": "Código de Desempacotamento:", "action_editor_placeholder": "var1, var2, var3 = resultado",
            "action_button_check": "Verificar Desempacotamento",
            "feedback_action_unpack_correct": "Excelente! Você desempacotou corretamente a tupla retornada.",
            "feedback_action_unpack_incorrect_vars": "Quase! Use os nomes exatos das variáveis: `pos_x, pos_y, pos_z`.",
            "feedback_action_unpack_incorrect_syntax": "Verifique a sintaxe: `var1, var2, var3 = nome_da_tupla`.",
            "feedback_action_unpack_empty": "Insira o código de desempacotamento.",
            // Activity 5: Missions
            "missions_title": "Mini Missões Avançadas!", "missions_desc": "Combine suas habilidades avançadas com tuplas para completar estas tarefas.",
            "mission1_title": "Missão 1: Empacotar & Desempacotar Coords", "mission1_desc": "Use empacotamento de tupla para criar uma tupla `local` com os valores \"Prefeitura\" e 123. Então, desempacote `local` nas variáveis `lugar` e `num_end`. Imprima ambas as variáveis.", "mission1_placeholder": "local = \"Prefeitura\", 123\nlugar, num_end = local\nprint(lugar)\nprint(num_end)",
            "button_test_mission_1": "Testar Missão 1",
            "mission2_title": "Missão 2: Achar e Contar", "mission2_desc": "Crie uma tupla `notas = ('B', 'A', 'C', 'A', 'B', 'A')`. Primeiro, imprima quantas vezes 'A' aparece usando `.count()`. Segundo, imprima o índice do *primeiro* 'B' usando `.index()`.", "mission2_placeholder": "notas = (...)\nprint(notas.count(...))\nprint(notas.index(...))",
            "button_test_mission_2": "Testar Missão 2",
            "mission3_title": "Missão 3: Acesso Aninhado & Fatiamento", "mission3_desc": "Crie `agenda = ((\"Seg\", \"Ter\"), (\"Qua\", \"Qui\"), (\"Sex\",))`. Primeiro, acesse e imprima \"Qui\". Segundo, crie e imprima uma *fatia* contendo as duas primeiras tuplas internas `((\"Seg\", \"Ter\"), (\"Qua\", \"Qui\"))`.", "mission3_placeholder": "agenda = (...)\nprint(agenda[?][?])\nprint(agenda[?:?])",
            "button_test_mission_3": "Testar Missão 3",
            "feedback_mission_success": "Missão Cumprida!", "feedback_mission_syntax_error": "Erro de sintaxe/lógica no código.",
            "feedback_mission1_hint": "Use empacotamento `var = val1, val2`, desempacotamento `v1, v2 = var`, e `print()`.",
            "feedback_mission2_hint": "Crie `notas = (...)`. Use `print(notas.count('A'))` e `print(notas.index('B'))`.",
            "feedback_mission3_hint": "Crie `agenda = (...)`. Use `print(agenda[1][1])` para 'Qui' e `print(agenda[0:2])` para a fatia.",
            "feedback_missions_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Excelente!", "feedback_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões. Continue!",
            // Completion
            "completion_title": "Prática Avançada do Módulo 22 Completa!", "completion_desc": "Ótimo trabalho com esses conceitos avançados de tuplas! Você está se tornando proficiente. <br> Revise a prática básica ou assista à videoaula se precisar, ou avance para o próximo módulo!",
            "button_basic_practice": "Revisar Prática Básica", "button_video": "Ver Videoaula", "button_back_menu": "Voltar ao Menu"
        },
        zh: {
            "page_title": "模块 22：高级元组练习",
            "tooltip_click_identify": "点击识别此部分",
            "nav_basic_practice": "基础练习", "nav_video": "观看视频课程", "nav_menu": "课程菜单", // 更新导航
            "nav_packing": "打包/解包", "nav_methods": "方法", "nav_nested_slicing": "嵌套与切片", "nav_action": "实际应用", "nav_missions": "任务", // 活动导航
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 22：高级元组练习", "header_subtitle": "深入探讨：元组的打包、解包、方法、嵌套和切片。",
            // Activity 1: Packing/Unpacking
            "pack_unpack_title": "元组打包与解包",
            "pack_unpack_desc_anatomy": "Python 允许不使用 `()` 创建元组（打包）并将元组元素直接分配给变量（解包）。点击各部分来理解。",
            "pack_unpack_code_comment1": "# 打包（圆括号可选）", "pack_unpack_code_comment2": "# 解包（将元组元素分配给变量）",
            "pack_unpack_status_initial": "识别所有 8 个部分！", "pack_unpack_status_progress": "已识别 {count} / {total} 个部分。", "pack_unpack_status_done": "所有部分已识别！",
            "pack_unpack_exp_var": "打包的元组变量：持有通过打包创建的元组。",
            "pack_unpack_exp_assign": "赋值 `=`：分配值。",
            "pack_unpack_exp_value": "打包的值：隐式创建的元组的一个元素。",
            "pack_unpack_exp_comma": "逗号 `,`：在打包/解包中分隔元素。",
            "pack_unpack_exp_unpacked_var": "解包的变量：接收元组中的一个元素。",
            "pack_unpack_exp_tuple_name": "要解包的元组：其元素被分配的现有元组。",
            "feedback_pack_unpack_anatomy_correct": "很好！你识别了打包和解包的语法。",
            "pack_unpack_desc_challenge": "挑战：给定 `data = (\"Alpha\", 101, True)`，编写代码将其解包到变量 `name`、`id_num` 和 `status` 中。",
            "pack_unpack_editor_label": "解包代码：", "pack_unpack_editor_placeholder": "例如：var1, var2, var3 = data",
            "pack_unpack_button_check": "检查解包",
            "feedback_unpack_correct": "太棒了！正确的解包赋值。",
            "feedback_unpack_incorrect_vars": "差不多！请确保使用确切的变量名：`name, id_num, status`。",
            "feedback_unpack_incorrect_syntax": "检查语法。应该是 `var1, var2, var3 = tuple_name`。",
            "feedback_unpack_empty": "请输入解包代码。",
            // Activity 2: Methods
            "methods_title": "元组方法：.index() 和 .count()", "methods_desc": "由于元组是不可变的，所以它们的方法很少。两个有用的方法是 `.index(value)`（查找首次出现的位置）和 `.count(value)`（计算出现次数）。试一试吧！",
            "methods_demo_tuple": "演示元组：`items = ('A', 1, 'B', 2, 'A', 3, 'A')`",
            "methods_button_index": "查找 'B' 的索引", "methods_button_count": "计算 'A' 的出现次数",
            "methods_output_label": "模拟结果：", "methods_output_placeholder": "结果将显示在此处...",
            "feedback_methods_index_success": "正确！`items.index('B')` 返回 `2`（第一个 'B' 的索引）。",
            "feedback_methods_count_success": "正确！`items.count('A')` 返回 `3`（'A' 出现了 3 次）。",
            // Activity 3: Nested & Slicing
            "nested_slicing_title": "嵌套元组与切片", "nested_slicing_desc": "元组可以包含其他元组！使用多个索引访问嵌套元素。切片（`[start:end]`）与列表类似，但会创建一个*新*元组。",
            "nested_slicing_code_comment": "# 访问数字 3",
            "nested_slicing_challenge_desc": "挑战：给定 `alphabet = ('a', 'b', 'c', 'd', 'e', 'f')`，编写代码使用切片获取包含 `('c', 'd', 'e')` 的新元组。",
            "nested_slicing_editor_label": "切片代码：", "nested_slicing_editor_placeholder": "例如：alphabet[1:4]",
            "nested_slicing_button_check": "模拟切片", "nested_slicing_output_label": "模拟输出：", "nested_slicing_output_placeholder": "切片后的元组将显示在此处...",
            "feedback_slice_correct": "完美切片！结果：`('c', 'd', 'e')`",
            "feedback_slice_incorrect": "切片不太对。请记住是从索引 2 开始，直到（但不包括）索引 5。",
            "feedback_slice_syntax": "检查切片语法：`tuple_name[start:end]`。",
            "feedback_slice_empty": "请输入切片代码。",
            // Activity 4: Action
            "action_title": "元组的实际应用：函数返回值", "action_desc": "Python 的一个常见模式是使用元组从函数返回多个值。解包使得访问这些结果干净利落。",
            "action_scenario": "场景：假设一个函数 `get_coordinates()` 返回一个元组 `(x, y, z)`。",
            "action_challenge_desc": "挑战：编写代码将 `result` 元组解包到变量 `pos_x`、`pos_y` 和 `pos_z` 中。",
            "action_editor_label": "解包代码：", "action_editor_placeholder": "var1, var2, var3 = result",
            "action_button_check": "检查解包",
            "feedback_action_unpack_correct": "太棒了！你正确地解包了返回的元组。",
            "feedback_action_unpack_incorrect_vars": "差不多！请使用确切的变量名：`pos_x, pos_y, pos_z`。",
            "feedback_action_unpack_incorrect_syntax": "检查语法：`var1, var2, var3 = tuple_name`。",
            "feedback_action_unpack_empty": "请输入解包代码。",
            // Activity 5: Missions
            "missions_title": "高级迷你任务！", "missions_desc": "结合你所学的高级元组技能完成这些任务。",
            "mission1_title": "任务 1：打包和解包坐标", "mission1_desc": "使用元组打包创建一个 `location` 元组，包含值 \"市政厅\" 和 123。然后，将 `location` 解包到 `place` 和 `address_num` 变量中。打印这两个变量。", "mission1_placeholder": "location = \"市政厅\", 123\nplace, address_num = location\nprint(place)\nprint(address_num)",
            "button_test_mission_1": "测试任务 1",
            "mission2_title": "任务 2：查找和计数", "mission2_desc": "创建一个元组 `grades = ('B', 'A', 'C', 'A', 'B', 'A')`。首先，使用 `.count()` 打印 'A' 出现的次数。其次，使用 `.index()` 打印*第一个* 'B' 的索引。", "mission2_placeholder": "grades = (...)\nprint(grades.count(...))\nprint(grades.index(...))",
            "button_test_mission_2": "测试任务 2",
            "mission3_title": "任务 3：嵌套访问与切片", "mission3_desc": "创建 `schedule = ((\"周一\", \"周二\"), (\"周三\", \"周四\"), (\"周五\",))`。首先，访问并打印 \"周四\"。其次，创建并打印一个包含前两个内部元组 `((\"周一\", \"周二\"), (\"周三\", \"周四\"))` 的*切片*。", "mission3_placeholder": "schedule = (...)\nprint(schedule[?][?])\nprint(schedule[?:?])",
            "button_test_mission_3": "测试任务 3",
            "feedback_mission_success": "任务完成！", "feedback_mission_syntax_error": "代码中存在语法/逻辑错误。",
            "feedback_mission1_hint": "使用打包 `var = val1, val2`，解包 `v1, v2 = var`，以及 `print()`。",
            "feedback_mission2_hint": "创建 `grades = (...)`。使用 `print(grades.count('A'))` 和 `print(grades.index('B'))`。",
            "feedback_mission3_hint": "创建 `schedule = (...)`。使用 `print(schedule[1][1])` 获取 '周四'，使用 `print(schedule[0:2])` 获取切片。",
            "feedback_missions_summary_all_done": "所有 {totalMissions} 个高级任务已完成！太棒了！", "feedback_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个任务。继续努力！",
            // Completion
            "completion_title": "模块 22 高级练习完成！", "completion_desc": "出色地完成了这些高级元组概念！你越来越熟练了。<br> 如果需要，可以回顾基础练习或观看视频课程，或者继续学习下一个模块！",
            "button_basic_practice": "回顾基础练习", "button_video": "观看视频课程", "button_back_menu": "返回课程菜单" // 更新按钮
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Identical) ---
        function getStoredLanguage() { /* ... identical ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
         }
        function setLanguage(lang) { /* ... identical, but calls new setup functions ... */
            if (!translations[lang]) lang = 'en';
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             // Re-initialize or update language-dependent interactive content for ADVANCED page
             if (packingUnpackingAnatomySection) setupPackingUnpackingAnatomy(); // Act 1 Anatomy
             if (packingUnpackingChallengeSection) setupPackingUnpackingChallenge(); // Act 1 Challenge
             if (tupleMethodsSection) setupTupleMethods(); // Act 2
             if (nestedSlicingSection) setupNestedSlicingChallenge(); // Act 3
             if (tuplesInActionSection) setupTuplesInActionChallenge(); // Act 4
             if (missionsSection && typeof updateMissionSummary === 'function') updateMissionSummary(); // Act 5
        }
        function getTranslation(key, lang, replacements = {}) { /* ... identical ... */
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }
        function translatePage(lang) { /* ... identical ... */
             if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Skip */ }
                 else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else {
                     if (translation.includes('<') && translation.includes('>')) el.innerHTML = translation;
                     else el.textContent = translation;
                 }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });
        }
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Identical) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle'); /* ... identical ... */
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => {
                event.stopPropagation(); body.classList.toggle('nav-active');
                navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
             });
            document.addEventListener('click', (event) => {
                if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) {
                    body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false');
                }
             });
            navPanel.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); });
             });
             document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }
             });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Identical) ---
        const langSelect = document.getElementById('languageSelect'); /* ... identical ... */
        if (langSelect) { langSelect.addEventListener('change', (e) => setLanguage(e.target.value)); }

        // --- Helper Function for Feedback (Identical) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) { /* ... identical ... */
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             if (translatedMessage.includes('<') && translatedMessage.includes('>')) feedbackEl.innerHTML = translatedMessage;
             else feedbackEl.textContent = translatedMessage;
            feedbackEl.className = 'feedback-message'; // Reset classes
            feedbackEl.classList.add('visible', type);
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') interactiveArea.classList.add('success-glow-anim');
            else if (type === 'incorrect') interactiveArea.classList.add('shake-anim');
        }

        // --- Activity 1: Packing & Unpacking ---
        const packingUnpackingAnatomySection = document.getElementById('packing-unpacking-anatomy');
        let packingUnpackingExplanations = {};
        const totalPackingUnpackingParts = 8; // Updated count
        let currentPackingUnpackingListeners = [];

        function setupPackingUnpackingAnatomy() { // Renamed function
            if (!packingUnpackingAnatomySection) return;
            const anatomyCode = packingUnpackingAnatomySection.querySelector('.code-block');
            if (!anatomyCode) return;

            const currentLang = getStoredLanguage();
            packingUnpackingExplanations = {};
             document.querySelectorAll('#explanation-texts-pack-unpack span[data-key]').forEach(span => { // Use new explanation div ID
                const key = span.getAttribute('data-key');
                packingUnpackingExplanations[key] = getTranslation(`pack_unpack_exp_${key}`, currentLang); // Use prefix
             });

            const parts = anatomyCode.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('packing-unpacking-explanations'); // Use new ID
            const statusP = document.getElementById('packing-unpacking-status'); // Use new ID
            const feedbackDiv = document.getElementById('packing-unpacking-feedback'); // Use new ID
            let identifiedCount = 0;

            currentPackingUnpackingListeners.forEach(({element, listener}) => element.removeEventListener('click', listener));
            currentPackingUnpackingListeners = [];

            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.innerHTML = getTranslation('pack_unpack_status_initial', currentLang, { total: totalPackingUnpackingParts });
            feedbackDiv.classList.remove('visible');

            parts.forEach(part => {
                const clickListener = () => {
                    const partType = part.dataset.part;
                    if (!part.classList.contains('identified') && partType && packingUnpackingExplanations[partType]) {
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        // ... (icon/strong/text creation identical to previous anatomy) ...
                         const icon = document.createElement('i'); icon.className = 'fas fa-check-circle'; icon.style.color = 'var(--success-color)';
                         const strong = document.createElement('strong');
                         const displayedTextElement = part.querySelector('span[class^="code-"]');
                         strong.textContent = (displayedTextElement ? displayedTextElement.textContent.trim() : part.textContent.trim()) + ': ';
                         p.appendChild(icon); p.appendChild(strong);
                         p.appendChild(document.createTextNode(packingUnpackingExplanations[partType]));
                        explanationsDiv.appendChild(p);
                        statusP.innerHTML = getTranslation('pack_unpack_status_progress', currentLang, { count: identifiedCount, total: totalPackingUnpackingParts });
                        if (identifiedCount === totalPackingUnpackingParts) {
                            statusP.innerHTML = getTranslation('pack_unpack_status_done', currentLang);
                            showFeedback('packing-unpacking-feedback', 'feedback_pack_unpack_anatomy_correct', 'correct');
                        }
                    }
                };
                part.addEventListener('click', clickListener);
                currentPackingUnpackingListeners.push({ element: part, listener: clickListener });
            });
        }

        // Activity 1 - Challenge Part
        const packingUnpackingChallengeSection = packingUnpackingAnatomySection; // Part of the same section
        function setupPackingUnpackingChallenge() {
            if (!packingUnpackingChallengeSection) return;
            const editor = document.getElementById('unpack-editor-input');
            const checkBtn = document.getElementById('check-unpack-btn');
            const feedbackDiv = document.getElementById('unpack-feedback');

            if (editor) editor.value = ''; // Clear editor on setup/language change
            if (feedbackDiv) feedbackDiv.classList.remove('visible');

            if (checkBtn) {
                checkBtn.onclick = () => { // Use onclick for simplicity or manage event listeners carefully
                    const code = editor.value.trim();
                    feedbackDiv.classList.remove('visible');
                    // Regex to match: name, id_num, status = data (allowing for whitespace variations)
                    const correctUnpackRegex = /^\s*name\s*,\s*id_num\s*,\s*status\s*=\s*data\s*$/;

                    if (!code) {
                        showFeedback('unpack-feedback', 'feedback_unpack_empty', 'info');
                    } else if (correctUnpackRegex.test(code)) {
                        showFeedback('unpack-feedback', 'feedback_unpack_correct', 'correct');
                    } else if (code.includes(',') && code.includes('=') && code.includes('data')) {
                        // Might be syntactically close but wrong variable names
                        showFeedback('unpack-feedback', 'feedback_unpack_incorrect_vars', 'incorrect');
                    } else {
                        showFeedback('unpack-feedback', 'feedback_unpack_incorrect_syntax', 'incorrect');
                    }
                };
            }
        }


        // --- Activity 2: Tuple Methods ---
        const tupleMethodsSection = document.getElementById('tuple-methods-demo');
        function setupTupleMethods() {
            if (!tupleMethodsSection) return;
            const indexBtn = document.getElementById('run-index-btn');
            const countBtn = document.getElementById('run-count-btn');
            const outputArea = document.getElementById('methods-output');
            const feedbackDiv = document.getElementById('methods-feedback');
            const placeholder = outputArea.querySelector('.placeholder');

            // Reset output and feedback on setup/language change
            outputArea.innerHTML = '';
            outputArea.appendChild(placeholder); // Re-add placeholder
            placeholder.textContent = getTranslation('methods_output_placeholder', getStoredLanguage()); // Translate placeholder
            feedbackDiv.classList.remove('visible');

            if (indexBtn) {
                indexBtn.onclick = () => {
                    outputArea.innerHTML = '<span class="output-line success">> 2</span>'; // Hardcoded result for demo
                    showFeedback('methods-feedback', 'feedback_methods_index_success', 'correct');
                };
            }
            if (countBtn) {
                countBtn.onclick = () => {
                    outputArea.innerHTML = '<span class="output-line success">> 3</span>'; // Hardcoded result for demo
                    showFeedback('methods-feedback', 'feedback_methods_count_success', 'correct');
                };
            }
        }


        // --- Activity 3: Nested Tuples & Slicing ---
        const nestedSlicingSection = document.getElementById('nested-slicing-challenge');
        function setupNestedSlicingChallenge() {
            if (!nestedSlicingSection) return;
            const editor = document.getElementById('slice-editor-input');
            const checkBtn = document.getElementById('run-slice-btn');
            const outputArea = document.getElementById('slice-output');
            const feedbackDiv = document.getElementById('slice-feedback');
            const placeholder = outputArea.querySelector('.placeholder');

            if (editor) editor.value = '';
            if (feedbackDiv) feedbackDiv.classList.remove('visible');
            // Reset output
            outputArea.innerHTML = '';
            outputArea.appendChild(placeholder);
            placeholder.textContent = getTranslation('nested_slicing_output_placeholder', getStoredLanguage());


            if (checkBtn) {
                checkBtn.onclick = () => {
                    const code = editor.value.trim();
                    feedbackDiv.classList.remove('visible');
                     // Regex to match: alphabet[2:5] (allowing whitespace)
                    const correctSliceRegex = /^\s*alphabet\s*\[\s*2\s*:\s*5\s*\]\s*$/;

                    if (!code) {
                         outputArea.innerHTML = ''; outputArea.appendChild(placeholder); // Show placeholder
                        showFeedback('slice-feedback', 'feedback_slice_empty', 'info');
                    } else if (correctSliceRegex.test(code)) {
                        outputArea.innerHTML = '<span class="output-line success">> (\'c\', \'d\', \'e\')</span>'; // Show result
                        showFeedback('slice-feedback', 'feedback_slice_correct', 'correct');
                    } else if (code.includes('alphabet') && code.includes('[') && code.includes(':') && code.includes(']')) {
                        outputArea.innerHTML = ''; outputArea.appendChild(placeholder);
                        showFeedback('slice-feedback', 'feedback_slice_incorrect', 'incorrect');
                    } else {
                        outputArea.innerHTML = ''; outputArea.appendChild(placeholder);
                        showFeedback('slice-feedback', 'feedback_slice_syntax', 'incorrect');
                    }
                };
            }
        }

        // --- Activity 4: Tuples in Action ---
        const tuplesInActionSection = document.getElementById('tuples-in-action');
        function setupTuplesInActionChallenge() {
            if (!tuplesInActionSection) return;
            const editor = document.getElementById('return-unpack-editor-input');
            const checkBtn = document.getElementById('check-return-unpack-btn');
            const feedbackDiv = document.getElementById('return-unpack-feedback');

            if(editor) editor.value = '';
            if(feedbackDiv) feedbackDiv.classList.remove('visible');

            if (checkBtn) {
                 checkBtn.onclick = () => {
                     const code = editor.value.trim();
                     feedbackDiv.classList.remove('visible');
                     // Regex: pos_x, pos_y, pos_z = result
                     const correctUnpackRegex = /^\s*pos_x\s*,\s*pos_y\s*,\s*pos_z\s*=\s*result\s*$/;

                    if (!code) {
                        showFeedback('return-unpack-feedback', 'feedback_action_unpack_empty', 'info');
                    } else if (correctUnpackRegex.test(code)) {
                        showFeedback('return-unpack-feedback', 'feedback_action_unpack_correct', 'correct');
                    } else if (code.includes(',') && code.includes('=') && code.includes('result')) {
                        showFeedback('return-unpack-feedback', 'feedback_action_unpack_incorrect_vars', 'incorrect');
                    } else {
                        showFeedback('return-unpack-feedback', 'feedback_action_unpack_incorrect_syntax', 'incorrect');
                    }
                 };
            }
        }

        // --- Activity 5: Mini Missions (Advanced) ---
        const missionsSection = document.getElementById('mini-missions');
        let updateMissionSummary; // Define function scope
        if (missionsSection) {
            const missionRunButtons = missionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('missions-summary-feedback');
            const totalMissions = missionsSection.querySelectorAll('.mission').length;
            let completedMissionsCount = 0;

            updateMissionSummary = function() { /* ... identical to basic practice ... */
                 completedMissionsCount = missionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('missions-summary-feedback', 'feedback_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('missions-summary-feedback', 'feedback_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible');
                 }
             };

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`mission-${missionId}`);
                    if (!missionDiv) return;
                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-feedback-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    if (!feedbackDiv) return;
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim().replace(/\r\n/g, '\n');
                    const lines = code.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#')); // Get non-empty, non-comment lines

                    outputArea.innerHTML = ''; // Clear previous output
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error';
                    let feedbackType = 'incorrect';
                    let specificHintKey = '';
                    let simulatedOutput = []; // To store simulated print outputs

                     /* Validation Logic (Advanced Tuple Focused) */
                     try {
                         if (missionId === '1') { // Pack, unpack, print unpacked
                             const packRegex = /^\s*location\s*=\s*".*"\s*,\s*\d+\s*$/; // location = "str", num
                             const unpackRegex = /^\s*place\s*,\s*address_num\s*=\s*location\s*$/; // place, address_num = location
                             const print1Regex = /^\s*print\s*\(\s*place\s*\)\s*$/;
                             const print2Regex = /^\s*print\s*\(\s*address_num\s*\)\s*$/;
                             if (lines.length >= 4 && packRegex.test(lines[0]) && unpackRegex.test(lines[1]) && print1Regex.test(lines[2]) && print2Regex.test(lines[3])) {
                                 success = true;
                                 // Simulate output
                                 const match = lines[0].match(/=\s*(".*")\s*,\s*(\d+)/);
                                 if(match) simulatedOutput = [`> ${match[1]}`, `> ${match[2]}`];
                             } else { specificHintKey = 'feedback_mission1_hint'; }
                         }
                         else if (missionId === '2') { // Create, print count, print index
                             const defineRegex = /^\s*grades\s*=\s*\((['"](A|B|C)['"]\s*,\s*){5}['"](A|B|C)['"]\s*\)\s*$/i; // Check general tuple structure
                             const countRegex = /^\s*print\s*\(\s*grades\.count\s*\(\s*['"]A['"]\s*\)\s*\)\s*$/i;
                             const indexRegex = /^\s*print\s*\(\s*grades\.index\s*\(\s*['"]B['"]\s*\)\s*\)\s*$/i;
                             if (lines.length >= 3 && defineRegex.test(lines[0]) && countRegex.test(lines[1]) && indexRegex.test(lines[2])) {
                                 success = true;
                                 simulatedOutput = [`> 3`, `> 0`]; // Based on 'B', 'A', 'C', 'A', 'B', 'A'
                             } else { specificHintKey = 'feedback_mission2_hint'; }
                         }
                          else if (missionId === '3') { // Nested access and slicing
                             const defineRegex = /^\s*schedule\s*=\s*\(\s*\(\s*".*?"\s*,\s*".*?"\s*\)\s*,\s*\(\s*".*?"\s*,\s*".*?"\s*\)\s*,\s*\(\s*".*?"\s*,\s*\)\s*\)\s*$/; // schedule = (("s","s"),("s","s"),("s",))
                             const accessRegex = /^\s*print\s*\(\s*schedule\s*\[\s*1\s*\]\s*\[\s*1\s*\]\s*\)\s*$/; // print(schedule[1][1])
                             const sliceRegex = /^\s*print\s*\(\s*schedule\s*\[\s*0\s*:\s*2\s*\]\s*\)\s*$/; // print(schedule[0:2])
                              if (lines.length >= 3 && defineRegex.test(lines[0]) && accessRegex.test(lines[1]) && sliceRegex.test(lines[2])) {
                                 success = true;
                                 // Extract "Thu" if possible, otherwise hardcode expected
                                 const accessMatch = lines[0].match(/\(\s*".*?"\s*,\s*"(.*?)"\s*\)/g); // Get inner tuples
                                 const thu = accessMatch && accessMatch.length > 1 ? accessMatch[1].match(/"(.*?)"/)[1] : "Thu"; // Get 2nd element of 2nd inner tuple
                                 simulatedOutput = [`> ${thu}`, `> ((${lines[0].match(/\(\s*".*?"\s*,\s*".*?"\s*\)/)[0]}), (${accessMatch[1]}))`]; // Show Thu and the slice
                             } else { specificHintKey = 'feedback_mission3_hint'; }
                         }
                     } catch (error) { console.error("Mission validation error:", error); specificHintKey = 'feedback_mission_syntax_error'; }
                    /* End Validation */

                     outputArea.innerHTML = simulatedOutput.map(line => `<span class="output-line">${line}</span>`).join(''); // Display simulated output

                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey;
                        feedbackType = 'incorrect';
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                    }
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    updateMissionSummary(); // Update overall progress
                });
            });
            updateMissionSummary(); // Initial call
        }

        // --- Fade-in animations on scroll (Identical) ---
        const fadeElements = document.querySelectorAll('.fade-in'); /* ... identical ... */
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return;
                 const rect = el.getBoundingClientRect();
                 if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                     el.style.opacity = '1'; el.style.transform = 'translateY(0)';
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);


        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST
        animateOnScroll(); // Trigger initial animation check AFTER language is set

        // Redundant calls removed as they are now inside setLanguage

    }); // End DOMContentLoaded
    </script>

</body>
</html>