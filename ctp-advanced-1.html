<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 1: Advanced Practice</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Identical to ctp-practice-1.html) --- */
        :root {
            --primary-color: #007bff; /* Keeping Blue as primary */
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --type-int-color: #17a2b8; /* Teal for int */
            --type-float-color: #fd7e14; /* Orange for float */
            --type-str-color: #d63384;  /* Pink for string */
            --assignment-color: #6f42c1; /* Purple for assignment */
            --variable-color: #0dcaf0; /* Light blue for variable names */
            --conversion-color: #20c997; /* Teal/Green for conversion functions */

            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            /* Colors matching news.html for consistency in switcher potentially */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Identical) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { /* For navigation buttons */
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
        }

        /* --- Advanced Animations (Identical) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon {
            0% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
            50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); }
            100% { transform: scale(1); opacity: 0.1; filter: brightness(1); }
        }
        @keyframes successGlow {
             0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
             50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); }
             100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); }
        }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); }
        }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            60% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearIncorrect {
             0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
             50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
             70% { transform: scale(0.9) rotate(-5deg); }
             100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes iconAppearMissed { /* Reuse for Type Spotting */
             0% { transform: scale(0.8) rotateY(90deg); opacity: 0; }
             100% { transform: scale(1) rotateY(0deg); opacity: 0.8; }
        }
        .action-button:active:not(:disabled) {
            transform: translateY(1px) scale(0.98);
            filter: brightness(0.95);
        }


        /* --- Minimal Retractable Nav (Identical Structure, Links will Change) --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001;
            background-color: rgba(52, 58, 64, 0.75); color: var(--text-light);
            border: none; border-radius: var(--border-radius); padding: 8px 12px;
            cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000;
            background-color: var(--background-dark); border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem;
            opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right;
            pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            min-width: 200px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light); text-decoration: none;
            padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white;
            border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px;
            cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto;
            transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }
        /* --- End Minimal Retractable Nav --- */


        /* --- Practice Header (Style Identical, Content Changes) --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        /* --- UPDATED Icons for Advanced Feel --- */
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* Keep Memory */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* Change to Code/Branch */

        /* --- Practice Section Styling (Identical) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Identical) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button {
             display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none; /* For <a> tags styled as buttons */
        }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        /* Code styling (Identical Base) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } /* E.g., print */
        .code-string { color: var(--type-str-color); } /* Pinkish */
        .code-comment { color: #6a9955; } /* Green */
        .code-number { color: #b5cea8; } /* Light green/number color */
        .code-variable { color: var(--variable-color); } /* Light Blue */
        .code-operator { color: var(--assignment-color); } /* Purple */
        .code-function { color: #dcdcaa; } /* Yellowish (for type(), print()) */
        .code-paren { color: #ffd700; } /* Gold */
        /* --- NEW: Style for conversion functions --- */
        .code-conversion { color: var(--conversion-color); font-weight: bold;} /* Teal/Green */

        /* --- Activity 1: Type Conversion Challenge --- */
        #type-conversion .scenario { margin-bottom: 1.5rem; background: var(--background-medium); padding: 1rem; border-radius: var(--border-radius); border-left: 4px solid var(--info-color);}
        #type-conversion .conversion-options button {
             margin: 0.5rem; padding: 0.6rem 1.2rem; font-size: 1rem; font-weight: bold;
             border: none; border-radius: var(--border-radius); cursor: pointer;
             transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
             background-color: var(--secondary-color); color: white; min-width: 80px;
             box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        #type-conversion .conversion-options button:hover:not(:disabled) { filter: brightness(1.1); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
        #type-conversion .conversion-options button:active:not(:disabled) { transform: scale(0.97); }
        #type-conversion .conversion-options button:disabled { opacity: 0.6; cursor: not-allowed; filter: grayscale(50%); }
        #type-conversion .conversion-options button.selected { background-color: var(--primary-color); }
        /* Specific styling for function buttons */
        #type-conversion .conversion-options button[data-func="int()"] { background-color: var(--type-int-color); }
        #type-conversion .conversion-options button[data-func="float()"] { background-color: var(--type-float-color); }
        #type-conversion .conversion-options button[data-func="str()"] { background-color: var(--type-str-color); }
        #type-conversion .conversion-options button[data-func="int()"]:hover:not(:disabled) { background-color: #138496;}
        #type-conversion .conversion-options button[data-func="float()"]:hover:not(:disabled) { background-color: #e06f0f;}
        #type-conversion .conversion-options button[data-func="str()"]:hover:not(:disabled) { background-color: #c42a77;}


        /* --- Activity 2: String Concatenation Simulator --- */
        #string-concat .sim-editor { width: 100%; min-height: 70px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-bottom: 1rem;}
        #string-concat .sim-output-area { margin-top: 1rem; min-height: 40px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #string-concat .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #string-concat .sim-output-area .output-line { display: block; color: var(--text-light);} /* Normal output color */
        #string-concat .sim-output-area .error-line { color: var(--error-color); } /* Error output */


        /* --- Activity 3: Variable Reassignment Prediction --- */
        #reassignment-challenge .code-snippet { margin-bottom: 1.5rem; }
        #reassignment-challenge .prediction-question { font-weight: bold; margin-bottom: 1rem; }
        #reassignment-challenge .prediction-options button {
            display: block; width: 100%; text-align: left;
            padding: 0.8rem 1.2rem; margin-bottom: 0.5rem; font-size: 1rem;
            border: 1px solid var(--background-medium); border-radius: var(--border-radius); cursor: pointer;
            background-color: #fff; color: var(--text-dark);
            transition: background-color var(--transition-speed), border-color var(--transition-speed), transform 0.1s;
        }
        #reassignment-challenge .prediction-options button:hover:not(:disabled) { background-color: var(--background-light); border-color: #ccc; }
        #reassignment-challenge .prediction-options button:active:not(:disabled) { transform: scale(0.99); }
        #reassignment-challenge .prediction-options button.selected { background-color: var(--selection-highlight-bg); border-color: var(--selection-highlight-border); font-weight: bold; }
        #reassignment-challenge .prediction-options button:disabled { opacity: 0.7; cursor: not-allowed; }
         /* Visual feedback for correct/incorrect options after check */
        #reassignment-challenge .prediction-options button.reveal-correct { background-color: #d4edda; border-color: #c3e6cb; color: #155724; font-weight: bold;}
        #reassignment-challenge .prediction-options button.reveal-incorrect { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; opacity: 0.8; text-decoration: line-through;}


        /* --- Activity 4: Naming Convention Check --- */
        #naming-convention .name-options .name-item {
            display: inline-block; padding: 0.6rem 1rem; margin: 5px;
            font-family: var(--code-font); font-size: 1.05rem;
            border: 1px solid #ccc; border-radius: var(--border-radius); cursor: pointer;
            background-color: var(--background-light); transition: all var(--transition-speed);
            user-select: none; -webkit-user-select: none;
        }
        #naming-convention .name-options .name-item:hover { background-color: #e2e6ea; border-color: #aaa;}
        #naming-convention .name-options .name-item.selected-visual { background-color: var(--selection-highlight-bg); border-color: var(--selection-highlight-border); font-weight: bold; }
        #naming-convention .name-options .name-item.correct { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; cursor: default;}
        #naming-convention .name-options .name-item.incorrect { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; text-decoration: line-through; cursor: default; opacity: 0.8;}
        #naming-convention .name-options .name-item.missed { border: 2px dashed var(--accent-color); cursor: default; /* Highlight missed correct one */}
        #naming-convention .name-options .name-item.checked-state { cursor: default; } /* Prevent hover effects after check */
        #reset-naming-btn { margin-left: 10px; }


        /* --- Activity 5: Advanced Mini Missions (Structure identical to previous) --- */
        #advanced-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #advanced-mini-missions .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #advanced-mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--text-light); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
         #advanced-mini-missions .mission-output .error-line { color: var(--error-color); } /* Error output */

        /* --- Final Section (Style Identical, Content/Links Change) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon {
            font-size: 4rem; color: var(--success-color); margin-bottom: 1rem;
            display: inline-block;
            opacity: 0; /* Start hidden for animation */
            animation: iconAppearCorrect 1s ease-out 0.5s forwards; /* Use icon animation */
        }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Identical) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
             #type-conversion .conversion-options button { font-size: 0.9rem; padding: 0.5rem 1rem; }
             #reassignment-challenge .prediction-options button { padding: 0.7rem 1rem; font-size: 0.95rem;}
             #naming-convention .name-options .name-item { font-size: 1rem; padding: 0.5rem 0.8rem; }
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            #string-concat .sim-editor, #string-concat .sim-output-area { font-size: 0.9rem; }
            #advanced-mini-missions .mission-editor { min-height: 90px; font-size: 0.95rem;}
            #advanced-mini-missions .mission-output { font-size: 0.95rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
             .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
             .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
             .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
             .minimal-nav ul li a i.fas { margin-right: 8px; }
             #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
             #type-conversion .conversion-options { text-align: center; }
             #type-conversion .conversion-options button { font-size: 0.85rem; padding: 0.4rem 0.8rem; margin: 0.3rem;}
             #reassignment-challenge .prediction-options button { padding: 0.6rem 1rem; font-size: 0.9rem;}
             #naming-convention .name-options .name-item { font-size: 0.9rem; padding: 0.4rem 0.7rem; }
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle (Identical) ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher & UPDATED Links) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** UPDATED HREFs *** -->
            <li><a href="ctp-practice-1.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_standard_practice">Standard Practice</span></a></li>
            <li><a href="ctp-video-1.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video_lesson">Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** UPDATED Quick Links *** -->
            <li><a href="#type-conversion"><i class="fas fa-exchange-alt fa-fw"></i> <span data-translate="nav_type_conversion">Type Conversion</span></a></li>
            <li><a href="#string-concat"><i class="fas fa-link fa-fw"></i> <span data-translate="nav_string_concat">Concatenation</span></a></li>
            <li><a href="#reassignment-challenge"><i class="fas fa-redo fa-fw"></i> <span data-translate="nav_reassignment">Reassignment</span></a></li>
            <li><a href="#naming-convention"><i class="fas fa-signature fa-fw"></i> <span data-translate="nav_naming">Naming</span></a></li>
            <li><a href="#advanced-mini-missions"><i class="fas fa-tasks fa-fw"></i> <span data-translate="nav_adv_missions">Adv. Missions</span></a></li>
            <!-- Language Switcher Item (Identical) -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header (UPDATED Text & Icons) ========= -->
    <header class="practice-header">
        <!-- *** UPDATED Icons *** -->
        <i class="fas fa-memory header-icon icon1"></i>
        <i class="fas fa-code-branch header-icon icon2"></i>
        <div class="container">
            <!-- *** UPDATED Text *** -->
            <h1 data-translate="header_title">Module 1: Advanced Practice</h1>
            <p data-translate="header_subtitle">Deepen your understanding of types, conversions, and variable manipulation.</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Type Conversion Challenge ========= -->
        <section id="type-conversion" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-exchange-alt"></i> <span data-translate="conversion_title">Type Conversion Challenge</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="conversion_desc">
                     Sometimes you need to change a value's type. Example: combining a number with text requires converting the number to a string first. Which function converts a value to an integer?
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="scenario code-block">
                         <span class="code-variable">user_age_str</span> <span class="code-operator">=</span> <span class="code-string">"25"</span> <span class="code-comment"># Age stored as text</span><br>
                         <span class="code-variable">years_until_next_decade</span> <span class="code-operator">=</span> <span class="code-number">10</span> <span class="code-operator">-</span> <span class="code-comment">???</span>(<span class="code-variable">user_age_str</span>) <span class="code-comment">% 10 # Calculation needs integer</span><br>
                         <span class="code-keyword">print</span>(<span class="code-variable">years_until_next_decade</span>)
                     </div>
                     <p class="text-center" style="margin-bottom: 1rem;" data-translate="conversion_question">Select the function needed to make the calculation work:</p>
                     <div class="conversion-options text-center">
                         <button data-func="int()" data-translate="type_int_func">int()</button>
                         <button data-func="float()" data-translate="type_float_func">float()</button>
                         <button data-func="str()" data-translate="type_str_func">str()</button>
                     </div>
                     <div id="conversion-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: String Concatenation Simulator ========= -->
        <section id="string-concat" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-link"></i> <span data-translate="concat_title">String Concatenation</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="concat_desc">
                     You can combine strings using the `+` operator. To combine strings with other types (like numbers), you must first convert the number to a string using `str()`. Try creating a welcome message below.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="concat-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="concat_editor_label">Task: Create a variable `greeting` by combining the `name` and `visits` variables like "Welcome, Bob! Visits: 5"</label>
                     <div class="code-block" style="font-size: 0.9em; padding: 0.8rem 1rem;">
                         <span class="code-variable">name</span> <span class="code-operator">=</span> <span class="code-string">"Bob"</span><br>
                         <span class="code-variable">visits</span> <span class="code-operator">=</span> <span class="code-number">5</span><br>
                         <span class="code-comment"># Your code below</span>
                     </div>
                     <textarea id="concat-editor-input" class="sim-editor" rows="3" data-translate-placeholder="concat_editor_placeholder" placeholder='e.g., greeting = "Welcome, " + name + "! Visits: " + str(visits)'></textarea>
                     <div class="text-center">
                          <button id="run-concat-btn" class="action-button" data-translate="button_run_code">Run Code</button>
                     </div>
                     <label style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="concat_output_label">Simulated Output (Value of `greeting`):</label>
                     <div id="concat-output" class="sim-output-area">
                         <span class="placeholder" data-translate="concat_output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="concat-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 3: Variable Reassignment Prediction ========= -->
        <section id="reassignment-challenge" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-redo"></i> <span data-translate="reassign_title">Variable Reassignment</span></h2>
                <p class="section-description fade-in delay-1" data-translate="reassign_desc">
                    Variables can be assigned new values, even of different types (dynamic typing)! Predict the *final* output of the code below.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div class="code-snippet code-block">
                         <span class="code-variable">data</span> <span class="code-operator">=</span> <span class="code-number">10</span><br>
                         <span class="code-variable">data</span> <span class="code-operator">=</span> <span class="code-variable">data</span> <span class="code-operator">+</span> <span class="code-number">5</span> <span class="code-comment"># data is now 15</span><br>
                         <span class="code-variable">data</span> <span class="code-operator">=</span> <span class="code-string">"Result: "</span> <span class="code-operator">+</span> <span class="code-conversion">str</span>(<span class="code-variable">data</span>) <span class="code-comment"># data is reassigned to a string</span><br>
                         <span class="code-keyword">print</span>(<span class="code-variable">data</span>)
                    </div>
                    <p class="prediction-question" data-translate="reassign_question">What will be printed?</p>
                    <div id="reassign-options" class="prediction-options">
                        <button data-option="A">15</button>
                        <button data-option="B">"Result: 10"</button>
                        <button data-option="C">"Result: 15"</button>
                        <button data-option="D">Error</button>
                    </div>
                     <div class="text-center">
                          <button id="check-reassign-btn" class="action-button" data-translate="button_check_prediction">Check Prediction</button>
                     </div>
                    <div id="reassign-feedback" class="feedback-message"></div>
                     <!-- Hidden correct answer -->
                     <div id="reassign-correct-answer" style="display: none;">C</div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 4: Naming Convention Quick Check ========= -->
        <section id="naming-convention" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-signature"></i> <span data-translate="naming_title">Variable Naming Conventions</span></h2>
                <p class="section-description fade-in delay-1" data-translate="naming_desc">
                    Python prefers `snake_case` for variable names (lowercase words separated by underscores). Click the variable name(s) below that follow this convention.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="naming-options" class="name-options text-center">
                         <!-- Options generated by JS -->
                    </div>
                     <div class="text-center">
                         <button id="check-naming-btn" class="action-button" data-translate="button_check_selection">Check Selection</button>
                         <button id="reset-naming-btn" class="action-button secondary hidden" data-translate="button_try_again">Try Again</button>
                     </div>
                     <div id="naming-feedback" class="feedback-message"></div>
                     <!-- Hidden data for JS -->
                     <div id="naming-data" style="display: none;">
                        <span data-name="user_input" data-correct="true"></span>
                        <span data-name="totalScore" data-correct="false"></span>
                        <span data-name="MAX_VALUE" data-correct="false"></span> <!-- Often used for constants, but not regular variables -->
                        <span data-name="player_1_score" data-correct="true"></span>
                        <span data-name="1st_place" data-correct="false"></span> <!-- Starts with number -->
                        <span data-name="is_active" data-correct="true"></span>
                     </div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 5: Advanced Mini Missions ========= -->
        <section id="advanced-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-tasks"></i> <span data-translate="adv_missions_title">Advanced Variable Missions</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="adv_missions_desc">
                     Apply your knowledge of types, conversion, and concatenation!
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="adv-mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission1_title">Mission 1: String to Integer Calc</h4>
                         <p data-translate="adv_mission1_desc">Imagine `input()` gives you a string. Convert the `score_str` to an integer, add 10 to it, and store the result in `final_score`. Then print `final_score`.</p>
                          <div class="code-block" style="font-size: 0.9em; padding: 0.8rem 1rem;">
                             <span class="code-variable">score_str</span> <span class="code-operator">=</span> <span class="code-string">"150"</span> <span class="code-comment"># Simulating input</span><br>
                             <span class="code-comment"># Your code below</span>
                         </div>
                         <textarea class="mission-editor" rows="3" data-translate-placeholder="adv_mission1_placeholder" placeholder='final_score = int(score_str) + 10\nprint(final_score)'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_adv_mission_1">Test Mission 1</button> </div>
                         <div class="mission-output"></div>
                         <div id="adv-mission-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="adv-mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission2_title">Mission 2: Formatted Report</h4>
                         <p data-translate="adv_mission2_desc">Create a `report` string using the variables provided. The final string should be exactly: "Sensor: temp_sensor Reading: 22.5 C". Remember to convert the float!</p>
                         <div class="code-block" style="font-size: 0.9em; padding: 0.8rem 1rem;">
                             <span class="code-variable">sensor_name</span> <span class="code-operator">=</span> <span class="code-string">"temp_sensor"</span><br>
                             <span class="code-variable">reading_value</span> <span class="code-operator">=</span> <span class="code-number">22.5</span><br>
                             <span class="code-comment"># Your code below</span>
                         </div>
                         <textarea class="mission-editor" rows="3" data-translate-placeholder="adv_mission2_placeholder" placeholder='report = "Sensor: " + sensor_name + " Reading: " + str(reading_value) + " C"\nprint(report)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_adv_mission_2">Test Mission 2</button> </div>
                         <div class="mission-output"></div>
                         <div id="adv-mission-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="adv-mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission3_title">Mission 3: Reassign and Combine</h4>
                         <p data-translate="adv_mission3_desc">Reassign the `status` variable to the string "Updated". Then, create a `log_entry` string combining the original `item_id` (as a string) and the *new* `status`, like: "ID: 101 Status: Updated". Print the `log_entry`.</p>
                         <div class="code-block" style="font-size: 0.9em; padding: 0.8rem 1rem;">
                             <span class="code-variable">item_id</span> <span class="code-operator">=</span> <span class="code-number">101</span><br>
                             <span class="code-variable">status</span> <span class="code-operator">=</span> <span class="code-string">"Pending"</span><br>
                              <span class="code-comment"># Your code below</span>
                         </div>
                         <textarea class="mission-editor" rows="4" data-translate-placeholder="adv_mission3_placeholder" placeholder='status = "Updated"\nlog_entry = "ID: " + str(item_id) + " Status: " + status\nprint(log_entry)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_adv_mission_3">Test Mission 3</button> </div>
                         <div class="mission-output"></div>
                         <div id="adv-mission-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section (UPDATED Text & Links) ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                     <i class="fas fa-cogs"></i> <i class="fas fa-check-double"></i> <i class="fas fa-brain"></i>
                </div>
                <!-- *** UPDATED Text *** -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Great job solidifying your understanding of types and variables! You handled conversions and reassignments well.<br>
                    Watch the video lesson for more context, or return to the course menu.
                </p>
                <div class="button-group">
                     <!-- *** UPDATED HREFs *** -->
                    <a href="ctp-practice-1.html" class="action-button secondary fade-in delay-3"><i class="fas fa-pencil-alt"></i> <span data-translate="button_standard_practice">Standard Practice</span></a>
                    <a href="ctp-video-1.html" class="action-button success fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_video_lesson">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script (Updated Translations & Logic) ========= -->
    <script>
    // --- Translations Object (Module 1 - Advanced) ---
    const translations = {
        en: {
            "page_title": "Module 1: Advanced Practice",
            "nav_standard_practice": "Standard Practice", "nav_video_lesson": "Video Lesson", "nav_menu": "Course Menu",
            "nav_type_conversion": "Type Conversion", "nav_string_concat": "Concatenation", "nav_reassignment": "Reassignment", "nav_naming": "Naming", "nav_adv_missions": "Adv. Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 1: Advanced Practice", "header_subtitle": "Deepen your understanding of types, conversions, and variable manipulation.",
            "conversion_title": "Type Conversion Challenge", "conversion_desc": "Sometimes you need to change a value's type. Example: combining a number with text requires converting the number to a string first. Which function converts a value to an integer?",
            "conversion_question": "Select the function needed to make the calculation work:",
            "type_int_func": "int()", "type_float_func": "float()", "type_str_func": "str()",
            "feedback_conversion_correct": "Correct! `int()` converts compatible values (like number strings) to integers.",
            "feedback_conversion_incorrect": "Not quite. `int()` is needed here to perform math on the string '25'.",
            "feedback_conversion_select": "Please select a function.",
            "concat_title": "String Concatenation", "concat_desc": "You can combine strings using the `+` operator. To combine strings with other types (like numbers), you must first convert the number to a string using `str()`. Try creating a welcome message below.",
            "concat_editor_label": "Task: Create a variable `greeting` by combining the `name` and `visits` variables like \"Welcome, Bob! Visits: 5\"",
            "concat_editor_placeholder": "e.g., greeting = \"Welcome, \" + name + \"! Visits: \" + str(visits)",
            "button_run_code": "Run Code", "concat_output_label": "Simulated Output (Value of `greeting`):", "concat_output_placeholder": "Output will appear here...",
            "feedback_concat_success": "Excellent! The greeting is formatted correctly.",
            "feedback_concat_missing_str": "Looks like you need to convert the number (`visits`) to a string using `str()` before combining.",
            "feedback_concat_wrong_output": "The final string value isn't quite right. Check spacing and variable order.",
            "feedback_concat_no_assign": "Make sure you assign the result to the `greeting` variable.",
            "feedback_concat_error": "There seems to be a syntax error in your code.",
            "reassign_title": "Variable Reassignment", "reassign_desc": "Variables can be assigned new values, even of different types (dynamic typing)! Predict the *final* output of the code below.",
            "reassign_question": "What will be printed?",
            "button_check_prediction": "Check Prediction",
            "feedback_reassign_correct": "Spot on! The variable `data` was first calculated as 15, then reassigned to the string \"Result: 15\".",
            "feedback_reassign_incorrect": "Not quite. Trace the variable `data` step-by-step. It changes value and type.",
            "feedback_reassign_select": "Please select an option.",
            "naming_title": "Variable Naming Conventions", "naming_desc": "Python prefers `snake_case` for variable names (lowercase words separated by underscores). Click the variable name(s) below that follow this convention.",
            "button_check_selection": "Check Selection", "button_try_again": "Try Again",
            "feedback_naming_correct": "Perfect! You identified all the `snake_case` names.",
            "feedback_naming_incorrect": "Check again. Remember `snake_case` uses lowercase and underscores between words. Avoid starting with numbers or using `CamelCase` for variables.",
            "feedback_naming_hint_incorrect": "{count} incorrect selection(s).",
            "feedback_naming_hint_missed": "{count} missed correct name(s).",
            "feedback_naming_hints_joiner": ", and ",
            "adv_missions_title": "Advanced Variable Missions", "adv_missions_desc": "Apply your knowledge of types, conversion, and concatenation!",
            "adv_mission1_title": "Mission 1: String to Integer Calc", "adv_mission1_desc": "Imagine `input()` gives you a string. Convert the `score_str` to an integer, add 10 to it, and store the result in `final_score`. Then print `final_score`.",
            "adv_mission1_placeholder": "final_score = int(score_str) + 10\\nprint(final_score)",
            "button_test_adv_mission_1": "Test Mission 1",
            "adv_mission2_title": "Mission 2: Formatted Report", "adv_mission2_desc": "Create a `report` string using the variables provided. The final string should be exactly: \"Sensor: temp_sensor Reading: 22.5 C\". Remember to convert the float!",
            "adv_mission2_placeholder": "report = \"Sensor: \" + sensor_name + \" Reading: \" + str(reading_value) + \" C\"\\nprint(report)",
            "button_test_adv_mission_2": "Test Mission 2",
            "adv_mission3_title": "Mission 3: Reassign and Combine", "adv_mission3_desc": "Reassign the `status` variable to the string \"Updated\". Then, create a `log_entry` string combining the original `item_id` (as a string) and the *new* `status`, like: \"ID: 101 Status: Updated\". Print the `log_entry`.",
            "adv_mission3_placeholder": "status = \"Updated\"\\nlog_entry = \"ID: \" + str(item_id) + \" Status: \" + status\\nprint(log_entry)",
            "button_test_adv_mission_3": "Test Mission 3",
            "feedback_mission_success": "Mission Accomplished!",
            "feedback_mission_syntax_error": "Syntax error or incorrect variable usage.",
            "feedback_mission_conversion_needed": "Remember to convert types (`int()`, `str()`) when needed.",
            "feedback_mission_wrong_output": "The output value or format is incorrect.",
            "feedback_mission_reassign_check": "Make sure you reassigned the variable correctly before using it.",
            "feedback_missions_summary_all_done": "All {totalMissions} advanced missions complete! Excellent!",
            "feedback_missions_summary_progress": "Completed {completedCount} of {totalMissions} advanced missions.",
            "completion_title": "Advanced Practice Complete!", "completion_desc": "Great job solidifying your understanding of types and variables! You handled conversions and reassignments well.<br> Watch the video lesson for more context, or return to the course menu.",
            "button_standard_practice": "Standard Practice", "button_video_lesson": "Watch Video Lesson", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 1: Prática Avançada",
            "nav_standard_practice": "Prática Padrão", "nav_video_lesson": "Lição em Vídeo", "nav_menu": "Menu do Curso",
            "nav_type_conversion": "Conversão Tipo", "nav_string_concat": "Concatenação", "nav_reassignment": "Reatribuição", "nav_naming": "Nomenclatura", "nav_adv_missions": "Missões Avanç.",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 1: Prática Avançada", "header_subtitle": "Aprofunde seu entendimento de tipos, conversões e manipulação de variáveis.",
            "conversion_title": "Desafio de Conversão de Tipo", "conversion_desc": "Às vezes, você precisa mudar o tipo de um valor. Exemplo: combinar um número com texto requer primeiro converter o número para uma string. Qual função converte um valor para um inteiro?",
            "conversion_question": "Selecione a função necessária para fazer o cálculo funcionar:",
            "type_int_func": "int()", "type_float_func": "float()", "type_str_func": "str()",
            "feedback_conversion_correct": "Correto! `int()` converte valores compatíveis (como strings numéricas) para inteiros.",
            "feedback_conversion_incorrect": "Quase lá. `int()` é necessário aqui para realizar a matemática na string '25'.",
            "feedback_conversion_select": "Por favor, selecione uma função.",
            "concat_title": "Concatenação de Strings", "concat_desc": "Você pode combinar strings usando o operador `+`. Para combinar strings com outros tipos (como números), você deve primeiro converter o número para uma string usando `str()`. Tente criar uma mensagem de boas-vindas abaixo.",
            "concat_editor_label": "Tarefa: Crie uma variável `greeting` combinando as variáveis `name` e `visits` como \"Welcome, Bob! Visits: 5\"",
            "concat_editor_placeholder": "ex: greeting = \"Welcome, \" + name + \"! Visits: \" + str(visits)",
            "button_run_code": "Executar Código", "concat_output_label": "Saída Simulada (Valor de `greeting`):", "concat_output_placeholder": "A saída aparecerá aqui...",
            "feedback_concat_success": "Excelente! A saudação está formatada corretamente.",
            "feedback_concat_missing_str": "Parece que você precisa converter o número (`visits`) para uma string usando `str()` antes de combinar.",
            "feedback_concat_wrong_output": "O valor final da string não está correto. Verifique espaçamento e ordem das variáveis.",
            "feedback_concat_no_assign": "Certifique-se de atribuir o resultado à variável `greeting`.",
            "feedback_concat_error": "Parece haver um erro de sintaxe no seu código.",
            "reassign_title": "Reatribuição de Variável", "reassign_desc": "Variáveis podem receber novos valores, até mesmo de tipos diferentes (tipagem dinâmica)! Preveja a saída *final* do código abaixo.",
            "reassign_question": "O que será impresso?",
            "button_check_prediction": "Verificar Previsão",
            "feedback_reassign_correct": "Exato! A variável `data` foi primeiro calculada como 15, depois reatribuída para a string \"Result: 15\".",
            "feedback_reassign_incorrect": "Quase lá. Siga a variável `data` passo a passo. Ela muda de valor e tipo.",
            "feedback_reassign_select": "Por favor, selecione uma opção.",
            "naming_title": "Convenções de Nomenclatura", "naming_desc": "Python prefere `snake_case` para nomes de variáveis (palavras minúsculas separadas por underscores). Clique no(s) nome(s) de variável abaixo que seguem esta convenção.",
            "button_check_selection": "Verificar Seleção", "button_try_again": "Tentar Novamente",
            "feedback_naming_correct": "Perfeito! Você identificou todos os nomes em `snake_case`.",
            "feedback_naming_incorrect": "Verifique novamente. Lembre-se que `snake_case` usa minúsculas e underscores entre palavras. Evite começar com números ou usar `CamelCase` para variáveis.",
            "feedback_naming_hint_incorrect": "{count} seleção(ões) incorreta(s).",
            "feedback_naming_hint_missed": "{count} nome(s) correto(s) não selecionado(s).",
            "feedback_naming_hints_joiner": ", e ",
            "adv_missions_title": "Missões Avançadas de Variáveis", "adv_missions_desc": "Aplique seu conhecimento de tipos, conversão e concatenação!",
            "adv_mission1_title": "Missão 1: Cálculo String para Inteiro", "adv_mission1_desc": "Imagine que `input()` lhe dá uma string. Converta `score_str` para um inteiro, adicione 10 e armazene o resultado em `final_score`. Depois imprima `final_score`.",
            "adv_mission1_placeholder": "final_score = int(score_str) + 10\\nprint(final_score)",
            "button_test_adv_mission_1": "Testar Missão 1",
            "adv_mission2_title": "Missão 2: Relatório Formatado", "adv_mission2_desc": "Crie uma string `report` usando as variáveis fornecidas. A string final deve ser exatamente: \"Sensor: temp_sensor Reading: 22.5 C\". Lembre-se de converter o float!",
            "adv_mission2_placeholder": "report = \"Sensor: \" + sensor_name + \" Reading: \" + str(reading_value) + \" C\"\\nprint(report)",
            "button_test_adv_mission_2": "Testar Missão 2",
            "adv_mission3_title": "Missão 3: Reatribuir e Combinar", "adv_mission3_desc": "Reatribua a variável `status` para a string \"Updated\". Então, crie uma string `log_entry` combinando o `item_id` original (como string) e o *novo* `status`, como: \"ID: 101 Status: Updated\". Imprima `log_entry`.",
            "adv_mission3_placeholder": "status = \"Updated\"\\nlog_entry = \"ID: \" + str(item_id) + \" Status: \" + status\\nprint(log_entry)",
            "button_test_adv_mission_3": "Testar Missão 3",
            "feedback_mission_success": "Missão Cumprida!",
            "feedback_mission_syntax_error": "Erro de sintaxe ou uso incorreto de variável.",
            "feedback_mission_conversion_needed": "Lembre-se de converter tipos (`int()`, `str()`) quando necessário.",
            "feedback_mission_wrong_output": "O valor ou formato da saída está incorreto.",
            "feedback_mission_reassign_check": "Certifique-se de que reatribuiu a variável corretamente antes de usá-la.",
            "feedback_missions_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Excelente!",
            "feedback_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões avançadas.",
            "completion_title": "Prática Avançada Completa!", "completion_desc": "Ótimo trabalho consolidando seu entendimento de tipos e variáveis! Você lidou bem com conversões e reatribuições.<br> Assista à lição em vídeo para mais contexto ou retorne ao menu do curso.",
            "button_standard_practice": "Prática Padrão", "button_video_lesson": "Assistir Lição em Vídeo", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 1：高级练习",
            "nav_standard_practice": "标准练习", "nav_video_lesson": "视频课程", "nav_menu": "课程菜单",
            "nav_type_conversion": "类型转换", "nav_string_concat": "字符串连接", "nav_reassignment": "重新赋值", "nav_naming": "命名", "nav_adv_missions": "高级任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 1：高级练习", "header_subtitle": "加深您对类型、转换和变量操作的理解。",
            "conversion_title": "类型转换挑战", "conversion_desc": "有时您需要更改值的类型。例如：将数字与文本组合需要先将数字转换为字符串。哪个函数将值转换为整数？",
            "conversion_question": "选择使计算正常工作所需的函数：",
            "type_int_func": "int()", "type_float_func": "float()", "type_str_func": "str()",
            "feedback_conversion_correct": "正确！`int()` 将兼容的值（如数字字符串）转换为整数。",
            "feedback_conversion_incorrect": "不太对。这里需要 `int()` 来对字符串 '25' 执行数学运算。",
            "feedback_conversion_select": "请选择一个函数。",
            "concat_title": "字符串连接", "concat_desc": "您可以使用 `+` 运算符组合字符串。要将字符串与其他类型（如数字）组合，必须先使用 `str()` 将数字转换为字符串。尝试在下面创建一条欢迎消息。",
            "concat_editor_label": "任务：通过组合 `name` 和 `visits` 变量创建一个名为 `greeting` 的变量，使其像这样 \"Welcome, Bob! Visits: 5\"",
            "concat_editor_placeholder": "例如：greeting = \"Welcome, \" + name + \"! Visits: \" + str(visits)",
            "button_run_code": "运行代码", "concat_output_label": "模拟输出 (`greeting` 的值):", "concat_output_placeholder": "输出将显示在此处...",
            "feedback_concat_success": "太棒了！问候语格式正确。",
            "feedback_concat_missing_str": "看起来您需要先使用 `str()` 将数字（`visits`）转换为字符串，然后再组合。",
            "feedback_concat_wrong_output": "最终的字符串值不太对。检查空格和变量顺序。",
            "feedback_concat_no_assign": "确保将结果分配给 `greeting` 变量。",
            "feedback_concat_error": "您的代码似乎存在语法错误。",
            "reassign_title": "变量重新赋值", "reassign_desc": "可以为变量赋新值，甚至可以是不同类型的值（动态类型）！预测下面代码的*最终*输出。",
            "reassign_question": "将打印什么？",
            "button_check_prediction": "检查预测",
            "feedback_reassign_correct": "完全正确！变量 `data` 首先计算为 15，然后重新赋值为字符串 \"Result: 15\"。",
            "feedback_reassign_incorrect": "不太对。一步一步地跟踪变量 `data`。它的值和类型都发生了变化。",
            "feedback_reassign_select": "请选择一个选项。",
            "naming_title": "变量命名约定", "naming_desc": "Python 推荐使用 `snake_case` (下划线命名法) 来命名变量（小写单词之间用下划线分隔）。点击下面遵循此约定的变量名。",
            "button_check_selection": "检查选择", "button_try_again": "再试一次",
            "feedback_naming_correct": "完美！您识别了所有 `snake_case` 名称。",
            "feedback_naming_incorrect": "再检查一下。记住 `snake_case` 使用小写字母和下划线分隔单词。避免以数字开头或对变量使用 `CamelCase`。",
            "feedback_naming_hint_incorrect": "{count} 个错误的选择。",
            "feedback_naming_hint_missed": "{count} 个遗漏的正确名称。",
            "feedback_naming_hints_joiner": "，以及 ",
            "adv_missions_title": "高级变量任务", "adv_missions_desc": "应用您关于类型、转换和连接的知识！",
            "adv_mission1_title": "任务 1：字符串转整数计算", "adv_mission1_desc": "假设 `input()` 给您一个字符串。将 `score_str` 转换为整数，加上 10，并将结果存储在 `final_score` 中。然后打印 `final_score`。",
            "adv_mission1_placeholder": "final_score = int(score_str) + 10\\nprint(final_score)",
            "button_test_adv_mission_1": "测试任务 1",
            "adv_mission2_title": "任务 2：格式化报告", "adv_mission2_desc": "使用提供的变量创建 `report` 字符串。最终字符串应精确为：“Sensor: temp_sensor Reading: 22.5 C”。记住转换浮点数！",
            "adv_mission2_placeholder": "report = \"Sensor: \" + sensor_name + \" Reading: \" + str(reading_value) + \" C\"\\nprint(report)",
            "button_test_adv_mission_2": "测试任务 2",
            "adv_mission3_title": "任务 3：重新赋值并组合", "adv_mission3_desc": "将 `status` 变量重新赋值为字符串 \"Updated\"。然后，创建一个 `log_entry` 字符串，组合原始的 `item_id`（作为字符串）和*新的* `status`，像这样：“ID: 101 Status: Updated”。打印 `log_entry`。",
            "adv_mission3_placeholder": "status = \"Updated\"\\nlog_entry = \"ID: \" + str(item_id) + \" Status: \" + status\\nprint(log_entry)",
            "button_test_adv_mission_3": "测试任务 3",
            "feedback_mission_success": "任务完成！",
            "feedback_mission_syntax_error": "语法错误或变量使用不当。",
            "feedback_mission_conversion_needed": "需要时请记住转换类型 (`int()`, `str()`)。",
            "feedback_mission_wrong_output": "输出值或格式不正确。",
            "feedback_mission_reassign_check": "确保在使用变量之前已正确地重新赋值。",
            "feedback_missions_summary_all_done": "所有 {totalMissions} 个高级任务已完成！太棒了！",
            "feedback_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个高级任务。",
            "completion_title": "高级练习完成！", "completion_desc": "很好地巩固了您对类型和变量的理解！您很好地处理了转换和重新赋值。<br> 观看视频课程以获取更多背景信息，或返回课程菜单。",
            "button_standard_practice": "标准练习", "button_video_lesson": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Identical to previous) ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang); // Apply generic translations

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             // Re-initialize language-dependent activities
             if (typeConversionSection) setupTypeConversion();
             if (reassignmentSection) setupReassignmentChallenge(); // Reset selections/feedback
             if (namingConventionSection) setupNamingConvention();
             if (advancedMissionsSection && typeof updateAdvMissionSummary === 'function') updateAdvMissionSummary();
             // Note: String Concat simulator doesn't need full reset on lang change, placeholders handled by translatePage
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; // Fallback
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
             if (!translations[lang]) lang = 'en';
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName !== 'INPUT' && el.tagName !== 'TEXTAREA' && el.tagName !== 'OPTION') {
                     // Preserve specific HTML structure within elements if needed
                     if (el.dataset.preserveHtml) {
                         // Find translatable text nodes, avoid translating elements
                         Array.from(el.childNodes).forEach(node => {
                             if (node.nodeType === Node.TEXT_NODE && node.textContent.trim() !== '') {
                                 // Simple approach: replace the whole text content if key matches
                                 // More complex logic needed if mixing static/dynamic text
                                 const nodeKey = el.getAttribute('data-translate'); // Assume key on parent
                                 if (nodeKey === key) node.textContent = translation;
                             }
                             // Could potentially add recursive translation for child elements if needed
                         });
                     }
                     // Handle simple text or innerHTML based on content
                     else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                     else { el.textContent = translation; }
                 } else if (el.tagName === 'OPTION') {
                     el.textContent = translation;
                 }
             });
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                 const key = el.getAttribute('data-translate-placeholder');
                 el.setAttribute('placeholder', getTranslation(key, lang));
             });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });

             // Specific updates for dynamically generated content needing re-translation
             if (namingConventionSection) { // Update naming convention button text if already generated
                const nameItems = namingConventionSection.querySelectorAll('.name-item');
                 if(nameItems.length > 0) {
                     // Re-setup might be cleaner if text content is complex
                     setupNamingConvention(); // Re-run setup to get correct translations
                 }
             }
        }

        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Identical) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
             navToggleButton.addEventListener('click', (event) => {
                 event.stopPropagation(); body.classList.toggle('nav-active');
                 navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
             });
             document.addEventListener('click', (event) => {
                 if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) {
                     body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false');
                 }
             });
             navPanel.querySelectorAll('a').forEach(link => {
                 link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); });
             });
             document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }
             });
             navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Identical) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => { setLanguage(e.target.value); });
        }

        // --- Helper Function for Feedback (Identical) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) {
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             if (translatedMessage.includes('<') && translatedMessage.includes('>')) { feedbackEl.innerHTML = translatedMessage; }
             else { feedbackEl.textContent = translatedMessage; }
            feedbackEl.className = 'feedback-message'; // Reset classes
            feedbackEl.classList.add('visible', type);

            // Animate parent interactive area
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
            else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
        }

        // --- Activity 1: Type Conversion Challenge ---
        const typeConversionSection = document.getElementById('type-conversion');
        let currentConversionListeners = [];

        function setupTypeConversion() {
             if (!typeConversionSection) return;
             const options = typeConversionSection.querySelectorAll('.conversion-options button');
             const feedbackDiv = document.getElementById('conversion-feedback');
             let selectedFunc = null;

             // Clear previous listeners
             currentConversionListeners.forEach(({element, listener}) => element.removeEventListener('click', listener));
             currentConversionListeners = [];

             // Reset state
             options.forEach(btn => {
                 btn.classList.remove('selected');
                 btn.disabled = false;
                 const btnListener = () => {
                     options.forEach(b => b.classList.remove('selected')); // Deselect others
                     btn.classList.add('selected');
                     selectedFunc = btn.dataset.func;

                     // Immediate check and feedback
                     if (selectedFunc === 'int()') {
                         showFeedback('conversion-feedback', 'feedback_conversion_correct', 'correct');
                         options.forEach(b => b.disabled = true); // Disable after correct selection
                     } else {
                         showFeedback('conversion-feedback', 'feedback_conversion_incorrect', 'incorrect');
                          // Keep incorrect options active for another try, or disable all after one guess?
                          // Let's disable all after any guess for simplicity here.
                          options.forEach(b => b.disabled = true);
                          // Optionally highlight the correct one visually after incorrect guess
                          const correctBtn = typeConversionSection.querySelector('button[data-func="int()"]');
                          if (correctBtn) correctBtn.classList.add('success-glow-anim'); // Use glow for correct answer hint
                     }
                 };
                 btn.addEventListener('click', btnListener);
                 currentConversionListeners.push({ element: btn, listener: btnListener });
             });
             feedbackDiv.classList.remove('visible'); // Clear feedback
        }

        // --- Activity 2: String Concatenation Simulator ---
        const concatSection = document.getElementById('string-concat');
        if (concatSection) {
             const editor = document.getElementById('concat-editor-input');
             const outputArea = document.getElementById('concat-output');
             const runBtn = document.getElementById('run-concat-btn');
             const feedbackDiv = document.getElementById('concat-feedback');
             const nameVar = "Bob"; // Predefined value for simulation
             const visitsVar = 5; // Predefined value

             runBtn.addEventListener('click', () => {
                 const code = editor.value.trim();
                 let placeholder = outputArea.querySelector('.placeholder');
                 outputArea.innerHTML = ''; // Clear previous
                 if (!placeholder) {
                     placeholder = document.createElement('span');
                     placeholder.className = 'placeholder';
                     placeholder.dataset.translate = 'concat_output_placeholder';
                 }
                 placeholder.textContent = getTranslation('concat_output_placeholder', getStoredLanguage());
                 feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

                 const expectedOutput = `Welcome, ${nameVar}! Visits: ${visitsVar}`;
                 let success = false;
                 let errorMessageKey = 'feedback_concat_error'; // Default error

                 // Basic Simulation Logic
                 // 1. Check if 'greeting =' is present
                 // 2. Check if 'str(visits)' or `str(5)` is used (simple check)
                 // 3. Evaluate the likely result (very simplified)

                 if (!code.includes('greeting =')) {
                     errorMessageKey = 'feedback_concat_no_assign';
                 } else {
                     // Simulate execution (super simplified)
                     try {
                         // Check for str() conversion
                         const needsStrConversion = !code.match(/str\s*\(\s*(visits|5)\s*\)/);

                         // Rough simulation of the concatenation
                         // This is NOT a real Python interpreter, just pattern matching
                         let simulatedResult = '';
                         if (code.includes('"Welcome, "') && code.includes('name') && code.includes('"!"') && code.includes('" Visits: "') && code.includes('visits')) {
                              if (needsStrConversion) {
                                  // Simulate TypeError if str() is missing
                                  throw new Error("TypeError simulation");
                              } else {
                                  // Assume correct if structure looks okay and str() is present
                                   simulatedResult = expectedOutput; // Assume success if structure ok
                              }
                         } else {
                             // Try a very basic eval-like approach ONLY for simple string concat for demo
                             // DANGER: In real scenarios, never use eval() on user input.
                             // This is highly simplified and brittle.
                             try {
                                 // Define vars in a temporary scope for a potential 'eval' (USE WITH EXTREME CAUTION or replace with safer parsing)
                                 let tempScope = { name: nameVar, visits: visitsVar, str: String };
                                 // Attempt to evaluate the assignment part (VERY UNSAFE/BRITTLE)
                                 // This is just to get *some* result for the simulation. A parser is better.
                                 // Let's try regex instead for slightly safer check:
                                  const assignmentPart = code.substring(code.indexOf('=') + 1).trim();
                                  const correctPattern = /"Welcome, "\s*\+\s*name\s*\+\s*"!\s*Visits:\s*"\s*\+\s*str\s*\(\s*visits\s*\)/;
                                  if (correctPattern.test(assignmentPart)) {
                                       simulatedResult = expectedOutput;
                                  } else {
                                      simulatedResult = "[Could not simulate accurately]";
                                      errorMessageKey = 'feedback_concat_wrong_output';
                                  }

                             } catch (evalError) {
                                 simulatedResult = "[Simulation Error]";
                                 errorMessageKey = 'feedback_concat_error';
                             }
                         }


                         if (simulatedResult === expectedOutput) {
                             success = true;
                             const outputLine = document.createElement('span');
                             outputLine.classList.add('output-line');
                             outputLine.textContent = `"${simulatedResult}"`; // Show quotes for string
                             outputArea.appendChild(outputLine);
                             showFeedback('concat-feedback', 'feedback_concat_success', 'correct');
                         } else if (simulatedResult.includes("TypeError simulation")) {
                              const errorLine = document.createElement('span');
                              errorLine.classList.add('error-line');
                              errorLine.textContent = "TypeError: can only concatenate str (not \"int\") to str";
                              outputArea.appendChild(errorLine);
                              showFeedback('concat-feedback', 'feedback_concat_missing_str', 'incorrect');
                         }
                         else {
                             const outputLine = document.createElement('span');
                             outputLine.classList.add('output-line');
                              outputLine.textContent = `"${simulatedResult}"`; // Show potentially wrong output
                             outputArea.appendChild(outputLine);
                             showFeedback('concat-feedback', errorMessageKey, 'incorrect');
                         }

                     } catch (e) {
                         // Catch errors from our basic simulation
                         const errorLine = document.createElement('span');
                         errorLine.classList.add('error-line');
                         errorLine.textContent = e.message === "TypeError simulation" ? "TypeError: can only concatenate str (not \"int\") to str" : "Simulation Error";
                         outputArea.appendChild(errorLine);
                         feedbackDiv.classList.remove('visible'); // Reset before showing new feedback
                          if (e.message === "TypeError simulation") {
                               showFeedback('concat-feedback', 'feedback_concat_missing_str', 'incorrect');
                          } else {
                               showFeedback('concat-feedback', errorMessageKey, 'incorrect');
                          }
                     }
                 }

                 if (!success && errorMessageKey !== 'feedback_concat_missing_str' && errorMessageKey !== 'feedback_concat_no_assign') {
                      // If not successful for other reasons, ensure placeholder isn't shown
                      if(outputArea.innerHTML === ''){
                           outputArea.appendChild(placeholder);
                      }
                 }
                 if (code === '') { // Handle empty editor case
                    outputArea.innerHTML = ''; // Clear again
                    outputArea.appendChild(placeholder);
                    feedbackDiv.classList.remove('visible'); // Clear any previous feedback
                 }
             });
        }


        // --- Activity 3: Variable Reassignment Prediction ---
        const reassignmentSection = document.getElementById('reassignment-challenge');
        let currentReassignListeners = [];

        function setupReassignmentChallenge() {
            if (!reassignmentSection) return;
            const optionsContainer = document.getElementById('reassign-options');
            const options = optionsContainer.querySelectorAll('button');
            const checkBtn = document.getElementById('check-reassign-btn');
            const feedbackDiv = document.getElementById('reassign-feedback');
            const correctAnswer = document.getElementById('reassign-correct-answer').textContent.trim();
            let selectedOption = null;

            // Clear previous listeners
            currentReassignListeners.forEach(({element, listener}) => element.removeEventListener('click', listener));
            currentReassignListeners = [];

            // Reset state
            options.forEach(btn => {
                btn.classList.remove('selected', 'reveal-correct', 'reveal-incorrect');
                btn.disabled = false;
                const btnListener = () => {
                    options.forEach(b => b.classList.remove('selected')); // Deselect others
                    btn.classList.add('selected');
                    selectedOption = btn.dataset.option;
                    checkBtn.disabled = false; // Enable check button once an option is selected
                    feedbackDiv.classList.remove('visible'); // Hide feedback on new selection
                };
                btn.addEventListener('click', btnListener);
                 currentReassignListeners.push({ element: btn, listener: btnListener });
            });

            checkBtn.disabled = true; // Disable check button initially
            feedbackDiv.classList.remove('visible');

            // Check button listener
            const checkBtnListener = () => {
                 if (!selectedOption) {
                     showFeedback('reassign-feedback', 'feedback_reassign_select', 'info');
                     return;
                 }
                 options.forEach(btn => {
                     btn.disabled = true; // Disable all options after checking
                     if (btn.dataset.option === correctAnswer) {
                         btn.classList.add('reveal-correct');
                     } else if (btn.dataset.option === selectedOption) {
                         btn.classList.add('reveal-incorrect');
                     }
                 });

                 if (selectedOption === correctAnswer) {
                     showFeedback('reassign-feedback', 'feedback_reassign_correct', 'correct');
                     checkBtn.classList.add('success');
                 } else {
                     showFeedback('reassign-feedback', 'feedback_reassign_incorrect', 'incorrect');
                     checkBtn.classList.remove('success');
                 }
                 checkBtn.disabled = true; // Disable check button after checking
            };
            checkBtn.addEventListener('click', checkBtnListener);
            currentReassignListeners.push({ element: checkBtn, listener: checkBtnListener }); // Add check button listener
        }


        // --- Activity 4: Naming Convention Quick Check ---
        const namingConventionSection = document.getElementById('naming-convention');
        let currentNamingListeners = [];

        function setupNamingConvention() {
            if (!namingConventionSection) return;
            const optionsContainer = document.getElementById('naming-options');
            const checkBtn = document.getElementById('check-naming-btn');
            const resetBtn = document.getElementById('reset-naming-btn');
            const feedbackDiv = document.getElementById('naming-feedback');
            const nameData = document.querySelectorAll('#naming-data span');
            const currentLang = getStoredLanguage();

            // Clear previous listeners and content
            currentNamingListeners.forEach(({element, listener}) => element.removeEventListener('click', listener));
            currentNamingListeners = [];
            optionsContainer.innerHTML = ''; // Clear existing options

            // Generate options
            nameData.forEach(data => {
                 const name = data.dataset.name;
                 const isCorrect = data.dataset.correct === 'true';
                 const item = document.createElement('span');
                 item.classList.add('name-item');
                 item.textContent = name;
                 item.dataset.correct = isCorrect.toString();

                 const itemListener = () => {
                     if (item.classList.contains('checked-state')) return; // Don't select after checking
                     item.classList.toggle('selected-visual');
                 };
                 item.addEventListener('click', itemListener);
                 currentNamingListeners.push({ element: item, listener: itemListener });
                 optionsContainer.appendChild(item);
            });

            // Reset button states and feedback
            checkBtn.disabled = false;
            checkBtn.classList.remove('success');
            resetBtn.classList.add('hidden');
            feedbackDiv.classList.remove('visible');
        }

         if (namingConventionSection) {
             const checkBtn = document.getElementById('check-naming-btn');
             const resetBtn = document.getElementById('reset-naming-btn');
             const optionsContainer = document.getElementById('naming-options');
             const feedbackDiv = document.getElementById('naming-feedback');

             checkBtn.addEventListener('click', () => {
                 let correctSelections = 0;
                 let incorrectSelections = 0;
                 let missedCorrect = 0;
                 const items = optionsContainer.querySelectorAll('.name-item');
                 const totalCorrectNames = Array.from(document.querySelectorAll('#naming-data span')).filter(span => span.dataset.correct === 'true').length;
                 const currentLang = getStoredLanguage();

                 items.forEach(item => {
                     const isCorrect = item.dataset.correct === 'true';
                     const isSelected = item.classList.contains('selected-visual');
                     item.classList.add('checked-state'); // Mark as checked

                     item.classList.remove('correct', 'incorrect', 'missed'); // Clear previous feedback classes

                     if (isSelected && isCorrect) {
                         item.classList.add('correct');
                         correctSelections++;
                     } else if (isSelected && !isCorrect) {
                         item.classList.add('incorrect');
                         incorrectSelections++;
                     } else if (!isSelected && isCorrect) {
                         item.classList.add('missed');
                         missedCorrect++;
                     }
                 });

                 if (incorrectSelections === 0 && missedCorrect === 0) {
                     showFeedback('naming-feedback', 'feedback_naming_correct', 'correct');
                     checkBtn.classList.add('success');
                     checkBtn.disabled = true;
                     resetBtn.classList.add('hidden');
                 } else {
                     let hints = [];
                     if (incorrectSelections > 0) hints.push(getTranslation('feedback_naming_hint_incorrect', currentLang, { count: incorrectSelections }));
                     if (missedCorrect > 0) hints.push(getTranslation('feedback_naming_hint_missed', currentLang, { count: missedCorrect }));
                     const hintText = hints.join(getTranslation('feedback_naming_hints_joiner', currentLang));

                     showFeedback('naming-feedback', 'feedback_naming_incorrect', 'incorrect', { hints: hintText });
                     checkBtn.classList.remove('success');
                     checkBtn.disabled = true;
                     resetBtn.classList.remove('hidden');
                 }
             });

             resetBtn.addEventListener('click', setupNamingConvention);
         }


        // --- Activity 5: Advanced Mini Missions ---
        const advancedMissionsSection = document.getElementById('advanced-mini-missions');
        let updateAdvMissionSummary; // Define function scope

        if (advancedMissionsSection) {
            const missionRunButtons = advancedMissionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('adv-missions-summary-feedback');
            const totalMissions = advancedMissionsSection.querySelectorAll('.mission').length;

            updateAdvMissionSummary = function() { // Assign function
                 const completedMissionsCount = advancedMissionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 summaryFeedback.classList.remove('visible', 'correct', 'incorrect', 'info'); // Clear previous state
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`adv-mission-${missionId}`);
                    if (!missionDiv) return;

                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `adv-mission-feedback-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();
                    const lines = code.split('\n').map(l => l.trim()).filter(l => l.length > 0);

                    outputArea.innerHTML = ''; // Clear output
                    feedbackDiv.classList.remove('visible'); // Clear feedback
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error';
                    let feedbackType = 'incorrect';
                    let simulatedOutput = ""; // Store final simulated output

                    // Predefined values for simulation
                    const missionData = {
                        '1': { score_str: "150", expectedOutput: "160" },
                        '2': { sensor_name: "temp_sensor", reading_value: 22.5, expectedOutput: "Sensor: temp_sensor Reading: 22.5 C" },
                        '3': { item_id: 101, status_initial: "Pending", expectedOutput: "ID: 101 Status: Updated" }
                    };
                    const data = missionData[missionId];

                    try {
                        // Basic Simulation Logic (using regex and pattern matching, not eval)
                        if (missionId === '1') {
                            const intConversion = code.match(/int\s*\(\s*score_str\s*\)/);
                            const assignment = code.match(/final_score\s*=\s*(.*)/);
                            const addition = assignment && assignment[1].includes('+') && assignment[1].includes('10');
                            const printStmt = code.match(/print\s*\(\s*final_score\s*\)/);

                            if (intConversion && assignment && addition && printStmt) {
                                simulatedOutput = data.expectedOutput;
                                success = true;
                            } else if (!intConversion) {
                                feedbackMessageKey = 'feedback_mission_conversion_needed';
                                simulatedOutput = '<span class="error-line">TypeError Simulation: Missing int()</span>';
                            } else {
                                feedbackMessageKey = 'feedback_mission_wrong_output';
                            }
                        } else if (missionId === '2') {
                            const strConversion = code.match(/str\s*\(\s*reading_value\s*\)/);
                            // Regex to check the overall structure and concatenation
                            const pattern = /report\s*=\s*"Sensor: "\s*\+\s*sensor_name\s*\+\s*" Reading: "\s*\+\s*str\s*\(\s*reading_value\s*\)\s*\+\s*" C"/;
                            const assignmentMatch = code.match(pattern);
                            const printStmt = code.match(/print\s*\(\s*report\s*\)/);

                            if (strConversion && assignmentMatch && printStmt) {
                                simulatedOutput = data.expectedOutput;
                                success = true;
                            } else if (!strConversion) {
                                feedbackMessageKey = 'feedback_mission_conversion_needed';
                                simulatedOutput = '<span class="error-line">TypeError Simulation: Missing str()</span>';
                            } else {
                                feedbackMessageKey = 'feedback_mission_wrong_output';
                             }
                        } else if (missionId === '3') {
                             const reassign = code.match(/status\s*=\s*"Updated"/);
                             const strConversion = code.match(/str\s*\(\s*item_id\s*\)/);
                              // Check combination uses the *new* status
                             const pattern = /log_entry\s*=\s*"ID: "\s*\+\s*str\s*\(\s*item_id\s*\)\s*\+\s*" Status: "\s*\+\s*status/;
                             const assignmentMatch = code.match(pattern);
                             const printStmt = code.match(/print\s*\(\s*log_entry\s*\)/);

                             // Check order: reassignment must happen before log_entry assignment
                             const reassignIndex = code.indexOf('status = "Updated"');
                             const logEntryIndex = code.indexOf('log_entry =');

                             if (reassign && strConversion && assignmentMatch && printStmt && (reassignIndex < logEntryIndex || logEntryIndex === -1)) {
                                 simulatedOutput = data.expectedOutput;
                                 success = true;
                             } else if (!reassign) {
                                 feedbackMessageKey = 'feedback_mission_reassign_check';
                             } else if (!strConversion) {
                                 feedbackMessageKey = 'feedback_mission_conversion_needed';
                                 simulatedOutput = '<span class="error-line">TypeError Simulation: Missing str()</span>';
                             } else {
                                 feedbackMessageKey = 'feedback_mission_wrong_output';
                             }
                        }
                    } catch (error) {
                        console.error("Mission simulation error:", error);
                        feedbackMessageKey = 'feedback_mission_syntax_error';
                        simulatedOutput = '<span class="error-line">Simulation Error</span>';
                    }

                    // Display simulated output
                    outputArea.innerHTML = simulatedOutput; // Allows HTML in output (for error styling)

                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        // feedbackMessageKey is already set
                        feedbackType = 'incorrect';
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                    }
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    updateAdvMissionSummary(); // Update overall progress
                });
            });
        }


        // --- Fade-in animations on scroll (Identical) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 // Check if element is already visible (opacity 1) to prevent re-animation
                 if (el.style.opacity === '1') return;

                 const rect = el.getBoundingClientRect();
                 // Adjust visibility threshold slightly if needed
                 const triggerPoint = windowHeight - 80; // e.g., 80px from bottom
                 const elementTopVisible = rect.top < triggerPoint;
                 const elementBottomVisible = rect.bottom >= 50; // Ensure some part is still visible

                 if (elementTopVisible && elementBottomVisible) {
                     // Apply animation styles directly
                     el.style.opacity = '1';
                     el.style.transform = 'translateY(0)';
                     // Optional: Remove the class after animation starts if it interferes
                     // el.classList.remove('fade-in');
                 }
             });
        };
        // Debounce or Throttle scroll handler for performance
        let scrollTimeout;
        const scrollHandler = () => {
            if (scrollTimeout) { clearTimeout(scrollTimeout); }
            scrollTimeout = setTimeout(() => {
                window.requestAnimationFrame(animateOnScroll);
            }, 50); // Adjust timeout as needed
        };
        window.addEventListener('scroll', scrollHandler);


        // --- Initial Setup ---
        setLanguage(initialLang); // Apply language FIRST, this calls activity setups
        animateOnScroll(); // Trigger initial animation check for elements already in view

    }); // End DOMContentLoaded
    </script>

</body>
</html>