<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="kc14_page_title">Knowledge Check: Module 14 - Loops (while)</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14;
            --check-color: #6f42c1; /* Color for KC elements */
            --certificate-color: #d63384;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Animations --- */
        .fade-in { opacity: 0; animation: fadeInAnimation 0.6s ease-out forwards; }
        @keyframes fadeInAnimation { to { opacity: 1; } }

        /* --- Knowledge Check Header --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.8rem; /* Slightly smaller than dashboard */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            flex-grow: 1;
            text-align: center;
            padding: 0 1rem; /* Add padding if title is long */
        }
        .back-button {
            color: var(--text-light);
            background-color: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            transition: background-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
            white-space: nowrap; /* Prevent wrapping */
        }
        .back-button i { margin-right: 8px; }
        .back-button:hover { background-color: rgba(255, 255, 255, 0.25); color: var(--text-light); }

        /* Language Switcher in Header */
         .language-switcher-header {
            position: relative; /* Needed for absolute positioning of dropdown */
         }
         #languageSelect {
             background: var(--lang-select-bg);
             color: var(--text-light);
             border: 1px solid var(--lang-select-border);
             border-radius: 5px;
             padding: 8px 35px 8px 15px;
             cursor: pointer;
             font-size: 0.9rem;
             font-weight: 500;
             appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--text-light').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
             background-repeat: no-repeat;
             background-position: right 12px center;
             background-size: 10px auto;
             transition: border-color 0.3s ease, background-color 0.3s ease;
             min-width: 130px; /* Ensure enough space */
         }
         #languageSelect:hover { background-color: var(--lang-select-bg-hover); border-color: var(--text-light); }
         #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Content Area --- */
        .kc-main {
            max-width: 900px;
            margin: 0 auto 3rem auto; /* Added bottom margin */
            padding: 0 1.5rem;
            width: 100%;
            flex-grow: 1; /* Make main content take available space */
        }

        /* --- Quiz Container Styling --- */
        .quiz-container {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 2rem 2.5rem;
            border: 1px solid var(--border-color);
        }
        .quiz-instructions {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .quiz-instructions p { margin-bottom: 0.5rem; }
        .quiz-instructions strong { color: var(--check-color); }
        .quiz-instructions code { font-size: 0.9em; background: #eee; padding: 1px 4px; border-radius: 3px;}

        /* --- Question Styling --- */
        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .question-block:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .question-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
        .question-text .q-number {
             display: inline-block;
             background-color: var(--check-color);
             color: var(--text-light);
             border-radius: 50%;
             width: 28px;
             height: 28px;
             line-height: 28px;
             text-align: center;
             font-weight: 700;
             font-size: 0.9rem;
             margin-right: 10px;
        }
        .question-text code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            background-color: #e9ecef;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
            color: #c7254e;
        }

        /* --- Options Styling --- */
        .quiz-options { list-style: none; padding: 0; margin: 0; }
        .quiz-option {
            margin-bottom: 0.8rem;
            background-color: #f8f9fa;
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            cursor: pointer;
            display: flex; /* Use flex for alignment */
            align-items: center; /* Vertically center items */
        }
        .quiz-option:hover { background-color: #e9ecef; }
        .quiz-option input[type="radio"] {
            margin-right: 12px;
            flex-shrink: 0; /* Prevent radio button from shrinking */
            accent-color: var(--check-color); /* Style the radio button itself */
            cursor: pointer;
            transform: scale(1.2); /* Make radio slightly larger */
        }
        .quiz-option label {
            flex-grow: 1; /* Allow label to take remaining space */
            cursor: pointer;
            color: var(--text-dark);
            line-height: 1.4; /* Improve readability */
            font-size: 0.95rem;
        }
         .quiz-option label code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            background-color: #dde2e6; /* Slightly different bg for inline code */
            padding: 0.1em 0.3em;
            border-radius: 3px;
            font-size: 0.9em;
            color: #c7254e;
        }

        /* --- Feedback Styling (Applied after submission) --- */
        .quiz-option.correct-answer label { color: var(--success-color); font-weight: 500; }
        .quiz-option.incorrect-answer label { color: var(--error-color); font-weight: 500; }
        .quiz-option.user-selected { border-left: 4px solid var(--check-color); font-weight: 500; }
        .quiz-option.correct-answer.user-selected { border-left: 4px solid var(--success-color); background-color: #d1e7dd; }
        .quiz-option.incorrect-answer.user-selected { border-left: 4px solid var(--error-color); background-color: #f8d7da; }
        .quiz-option.correct-answer::after {
            content: '\f00c'; /* Font Awesome check icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--success-color);
            margin-left: 10px;
            font-size: 1.1rem;
        }
         .quiz-option.incorrect-answer.user-selected::after {
            content: '\f00d'; /* Font Awesome times icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--error-color);
            margin-left: 10px;
            font-size: 1.1rem;
        }
        /* Disable input after submission */
        .quiz-submitted .quiz-option input[type="radio"] { cursor: default; }
        .quiz-submitted .quiz-option label { cursor: default; }
        .quiz-submitted .quiz-option:hover { background-color: #f8f9fa; /* Prevent hover effect */ }
        .quiz-submitted .quiz-option.user-selected:hover { /* Keep selected styles on hover */
             background-color: #f8f9fa; /* Default bg */
        }
        .quiz-submitted .quiz-option.correct-answer.user-selected:hover {
             background-color: #d1e7dd;
        }
        .quiz-submitted .quiz-option.incorrect-answer.user-selected:hover {
             background-color: #f8d7da;
        }


        /* --- Buttons & Results Styling --- */
        .quiz-controls { text-align: center; margin-top: 2.5rem; }
        .quiz-button {
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            margin: 0 0.5rem;
        }
        .quiz-button:hover { background-color: #5a349b; transform: translateY(-2px); }
        .quiz-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; }
        #retry-button { background-color: var(--secondary-color); }
        #retry-button:hover { background-color: #5a6268; }

        .quiz-results {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden initially */
            border: 1px solid var(--border-color);
        }
        .quiz-results.show { display: block; animation: fadeInAnimation 0.5s ease-out; }
        .result-message { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.8rem; }
        .result-message.pass { color: var(--success-color); }
        .result-message.fail { color: var(--error-color); }
        .result-score { font-size: 1.1rem; color: var(--text-dark); margin-bottom: 0.5rem; }
        .result-feedback { font-size: 0.95rem; color: var(--text-muted); }
        .result-feedback i { margin-right: 5px; }
        .result-feedback.pass i { color: var(--success-color); }
        .result-feedback.fail i { color: var(--error-color); }


        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header h1 { font-size: 1.5rem; padding: 0 0.5rem; }
            .back-button { padding: 0.4rem 0.8rem; font-size: 0.9rem; }
            .language-switcher-header { margin-left: 0.5rem; }
             #languageSelect { padding: 6px 30px 6px 10px; font-size: 0.85rem; min-width: 110px; background-size: 8px auto; background-position: right 8px center;}
            .kc-main { padding: 0 1rem; }
            .quiz-container { padding: 1.5rem; }
            .question-text { font-size: 1rem; }
            .quiz-option { padding: 0.7rem 1rem; }
            .quiz-option label { font-size: 0.9rem; }
             .quiz-button { padding: 0.7rem 1.5rem; font-size: 1rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .kc-header { flex-wrap: wrap; padding: 0.8rem 1rem; }
            .kc-header h1 { font-size: 1.3rem; order: 2; width: 100%; text-align: center; margin-top: 0.5rem; padding: 0;}
            .back-button { order: 1; }
            .language-switcher-header { order: 3; }
            .kc-main { margin-bottom: 2rem; }
            .quiz-container { padding: 1rem 1.2rem; }
            .quiz-instructions { font-size: 1rem; }
            .question-text { margin-bottom: 0.8rem; }
            .quiz-option { margin-bottom: 0.6rem; padding: 0.6rem 0.9rem; }
             .quiz-option input[type="radio"] { transform: scale(1.1); margin-right: 10px;}
             .quiz-option label { font-size: 0.85rem; }
             .quiz-controls { margin-top: 2rem; }
             .quiz-button { display: block; width: 80%; margin: 0.8rem auto; }
             .quiz-results { padding: 1rem; }
             .result-message { font-size: 1.1rem; }
             .result-score { font-size: 1rem; }
             .result-feedback { font-size: 0.9rem; }
        }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="back-button fade-in">
            <i class="fas fa-arrow-left"></i> <span data-translate="kc_back_button">Back to Dashboard</span>
        </a>
        <h1 data-translate="kc14_header_title" class="fade-in">Module 14: While Loops</h1>
         <div class="language-switcher-header fade-in">
             <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                 <option value="en" data-translate="lang_en">🇬🇧 English</option>
                 <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                 <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
             </select>
         </div>
    </header>

    <main class="kc-main">
        <div class="quiz-container fade-in" style="animation-delay: 0.1s;">

            <div class="quiz-instructions">
                <p><strong data-translate="kc_instruction_1">Instructions:</strong> <span data-translate="kc_instruction_2">Select the best answer for each question.</span></p>
                <p><span data-translate="kc_instruction_3">You need at least <strong data-translate="kc_passing_score">6 out of 10</strong> correct answers to pass.</span></p>
                <p><span data-translate="kc_instruction_4">You can retry as many times as you need. Passing marks this module as complete on the dashboard.</span></p>
            </div>

            <form id="quiz-form">
                <!-- Questions will be dynamically inserted here -->
                <div id="questions-wrapper"></div>

                <div class="quiz-controls">
                    <button type="submit" id="submit-button" class="quiz-button" data-translate="kc_submit_button">Submit Answers</button>
                    <button type="button" id="retry-button" class="quiz-button" style="display: none;" data-translate="kc_retry_button">Retry Quiz</button>
                </div>
            </form>

            <div id="quiz-results" class="quiz-results">
                <p id="result-message" class="result-message"></p>
                <p id="result-score" class="result-score"></p>
                <p id="result-feedback" class="result-feedback"></p>
            </div>

        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Configuration ---
        const moduleId = 14; // *** IMPORTANT: Set this for each knowledge check page ***
        const passingScore = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object (Add KC-specific keys) ---
        const translations = {
            en: {
                "kc14_page_title": "Knowledge Check: Module 14 - Loops (while)",
                "kc14_header_title": "Module 14: While Loops",
                "kc_back_button": "Back to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "kc_instruction_1": "Instructions:",
                "kc_instruction_2": "Select the best answer for each question.",
                "kc_instruction_3": "You need at least 6 out of 10 correct answers to pass.",
                "kc_passing_score": "6 out of 10",
                "kc_instruction_4": "You can retry as many times as you need. Passing marks this module as complete on the dashboard.",
                "kc_submit_button": "Submit Answers",
                "kc_retry_button": "Retry Quiz",
                "kc_result_pass_message": "Congratulations! You Passed!",
                "kc_result_fail_message": "Keep Trying!",
                "kc_result_score_text": "Your score: {score} out of {total}",
                "kc_result_feedback_pass": "<i class=\"fas fa-check-circle\"></i> Module {id} marked as complete!",
                "kc_result_feedback_fail": "<i class=\"fas fa-times-circle\"></i> You needed {needed} more correct answers. Review the material and try again!",
                "footer_text": "Part of the Road to Free Open AGI Project",
                // Module 14 Questions & Options
                "q14_1_q": "What is the primary characteristic of a `while` loop?",
                "q14_1_o": ["It runs a fixed number of times specified by `range()`.", "It continues to execute as long as a specific condition remains `True`.", "It iterates over items in a sequence (like a list or string).", "It always executes at least once before checking the condition."],
                "q14_2_q": "Consider this code: `count = 0\nwhile count < 5:\n  print(count)\n  count += 1`. What is the last number printed?",
                "q14_2_o": ["3", "4", "5", "The loop never stops."],
                "q14_3_q": "What typically causes an infinite `while` loop?",
                "q14_3_o": ["Using `break` inside the loop.", "The loop condition starting as `False`.", "Forgetting to update the variable(s) involved in the loop condition.", "Using `continue` too often."],
                "q14_4_q": "In the code `while True:\n  user_input = input('Enter command: ')\n  if user_input == 'quit':\n    break\n  print(f'Executing: {user_input}')`, what is the purpose of `break`?",
                "q14_4_o": ["To skip the current iteration and start the next.", "To signal an error.", "To exit the `while` loop immediately.", "To pause the program execution."],
                "q14_5_q": "Which scenario is generally better suited for a `while` loop than a `for` loop?",
                "q14_5_o": ["Iterating through all characters in a string.", "Printing numbers from 1 to 10.", "Repeating an action until a specific condition is met (e.g., user enters 'done').", "Accessing each element in a list by index."],
                "q14_6_q": "What will happen if the condition in a `while` loop is initially `False`?",
                "q14_6_o": ["The loop body will execute exactly once.", "The program will produce an error.", "The loop body will never execute.", "The loop will run indefinitely."],
                "q14_7_q": "Examine this loop: `x = 10\nwhile x > 0:\n  print(x)\n  x -= 2`. What sequence of numbers will be printed?",
                "q14_7_o": ["10, 8, 6, 4, 2, 0", "10, 8, 6, 4, 2", "9, 7, 5, 3, 1", "10, 9, 8, 7, 6, 5, 4, 3, 2, 1"],
                "q14_8_q": "What is the role of the condition (`count < 3`) in `count = 0\nwhile count < 3:\n print('Looping')\n count += 1`?",
                "q14_8_o": ["It determines how many times the loop has already run.", "It's checked *after* each execution of the loop body.", "It's checked *before* each potential execution of the loop body.", "It specifies the value to increment `count` by."],
                "q14_9_q": "Consider `password = ''\nwhile password != 'secret':\n  password = input('Enter password: ') \nprint('Access granted')`. When does the loop stop?",
                "q14_9_o": ["Immediately, because the initial condition is false.", "After the user enters 'secret'.", "After the first time the user enters any input.", "Never, it's an infinite loop."],
                "q14_10_q": "Which of these is crucial for ensuring a `while` loop eventually terminates (unless designed to be infinite)?",
                "q14_10_o": ["Using `print()` inside the loop.", "Having a `continue` statement.", "Ensuring the loop's condition can eventually become `False`.", "Initializing the loop variable to 0."]
            },
            pt: {
                "kc14_page_title": "Verificação de Conhecimento: Módulo 14 - Loops (while)",
                "kc14_header_title": "Módulo 14: Loops While",
                "kc_back_button": "Voltar ao Painel",
                "lang_select_aria": "Selecionar Idioma",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "kc_instruction_1": "Instruções:",
                "kc_instruction_2": "Selecione a melhor resposta para cada pergunta.",
                "kc_instruction_3": "Você precisa de pelo menos 6 de 10 respostas corretas para passar.",
                "kc_passing_score": "6 de 10",
                "kc_instruction_4": "Você pode tentar quantas vezes precisar. Passar marca este módulo como concluído no painel.",
                "kc_submit_button": "Enviar Respostas",
                "kc_retry_button": "Tentar Novamente",
                "kc_result_pass_message": "Parabéns! Você Passou!",
                "kc_result_fail_message": "Continue Tentando!",
                "kc_result_score_text": "Sua pontuação: {score} de {total}",
                "kc_result_feedback_pass": "<i class=\"fas fa-check-circle\"></i> Módulo {id} marcado como concluído!",
                "kc_result_feedback_fail": "<i class=\"fas fa-times-circle\"></i> Você precisava de mais {needed} respostas corretas. Revise o material e tente novamente!",
                "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // Module 14 Questions & Options - PT
                "q14_1_q": "Qual é a característica principal de um loop `while`?",
                "q14_1_o": ["Ele executa um número fixo de vezes especificado por `range()`.", "Ele continua a executar enquanto uma condição específica permanecer `True`.", "Ele itera sobre itens em uma sequência (como lista ou string).", "Ele sempre executa pelo menos uma vez antes de verificar a condição."],
                "q14_2_q": "Considere este código: `count = 0\nwhile count < 5:\n  print(count)\n  count += 1`. Qual é o último número impresso?",
                "q14_2_o": ["3", "4", "5", "O loop nunca para."],
                "q14_3_q": "O que tipicamente causa um loop `while` infinito?",
                "q14_3_o": ["Usar `break` dentro do loop.", "A condição do loop começar como `False`.", "Esquecer de atualizar a(s) variável(is) envolvida(s) na condição do loop.", "Usar `continue` com muita frequência."],
                "q14_4_q": "No código `while True:\n  user_input = input('Digite comando: ')\n  if user_input == 'quit':\n    break\n  print(f'Executando: {user_input}')`, qual o propósito do `break`?",
                "q14_4_o": ["Pular a iteração atual e começar a próxima.", "Sinalizar um erro.", "Sair do loop `while` imediatamente.", "Pausar a execução do programa."],
                "q14_5_q": "Qual cenário é geralmente mais adequado para um loop `while` do que para um loop `for`?",
                "q14_5_o": ["Iterar por todos os caracteres de uma string.", "Imprimir números de 1 a 10.", "Repetir uma ação até que uma condição específica seja atendida (ex: usuário digita 'done').", "Acessar cada elemento de uma lista pelo índice."],
                "q14_6_q": "O que acontecerá se a condição em um loop `while` for inicialmente `False`?",
                "q14_6_o": ["O corpo do loop executará exatamente uma vez.", "O programa produzirá um erro.", "O corpo do loop nunca executará.", "O loop rodará indefinidamente."],
                "q14_7_q": "Examine este loop: `x = 10\nwhile x > 0:\n  print(x)\n  x -= 2`. Qual sequência de números será impressa?",
                "q14_7_o": ["10, 8, 6, 4, 2, 0", "10, 8, 6, 4, 2", "9, 7, 5, 3, 1", "10, 9, 8, 7, 6, 5, 4, 3, 2, 1"],
                "q14_8_q": "Qual é o papel da condição (`count < 3`) em `count = 0\nwhile count < 3:\n print('Looping')\n count += 1`?",
                "q14_8_o": ["Determina quantas vezes o loop já executou.", "É verificada *após* cada execução do corpo do loop.", "É verificada *antes* de cada execução potencial do corpo do loop.", "Especifica o valor a ser incrementado em `count`."],
                "q14_9_q": "Considere `password = ''\nwhile password != 'secret':\n  password = input('Digite a senha: ') \nprint('Acesso concedido')`. Quando o loop para?",
                "q14_9_o": ["Imediatamente, porque a condição inicial é falsa.", "Depois que o usuário digita 'secret'.", "Depois da primeira vez que o usuário digita qualquer entrada.", "Nunca, é um loop infinito."],
                "q14_10_q": "Qual destes é crucial para garantir que um loop `while` eventualmente termine (a menos que projetado para ser infinito)?",
                "q14_10_o": ["Usar `print()` dentro do loop.", "Ter uma instrução `continue`.", "Garantir que a condição do loop possa eventualmente se tornar `False`.", "Inicializar a variável do loop com 0."]
            },
            zh: {
                "kc14_page_title": "知识测验: 模块 14 - 循环 (while)",
                "kc14_header_title": "模块 14: While 循环",
                "kc_back_button": "返回仪表板",
                "lang_select_aria": "选择语言",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "kc_instruction_1": "说明:",
                "kc_instruction_2": "为每个问题选择最佳答案。",
                "kc_instruction_3": "您至少需要答对 10 个问题中的 6 个才能通过。",
                "kc_passing_score": "10 个中的 6 个",
                "kc_instruction_4": "您可以根据需要重试多次。通过后，此模块将在仪表板上标记为完成。",
                "kc_submit_button": "提交答案",
                "kc_retry_button": "重试测验",
                "kc_result_pass_message": "恭喜！您已通过！",
                "kc_result_fail_message": "请继续努力！",
                "kc_result_score_text": "您的得分：{total} 题中答对 {score} 题",
                "kc_result_feedback_pass": "<i class=\"fas fa-check-circle\"></i> 模块 {id} 已标记为完成！",
                "kc_result_feedback_fail": "<i class=\"fas fa-times-circle\"></i> 您还需要答对 {needed} 题。请复习内容后重试！",
                "footer_text": "通往自由开放AGI之路项目的一部分",
                // Module 14 Questions & Options - ZH
                "q14_1_q": "`while` 循环的主要特点是什么？",
                "q14_1_o": ["它运行由 `range()` 指定的固定次数。", "只要特定条件保持为 `True`，它就继续执行。", "它遍历序列（如列表或字符串）中的项目。", "它总是在检查条件之前至少执行一次。"],
                "q14_2_q": "考虑这段代码: `count = 0\nwhile count < 5:\n  print(count)\n  count += 1`。打印的最后一个数字是什么？",
                "q14_2_o": ["3", "4", "5", "循环永不停止。"],
                "q14_3_q": "什么通常会导致无限 `while` 循环？",
                "q14_3_o": ["在循环内部使用 `break`。", "循环条件开始时为 `False`。", "忘记更新循环条件中涉及的变量。", "过于频繁地使用 `continue`。"],
                "q14_4_q": "在代码 `while True:\n  user_input = input('输入命令: ')\n  if user_input == 'quit':\n    break\n  print(f'正在执行: {user_input}')` 中，`break` 的目的是什么？",
                "q14_4_o": ["跳过当前迭代并开始下一次迭代。", "表示错误。", "立即退出 `while` 循环。", "暂停程序执行。"],
                "q14_5_q": "哪种情况通常更适合使用 `while` 循环而不是 `for` 循环？",
                "q14_5_o": ["遍历字符串中的所有字符。", "打印从 1 到 10 的数字。", "重复一个动作直到满足特定条件（例如，用户输入 'done'）。", "按索引访问列表中的每个元素。"],
                "q14_6_q": "如果 `while` 循环中的条件最初为 `False`，会发生什么？",
                "q14_6_o": ["循环体将精确执行一次。", "程序将产生错误。", "循环体将永远不会执行。", "循环将无限期运行。"],
                "q14_7_q": "检查这个循环：`x = 10\nwhile x > 0:\n  print(x)\n  x -= 2`。将打印什么数字序列？",
                "q14_7_o": ["10, 8, 6, 4, 2, 0", "10, 8, 6, 4, 2", "9, 7, 5, 3, 1", "10, 9, 8, 7, 6, 5, 4, 3, 2, 1"],
                "q14_8_q": "在 `count = 0\nwhile count < 3:\n print('Looping')\n count += 1` 中，条件 (`count < 3`) 的作用是什么？",
                "q14_8_o": ["它确定循环已经运行了多少次。", "它在循环体每次执行*之后*被检查。", "它在循环体每次潜在执行*之前*被检查。", "它指定 `count` 增加的值。"],
                "q14_9_q": "考虑 `password = ''\nwhile password != 'secret':\n  password = input('输入密码: ') \nprint('访问已授权')`。循环什么时候停止？",
                "q14_9_o": ["立即停止，因为初始条件为假。", "在用户输入 'secret' 之后。", "在用户第一次输入任何内容之后。", "永不停止，这是一个无限循环。"],
                "q14_10_q": "以下哪项对于确保 `while` 循环最终终止（除非设计为无限循环）至关重要？",
                "q14_10_o": ["在循环内部使用 `print()`。", "有一个 `continue` 语句。", "确保循环的条件最终能够变为 `False`。", "将循环变量初始化为 0。"]
            }
        };

        // --- Quiz Data ---
        const quizData = [
            { question_key: "q14_1_q", options_key: "q14_1_o", correct_answer_index: 1 },
            { question_key: "q14_2_q", options_key: "q14_2_o", correct_answer_index: 1 },
            { question_key: "q14_3_q", options_key: "q14_3_o", correct_answer_index: 2 },
            { question_key: "q14_4_q", options_key: "q14_4_o", correct_answer_index: 2 },
            { question_key: "q14_5_q", options_key: "q14_5_o", correct_answer_index: 2 },
            { question_key: "q14_6_q", options_key: "q14_6_o", correct_answer_index: 2 },
            { question_key: "q14_7_q", options_key: "q14_7_o", correct_answer_index: 1 },
            { question_key: "q14_8_q", options_key: "q14_8_o", correct_answer_index: 2 },
            { question_key: "q14_9_q", options_key: "q14_9_o", correct_answer_index: 1 },
            { question_key: "q14_10_q", options_key: "q14_10_o", correct_answer_index: 2 }
        ];

         // --- Core Functions (Translation, LocalStorage, UI Update) ---
        let currentLanguage = 'en'; // Default language

        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            currentLanguage = lang;
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            document.documentElement.lang = lang;
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;
            translatePage(lang);
            // Re-render questions if already displayed
            const questionsWrapper = document.getElementById('questions-wrapper');
            if (questionsWrapper.children.length > 0 && !document.getElementById('quiz-form').classList.contains('quiz-submitted')) {
                renderQuestions(); // Re-render to update question/option text
            }
            // Update result text if quiz was submitted
            const resultsDiv = document.getElementById('quiz-results');
            if (resultsDiv.classList.contains('show')) {
                updateResultText(); // Function to specifically update result text based on stored score/pass status
            }
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            // Basic HTML tag handling for simple cases like <strong> or <code>
             const allowedTags = ['strong', 'code', 'i', 'br'];
             const tagRegex = new RegExp(`</?(${allowedTags.join('|')})>`, 'gi');
             // This is a basic sanitizer, be careful if translations become complex
             text = text.replace(/<(?!\/?(strong|code|i|br)\b)[^>]*>/gi, ''); // Remove potentially harmful tags
             return text;
        }


        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                if (el.tagName === 'TITLE') { document.title = translation; }
                else if (el.tagName === 'BUTTON' || el.tagName === 'A' || el.tagName === 'OPTION') {
                    // For elements where only text content matters primarily
                     el.textContent = translation.replace(/<[^>]*>/g, ''); // Strip potential tags for simple elements
                 } else {
                    // Use innerHTML for elements that might contain formatting (like instructions)
                     el.innerHTML = translation;
                 }
            });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang).replace(/<[^>]*>/g, ''));
             });
        }

        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                if (typeof parsed === 'object' && parsed !== null && !Array.isArray(parsed)) {
                    return parsed;
                }
                 console.warn("Invalid KC status found in localStorage. Resetting.");
                 return {};
             } catch (e) {
                 console.error("Error reading KC status from localStorage:", e);
                 return {}; // Return empty object on error
             }
        }

         function saveKnowledgeCheckStatus(statusObject) {
             try {
                 localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
             } catch (e) {
                 console.error("Error saving KC status to localStorage:", e);
             }
         }

        // --- Quiz Logic ---
        const quizForm = document.getElementById('quiz-form');
        const questionsWrapper = document.getElementById('questions-wrapper');
        const submitButton = document.getElementById('submit-button');
        const retryButton = document.getElementById('retry-button');
        const resultsDiv = document.getElementById('quiz-results');
        const resultMessageEl = document.getElementById('result-message');
        const resultScoreEl = document.getElementById('result-score');
        const resultFeedbackEl = document.getElementById('result-feedback');

        let currentScore = 0;
        let quizSubmitted = false;

        function renderQuestions() {
            questionsWrapper.innerHTML = ''; // Clear existing questions
            quizData.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.setAttribute('data-question-index', index);

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                // Using innerHTML safely because getTranslation handles basic tags
                 questionText.innerHTML = `<span class="q-number">${index + 1}</span> ${getTranslation(q.question_key, currentLanguage)}`;

                const optionsList = document.createElement('ul');
                optionsList.classList.add('quiz-options');

                const options = getTranslation(q.options_key, currentLanguage); // Get options array for the current language
                 if (Array.isArray(options)) {
                    options.forEach((optionText, optionIndex) => {
                        const optionItem = document.createElement('li');
                        optionItem.classList.add('quiz-option');

                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        radioInput.name = `question_${index}`;
                        radioInput.value = optionIndex;
                        radioInput.id = `q${index}_option${optionIndex}`;
                        radioInput.required = true; // Make selection required

                         const label = document.createElement('label');
                         label.htmlFor = `q${index}_option${optionIndex}`;
                         // Using innerHTML here because options might contain <code> tags
                         label.innerHTML = optionText;

                         optionItem.appendChild(radioInput);
                         optionItem.appendChild(label);
                         optionsList.appendChild(optionItem);
                    });
                } else {
                    console.error(`Options for key ${q.options_key} are not an array in language ${currentLanguage}.`);
                     questionText.innerHTML += `<br><i style='color:red;'>Error loading options.</i>`; // Provide feedback
                 }

                questionBlock.appendChild(questionText);
                questionBlock.appendChild(optionsList);
                questionsWrapper.appendChild(questionBlock);
            });
        }

        function handleSubmit(event) {
            event.preventDefault();
            if (quizSubmitted) return; // Prevent re-submission

            currentScore = 0;
            quizSubmitted = true;
            quizForm.classList.add('quiz-submitted'); // Add class to disable hover effects etc.

            quizData.forEach((q, index) => {
                const questionBlock = questionsWrapper.querySelector(`[data-question-index="${index}"]`);
                const selectedOptionInput = questionBlock.querySelector(`input[name="question_${index}"]:checked`);
                const options = questionBlock.querySelectorAll('.quiz-option');

                options.forEach(opt => opt.querySelector('input').disabled = true); // Disable radios

                if (selectedOptionInput) {
                    const selectedAnswerIndex = parseInt(selectedOptionInput.value, 10);
                    const correctOptionIndex = q.correct_answer_index;
                    const selectedOptionLi = selectedOptionInput.closest('.quiz-option');

                    selectedOptionLi.classList.add('user-selected');

                    if (selectedAnswerIndex === correctOptionIndex) {
                        currentScore++;
                        selectedOptionLi.classList.add('correct-answer');
                    } else {
                        selectedOptionLi.classList.add('incorrect-answer');
                        // Also highlight the correct answer if the user was wrong
                        const correctOptionLi = questionBlock.querySelector(`input[value="${correctOptionIndex}"]`).closest('.quiz-option');
                        if (correctOptionLi) {
                            correctOptionLi.classList.add('correct-answer');
                        }
                    }
                } else {
                    // If no answer was selected (shouldn't happen with 'required', but good practice)
                    // Optionally mark the correct answer anyway
                    const correctOptionLi = questionBlock.querySelector(`input[value="${q.correct_answer_index}"]`).closest('.quiz-option');
                     if (correctOptionLi) {
                         correctOptionLi.classList.add('correct-answer'); // Show correct one
                     }
                }
            });

            displayResults();
        }

        function displayResults() {
            const passed = currentScore >= passingScore;
            updateResultText(passed); // Update text content first

            resultsDiv.classList.remove('pass', 'fail'); // Clear previous status classes
            if (passed) {
                resultMessageEl.classList.add('pass');
                resultFeedbackEl.classList.add('pass');
                resultsDiv.classList.add('pass'); // Add class to results div for potential styling
                // --- Save Progress on Pass ---
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[moduleId] = true; // Mark this module as complete
                saveKnowledgeCheckStatus(currentStatus);
                // --- End Save Progress ---
            } else {
                resultMessageEl.classList.add('fail');
                resultFeedbackEl.classList.add('fail');
                 resultsDiv.classList.add('fail');
            }

            resultsDiv.classList.add('show'); // Make results visible
            submitButton.style.display = 'none';
            retryButton.style.display = 'inline-block';
             resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Function to update result text based on current language and score
        function updateResultText(passed = currentScore >= passingScore) {
             resultScoreEl.textContent = getTranslation('kc_result_score_text', currentLanguage, { score: currentScore, total: quizData.length });

            if (passed) {
                 resultMessageEl.textContent = getTranslation('kc_result_pass_message', currentLanguage);
                 resultFeedbackEl.innerHTML = getTranslation('kc_result_feedback_pass', currentLanguage, { id: moduleId });
            } else {
                 resultMessageEl.textContent = getTranslation('kc_result_fail_message', currentLanguage);
                 const needed = passingScore - currentScore;
                 resultFeedbackEl.innerHTML = getTranslation('kc_result_feedback_fail', currentLanguage, { needed: needed });
            }
        }


        function handleRetry() {
            quizSubmitted = false;
            currentScore = 0;
            quizForm.classList.remove('quiz-submitted');
            resultsDiv.classList.remove('show', 'pass', 'fail');
            submitButton.style.display = 'inline-block';
            retryButton.style.display = 'none';

            // Clear selections and feedback
            const allOptions = questionsWrapper.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => {
                opt.classList.remove('user-selected', 'correct-answer', 'incorrect-answer');
                const input = opt.querySelector('input[type="radio"]');
                 if (input) {
                     input.checked = false;
                     input.disabled = false;
                 }
            });

            // Scroll back to the top of the quiz
            quizForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // --- Event Listeners ---
        quizForm.addEventListener('submit', handleSubmit);
        retryButton.addEventListener('click', handleRetry);

        // Language Switcher Setup
        const languageSelectElement = document.getElementById('languageSelect');
        if (languageSelectElement) {
             languageSelectElement.addEventListener('change', (e) => {
                 setLanguage(e.target.value);
             });
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            currentLanguage = initialLang; // Set global language variable
            const langSelect = document.getElementById('languageSelect');
            if(langSelect) langSelect.value = initialLang; // Set dropdown value
            translatePage(initialLang); // Translate static text
            renderQuestions(); // Render questions in the selected language
        });

    </script>

</body>
</html>