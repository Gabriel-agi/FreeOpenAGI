<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title_kc14">Knowledge Check: Module 14</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for KC icon color */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-top: 20px; /* Space for back button */
        }

        /* --- General Layout --- */
        .quiz-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem 2.5rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        /* --- Back Button --- */
        .back-button {
            display: inline-block;
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 0.6rem 1.2rem;
            background-color: var(--secondary-color);
            color: var(--text-light);
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color var(--transition-speed);
        }
        .back-button i { margin-right: 6px; }
        .back-button:hover { background-color: #5a6268; color: var(--text-light); }

        /* --- Language Switcher --- */
         .language-switcher-container {
            position: absolute;
            top: 20px;
            right: 20px;
         }
         #languageSelect {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            padding: 8px 30px 8px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--secondary-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: #5a6268; }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option { background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px; }

        /* --- Quiz Header --- */
        .quiz-header h1 {
            font-family: var(--font-title);
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        .quiz-header h1 i {
            margin-right: 10px;
            color: var(--check-color); /* Icon color specific to KC */
        }
        .quiz-header .module-number {
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--text-muted);
            background-color: var(--background-page);
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 10px;
        }
        .quiz-instructions {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            background-color: #e9f5ff;
            padding: 0.8rem 1.2rem;
            border-left: 4px solid var(--info-color);
            border-radius: 4px;
        }
        .quiz-instructions strong { color: var(--text-dark); }
        .quiz-instructions i { margin-right: 5px; }

        /* --- Quiz Form & Questions --- */
        #quiz-form { counter-reset: question-counter; }
        .question-block {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #fdfdff; /* Slightly off-white */
        }
        .question-block:last-of-type { margin-bottom: 1.5rem; }
        .question-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
            display: flex;
        }
        .question-text::before {
             counter-increment: question-counter;
             content: counter(question-counter) ". ";
             font-weight: 700;
             margin-right: 8px;
             color: var(--primary-color);
        }
        .question-text code {
             font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
             background-color: #e9ecef;
             padding: 0.1em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e;
        }

        /* --- Options --- */
        .options { display: flex; flex-direction: column; gap: 0.7rem; }
        .options label {
            display: block;
            padding: 0.8rem 1.2rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            background-color: var(--background-card);
            position: relative; /* For feedback icons */
        }
        .options label:hover { background-color: #f8f9fa; border-color: var(--secondary-color); }
        .options input[type="radio"] { margin-right: 10px; accent-color: var(--primary-color); transform: scale(1.1); }
        .options input[type="radio"]:focus + span { /* Optional: add focus style */ outline: 1px dotted var(--primary-color); }
        .options label span code { /* Style code within options */
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
             background-color: #e9ecef;
             padding: 0.1em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e;
        }

        /* --- Feedback Styles (Applied after submit) --- */
        .options label.correct {
            background-color: #d1e7dd; /* Light green */
            border-color: var(--success-color);
            color: #0f5132;
            font-weight: 500;
        }
        .options label.incorrect {
            background-color: #f8d7da; /* Light red */
            border-color: var(--error-color);
            color: #842029;
        }
        .options label.correct::after,
        .options label.incorrect.selected::after {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
        }
        .options label.correct::after { content: '\f00c'; color: var(--success-color); } /* Checkmark */
        .options label.incorrect.selected::after { content: '\f00d'; color: var(--error-color); } /* X mark */

        /* Disable input interaction after submit */
        #quiz-form.submitted .options label { cursor: default; }
        #quiz-form.submitted .options label:hover { background-color: initial; border-color: initial; }
        #quiz-form.submitted .options input[type="radio"] { pointer-events: none; }
        #quiz-form.submitted .options label.correct:hover { background-color: #d1e7dd; border-color: var(--success-color); }
        #quiz-form.submitted .options label.incorrect:hover { background-color: #f8d7da; border-color: var(--error-color); }

        /* --- Buttons --- */
        .quiz-buttons { text-align: center; margin-top: 2rem; }
        .quiz-buttons button {
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            border: none;
        }
        .quiz-buttons button:hover { transform: scale(1.03); }
        #submit-quiz-button {
            background-color: var(--primary-color);
            color: var(--text-light);
            margin-right: 1rem; /* Space between buttons */
        }
        #submit-quiz-button:hover { background-color: #0b5ed7; }
        #submit-quiz-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }
        #retake-quiz-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
            display: none; /* Hidden initially */
        }
        #retake-quiz-button:hover { background-color: #5a6268; }

        /* --- Results Area --- */
        #quiz-results {
            margin-top: 2.5rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden initially */
            border: 1px solid var(--border-color);
        }
        #quiz-results p { margin-bottom: 0.5rem; font-size: 1.1rem; }
        #quiz-results .score { font-weight: 700; font-size: 1.3rem; color: var(--text-dark); }
        #quiz-results .pass { color: var(--success-color); font-weight: 700; font-size: 1.2rem; }
        #quiz-results .fail { color: var(--error-color); font-weight: 700; font-size: 1.2rem; }
        #quiz-results i { margin-right: 8px; }

        /* --- Footer --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            .quiz-container { margin: 1rem; padding: 1.5rem; }
            .back-button { position: static; display: block; margin-bottom: 1rem; text-align: center; }
            .language-switcher-container { position: static; margin-bottom: 1rem; text-align: center; }
            .quiz-header h1 { font-size: 1.5rem; }
            .question-text { font-size: 1rem; }
            .options label { padding: 0.7rem 1rem; }
        }
         @media (max-width: 576px) {
             html { font-size: 15px; }
             .quiz-container { padding: 1rem 1.2rem; }
             .quiz-header h1 { font-size: 1.4rem; }
             .quiz-instructions { font-size: 0.9rem; padding: 0.6rem 1rem; }
             .question-block { padding: 1rem; }
             .question-text { font-size: 0.95rem; }
             .options label { font-size: 0.9rem; padding: 0.6rem 0.8rem; }
             .quiz-buttons button { font-size: 1rem; padding: 0.7rem 1.5rem; }
             #quiz-results { padding: 1rem; }
             #quiz-results p { font-size: 1rem; }
             #quiz-results .score { font-size: 1.15rem; }
             #quiz-results .pass, #quiz-results .fail { font-size: 1.1rem; }
         }

    </style>
</head>
<body>

    <!-- Back Button -->
    <a href="ctp-dashboard.html" class="back-button" data-translate="back_to_dashboard">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>

    <!-- Language Switcher -->
    <div class="language-switcher-container">
         <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
             <option value="en" data-translate="lang_en">🇬🇧 English</option>
             <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
             <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
         </select>
     </div>

    <div class="quiz-container">
        <header class="quiz-header">
            <h1>
                <i class="fas fa-check-double"></i>
                <span data-translate="quiz_title_kc14">Knowledge Check</span>: <span class="module-number">14</span> <span data-translate="module_14_title_short">Conditional Loops (while)</span>
            </h1>
        </header>

        <p class="quiz-instructions" data-translate="quiz_instructions_kc14">
             <i class="fas fa-info-circle"></i> Select the best answer for each question. You need at least <strong>6 out of 10</strong> correct answers to pass. You can retake this check as many times as needed. Passing marks this module as complete on your dashboard.
        </p>

        <form id="quiz-form">
            <!-- Questions will be loaded here by JavaScript -->
        </form>

        <div id="quiz-results">
            <!-- Results will be shown here -->
        </div>

        <div class="quiz-buttons">
            <button type="submit" id="submit-quiz-button" form="quiz-form" data-translate="submit_quiz">Submit Answers</button>
            <button type="button" id="retake-quiz-button" data-translate="retake_quiz">Retake Quiz</button>
        </div>

    </div>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Constants ---
        const MODULE_ID = 14; // *** This MUST match the module number ***
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Quiz Questions Data ---
        // Structure: { id: 'q14_X', correctAnswer: 'a'/'b'/'c'/'d' }
        // Translation keys: q14_X_question, q14_X_option_a, q14_X_option_b, ...
        const quizQuestionsData = [
            { id: 'q14_1', correctAnswer: 'c' }, // Correct syntax check
            { id: 'q14_2', correctAnswer: 'a' }, // Purpose of while
            { id: 'q14_3', correctAnswer: 'b' }, // Avoiding infinite loops
            { id: 'q14_4', correctAnswer: 'd' }, // Identifying infinite loop
            { id: 'q14_5', correctAnswer: 'a' }, // while True needs break
            { id: 'q14_6', correctAnswer: 'c' }, // while vs for
            { id: 'q14_7', correctAnswer: 'b' }, // Predicting output
            { id: 'q14_8', correctAnswer: 'd' }, // Using input() to stop
            { id: 'q14_9', correctAnswer: 'a' }, // Counter variable usage
            { id: 'q14_10', correctAnswer: 'c' }, // How to terminate a loop
        ];

        // --- Translations Object ---
        const translations = {
            en: {
                "page_title_kc14": "Knowledge Check: Module 14 - While Loops",
                "back_to_dashboard": "Back to Dashboard",
                "quiz_title_kc14": "Knowledge Check",
                "module_14_title_short": "Conditional Loops (while)",
                "quiz_instructions_kc14": "<i class=\"fas fa-info-circle\"></i> Select the best answer for each question. You need at least <strong>6 out of 10</strong> correct answers to pass. You can retake this check as many times as needed. Passing marks this module as complete on your dashboard.",
                "submit_quiz": "Submit Answers",
                "retake_quiz": "Retake Quiz",
                "result_score": "Your score: {score} out of {total}",
                "result_pass": "<i class=\"fas fa-check-circle\"></i> Congratulations! You passed. Module 14 progress updated.",
                "result_fail": "<i class=\"fas fa-times-circle\"></i> You need {passingScore} correct answers to pass. Keep trying!",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                "footer_text": "Part of the Road to Free Open AGI Project",

                // Questions for Module 14
                "q14_1_question": "Which of the following is the correct basic syntax for a `while` loop in Python?",
                "q14_1_option_a": "`while condition`",
                "q14_1_option_b": "`while (condition);`",
                "q14_1_option_c": "`while condition:`",
                "q14_1_option_d": "`loop while condition:`",

                "q14_2_question": "What is the primary purpose of a `while` loop?",
                "q14_2_option_a": "To repeat a block of code as long as a certain condition is `True`.",
                "q14_2_option_b": "To repeat a block of code a fixed number of times.",
                "q14_2_option_c": "To execute a block of code only once if a condition is `True`.",
                "q14_2_option_d": "To define a function.",

                "q14_3_question": "What is essential to include *inside* the body of most `while` loops to prevent them from running forever (infinite loop)?",
                "q14_3_option_a": "A `print()` statement.",
                "q14_3_option_b": "Code that eventually makes the loop's condition `False`.",
                "q14_3_option_c": "An `if` statement.",
                "q14_3_option_d": "A comment explaining the loop.",

                "q14_4_question": "Consider this code: `count = 0\nwhile count < 5:\n  print(\"Hello\")` What will happen when this code runs?",
                "q14_4_option_a": "It will print \"Hello\" 5 times.",
                "q14_4_option_b": "It will print \"Hello\" 4 times.",
                "q14_4_option_c": "It will cause a syntax error.",
                "q14_4_option_d": "It will result in an infinite loop printing \"Hello\".",

                "q14_5_question": "If you use `while True:`, what statement is typically needed inside the loop to eventually stop it?",
                "q14_5_option_a": "`break`",
                "q14_5_option_b": "`continue`",
                "q14_5_option_c": "`pass`",
                "q14_5_option_d": "`return`",

                "q14_6_question": "What is a key difference between a `while` loop and a `for` loop (like `for i in range(5):`)?",
                "q14_6_option_a": "`while` loops cannot use numbers.",
                "q14_6_option_b": "`for` loops are always faster.",
                "q14_6_option_c": "`while` loops repeat based on a condition; `for` loops typically iterate over a sequence or range.",
                "q14_6_option_d": "Only `for` loops can have `else` blocks.",

                "q14_7_question": "What will be the final value of `x` after this code runs? \n`x = 10\nwhile x > 5:\n  x = x - 2`",
                "q14_7_option_a": "5",
                "q14_7_option_b": "4",
                "q14_7_option_c": "6",
                "q14_7_option_d": "10",

                "q14_8_question": "How can you use `input()` to control a `while` loop, allowing the user to decide when to stop?",
                "q14_8_option_a": "It's not possible; `input()` only works outside loops.",
                "q14_8_option_b": "Use `while input():`",
                "q14_8_option_c": "Compare the result of `input()` to a specific 'quit' value inside the loop.",
                "q14_8_option_d": "Wrap the entire `while` loop inside an `input()` call.",

                "q14_9_question": "Consider this code: `i = 1\nwhile i <= 3:\n  print(i)\n  i += 1` What is the output?",
                "q14_9_option_a": "1\n2\n3",
                "q14_9_option_b": "1\n2",
                "q14_9_option_c": "1\n2\n3\n4",
                "q14_9_option_d": "An error occurs.",

                "q14_10_question": "Besides the condition becoming `False`, what is another common way to exit a `while` loop prematurely?",
                "q14_10_option_a": "Using the `pass` statement.",
                "q14_10_option_b": "Using the `continue` statement.",
                "q14_10_option_c": "Using the `break` statement.",
                "q14_10_option_d": "Deleting the loop variable.",
            },
            pt: {
                 "page_title_kc14": "Verificação: Módulo 14 - Loops While",
                 "back_to_dashboard": "Voltar ao Painel",
                 "quiz_title_kc14": "Verificação de Conhecimento",
                 "module_14_title_short": "Loops Condicionais (while)",
                 "quiz_instructions_kc14": "<i class=\"fas fa-info-circle\"></i> Selecione a melhor resposta para cada pergunta. Você precisa de pelo menos <strong>6 de 10</strong> respostas corretas para passar. Pode refazer esta verificação quantas vezes precisar. Passar marca este módulo como completo no seu painel.",
                 "submit_quiz": "Enviar Respostas",
                 "retake_quiz": "Refazer Verificação",
                 "result_score": "Sua pontuação: {score} de {total}",
                 "result_pass": "<i class=\"fas fa-check-circle\"></i> Parabéns! Você passou. Progresso do Módulo 14 atualizado.",
                 "result_fail": "<i class=\"fas fa-times-circle\"></i> Você precisa de {passingScore} respostas corretas para passar. Continue tentando!",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",

                 // Questions PT
                "q14_1_question": "Qual das seguintes opções é a sintaxe básica correta para um loop `while` em Python?",
                "q14_1_option_a": "`while condicao`",
                "q14_1_option_b": "`while (condicao);`",
                "q14_1_option_c": "`while condicao:`",
                "q14_1_option_d": "`loop while condicao:`",

                "q14_2_question": "Qual é o propósito principal de um loop `while`?",
                "q14_2_option_a": "Repetir um bloco de código enquanto uma certa condição for `True`.",
                "q14_2_option_b": "Repetir um bloco de código um número fixo de vezes.",
                "q14_2_option_c": "Executar um bloco de código apenas uma vez se uma condição for `True`.",
                "q14_2_option_d": "Definir uma função.",

                "q14_3_question": "O que é essencial incluir *dentro* do corpo da maioria dos loops `while` para evitar que executem para sempre (loop infinito)?",
                "q14_3_option_a": "Uma instrução `print()`.",
                "q14_3_option_b": "Código que eventualmente torna a condição do loop `False`.",
                "q14_3_option_c": "Uma instrução `if`.",
                "q14_3_option_d": "Um comentário explicando o loop.",

                "q14_4_question": "Considere este código: `contador = 0\nwhile contador < 5:\n  print(\"Olá\")` O que acontecerá quando este código for executado?",
                "q14_4_option_a": "Imprimirá \"Olá\" 5 vezes.",
                "q14_4_option_b": "Imprimirá \"Olá\" 4 vezes.",
                "q14_4_option_c": "Causará um erro de sintaxe.",
                "q14_4_option_d": "Resultará em um loop infinito imprimindo \"Olá\".",

                "q14_5_question": "Se você usar `while True:`, qual instrução é tipicamente necessária dentro do loop para eventualmente pará-lo?",
                "q14_5_option_a": "`break`",
                "q14_5_option_b": "`continue`",
                "q14_5_option_c": "`pass`",
                "q14_5_option_d": "`return`",

                "q14_6_question": "Qual é a diferença chave entre um loop `while` e um loop `for` (como `for i in range(5):`)?",
                "q14_6_option_a": "Loops `while` não podem usar números.",
                "q14_6_option_b": "Loops `for` são sempre mais rápidos.",
                "q14_6_option_c": "Loops `while` repetem com base em uma condição; loops `for` tipicamente iteram sobre uma sequência ou intervalo.",
                "q14_6_option_d": "Apenas loops `for` podem ter blocos `else`.",

                "q14_7_question": "Qual será o valor final de `x` após a execução deste código? \n`x = 10\nwhile x > 5:\n  x = x - 2`",
                "q14_7_option_a": "5",
                "q14_7_option_b": "4",
                "q14_7_option_c": "6",
                "q14_7_option_d": "10",

                "q14_8_question": "Como você pode usar `input()` para controlar um loop `while`, permitindo que o usuário decida quando parar?",
                "q14_8_option_a": "Não é possível; `input()` só funciona fora de loops.",
                "q14_8_option_b": "Use `while input():`",
                "q14_8_option_c": "Compare o resultado de `input()` com um valor específico 'quit' dentro do loop.",
                "q14_8_option_d": "Envolva todo o loop `while` dentro de uma chamada `input()`.",

                "q14_9_question": "Considere este código: `i = 1\nwhile i <= 3:\n  print(i)\n  i += 1` Qual é a saída?",
                "q14_9_option_a": "1\n2\n3",
                "q14_9_option_b": "1\n2",
                "q14_9_option_c": "1\n2\n3\n4",
                "q14_9_option_d": "Ocorre um erro.",

                "q14_10_question": "Além da condição se tornar `False`, qual é outra maneira comum de sair prematuramente de um loop `while`?",
                "q14_10_option_a": "Usando a instrução `pass`.",
                "q14_10_option_b": "Usando a instrução `continue`.",
                "q14_10_option_c": "Usando a instrução `break`.",
                "q14_10_option_d": "Deletando a variável do loop.",
            },
             zh: {
                 "page_title_kc14": "知识测验: 模块 14 - While 循环",
                 "back_to_dashboard": "返回仪表板",
                 "quiz_title_kc14": "知识测验",
                 "module_14_title_short": "条件循环 (while)",
                 "quiz_instructions_kc14": "<i class=\"fas fa-info-circle\"></i> 为每个问题选择最佳答案。您需要至少答对 <strong>10 题中的 6 题</strong> 才能通过。您可以根据需要多次重做此测验。通过后，将在您的仪表板上将此模块标记为完成。",
                 "submit_quiz": "提交答案",
                 "retake_quiz": "重新测验",
                 "result_score": "您的得分: {total} 题中答对 {score} 题",
                 "result_pass": "<i class=\"fas fa-check-circle\"></i> 恭喜！您已通过。模块 14 进度已更新。",
                 "result_fail": "<i class=\"fas fa-times-circle\"></i> 您需要答对 {passingScore} 题才能通过。请继续努力！",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 "footer_text": "通往自由开放AGI之路项目的一部分",

                 // Questions ZH
                 "q14_1_question": "以下哪项是 Python 中 `while` 循环正确的基数语法？",
                 "q14_1_option_a": "`while condition`",
                 "q14_1_option_b": "`while (condition);`",
                 "q14_1_option_c": "`while condition:`",
                 "q14_1_option_d": "`loop while condition:`",

                 "q14_2_question": "`while` 循环的主要目的是什么？",
                 "q14_2_option_a": "只要某个条件为 `True`，就重复执行一段代码块。",
                 "q14_2_option_b": "重复执行代码块固定次数。",
                 "q14_2_option_c": "如果条件为 `True`，则只执行一次代码块。",
                 "q14_2_option_d": "定义一个函数。",

                 "q14_3_question": "为了防止大多数 `while` 循环永远运行（无限循环），*在*循环体内必须包含什么？",
                 "q14_3_option_a": "一个 `print()` 语句。",
                 "q14_3_option_b": "能最终使循环条件变为 `False` 的代码。",
                 "q14_3_option_c": "一个 `if` 语句。",
                 "q14_3_option_d": "解释循环的注释。",

                 "q14_4_question": "考虑这段代码：`count = 0\nwhile count < 5:\n  print(\"Hello\")` 这段代码运行时会发生什么？",
                 "q14_4_option_a": "它将打印 \"Hello\" 5 次。",
                 "q14_4_option_b": "它将打印 \"Hello\" 4 次。",
                 "q14_4_option_c": "它将导致语法错误。",
                 "q14_4_option_d": "它将导致打印 \"Hello\" 的无限循环。",

                 "q14_5_question": "如果你使用 `while True:`，通常需要在循环内部使用哪个语句来最终停止它？",
                 "q14_5_option_a": "`break`",
                 "q14_5_option_b": "`continue`",
                 "q14_5_option_c": "`pass`",
                 "q14_5_option_d": "`return`",

                 "q14_6_question": "`while` 循环和 `for` 循环（例如 `for i in range(5):`）之间的一个关键区别是什么？",
                 "q14_6_option_a": "`while` 循环不能使用数字。",
                 "q14_6_option_b": "`for` 循环总是更快。",
                 "q14_6_option_c": "`while` 循环根据条件重复；`for` 循环通常遍历序列或范围。",
                 "q14_6_option_d": "只有 `for` 循环可以有 `else` 块。",

                 "q14_7_question": "这段代码运行后，`x` 的最终值将是什么？\n`x = 10\nwhile x > 5:\n  x = x - 2`",
                 "q14_7_option_a": "5",
                 "q14_7_option_b": "4",
                 "q14_7_option_c": "6",
                 "q14_7_option_d": "10",

                 "q14_8_question": "你如何使用 `input()` 来控制 `while` 循环，允许用户决定何时停止？",
                 "q14_8_option_a": "不可能；`input()` 只能在循环外工作。",
                 "q14_8_option_b": "使用 `while input():`",
                 "q14_8_option_c": "在循环内部将 `input()` 的结果与特定的“退出”值进行比较。",
                 "q14_8_option_d": "将整个 `while` 循环包装在 `input()` 调用中。",

                 "q14_9_question": "考虑这段代码：`i = 1\nwhile i <= 3:\n  print(i)\n  i += 1` 输出是什么？",
                 "q14_9_option_a": "1\n2\n3",
                 "q14_9_option_b": "1\n2",
                 "q14_9_option_c": "1\n2\n3\n4",
                 "q14_9_option_d": "发生错误。",

                 "q14_10_question": "除了条件变为 `False` 之外，提前退出 `while` 循环的另一种常见方法是什么？",
                 "q14_10_option_a": "使用 `pass` 语句。",
                 "q14_10_option_b": "使用 `continue` 语句。",
                 "q14_10_option_c": "使用 `break` 语句。",
                 "q14_10_option_d": "删除循环变量。",
            }
        };

        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const quizResultsDiv = document.getElementById('quiz-results');
        const submitButton = document.getElementById('submit-quiz-button');
        const retakeButton = document.getElementById('retake-quiz-button');
        const languageSelectElement = document.getElementById('languageSelect');

        // --- Translation Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            // Updated check to ensure 'zh' is recognized correctly
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh'; // Handles zh, zh-CN, zh-TW etc.
            return 'en'; // Default
        }

        function getTranslation(key, lang, replacements = {}) {
            // Fallback logic: current lang -> english -> key itself
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                // Use a more robust regex to avoid issues with special characters in replacements
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            document.documentElement.lang = lang; // Set html lang attribute

            // Update page title
            document.title = getTranslation('page_title_kc14', lang);

            // Update elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                 // Use innerHTML only if the translation contains HTML tags, otherwise use textContent
                 if (translation.includes('<') && translation.includes('>')) {
                    el.innerHTML = translation;
                } else {
                    el.textContent = translation;
                }
            });

             // Update elements with data-translate-aria-label attribute
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
            });

            // Reload quiz questions with the new language
            loadQuiz(lang);
        }

        // --- Quiz Logic Functions ---
        function loadQuiz(lang) {
            quizForm.innerHTML = ''; // Clear previous questions
            quizQuestionsData.forEach((qData, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';
                questionBlock.setAttribute('data-question-id', qData.id);

                const questionText = document.createElement('p');
                questionText.className = 'question-text';
                const questionContent = getTranslation(`${qData.id}_question`, lang);
                 // Handle potential code tags within the question
                questionText.innerHTML = questionContent.replace(/`([^`]+)`/g, '<code>$1</code>');


                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';

                const options = ['a', 'b', 'c', 'd']; // Assuming max 4 options
                options.forEach(optLetter => {
                    const optionKey = `${qData.id}_option_${optLetter}`;
                    const optionText = getTranslation(optionKey, lang);

                    // Only create option if translation exists (handles questions with fewer than 4 options)
                     if (optionText !== `[${optionKey}]`) {
                        const label = document.createElement('label');
                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.name = `q${index}`; // Unique name for each question group
                        input.value = optLetter;
                        input.required = true; // Ensure an answer is selected

                        const span = document.createElement('span');
                        // Handle potential code tags within the option text
                         span.innerHTML = optionText.replace(/`([^`]+)`/g, '<code>$1</code>');


                        label.appendChild(input);
                        label.appendChild(span);
                        optionsDiv.appendChild(label);
                    }
                });

                questionBlock.appendChild(questionText);
                questionBlock.appendChild(optionsDiv);
                quizForm.appendChild(questionBlock);
            });
             // Reset quiz state visually if reloading
             resetQuizVisuals();
        }

        function handleSubmit(event) {
            event.preventDefault(); // Prevent page reload
            if (quizForm.classList.contains('submitted')) return; // Prevent re-submission

            let score = 0;
            const selectedAnswers = {};

            quizQuestionsData.forEach((qData, index) => {
                const questionId = qData.id;
                const questionBlock = quizForm.querySelector(`.question-block[data-question-id="${questionId}"]`);
                const selectedOption = questionBlock.querySelector(`input[name="q${index}"]:checked`);

                if (selectedOption) {
                    const userAnswer = selectedOption.value;
                    selectedAnswers[questionId] = userAnswer;
                    const correctAnswer = qData.correctAnswer;
                    const labels = questionBlock.querySelectorAll('.options label');

                    labels.forEach(label => {
                        const input = label.querySelector('input');
                        label.classList.remove('correct', 'incorrect', 'selected'); // Clear previous feedback

                        if (input.value === correctAnswer) {
                            label.classList.add('correct'); // Mark correct option
                        }
                        if (input.checked) {
                            label.classList.add('selected'); // Mark what user selected
                            if (userAnswer !== correctAnswer) {
                                label.classList.add('incorrect'); // Mark selected incorrect option
                            } else {
                                score++; // Increment score only if selected is correct
                            }
                        }
                        input.disabled = true; // Disable options after submit
                    });
                 } else {
                     // Handle case where a question might not have been answered (though 'required' should prevent this)
                     const labels = questionBlock.querySelectorAll('.options label');
                     labels.forEach(label => {
                         const input = label.querySelector('input');
                         label.classList.remove('correct', 'incorrect', 'selected');
                         if (input.value === qData.correctAnswer) {
                             label.classList.add('correct'); // Still show the correct answer
                         }
                         input.disabled = true;
                     });
                 }
            });

            quizForm.classList.add('submitted'); // Mark form as submitted
            submitButton.disabled = true;
            displayResults(score);
            quizResultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function displayResults(score) {
            const lang = getStoredLanguage();
            const scoreText = getTranslation('result_score', lang, { score: score, total: TOTAL_QUESTIONS });
            let resultMessage = '';
            let resultClass = '';

            if (score >= PASSING_SCORE) {
                resultMessage = getTranslation('result_pass', lang);
                resultClass = 'pass';
                updateKnowledgeCheckStatus(); // Update localStorage on pass
            } else {
                resultMessage = getTranslation('result_fail', lang, { passingScore: PASSING_SCORE });
                resultClass = 'fail';
            }

            quizResultsDiv.innerHTML = `
                <p class="score">${scoreText}</p>
                <p class="${resultClass}">${resultMessage}</p>
            `;
            quizResultsDiv.style.display = 'block';
            retakeButton.style.display = 'inline-block'; // Show retake button
        }

         function resetQuizVisuals() {
             quizForm.classList.remove('submitted');
             submitButton.disabled = false;
             retakeButton.style.display = 'none';
             quizResultsDiv.style.display = 'none';
             quizResultsDiv.innerHTML = '';

             quizForm.querySelectorAll('.options label').forEach(label => {
                 label.classList.remove('correct', 'incorrect', 'selected');
             });
             quizForm.querySelectorAll('input[type="radio"]').forEach(input => {
                 input.disabled = false;
                 input.checked = false;
             });
              // Explicitly call reset on the form element itself
             quizForm.reset();
         }

        function handleRetake() {
            resetQuizVisuals();
            // Optional: Scroll back to the top
            // window.scrollTo({ top: 0, behavior: 'smooth' });
            // Focus the first question's first radio button for accessibility
             const firstRadio = quizForm.querySelector('input[type="radio"]');
             if(firstRadio) {
                 firstRadio.focus();
             }
        }

        // --- LocalStorage Interaction ---
        function loadKnowledgeCheckStatus() {
             try {
                 const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                 const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                 // Basic validation: ensure it's an object
                 return typeof parsed === 'object' && parsed !== null ? parsed : {};
             } catch (e) {
                 console.error("Error reading KC status from localStorage:", e);
                 return {}; // Return empty object on error
             }
         }

        function updateKnowledgeCheckStatus() {
            const currentStatus = loadKnowledgeCheckStatus();
            currentStatus[MODULE_ID] = true; // Mark this module as passed
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                console.log(`Knowledge check status updated for Module ${MODULE_ID}.`);
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
                // Optionally inform the user about the saving issue
                alert("Could not save your progress. Please ensure localStorage is enabled and not full.");
            }
        }

        // --- Language Switcher Setup ---
         function setupLanguageSwitcher() {
             if (languageSelectElement) {
                 languageSelectElement.value = getStoredLanguage(); // Set initial value
                 languageSelectElement.addEventListener('change', (e) => {
                     const selectedLang = e.target.value;
                     localStorage.setItem(LANGUAGE_STORAGE_KEY, selectedLang);
                     translatePage(selectedLang); // Translate and reload quiz
                     // Reset results if language is changed mid-quiz or after completion
                     resetQuizVisuals();
                 });
             }
         }


        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            setupLanguageSwitcher(); // Setup switcher first
            const initialLang = getStoredLanguage(); // Get language
            translatePage(initialLang); // Translate page and load initial quiz content

            quizForm.addEventListener('submit', handleSubmit);
            retakeButton.addEventListener('click', handleRetake);
        });

    </script>

</body>
</html>
