<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 3 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Purple for knowledge checks */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color, var(--check-color)); /* Use check color as fallback */
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color, var(--check-color));
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-bottom: 3rem; /* Space for footer */
        }

        /* --- Header --- */
        .kc-header {
            background: linear-gradient(135deg, #6f42c1, #5a35a0); /* Check color gradient */
            color: var(--text-light);
            padding: 1.5rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .kc-header-left {
            display: flex;
            align-items: center;
        }
        .return-button {
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            border: none;
            padding: 0.6rem 1rem;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
            margin-right: 1.5rem;
        }
        .return-button i { margin-right: 6px; }
        .return-button:hover { background-color: rgba(255, 255, 255, 0.25); }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.8rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15);
            display: inline-flex; /* Align icon and text */
            align-items: center;
        }
         .kc-header h1 i {
             margin-right: 10px;
             font-size: 1.6rem;
             opacity: 0.9;
         }

        .kc-header-right .language-switcher {
             position: relative; /* Needed for custom arrow styling */
             min-width: 150px;
        }
         .kc-header-right #languageSelect {
             background: var(--lang-select-bg);
             color: var(--text-light);
             border: 1px solid var(--lang-select-border);
             border-radius: 5px;
             padding: 8px 35px 8px 15px;
             cursor: pointer;
             font-size: 0.9rem;
             font-weight: 500;
             appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--lang-arrow-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
             background-repeat: no-repeat;
             background-position: right 12px center;
             background-size: 10px auto;
             transition: border-color 0.3s ease, background-color 0.3s ease;
             width: 100%;
         }
         .kc-header-right #languageSelect:hover { border-color: var(--text-light); background-color: var(--lang-select-bg-hover); }
         .kc-header-right #languageSelect:focus { outline: none; border-color: var(--text-light); box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.25); }
         .kc-header-right #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Content --- */
        .kc-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .kc-instructions {
            background-color: var(--background-card);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--card-shadow);
            font-size: 1rem;
            color: var(--text-dark);
            border-left: 5px solid var(--check-color); /* Accent border */
        }
        .kc-instructions p { margin-bottom: 0.5rem; }
        .kc-instructions p:last-child { margin-bottom: 0; }
        .kc-instructions strong { color: var(--primary-color); }
        .kc-instructions .pass-condition { color: var(--success-color); font-weight: 500; }
        .kc-instructions .attempts-info { color: var(--secondary-color); font-weight: 500; }

        /* --- Quiz Form Styling --- */
        #knowledgeCheckForm {
            background-color: var(--background-card);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: var(--card-shadow);
        }

        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .question-block:last-of-type {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .question-block p.question-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
        .question-block p.question-text strong { /* For question number */
            color: var(--check-color);
            margin-right: 8px;
        }
        .question-block code {
            background-color: #e9ecef;
            padding: 0.15em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
            color: #c7254e;
            font-family: monospace;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .options label {
            display: block;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            font-size: 0.95rem;
            position: relative; /* For potential future :checked styling */
        }
        .options label:hover {
            background-color: #e9ecef;
            border-color: var(--secondary-color);
        }

        .options input[type="radio"] {
           margin-right: 10px;
           vertical-align: middle;
           accent-color: var(--check-color); /* Style the radio button itself */
        }

        /* Style for selected label (optional but nice) */
        .options input[type="radio"]:checked + span {
            font-weight: 500;
            color: var(--primary-color);
        }
         /* Can add more complex :checked styling later if needed */


        /* --- Buttons --- */
        .kc-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center; /* Center buttons */
        }

        .kc-button {
            padding: 0.8rem 1.8rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            text-decoration: none; /* For potential <a> buttons */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .kc-button i { margin-right: 8px; }

        #submitBtn {
            background-color: var(--check-color);
            color: var(--text-light);
        }
        #submitBtn:hover { background-color: #5a35a0; }
        #submitBtn:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }

        #retryBtn {
            background-color: var(--secondary-color);
            color: var(--text-light);
            display: none; /* Hidden initially */
        }
        #retryBtn:hover { background-color: #5a6268; }

        /* --- Results Area --- */
        #resultsArea {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            display: none; /* Hidden initially */
            border: 1px solid transparent;
        }
        #resultsArea.pass {
            background-color: #d1e7dd; /* Success background */
            color: var(--success-color);
            border-color: #a3cfbb;
        }
        #resultsArea.fail {
            background-color: #f8d7da; /* Error background */
            color: var(--error-color);
            border-color: #f1aeb5;
        }
        #resultsArea i { margin-right: 8px; }
        #resultsArea p { margin-bottom: 0.5rem; }
        #resultsArea p:last-child { margin-bottom: 0; }


        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: 3rem;
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design Adjustments --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header { flex-direction: column; align-items: flex-start; gap: 1rem; padding: 1rem; }
            .kc-header h1 { font-size: 1.5rem; }
            .kc-header-left { width: 100%; justify-content: space-between;} /* Move return button */
            .kc-header-right { width: 100%; }
            .kc-header-right #languageSelect { width: 100%; } /* Make select full width */
            .return-button { margin-right: 0; }
            .kc-container { padding: 0 1rem; }
            #knowledgeCheckForm { padding: 1.5rem; }
            .question-block p.question-text { font-size: 1rem; }
            .options label { padding: 0.7rem 1rem; font-size: 0.9rem; }
            .kc-buttons { flex-direction: column; } /* Stack buttons */
            .kc-button { width: 100%; } /* Full width buttons */
        }
         @media (max-width: 576px) {
            html { font-size: 14px; }
            .kc-header h1 { font-size: 1.3rem; }
            .kc-header h1 i { font-size: 1.2rem; }
            .kc-instructions { padding: 1rem; font-size: 0.95rem; }
            #knowledgeCheckForm { padding: 1rem; }
            .question-block { padding-bottom: 1rem; }
            .question-block p.question-text { margin-bottom: 0.8rem; }
            .options { gap: 0.6rem; }
            .options label { padding: 0.6rem 0.8rem; }
            .kc-button { padding: 0.7rem 1.5rem; font-size: 0.95rem; }
            #resultsArea { padding: 1rem; font-size: 1rem; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <div class="kc-header-left">
            <a href="ctp-dashboard.html" class="return-button">
                <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
            </a>
             <h1 data-translate="header_title"><i class="fas fa-file-alt"></i> Mod 3: Working with Text</h1>
        </div>
        <div class="kc-header-right">
             <div class="language-switcher">
                <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                    <option value="en" data-translate="lang_en">🇬🇧 English</option>
                    <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                    <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                </select>
            </div>
        </div>
    </header>

    <main class="kc-container">

        <div class="kc-instructions">
            <p data-translate="instructions_p1">Test your knowledge of Module 3 concepts.</p>
            <p><span data-translate="instructions_p2">There are <strong>10 questions</strong>. You need to answer at least</span> <strong class="pass-condition" data-translate="instructions_pass">6 questions correctly</strong> <span data-translate="instructions_p3">to pass.</span></p>
            <p class="attempts-info" data-translate="instructions_p4">You can attempt this check as many times as you need.</p>
        </div>

        <form id="knowledgeCheckForm">

            <!-- Question 1 -->
            <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 1}'>Q1:</strong> <span data-translate="q1_text">What will the following Python code print?</span> <code>print("Py" + "thon")</code></p>
                <div class="options">
                    <label><input type="radio" name="q1" value="a"> <span data-translate="q1_opt_a">Py thon</span></label>
                    <label><input type="radio" name="q1" value="b"> <span data-translate="q1_opt_b">Py</span></label>
                    <label><input type="radio" name="q1" value="c"> <span data-translate="q1_opt_c">Python</span></label>
                    <label><input type="radio" name="q1" value="d"> <span data-translate="q1_opt_d">Error</span></label>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 2}'>Q2:</strong> <span data-translate="q2_text">What is the result of the expression</span> <code>"Go " * 3</code>?</p>
                <div class="options">
                    <label><input type="radio" name="q2" value="a"> <span data-translate="q2_opt_a">"Go Go Go "</span></label>
                    <label><input type="radio" name="q2" value="b"> <span data-translate="q2_opt_b">"GoGoGo"</span></label>
                    <label><input type="radio" name="q2" value="c"> <span data-translate="q2_opt_c">"Go 3"</span></label>
                    <label><input type="radio" name="q2" value="d"> <span data-translate="q2_opt_d">Error</span></label>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 3}'>Q3:</strong> <span data-translate="q3_text">Which function is used to find the number of characters in a string like</span> <code>my_string = "Hello"</code>?</p>
                <div class="options">
                    <label><input type="radio" name="q3" value="a"> <span data-translate="q3_opt_a"><code>count(my_string)</code></span></label>
                    <label><input type="radio" name="q3" value="b"> <span data-translate="q3_opt_b"><code>size(my_string)</code></span></label>
                    <label><input type="radio" name="q3" value="c"> <span data-translate="q3_opt_c"><code>len(my_string)</code></span></label>
                    <label><input type="radio" name="q3" value="d"> <span data-translate="q3_opt_d"><code>length(my_string)</code></span></label>
                </div>
            </div>

             <!-- Question 4 -->
             <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 4}'>Q4:</strong> <span data-translate="q4_text">In Python, what is the index of the *first* character in any non-empty string?</span></p>
                <div class="options">
                    <label><input type="radio" name="q4" value="a"> <span data-translate="q4_opt_a">1</span></label>
                    <label><input type="radio" name="q4" value="b"> <span data-translate="q4_opt_b">0</span></label>
                    <label><input type="radio" name="q4" value="c"> <span data-translate="q4_opt_c">-1</span></label>
                    <label><input type="radio" name="q4" value="d"> <span data-translate="q4_opt_d">It depends on the string length.</span></label>
                </div>
            </div>

             <!-- Question 5 -->
             <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 5}'>Q5:</strong> <span data-translate="q5_text">Given the string</span> <code>word = "Code"</code><span data-translate="q5_text_b">, what character does</span> <code>word[1]</code> <span data-translate="q5_text_c">refer to?</span></p>
                <div class="options">
                    <label><input type="radio" name="q5" value="a"> <span data-translate="q5_opt_a">'C'</span></label>
                    <label><input type="radio" name="q5" value="b"> <span data-translate="q5_opt_b">'o'</span></label>
                    <label><input type="radio" name="q5" value="c"> <span data-translate="q5_opt_c">'d'</span></label>
                    <label><input type="radio" name="q5" value="d"> <span data-translate="q5_opt_d">Error, index out of range.</span></label>
                </div>
            </div>

             <!-- Question 6 -->
             <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 6}'>Q6:</strong> <span data-translate="q6_text">What is the primary reason the following code causes an error?</span> <code>print("Score: " + 100)</code></p>
                 <div class="options">
                    <label><input type="radio" name="q6" value="a"> <span data-translate="q6_opt_a">The <code>print</code> function cannot handle numbers.</span></label>
                    <label><input type="radio" name="q6" value="b"> <span data-translate="q6_opt_b">You cannot use the <code>+</code> operator with strings.</span></label>
                    <label><input type="radio" name="q6" value="c"> <span data-translate="q6_opt_c">You cannot directly concatenate a string and an integer.</span></label>
                    <label><input type="radio" name="q6" value="d"> <span data-translate="q6_opt_d">The number <code>100</code> is too large.</span></label>
                </div>
            </div>

             <!-- Question 7 -->
             <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 7}'>Q7:</strong> <span data-translate="q7_text">If</span> <code>text = "Python"</code><span data-translate="q7_text_b">, how can you access the *last* character ('n') using indexing?</span></p>
                <div class="options">
                    <label><input type="radio" name="q7" value="a"> <span data-translate="q7_opt_a"><code>text[6]</code></span></label>
                    <label><input type="radio" name="q7" value="b"> <span data-translate="q7_opt_b"><code>text[last]</code></span></label>
                    <label><input type="radio" name="q7" value="c"> <span data-translate="q7_opt_c"><code>text[len(text)]</code></span></label>
                    <label><input type="radio" name="q7" value="d"> <span data-translate="q7_opt_d"><code>text[-1]</code></span></label>
                </div>
            </div>

            <!-- Question 8 -->
            <div class="question-block">
                 <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 8}'>Q8:</strong> <span data-translate="q8_text">Which symbol is used to start a single-line comment in Python?</span></p>
                <div class="options">
                    <label><input type="radio" name="q8" value="a"> <span data-translate="q8_opt_a"><code>//</code></span></label>
                    <label><input type="radio" name="q8" value="b"> <span data-translate="q8_opt_b"><code>#</code></span></label>
                    <label><input type="radio" name="q8" value="c"> <span data-translate="q8_opt_c"><code>/*</code></span></label>
                    <label><input type="radio" name="q8" value="d"> <span data-translate="q8_opt_d"><code>--</code></span></label>
                </div>
            </div>

            <!-- Question 9 -->
            <div class="question-block">
                <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 9}'>Q9:</strong> <span data-translate="q9_text">How would you correctly print the length of the string</span> <code>name = "Alice"</code>?</p>
                <div class="options">
                    <label><input type="radio" name="q9" value="a"> <span data-translate="q9_opt_a"><code>print(name.length)</code></span></label>
                    <label><input type="radio" name="q9" value="b"> <span data-translate="q9_opt_b"><code>print(length(name))</code></span></label>
                    <label><input type="radio" name="q9" value="c"> <span data-translate="q9_opt_c"><code>print(len(name))</code></span></label>
                    <label><input type="radio" name="q9" value="d"> <span data-translate="q9_opt_d"><code>print(size(name))</code></span></label>
                </div>
            </div>

            <!-- Question 10 -->
            <div class="question-block">
                 <p class="question-text"><strong data-translate="q_num" data-replacements='{"num": 10}'>Q10:</strong> <span data-translate="q10_text">What data type is the value</span> <code>"123"</code> <span data-translate="q10_text_b">(note the quotes)?</span></p>
                <div class="options">
                    <label><input type="radio" name="q10" value="a"> <span data-translate="q10_opt_a">Integer (<code>int</code>)</span></label>
                    <label><input type="radio" name="q10" value="b"> <span data-translate="q10_opt_b">Float (<code>float</code>)</span></label>
                    <label><input type="radio" name="q10" value="c"> <span data-translate="q10_opt_c">String (<code>str</code>)</span></label>
                    <label><input type="radio" name="q10" value="d"> <span data-translate="q10_opt_d">Boolean (<code>bool</code>)</span></label>
                </div>
            </div>

            <!-- Buttons -->
            <div class="kc-buttons">
                <button type="submit" id="submitBtn" class="kc-button">
                    <i class="fas fa-check"></i> <span data-translate="submit_button">Submit Answers</span>
                </button>
                <button type="button" id="retryBtn" class="kc-button">
                    <i class="fas fa-redo"></i> <span data-translate="retry_button">Try Again</span>
                </button>
            </div>

        </form>

        <!-- Results Area -->
        <div id="resultsArea">
            <!-- Content added by JS -->
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 3; // *** Set the correct Module ID here ***
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const PASSING_SCORE = 6;
        const TOTAL_QUESTIONS = 10;
        const LANGUAGE_STORAGE_KEY = 'userLanguage'; // Key for storing language

        // --- Correct Answers ---
        const correctAnswers = {
            q1: 'c',
            q2: 'a',
            q3: 'c',
            q4: 'b',
            q5: 'b',
            q6: 'c',
            q7: 'd',
            q8: 'b',
            q9: 'c',
            q10: 'c'
        };

        // --- Translations Object ---
        const translations = {
            en: {
                "page_title": "Knowledge Check: Module 3 - Complete Python",
                "return_button": "Return to Dashboard",
                "header_title": "Mod 3: Working with Text",
                "instructions_p1": "Test your knowledge of Module 3 concepts.",
                "instructions_p2": "There are",
                "instructions_pass": "6 questions correctly",
                "instructions_p3": "to pass.",
                "instructions_p4": "You can attempt this check as many times as you need.",
                "q_num": "Q{num}:",
                "q1_text": "What will the following Python code print?",
                "q1_opt_a": "Py thon", "q1_opt_b": "Py", "q1_opt_c": "Python", "q1_opt_d": "Error",
                "q2_text": "What is the result of the expression",
                "q2_opt_a": '"Go Go Go "', "q2_opt_b": '"GoGoGo"', "q2_opt_c": '"Go 3"', "q2_opt_d": "Error",
                "q3_text": "Which function is used to find the number of characters in a string like",
                "q3_opt_a": "`count(my_string)`", "q3_opt_b": "`size(my_string)`", "q3_opt_c": "`len(my_string)`", "q3_opt_d": "`length(my_string)`",
                "q4_text": "In Python, what is the index of the *first* character in any non-empty string?",
                "q4_opt_a": "1", "q4_opt_b": "0", "q4_opt_c": "-1", "q4_opt_d": "It depends on the string length.",
                "q5_text": "Given the string", "q5_text_b": "", "q5_text_c": "refer to?",
                "q5_opt_a": "'C'", "q5_opt_b": "'o'", "q5_opt_c": "'d'", "q5_opt_d": "Error, index out of range.",
                "q6_text": "What is the primary reason the following code causes an error?",
                "q6_opt_a": "The `print` function cannot handle numbers.", "q6_opt_b": "You cannot use the `+` operator with strings.", "q6_opt_c": "You cannot directly concatenate a string and an integer.", "q6_opt_d": "The number `100` is too large.",
                "q7_text": "If", "q7_text_b": ", how can you access the *last* character ('n') using indexing?",
                "q7_opt_a": "`text[6]`", "q7_opt_b": "`text[last]`", "q7_opt_c": "`text[len(text)]`", "q7_opt_d": "`text[-1]`",
                "q8_text": "Which symbol is used to start a single-line comment in Python?",
                "q8_opt_a": "`//`", "q8_opt_b": "`#`", "q8_opt_c": "`/*`", "q8_opt_d": "`--`",
                "q9_text": "How would you correctly print the length of the string",
                "q9_opt_a": "`print(name.length)`", "q9_opt_b": "`print(length(name))`", "q9_opt_c": "`print(len(name))`", "q9_opt_d": "`print(size(name))`",
                "q10_text": "What data type is the value", "q10_text_b": "(note the quotes)?",
                "q10_opt_a": "Integer (`int`)", "q10_opt_b": "Float (`float`)", "q10_opt_c": "String (`str`)", "q10_opt_d": "Boolean (`bool`)",
                "submit_button": "Submit Answers",
                "retry_button": "Try Again",
                "result_pass": "<i class='fas fa-check-circle'></i> Passed! You scored {score}/{total}.",
                "result_pass_already": "<i class='fas fa-check-double'></i> Already Passed! Your score for this attempt: {score}/{total}.",
                "result_fail": "<i class='fas fa-times-circle'></i> Keep Trying! You scored {score}/{total}. You need {needed} to pass.",
                "footer_text": "Part of the Road to Free Open AGI Project",
                "lang_select_aria": "Select Language", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文"
            },
            pt: {
                "page_title": "Verificação de Conhecimento: Módulo 3 - Python Completo",
                "return_button": "Voltar ao Painel",
                "header_title": "Mod 3: Trabalhando com Texto",
                "instructions_p1": "Teste seus conhecimentos sobre os conceitos do Módulo 3.",
                "instructions_p2": "São <strong>10 questões</strong>. Você precisa responder pelo menos",
                "instructions_pass": "6 questões corretamente",
                "instructions_p3": "para passar.",
                "instructions_p4": "Você pode tentar esta verificação quantas vezes precisar.",
                "q_num": "Q{num}:",
                "q1_text": "O que o seguinte código Python imprimirá?",
                "q1_opt_a": "Py thon", "q1_opt_b": "Py", "q1_opt_c": "Python", "q1_opt_d": "Erro",
                "q2_text": "Qual é o resultado da expressão",
                "q2_opt_a": '"Go Go Go "', "q2_opt_b": '"GoGoGo"', "q2_opt_c": '"Go 3"', "q2_opt_d": "Erro",
                "q3_text": "Qual função é usada para encontrar o número de caracteres em uma string como",
                "q3_opt_a": "`count(my_string)`", "q3_opt_b": "`size(my_string)`", "q3_opt_c": "`len(my_string)`", "q3_opt_d": "`length(my_string)`",
                "q4_text": "Em Python, qual é o índice do *primeiro* caractere em qualquer string não vazia?",
                "q4_opt_a": "1", "q4_opt_b": "0", "q4_opt_c": "-1", "q4_opt_d": "Depende do comprimento da string.",
                "q5_text": "Dada a string", "q5_text_b": "", "q5_text_c": "se refere a qual caractere?",
                "q5_opt_a": "'C'", "q5_opt_b": "'o'", "q5_opt_c": "'d'", "q5_opt_d": "Erro, índice fora do alcance.",
                "q6_text": "Qual é a razão principal pela qual o código a seguir causa um erro?",
                "q6_opt_a": "A função `print` não pode lidar com números.", "q6_opt_b": "Você não pode usar o operador `+` com strings.", "q6_opt_c": "Você não pode concatenar diretamente uma string e um inteiro.", "q6_opt_d": "O número `100` é muito grande.",
                "q7_text": "Se", "q7_text_b": ", como você pode acessar o *último* caractere ('n') usando indexação?",
                "q7_opt_a": "`text[6]`", "q7_opt_b": "`text[last]`", "q7_opt_c": "`text[len(text)]`", "q7_opt_d": "`text[-1]`",
                "q8_text": "Qual símbolo é usado para iniciar um comentário de linha única em Python?",
                "q8_opt_a": "`//`", "q8_opt_b": "`#`", "q8_opt_c": "`/*`", "q8_opt_d": "`--`",
                "q9_text": "Como você imprimiria corretamente o comprimento da string",
                "q9_opt_a": "`print(name.length)`", "q9_opt_b": "`print(length(name))`", "q9_opt_c": "`print(len(name))`", "q9_opt_d": "`print(size(name))`",
                "q10_text": "Qual tipo de dado é o valor", "q10_text_b": "(note as aspas)?",
                "q10_opt_a": "Inteiro (`int`)", "q10_opt_b": "Ponto flutuante (`float`)", "q10_opt_c": "String (`str`)", "q10_opt_d": "Booleano (`bool`)",
                "submit_button": "Enviar Respostas",
                "retry_button": "Tentar Novamente",
                "result_pass": "<i class='fas fa-check-circle'></i> Aprovado! Você acertou {score}/{total}.",
                "result_pass_already": "<i class='fas fa-check-double'></i> Já Aprovado! Sua pontuação nesta tentativa: {score}/{total}.",
                "result_fail": "<i class='fas fa-times-circle'></i> Continue Tentando! Você acertou {score}/{total}. Você precisa de {needed} para passar.",
                "footer_text": "Parte do Projeto Road to Free Open AGI",
                "lang_select_aria": "Selecionar Idioma", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文"
            },
            zh: {
                "page_title": "知识测验：模块 3 - Python 完全指南",
                "return_button": "返回仪表板",
                "header_title": "模块 3: 处理文本",
                "instructions_p1": "测试您对模块 3 概念的掌握程度。",
                "instructions_p2": "共有 <strong>10 个问题</strong>。您需要至少答对",
                "instructions_pass": "6 个问题",
                "instructions_p3": "才能通过。",
                "instructions_p4": "您可以根据需要多次尝试此测验。",
                "q_num": "问题{num}:",
                "q1_text": "以下 Python 代码将打印什么？",
                "q1_opt_a": "Py thon", "q1_opt_b": "Py", "q1_opt_c": "Python", "q1_opt_d": "错误",
                "q2_text": "表达式", "q2_text_b": "的结果是什么？",
                "q2_opt_a": '"Go Go Go "', "q2_opt_b": '"GoGoGo"', "q2_opt_c": '"Go 3"', "q2_opt_d": "错误",
                "q3_text": "哪个函数用于查找像", "q3_text_b": "这样的字符串中的字符数？",
                "q3_opt_a": "`count(my_string)`", "q3_opt_b": "`size(my_string)`", "q3_opt_c": "`len(my_string)`", "q3_opt_d": "`length(my_string)`",
                "q4_text": "在 Python 中，任何非空字符串的*第一个*字符的索引是什么？",
                "q4_opt_a": "1", "q4_opt_b": "0", "q4_opt_c": "-1", "q4_opt_d": "取决于字符串长度。",
                "q5_text": "给定字符串", "q5_text_b": "，", "q5_text_c": "指的是哪个字符？",
                "q5_opt_a": "'C'", "q5_opt_b": "'o'", "q5_opt_c": "'d'", "q5_opt_d": "错误，索引超出范围。",
                "q6_text": "以下代码导致错误的主要原因是什么？",
                "q6_opt_a": "`print` 函数无法处理数字。", "q6_opt_b": "不能对字符串使用 `+` 运算符。", "q6_opt_c": "不能直接将字符串和整数连接起来。", "q6_opt_d": "数字 `100` 太大了。",
                "q7_text": "如果", "q7_text_b": "，如何使用索引访问*最后一个*字符 ('n')？",
                "q7_opt_a": "`text[6]`", "q7_opt_b": "`text[last]`", "q7_opt_c": "`text[len(text)]`", "q7_opt_d": "`text[-1]`",
                "q8_text": "在 Python 中，哪个符号用于开始单行注释？",
                "q8_opt_a": "`//`", "q8_opt_b": "`#`", "q8_opt_c": "`/*`", "q8_opt_d": "`--`",
                "q9_text": "如何正确打印字符串", "q9_text_b": "的长度？",
                "q9_opt_a": "`print(name.length)`", "q9_opt_b": "`print(length(name))`", "q9_opt_c": "`print(len(name))`", "q9_opt_d": "`print(size(name))`",
                "q10_text": "值", "q10_text_b": "（注意引号）是什么数据类型？",
                "q10_opt_a": "整数 (`int`)", "q10_opt_b": "浮点数 (`float`)", "q10_opt_c": "字符串 (`str`)", "q10_opt_d": "布尔值 (`bool`)",
                "submit_button": "提交答案",
                "retry_button": "再试一次",
                "result_pass": "<i class='fas fa-check-circle'></i> 通过！您的得分是 {score}/{total}。",
                "result_pass_already": "<i class='fas fa-check-double'></i> 已通过！本次尝试得分：{score}/{total}。",
                "result_fail": "<i class='fas fa-times-circle'></i> 继续努力！您的得分是 {score}/{total}。您需要达到 {needed} 分才能通过。",
                "footer_text": "通往自由开放AGI之路项目的一部分",
                "lang_select_aria": "选择语言", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文"
            }
        };


        document.addEventListener('DOMContentLoaded', () => {
            const quizForm = document.getElementById('knowledgeCheckForm');
            const resultsArea = document.getElementById('resultsArea');
            const submitBtn = document.getElementById('submitBtn');
            const retryBtn = document.getElementById('retryBtn');
            const languageSelectElement = document.getElementById('languageSelect');

            let alreadyPassed = false; // Track if already passed before this session attempt

            // --- LocalStorage Functions ---
            function loadKnowledgeCheckStatus() {
                try {
                    const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                    const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                    return typeof parsed === 'object' && parsed !== null ? parsed : {};
                } catch (e) {
                    console.error("Error reading KC status from localStorage:", e);
                    return {};
                }
            }

            function saveKnowledgeCheckStatus(moduleId, status) {
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[moduleId] = status; // Update only this module
                try {
                    localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                    console.log(`KC Status saved for module ${moduleId}: ${status}`);
                    alreadyPassed = status; // Update the flag
                } catch (e) {
                    console.error("Error saving KC status to localStorage:", e);
                }
            }

             // --- Translation Functions ---
            function getStoredLanguage() {
                const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
                if (storedLang && translations[storedLang]) return storedLang;
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('pt')) return 'pt';
                if (browserLang.startsWith('zh')) return 'zh';
                return 'en'; // Default to English
            }

             function getTranslation(key, lang, replacements = {}) {
                 let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; // Fallback chain: Current Lang -> EN -> Key Name
                 for (const placeholder in replacements) {
                     // Use a more robust regex to avoid issues with special characters in replacements
                     const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                     text = text.replace(regex, replacements[placeholder]);
                 }
                 return text;
             }


            function translatePage(lang) {
                if (!translations[lang]) lang = 'en'; // Ensure lang exists
                document.documentElement.lang = lang;

                 // Update simple text content and titles
                 document.querySelectorAll('[data-translate]').forEach(el => {
                     const key = el.getAttribute('data-translate');
                     const replacementsAttr = el.getAttribute('data-replacements');
                     let replacements = {};
                     if (replacementsAttr) {
                         try { replacements = JSON.parse(replacementsAttr.replace(/'/g, '"')); } // Allow single quotes in HTML
                         catch (e) { console.error("Failed to parse replacements:", replacementsAttr, e); }
                     }

                     // Special handling for Q_num to insert the number
                     if (key === 'q_num') {
                        const questionBlock = el.closest('.question-block');
                        if (questionBlock) {
                            const radio = questionBlock.querySelector('input[type="radio"]');
                            if(radio) {
                                const qName = radio.name; // e.g., "q1"
                                replacements.num = qName.substring(1); // Extract number "1"
                            }
                        }
                     }

                     const translation = getTranslation(key, lang, replacements);

                     if (el.tagName === 'TITLE') {
                         document.title = translation;
                     } else if (translation.includes('<') && translation.includes('>')) {
                          // If translation contains HTML (like <i> tags or <strong>), use innerHTML
                         el.innerHTML = translation;
                     } else {
                         el.textContent = translation;
                     }
                 });

                 // Update placeholders and aria-labels
                 document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                     const key = el.getAttribute('data-translate-placeholder');
                     el.setAttribute('placeholder', getTranslation(key, lang));
                 });
                 document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                     const key = el.getAttribute('data-translate-aria-label');
                     el.setAttribute('aria-label', getTranslation(key, lang));
                 });

                 // Re-render results if they are currently displayed
                 if (resultsArea.style.display !== 'none') {
                    const score = parseInt(resultsArea.dataset.score || "0");
                    const passed = resultsArea.classList.contains('pass');
                    displayResults(score, passed);
                 }
            }


            function setLanguage(lang) {
                if (!translations[lang]) lang = 'en'; // Fallback
                localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
                translatePage(lang);
                // Update language selector value
                if (languageSelectElement) languageSelectElement.value = lang;
             }


            // --- Quiz Logic ---
            function calculateScore(formData) {
                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const questionName = `q${i}`;
                    const userAnswer = formData.get(questionName);
                    if (userAnswer === correctAnswers[questionName]) {
                        score++;
                    }
                }
                return score;
            }

            function displayResults(score, passed) {
                const lang = getStoredLanguage();
                resultsArea.innerHTML = ''; // Clear previous results
                resultsArea.classList.remove('pass', 'fail'); // Remove old classes
                resultsArea.dataset.score = score; // Store score for re-translation

                let messageKey = '';
                let replacements = { score: score, total: TOTAL_QUESTIONS };

                if (passed) {
                    resultsArea.classList.add('pass');
                    // Use different message if they had already passed before this attempt
                    messageKey = alreadyPassed ? "result_pass_already" : "result_pass";
                } else {
                    resultsArea.classList.add('fail');
                    messageKey = "result_fail";
                    replacements.needed = PASSING_SCORE;
                }

                resultsArea.innerHTML = getTranslation(messageKey, lang, replacements);
                resultsArea.style.display = 'block';
                resultsArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }


            function handleSubmit(event) {
                event.preventDefault();
                const formData = new FormData(quizForm);
                const score = calculateScore(formData);
                const passed = score >= PASSING_SCORE;

                displayResults(score, passed);

                if (passed) {
                    saveKnowledgeCheckStatus(MODULE_ID, true);
                }

                submitBtn.disabled = true;
                retryBtn.style.display = 'inline-flex'; // Show retry button

                // Optional: Disable radio buttons after submission
                quizForm.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.disabled = true;
                });
            }

            function handleRetry() {
                quizForm.reset();
                resultsArea.style.display = 'none';
                resultsArea.classList.remove('pass', 'fail');
                submitBtn.disabled = false;
                retryBtn.style.display = 'none';
                resultsArea.dataset.score = ""; // Clear stored score


                // Re-enable radio buttons if they were disabled
                 quizForm.querySelectorAll('input[type="radio"]').forEach(radio => {
                     radio.disabled = false;
                 });

                 // Scroll back to the top of the quiz
                 quizForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // --- Initialization ---
            const initialStatus = loadKnowledgeCheckStatus();
            alreadyPassed = initialStatus[MODULE_ID] === true;

            quizForm.addEventListener('submit', handleSubmit);
            retryBtn.addEventListener('click', handleRetry);

            // Language Switcher Setup
             if (languageSelectElement) {
                const initialLang = getStoredLanguage();
                languageSelectElement.value = initialLang; // Set initial value
                setLanguage(initialLang); // Initial translation
                languageSelectElement.addEventListener('change', (e) => {
                    setLanguage(e.target.value);
                });
             } else {
                 // Fallback if selector not found
                 setLanguage(getStoredLanguage());
             }


        }); // End DOMContentLoaded
    </script>

</body>
</html>
