<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 3 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Using for quiz container */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for highlighting correct answer maybe? */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Quiz Header --- */
        .quiz-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 1rem;
        }
        .return-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            text-decoration: none;
            color: var(--text-light);
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 5px;
            transition: background-color var(--transition-speed);
        }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
            color: var(--text-light);
        }
        .return-button i { margin-right: 6px; }
        .quiz-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem; /* Slightly smaller than dashboard */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            flex-grow: 1; /* Allow title to take space */
            text-align: center; /* Center title */
            min-width: 200px; /* Prevent title from getting too squished */
        }
        /* Language Switcher Styles (Copied & Adjusted) */
         .language-switcher { min-width: 150px; /* Ensure it has some space */ }
         #languageSelect {
            width: 100%;
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 8px 35px 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: var(--primary-color); }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Takes up remaining vertical space */
        }
        .quiz-instructions {
            margin-bottom: 2rem;
            font-size: 1rem;
            color: var(--text-muted);
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1rem;
        }
        .quiz-instructions p { margin-bottom: 0.5rem; }
        .quiz-instructions strong { color: var(--text-dark); }
        .quiz-instructions code { font-size: 0.9em; background: #eee; padding: 1px 4px; border-radius: 3px; color: #c7254e;}

        /* --- Quiz Form Styling --- */
        .quiz-question {
            margin-bottom: 1.8rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .quiz-question:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .quiz-question p {
            font-weight: 500;
            margin-bottom: 1rem;
            font-size: 1.05rem;
        }
        .quiz-question p code { /* Style code within questions */
             background-color: #e9ecef;
             padding: 0.1em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e;
             font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        }
        .quiz-option {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center; /* Align radio button and label nicely */
        }
        .quiz-option input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--primary-color); /* Modern way to color radio buttons */
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .quiz-option label {
            font-size: 0.95rem;
            color: var(--text-dark);
            flex-grow: 1; /* Allow label to take available space */
            cursor: pointer;
            transition: color 0.2s ease;
        }
         .quiz-option label code { /* Style code within answers */
            background-color: #f8f9fa;
            border: 1px solid #eee;
            padding: 0.1em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
            color: #0b5ed7;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
         }
        .quiz-option input[type="radio"]:checked + label {
            color: var(--primary-color);
            font-weight: 500;
        }
        /* Disabled state styling */
        #quiz-form fieldset[disabled] .quiz-option label {
             color: var(--text-muted);
             cursor: default;
        }
        #quiz-form fieldset[disabled] .quiz-option input[type="radio"] {
            cursor: default;
            opacity: 0.6;
        }


        /* --- Buttons --- */
        .quiz-buttons {
            margin-top: 2.5rem;
            display: flex;
            justify-content: center; /* Center buttons */
            gap: 1rem;
        }
        .quiz-button {
            padding: 0.8rem 1.8rem;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: inline-flex; /* Use flex for icon alignment */
            align-items: center;
            justify-content: center; /* Center text/icon */
        }
        .quiz-button i { margin-right: 8px; }

        #submit-button {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        #submit-button:hover { background-color: #0a58ca; }
        #submit-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }

        #retry-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
            display: none; /* Hidden by default */
        }
        #retry-button:hover { background-color: #5a6268; }


        /* --- Quiz Results --- */
        #quiz-results {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden by default */
            border: 1px solid var(--border-color);
        }
        #quiz-results.pass {
            background-color: #d1e7dd; /* Light green */
            border-color: var(--success-color);
            color: #0f5132; /* Darker green */
        }
        #quiz-results.fail {
            background-color: #f8d7da; /* Light red */
            border-color: var(--error-color);
            color: #842029; /* Darker red */
        }
        #quiz-results h3 {
            font-family: var(--font-title);
            margin-bottom: 0.8rem;
            font-size: 1.4rem;
        }
        #quiz-results p {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        #quiz-results p strong { font-weight: 700; }

        /* Answer feedback styling (Optional but helpful) */
        .quiz-option.correct label {
            color: var(--success-color) !important;
            font-weight: bold;
            position: relative;
        }
        .quiz-option.correct label::after {
            content: '\f00c'; /* Font Awesome check */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--success-color);
            margin-left: 8px;
        }
        .quiz-option.incorrect label {
            color: var(--error-color) !important;
            text-decoration: line-through;
            position: relative;
        }
         .quiz-option.incorrect label::after {
            content: '\f00d'; /* Font Awesome times */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--error-color);
            margin-left: 8px;
         }


        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem; width: 100%;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .quiz-header { flex-direction: column; align-items: flex-start; }
            .quiz-header h1 { font-size: 1.4rem; text-align: left; }
            .language-switcher { width: 100%; margin-top: 0.5rem; }
            .quiz-container { margin: 1rem; padding: 1.5rem; }
        }
        @media (max-width: 576px) {
             html { font-size: 14px; }
            .quiz-header { padding: 0.8rem 1rem; }
            .quiz-header h1 { font-size: 1.3rem; }
            .return-button { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
            .quiz-container { padding: 1rem; }
            .quiz-instructions { margin-bottom: 1.5rem; padding-bottom: 1rem; }
            .quiz-question { margin-bottom: 1.5rem; padding-bottom: 1rem; }
            .quiz-buttons { flex-direction: column; gap: 0.8rem; align-items: stretch;}
            .quiz-button { width: 100%; padding: 0.7rem; }
            #quiz-results { padding: 1rem; }
            #quiz-results h3 { font-size: 1.2rem; }
            #quiz-results p { font-size: 1rem; }
        }

    </style>
</head>
<body>

    <header class="quiz-header">
        <a href="ctp-dashboard.html" class="return-button">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
        </a>
        <h1 data-translate="quiz_title">Knowledge Check: Module 3</h1>
        <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="quiz-container">
        <div class="quiz-instructions">
            <p data-translate="instructions_p1">Test your understanding of Module 3: Working with Text.</p>
            <p data-translate="instructions_p2">There are <strong>10 questions</strong>. You need to answer at least <strong>6 questions correctly</strong> to pass.</p>
            <p data-translate="instructions_p3">You can attempt this check as many times as you like. Good luck!</p>
            <p data-translate="instructions_already_passed" style="display: none; color: var(--success-color); font-weight: bold;">You have already passed this knowledge check!</p>
        </div>

        <form id="quiz-form">
             <fieldset id="quiz-fieldset"> <!-- Use fieldset to disable all inputs easily -->
                <!-- Question 1 -->
                <div class="quiz-question" data-question-id="q1">
                    <p><span data-translate="q1_text">1. What is the result of the expression <code>"Hello" + " " + "World"</code> in Python?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q1_opt1" name="q1" value="a"> <label for="q1_opt1" data-translate="q1_opt1_text"><code>"HelloWorld"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q1_opt2" name="q1" value="b"> <label for="q1_opt2" data-translate="q1_opt2_text"><code>"Hello World"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q1_opt3" name="q1" value="c"> <label for="q1_opt3" data-translate="q1_opt3_text">An error</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q1_opt4" name="q1" value="d"> <label for="q1_opt4" data-translate="q1_opt4_text"><code>Hello World</code> (without quotes)</label> </div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-question" data-question-id="q2">
                    <p><span data-translate="q2_text">2. Which function is used to find the number of characters in a string?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q2_opt1" name="q2" value="a"> <label for="q2_opt1" data-translate="q2_opt1_text"><code>count()</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q2_opt2" name="q2" value="b"> <label for="q2_opt2" data-translate="q2_opt2_text"><code>size()</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q2_opt3" name="q2" value="c"> <label for="q2_opt3" data-translate="q2_opt3_text"><code>len()</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q2_opt4" name="q2" value="d"> <label for="q2_opt4" data-translate="q2_opt4_text"><code>length()</code></label> </div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-question" data-question-id="q3">
                    <p><span data-translate="q3_text">3. What will <code>"Py" * 3</code> produce?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q3_opt1" name="q3" value="a"> <label for="q3_opt1" data-translate="q3_opt1_text"><code>"PyPyPy"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q3_opt2" name="q3" value="b"> <label for="q3_opt2" data-translate="q3_opt2_text"><code>"Py Py Py"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q3_opt3" name="q3" value="c"> <label for="q3_opt3" data-translate="q3_opt3_text"><code>"Py3"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q3_opt4" name="q3" value="d"> <label for="q3_opt4" data-translate="q3_opt4_text">An error</label> </div>
                </div>

                <!-- Question 4 -->
                <div class="quiz-question" data-question-id="q4">
                    <p><span data-translate="q4_text">4. If <code>word = "Python"</code>, what is <code>word[0]</code>?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q4_opt1" name="q4" value="a"> <label for="q4_opt1" data-translate="q4_opt1_text"><code>"P"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q4_opt2" name="q4" value="b"> <label for="q4_opt2" data-translate="q4_opt2_text"><code>"Python"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q4_opt3" name="q4" value="c"> <label for="q4_opt3" data-translate="q4_opt3_text"><code>"y"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q4_opt4" name="q4" value="d"> <label for="q4_opt4" data-translate="q4_opt4_text">An error</label> </div>
                </div>

                <!-- Question 5 -->
                <div class="quiz-question" data-question-id="q5">
                    <p><span data-translate="q5_text">5. If <code>text = "Code"</code>, what is <code>text[-1]</code>?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q5_opt1" name="q5" value="a"> <label for="q5_opt1" data-translate="q5_opt1_text"><code>"C"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q5_opt2" name="q5" value="b"> <label for="q5_opt2" data-translate="q5_opt2_text"><code>"d"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q5_opt3" name="q5" value="c"> <label for="q5_opt3" data-translate="q5_opt3_text"><code>"e"</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q5_opt4" name="q5" value="d"> <label for="q5_opt4" data-translate="q5_opt4_text">An error</label> </div>
                </div>

                <!-- Question 6 -->
                 <div class="quiz-question" data-question-id="q6">
                    <p><span data-translate="q6_text">6. What does the term 'indexing' refer to when working with strings?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q6_opt1" name="q6" value="a"> <label for="q6_opt1" data-translate="q6_opt1_text">Combining strings together.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q6_opt2" name="q6" value="b"> <label for="q6_opt2" data-translate="q6_opt2_text">Accessing individual characters using their position.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q6_opt3" name="q6" value="c"> <label for="q6_opt3" data-translate="q6_opt3_text">Finding the length of the string.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q6_opt4" name="q6" value="d"> <label for="q6_opt4" data-translate="q6_opt4_text">Repeating a string multiple times.</label> </div>
                </div>

                 <!-- Question 7 -->
                 <div class="quiz-question" data-question-id="q7">
                    <p><span data-translate="q7_text">7. If <code>message = "Welcome"</code>, what is the result of <code>len(message)</code>?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q7_opt1" name="q7" value="a"> <label for="q7_opt1" data-translate="q7_opt1_text">6</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q7_opt2" name="q7" value="b"> <label for="q7_opt2" data-translate="q7_opt2_text">7</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q7_opt3" name="q7" value="c"> <label for="q7_opt3" data-translate="q7_opt3_text">8</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q7_opt4" name="q7" value="d"> <label for="q7_opt4" data-translate="q7_opt4_text"><code>"Welcome"</code></label> </div>
                </div>

                 <!-- Question 8 -->
                 <div class="quiz-question" data-question-id="q8">
                    <p><span data-translate="q8_text">8. Consider <code>name = "Ada"</code>. What happens if you try to execute <code>name[3]</code>?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q8_opt1" name="q8" value="a"> <label for="q8_opt1" data-translate="q8_opt1_text">It returns the last character, <code>'a'</code>.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q8_opt2" name="q8" value="b"> <label for="q8_opt2" data-translate="q8_opt2_text">It returns <code>None</code>.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q8_opt3" name="q8" value="c"> <label for="q8_opt3" data-translate="q8_opt3_text">It causes an <code>IndexError</code>.</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q8_opt4" name="q8" value="d"> <label for="q8_opt4" data-translate="q8_opt4_text">It returns an empty string <code>""</code>.</label> </div>
                </div>

                 <!-- Question 9 -->
                 <div class="quiz-question" data-question-id="q9">
                    <p><span data-translate="q9_text">9. What is the operation of joining two or more strings called?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q9_opt1" name="q9" value="a"> <label for="q9_opt1" data-translate="q9_opt1_text">Indexing</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q9_opt2" name="q9" value="b"> <label for="q9_opt2" data-translate="q9_opt2_text">Slicing</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q9_opt3" name="q9" value="c"> <label for="q9_opt3" data-translate="q9_opt3_text">Multiplication</label> </div>
                    <div class="quiz-option"> <input type="radio" id="q9_opt4" name="q9" value="d"> <label for="q9_opt4" data-translate="q9_opt4_text">Concatenation</label> </div>
                </div>

                 <!-- Question 10 -->
                 <div class="quiz-question" data-question-id="q10">
                    <p><span data-translate="q10_text">10. Which of these expressions results in the string <code>"HaHa"</code>?</span></p>
                    <div class="quiz-option"> <input type="radio" id="q10_opt1" name="q10" value="a"> <label for="q10_opt1" data-translate="q10_opt1_text"><code>"Ha" + 2</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q10_opt2" name="q10" value="b"> <label for="q10_opt2" data-translate="q10_opt2_text"><code>"Ha" * 2</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q10_opt3" name="q10" value="c"> <label for="q10_opt3" data-translate="q10_opt3_text"><code>len("HaHa")</code></label> </div>
                    <div class="quiz-option"> <input type="radio" id="q10_opt4" name="q10" value="d"> <label for="q10_opt4" data-translate="q10_opt4_text"><code>"Ha"[0] + "Ha"[1]</code></label> </div>
                </div>
            </fieldset> <!-- End fieldset -->

            <div class="quiz-buttons">
                <button type="submit" id="submit-button" class="quiz-button">
                    <i class="fas fa-paper-plane"></i> <span data-translate="submit_button">Submit Answers</span>
                </button>
                <button type="button" id="retry-button" class="quiz-button">
                     <i class="fas fa-redo"></i> <span data-translate="retry_button">Try Again</span>
                </button>
            </div>
        </form>

        <div id="quiz-results">
            <h3 id="results-title"></h3>
            <p id="results-score"></p>
            <p id="results-message"></p>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Configuration ---
        const MODULE_ID = 3; // Unique ID for this knowledge check
        const PASSING_SCORE = 6; // Minimum correct answers to pass
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Correct Answers ---
        const correctAnswers = {
            q1: 'b', q2: 'c', q3: 'a', q4: 'a', q5: 'c',
            q6: 'b', q7: 'b', q8: 'c', q9: 'd', q10: 'b'
        };
        const totalQuestions = Object.keys(correctAnswers).length;

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": `Knowledge Check: Module ${MODULE_ID} - Complete Python`,
                 "return_button": "Return to Dashboard",
                 "quiz_title": `Knowledge Check: Module ${MODULE_ID} - Working with Text`,
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "instructions_p1": "Test your understanding of Module 3: Working with Text.",
                 "instructions_p2": `There are <strong>${totalQuestions} questions</strong>. You need to answer at least <strong>${PASSING_SCORE} questions correctly</strong> to pass.`,
                 "instructions_p3": "You can attempt this check as many times as you like. Good luck!",
                 "instructions_already_passed": "You have already passed this knowledge check!",
                 "q1_text": "1. What is the result of the expression <code>\"Hello\" + \" \" + \"World\"</code> in Python?",
                 "q1_opt1_text": "<code>\"HelloWorld\"</code>", "q1_opt2_text": "<code>\"Hello World\"</code>", "q1_opt3_text": "An error", "q1_opt4_text": "<code>Hello World</code> (without quotes)",
                 "q2_text": "2. Which function is used to find the number of characters in a string?",
                 "q2_opt1_text": "<code>count()</code>", "q2_opt2_text": "<code>size()</code>", "q2_opt3_text": "<code>len()</code>", "q2_opt4_text": "<code>length()</code>",
                 "q3_text": "3. What will <code>\"Py\" * 3</code> produce?",
                 "q3_opt1_text": "<code>\"PyPyPy\"</code>", "q3_opt2_text": "<code>\"Py Py Py\"</code>", "q3_opt3_text": "<code>\"Py3\"</code>", "q3_opt4_text": "An error",
                 "q4_text": "4. If <code>word = \"Python\"</code>, what is <code>word[0]</code>?",
                 "q4_opt1_text": "<code>\"P\"</code>", "q4_opt2_text": "<code>\"Python\"</code>", "q4_opt3_text": "<code>\"y\"</code>", "q4_opt4_text": "An error",
                 "q5_text": "5. If <code>text = \"Code\"</code>, what is <code>text[-1]</code>?",
                 "q5_opt1_text": "<code>\"C\"</code>", "q5_opt2_text": "<code>\"d\"</code>", "q5_opt3_text": "<code>\"e\"</code>", "q5_opt4_text": "An error",
                 "q6_text": "6. What does the term 'indexing' refer to when working with strings?",
                 "q6_opt1_text": "Combining strings together.", "q6_opt2_text": "Accessing individual characters using their position.", "q6_opt3_text": "Finding the length of the string.", "q6_opt4_text": "Repeating a string multiple times.",
                 "q7_text": "7. If <code>message = \"Welcome\"</code>, what is the result of <code>len(message)</code>?",
                 "q7_opt1_text": "6", "q7_opt2_text": "7", "q7_opt3_text": "8", "q7_opt4_text": "<code>\"Welcome\"</code>",
                 "q8_text": "8. Consider <code>name = \"Ada\"</code>. What happens if you try to execute <code>name[3]</code>?",
                 "q8_opt1_text": "It returns the last character, <code>'a'</code>.", "q8_opt2_text": "It returns <code>None</code>.", "q8_opt3_text": "It causes an <code>IndexError</code>.", "q8_opt4_text": "It returns an empty string <code>\"\"</code>.",
                 "q9_text": "9. What is the operation of joining two or more strings called?",
                 "q9_opt1_text": "Indexing", "q9_opt2_text": "Slicing", "q9_opt3_text": "Multiplication", "q9_opt4_text": "Concatenation",
                 "q10_text": "10. Which of these expressions results in the string <code>\"HaHa\"</code>?",
                 "q10_opt1_text": "<code>\"Ha\" + 2</code>", "q10_opt2_text": "<code>\"Ha\" * 2</code>", "q10_opt3_text": "<code>len(\"HaHa\")</code>", "q10_opt4_text": "<code>\"Ha\"[0] + \"Ha\"[1]</code>",
                 "submit_button": "Submit Answers",
                 "retry_button": "Try Again",
                 "results_title_pass": "Passed!",
                 "results_title_fail": "Try Again!",
                 "results_score_text": "Your Score: <strong>{score}/{total}</strong>",
                 "results_message_pass": "Great job! You've passed the knowledge check for Module {module_id}. Your progress has been saved.",
                 "results_message_fail": "You need at least {passing_score} correct answers to pass. Review the material and try again!",
                 "footer_text": "Part of the Road to Free Open AGI Project"
             },
             pt: {
                 "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Python Completo`,
                 "return_button": "Voltar ao Painel",
                 "quiz_title": `Verificação: Módulo ${MODULE_ID} - Trabalhando com Texto`,
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "instructions_p1": "Teste seu entendimento do Módulo 3: Trabalhando com Texto.",
                 "instructions_p2": `São <strong>${totalQuestions} questões</strong>. Você precisa acertar pelo menos <strong>${PASSING_SCORE} questões</strong> para passar.`,
                 "instructions_p3": "Você pode tentar esta verificação quantas vezes quiser. Boa sorte!",
                 "instructions_already_passed": "Você já passou nesta verificação de conhecimento!",
                 "q1_text": "1. Qual é o resultado da expressão <code>\"Olá\" + \" \" + \"Mundo\"</code> em Python?",
                 "q1_opt1_text": "<code>\"OláMundo\"</code>", "q1_opt2_text": "<code>\"Olá Mundo\"</code>", "q1_opt3_text": "Um erro", "q1_opt4_text": "<code>Olá Mundo</code> (sem aspas)",
                 "q2_text": "2. Qual função é usada para encontrar o número de caracteres em uma string?",
                 "q2_opt1_text": "<code>count()</code>", "q2_opt2_text": "<code>size()</code>", "q2_opt3_text": "<code>len()</code>", "q2_opt4_text": "<code>length()</code>",
                 "q3_text": "3. O que <code>\"Py\" * 3</code> produzirá?",
                 "q3_opt1_text": "<code>\"PyPyPy\"</code>", "q3_opt2_text": "<code>\"Py Py Py\"</code>", "q3_opt3_text": "<code>\"Py3\"</code>", "q3_opt4_text": "Um erro",
                 "q4_text": "4. Se <code>palavra = \"Python\"</code>, o que é <code>palavra[0]</code>?",
                 "q4_opt1_text": "<code>\"P\"</code>", "q4_opt2_text": "<code>\"Python\"</code>", "q4_opt3_text": "<code>\"y\"</code>", "q4_opt4_text": "Um erro",
                 "q5_text": "5. Se <code>texto = \"Code\"</code>, o que é <code>texto[-1]</code>?",
                 "q5_opt1_text": "<code>\"C\"</code>", "q5_opt2_text": "<code>\"d\"</code>", "q5_opt3_text": "<code>\"e\"</code>", "q5_opt4_text": "Um erro",
                 "q6_text": "6. Ao trabalhar com strings, a que se refere o termo 'indexação'?",
                 "q6_opt1_text": "Combinar strings.", "q6_opt2_text": "Acessar caracteres individuais usando sua posição.", "q6_opt3_text": "Encontrar o comprimento da string.", "q6_opt4_text": "Repetir uma string várias vezes.",
                 "q7_text": "7. Se <code>mensagem = \"Bemvindo\"</code>, qual o resultado de <code>len(mensagem)</code>?",
                 "q7_opt1_text": "7", "q7_opt2_text": "8", "q7_opt3_text": "9", "q7_opt4_text": "<code>\"Bemvindo\"</code>", // Note: "Bemvindo" has 8 chars in Portuguese
                 "q8_text": "8. Considere <code>nome = \"Ada\"</code>. O que acontece se você tentar executar <code>nome[3]</code>?",
                 "q8_opt1_text": "Retorna o último caractere, <code>'a'</code>.", "q8_opt2_text": "Retorna <code>None</code>.", "q8_opt3_text": "Causa um <code>IndexError</code>.", "q8_opt4_text": "Retorna uma string vazia <code>\"\"</code>.",
                 "q9_text": "9. Como se chama a operação de juntar duas ou mais strings?",
                 "q9_opt1_text": "Indexação", "q9_opt2_text": "Fatiamento", "q9_opt3_text": "Multiplicação", "q9_opt4_text": "Concatenação",
                 "q10_text": "10. Qual destas expressões resulta na string <code>\"HaHa\"</code>?",
                 "q10_opt1_text": "<code>\"Ha\" + 2</code>", "q10_opt2_text": "<code>\"Ha\" * 2</code>", "q10_opt3_text": "<code>len(\"HaHa\")</code>", "q10_opt4_text": "<code>\"Ha\"[0] + \"Ha\"[1]</code>",
                 "submit_button": "Enviar Respostas",
                 "retry_button": "Tentar Novamente",
                 "results_title_pass": "Aprovado!",
                 "results_title_fail": "Tente Novamente!",
                 "results_score_text": "Sua Pontuação: <strong>{score}/{total}</strong>",
                 "results_message_pass": "Ótimo trabalho! Você passou na verificação do Módulo {module_id}. Seu progresso foi salvo.",
                 "results_message_fail": "Você precisa de pelo menos {passing_score} respostas corretas para passar. Revise o material e tente novamente!",
                 "footer_text": "Parte do Projeto Road to Free Open AGI"
             },
              zh: {
                  "page_title": `知识测验: 模块 ${MODULE_ID} - Python 完全指南`,
                  "return_button": "返回仪表板",
                  "quiz_title": `知识测验: 模块 ${MODULE_ID} - 处理文本`,
                  "lang_select_aria": "选择语言",
                  "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                  "instructions_p1": "测试您对模块 3：处理文本的理解程度。",
                  "instructions_p2": `共有 <strong>${totalQuestions} 个问题</strong>。您至少需要答对 <strong>${PASSING_SCORE} 个问题</strong> 才能通过。`,
                  "instructions_p3": "您可以根据需要尝试多次测验。祝您好运！",
                 "instructions_already_passed": "您已通过此知识测验！",
                  "q1_text": "1. 表达式 <code>\"Hello\" + \" \" + \"World\"</code> 在 Python 中的结果是什么？",
                  "q1_opt1_text": "<code>\"HelloWorld\"</code>", "q1_opt2_text": "<code>\"Hello World\"</code>", "q1_opt3_text": "一个错误", "q1_opt4_text": "<code>Hello World</code> (没有引号)",
                  "q2_text": "2. 哪个函数用于查找字符串中的字符数？",
                  "q2_opt1_text": "<code>count()</code>", "q2_opt2_text": "<code>size()</code>", "q2_opt3_text": "<code>len()</code>", "q2_opt4_text": "<code>length()</code>",
                  "q3_text": "3. <code>\"Py\" * 3</code> 会产生什么？",
                  "q3_opt1_text": "<code>\"PyPyPy\"</code>", "q3_opt2_text": "<code>\"Py Py Py\"</code>", "q3_opt3_text": "<code>\"Py3\"</code>", "q3_opt4_text": "一个错误",
                  "q4_text": "4. 如果 <code>word = \"Python\"</code>，那么 <code>word[0]</code> 是什么？",
                  "q4_opt1_text": "<code>\"P\"</code>", "q4_opt2_text": "<code>\"Python\"</code>", "q4_opt3_text": "<code>\"y\"</code>", "q4_opt4_text": "一个错误",
                  "q5_text": "5. 如果 <code>text = \"Code\"</code>，那么 <code>text[-1]</code> 是什么？",
                  "q5_opt1_text": "<code>\"C\"</code>", "q5_opt2_text": "<code>\"d\"</code>", "q5_opt3_text": "<code>\"e\"</code>", "q5_opt4_text": "一个错误",
                  "q6_text": "6. 在处理字符串时，术语“索引 (indexing)”指的是什么？",
                  "q6_opt1_text": "将字符串组合在一起。", "q6_opt2_text": "使用位置访问单个字符。", "q6_opt3_text": "查找字符串的长度。", "q6_opt4_text": "将字符串重复多次。",
                  "q7_text": "7. 如果 <code>message = \"Welcome\"</code>，那么 <code>len(message)</code> 的结果是什么？",
                  "q7_opt1_text": "6", "q7_opt2_text": "7", "q7_opt3_text": "8", "q7_opt4_text": "<code>\"Welcome\"</code>",
                  "q8_text": "8. 假设 <code>name = \"Ada\"</code>。如果您尝试执行 <code>name[3]</code> 会发生什么？",
                  "q8_opt1_text": "它返回最后一个字符 <code>'a'</code>。", "q8_opt2_text": "它返回 <code>None</code>。", "q8_opt3_text": "它导致一个 <code>IndexError</code>。", "q8_opt4_text": "它返回一个空字符串 <code>\"\"</code>。",
                  "q9_text": "9. 连接两个或多个字符串的操作称为什么？",
                  "q9_opt1_text": "索引", "q9_opt2_text": "切片", "q9_opt3_text": "乘法", "q9_opt4_text": "连接 (Concatenation)",
                  "q10_text": "10. 以下哪个表达式的结果是字符串 <code>\"HaHa\"</code>？",
                  "q10_opt1_text": "<code>\"Ha\" + 2</code>", "q10_opt2_text": "<code>\"Ha\" * 2</code>", "q10_opt3_text": "<code>len(\"HaHa\")</code>", "q10_opt4_text": "<code>\"Ha\"[0] + \"Ha\"[1]</code>",
                  "submit_button": "提交答案",
                  "retry_button": "再试一次",
                  "results_title_pass": "通过！",
                  "results_title_fail": "再试一次！",
                  "results_score_text": "您的得分: <strong>{score}/{total}</strong>",
                  "results_message_pass": "做得好！您已通过模块 {module_id} 的知识测验。您的进度已保存。",
                  "results_message_fail": "您至少需要答对 {passing_score} 题才能通过。请复习相关内容后再试一次！",
                  "footer_text": "通往自由开放 AGI 之路项目的一部分"
             }
         };

        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const quizFieldset = document.getElementById('quiz-fieldset');
        const submitButton = document.getElementById('submit-button');
        const retryButton = document.getElementById('retry-button');
        const resultsDiv = document.getElementById('quiz-results');
        const resultsTitle = document.getElementById('results-title');
        const resultsScore = document.getElementById('results-score');
        const resultsMessage = document.getElementById('results-message');
        const languageSelect = document.getElementById('languageSelect');
        const alreadyPassedMsg = document.querySelector('.quiz-instructions [data-translate="instructions_already_passed"]');

        // --- Utility Functions ---
        function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
        function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); if (storedLang && translations[storedLang]) return storedLang; const browserLang = navigator.language || navigator.userLanguage; if (browserLang.startsWith('pt')) return 'pt'; if (browserLang.startsWith('zh')) return 'zh'; return 'en'; }
        function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang, { score: '?', total: totalQuestions, module_id: MODULE_ID, passing_score: PASSING_SCORE }); if (el.tagName === 'TITLE') { document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); });
            document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); });
            // Re-check already passed status visibility after translation
             checkAlreadyPassed();
        }
        function setLanguage(lang) { if (!translations[lang]) lang = 'en'; localStorage.setItem(LANGUAGE_STORAGE_KEY, lang); languageSelect.value = lang; translatePage(lang); }

        // --- Quiz Logic Functions ---
        function checkAlreadyPassed() {
            const knowledgeCheckStatus = loadKnowledgeCheckStatus();
            if (knowledgeCheckStatus[MODULE_ID] === true) {
                alreadyPassedMsg.style.display = 'block';
                // Optional: Disable form if already passed?
                // quizFieldset.disabled = true;
                // submitButton.disabled = true;
                // retryButton.style.display = 'none';
            } else {
                 alreadyPassedMsg.style.display = 'none';
            }
        }

        function showResults(score, passed) {
            const lang = getStoredLanguage();
            resultsDiv.style.display = 'block';
            resultsScore.innerHTML = getTranslation('results_score_text', lang, { score: score, total: totalQuestions });

            if (passed) {
                resultsTitle.textContent = getTranslation('results_title_pass', lang);
                resultsMessage.innerHTML = getTranslation('results_message_pass', lang, { module_id: MODULE_ID });
                resultsDiv.className = 'pass';
                retryButton.style.display = 'none'; // No retry needed if passed
                 // Save progress
                const knowledgeCheckStatus = loadKnowledgeCheckStatus();
                knowledgeCheckStatus[MODULE_ID] = true;
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(knowledgeCheckStatus));
                checkAlreadyPassed(); // Update instruction message
            } else {
                resultsTitle.textContent = getTranslation('results_title_fail', lang);
                resultsMessage.innerHTML = getTranslation('results_message_fail', lang, { passing_score: PASSING_SCORE });
                resultsDiv.className = 'fail';
                retryButton.style.display = 'inline-flex'; // Show retry button
            }

            submitButton.disabled = true;
            quizFieldset.disabled = true; // Disable inputs after submission
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function highlightAnswers(userAnswers) {
             // Remove previous highlights first
             document.querySelectorAll('.quiz-option.correct, .quiz-option.incorrect').forEach(el => {
                 el.classList.remove('correct', 'incorrect');
             });

             Object.keys(correctAnswers).forEach(questionId => {
                const correctAnswerValue = correctAnswers[questionId];
                const userAnswerValue = userAnswers[questionId];

                const options = document.querySelectorAll(`.quiz-question[data-question-id="${questionId}"] .quiz-option`);
                options.forEach(option => {
                    const input = option.querySelector('input[type="radio"]');
                    if (input.value === correctAnswerValue) {
                        option.classList.add('correct'); // Highlight correct answer
                    } else if (input.value === userAnswerValue) {
                         option.classList.add('incorrect'); // Highlight user's incorrect choice
                    }
                });
             });
        }


        function handleSubmit(event) {
            event.preventDefault();
            let score = 0;
            const userAnswers = {};
            const formData = new FormData(quizForm);

            for (const [questionId, userAnswer] of formData.entries()) {
                userAnswers[questionId] = userAnswer; // Store user's answer
                if (userAnswer === correctAnswers[questionId]) {
                    score++;
                }
            }

            const passed = score >= PASSING_SCORE;
            highlightAnswers(userAnswers); // Highlight after calculating score
            showResults(score, passed);
        }

        function resetQuiz() {
            resultsDiv.style.display = 'none';
            retryButton.style.display = 'none';
            submitButton.disabled = false;
            quizFieldset.disabled = false; // Re-enable inputs
            quizForm.reset(); // Clear selections
            // Remove highlights
             document.querySelectorAll('.quiz-option.correct, .quiz-option.incorrect').forEach(el => {
                 el.classList.remove('correct', 'incorrect');
             });
            // Scroll back to top might be nice
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // Re-check if they passed *just now* and maybe shouldn't be able to reset?
            // For now, allowing reset is fine as per requirements.
            checkAlreadyPassed();
        }


        // --- Event Listeners ---
        quizForm.addEventListener('submit', handleSubmit);
        retryButton.addEventListener('click', resetQuiz);
        languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            setLanguage(initialLang); // Translate page on load
            // checkAlreadyPassed is called within translatePage now
        });

    </script>

</body>
</html>
