<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 3 - Working with Text</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from dashboard, slightly adjusted) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Purple for check links */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Header --- */
        .kc-header {
            background: var(--background-header); color: var(--text-light);
            padding: 1.5rem 1.5rem; margin-bottom: 2rem;
            display: flex; align-items: center; justify-content: space-between;
            position: relative;
        }
        .header-content { display: flex; align-items: center; gap: 1rem; }
        .kc-header h1 {
            font-family: var(--font-title); font-size: 1.8rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); margin: 0;
        }
        .return-button {
            display: inline-flex; align-items: center; gap: 8px;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light); border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.6rem 1rem; border-radius: var(--border-radius);
            text-decoration: none; font-weight: 500;
            transition: background-color var(--transition-speed) ease;
        }
        .return-button:hover { background-color: rgba(255, 255, 255, 0.25); }
        .return-button i { font-size: 0.9em; }

        /* Language Switcher in Header */
        .language-switcher { position: relative; }
        #languageSelect {
            background: rgba(255, 255, 255, 0.1); color: var(--text-light);
            border: 1px solid var(--lang-select-border); border-radius: 5px;
            padding: 8px 30px 8px 12px; cursor: pointer; font-size: 0.9rem;
            font-weight: 500; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--text-light').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
         #languageSelect:hover { background-color: rgba(255, 255, 255, 0.15); border-color: var(--accent-color); }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Content Area --- */
        .kc-container {
            max-width: 900px; margin: 0 auto; padding: 0 1.5rem;
        }
        .quiz-card {
            background-color: var(--background-card); border-radius: var(--border-radius);
            padding: 2rem 2.5rem; box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        .quiz-instructions {
            margin-bottom: 2rem; padding-bottom: 1rem;
            border-bottom: 1px dashed var(--border-color); font-size: 0.95rem;
            color: var(--text-muted);
        }
        .quiz-instructions p { margin-bottom: 0.5rem; }
        .quiz-instructions strong { color: var(--text-dark); font-weight: 500; }
        .quiz-instructions i { color: var(--check-color); }

        /* --- Quiz Form Styling --- */
        .quiz-form fieldset {
            border: none; padding: 0; margin: 0 0 2rem 0;
        }
        .quiz-form legend {
            font-size: 1.2rem; font-weight: 500; color: var(--primary-color);
            margin-bottom: 1rem; padding: 0; display: block; width: 100%;
        }
        .quiz-form legend code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            background-color: #e9ecef; padding: 0.15em 0.4em;
            border-radius: 3px; font-size: 0.9em; color: #c7254e;
        }
        .quiz-options label {
            display: block; background-color: #f8f9fa;
            padding: 0.8rem 1.2rem; margin-bottom: 0.7rem;
            border-radius: 6px; border: 1px solid var(--border-color);
            cursor: pointer; transition: all var(--transition-speed) ease;
        }
        .quiz-options label:hover { background-color: #e9ecef; border-color: var(--secondary-color); }
        .quiz-options input[type="radio"] { margin-right: 10px; vertical-align: middle; accent-color: var(--primary-color); }
        .quiz-options label code { /* Same as legend code */
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            background-color: #ddeeff; padding: 0.1em 0.3em; border-radius: 3px;
            font-size: 0.9em; color: var(--primary-color);
        }

        /* Styling for checked state (enhanced) */
        .quiz-options input[type="radio"]:checked + span { font-weight: 500; }
        .quiz-options label.selected { border-color: var(--primary-color); background-color: #e7f1ff; }

        /* Feedback Styling */
         .quiz-options label.correct { border-color: var(--success-color); background-color: #d1e7dd; color: #0f5132; font-weight: 500; }
         .quiz-options label.incorrect { border-color: var(--error-color); background-color: #f8d7da; color: #842029; }
         .quiz-options label.correct::after { content: ' \f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--success-color); margin-left: 8px; }
         .quiz-options label.incorrect::after { content: ' \f00d'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--error-color); margin-left: 8px; }
         .quiz-options label.missed-correct { /* Style for the correct answer when user chose wrong */ border: 2px dashed var(--success-color); background-color: #e9f7ef; }
         .quiz-options label.missed-correct::after { content: ' \f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--success-color); margin-left: 8px; }

        /* --- Buttons --- */
        .quiz-buttons { text-align: center; margin-top: 2rem; }
        .quiz-button {
            background-color: var(--primary-color); color: var(--text-light);
            border: none; padding: 0.8rem 1.8rem; font-size: 1rem;
            border-radius: var(--border-radius); cursor: pointer;
            transition: background-color var(--transition-speed) ease, transform 0.1s ease;
            font-weight: 500; margin: 0 0.5rem;
        }
        .quiz-button:hover { background-color: #0a58ca; }
        .quiz-button:active { transform: scale(0.98); }
        .quiz-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }
        .quiz-button.retry-button { background-color: var(--secondary-color); }
        .quiz-button.retry-button:hover { background-color: #5a6268; }

        /* --- Results Area --- */
        #quiz-results {
            margin-top: 2.5rem; padding: 1.5rem; border-radius: var(--border-radius);
            border: 1px solid var(--border-color); display: none; /* Hidden by default */
            text-align: center;
        }
        #quiz-results.pass { background-color: #d1e7dd; border-color: var(--success-color); }
        #quiz-results.fail { background-color: #f8d7da; border-color: var(--error-color); }
        #quiz-results h3 {
            font-family: var(--font-title); margin-bottom: 0.8rem;
        }
        #quiz-results.pass h3 { color: var(--success-color); }
        #quiz-results.fail h3 { color: var(--error-color); }
        #quiz-results p { font-size: 1.1rem; margin-bottom: 1rem; color: var(--text-dark); }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: 3rem;
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header { flex-direction: column; gap: 1rem; text-align: center; }
            .header-content { flex-direction: column; }
            .kc-header h1 { font-size: 1.6rem; }
            .quiz-card { padding: 1.5rem; }
            .quiz-form legend { font-size: 1.1rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .kc-header h1 { font-size: 1.4rem; }
            .return-button { padding: 0.5rem 0.8rem; font-size: 0.9rem; }
            #languageSelect { padding: 6px 25px 6px 10px; font-size: 0.85rem; }
            .quiz-card { padding: 1rem 1.2rem; }
            .quiz-options label { padding: 0.7rem 1rem; }
            .quiz-button { padding: 0.7rem 1.5rem; font-size: 0.95rem; }
            #quiz-results { padding: 1rem; }
            #quiz-results p { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <header class="kc-header">
        <div class="header-content">
            <a href="ctp-dashboard.html" class="return-button">
                <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
            </a>
            <h1 data-translate="header_title">Module 3 Check: Working with Text</h1>
        </div>
        <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">ğŸ‡¬ğŸ‡§ English</option>
                <option value="pt" data-translate="lang_pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                <option value="zh" data-translate="lang_zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            </select>
        </div>
    </header>

    <main class="kc-container">
        <div class="quiz-card">
            <div class="quiz-instructions">
                <p><strong data-translate="instructions_title">Instructions:</strong></p>
                <p data-translate="instructions_pass">Answer the following 10 questions about working with text in Python.</p>
                <p><span data-translate="instructions_score">You need at least <strong data-score-needed>6</strong> correct answers to pass.</span> <span data-translate="instructions_attempts">You can retry as many times as you need.</span></p>
                <p><i class="fas fa-check-double"></i> <span data-translate="instructions_progress">Passing this check contributes to your certificate progress.</span></p>
            </div>

            <form id="quiz-form" class="quiz-form">
                <!-- Questions will be dynamically inserted here by JavaScript -->
            </form>

            <div id="quiz-results">
                <h3 id="results-title"></h3>
                <p id="results-score"></p>
                <p id="results-message"></p>
            </div>

            <div class="quiz-buttons">
                <button type="submit" id="submit-button" class="quiz-button" data-translate="submit_button">Submit Answers</button>
                <button type="button" id="retry-button" class="quiz-button retry-button" style="display: none;" data-translate="retry_button">Try Again</button>
            </div>
        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Constants ---
        const MODULE_ID = 3; // Module this check is for
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object ---
        const translations = {
            en: {
                "page_title": "Knowledge Check: Module 3 - Working with Text",
                "header_title": "Module 3 Check: Working with Text",
                "return_button": "Return to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "ğŸ‡¬ğŸ‡§ English",
                "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs",
                "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡",
                "instructions_title": "Instructions:",
                "instructions_pass": "Answer the following 10 questions about working with text in Python.",
                "instructions_score": "You need at least {score} correct answers to pass.",
                "instructions_attempts": "You can retry as many times as you need.",
                "instructions_progress": "Passing this check contributes to your certificate progress.",
                "submit_button": "Submit Answers",
                "retry_button": "Try Again",
                "results_title_pass": "Passed!",
                "results_title_fail": "Needs Improvement",
                "results_score_details": "Your score: {score} / {total}",
                "results_message_pass": "Great job! You've successfully completed the knowledge check for Module {moduleId}.",
                "results_message_fail": "Don't worry, review the material and try again. You can do it!",
                "footer_text": "Part of the Road to Free Open AGI Project",
                // --- Questions & Options (Module 3) ---
                "q1_question": "What is the result of the expression <code>'Hello' + ' ' + 'World'</code>?",
                "q1_opt1": "HelloWorld",
                "q1_opt2": "Hello World", // Correct
                "q1_opt3": "Error",
                "q1_opt4": "Hello + World",
                "q2_question": "What does <code>'Py' * 3</code> evaluate to?",
                "q2_opt1": "PyPyPy", // Correct
                "q2_opt2": "Py3",
                "q2_opt3": "Error",
                "q2_opt4": "Py * 3",
                "q3_question": "Which function is used to find the number of characters in a string?",
                "q3_opt1": "<code>count()</code>",
                "q3_opt2": "<code>size()</code>",
                "q3_opt3": "<code>length()</code>",
                "q3_opt4": "<code>len()</code>", // Correct
                "q4_question": "If <code>word = 'Python'</code>, what is the value of <code>word[0]</code>?",
                "q4_opt1": "'P'", // Correct
                "q4_opt2": "'p'",
                "q4_opt3": "'n'",
                "q4_opt4": "Error",
                "q5_question": "Using the same <code>word = 'Python'</code>, what is <code>word[-1]</code>?",
                "q5_opt1": "'P'",
                "q5_opt2": "'o'",
                "q5_opt3": "'n'", // Correct
                "q5_opt4": "Error",
                "q6_question": "What happens if you try to execute <code>'Score: ' + 10</code>?",
                "q6_opt1": "It results in 'Score: 10'.",
                "q6_opt2": "It results in 'Score:10'.",
                "q6_opt3": "It causes a TypeError.", // Correct
                "q6_opt4": "It results in 'Score: + 10'.",
                "q7_question": "What is the result of <code>len('Ha' * 2)</code>?",
                "q7_opt1": "2",
                "q7_opt2": "3",
                "q7_opt3": "4", // Correct ('HaHa')
                "q7_opt4": "Error",
                "q8_question": "If <code>text = 'Code'</code>, what happens if you try to access <code>text[5]</code>?",
                "q8_opt1": "It returns nothing.",
                "q8_opt2": "It returns the last character 'e'.",
                "q8_opt3": "It causes an IndexError.", // Correct
                "q8_opt4": "It causes a ValueError.",
                "q9_question": "What does the <code>+</code> operator do when used with two strings?",
                "q9_opt1": "Adds their lengths.",
                "q9_opt2": "Compares them alphabetically.",
                "q9_opt3": "Joins them together (concatenation).", // Correct
                "q9_opt4": "Causes an error.",
                "q10_question": "What is the primary purpose of indexing (e.g., <code>my_string[i]</code>)?",
                "q10_opt1": "To change the string.",
                "q10_opt2": "To get the length of the string.",
                "q10_opt3": "To access a specific character at a position.", // Correct
                "q10_opt4": "To count occurrences of a character."
            },
            pt: {
                 "page_title": "VerificaÃ§Ã£o de Conhecimento: MÃ³dulo 3 - Trabalhando com Texto",
                 "header_title": "VerificaÃ§Ã£o MÃ³dulo 3: Trabalhando com Texto",
                 "return_button": "Voltar ao Painel",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "ğŸ‡¬ğŸ‡§ English",
                 "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs",
                 "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡",
                 "instructions_title": "InstruÃ§Ãµes:",
                 "instructions_pass": "Responda Ã s 10 perguntas seguintes sobre como trabalhar com texto em Python.",
                 "instructions_score": "VocÃª precisa de pelo menos {score} respostas corretas para passar.",
                 "instructions_attempts": "VocÃª pode tentar novamente quantas vezes precisar.",
                 "instructions_progress": "Passar nesta verificaÃ§Ã£o contribui para o progresso do seu certificado.",
                 "submit_button": "Enviar Respostas",
                 "retry_button": "Tentar Novamente",
                 "results_title_pass": "Aprovado!",
                 "results_title_fail": "Precisa Melhorar",
                 "results_score_details": "Sua pontuaÃ§Ã£o: {score} / {total}",
                 "results_message_pass": "Ã“timo trabalho! VocÃª completou com sucesso a verificaÃ§Ã£o de conhecimento para o MÃ³dulo {moduleId}.",
                 "results_message_fail": "NÃ£o se preocupe, revise o material e tente novamente. VocÃª consegue!",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // --- Questions & Options (Module 3 - PT) ---
                 "q1_question": "Qual Ã© o resultado da expressÃ£o <code>'OlÃ¡' + ' ' + 'Mundo'</code>?",
                 "q1_opt1": "OlÃ¡Mundo",
                 "q1_opt2": "OlÃ¡ Mundo", // Correct
                 "q1_opt3": "Erro",
                 "q1_opt4": "OlÃ¡ + Mundo",
                 "q2_question": "O que <code>'Py' * 3</code> resulta?",
                 "q2_opt1": "PyPyPy", // Correct
                 "q2_opt2": "Py3",
                 "q2_opt3": "Erro",
                 "q2_opt4": "Py * 3",
                 "q3_question": "Qual funÃ§Ã£o Ã© usada para encontrar o nÃºmero de caracteres em uma string?",
                 "q3_opt1": "<code>count()</code>",
                 "q3_opt2": "<code>size()</code>",
                 "q3_opt3": "<code>length()</code>",
                 "q3_opt4": "<code>len()</code>", // Correct
                 "q4_question": "Se <code>palavra = 'Python'</code>, qual Ã© o valor de <code>palavra[0]</code>?",
                 "q4_opt1": "'P'", // Correct
                 "q4_opt2": "'p'",
                 "q4_opt3": "'n'",
                 "q4_opt4": "Erro",
                 "q5_question": "Usando a mesma <code>palavra = 'Python'</code>, o que Ã© <code>palavra[-1]</code>?",
                 "q5_opt1": "'P'",
                 "q5_opt2": "'o'",
                 "q5_opt3": "'n'", // Correct
                 "q5_opt4": "Erro",
                 "q6_question": "O que acontece se vocÃª tentar executar <code>'PontuaÃ§Ã£o: ' + 10</code>?",
                 "q6_opt1": "Resulta em 'PontuaÃ§Ã£o: 10'.",
                 "q6_opt2": "Resulta em 'PontuaÃ§Ã£o:10'.",
                 "q6_opt3": "Causa um TypeError.", // Correct
                 "q6_opt4": "Resulta em 'PontuaÃ§Ã£o: + 10'.",
                 "q7_question": "Qual Ã© o resultado de <code>len('Ha' * 2)</code>?",
                 "q7_opt1": "2",
                 "q7_opt2": "3",
                 "q7_opt3": "4", // Correct ('HaHa')
                 "q7_opt4": "Erro",
                 "q8_question": "Se <code>texto = 'Code'</code>, o que acontece se vocÃª tentar acessar <code>texto[5]</code>?",
                 "q8_opt1": "NÃ£o retorna nada.",
                 "q8_opt2": "Retorna o Ãºltimo caractere 'e'.",
                 "q8_opt3": "Causa um IndexError.", // Correct
                 "q8_opt4": "Causa um ValueError.",
                 "q9_question": "O que o operador <code>+</code> faz quando usado com duas strings?",
                 "q9_opt1": "Soma seus comprimentos.",
                 "q9_opt2": "Compara-as alfabeticamente.",
                 "q9_opt3": "Junta-as (concatenaÃ§Ã£o).", // Correct
                 "q9_opt4": "Causa um erro.",
                 "q10_question": "Qual Ã© o propÃ³sito principal da indexaÃ§Ã£o (ex: <code>minha_string[i]</code>)?",
                 "q10_opt1": "Modificar a string.",
                 "q10_opt2": "Obter o comprimento da string.",
                 "q10_opt3": "Acessar um caractere especÃ­fico em uma posiÃ§Ã£o.", // Correct
                 "q10_opt4": "Contar ocorrÃªncias de um caractere."
            },
            zh: {
                 "page_title": "çŸ¥è¯†æµ‹éªŒï¼šæ¨¡å— 3 - å¤„ç†æ–‡æœ¬",
                 "header_title": "æ¨¡å— 3 æµ‹éªŒï¼šå¤„ç†æ–‡æœ¬",
                 "return_button": "è¿”å›ä»ªè¡¨æ¿",
                 "lang_select_aria": "é€‰æ‹©è¯­è¨€",
                 "lang_en": "ğŸ‡¬ğŸ‡§ English",
                 "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs",
                 "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡",
                 "instructions_title": "è¯´æ˜ï¼š",
                 "instructions_pass": "å›ç­”ä»¥ä¸‹å…³äºåœ¨ Python ä¸­å¤„ç†æ–‡æœ¬çš„ 10 ä¸ªé—®é¢˜ã€‚",
                 "instructions_score": "æ‚¨è‡³å°‘éœ€è¦ç­”å¯¹ {score} é¢˜æ‰èƒ½é€šè¿‡ã€‚",
                 "instructions_attempts": "æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é‡è¯•ä»»æ„æ¬¡æ•°ã€‚",
                 "instructions_progress": "é€šè¿‡æ­¤æµ‹éªŒæœ‰åŠ©äºæ‚¨çš„è¯ä¹¦è¿›åº¦ã€‚",
                 "submit_button": "æäº¤ç­”æ¡ˆ",
                 "retry_button": "å†è¯•ä¸€æ¬¡",
                 "results_title_pass": "é€šè¿‡ï¼",
                 "results_title_fail": "æœ‰å¾…æ”¹è¿›",
                 "results_score_details": "ä½ çš„åˆ†æ•°ï¼š{score} / {total}",
                 "results_message_pass": "åšå¾—å¥½ï¼æ‚¨å·²æˆåŠŸå®Œæˆæ¨¡å— {moduleId} çš„çŸ¥è¯†æµ‹éªŒã€‚",
                 "results_message_fail": "åˆ«æ‹…å¿ƒï¼Œå¤ä¹ ä¸€ä¸‹ææ–™å†è¯•ä¸€æ¬¡ã€‚ä½ å¯ä»¥åšåˆ°çš„ï¼",
                 "footer_text": "é€šå¾€è‡ªç”±å¼€æ”¾AGIä¹‹è·¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†",
                 // --- Questions & Options (Module 3 - ZH) ---
                 "q1_question": "è¡¨è¾¾å¼ <code>'Hello' + ' ' + 'World'</code> çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q1_opt1": "HelloWorld",
                 "q1_opt2": "Hello World", // Correct
                 "q1_opt3": "é”™è¯¯",
                 "q1_opt4": "Hello + World",
                 "q2_question": "<code>'Py' * 3</code> çš„è®¡ç®—ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q2_opt1": "PyPyPy", // Correct
                 "q2_opt2": "Py3",
                 "q2_opt3": "é”™è¯¯",
                 "q2_opt4": "Py * 3",
                 "q3_question": "å“ªä¸ªå‡½æ•°ç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ•°ï¼Ÿ",
                 "q3_opt1": "<code>count()</code>",
                 "q3_opt2": "<code>size()</code>",
                 "q3_opt3": "<code>length()</code>",
                 "q3_opt4": "<code>len()</code>", // Correct
                 "q4_question": "å¦‚æœ <code>word = 'Python'</code>ï¼Œé‚£ä¹ˆ <code>word[0]</code> çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q4_opt1": "'P'", // Correct
                 "q4_opt2": "'p'",
                 "q4_opt3": "'n'",
                 "q4_opt4": "é”™è¯¯",
                 "q5_question": "ä½¿ç”¨ç›¸åŒçš„ <code>word = 'Python'</code>ï¼Œ<code>word[-1]</code> æ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q5_opt1": "'P'",
                 "q5_opt2": "'o'",
                 "q5_opt3": "'n'", // Correct
                 "q5_opt4": "é”™è¯¯",
                 "q6_question": "å¦‚æœä½ å°è¯•æ‰§è¡Œ <code>'Score: ' + 10</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ",
                 "q6_opt1": "ç»“æœæ˜¯ 'Score: 10'ã€‚",
                 "q6_opt2": "ç»“æœæ˜¯ 'Score:10'ã€‚",
                 "q6_opt3": "å¯¼è‡´ TypeErrorã€‚", // Correct
                 "q6_opt4": "ç»“æœæ˜¯ 'Score: + 10'ã€‚",
                 "q7_question": "<code>len('Ha' * 2)</code> çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q7_opt1": "2",
                 "q7_opt2": "3",
                 "q7_opt3": "4", // Correct ('HaHa')
                 "q7_opt4": "é”™è¯¯",
                 "q8_question": "å¦‚æœ <code>text = 'Code'</code>ï¼Œå½“ä½ å°è¯•è®¿é—® <code>text[5]</code> æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ",
                 "q8_opt1": "å®ƒä¸è¿”å›ä»»ä½•å†…å®¹ã€‚",
                 "q8_opt2": "å®ƒè¿”å›æœ€åä¸€ä¸ªå­—ç¬¦ 'e'ã€‚",
                 "q8_opt3": "å¯¼è‡´ IndexErrorã€‚", // Correct
                 "q8_opt4": "å¯¼è‡´ ValueErrorã€‚",
                 "q9_question": "å½“ <code>+</code> è¿ç®—ç¬¦ç”¨äºä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä»€ä¹ˆï¼Ÿ",
                 "q9_opt1": "å°†å®ƒä»¬çš„é•¿åº¦ç›¸åŠ ã€‚",
                 "q9_opt2": "æŒ‰å­—æ¯é¡ºåºæ¯”è¾ƒå®ƒä»¬ã€‚",
                 "q9_opt3": "å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼ˆä¸²è”ï¼‰ã€‚", // Correct
                 "q9_opt4": "å¯¼è‡´é”™è¯¯ã€‚",
                 "q10_question": "ç´¢å¼•ï¼ˆä¾‹å¦‚ <code>my_string[i]</code>ï¼‰çš„ä¸»è¦ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ",
                 "q10_opt1": "æ”¹å˜å­—ç¬¦ä¸²ã€‚",
                 "q10_opt2": "è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚",
                 "q10_opt3": "è®¿é—®ç‰¹å®šä½ç½®çš„ç‰¹å®šå­—ç¬¦ã€‚", // Correct
                 "q10_opt4": "è®¡ç®—å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ã€‚"
            }
        };

        // --- Quiz Data (Module 3) ---
        const quizData = [
            { questionKey: "q1_question", optionsKeys: ["q1_opt1", "q1_opt2", "q1_opt3", "q1_opt4"], correctIndex: 1 },
            { questionKey: "q2_question", optionsKeys: ["q2_opt1", "q2_opt2", "q2_opt3", "q2_opt4"], correctIndex: 0 },
            { questionKey: "q3_question", optionsKeys: ["q3_opt1", "q3_opt2", "q3_opt3", "q3_opt4"], correctIndex: 3 },
            { questionKey: "q4_question", optionsKeys: ["q4_opt1", "q4_opt2", "q4_opt3", "q4_opt4"], correctIndex: 0 },
            { questionKey: "q5_question", optionsKeys: ["q5_opt1", "q5_opt2", "q5_opt3", "q5_opt4"], correctIndex: 2 },
            { questionKey: "q6_question", optionsKeys: ["q6_opt1", "q6_opt2", "q6_opt3", "q6_opt4"], correctIndex: 2 },
            { questionKey: "q7_question", optionsKeys: ["q7_opt1", "q7_opt2", "q7_opt3", "q7_opt4"], correctIndex: 2 },
            { questionKey: "q8_question", optionsKeys: ["q8_opt1", "q8_opt2", "q8_opt3", "q8_opt4"], correctIndex: 2 },
            { questionKey: "q9_question", optionsKeys: ["q9_opt1", "q9_opt2", "q9_opt3", "q9_opt4"], correctIndex: 2 },
            { questionKey: "q10_question", optionsKeys: ["q10_opt1", "q10_opt2", "q10_opt3", "q10_opt4"], correctIndex: 2 }
        ];

        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const resultsDiv = document.getElementById('quiz-results');
        const resultsTitle = document.getElementById('results-title');
        const resultsScore = document.getElementById('results-score');
        const resultsMessage = document.getElementById('results-message');
        const submitButton = document.getElementById('submit-button');
        const retryButton = document.getElementById('retry-button');
        const languageSelectElement = document.getElementById('languageSelect');
        const scoreNeededSpan = document.querySelector('[data-score-needed]');

        // --- State ---
        let currentScore = 0;
        let submitted = false;

        // --- Translation Functions ---
        function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); return (storedLang && translations[storedLang]) ? storedLang : 'en'; }
        function setLanguage(lang) { if (!translations[lang]) lang = 'en'; localStorage.setItem(LANGUAGE_STORAGE_KEY, lang); document.documentElement.lang = lang; if (languageSelectElement) languageSelectElement.value = lang; updateUI(); }
        function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
        function translatePage(lang) { document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang); if (el.tagName === 'TITLE') document.title = translation; else if (translation.includes('<') && translation.includes('>')) el.innerHTML = translation; else el.textContent = translation; }); document.querySelectorAll('[data-translate-placeholder]').forEach(el => el.setAttribute('placeholder', getTranslation(el.getAttribute('data-translate-placeholder'), lang))); document.querySelectorAll('[data-translate-aria-label]').forEach(el => el.setAttribute('aria-label', getTranslation(el.getAttribute('data-translate-aria-label'), lang))); // Translate dynamic elements like score needed if (scoreNeededSpan) { const scoreText = getTranslation("instructions_score", lang, { score: PASSING_SCORE }); const attemptsText = getTranslation("instructions_attempts", lang); scoreNeededSpan.parentElement.innerHTML = `${scoreText} ${attemptsText}`; // Update parent p tag } }

        // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); return storedStatus ? JSON.parse(storedStatus) : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
        function saveKnowledgeCheckStatus(statusObject) { try { localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject)); } catch (e) { console.error("Error saving KC status to localStorage:", e); } }
        function markModuleComplete(moduleId) { const status = loadKnowledgeCheckStatus(); status[moduleId] = true; saveKnowledgeCheckStatus(status); }

        // --- Quiz Logic ---
        function renderQuestions(lang) {
            quizForm.innerHTML = ''; // Clear previous questions
            quizData.forEach((q, index) => {
                const fieldset = document.createElement('fieldset');
                fieldset.setAttribute('aria-labelledby', `q${index + 1}-legend`);

                const legend = document.createElement('legend');
                legend.id = `q${index + 1}-legend`;
                // InnerHTML needed for <code> tags within question
                legend.innerHTML = `${index + 1}. ${getTranslation(q.questionKey, lang)}`;
                fieldset.appendChild(legend);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'quiz-options';

                q.optionsKeys.forEach((optKey, optIndex) => {
                    const label = document.createElement('label');
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `question${index}`;
                    radio.value = optIndex;
                    radio.id = `q${index}o${optIndex}`;
                    radio.required = true; // Make sure an answer is selected

                    const span = document.createElement('span');
                    // Use innerHTML for options that might contain <code>
                    span.innerHTML = getTranslation(optKey, lang);

                    label.htmlFor = `q${index}o${optIndex}`;
                    label.appendChild(radio);
                    label.appendChild(span);
                    optionsDiv.appendChild(label);

                    // Add event listener for visual selection feedback
                    radio.addEventListener('change', () => {
                        // Remove 'selected' from siblings
                        fieldset.querySelectorAll('.quiz-options label').forEach(l => l.classList.remove('selected'));
                        // Add 'selected' to current parent label
                        label.classList.add('selected');
                    });
                });

                fieldset.appendChild(optionsDiv);
                quizForm.appendChild(fieldset);
            });
        }

        function gradeQuiz(lang) {
            currentScore = 0;
            submitted = true;
            const totalQuestions = quizData.length;

            quizData.forEach((q, index) => {
                const selectedOption = quizForm.querySelector(`input[name="question${index}"]:checked`);
                const options = quizForm.querySelectorAll(`input[name="question${index}"]`);
                const labels = quizForm.querySelectorAll(`input[name="question${index}"] + span`);

                options.forEach(opt => opt.disabled = true); // Disable options after submit

                if (selectedOption) {
                    const selectedIndex = parseInt(selectedOption.value, 10);
                    const correctIndex = q.correctIndex;
                    const selectedLabel = selectedOption.parentElement; // Get the label element

                    if (selectedIndex === correctIndex) {
                        currentScore++;
                        selectedLabel.classList.add('correct');
                    } else {
                        selectedLabel.classList.add('incorrect');
                        // Highlight the actual correct answer if missed
                        const correctLabel = options[correctIndex].parentElement;
                        correctLabel.classList.add('missed-correct');
                    }
                } else {
                    // Should not happen if required is set, but good practice
                    // Mark the correct answer anyway
                    const correctLabel = options[q.correctIndex].parentElement;
                    correctLabel.classList.add('missed-correct');
                }
            });

            // Display results
            const passed = currentScore >= PASSING_SCORE;
            resultsDiv.style.display = 'block';
            resultsDiv.className = passed ? 'pass' : 'fail'; // Add pass/fail class for styling

            resultsTitle.textContent = getTranslation(passed ? 'results_title_pass' : 'results_title_fail', lang);
            resultsScore.textContent = getTranslation('results_score_details', lang, { score: currentScore, total: totalQuestions });
            resultsMessage.textContent = getTranslation(passed ? 'results_message_pass' : 'results_message_fail', lang, { moduleId: MODULE_ID });

            // Update buttons
            submitButton.style.display = 'none';
            retryButton.style.display = 'inline-block';

            // Save progress if passed
            if (passed) {
                markModuleComplete(MODULE_ID);
                retryButton.style.display = 'none'; // No need to retry if passed
                 // Optional: Add a link back to dashboard or next module here?
                 const backLink = document.createElement('a');
                 backLink.href = "ctp-dashboard.html";
                 backLink.className = "quiz-button";
                 backLink.style.marginTop = "1rem";
                 backLink.textContent = getTranslation("return_button", lang);
                 if (!resultsDiv.querySelector('.quiz-button')) { // Prevent adding multiple links on re-translate
                    resultsDiv.appendChild(backLink);
                 }
            }
        }

        function resetQuiz() {
            submitted = false;
            currentScore = 0;
            resultsDiv.style.display = 'none';
            resultsDiv.className = '';
            submitButton.style.display = 'inline-block';
            retryButton.style.display = 'none';

            // Re-enable radios and remove feedback classes
            quizForm.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.disabled = false;
                radio.checked = false;
            });
            quizForm.querySelectorAll('label').forEach(label => {
                 label.classList.remove('correct', 'incorrect', 'selected', 'missed-correct');
                 // Remove FontAwesome icons if added by ::after
                 label.classList.remove('fa-check', 'fa-times'); // Adjust if using different icons
            });

            // Ensure questions are rendered for the current language
            const currentLang = getStoredLanguage();
            renderQuestions(currentLang);
        }

        // --- Event Listeners ---
        quizForm.addEventListener('submit', (event) => {
            event.preventDefault();
            if (!submitted) {
                const currentLang = getStoredLanguage();
                gradeQuiz(currentLang);
                // Scroll to results smoothly
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        retryButton.addEventListener('click', () => {
            resetQuiz();
             // Scroll back to the top smoothly
             quizForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        languageSelectElement.addEventListener('change', (e) => {
            setLanguage(e.target.value);
        });

        // --- Initial UI Update Function ---
        function updateUI() {
            const lang = getStoredLanguage();
            translatePage(lang); // Translate static text first
            renderQuestions(lang); // Render questions in the correct language

            // If results were already shown (e.g., language changed after submission), re-translate results
            if (submitted) {
                 const passed = currentScore >= PASSING_SCORE;
                 resultsTitle.textContent = getTranslation(passed ? 'results_title_pass' : 'results_title_fail', lang);
                 resultsScore.textContent = getTranslation('results_score_details', lang, { score: currentScore, total: quizData.length });
                 resultsMessage.textContent = getTranslation(passed ? 'results_message_pass' : 'results_message_fail', lang, { moduleId: MODULE_ID });
                  // Re-translate retry button if visible
                 if(retryButton.style.display !== 'none') {
                     retryButton.textContent = getTranslation('retry_button', lang);
                 }
                 // Re-translate the dynamically added back button if it exists
                 const dynamicBackBtn = resultsDiv.querySelector('.quiz-button');
                 if (dynamicBackBtn) {
                    dynamicBackBtn.textContent = getTranslation("return_button", lang);
                 }
            } else {
                 submitButton.textContent = getTranslation('submit_button', lang);
            }
        }


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
             const initialLang = getStoredLanguage();
             setLanguage(initialLang); // Set initial language and render UI
        });

    </script>

</body>
</html>
