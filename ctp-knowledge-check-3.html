<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title_kc3">Knowledge Check - Module 3 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14;
            --check-color: #6f42c1; /* Knowledge Check Color */
            --certificate-color: #d63384;
            --chat-panel-bg: #ffffff;
            --chat-box-bg: #f8f9fa;
            --chat-bot-bg: #e9ecef;
            --chat-bot-text: #343a40;
            --chat-user-bg: #d1e7ff;
            --chat-user-text: #0a58ca;
            --chat-error-bg: #f8d7da;
            --chat-error-text: #842029;
            --chat-border-color: #dee2e6;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --sidebar-width: 260px;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header specific for KC page --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .kc-header .return-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }
        .kc-header .return-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.6);
        }
        .kc-header .return-link i {
            margin-right: 8px;
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem; /* Slightly smaller than dashboard */
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            text-align: center;
            flex-grow: 1; /* Allows title to center if needed */
        }
        .kc-header .lang-switcher-area { /* Placeholder for potential lang switcher in header */
            min-width: 130px; /* Match button width roughly */
             display: flex;
             justify-content: flex-end;
        }
         /* Language Switcher Styles (Simplified for Header/Small Areas) */
         .language-switcher-simple { position: relative; }
         #languageSelectHeader {
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
             background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
            min-width: 110px; /* Ensure it has some width */
         }
         #languageSelectHeader:hover { background-color: var(--lang-select-bg-hover); }
         #languageSelectHeader:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         #languageSelectHeader option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }


        /* --- Main Content Area for KC page --- */
        .kc-main {
            max-width: 900px; /* Limit width for readability */
            margin: 2rem auto;
            padding: 0 1.5rem;
            flex-grow: 1; /* Takes up remaining vertical space */
            width: 100%;
        }
        .kc-instructions {
            background-color: var(--background-card);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            font-size: 0.95rem;
            color: var(--text-dark);
        }
        .kc-instructions h2 {
            font-family: var(--font-title);
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.4rem;
             display: flex;
             align-items: center;
        }
         .kc-instructions h2 i {
             margin-right: 10px;
             color: var(--check-color); /* Use KC color */
         }
        .kc-instructions p {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
         .kc-instructions strong {
             font-weight: 700;
             color: var(--primary-color);
         }
         .kc-instructions code {
             font-size: 0.9em; background: #eee; padding: 1px 4px; border-radius: 3px; color: var(--certificate-color);
         }


        /* --- Quiz Form Styling --- */
        #kc-form {
            background-color: var(--background-card);
            padding: 1.5rem 2rem; /* More padding inside form */
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        .kc-question {
            margin-bottom: 2.5rem; /* More space between questions */
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .kc-question:last-of-type {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .kc-question-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 1.2rem;
            color: var(--text-dark);
            line-height: 1.4;
        }
         .kc-question-text code {
             font-size: 0.95em; background: #eee; padding: 2px 5px; border-radius: 3px; color: var(--certificate-color); font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
         }

        .kc-options label {
            display: block;
            margin-bottom: 0.8rem;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            background-color: #fdfdfd;
            position: relative; /* For potential feedback icons */
        }
        .kc-options label:hover {
            background-color: #f5f9ff;
            border-color: var(--primary-color);
        }
        .kc-options input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
            accent-color: var(--primary-color); /* Modern browser radio color */
        }
         .kc-options code {
            font-size: 0.9em; background: #eee; padding: 1px 4px; border-radius: 3px; color: var(--certificate-color);
        }

        /* Styles when form is submitted */
         #kc-form.submitted .kc-options label {
             cursor: default;
             background-color: #f8f9fa; /* Slightly greyed out */
             opacity: 0.8;
         }
         #kc-form.submitted .kc-options label:hover {
             background-color: #f8f9fa; /* No hover effect */
             border-color: var(--border-color); /* No hover border */
         }
         #kc-form.submitted .kc-options input[type="radio"]:checked + span {
             font-weight: 500; /* Make selected answer slightly bolder */
         }


        /* --- Buttons and Result Styling --- */
        .kc-controls {
            display: flex;
            justify-content: center; /* Center buttons */
            align-items: center;
            gap: 1rem;
            margin-top: 2.5rem;
        }

        #submit-kc, #retry-kc {
            background-color: var(--check-color); /* Use KC color */
            color: var(--text-light);
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
             font-family: var(--font-body);
        }
        #submit-kc:hover, #retry-kc:hover {
            background-color: #5a34a0; /* Darker shade of check-color */
            transform: translateY(-2px);
        }
         #retry-kc {
             background-color: var(--secondary-color);
         }
         #retry-kc:hover {
              background-color: #5a6268;
         }

        .kc-result-display {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            display: none; /* Hidden initially */
        }
        .kc-result-display.pass {
            background-color: #d1e7dd; /* Light green */
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        .kc-result-display.fail {
            background-color: #f8d7da; /* Light red */
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        .kc-result-display p { margin: 0.5rem 0; }
        .kc-result-display .score { font-size: 1.3rem; font-weight: 700; }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 3rem; /* Ensure space above footer */
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

         /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
             .kc-header { padding: 0.8rem 1rem; flex-wrap: wrap; }
             .kc-header h1 { font-size: 1.3rem; order: 1; width: 100%; text-align: center; margin-top: 0.5rem; }
             .kc-header .return-link { font-size: 0.9rem; padding: 0.3rem 0.6rem; order: 0;}
             .kc-header .lang-switcher-area { order: 2; }
            .kc-main { margin: 1.5rem auto; padding: 0 1rem; }
            .kc-instructions, #kc-form { padding: 1rem 1.2rem; }
             .kc-question-text { font-size: 1rem; }
             .kc-options label { padding: 0.7rem 0.9rem; }
             .kc-controls { flex-direction: column; gap: 0.8rem;}
             #submit-kc, #retry-kc { width: 100%; padding: 0.7rem 1rem; }
        }
         @media (max-width: 576px) {
             html { font-size: 14px; }
             .kc-header h1 { font-size: 1.2rem; }
             .kc-instructions { font-size: 0.9rem; }
             #kc-form { padding: 1rem; }
             .kc-question { margin-bottom: 1.8rem; padding-bottom: 1rem; }
             .kc-options label { font-size: 0.9rem; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="kc_return_dashboard">Return to Dashboard</span>
        </a>
        <h1 data-translate="kc3_page_header">Module 3 Check: Working with Text</h1>
         <div class="lang-switcher-area">
             <!-- Simple Language Switcher -->
             <div class="language-switcher-simple">
                <select id="languageSelectHeader" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                    <option value="en" data-translate="lang_en">🇬🇧 English</option>
                    <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                    <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                </select>
            </div>
         </div>
    </header>

    <main class="kc-main">

        <section class="kc-instructions">
            <h2 data-translate="kc_instructions_title"><i class="fas fa-check-double"></i> Knowledge Check Instructions</h2>
            <p data-translate="kc_instructions_p1">Test your understanding of the concepts covered in this module.</p>
            <p data-translate="kc_instructions_p2">You need to answer at least <strong data-translate="kc_pass_score_num">6</strong> out of <strong data-translate="kc_total_questions_num">10</strong> questions correctly to pass.</p>
            <p data-translate="kc_instructions_p3">You can attempt this check as many times as you need. Passing will mark this module as complete on your dashboard.</p>
            <p data-translate="kc_instructions_p4"><i class="fas fa-info-circle"></i> Select the best answer for each question and click '<span data-translate="kc_submit_button">Submit Answers</span>' at the bottom.</p>
        </section>

        <form id="kc-form">
            <!-- Questions will be dynamically inserted here by JavaScript -->
            <div id="kc-questions-container"></div>

            <div class="kc-controls">
                <button type="submit" id="submit-kc" data-translate="kc_submit_button">Submit Answers</button>
                <button type="button" id="retry-kc" style="display: none;" data-translate="kc_retry_button">Try Again</button>
            </div>
        </form>

        <div id="kc-result" class="kc-result-display">
            <!-- Result message will be inserted here -->
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 3; // Crucial: Set the correct module ID here
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const PASS_SCORE = 6;
        const TOTAL_QUESTIONS = 10;

        // --- Translations Object (Include keys from dashboard + new KC keys) ---
        const translations = {
             en: {
                 "page_title_kc3": "Knowledge Check - Module 3 - Complete Python",
                 "kc_return_dashboard": "Return to Dashboard",
                 "kc3_page_header": "Module 3 Check: Working with Text",
                 "kc_instructions_title": "Knowledge Check Instructions",
                 "kc_instructions_p1": "Test your understanding of the concepts covered in this module.",
                 "kc_instructions_p2": "You need to answer at least <strong>6</strong> out of <strong>10</strong> questions correctly to pass.",
                 "kc_instructions_p3": "You can attempt this check as many times as you need. Passing will mark this module as complete on your dashboard.",
                 "kc_instructions_p4": "<i class=\"fas fa-info-circle\"></i> Select the best answer for each question and click 'Submit Answers' at the bottom.",
                 "kc_submit_button": "Submit Answers",
                 "kc_retry_button": "Try Again",
                 "kc_result_pass_title": "Congratulations! You Passed!",
                 "kc_result_fail_title": "Keep Trying!",
                 "kc_result_score_prefix": "Your score:",
                 "kc_result_pass_text": "You have successfully completed the knowledge check for Module {moduleId}. Your progress has been updated.",
                 "kc_result_fail_text": "You didn't pass this time. Review the module content and try again!",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 "kc_pass_score_num": "6",
                 "kc_total_questions_num": "10",
                 // --- Module 3 Questions & Options (EN) ---
                 "kc3_q1": "Which operator is used to join two strings together in Python?",
                 "kc3_q1_op1": "<code>&</code> (Ampersand)",
                 "kc3_q1_op2": "<code>+</code> (Plus)",
                 "kc3_q1_op3": "<code>*</code> (Asterisk)",
                 "kc3_q1_op4": "<code>.join()</code> (Method - though exists, not the basic operator)",
                 "kc3_q2": "What is the result of the expression <code>'Py' + 'thon'</code>?",
                 "kc3_q2_op1": "<code>'Py thon'</code> (with a space)",
                 "kc3_q2_op2": "<code>'Python'</code>",
                 "kc3_q2_op3": "An error",
                 "kc3_q2_op4": "<code>'Py + thon'</code>",
                 "kc3_q3": "What does the <code>len()</code> function return when used with a string like <code>'hello'</code>?",
                 "kc3_q3_op1": "The string itself (<code>'hello'</code>)",
                 "kc3_q3_op2": "The number of characters (<code>5</code>)",
                 "kc3_q3_op3": "The last character (<code>'o'</code>)",
                 "kc3_q3_op4": "<code>True</code> or <code>False</code> depending on the string",
                 "kc3_q4": "What is the output of <code>print('Ha' * 3)</code>?",
                 "kc3_q4_op1": "<code>'Ha Ha Ha'</code> (with spaces)",
                 "kc3_q4_op2": "<code>'Ha3'</code>",
                 "kc3_q4_op3": "An error",
                 "kc3_q4_op4": "<code>'HaHaHa'</code>",
                 "kc3_q5": "In Python, string indexing starts at which number?",
                 "kc3_q5_op1": "<code>1</code>",
                 "kc3_q5_op2": "<code>0</code>",
                 "kc3_q5_op3": "<code>-1</code>",
                 "kc3_q5_op4": "It depends on the string length",
                 "kc3_q6": "Given <code>word = 'Python'</code>, what does <code>word[0]</code> evaluate to?",
                 "kc3_q6_op1": "<code>'P'</code>",
                 "kc3_q6_op2": "<code>'y'</code>",
                 "kc3_q6_op3": "<code>'Python'</code>",
                 "kc3_q6_op4": "An error",
                 "kc3_q7": "Given <code>word = 'Python'</code>, what does <code>word[5]</code> evaluate to?",
                 "kc3_q7_op1": "<code>'o'</code>",
                 "kc3_q7_op2": "<code>'n'</code>",
                 "kc3_q7_op3": "An error (IndexError)",
                 "kc3_q7_op4": "<code>'t'</code>",
                 "kc3_q8": "What is the index of the *last* character in the string <code>'code'</code>?",
                 "kc3_q8_op1": "<code>4</code>",
                 "kc3_q8_op2": "<code>3</code>",
                 "kc3_q8_op3": "<code>-1</code> (can be used to access it, but index is 3)",
                 "kc3_q8_op4": "<code>'e'</code>",
                 "kc3_q9": "Consider <code>text = 'Hello World'</code>. What is <code>len(text)</code>?",
                 "kc3_q9_op1": "<code>10</code>",
                 "kc3_q9_op2": "<code>11</code> (including the space)",
                 "kc3_q9_op3": "<code>2</code> (number of words)",
                 "kc3_q9_op4": "<code>'Hello World'</code>",
                 "kc3_q10": "What happens if you try to access an index that is outside the bounds of a string, like <code>'abc'[5]</code>?",
                 "kc3_q10_op1": "It returns an empty string <code>''</code>.",
                 "kc3_q10_op2": "It returns <code>None</code>.",
                 "kc3_q10_op3": "It causes an <code>IndexError</code>.",
                 "kc3_q10_op4": "It wraps around (accesses <code>'c'</code>)."
             },
             pt: {
                 "page_title_kc3": "Verificação de Conhecimento - Módulo 3 - Python Completo",
                 "kc_return_dashboard": "Voltar ao Painel",
                 "kc3_page_header": "Verificação Módulo 3: Trabalhando com Texto",
                 "kc_instructions_title": "Instruções da Verificação de Conhecimento",
                 "kc_instructions_p1": "Teste seu entendimento dos conceitos abordados neste módulo.",
                 "kc_instructions_p2": "Você precisa responder corretamente a pelo menos <strong>6</strong> de <strong>10</strong> perguntas para passar.",
                 "kc_instructions_p3": "Você pode tentar esta verificação quantas vezes precisar. Passar marcará este módulo como concluído em seu painel.",
                 "kc_instructions_p4": "<i class=\"fas fa-info-circle\"></i> Selecione a melhor resposta para cada pergunta e clique em 'Enviar Respostas' no final.",
                 "kc_submit_button": "Enviar Respostas",
                 "kc_retry_button": "Tentar Novamente",
                 "kc_result_pass_title": "Parabéns! Você Passou!",
                 "kc_result_fail_title": "Continue Tentando!",
                 "kc_result_score_prefix": "Sua pontuação:",
                 "kc_result_pass_text": "Você concluiu com sucesso a verificação de conhecimento do Módulo {moduleId}. Seu progresso foi atualizado.",
                 "kc_result_fail_text": "Você não passou desta vez. Revise o conteúdo do módulo e tente novamente!",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 "kc_pass_score_num": "6",
                 "kc_total_questions_num": "10",
                 // --- Module 3 Questions & Options (PT) ---
                 "kc3_q1": "Qual operador é usado para juntar duas strings em Python?",
                 "kc3_q1_op1": "<code>&</code> (E comercial)",
                 "kc3_q1_op2": "<code>+</code> (Mais)",
                 "kc3_q1_op3": "<code>*</code> (Asterisco)",
                 "kc3_q1_op4": "<code>.join()</code> (Método - embora exista, não é o operador básico)",
                 "kc3_q2": "Qual é o resultado da expressão <code>'Py' + 'thon'</code>?",
                 "kc3_q2_op1": "<code>'Py thon'</code> (com espaço)",
                 "kc3_q2_op2": "<code>'Python'</code>",
                 "kc3_q2_op3": "Um erro",
                 "kc3_q2_op4": "<code>'Py + thon'</code>",
                 "kc3_q3": "O que a função <code>len()</code> retorna quando usada com uma string como <code>'hello'</code>?",
                 "kc3_q3_op1": "A própria string (<code>'hello'</code>)",
                 "kc3_q3_op2": "O número de caracteres (<code>5</code>)",
                 "kc3_q3_op3": "O último caractere (<code>'o'</code>)",
                 "kc3_q3_op4": "<code>True</code> ou <code>False</code> dependendo da string",
                 "kc3_q4": "Qual é a saída de <code>print('Ha' * 3)</code>?",
                 "kc3_q4_op1": "<code>'Ha Ha Ha'</code> (com espaços)",
                 "kc3_q4_op2": "<code>'Ha3'</code>",
                 "kc3_q4_op3": "Um erro",
                 "kc3_q4_op4": "<code>'HaHaHa'</code>",
                 "kc3_q5": "Em Python, a indexação de strings começa em qual número?",
                 "kc3_q5_op1": "<code>1</code>",
                 "kc3_q5_op2": "<code>0</code>",
                 "kc3_q5_op3": "<code>-1</code>",
                 "kc3_q5_op4": "Depende do tamanho da string",
                 "kc3_q6": "Dado <code>word = 'Python'</code>, qual o valor de <code>word[0]</code>?",
                 "kc3_q6_op1": "<code>'P'</code>",
                 "kc3_q6_op2": "<code>'y'</code>",
                 "kc3_q6_op3": "<code>'Python'</code>",
                 "kc3_q6_op4": "Um erro",
                 "kc3_q7": "Dado <code>word = 'Python'</code>, qual o valor de <code>word[5]</code>?",
                 "kc3_q7_op1": "<code>'o'</code>",
                 "kc3_q7_op2": "<code>'n'</code>",
                 "kc3_q7_op3": "Um erro (IndexError)",
                 "kc3_q7_op4": "<code>'t'</code>",
                 "kc3_q8": "Qual é o índice do *último* caractere na string <code>'code'</code>?",
                 "kc3_q8_op1": "<code>4</code>",
                 "kc3_q8_op2": "<code>3</code>",
                 "kc3_q8_op3": "<code>-1</code> (pode ser usado para acessá-lo, mas o índice é 3)",
                 "kc3_q8_op4": "<code>'e'</code>",
                 "kc3_q9": "Considere <code>text = 'Hello World'</code>. Qual é o valor de <code>len(text)</code>?",
                 "kc3_q9_op1": "<code>10</code>",
                 "kc3_q9_op2": "<code>11</code> (incluindo o espaço)",
                 "kc3_q9_op3": "<code>2</code> (número de palavras)",
                 "kc3_q9_op4": "<code>'Hello World'</code>",
                 "kc3_q10": "O que acontece se você tentar acessar um índice fora dos limites de uma string, como <code>'abc'[5]</code>?",
                 "kc3_q10_op1": "Retorna uma string vazia <code>''</code>.",
                 "kc3_q10_op2": "Retorna <code>None</code>.",
                 "kc3_q10_op3": "Causa um <code>IndexError</code>.",
                 "kc3_q10_op4": "Dá a volta (acessa <code>'c'</code>)."
             },
             zh: {
                 "page_title_kc3": "知识测验 - 模块 3 - Python 完全指南",
                 "kc_return_dashboard": "返回仪表板",
                 "kc3_page_header": "模块 3 测验：处理文本",
                 "kc_instructions_title": "知识测验说明",
                 "kc_instructions_p1": "测试您对本模块所涵盖概念的理解。",
                 "kc_instructions_p2": "您需要正确回答 <strong>10</strong> 个问题中的至少 <strong>6</strong> 个才能通过。",
                 "kc_instructions_p3": "您可以根据需要尝试多次此测验。通过后，此模块将在您的仪表板上标记为已完成。",
                 "kc_instructions_p4": "<i class=\"fas fa-info-circle\"></i> 为每个问题选择最佳答案，然后单击底部的“提交答案”。",
                 "kc_submit_button": "提交答案",
                 "kc_retry_button": "再试一次",
                 "kc_result_pass_title": "恭喜！ 您已通过！",
                 "kc_result_fail_title": "继续努力！",
                 "kc_result_score_prefix": "你的分数：",
                 "kc_result_pass_text": "您已成功完成模块 {moduleId} 的知识测验。您的进度已更新。",
                 "kc_result_fail_text": "您这次未能通过。请复习模块内容，然后再试一次！",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 "kc_pass_score_num": "6",
                 "kc_total_questions_num": "10",
                  // --- Module 3 Questions & Options (ZH) ---
                 "kc3_q1": "在 Python 中，哪个运算符用于连接两个字符串？",
                 "kc3_q1_op1": "<code>&</code> (和号)",
                 "kc3_q1_op2": "<code>+</code> (加号)",
                 "kc3_q1_op3": "<code>*</code> (星号)",
                 "kc3_q1_op4": "<code>.join()</code> (方法 - 虽然存在，但不是基本运算符)",
                 "kc3_q2": "表达式 <code>'Py' + 'thon'</code> 的结果是什么？",
                 "kc3_q2_op1": "<code>'Py thon'</code> (带有空格)",
                 "kc3_q2_op2": "<code>'Python'</code>",
                 "kc3_q2_op3": "一个错误",
                 "kc3_q2_op4": "<code>'Py + thon'</code>",
                 "kc3_q3": "当与像 <code>'hello'</code> 这样的字符串一起使用时，<code>len()</code> 函数返回什么？",
                 "kc3_q3_op1": "字符串本身 (<code>'hello'</code>)",
                 "kc3_q3_op2": "字符数 (<code>5</code>)",
                 "kc3_q3_op3": "最后一个字符 (<code>'o'</code>)",
                 "kc3_q3_op4": "根据字符串返回 <code>True</code> 或 <code>False</code>",
                 "kc3_q4": "<code>print('Ha' * 3)</code> 的输出是什么？",
                 "kc3_q4_op1": "<code>'Ha Ha Ha'</code> (带有空格)",
                 "kc3_q4_op2": "<code>'Ha3'</code>",
                 "kc3_q4_op3": "一个错误",
                 "kc3_q4_op4": "<code>'HaHaHa'</code>",
                 "kc3_q5": "在 Python 中，字符串索引从哪个数字开始？",
                 "kc3_q5_op1": "<code>1</code>",
                 "kc3_q5_op2": "<code>0</code>",
                 "kc3_q5_op3": "<code>-1</code>",
                 "kc3_q5_op4": "取决于字符串长度",
                 "kc3_q6": "给定 <code>word = 'Python'</code>，<code>word[0]</code> 的值是什么？",
                 "kc3_q6_op1": "<code>'P'</code>",
                 "kc3_q6_op2": "<code>'y'</code>",
                 "kc3_q6_op3": "<code>'Python'</code>",
                 "kc3_q6_op4": "一个错误",
                 "kc3_q7": "给定 <code>word = 'Python'</code>，<code>word[5]</code> 的值是什么？",
                 "kc3_q7_op1": "<code>'o'</code>",
                 "kc3_q7_op2": "<code>'n'</code>",
                 "kc3_q7_op3": "一个错误 (IndexError)",
                 "kc3_q7_op4": "<code>'t'</code>",
                 "kc3_q8": "字符串 <code>'code'</code> 中 *最后* 一个字符的索引是什么？",
                 "kc3_q8_op1": "<code>4</code>",
                 "kc3_q8_op2": "<code>3</code>",
                 "kc3_q8_op3": "<code>-1</code> (可用于访问它，但索引是 3)",
                 "kc3_q8_op4": "<code>'e'</code>",
                 "kc3_q9": "考虑 <code>text = 'Hello World'</code>。<code>len(text)</code> 是多少？",
                 "kc3_q9_op1": "<code>10</code>",
                 "kc3_q9_op2": "<code>11</code> (包括空格)",
                 "kc3_q9_op3": "<code>2</code> (单词数)",
                 "kc3_q9_op4": "<code>'Hello World'</code>",
                 "kc3_q10": "如果您尝试访问字符串边界之外的索引，例如 <code>'abc'[5]</code>，会发生什么？",
                 "kc3_q10_op1": "它返回一个空字符串 <code>''</code>。",
                 "kc3_q10_op2": "它返回 <code>None</code>。",
                 "kc3_q10_op3": "它导致一个 <code>IndexError</code>。",
                 "kc3_q10_op4": "它会环绕（访问 <code>'c'</code>）。"
             }
         };

         // --- Question Data Structure ---
         const questionsData = [
             { key: "kc3_q1", name: "q1", options: [ {key: "kc3_q1_op1", correct: false}, {key: "kc3_q1_op2", correct: true}, {key: "kc3_q1_op3", correct: false}, {key: "kc3_q1_op4", correct: false} ] },
             { key: "kc3_q2", name: "q2", options: [ {key: "kc3_q2_op1", correct: false}, {key: "kc3_q2_op2", correct: true}, {key: "kc3_q2_op3", correct: false}, {key: "kc3_q2_op4", correct: false} ] },
             { key: "kc3_q3", name: "q3", options: [ {key: "kc3_q3_op1", correct: false}, {key: "kc3_q3_op2", correct: true}, {key: "kc3_q3_op3", correct: false}, {key: "kc3_q3_op4", correct: false} ] },
             { key: "kc3_q4", name: "q4", options: [ {key: "kc3_q4_op1", correct: false}, {key: "kc3_q4_op2", correct: false}, {key: "kc3_q4_op3", correct: false}, {key: "kc3_q4_op4", correct: true} ] },
             { key: "kc3_q5", name: "q5", options: [ {key: "kc3_q5_op1", correct: false}, {key: "kc3_q5_op2", correct: true}, {key: "kc3_q5_op3", correct: false}, {key: "kc3_q5_op4", correct: false} ] },
             { key: "kc3_q6", name: "q6", options: [ {key: "kc3_q6_op1", correct: true}, {key: "kc3_q6_op2", correct: false}, {key: "kc3_q6_op3", correct: false}, {key: "kc3_q6_op4", correct: false} ] },
             { key: "kc3_q7", name: "q7", options: [ {key: "kc3_q7_op1", correct: false}, {key: "kc3_q7_op2", correct: true}, {key: "kc3_q7_op3", correct: false}, {key: "kc3_q7_op4", correct: false} ] },
             { key: "kc3_q8", name: "q8", options: [ {key: "kc3_q8_op1", correct: false}, {key: "kc3_q8_op2", correct: true}, {key: "kc3_q8_op3", correct: false}, {key: "kc3_q8_op4", correct: false} ] },
             { key: "kc3_q9", name: "q9", options: [ {key: "kc3_q9_op1", correct: false}, {key: "kc3_q9_op2", correct: true}, {key: "kc3_q9_op3", correct: false}, {key: "kc3_q9_op4", correct: false} ] },
             { key: "kc3_q10", name: "q10", options: [ {key: "kc3_q10_op1", correct: false}, {key: "kc3_q10_op2", correct: false}, {key: "kc3_q10_op3", correct: true}, {key: "kc3_q10_op4", correct: false} ] },
         ];

        // --- Core Logic (Translation, LocalStorage, Quiz Handling) ---
        document.addEventListener('DOMContentLoaded', () => {

            const LANGUAGE_STORAGE_KEY = 'userLanguage'; // Key for storing language
            const kcForm = document.getElementById('kc-form');
            const submitButton = document.getElementById('submit-kc');
            const retryButton = document.getElementById('retry-kc');
            const resultDisplay = document.getElementById('kc-result');
            const questionsContainer = document.getElementById('kc-questions-container');
            const languageSelectHeader = document.getElementById('languageSelectHeader');

            // --- Data Loading & Saving (LocalStorage) ---
            function loadKnowledgeCheckStatus() {
                 try {
                    const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                    const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                    // Ensure it's an object, handle potential null or non-object values
                    return typeof parsed === 'object' && parsed !== null ? parsed : {};
                 } catch (e) {
                     console.error("Error reading KC status from localStorage:", e);
                     return {}; // Return empty object on error
                 }
            }

            function saveKnowledgeCheckStatus(moduleId, passed) {
                 if (passed) {
                     try {
                         const currentStatus = loadKnowledgeCheckStatus();
                         currentStatus[moduleId] = true; // Mark as passed
                         localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                         console.log(`Module ${moduleId} status saved as passed.`);
                     } catch (e) {
                         console.error("Error saving KC status to localStorage:", e);
                     }
                 }
            }

            // --- Translation Functions ---
            function getStoredLanguage() {
                const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
                if (storedLang && translations[storedLang]) return storedLang;
                // Basic browser language detection (fallback)
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('pt')) return 'pt';
                if (browserLang.startsWith('zh')) return 'zh';
                return 'en'; // Default to English
            }

             function getTranslation(key, lang, replacements = {}) {
                 // Fallback chain: Current Lang -> English -> Key Name
                 let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
                  // Replace placeholders like {moduleId}
                 for (const placeholder in replacements) {
                     const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                     text = text.replace(regex, replacements[placeholder]);
                 }
                 return text;
             }

             function translatePage(lang) {
                 if (!translations[lang]) lang = 'en'; // Fallback safety
                 document.documentElement.lang = lang;

                 // Update static text elements
                 document.querySelectorAll('[data-translate]').forEach(el => {
                     const key = el.getAttribute('data-translate');
                     const translation = getTranslation(key, lang, { moduleId: MODULE_ID }); // Pass moduleId for replacements
                     // Handle elements where HTML is intended (like instructions with <strong>)
                     if (translation.includes('<') && translation.includes('>')) {
                         el.innerHTML = translation;
                     } else {
                         el.textContent = translation;
                     }
                 });

                 // Update aria-labels
                 document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                     const key = el.getAttribute('data-translate-aria-label');
                     el.setAttribute('aria-label', getTranslation(key, lang));
                 });

                 // Update dynamically generated quiz content
                 renderQuiz(lang);

                  // Set language selector value
                 if(languageSelectHeader) languageSelectHeader.value = lang;
             }

            function setLanguage(lang) {
                 if (!translations[lang]) lang = 'en'; // Fallback
                 localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
                 translatePage(lang); // Re-translate and re-render quiz
            }


            // --- Quiz Rendering ---
            function renderQuiz(lang) {
                 questionsContainer.innerHTML = ''; // Clear existing questions
                 questionsData.forEach((qData, index) => {
                     const questionDiv = document.createElement('div');
                     questionDiv.className = 'kc-question';

                     const questionText = document.createElement('p');
                     questionText.className = 'kc-question-text';
                     // Use innerHTML because question keys might contain <code> tags
                     questionText.innerHTML = `<strong>${index + 1}.</strong> ${getTranslation(qData.key, lang)}`;
                     questionDiv.appendChild(questionText);

                     const optionsDiv = document.createElement('div');
                     optionsDiv.className = 'kc-options';

                     // Shuffle options for variety? Maybe later, keep simple for now.
                     qData.options.forEach((opt, optIndex) => {
                         const label = document.createElement('label');
                         const radio = document.createElement('input');
                         radio.type = 'radio';
                         radio.name = qData.name;
                         radio.value = optIndex; // Store option index as value
                         radio.id = `${qData.name}_opt${optIndex}`;
                         radio.required = true; // Make sure user selects one

                         const span = document.createElement('span');
                         // Use innerHTML because option keys might contain <code> tags
                         span.innerHTML = getTranslation(opt.key, lang);

                         label.appendChild(radio);
                         label.appendChild(span);
                         optionsDiv.appendChild(label);
                     });

                     questionDiv.appendChild(optionsDiv);
                     questionsContainer.appendChild(questionDiv);
                 });
            }

            // --- Quiz Submission and Handling ---
             function handleSubmit(event) {
                 event.preventDefault();
                 let score = 0;
                 const formData = new FormData(kcForm);

                 questionsData.forEach((qData, index) => {
                     const selectedOptionIndex = formData.get(qData.name); // Gets the value (option index)
                     if (selectedOptionIndex !== null) {
                         // Check if the selected option's 'correct' flag is true
                         if (qData.options[parseInt(selectedOptionIndex)].correct) {
                             score++;
                         }
                     }
                 });

                 displayResult(score);
                 disableForm();
                 submitButton.style.display = 'none';
                 retryButton.style.display = 'inline-block';

                 // Save progress if passed
                 if (score >= PASS_SCORE) {
                     saveKnowledgeCheckStatus(MODULE_ID, true);
                 }
             }

             function displayResult(score) {
                 const lang = getStoredLanguage();
                 const passed = score >= PASS_SCORE;
                 resultDisplay.innerHTML = ''; // Clear previous result

                 const title = document.createElement('h3');
                 title.textContent = passed ? getTranslation('kc_result_pass_title', lang) : getTranslation('kc_result_fail_title', lang);

                 const scoreText = document.createElement('p');
                 scoreText.innerHTML = `${getTranslation('kc_result_score_prefix', lang)} <span class="score">${score} / ${TOTAL_QUESTIONS}</span>`;

                 const message = document.createElement('p');
                 message.innerHTML = passed
                     ? getTranslation('kc_result_pass_text', lang, { moduleId: MODULE_ID })
                     : getTranslation('kc_result_fail_text', lang);

                 resultDisplay.appendChild(title);
                 resultDisplay.appendChild(scoreText);
                 resultDisplay.appendChild(message);

                 resultDisplay.className = `kc-result-display ${passed ? 'pass' : 'fail'}`;
                 resultDisplay.style.display = 'block';
                 resultDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Scroll to show result
             }

            function disableForm() {
                 kcForm.classList.add('submitted'); // Add class to style disabled state
                 const inputs = kcForm.querySelectorAll('input[type="radio"]');
                 inputs.forEach(input => input.disabled = true);
             }

             function enableForm() {
                 kcForm.classList.remove('submitted');
                 const inputs = kcForm.querySelectorAll('input[type="radio"]');
                 inputs.forEach(input => input.disabled = false);
             }

            function handleRetry() {
                 kcForm.reset(); // Clear selections
                 resultDisplay.style.display = 'none'; // Hide results
                 retryButton.style.display = 'none'; // Hide retry button
                 submitButton.style.display = 'inline-block'; // Show submit button
                 enableForm();
                 // Scroll back to the top of the form/instructions
                 document.querySelector('.kc-instructions')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
             }


            // --- Initialization ---
            function initializeKCPage() {
                const initialLang = getStoredLanguage();
                translatePage(initialLang); // Initial translate and render

                // Setup Language Switcher Listener
                if(languageSelectHeader){
                    languageSelectHeader.value = initialLang; // Set initial value
                    languageSelectHeader.addEventListener('change', (e) => {
                        setLanguage(e.target.value);
                    });
                }

                // Add Form Listeners
                kcForm.addEventListener('submit', handleSubmit);
                retryButton.addEventListener('click', handleRetry);
            }

            initializeKCPage(); // Run initialization

        }); // End DOMContentLoaded
    </script>

</body>
</html>
