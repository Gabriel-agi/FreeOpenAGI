<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title_kc_3">Knowledge Check: Module 3 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from ctp-dashboard.html) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Less relevant here, but keep for consistency */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14; /* Less relevant */
            --check-color: #6f42c1; /* Used for KC icon/theme */
            --certificate-color: #d63384; /* Less relevant */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            /* Quiz Specific */
            --option-bg-default: #ffffff;
            --option-bg-hover: #e9ecef;
            --option-bg-correct: #d1e7dd;
            --option-bg-incorrect: #f8d7da;
            --option-border-default: var(--border-color);
            --option-border-correct: var(--success-color);
            --option-border-incorrect: var(--error-color);
            --option-text-default: var(--text-dark);
            --option-text-correct: var(--success-color);
            --option-text-incorrect: var(--error-color);
             /* Colors for lang switcher (copied in case needed later) */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header Area --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .return-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.1);
            transition: background-color var(--transition-speed);
            display: inline-flex;
            align-items: center;
        }
        .return-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .return-link i {
            margin-right: 8px;
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem;
            margin: 0;
            text-align: center;
            flex-grow: 1; /* Allow title to take space */
            padding: 0 1rem; /* Add padding around title */
        }
        /* Language Switcher (Optional for KC page, but added) */
        .language-switcher-kc {
             position: relative; /* Needed if we add dropdown */
             margin-left: 1rem; /* Space from title or return button */
        }
         #languageSelect {
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease;
         }
         #languageSelect:hover { background-color: var(--lang-select-bg-hover); }
         #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Content Area --- */
        .kc-main-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Take remaining vertical space */
        }

        /* --- Quiz Area Styling --- */
        .quiz-area { /* Initially visible */ }
        .results-area { display: none; } /* Initially hidden */

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--border-color);
        }
        .quiz-header h2 {
            font-family: var(--font-title);
            font-size: 1.4rem;
            color: var(--check-color);
            margin: 0;
        }
        .quiz-progress {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-muted);
        }

        .question-container { margin-bottom: 2rem; }
        .question-text {
            font-size: 1.15rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        .question-text code {
            background-color: #e9ecef;
            padding: 0.2em 0.5em;
            border-radius: 4px;
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.95em;
            color: var(--primary-color);
            border: 1px solid #ced4da;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr; /* Single column for options */
            gap: 0.8rem;
        }

        .option-button {
            display: block;
            width: 100%;
            padding: 0.8rem 1.2rem;
            font-size: 1rem;
            text-align: left;
            background-color: var(--option-bg-default);
            border: 2px solid var(--option-border-default);
            color: var(--option-text-default);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            line-height: 1.4;
        }
        .option-button:hover:not(:disabled) {
            background-color: var(--option-bg-hover);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-button.correct {
            background-color: var(--option-bg-correct);
            border-color: var(--option-border-correct);
            color: var(--option-text-correct);
            font-weight: 500;
        }
        .option-button.incorrect {
            background-color: var(--option-bg-incorrect);
            border-color: var(--option-border-incorrect);
            color: var(--option-text-incorrect);
            font-weight: 500;
        }
        .option-button.selected:not(.correct):not(.incorrect) {
             /* Optional: Style for the selected answer before feedback */
            border-color: var(--check-color);
            background-color: #f0eaff;
        }
        .option-button code { /* Style code within options */
            background-color: rgba(0,0,0,0.05);
            padding: 0.1em 0.3em;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .option-button.correct code,
        .option-button.incorrect code {
            background-color: rgba(0,0,0,0.08);
        }


        .feedback-area {
            margin-top: 1.5rem;
            padding: 0.8rem 1.2rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-align: center;
            visibility: hidden; /* Use visibility to maintain layout space */
            opacity: 0;
            transition: opacity var(--transition-speed), visibility 0s var(--transition-speed);
        }
        .feedback-area.visible {
            visibility: visible;
            opacity: 1;
            transition-delay: 0s;
        }
        .feedback-area.correct {
            background-color: var(--option-bg-correct);
            color: var(--option-text-correct);
            border: 1px solid var(--option-border-correct);
        }
        .feedback-area.incorrect {
            background-color: var(--option-bg-incorrect);
            color: var(--option-text-incorrect);
            border: 1px solid var(--option-border-incorrect);
        }

        .quiz-navigation {
            margin-top: 2rem;
            text-align: right;
        }
        .next-button {
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed);
            visibility: hidden; /* Hidden until answer is selected */
        }
        .next-button:hover {
            background-color: #5a349c; /* Darker purple */
        }
        .next-button.visible {
            visibility: visible;
        }

        /* --- Results Area Styling --- */
        .results-area {
            text-align: center;
            padding: 2rem 1rem;
        }
        .results-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
        }
        .results-icon.pass { color: var(--success-color); }
        .results-icon.fail { color: var(--error-color); }

        .results-title {
            font-family: var(--font-title);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        .results-title.pass { color: var(--success-color); }
        .results-title.fail { color: var(--error-color); }

        .results-score {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        .results-message {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .results-button {
            text-decoration: none;
            color: var(--text-light);
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            border: none;
            display: inline-flex;
            align-items: center;
        }
         .results-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
         }
        .retry-button {
            background-color: var(--secondary-color);
        }
        .retry-button:hover {
            background-color: #5a6268;
        }
        .dashboard-button {
            background-color: var(--primary-color);
        }
        .dashboard-button:hover {
            background-color: #0b5ed7;
        }
         .results-button i {
             margin-right: 8px;
         }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* --- Responsive Design Tweaks --- */
         @media (max-width: 768px) {
            .kc-header { flex-direction: column; align-items: flex-start; padding: 0.8rem 1rem; }
            .kc-header h1 { font-size: 1.4rem; order: 2; margin-top: 0.5rem; text-align: left; padding: 0;}
            .return-link { order: 1; margin-bottom: 0.5rem; }
            .language-switcher-kc { order: 3; margin-left: 0; margin-top: 0.5rem; }
            .kc-main-container { margin: 1rem; padding: 1rem 1.2rem; }
            .quiz-header h2 { font-size: 1.2rem;}
            .question-text { font-size: 1.05rem; }
            .option-button { font-size: 0.95rem; padding: 0.7rem 1rem; }
            .results-title { font-size: 1.5rem; }
            .results-score { font-size: 1.1rem; }
            .results-actions { flex-direction: column; align-items: center; }
            .results-button { width: 80%; text-align: center; justify-content: center;}
         }
         @media (max-width: 480px) {
             html { font-size: 15px; }
             .kc-header h1 { font-size: 1.2rem; }
             .return-link { font-size: 0.9rem; padding: 0.4rem 0.8rem; }
             #languageSelect { padding: 5px 25px 5px 10px; font-size: 0.85rem;}
             .kc-main-container { margin: 0.5rem; padding: 1rem; }
             .question-text { font-size: 1rem; }
             .option-button { font-size: 0.9rem; }
             .next-button, .results-button { font-size: 0.95rem; padding: 0.6rem 1.2rem; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_to_dashboard">Return to Dashboard</span>
        </a>
        <h1 data-translate="kc_header_title_3">Knowledge Check: Module 3</h1>
        <!-- Optional: Language Switcher in Header -->
         <div class="language-switcher-kc">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="kc-main-container">

        <!-- Quiz Area (Initially Visible) -->
        <div class="quiz-area">
            <div class="quiz-header">
                 <h2 data-translate="quiz_title">Test Your Knowledge!</h2>
                 <span class="quiz-progress" id="quiz-progress-indicator">Question 1 / 10</span>
            </div>

            <div class="question-container">
                <p class="question-text" id="question-text">Loading question...</p>
                <div class="options-container" id="options-container">
                    <!-- Options will be loaded here by JS -->
                </div>
            </div>

            <div class="feedback-area" id="feedback-area">
                <!-- Feedback (Correct/Incorrect) shown here -->
            </div>

            <div class="quiz-navigation">
                <button class="next-button" id="next-button" data-translate="next_question_button">Next Question</button>
            </div>
        </div>

        <!-- Results Area (Initially Hidden) -->
        <div class="results-area" id="results-area">
            <div id="results-icon" class="results-icon">
                <!-- Icon (Check or Times) added by JS -->
            </div>
            <h2 id="results-title" class="results-title">Quiz Complete!</h2>
            <p id="results-score" class="results-score">Your score: 0 / 10</p>
            <p id="results-message" class="results-message">Let's see how you did.</p>
            <div class="results-actions">
                <button id="retry-button" class="results-button retry-button">
                    <i class="fas fa-redo"></i> <span data-translate="retry_quiz_button">Retry Quiz</span>
                </button>
                <a href="ctp-dashboard.html" class="results-button dashboard-button">
                   <i class="fas fa-tachometer-alt"></i> <span data-translate="back_to_dashboard_button">Back to Dashboard</span>
                </a>
            </div>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Constants ---
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const CURRENT_MODULE_ID = 3; // <--- SET THIS FOR EACH MODULE'S PAGE
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title_kc_3": `Knowledge Check: Module ${CURRENT_MODULE_ID} - Complete Python`,
                 "kc_header_title_3": `Knowledge Check: Module ${CURRENT_MODULE_ID} - Working with Text`,
                 "return_to_dashboard": "Return to Dashboard",
                 "quiz_title": "Test Your Knowledge!",
                 "quiz_progress_indicator": "Question {current} / {total}",
                 "next_question_button": "Next Question",
                 "finish_quiz_button": "Finish Quiz",
                 "feedback_correct": "Correct! Nicely done.",
                 "feedback_incorrect": "Not quite. Let's keep trying!",
                 "results_title_pass": "Congratulations! Passed!",
                 "results_title_fail": "Keep Practicing!",
                 "results_score_details": "Your score: {score} / {total}",
                 "results_message_pass": "Great job! You've successfully passed the knowledge check for Module {moduleId}. Your progress has been updated.",
                 "results_message_fail": "You scored {score} out of {total}. Remember, you need {passingScore} correct answers to pass. Feel free to retry!",
                 "retry_quiz_button": "Retry Quiz",
                 "back_to_dashboard_button": "Back to Dashboard",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 3 Questions (English) ---
                 "q3_1_text": "What will the following code print?\n<code>print(\"Hello\" + \" \" + \"World\")</code>",
                 "q3_1_opt_a": "`HelloWorld`",
                 "q3_1_opt_b": "`Hello World`", // Correct
                 "q3_1_opt_c": "`Hello +   + World`",
                 "q3_1_opt_d": "Error",
                 "q3_2_text": "Which operator is used for string concatenation in Python?",
                 "q3_2_opt_a": "`*`",
                 "q3_2_opt_b": "`&`",
                 "q3_2_opt_c": "`+`", // Correct
                 "q3_2_opt_d": "`.concat()`",
                 "q3_3_text": "What is the output of:\n<code>print(\"Go\" * 3)</code>",
                 "q3_3_opt_a": "`GoGoGo`", // Correct
                 "q3_3_opt_b": "`Go 3`",
                 "q3_3_opt_c": "`Go Go Go`",
                 "q3_3_opt_d": "Error",
                 "q3_4_text": "What does the `len()` function return when used with a string?",
                 "q3_4_opt_a": "The string itself.",
                 "q3_4_opt_b": "The number of words in the string.",
                 "q3_4_opt_c": "The number of characters in the string.", // Correct
                 "q3_4_opt_d": "The memory address of the string.",
                 "q3_5_text": "If `my_string = \"Python\"`, what is `my_string[0]`?",
                 "q3_5_opt_a": "`P`", // Correct
                 "q3_5_opt_b": "`p`",
                 "q3_5_opt_c": "`Python`",
                 "q3_5_opt_d": "Error",
                 "q3_6_text": "What is the index of the *last* character in the string `word = \"Test\"`?",
                 "q3_6_opt_a": "`0`",
                 "q3_6_opt_b": "`3`", // Correct (length is 4, last index is 3)
                 "q3_6_opt_c": "`4`",
                 "q3_6_opt_d": "`-1` (can be used, but the *positive* index is 3)",
                 "q3_7_text": "What will `len(\"Hello!\")` evaluate to?",
                 "q3_7_opt_a": "`5`",
                 "q3_7_opt_b": "`6`", // Correct
                 "q3_7_opt_c": "`Hello!`",
                 "q3_7_opt_d": "`7`",
                 "q3_8_text": "Consider `text = \"ABC\"`. What happens if you try `text[1] = 'X'`?",
                 "q3_8_opt_a": "The string becomes `AXC`.",
                 "q3_8_opt_b": "It causes an error because strings are immutable.", // Correct
                 "q3_8_opt_c": "It causes an error because 'X' is not 'B'.",
                 "q3_8_opt_d": "The string remains `ABC` with no error.",
                 "q3_9_text": "Which code snippet correctly finds the length of the string variable `name`?",
                 "q3_9_opt_a": "`length(name)`",
                 "q3_9_opt_b": "`name.length()`",
                 "q3_9_opt_c": "`len(name)`", // Correct
                 "q3_9_opt_d": "`size(name)`",
                 "q3_10_text": "If `s1 = \"10\"` and `s2 = \"20\"`, what is the result of `s1 + s2`?",
                 "q3_10_opt_a": "`30`",
                 "q3_10_opt_b": "`10 20`",
                 "q3_10_opt_c": "`\"1020\"`", // Correct (string concatenation)
                 "q3_10_opt_d": "Error"
             },
             pt: {
                 "page_title_kc_3": `Verificação: Módulo ${CURRENT_MODULE_ID} - Python Completo`,
                 "kc_header_title_3": `Verificação: Módulo ${CURRENT_MODULE_ID} - Trabalhando com Texto`,
                 "return_to_dashboard": "Voltar ao Painel",
                 "quiz_title": "Teste Seu Conhecimento!",
                 "quiz_progress_indicator": "Questão {current} / {total}",
                 "next_question_button": "Próxima Questão",
                 "finish_quiz_button": "Finalizar Quiz",
                 "feedback_correct": "Correto! Muito bem.",
                 "feedback_incorrect": "Não foi bem isso. Vamos continuar tentando!",
                 "results_title_pass": "Parabéns! Aprovado!",
                 "results_title_fail": "Continue Praticando!",
                 "results_score_details": "Sua pontuação: {score} / {total}",
                 "results_message_pass": "Ótimo trabalho! Você passou na verificação de conhecimento do Módulo {moduleId}. Seu progresso foi atualizado.",
                 "results_message_fail": "Você acertou {score} de {total}. Lembre-se, você precisa de {passingScore} respostas corretas para passar. Sinta-se à vontade para tentar novamente!",
                 "retry_quiz_button": "Tentar Novamente",
                 "back_to_dashboard_button": "Voltar ao Painel",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 3 Questions (Portuguese) ---
                 "q3_1_text": "O que o seguinte código imprimirá?\n<code>print(\"Olá\" + \" \" + \"Mundo\")</code>",
                 "q3_1_opt_a": "`OláMundo`",
                 "q3_1_opt_b": "`Olá Mundo`", // Correct
                 "q3_1_opt_c": "`Olá +   + Mundo`",
                 "q3_1_opt_d": "Erro",
                 "q3_2_text": "Qual operador é usado para concatenação de strings em Python?",
                 "q3_2_opt_a": "`*`",
                 "q3_2_opt_b": "`&`",
                 "q3_2_opt_c": "`+`", // Correct
                 "q3_2_opt_d": "`.concat()`",
                 "q3_3_text": "Qual é a saída de:\n<code>print(\"Vai\" * 3)</code>",
                 "q3_3_opt_a": "`VaiVaiVai`", // Correct
                 "q3_3_opt_b": "`Vai 3`",
                 "q3_3_opt_c": "`Vai Vai Vai`",
                 "q3_3_opt_d": "Erro",
                 "q3_4_text": "O que a função `len()` retorna quando usada com uma string?",
                 "q3_4_opt_a": "A própria string.",
                 "q3_4_opt_b": "O número de palavras na string.",
                 "q3_4_opt_c": "O número de caracteres na string.", // Correct
                 "q3_4_opt_d": "O endereço de memória da string.",
                 "q3_5_text": "Se `minha_string = \"Python\"`, o que é `minha_string[0]`?",
                 "q3_5_opt_a": "`P`", // Correct
                 "q3_5_opt_b": "`p`",
                 "q3_5_opt_c": "`Python`",
                 "q3_5_opt_d": "Erro",
                 "q3_6_text": "Qual é o índice do *último* caractere na string `palavra = \"Teste\"`?",
                 "q3_6_opt_a": "`0`",
                 "q3_6_opt_b": "`3`", // Correct (comprimento é 4, último índice é 3)
                 "q3_6_opt_c": "`4`",
                 "q3_6_opt_d": "`-1` (pode ser usado, mas o índice *positivo* é 3)",
                 "q3_7_text": "Qual será o resultado de `len(\"Olá!\")`?",
                 "q3_7_opt_a": "`3`", // PT specific 'Olá!' length
                 "q3_7_opt_b": "`4`", // Correct for PT 'Olá!'
                 "q3_7_opt_c": "`Olá!`",
                 "q3_7_opt_d": "`5`",
                 "q3_8_text": "Considere `texto = \"ABC\"`. O que acontece se você tentar `texto[1] = 'X'`?",
                 "q3_8_opt_a": "A string se torna `AXC`.",
                 "q3_8_opt_b": "Causa um erro porque strings são imutáveis.", // Correct
                 "q3_8_opt_c": "Causa um erro porque 'X' não é 'B'.",
                 "q3_8_opt_d": "A string permanece `ABC` sem erro.",
                 "q3_9_text": "Qual trecho de código encontra corretamente o comprimento da variável string `nome`?",
                 "q3_9_opt_a": "`comprimento(nome)`",
                 "q3_9_opt_b": "`nome.comprimento()`",
                 "q3_9_opt_c": "`len(nome)`", // Correct
                 "q3_9_opt_d": "`tamanho(nome)`",
                 "q3_10_text": "Se `s1 = \"10\"` e `s2 = \"20\"`, qual é o resultado de `s1 + s2`?",
                 "q3_10_opt_a": "`30`",
                 "q3_10_opt_b": "`10 20`",
                 "q3_10_opt_c": "`\"1020\"`", // Correct (concatenação de string)
                 "q3_10_opt_d": "Erro"
             },
             zh: {
                 "page_title_kc_3": `知识测验：模块 ${CURRENT_MODULE_ID} - Python 完全指南`,
                 "kc_header_title_3": `知识测验：模块 ${CURRENT_MODULE_ID} - 处理文本`,
                 "return_to_dashboard": "返回仪表板",
                 "quiz_title": "测试您的知识！",
                 "quiz_progress_indicator": "问题 {current} / {total}",
                 "next_question_button": "下一题",
                 "finish_quiz_button": "完成测验",
                 "feedback_correct": "正确！做得好。",
                 "feedback_incorrect": "不太对。继续努力！",
                 "results_title_pass": "恭喜！已通过！",
                 "results_title_fail": "继续练习！",
                 "results_score_details": "您的得分：{score} / {total}",
                 "results_message_pass": "干得漂亮！您已成功通过模块 {moduleId} 的知识测验。您的进度已更新。",
                 "results_message_fail": "您在 {total} 题中答对了 {score} 题。请记住，您需要答对 {passingScore} 题才能通过。欢迎重试！",
                 "retry_quiz_button": "重试测验",
                 "back_to_dashboard_button": "返回仪表板",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 3 Questions (Chinese) ---
                 "q3_1_text": "以下代码将打印什么？\n<code>print(\"你好\" + \" \" + \"世界\")</code>",
                 "q3_1_opt_a": "`你好世界`",
                 "q3_1_opt_b": "`你好 世界`", // Correct
                 "q3_1_opt_c": "`你好 +   + 世界`",
                 "q3_1_opt_d": "错误",
                 "q3_2_text": "在 Python 中，哪个运算符用于字符串连接？",
                 "q3_2_opt_a": "`*`",
                 "q3_2_opt_b": "`&`",
                 "q3_2_opt_c": "`+`", // Correct
                 "q3_2_opt_d": "`.concat()`",
                 "q3_3_text": "以下代码的输出是什么？\n<code>print(\"走\" * 3)</code>",
                 "q3_3_opt_a": "`走走走`", // Correct
                 "q3_3_opt_b": "`走 3`",
                 "q3_3_opt_c": "`走 走 走`",
                 "q3_3_opt_d": "错误",
                 "q3_4_text": "当 `len()` 函数用于字符串时，它返回什么？",
                 "q3_4_opt_a": "字符串本身。",
                 "q3_4_opt_b": "字符串中的单词数。",
                 "q3_4_opt_c": "字符串中的字符数。", // Correct
                 "q3_4_opt_d": "字符串的内存地址。",
                 "q3_5_text": "如果 `my_string = \"Python\"`，那么 `my_string[0]` 是什么？",
                 "q3_5_opt_a": "`P`", // Correct
                 "q3_5_opt_b": "`p`",
                 "q3_5_opt_c": "`Python`",
                 "q3_5_opt_d": "错误",
                 "q3_6_text": "在字符串 `word = \"Test\"` 中，*最后*一个字符的索引是什么？",
                 "q3_6_opt_a": "`0`",
                 "q3_6_opt_b": "`3`", // Correct (长度为 4，最后索引为 3)
                 "q3_6_opt_c": "`4`",
                 "q3_6_opt_d": "`-1` (可以使用，但*正*索引是 3)",
                 "q3_7_text": "`len(\"你好！\")` 的结果是什么？", // Chinese string "你好！"
                 "q3_7_opt_a": "`2`",
                 "q3_7_opt_b": "`3`", // Correct (3 Chinese characters)
                 "q3_7_opt_c": "`你好！`",
                 "q3_7_opt_d": "`4`",
                 "q3_8_text": "考虑 `text = \"ABC\"`。如果你尝试 `text[1] = 'X'` 会发生什么？",
                 "q3_8_opt_a": "字符串变为 `AXC`。",
                 "q3_8_opt_b": "导致错误，因为字符串是不可变的。", // Correct
                 "q3_8_opt_c": "导致错误，因为 'X' 不是 'B'。",
                 "q3_8_opt_d": "字符串保持 `ABC` 并且没有错误。",
                 "q3_9_text": "哪个代码片段正确地找到了字符串变量 `name` 的长度？",
                 "q3_9_opt_a": "`length(name)`",
                 "q3_9_opt_b": "`name.length()`",
                 "q3_9_opt_c": "`len(name)`", // Correct
                 "q3_9_opt_d": "`size(name)`",
                 "q3_10_text": "如果 `s1 = \"10\"` 且 `s2 = \"20\"`，`s1 + s2` 的结果是什么？",
                 "q3_10_opt_a": "`30`",
                 "q3_10_opt_b": "`10 20`",
                 "q3_10_opt_c": "`\"1020\"`", // Correct (字符串连接)
                 "q3_10_opt_d": "错误"
             }
         };

        // --- Module Specific Questions Data ---
        // Structure: { questionKey: "qN_M_text", options: ["qN_M_opt_a", ...], correctAnswerIndex: number }
        const questionsData = [
            { questionKey: "q3_1_text", options: ["q3_1_opt_a", "q3_1_opt_b", "q3_1_opt_c", "q3_1_opt_d"], correctAnswerIndex: 1 },
            { questionKey: "q3_2_text", options: ["q3_2_opt_a", "q3_2_opt_b", "q3_2_opt_c", "q3_2_opt_d"], correctAnswerIndex: 2 },
            { questionKey: "q3_3_text", options: ["q3_3_opt_a", "q3_3_opt_b", "q3_3_opt_c", "q3_3_opt_d"], correctAnswerIndex: 0 },
            { questionKey: "q3_4_text", options: ["q3_4_opt_a", "q3_4_opt_b", "q3_4_opt_c", "q3_4_opt_d"], correctAnswerIndex: 2 },
            { questionKey: "q3_5_text", options: ["q3_5_opt_a", "q3_5_opt_b", "q3_5_opt_c", "q3_5_opt_d"], correctAnswerIndex: 0 },
            { questionKey: "q3_6_text", options: ["q3_6_opt_a", "q3_6_opt_b", "q3_6_opt_c", "q3_6_opt_d"], correctAnswerIndex: 1 },
            { questionKey: "q3_7_text", options: ["q3_7_opt_a", "q3_7_opt_b", "q3_7_opt_c", "q3_7_opt_d"], correctAnswerIndex: 1 }, // English len("Hello!") is 6
            // Adjusted correct index for PT/ZH len() in translation check later if needed
            { questionKey: "q3_8_text", options: ["q3_8_opt_a", "q3_8_opt_b", "q3_8_opt_c", "q3_8_opt_d"], correctAnswerIndex: 1 },
            { questionKey: "q3_9_text", options: ["q3_9_opt_a", "q3_9_opt_b", "q3_9_opt_c", "q3_9_opt_d"], correctAnswerIndex: 2 },
            { questionKey: "q3_10_text", options: ["q3_10_opt_a", "q3_10_opt_b", "q3_10_opt_c", "q3_10_opt_d"], correctAnswerIndex: 2 },
        ];


        // --- Quiz State ---
        let currentQuestionIndex = 0;
        let score = 0;
        let quizFinished = false;
        let selectedAnswerIndex = null; // Track which answer was clicked

        // --- DOM Elements ---
        const quizArea = document.querySelector('.quiz-area');
        const resultsArea = document.getElementById('results-area');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const nextButton = document.getElementById('next-button');
        const retryButton = document.getElementById('retry-button');
        const progressIndicator = document.getElementById('quiz-progress-indicator');
        const resultsIcon = document.getElementById('results-icon');
        const resultsTitle = document.getElementById('results-title');
        const resultsScoreElement = document.getElementById('results-score');
        const resultsMessage = document.getElementById('results-message');
        const languageSelectElement = document.getElementById('languageSelect');

        // --- Translation Functions (Mostly copied from dashboard) ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            document.documentElement.lang = lang;
            if (languageSelectElement) languageSelectElement.value = lang;
            translatePage(lang); // Translate static elements
            // If quiz is ongoing, redisplay current question with new lang
            if (!quizFinished) {
                 displayQuestion(currentQuestionIndex);
                 // Re-apply feedback if an answer was already selected for the current question
                 if (selectedAnswerIndex !== null) {
                     showFeedback(questionsData[currentQuestionIndex].correctAnswerIndex === selectedAnswerIndex);
                     highlightAnswers(questionsData[currentQuestionIndex].correctAnswerIndex, selectedAnswerIndex);
                     nextButton.classList.add('visible');
                     if (currentQuestionIndex === TOTAL_QUESTIONS - 1) {
                         nextButton.textContent = getTranslation('finish_quiz_button', lang);
                     } else {
                         nextButton.textContent = getTranslation('next_question_button', lang);
                     }
                 }
            } else {
                // If quiz is finished, re-render the results page in the new language
                showResults();
            }
        }

        function getTranslation(key, lang, replacements = {}) {
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             // Handle potential language-specific differences in correct answers (like len())
             // Example for Q7 (len("Hello!") vs len("Olá!") vs len("你好！"))
             if (key === 'q3_7_text' || key.startsWith('q3_7_opt')) {
                 if (lang === 'pt') questionsData[6].correctAnswerIndex = 1; // "Olá!" len is 4 (index 1)
                 else if (lang === 'zh') questionsData[6].correctAnswerIndex = 1; // "你好！" len is 3 (index 1)
                 else questionsData[6].correctAnswerIndex = 1; // "Hello!" len is 6 (index 1)
             }
             // ... add more checks if other questions have lang-dependent correct answers

             // Parse for `<code>` tags specifically within options for styling
             if (key.includes('_opt_')) {
                 text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
             }
             return text;
         }


        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                if (el.tagName === 'TITLE') {
                    document.title = translation;
                } else {
                    // Use innerHTML for elements that might contain <code> tags from translation
                    el.innerHTML = translation;
                }
            });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                const key = el.getAttribute('data-translate-aria-label');
                el.setAttribute('aria-label', getTranslation(key, lang));
             });
        }


        // --- Quiz Logic Functions ---

        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {}; // Return empty object on error
            }
        }

        function saveKnowledgeCheckStatus(moduleId) {
            if (quizFinished && score >= PASSING_SCORE) {
                try {
                    const currentStatus = loadKnowledgeCheckStatus();
                    currentStatus[moduleId] = true; // Mark this module as complete
                    localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(currentStatus));
                    console.log(`Knowledge check status updated for Module ${moduleId}.`);
                } catch (e) {
                    console.error("Error saving KC status to localStorage:", e);
                }
            }
        }

        function displayQuestion(index) {
            if (index >= TOTAL_QUESTIONS) {
                showResults();
                return;
            }
            selectedAnswerIndex = null; // Reset selection for the new question
            const question = questionsData[index];
            const lang = getStoredLanguage();

            // Update progress indicator
            progressIndicator.textContent = getTranslation('quiz_progress_indicator', lang, { current: index + 1, total: TOTAL_QUESTIONS });

            // Update question text (handle potential newlines and code)
            let questionHTML = getTranslation(question.questionKey, lang);
            questionHTML = questionHTML.replace(/\n/g, '<br>').replace(/`([^`]+)`/g, '<code>$1</code>');
            questionTextElement.innerHTML = questionHTML;


            // Clear previous options and feedback
            optionsContainer.innerHTML = '';
            feedbackArea.textContent = '';
            feedbackArea.className = 'feedback-area'; // Reset classes
            nextButton.classList.remove('visible');

            // Create and add option buttons
            question.options.forEach((optionKey, i) => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.dataset.index = i;
                // Use innerHTML for options to render <code> tags correctly
                button.innerHTML = getTranslation(optionKey, lang);
                button.addEventListener('click', () => handleAnswer(i));
                optionsContainer.appendChild(button);
            });

             // Set button text based on question index
             if (index === TOTAL_QUESTIONS - 1) {
                 nextButton.textContent = getTranslation('finish_quiz_button', lang);
             } else {
                 nextButton.textContent = getTranslation('next_question_button', lang);
             }
        }

        function handleAnswer(selectedIndex) {
            if (selectedAnswerIndex !== null) return; // Allow only one answer per question

            selectedAnswerIndex = selectedIndex;
            const currentQuestion = questionsData[currentQuestionIndex];
            const correctIndex = currentQuestion.correctAnswerIndex;
            const isCorrect = (selectedIndex === correctIndex);

            if (isCorrect) {
                score++;
            }

            // Disable all option buttons after selection
            const optionButtons = optionsContainer.querySelectorAll('.option-button');
            optionButtons.forEach(btn => btn.disabled = true);

            // Highlight correct/incorrect answers
            highlightAnswers(correctIndex, selectedIndex);

            // Show feedback message
            showFeedback(isCorrect);

            // Show the Next/Finish button
            nextButton.classList.add('visible');
        }

        function highlightAnswers(correctIndex, selectedIndex) {
             const optionButtons = optionsContainer.querySelectorAll('.option-button');
             optionButtons.forEach((btn, i) => {
                 if (i === correctIndex) {
                     btn.classList.add('correct');
                 } else if (i === selectedIndex) {
                     btn.classList.add('incorrect');
                 }
                 // Add 'selected' class to the clicked button for potential styling
                 if (i === selectedIndex) {
                     btn.classList.add('selected');
                 }
             });
         }

        function showFeedback(isCorrect) {
             const lang = getStoredLanguage();
             feedbackArea.textContent = getTranslation(isCorrect ? 'feedback_correct' : 'feedback_incorrect', lang);
             feedbackArea.classList.add(isCorrect ? 'correct' : 'incorrect');
             feedbackArea.classList.add('visible'); // Make it visible
         }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                displayQuestion(currentQuestionIndex);
            } else {
                showResults();
            }
        }

        function showResults() {
            quizFinished = true;
            const lang = getStoredLanguage();
            const passed = score >= PASSING_SCORE;

            // Hide quiz, show results
            quizArea.style.display = 'none';
            resultsArea.style.display = 'block';

            // Update results display
            resultsIcon.innerHTML = passed ? '<i class="fas fa-check-circle pass"></i>' : '<i class="fas fa-times-circle fail"></i>';
            resultsTitle.textContent = getTranslation(passed ? 'results_title_pass' : 'results_title_fail', lang);
            resultsTitle.className = `results-title ${passed ? 'pass' : 'fail'}`; // Add class for color if needed by CSS
            resultsScoreElement.textContent = getTranslation('results_score_details', lang, { score: score, total: TOTAL_QUESTIONS });

            const messageKey = passed ? 'results_message_pass' : 'results_message_fail';
            resultsMessage.textContent = getTranslation(messageKey, lang, {
                score: score,
                total: TOTAL_QUESTIONS,
                passingScore: PASSING_SCORE,
                moduleId: CURRENT_MODULE_ID
            });

            // Save progress IF passed
            if (passed) {
                saveKnowledgeCheckStatus(CURRENT_MODULE_ID);
            }

            // Ensure buttons have correct text (in case language changed during quiz)
             retryButton.querySelector('span').textContent = getTranslation('retry_quiz_button', lang);
             document.querySelector('.dashboard-button span').textContent = getTranslation('back_to_dashboard_button', lang);

        }

        function retryQuiz() {
            // Reset state
            currentQuestionIndex = 0;
            score = 0;
            quizFinished = false;
            selectedAnswerIndex = null;

            // Hide results, show quiz
            resultsArea.style.display = 'none';
            quizArea.style.display = 'block';

            // Start quiz again from the first question
            displayQuestion(currentQuestionIndex);
        }


        // --- Event Listeners ---
        nextButton.addEventListener('click', nextQuestion);
        retryButton.addEventListener('click', retryQuiz);
        if (languageSelectElement) {
             languageSelectElement.addEventListener('change', (e) => {
                 setLanguage(e.target.value);
             });
         }

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            if (languageSelectElement) languageSelectElement.value = initialLang;
            translatePage(initialLang); // Translate static elements first
            displayQuestion(currentQuestionIndex); // Display the first question
        });

    </script>

</body>
</html>