<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 3: Working with Text (Strings)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Reset & Base Styles --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Keep yellow accent */
            --success-color: #28a745;
            --error-color: #dc3545;
            --string-op-color: #e83e8c; /* Pinkish for string operations */
            --length-color: #fd7e14; /* Orange for length */
            --index-color: #20c997; /* Teal for index */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Nav Colors */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden; display: flex; flex-direction: column; min-height: 100vh;
        }
        main { flex-grow: 1; }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        .fade-in.delay-5 { animation-delay: 1.0s; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
        .action-button {
             display: inline-flex; align-items: center; justify-content: center; gap: 0.5em;
             padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold;
             color: var(--text-light); background-color: var(--primary-color); border: none;
             border-radius: var(--border-radius); cursor: pointer;
             transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed);
             margin-top: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             text-decoration: none; line-height: 1.2;
        }
        .action-button i.fas { /* Aligned by flex */ }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Animations --- */
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); } 50% { transform: scale(1.03); box-shadow: 0 0 15px rgba(0, 123, 255, 0.6); } 100% { transform: scale(1); box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); } }
        @keyframes code-line-anim { from { width: 0; opacity: 0; } to { width: 100%; opacity: 1; } }
        @keyframes tada { from { transform: scale3d(1, 1, 1); } 10%, 20% { transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg); } 30%, 50%, 70%, 90% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg); } 40%, 60%, 80% { transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg); } to { transform: scale3d(1, 1, 1); } }
        .tada-anim { animation: tada 1s ease; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }

        /* --- Minimal Retractable Nav --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Header --- */
        .main-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 4rem 0 6rem; text-align: center; position: relative; overflow: hidden; }
        .main-header h1 { font-family: var(--font-title); font-size: 3rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .main-header p { font-size: 1.2rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-shape { position: absolute; border-radius: 50%; background-color: rgba(255, 255, 255, 0.1); animation: pulse 5s infinite ease-in-out alternate; }
        .shape1 { width: 150px; height: 150px; bottom: -50px; left: 10%; animation-duration: 6s; }
        .shape2 { width: 80px; height: 80px; top: 50px; right: 15%; animation-duration: 4s; }
        .shape3 { width: 50px; height: 50px; bottom: 20px; right: 30%; animation-duration: 7s; }

        /* --- Section Styling --- */
        section { padding: 4rem 0; border-bottom: 1px solid #eee; }
        main section:last-of-type { border-bottom: none; }
        section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); margin-bottom: 2rem; text-align: center; position: relative; padding-bottom: 10px; }
        section h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 60px; height: 4px; background-color: var(--accent-color); border-radius: 2px; }

        /* --- Welcome Section (Module 3) --- */
        #welcome p { font-size: 1.1rem; max-width: 700px; margin: 0 auto 1rem; text-align: center; }

        /* --- String Operations Section --- */
        #string-operations .string-op-analogy { /* New class name */
            display: flex; align-items: flex-start; /* Align top for potentially different text lengths */ justify-content: space-around;
            background-color: #fff; padding: 2rem; border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 2rem; flex-wrap: wrap; gap: 2rem; /* Increased gap */
        }
        .op-part { /* New class name */
            text-align: center; max-width: 250px; opacity: 0; transform: scale(0.9);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .op-part.visible { opacity: 1; transform: scale(1); }
        .op-icon { /* New class name */
            font-size: 3rem; margin-bottom: 1rem; color: var(--string-op-color); /* Specific color */
            display: inline-block; transition: transform var(--transition-speed) ease;
        }
        .op-part:hover .op-icon { transform: scale(1.15); }
        .op-example { /* Style for code examples within analogy */
            font-family: 'Courier New', Courier, monospace; background-color: #e9ecef;
            padding: 0.5rem 0.8rem; border-radius: 4px; margin-top: 1rem;
            font-size: 0.95rem; color: var(--text-dark); display: inline-block;
            border: 1px solid #ced4da;
        }

        /* --- String Info & Access Section --- */
        #string-info-access .info-cards { /* Renamed from features */
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Slightly wider */
            gap: 2rem; margin-top: 2rem;
        }
        .info-card { /* Renamed from feature-card */
            background-color: #fff; padding: 1.5rem; border-radius: var(--border-radius);
            box-shadow: 0 4px 10px rgba(0,0,0,0.07); text-align: center;
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            opacity: 0; transform: translateY(20px);
            animation: fadeInAnimation 0.6s ease-out forwards;
            border-top: 4px solid transparent; /* For hover effect */
        }
        .info-card:nth-child(1) { animation-delay: 0.2s; border-top-color: var(--length-color); } /* Length card */
        .info-card:nth-child(2) { animation-delay: 0.4s; border-top-color: var(--index-color); } /* Index card */
        .info-card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .info-icon { font-size: 2.5rem; margin-bottom: 1rem; }
        #card-len .info-icon { color: var(--length-color); }
        #card-index .info-icon { color: var(--index-color); }

        .info-card h3 { font-family: var(--font-body); font-weight: 700; font-size: 1.3rem; margin-bottom: 0.8rem; color: var(--text-dark); }
        .info-details { /* Reused class */
             font-size: 1rem; color: var(--secondary-color); margin-top: 1rem; line-height: 1.6;
        }
        .info-example { /* Specific styling for examples here */
            font-family: 'Courier New', Courier, monospace; background-color: #e9ecef;
            padding: 0.5rem 0.8rem; border-radius: 4px; margin-top: 1rem;
            font-size: 0.95rem; color: var(--text-dark); display: block; /* Stack examples */
            border: 1px solid #ced4da; margin-left: auto; margin-right: auto; max-width: 90%;
        }
        .zero-based-highlight { background-color: rgba(32, 201, 151, 0.15); padding: 0.2em 0.4em; border-radius: 3px; font-weight: bold; color: #147a5a; }

        /* --- Putting It Together Section --- */
        #putting-it-together-m3 .explanation { display: flex; gap: 2rem; align-items: flex-start; margin-top: 2rem; flex-wrap: wrap; }
        .text-demo { /* Renamed from variable-demo */
            flex-basis: 55%; background-color: var(--background-dark); color: #eee;
            padding: 1.5rem; border-radius: var(--border-radius); font-family: 'Courier New', Courier, monospace;
            position: relative; min-height: 300px; /* Adjusted height */ box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 0.9rem; /* Slightly smaller code */ line-height: 1.6;
        }
        .text-demo .code-line { margin-bottom: 0.7rem; display: block; /* Ensure lines stack */ white-space: nowrap; overflow: hidden; /* Prevent wrapping */ }
        .text-demo .code-output-area {
            color: var(--accent-color); font-weight: bold; font-size: 1rem;
            border-top: 1px dashed var(--secondary-color); padding-top: 1rem; margin-top: 1rem;
            opacity: 0; transition: opacity 0.8s ease 1.8s; /* Delay appearance longer */
            line-height: 1.8; /* More space for output */
        }
        .text-demo .code-output-area.visible { opacity: 1; }
        .text-explanation { /* Renamed from variable-text */ flex-basis: 40%; font-size: 1.05rem; }
        .text-explanation p { margin-bottom: 1rem; }
        .code-highlight { /* Reused */
            background-color: rgba(0, 123, 255, 0.1); color: #0056b3; padding: 0.2em 0.4em;
            border-radius: 4px; font-family: 'Courier New', Courier, monospace; font-weight: bold;
            cursor: pointer; transition: background-color var(--transition-speed);
            display: inline-block; position: relative;
        }
        .code-highlight:hover { background-color: rgba(0, 123, 255, 0.2); }
        /* Tooltip */
        .tooltip {
            visibility: hidden; width: 200px; /* Wider */ background-color: var(--background-dark);
            color: var(--text-light); text-align: center; border-radius: 6px; padding: 8px 5px;
            position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -100px; /* Adjusted */
            opacity: 0; transition: opacity 0.3s; font-family: var(--font-body);
            font-size: 0.9rem; font-weight: normal; pointer-events: none; line-height: 1.3;
        }
        .tooltip::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: var(--background-dark) transparent transparent transparent; }
        .code-highlight:hover .tooltip { visibility: visible; opacity: 1; }
        /* Code syntax colors within blocks */
        .code-variable { color: #9cdcfe; }
        .code-operator { color: var(--string-op-color); } /* Pink for + and * with strings */
        .code-keyword { color: #569cd6; } /* print */
        .code-string { color: #ce9178; }
        .code-comment { color: #6a9955; }
        .code-function { color: #dcdcaa; } /* len */
        .code-number { color: #b5cea8; } /* For index numbers, repetition count */
        .code-brackets { color: var(--index-color); font-weight: bold; } /* Teal for [] */
        .code-builtin { color: #4ec9b0; } /* Potentially for type() results if needed */

        /* --- Knowledge Check Section --- */
        #knowledge-check { background-color: #e9ecef; }
        .quiz-container { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 700px; margin: 2rem auto 0; }
        .quiz-question { font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; color: var(--text-dark); }
        .quiz-options button { display: block; width: 100%; padding: 1rem; margin-bottom: 1rem; text-align: left; font-size: 1rem; background-color: #f8f9fa; border: 1px solid #ced4da; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), border-color var(--transition-speed), transform var(--transition-speed); }
        .quiz-options button:not(:disabled):hover { background-color: #e2e6ea; border-color: #adb5bd; transform: translateX(5px); }
        .quiz-options button:disabled { cursor: default; opacity: 0.7; }
        .quiz-options button.correct { background-color: #d4edda; border-color: var(--success-color); color: #155724; font-weight: bold; }
        .quiz-options button.incorrect { background-color: #f8d7da; border-color: var(--error-color); color: #721c24; font-weight: bold; }
        .quiz-options button.incorrect.shake { animation: shake 0.5s ease; }
        .quiz-feedback { margin-top: 1.5rem; padding: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; transition: opacity 0.5s ease; height: 0; overflow: hidden; }
        .quiz-feedback.visible { opacity: 1; height: auto; margin-bottom: 1rem; }
        .quiz-feedback.correct { background-color: #d4edda; color: #155724; }
        .quiz-feedback.incorrect { background-color: #f8d7da; color: #721c24; }
        #next-question-btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5em; margin: 1.5rem auto 0; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.3s, visibility 0.3s; opacity: 0; visibility: hidden; }
        #next-question-btn:hover { background-color: #0056b3; transform: scale(1.05); }
        #next-question-btn.visible { opacity: 1; visibility: visible; }

        /* --- Completion Section Styling --- */
        .completion-section { padding: 4rem 0; text-align: center; background-color: var(--background-light); }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section .icon .fas + .fas { margin-left: 0.75rem; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); margin-bottom: 1rem; }
        .completion-section h2::after { display: none; } /* Remove underline */
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); max-width: 700px; margin-left: auto; margin-right: auto; line-height: 1.8; }
        .completion-section .button-group { margin-top: 2.5rem; }

        /* --- Footer --- */
        .main-footer { background-color: var(--background-dark); color: var(--text-light); text-align: center; padding: 1.5rem 0; font-size: 0.9rem; margin-top: auto; }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .main-header h1 { font-size: 2.5rem; } .main-header p { font-size: 1.1rem; }
            section h2 { font-size: 1.8rem; }
            .string-op-analogy { flex-direction: column; gap: 1.5rem; align-items: center; } /* Stack vertically */
            #string-info-access .info-cards { grid-template-columns: 1fr; }
            #putting-it-together-m3 .explanation { flex-direction: column; }
            .text-demo, .text-explanation { flex-basis: 100%; }
            .minimal-nav { min-width: 180px; } .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
            .completion-section h2 { font-size: 2rem; }
            .completion-section .button-group { flex-direction: column; align-items: center; gap: 0.8rem; }
            .completion-section .action-button { width: 80%; max-width: 350px; margin-top: 0; }
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .main-header h1 { font-size: 2rem; } .main-header p { font-size: 1rem; }
            section h2 { font-size: 1.6rem; }
            .quiz-options button { padding: 0.8rem; font-size: 0.95rem; }
            .tooltip { width: 160px; margin-left: -80px; font-size: 0.8rem;} /* Adjusted tooltip width */
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
            .completion-section .icon { font-size: 3.5rem; }
            .completion-section h2 { font-size: 1.8rem; } .completion-section p { font-size: 1rem; }
            .completion-section .action-button { width: 90%; max-width: 300px; }
             .text-demo { font-size: 0.85rem; } /* Further reduce code size */
        }

    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- Links to OTHER main pages - UPDATED FOR MODULE 3 -->
            <li><a href="ctp-practice-3.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_practice">Practice</span></a></li>
            <li><a href="ctp-advanced-3.html"><i class="fas fa-flask fa-fw"></i> <span data-translate="nav_advanced">Advanced Practice</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
             <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
             <!-- Links to sections on THIS page -->
             <li><a href="#welcome"><i class="fas fa-door-open fa-fw"></i> <span data-translate="nav_welcome_m3">Welcome M3</span></a></li>
             <li><a href="#string-operations"><i class="fas fa-link fa-fw"></i> <span data-translate="nav_string_ops">Combine/Repeat</span></a></li>
             <li><a href="#string-info-access"><i class="fas fa-info-circle fa-fw"></i> <span data-translate="nav_len_index">Length/Access</span></a></li>
             <li><a href="#putting-it-together-m3"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_putting_together">In Action</span></a></li>
             <li><a href="#knowledge-check"><i class="fas fa-check-double fa-fw"></i> <span data-translate="nav_quiz">Knowledge Check</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">üá¨üáß English</option>
                     <option value="pt" data-translate="lang_pt">üáßüá∑ Portugu√™s</option>
                     <option value="zh" data-translate="lang_zh">üá®üá≥ ‰∏≠Êñá</option>
                 </select>
            </li>
        </ul>
    </nav>

    <header class="main-header">
        <!-- Decorative shapes -->
        <div class="header-shape shape1"></div>
        <div class="header-shape shape2"></div>
        <div class="header-shape shape3"></div>

        <div class="container">
            <h1 data-translate="header_title_m3">Module 3: Working with Text (Strings)</h1>
            <p data-translate="header_subtitle_m3">Combining, repeating, measuring, and accessing parts of text data.</p>
        </div>
    </header>

    <main>
        <!-- ========= Welcome Section (Module 3) ========= -->
        <section id="welcome">
            <div class="container">
                <h2 class="fade-in" data-translate="welcome_title_m3">üìù Manipulating Text</h2>
                <p class="fade-in delay-1" data-translate="welcome_p1_m3">
                    Welcome to Module 3! Text is everywhere in AI ‚Äì from user commands and chatbot responses to articles we analyze (Natural Language Processing) and labels for data.
                    Python makes it easy to <span class="highlight">manipulate</span> text data, called <span class="highlight">strings</span>.
                </p>
                <p class="fade-in delay-2" data-translate="welcome_p2_m3">
                    In this module, we'll learn how to join strings together, repeat them, find out how long they are, and pick out specific characters. Let's dive in!
                </p>
            </div>
        </section>

        <!-- ========= String Operations Section ========= -->
        <section id="string-operations">
            <div class="container">
                <h2 class="fade-in" data-translate="string_ops_title">üîó Combining & Repeating Strings</h2>
                <p class="text-center fade-in delay-1" data-translate="string_ops_subtitle">Two common ways to build new strings from existing ones.</p>

                <div class="string-op-analogy fade-in delay-2">
                     <!-- Part 1: Concatenation (+) -->
                    <div class="op-part">
                        <span class="op-icon"><i class="fas fa-link"></i></span>
                        <h3 data-translate="op_concat_title">Concatenation (+)</h3>
                        <p data-translate="op_concat_text">Joining strings end-to-end using the plus sign.</p>
                        <div class="op-example" data-translate="op_concat_example"><code>"AI" + " " + "Rules"</code><br>‚û°Ô∏è <code>"AI Rules"</code></div>
                    </div>
                     <!-- Part 2: Multiplication (*) -->
                    <div class="op-part">
                        <span class="op-icon"><i class="fas fa-clone"></i></span>
                        <h3 data-translate="op_repeat_title">Multiplication (*)</h3>
                        <p data-translate="op_repeat_text">Repeating a string a certain number of times.</p>
                        <div class="op-example" data-translate="op_repeat_example"><code>"Go! " * 3</code><br>‚û°Ô∏è <code>"Go! Go! Go! "</code></div>
                    </div>
                </div>
                 <p class="text-center fade-in delay-3" style="margin-top: 2rem;" data-translate="string_ops_conclusion">These operators let us dynamically construct text messages, separators, and more.</p>
            </div>
        </section>

        <!-- ========= String Info & Access Section ========= -->
        <section id="string-info-access">
            <div class="container">
                <h2 class="fade-in" data-translate="info_access_title">üìè Measuring & Accessing Characters</h2>
                <p class="text-center fade-in delay-1" data-translate="info_access_subtitle">Finding the length and getting individual characters.</p>

                <div class="info-cards"> <!-- Reusing 'features' structure -->
                    <!-- Card 1: Length (len) -->
                    <div class="info-card" id="card-len">
                        <span class="info-icon"><i class="fas fa-ruler-horizontal"></i></span>
                        <h3 data-translate="info_len_title">Finding Length (len())</h3>
                        <div class="info-details">
                            <p data-translate="info_len_text">The built-in <code>len()</code> function tells you how many characters are in a string (including spaces).</p>
                            <div class="info-example" data-translate="info_len_example"><code>len("Hello AI")</code> ‚û°Ô∏è <code>8</code></div>
                        </div>
                    </div>

                    <!-- Card 2: Indexing ([]) -->
                    <div class="info-card" id="card-index">
                        <span class="info-icon"><i class="fas fa-map-pin"></i></span>
                        <h3 data-translate="info_index_title">Accessing Characters (Indexing [])</h3>
                        <div class="info-details">
                            <p data-translate="info_index_text">Use square brackets <code>[]</code> with a number (the index) to get the character at that position. <strong data-translate="info_index_zero_based">Important:</strong> Indexing starts from <span class="zero-based-highlight">0</span>!</p>
                            <div class="info-example" data-translate="info_index_example"><code>model = "GPT-4"</code><br><code>model[0]</code> ‚û°Ô∏è <code>'G'</code> (First character)<br><code>model[2]</code> ‚û°Ô∏è <code>'T'</code> (Third character)</div>
                        </div>
                    </div>
                </div>
                 <p class="text-center fade-in delay-3" style="margin-top: 2rem;" data-translate="info_access_conclusion">Knowing the length and accessing specific parts is crucial for analyzing and processing text.</p>
            </div>
        </section>

        <!-- ========= Putting It Together Section (Module 3) ========= -->
        <section id="putting-it-together-m3">
             <div class="container">
                 <h2 class="fade-in" data-translate="putting_together_title_m3">‚öôÔ∏è Text Operations in Action</h2>
                 <p class="text-center fade-in delay-1" data-translate="putting_together_subtitle_m3">Let's combine these concepts to work with an AI-related message.</p>

                 <div class="explanation fade-in delay-2">
                     <div class="text-demo">
                        <span class="code-line">
                            <span class="code-variable">prefix</span> <span class="code-operator">=</span> <span class="code-string">"Status:"</span>
                        </span>
                        <span class="code-line">
                            <span class="code-variable">core_message</span> <span class="code-operator">=</span> <span class="code-string">"Data Processed"</span>
                        </span>
                        <span class="code-line">
                             <span class="code-comment" data-translate="concat_comment"># Combine prefix, a space, and the message</span>
                        </span>
                        <span class="code-line">
                            <span class="code-variable">full_status</span> <span class="code-operator">=</span> <span class="code-variable">prefix</span> <span class="code-operator">+</span> <span class="code-string">" "</span> <span class="code-operator">+</span> <span class="code-variable">core_message</span>
                        </span>
                         <span class="code-line" style="margin-top: 1rem;">
                             <span class="code-comment" data-translate="repeat_comment"># Create a separator line</span>
                         </span>
                         <span class="code-line">
                            <span class="code-variable">separator</span> <span class="code-operator">=</span> <span class="code-string">"="</span> <span class="code-operator">*</span> <span class="code-number">20</span>
                         </span>
                         <span class="code-line" style="margin-top: 1rem;">
                            <span class="code-comment" data-translate="len_comment"># Find the length of the full status</span>
                         </span>
                          <span class="code-line">
                            <span class="code-variable">status_length</span> <span class="code-operator">=</span> <span class="code-function">len</span>(<span class="code-variable">full_status</span>)
                         </span>
                         <span class="code-line" style="margin-top: 1rem;">
                             <span class="code-comment" data-translate="index_comment"># Get the first character of the core message</span>
                         </span>
                         <span class="code-line">
                            <span class="code-variable">first_char_core</span> <span class="code-operator">=</span> <span class="code-variable">core_message</span><span class="code-brackets">[</span><span class="code-number">0</span><span class="code-brackets">]</span>
                         </span>
                         <span class="code-line" style="margin-top: 1.5rem;">
                            <span class="code-function">print</span>(<span class="code-variable">separator</span>)
                         </span>
                         <span class="code-line">
                            <span class="code-function">print</span>(<span class="code-variable">full_status</span>)
                         </span>
                         <span class="code-line">
                            <span class="code-function">print</span>(<span class="code-string">f"Length: {status_length}"</span>) <span class="code-comment"># Using an f-string (covered later)</span>
                         </span>
                         <span class="code-line">
                             <span class="code-function">print</span>(<span class="code-string">f"First char of core: {first_char_core}"</span>)
                         </span>
                         <span class="code-line">
                             <span class="code-function">print</span>(<span class="code-variable">separator</span>)
                         </span>

                        <div class="code-output-area">
                            <!-- Output will appear here via JS -->
                        </div>
                     </div>
                     <div class="text-explanation fade-in delay-3"> <!-- Renamed class -->
                         <p data-translate="putting_together_p1_m3">We start with two strings, `prefix` and `core_message`.</p>
                         <p data-translate="putting_together_p2_m3">
                             The <span class="code-highlight" data-translate-tooltip="tooltip_concat"><span class="code-operator">+</span><span class="tooltip">Joins strings together (Concatenation). Remember to add spaces if needed!</span></span> operator combines them with a space in between to create `full_status`.
                         </p>
                         <p data-translate="putting_together_p3_m3">
                             The <span class="code-highlight" data-translate-tooltip="tooltip_multiply"><span class="code-operator">*</span><span class="tooltip">Repeats a string a specified number of times.</span></span> operator creates a `separator` line by repeating the "=" string.
                         </p>
                         <p data-translate="putting_together_p4_m3">
                             <span class="code-highlight" data-translate-tooltip="tooltip_len"><span class="code-function">len()</span><span class="tooltip">Returns the number of characters in the string passed to it.</span></span> calculates the total characters in `full_status`.
                         </p>
                         <p data-translate="putting_together_p5_m3">
                             <span class="code-highlight" data-translate-tooltip="tooltip_index"><span class="code-brackets">[]</span><span class="tooltip">Accesses a character at a specific position (index). Starts from 0! `[0]` gets the very first character.</span></span> is used with index `0` to get the first character ('D') from `core_message`.
                         </p>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Knowledge Check Section ========= -->
        <section id="knowledge-check">
            <div class="container">
                <h2 class="fade-in" data-translate="quiz_title">üß† Quick Check!</h2>
                <div class="quiz-container fade-in delay-1">
                    <div id="quiz-area">
                        <!-- Quiz questions will be loaded here by JavaScript -->
                    </div>
                    <div id="quiz-feedback" class="quiz-feedback">
                        <!-- Feedback (Correct/Incorrect) shown here -->
                    </div>
                    <button id="next-question-btn" data-translate="quiz_next_button">Next Question</button>
                </div>
            </div>
        </section>

        <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                 <div class="icon"> <!-- Animation applied via CSS -->
                    <i class="fas fa-check-double"></i>
                    <i class="fas fa-file-alt"></i> <!-- Text file icon -->
                    <i class="fas fa-star"></i>
                </div>
                <h2 class="fade-in delay-1" data-translate="completion_theory_title_m3">Module 3 Theory Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_theory_desc_m3">
                    Fantastic! You now know the basics of manipulating strings in Python. This is fundamental for any AI task involving text. <br>
                    Time to practice these skills! Head to the <strong>Practice Zone</strong> or the <strong>Advanced Practice</strong> for Module 3.
                </p>
                <div class="button-group">
                    <!-- UPDATED Links for Module 3 -->
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-3"><i class="fas fa-list"></i> <span data-translate="nav_menu">Course Menu</span></a>
                    <a href="ctp-practice-3.html" class="action-button success fade-in delay-4"><i class="fas fa-pencil-alt"></i> <span data-translate="nav_practice">Start Practice</span></a>
                    <a href="ctp-advanced-3.html" class="action-button secondary fade-in delay-5"><i class="fas fa-flask"></i> <span data-translate="nav_advanced">Advanced Practice</span></a>
                </div>
            </div>
        </section>

    </main>

    <footer class="main-footer">
        <div class="container">
            <!-- Footer text kept minimal -->
        </div>
    </footer>

    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 3: Working with Text (Strings)",
            "nav_practice": "Start Practice",
            "nav_advanced": "Advanced Practice",
            "nav_menu": "Course Menu",
            "nav_welcome_m3": "Welcome M3", "nav_string_ops": "Combine/Repeat", "nav_len_index": "Length/Access", "nav_putting_together": "In Action", "nav_quiz": "Knowledge Check",
            "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá",
            "header_title_m3": "Module 3: Working with Text (Strings)", "header_subtitle_m3": "Combining, repeating, measuring, and accessing parts of text data.",
            "welcome_title_m3": "üìù Manipulating Text",
            "welcome_p1_m3": "Welcome to Module 3! Text is everywhere in AI ‚Äì from user commands and chatbot responses to articles we analyze (Natural Language Processing) and labels for data. Python makes it easy to manipulate text data, called strings.",
            "welcome_p2_m3": "In this module, we'll learn how to join strings together, repeat them, find out how long they are, and pick out specific characters. Let's dive in!",
            "string_ops_title": "üîó Combining & Repeating Strings", "string_ops_subtitle": "Two common ways to build new strings from existing ones.",
            "op_concat_title": "Concatenation (+)", "op_concat_text": "Joining strings end-to-end using the plus sign.", "op_concat_example": "<code>\"AI\" + \" \" + \"Rules\"</code><br>‚û°Ô∏è <code>\"AI Rules\"</code>",
            "op_repeat_title": "Multiplication (*)", "op_repeat_text": "Repeating a string a certain number of times.", "op_repeat_example": "<code>\"Go! \" * 3</code><br>‚û°Ô∏è <code>\"Go! Go! Go! \"</code>",
            "string_ops_conclusion": "These operators let us dynamically construct text messages, separators, and more.",
            "info_access_title": "üìè Measuring & Accessing Characters", "info_access_subtitle": "Finding the length and getting individual characters.",
            "info_len_title": "Finding Length (len())", "info_len_text": "The built-in <code>len()</code> function tells you how many characters are in a string (including spaces).", "info_len_example": "<code>len(\"Hello AI\")</code> ‚û°Ô∏è <code>8</code>",
            "info_index_title": "Accessing Characters (Indexing [])", "info_index_text": "Use square brackets <code>[]</code> with a number (the index) to get the character at that position. <strong>Important:</strong> Indexing starts from <span class=\"zero-based-highlight\">0</span>!", "info_index_zero_based": "Important:", "info_index_example": "<code>model = \"GPT-4\"</code><br><code>model[0]</code> ‚û°Ô∏è <code>'G'</code> (First character)<br><code>model[2]</code> ‚û°Ô∏è <code>'T'</code> (Third character)",
            "info_access_conclusion": "Knowing the length and accessing specific parts is crucial for analyzing and processing text.",
            "putting_together_title_m3": "‚öôÔ∏è Text Operations in Action", "putting_together_subtitle_m3": "Let's combine these concepts to work with an AI-related message.",
            "concat_comment": "# Combine prefix, a space, and the message", "repeat_comment": "# Create a separator line", "len_comment": "# Find the length of the full status", "index_comment": "# Get the first character of the core message",
            "putting_together_p1_m3": "We start with two strings, <code>prefix</code> and <code>core_message</code>.",
            "putting_together_p2_m3": "The <code>+</code> operator combines them with a space in between to create <code>full_status</code>.",
            "putting_together_p3_m3": "The <code>*</code> operator creates a <code>separator</code> line by repeating the \"=\" string.",
            "putting_together_p4_m3": "<code>len()</code> calculates the total characters in <code>full_status</code>.",
            "putting_together_p5_m3": "<code>[]</code> is used with index <code>0</code> to get the first character ('D') from <code>core_message</code>.",
            "tooltip_concat": "Joins strings together (Concatenation). Remember to add spaces if needed!", "tooltip_multiply": "Repeats a string a specified number of times.", "tooltip_len": "Returns the number of characters in the string passed to it.", "tooltip_index": "Accesses a character at a specific position (index). Starts from 0! `[0]` gets the very first character.",
            "quiz_title": "üß† Quick Check!", "quiz_next_button": "Next Question",
            "quiz_q1_m3": "What is the result of `'Py' + 'thon'`?",
            "quiz_q1_m3_opt1": "`'Python'`", "quiz_q1_m3_opt2": "`'Py thon'`", "quiz_q1_m3_opt3": "An error", "quiz_q1_m3_opt4": "`'Py+thon'`",
            "quiz_q2_m3": "What does `'AI' * 3` produce?",
            "quiz_q2_m3_opt1": "`'AI AI AI'`", "quiz_q2_m3_opt2": "An error", "quiz_q2_m3_opt3": "`'AI3'`", "quiz_q2_m3_opt4": "`'AIAIAI'`",
            "quiz_q3_m3": "What would `len('Hello!')` return?",
            "quiz_q3_m3_opt1": "5", "quiz_q3_m3_opt2": "6", "quiz_q3_m3_opt3": "7", "quiz_q3_m3_opt4": "An error",
            "quiz_q4_m3": "If `word = 'Robot'`, what is `word[0]`?",
            "quiz_q4_m3_opt1": "`'R'`", "quiz_q4_m3_opt2": "`'o'`", "quiz_q4_m3_opt3": "`'t'`", "quiz_q4_m3_opt4": "An error",
            "quiz_feedback_correct": "Correct! üéâ", "quiz_feedback_incorrect": "Not quite! The correct answer was: {correctAnswerText}",
            "quiz_final_score_title": "Module 3 Complete!", "quiz_final_score_summary": "You answered {score} out of {total} questions correctly.",
            "quiz_final_score_perfect": "Excellent! You're mastering string manipulation.", "quiz_final_score_good": "Solid work! Keep practicing these text operations.",
            "completion_theory_title_m3": "Module 3 Theory Complete!",
            "completion_theory_desc_m3": "Fantastic! You now know the basics of manipulating strings in Python. This is fundamental for any AI task involving text. <br> Time to practice these skills! Head to the <strong>Practice Zone</strong> or the <strong>Advanced Practice</strong> for Module 3."
        },
        pt: {
            "page_title": "M√≥dulo 3: Trabalhando com Texto (Strings)",
            "nav_practice": "Iniciar Pr√°tica",
            "nav_advanced": "Pr√°tica Avan√ßada",
            "nav_menu": "Menu do Curso",
            "nav_welcome_m3": "Boas-vindas M3", "nav_string_ops": "Combinar/Repetir", "nav_len_index": "Tamanho/Acesso", "nav_putting_together": "Em A√ß√£o", "nav_quiz": "Teste R√°pido",
            "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá",
            "header_title_m3": "M√≥dulo 3: Trabalhando com Texto (Strings)", "header_subtitle_m3": "Combinando, repetindo, medindo e acessando partes de dados textuais.",
            "welcome_title_m3": "üìù Manipulando Texto",
            "welcome_p1_m3": "Bem-vindo ao M√≥dulo 3! Texto est√° por toda parte em IA ‚Äì desde comandos de usu√°rio e respostas de chatbot at√© artigos que analisamos (Processamento de Linguagem Natural) e r√≥tulos para dados. Python facilita a manipula√ß√£o de dados textuais, chamados strings.",
            "welcome_p2_m3": "Neste m√≥dulo, aprenderemos como juntar strings, repeti-las, descobrir seu tamanho e selecionar caracteres espec√≠ficos. Vamos come√ßar!",
            "string_ops_title": "üîó Combinando & Repetindo Strings", "string_ops_subtitle": "Duas maneiras comuns de construir novas strings a partir das existentes.",
            "op_concat_title": "Concatena√ß√£o (+)", "op_concat_text": "Unir strings ponta a ponta usando o sinal de mais.", "op_concat_example": "<code>\"IA\" + \" \" + \"Manda\"</code><br>‚û°Ô∏è <code>\"IA Manda\"</code>",
            "op_repeat_title": "Multiplica√ß√£o (*)", "op_repeat_text": "Repetir uma string um certo n√∫mero de vezes.", "op_repeat_example": "<code>\"Vai! \" * 3</code><br>‚û°Ô∏è <code>\"Vai! Vai! Vai! \"</code>",
            "string_ops_conclusion": "Esses operadores nos permitem construir dinamicamente mensagens de texto, separadores e muito mais.",
            "info_access_title": "üìè Medindo & Acessando Caracteres", "info_access_subtitle": "Encontrando o comprimento e obtendo caracteres individuais.",
            "info_len_title": "Encontrando Comprimento (len())", "info_len_text": "A fun√ß√£o embutida <code>len()</code> informa quantos caracteres existem em uma string (incluindo espa√ßos).", "info_len_example": "<code>len(\"Ol√° IA\")</code> ‚û°Ô∏è <code>6</code>",
            "info_index_title": "Acessando Caracteres (Indexa√ß√£o [])", "info_index_text": "Use colchetes <code>[]</code> com um n√∫mero (o √≠ndice) para obter o caractere naquela posi√ß√£o. <strong>Importante:</strong> A indexa√ß√£o come√ßa em <span class=\"zero-based-highlight\">0</span>!", "info_index_zero_based": "Importante:", "info_index_example": "<code>modelo = \"GPT-4\"</code><br><code>modelo[0]</code> ‚û°Ô∏è <code>'G'</code> (Primeiro caractere)<br><code>modelo[2]</code> ‚û°Ô∏è <code>'T'</code> (Terceiro caractere)",
            "info_access_conclusion": "Saber o comprimento e acessar partes espec√≠ficas √© crucial para analisar e processar texto.",
            "putting_together_title_m3": "‚öôÔ∏è Opera√ß√µes de Texto em A√ß√£o", "putting_together_subtitle_m3": "Vamos combinar esses conceitos para trabalhar com uma mensagem relacionada √† IA.",
            "concat_comment": "# Combina prefixo, um espa√ßo e a mensagem", "repeat_comment": "# Cria uma linha separadora", "len_comment": "# Encontra o comprimento do status completo", "index_comment": "# Pega o primeiro caractere da mensagem principal",
            "putting_together_p1_m3": "Come√ßamos com duas strings, <code>prefixo</code> e <code>mensagem_principal</code>.",
            "putting_together_p2_m3": "O operador <code>+</code> as combina com um espa√ßo no meio para criar <code>status_completo</code>.",
            "putting_together_p3_m3": "O operador <code>*</code> cria uma linha <code>separador</code> repetindo a string \"=\".",
            "putting_together_p4_m3": "<code>len()</code> calcula o total de caracteres em <code>status_completo</code>.",
            "putting_together_p5_m3": "<code>[]</code> √© usado com o √≠ndice <code>0</code> para obter o primeiro caractere ('D') de <code>mensagem_principal</code>.",
            "tooltip_concat": "Junta strings (Concatena√ß√£o). Lembre-se de adicionar espa√ßos se necess√°rio!", "tooltip_multiply": "Repete uma string um n√∫mero espec√≠fico de vezes.", "tooltip_len": "Retorna o n√∫mero de caracteres na string passada para ela.", "tooltip_index": "Acessa um caractere em uma posi√ß√£o espec√≠fica (√≠ndice). Come√ßa em 0! `[0]` pega o primeiro caractere.",
            "quiz_title": "üß† Teste R√°pido!", "quiz_next_button": "Pr√≥xima Pergunta",
            "quiz_q1_m3": "Qual o resultado de `'Py' + 'thon'`?",
            "quiz_q1_m3_opt1": "`'Python'`", "quiz_q1_m3_opt2": "`'Py thon'`", "quiz_q1_m3_opt3": "Um erro", "quiz_q1_m3_opt4": "`'Py+thon'`",
            "quiz_q2_m3": "O que `'AI' * 3` produz?",
            "quiz_q2_m3_opt1": "`'AI AI AI'`", "quiz_q2_m3_opt2": "Um erro", "quiz_q2_m3_opt3": "`'AI3'`", "quiz_q2_m3_opt4": "`'AIAIAI'`",
            "quiz_q3_m3": "O que `len('Ol√°!')` retornaria?",
            "quiz_q3_m3_opt1": "3", "quiz_q3_m3_opt2": "4", "quiz_q3_m3_opt3": "5", "quiz_q3_m3_opt4": "Um erro",
            "quiz_q4_m3": "Se `palavra = 'Robo'`, qual √© `palavra[0]`?",
            "quiz_q4_m3_opt1": "`'R'`", "quiz_q4_m3_opt2": "`'o'`", "quiz_q4_m3_opt3": "`'b'`", "quiz_q4_m3_opt4": "Um erro",
            "quiz_feedback_correct": "Correto! üéâ", "quiz_feedback_incorrect": "N√£o foi bem assim! A resposta correta era: {correctAnswerText}",
            "quiz_final_score_title": "M√≥dulo 3 Completo!", "quiz_final_score_summary": "Voc√™ respondeu {score} de {total} perguntas corretamente.",
            "quiz_final_score_perfect": "Excelente! Voc√™ est√° dominando a manipula√ß√£o de strings.", "quiz_final_score_good": "Bom trabalho! Continue praticando essas opera√ß√µes de texto.",
            "completion_theory_title_m3": "Teoria do M√≥dulo 3 Completa!",
            "completion_theory_desc_m3": "Fant√°stico! Agora voc√™ conhece o b√°sico da manipula√ß√£o de strings em Python. Isso √© fundamental para qualquer tarefa de IA envolvendo texto. <br> Hora de praticar essas habilidades! V√° para a <strong>Zona de Pr√°tica</strong> ou a <strong>Pr√°tica Avan√ßada</strong> do M√≥dulo 3."
        },
        zh: {
            "page_title": "Ê®°Âùó 3ÔºöÂ§ÑÁêÜÊñáÊú¨ (Â≠óÁ¨¶‰∏≤)",
            "nav_practice": "ÂºÄÂßãÁªÉ‰π†",
            "nav_advanced": "È´òÁ∫ßÁªÉ‰π†",
            "nav_menu": "ËØæÁ®ãËèúÂçï",
            "nav_welcome_m3": "Ê¨¢Ëøé M3", "nav_string_ops": "ÁªÑÂêà/ÈáçÂ§ç", "nav_len_index": "ÈïøÂ∫¶/ËÆøÈóÆ", "nav_putting_together": "ÂÆûË∑µ", "nav_quiz": "Áü•ËØÜÊµãÈ™å",
            "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá",
            "header_title_m3": "Ê®°Âùó 3ÔºöÂ§ÑÁêÜÊñáÊú¨ (Â≠óÁ¨¶‰∏≤)", "header_subtitle_m3": "ÁªÑÂêà„ÄÅÈáçÂ§ç„ÄÅÊµãÈáèÂíåËÆøÈóÆÊñáÊú¨Êï∞ÊçÆÈÉ®ÂàÜ„ÄÇ",
            "welcome_title_m3": "üìù Êìç‰ΩúÊñáÊú¨",
            "welcome_p1_m3": "Ê¨¢ËøéÊù•Âà∞Ê®°Âùó 3ÔºÅÊñáÊú¨Âú®‰∫∫Â∑•Êô∫ËÉΩ‰∏≠Êó†Â§Ñ‰∏çÂú®‚Äî‚Äî‰ªéÁî®Êà∑ÂëΩ‰ª§ÂíåËÅäÂ§©Êú∫Âô®‰∫∫ÂìçÂ∫îÂà∞Êàë‰ª¨ÂàÜÊûêÁöÑÊñáÁ´†ÔºàËá™ÁÑ∂ËØ≠Ë®ÄÂ§ÑÁêÜÔºâÂíåÊï∞ÊçÆÊ†áÁ≠æ„ÄÇPython ÂèØ‰ª•ËΩªÊùæÂú∞Êìç‰ΩúÁß∞‰∏∫Â≠óÁ¨¶‰∏≤ÁöÑÊñáÊú¨Êï∞ÊçÆ„ÄÇ",
            "welcome_p2_m3": "Âú®Êú¨Ê®°Âùó‰∏≠ÔºåÊàë‰ª¨Â∞ÜÂ≠¶‰π†Â¶Ç‰ΩïËøûÊé•Â≠óÁ¨¶‰∏≤„ÄÅÈáçÂ§çÂ≠óÁ¨¶‰∏≤„ÄÅÊâæÂá∫ÂÆÉ‰ª¨ÁöÑÈïøÂ∫¶‰ª•ÂèäÈÄâÂèñÁâπÂÆöÂ≠óÁ¨¶„ÄÇËÆ©Êàë‰ª¨ÂºÄÂßãÂêßÔºÅ",
            "string_ops_title": "üîó ÁªÑÂêà‰∏éÈáçÂ§çÂ≠óÁ¨¶‰∏≤", "string_ops_subtitle": "‰∏§Áßç‰ªéÁé∞ÊúâÂ≠óÁ¨¶‰∏≤ÊûÑÂª∫Êñ∞Â≠óÁ¨¶‰∏≤ÁöÑÂ∏∏Áî®ÊñπÊ≥ï„ÄÇ",
            "op_concat_title": "ËøûÊé• (+)", "op_concat_text": "‰ΩøÁî®Âä†Âè∑Â∞ÜÂ≠óÁ¨¶‰∏≤Á´ØÂà∞Á´ØËøûÊé•Ëµ∑Êù•„ÄÇ", "op_concat_example": "<code>\"AI\" + \" \" + \"ËßÑÂàô\"</code><br>‚û°Ô∏è <code>\"AI ËßÑÂàô\"</code>",
            "op_repeat_title": "‰πòÊ≥ï (*)", "op_repeat_text": "Â∞ÜÂ≠óÁ¨¶‰∏≤ÈáçÂ§çÁâπÂÆöÊ¨°Êï∞„ÄÇ", "op_repeat_example": "<code>\"Âä†Ê≤πÔºÅ\" * 3</code><br>‚û°Ô∏è <code>\"Âä†Ê≤πÔºÅÂä†Ê≤πÔºÅÂä†Ê≤πÔºÅ\"</code>",
            "string_ops_conclusion": "Ëøô‰∫õËøêÁÆóÁ¨¶‰ΩøÊàë‰ª¨ËÉΩÂ§üÂä®ÊÄÅÊûÑÂª∫ÊñáÊú¨Ê∂àÊÅØ„ÄÅÂàÜÈöîÁ¨¶Á≠â„ÄÇ",
            "info_access_title": "üìè ÊµãÈáè‰∏éËÆøÈóÆÂ≠óÁ¨¶", "info_access_subtitle": "Êü•ÊâæÈïøÂ∫¶ÂíåËé∑ÂèñÂçï‰∏™Â≠óÁ¨¶„ÄÇ",
            "info_len_title": "Êü•ÊâæÈïøÂ∫¶ (len())", "info_len_text": "ÂÜÖÁΩÆÂáΩÊï∞ <code>len()</code> ÂëäËØâ‰Ω†‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤‰∏≠ÊúâÂ§öÂ∞ë‰∏™Â≠óÁ¨¶ÔºàÂåÖÊã¨Á©∫Ê†ºÔºâ„ÄÇ", "info_len_example": "<code>len(\"‰Ω†Â•Ω AI\")</code> ‚û°Ô∏è <code>6</code>",
            "info_index_title": "ËÆøÈóÆÂ≠óÁ¨¶ (Á¥¢Âºï [])", "info_index_text": "‰ΩøÁî®ÊñπÊã¨Âè∑ <code>[]</code> Âíå‰∏Ä‰∏™Êï∞Â≠óÔºàÁ¥¢ÂºïÔºâÊù•Ëé∑ÂèñËØ•‰ΩçÁΩÆÁöÑÂ≠óÁ¨¶„ÄÇ<strong>ÈáçË¶ÅÊèêÁ§∫Ôºö</strong> Á¥¢Âºï‰ªé <span class=\"zero-based-highlight\">0</span> ÂºÄÂßãÔºÅ", "info_index_zero_based": "ÈáçË¶ÅÊèêÁ§∫Ôºö", "info_index_example": "<code>Ê®°Âûã = \"GPT-4\"</code><br><code>Ê®°Âûã[0]</code> ‚û°Ô∏è <code>'G'</code> (Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶)<br><code>Ê®°Âûã[2]</code> ‚û°Ô∏è <code>'T'</code> (Á¨¨‰∏â‰∏™Â≠óÁ¨¶)",
            "info_access_conclusion": "‰∫ÜËß£ÈïøÂ∫¶ÂíåËÆøÈóÆÁâπÂÆöÈÉ®ÂàÜÂØπ‰∫éÂàÜÊûêÂíåÂ§ÑÁêÜÊñáÊú¨Ëá≥ÂÖ≥ÈáçË¶Å„ÄÇ",
            "putting_together_title_m3": "‚öôÔ∏è ÊñáÊú¨Êìç‰ΩúÂÆûÊàò", "putting_together_subtitle_m3": "ËÆ©Êàë‰ª¨ÁªìÂêàËøô‰∫õÊ¶ÇÂøµÊù•Â§ÑÁêÜ‰∏Ä‰∏™‰∏é AI Áõ∏ÂÖ≥ÁöÑÊ∂àÊÅØ„ÄÇ",
            "concat_comment": "# ÁªÑÂêàÂâçÁºÄ„ÄÅ‰∏Ä‰∏™Á©∫Ê†ºÂíåÊ∂àÊÅØ", "repeat_comment": "# ÂàõÂª∫‰∏Ä‰∏™ÂàÜÈöîË°å", "len_comment": "# Êü•ÊâæÂÆåÊï¥Áä∂ÊÄÅÁöÑÈïøÂ∫¶", "index_comment": "# Ëé∑ÂèñÊ†∏ÂøÉÊ∂àÊÅØÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶",
            "putting_together_p1_m3": "Êàë‰ª¨‰ªé‰∏§‰∏™Â≠óÁ¨¶‰∏≤ÂºÄÂßãÔºå`prefix` Âíå `core_message`„ÄÇ",
            "putting_together_p2_m3": "<code>+</code> ËøêÁÆóÁ¨¶Â∞ÜÂÆÉ‰ª¨‰∏é‰∏Ä‰∏™Á©∫Ê†ºËøûÊé•Ëµ∑Êù•ÔºåÂàõÂª∫ `full_status`„ÄÇ",
            "putting_together_p3_m3": "<code>*</code> ËøêÁÆóÁ¨¶ÈÄöËøáÈáçÂ§ç \"=\" Â≠óÁ¨¶‰∏≤Êù•ÂàõÂª∫ `separator` Ë°å„ÄÇ",
            "putting_together_p4_m3": "<code>len()</code> ËÆ°ÁÆó `full_status` ‰∏≠ÁöÑÊÄªÂ≠óÁ¨¶Êï∞„ÄÇ",
            "putting_together_p5_m3": "‰ΩøÁî®Á¥¢Âºï <code>0</code> ÁöÑ <code>[]</code> Êù•Ëé∑Âèñ `core_message` ÁöÑÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶Ôºà'D'Ôºâ„ÄÇ",
            "tooltip_concat": "Â∞ÜÂ≠óÁ¨¶‰∏≤ËøûÊé•Âú®‰∏ÄËµ∑ÔºàËøûÊé•Ôºâ„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÔºåËÆ∞ÂæóÊ∑ªÂä†Á©∫Ê†ºÔºÅ", "tooltip_multiply": "Â∞ÜÂ≠óÁ¨¶‰∏≤ÈáçÂ§çÊåáÂÆöÁöÑÊ¨°Êï∞„ÄÇ", "tooltip_len": "ËøîÂõû‰º†ÈÄíÁªôÂÆÉÁöÑÂ≠óÁ¨¶‰∏≤‰∏≠ÁöÑÂ≠óÁ¨¶Êï∞„ÄÇ", "tooltip_index": "ËÆøÈóÆÁâπÂÆö‰ΩçÁΩÆÔºàÁ¥¢ÂºïÔºâÂ§ÑÁöÑÂ≠óÁ¨¶„ÄÇ‰ªé 0 ÂºÄÂßãÔºÅ`[0]` Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶„ÄÇ",
            "quiz_title": "üß† Âø´ÈÄüÊµãÈ™åÔºÅ", "quiz_next_button": "‰∏ã‰∏ÄÈ¢ò",
            "quiz_q1_m3": "`'Py' + 'thon'` ÁöÑÁªìÊûúÊòØ‰ªÄ‰πàÔºü",
            "quiz_q1_m3_opt1": "`'Python'`", "quiz_q1_m3_opt2": "`'Py thon'`", "quiz_q1_m3_opt3": "‰∏Ä‰∏™ÈîôËØØ", "quiz_q1_m3_opt4": "`'Py+thon'`",
            "quiz_q2_m3": "`'AI' * 3` ‰ºö‰∫ßÁîü‰ªÄ‰πàÔºü",
            "quiz_q2_m3_opt1": "`'AI AI AI'`", "quiz_q2_m3_opt2": "‰∏Ä‰∏™ÈîôËØØ", "quiz_q2_m3_opt3": "`'AI3'`", "quiz_q2_m3_opt4": "`'AIAIAI'`",
            "quiz_q3_m3": "`len('‰Ω†Â•ΩÔºÅ')` ‰ºöËøîÂõû‰ªÄ‰πàÔºü", // Note: Chinese characters count as 1 each
            "quiz_q3_m3_opt1": "2", "quiz_q3_m3_opt2": "3", "quiz_q3_m3_opt3": "4", "quiz_q3_m3_opt4": "‰∏Ä‰∏™ÈîôËØØ",
            "quiz_q4_m3": "Â¶ÇÊûú `word = 'Robot'`ÔºåÈÇ£‰πà `word[0]` ÊòØ‰ªÄ‰πàÔºü",
            "quiz_q4_m3_opt1": "`'R'`", "quiz_q4_m3_opt2": "`'o'`", "quiz_q4_m3_opt3": "`'t'`", "quiz_q4_m3_opt4": "‰∏Ä‰∏™ÈîôËØØ",
            "quiz_feedback_correct": "Ê≠£Á°ÆÔºÅüéâ", "quiz_feedback_incorrect": "‰∏çÂ§™ÂØπÂì¶ÔºÅÊ≠£Á°ÆÁ≠îÊ°àÊòØÔºö{correctAnswerText}",
            "quiz_final_score_title": "Ê®°Âùó 3 ÂÆåÊàêÔºÅ", "quiz_final_score_summary": "‰Ω†Á≠îÂØπ‰∫Ü {score} / {total} È¢ò„ÄÇ",
            "quiz_final_score_perfect": "Â§™Ê£í‰∫ÜÔºÅ‰Ω†Ê≠£Âú®ÊéåÊè°Â≠óÁ¨¶‰∏≤Êìç‰Ωú„ÄÇ", "quiz_final_score_good": "ÂÅöÂæó‰∏çÈîôÔºÅÁªßÁª≠ÁªÉ‰π†Ëøô‰∫õÊñáÊú¨Êìç‰Ωú„ÄÇ",
            "completion_theory_title_m3": "Ê®°Âùó 3 ÁêÜËÆ∫ÂÆåÊàêÔºÅ",
            "completion_theory_desc_m3": "Â§™Ê£í‰∫ÜÔºÅÊÇ®Áé∞Âú®‰∫ÜËß£‰∫ÜÂú® Python ‰∏≠Êìç‰ΩúÂ≠óÁ¨¶‰∏≤ÁöÑÂü∫Á°ÄÁü•ËØÜ„ÄÇËøôÂØπ‰∫é‰ªª‰ΩïÊ∂âÂèäÊñáÊú¨ÁöÑ AI ‰ªªÂä°ÈÉΩËá≥ÂÖ≥ÈáçË¶Å„ÄÇ<br> ÊòØÊó∂ÂÄôÁªÉ‰π†Ëøô‰∫õÊäÄËÉΩ‰∫ÜÔºÅÂâçÂæÄÊ®°Âùó 3 ÁöÑ<strong>ÁªÉ‰π†Âå∫</strong>Êàñ<strong>È´òÁ∫ßÁªÉ‰π†</strong>„ÄÇ"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions ---
        function getStoredLanguage() { /* ... (same as previous modules) ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
         }

        function setLanguage(lang) { /* ... (same as previous modules) ... */
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             if(quizArea && currentQuestionIndex < quizData.length) {
                 if (!quizArea.querySelector('[data-translate="quiz_final_score_title"]')) {
                    loadQuestion();
                 }
             }
         }

        function getTranslation(key, lang, replacements = {}) { /* ... (same as previous modules) ... */
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }


        function translatePage(lang) { /* ... (same, handles code tags, tooltips, specific comments) ... */
             if (!translations[lang]) lang = 'en';

             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 let translation = getTranslation(key, lang);

                  if (el.tagName === 'TITLE') { document.title = translation; }
                  else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Skip placeholders */ }
                  else if (el.tagName === 'OPTION') { el.textContent = translation; }
                  else {
                       // Allow HTML in certain elements (e.g., code examples in analogies/info cards)
                       if ((el.classList.contains('op-example') || el.classList.contains('info-example') || el.closest('.text-explanation') || el.closest('.info-details') || el.closest('.op-part')) && translation.includes('<')) {
                          el.innerHTML = translation;
                       } else if (translation.includes('<') && translation.includes('>')) { // General safe innerHTML use
                           el.innerHTML = translation;
                       }
                       else {
                          el.textContent = translation;
                       }
                  }
             });

             document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                 const key = el.getAttribute('data-translate-placeholder');
                 el.setAttribute('placeholder', getTranslation(key, lang));
             });

              document.querySelectorAll('.code-highlight').forEach(el => {
                  const tooltipKey = el.getAttribute('data-translate-tooltip');
                  const tooltipSpan = el.querySelector('.tooltip');
                  if(tooltipSpan && tooltipKey) {
                     // Use innerHTML for tooltips to allow code tags if needed
                     tooltipSpan.innerHTML = getTranslation(tooltipKey, lang);
                  }
              });

               document.querySelectorAll('.code-comment[data-translate]').forEach(commentSpan => {
                   const key = commentSpan.getAttribute('data-translate');
                   const translatedText = getTranslation(key, lang);
                   const commentContent = translatedText.substring(translatedText.indexOf('#') + 1).trim();
                   commentSpan.textContent = ' # ' + commentContent;
               });
        }

        // --- Initialize Language ---
        const initialLang = getStoredLanguage();


        // --- Minimal Nav Logic ---
        /* ... (same as previous modules) ... */
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;

        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
            document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target)) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
            document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });
        }


        // --- Intersection Observer for Animations ---
        /* ... (targets .op-part, .info-card) ... */
         const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
         const observerCallback = (entries, observer) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); } }); };
         const observer = new IntersectionObserver(observerCallback, observerOptions);
         document.querySelectorAll('.op-part, .info-card').forEach(el => { observer.observe(el); });


        // --- Feature Card Interactivity (Not needed for Module 3 cards) ---


        // --- Text Demo Output Simulation ---
        const codeOutputArea = document.querySelector('#putting-it-together-m3 .code-output-area'); // Updated selector
        if (codeOutputArea) {
             const codeObserver = new IntersectionObserver((entries) => {
                 entries.forEach(entry => {
                     if (entry.isIntersecting && !codeOutputArea.classList.contains('visible')) {
                        setTimeout(() => {
                            // Simulate the output based on the Module 3 code
                            const separator = "=".repeat(20);
                            const full_status = "Status: Data Processed";
                            const status_length = full_status.length;
                            const first_char_core = "Data Processed"[0];

                            codeOutputArea.innerHTML = `
                                > ${separator}<br>
                                > ${full_status}<br>
                                > Length: ${status_length}<br>
                                > First char of core: ${first_char_core}<br>
                                > ${separator}
                            `;
                            codeOutputArea.classList.add('visible');
                        }, 1500); // Adjusted delay
                        codeObserver.unobserve(entry.target);
                     }
                 });
             }, { threshold: 0.4 });
             codeObserver.observe(document.querySelector('.text-demo')); // Updated selector
        }


        // --- Tooltip Setup (CSS Hover handles this) ---


        // --- Knowledge Check / Quiz ---
        // UPDATED quizData for Module 3
        const quizData = [
            { questionKey: "quiz_q1_m3", optionKeys: ["quiz_q1_m3_opt1", "quiz_q1_m3_opt2", "quiz_q1_m3_opt3", "quiz_q1_m3_opt4"], correctAnswer: 0 },
            { questionKey: "quiz_q2_m3", optionKeys: ["quiz_q2_m3_opt1", "quiz_q2_m3_opt2", "quiz_q2_m3_opt3", "quiz_q2_m3_opt4"], correctAnswer: 3 },
            { questionKey: "quiz_q3_m3", optionKeys: ["quiz_q3_m3_opt1", "quiz_q3_m3_opt2", "quiz_q3_m3_opt3", "quiz_q3_m3_opt4"], correctAnswer: 1 }, // 'Hello!' is 6 chars
            // Adjusting Q3 for Portuguese/Chinese examples if needed or keep English base
            // Portuguese: 'Ol√°!' -> 4 chars
            // Chinese: '‰Ω†Â•ΩÔºÅ' -> 3 chars (assuming UTF-8 count)
            // The English base is used here for simplicity across translations quiz logic
            { questionKey: "quiz_q4_m3", optionKeys: ["quiz_q4_m3_opt1", "quiz_q4_m3_opt2", "quiz_q4_m3_opt3", "quiz_q4_m3_opt4"], correctAnswer: 0 }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        const quizArea = document.getElementById('quiz-area');
        const feedbackArea = document.getElementById('quiz-feedback');
        const nextButton = document.getElementById('next-question-btn');

        function loadQuestion() { /* ... (same logic, uses M3 quizData) ... */
              const currentLang = getStoredLanguage();
              if (!quizArea || currentQuestionIndex >= quizData.length) {
                  if (quizArea && !quizArea.querySelector('[data-translate="quiz_final_score_title"]')) {
                     showFinalScore();
                  }
                  return;
              }

              const currentQuiz = quizData[currentQuestionIndex];
              const questionText = getTranslation(currentQuiz.questionKey, currentLang);
              quizArea.innerHTML = `
                  <div class="quiz-question">${currentQuestionIndex + 1}. ${questionText.replace(/`(.*?)`/g, '<code>$1</code>')}</div>
                  <div class="quiz-options">
                      ${currentQuiz.optionKeys.map((optionKey, index) => `
                          <button class="quiz-option-btn" data-index="${index}">${getTranslation(optionKey, currentLang).replace(/`(.*?)`/g, '<code>$1</code>')}</button>
                      `).join('')}
                  </div>
              `;

              feedbackArea.classList.remove('visible', 'correct', 'incorrect');
              feedbackArea.textContent = '';
              nextButton.classList.remove('visible');
              nextButton.disabled = true;

              document.querySelectorAll('.quiz-option-btn').forEach(button => {
                  button.addEventListener('click', handleAnswer);
              });
        }

        function handleAnswer(event) { /* ... (same logic) ... */
             const currentLang = getStoredLanguage();
             const selectedButton = event.target;
             const selectedIndex = parseInt(selectedButton.dataset.index);
             const correctIndex = quizData[currentQuestionIndex].correctAnswer;
             const correctOptionKey = quizData[currentQuestionIndex].optionKeys[correctIndex];
             // Get raw text for feedback, potentially re-adding code tags
             let correctAnswerText = getTranslation(correctOptionKey, currentLang);
             correctAnswerText = correctAnswerText.replace(/<code>(.*?)<\/code>/g, '$1'); // Remove code tags for feedback if needed, or keep them

             document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('shake');
             });

             feedbackArea.classList.add('visible');

             if (selectedIndex === correctIndex) {
                 selectedButton.classList.add('correct');
                 feedbackArea.innerHTML = getTranslation('quiz_feedback_correct', currentLang);
                 feedbackArea.classList.add('correct');
                 feedbackArea.classList.remove('incorrect');
                 score++;
                 selectedButton.classList.add('tada-anim');
             } else {
                 selectedButton.classList.add('incorrect');
                 // Re-add code tags for display in feedback
                 const formattedCorrectAnswer = getTranslation(correctOptionKey, currentLang).replace(/`(.*?)`/g, '<code>$1</code>');
                 feedbackArea.innerHTML = getTranslation('quiz_feedback_incorrect', currentLang, { correctAnswerText: `<strong>${formattedCorrectAnswer}</strong>` });
                 feedbackArea.classList.add('incorrect');
                 feedbackArea.classList.remove('correct');
                 const correctButton = document.querySelector(`.quiz-option-btn[data-index="${correctIndex}"]`);
                 if(correctButton) correctButton.classList.add('correct');
                 selectedButton.classList.add('shake');
             }

              selectedButton.addEventListener('animationend', () => {
                   selectedButton.classList.remove('tada-anim', 'shake');
              }, { once: true });

             nextButton.classList.add('visible');
             nextButton.disabled = false;
         }

         function showFinalScore() { /* ... (same logic, uses M3 final score keys) ... */
               const currentLang = getStoredLanguage();
               const totalQuestions = quizData.length;
               let resultMessageKey = score === totalQuestions ? 'quiz_final_score_perfect' : 'quiz_final_score_good';

               quizArea.innerHTML = `
                   <div class="quiz-question text-center" data-translate="quiz_final_score_title" style="font-size: 1.5rem;">${getTranslation('quiz_final_score_title', currentLang)}</div>
                   <p class="text-center" style="font-size: 1.2rem; margin-bottom: 1rem;">${getTranslation('quiz_final_score_summary', currentLang, { score: score, total: totalQuestions })}</p>
                   <p class="text-center" style="color: ${score === totalQuestions ? 'var(--success-color)' : 'var(--primary-color)'}; font-weight: bold;">${getTranslation(resultMessageKey, currentLang)}</p>
               `;
               feedbackArea.classList.remove('visible');
               nextButton.style.display = 'none'; // Hide next button
               quizArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
           }


        nextButton.addEventListener('click', () => { /* ... (same) ... */
             currentQuestionIndex++;
             loadQuestion();
         });

        // --- Initial Language Application and Load ---
        setLanguage(initialLang); // Apply language FIRST
        if (quizArea) { loadQuestion(); } // Initial quiz load for M3

        // Trigger fade-in animations for elements initially in view
        /* ... (same as previous modules) ... */
          document.querySelectorAll('.fade-in').forEach(el => {
              const rect = el.getBoundingClientRect();
              if(rect.top < window.innerHeight && rect.bottom >= 0) {
                  // Element is initially visible, CSS animation runs automatically
              }
          });

    }); // End DOMContentLoaded
    </script>

</body>
</html>
