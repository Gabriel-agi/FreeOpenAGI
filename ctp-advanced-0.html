<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 0: Advanced Python Practice! (v2)</title> <!-- Version Update -->
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Same as Basic Practice) --- */
        :root {
            --primary-color: #007bff; /* Primary Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa; /* Very Light Grey */
            --background-medium: #e9ecef; /* Light Grey */
            --background-dark: #343a40; /* Dark Grey/Black */
            --text-light: #f8f9fa; /* Light Text */
            --text-dark: #212529; /* Dark Text */
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --warning-color: #ff9800; /* Orange for warnings/hints */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* --- Utility Classes (Mostly Same) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }

        /* --- Advanced Animations (Same as Basic Practice) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; } .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; } .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Practice Header (Updated Title) --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; }
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; }

        /* --- Practice Section Styling (Same) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Same + Warning Type) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 120px; /* Increased max-height slightly */ margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .feedback-message .fas { margin: 0 3px; }

        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        /* New style for the smaller menu button */
        .action-button.smaller-button {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            background-color: var(--info-color); /* Example: make it teal */
        }
        .action-button.smaller-button:hover:not(:disabled) {
             background-color: #138496; /* Darker teal */
        }


        /* Code styling (Same) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; white-space: pre; /* Preserve line breaks in HTML */ }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; }

        /* --- Activity Specific Styles --- */

        /* Activity 1: Anatomy (Added Scrolling Style) */
        #anatomy-advanced .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #anatomy-advanced .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #anatomy-advanced .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        /* **NEW/MODIFIED** Styles for Explanation Box */
        #anatomy-advanced-explanations {
            max-height: 160px; /* Approx 5 lines + padding */
            overflow-y: auto;
            border: 1px solid var(--background-medium);
            padding: 10px 15px; /* More horizontal padding */
            margin-top: 1.2rem;
            background-color: var(--background-light);
            border-radius: var(--border-radius);
            scroll-behavior: smooth; /* Smooth scroll when new item added */
        }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0; margin-bottom: 8px; /* Spacing between items */ background-color: transparent; } /* Simpler style inside scroll box */
         /* Style the scrollbar (optional, webkit example) */
        #anatomy-advanced-explanations::-webkit-scrollbar { width: 8px; }
        #anatomy-advanced-explanations::-webkit-scrollbar-track { background: var(--background-medium); border-radius: 4px; }
        #anatomy-advanced-explanations::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 4px; }
        #anatomy-advanced-explanations::-webkit-scrollbar-thumb:hover { background: #555; }
        #anatomy-advanced-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* Activity 2: Build-a-Print Advanced (Multiple Lines - Same Style) */
        #build-multi-print .draggable-pieces { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1.5rem; padding: 1rem; background-color: var(--background-light); border: 1px dashed var(--secondary-color); border-radius: var(--border-radius); justify-content: center; user-select: none; -webkit-user-select: none; -ms-user-select: none; }
        .piece { display: inline-block; padding: 8px 12px; background-color: var(--primary-color); color: var(--text-light); border-radius: 4px; cursor: grab; font-family: var(--code-font); font-size: 1rem; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.1s ease, box-shadow var(--transition-speed); border: 1px solid #0056b3; touch-action: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .piece:active { cursor: grabbing; }
        .piece.dragging { opacity: 0.6 !important; transform: scale(1.05) rotate(3deg); position: fixed !important; pointer-events: none !important; z-index: 1000 !important; cursor: grabbing !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .piece.ghosting { opacity: 0.3; }
        .piece[data-type="string"] { background-color: #b17a62; border-color:#9d6c56; }
        .piece[data-type="comment"] { background-color: #5d8f4c; border-color:#4a723d; }
        #multi-drop-zone { min-height: 100px; background-color: var(--background-dark); border: 3px dashed var(--secondary-color); border-radius: var(--border-radius); padding: 15px; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; transition: border-color var(--transition-speed), background-color var(--transition-speed), box-shadow var(--transition-speed); }
        #multi-drop-zone.over { border-color: var(--accent-color); background-color: #495057; box-shadow: inset 0 0 10px rgba(255,193,7,0.2); }
        #multi-drop-zone .piece { cursor: default; margin: 0 2px; touch-action: auto; box-shadow: none; }
        #multi-drop-zone .code-line { display: flex; align-items: center; width: 100%; }
        #multi-drop-zone-placeholder { color: var(--secondary-color); font-style: italic; width: 100%; text-align: center; padding: 10px 0; }

        /* Activity 3: Advanced Simulator (Same Style) */
        #adv-code-simulator .sim-editor { width: 100%; min-height: 120px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #adv-code-simulator .sim-output-area { margin-top: 1rem; min-height: 80px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #adv-code-simulator .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #adv-code-simulator .sim-output-area .output-line { display: block; }
        #adv-code-simulator .sim-output-area .output-line.error { color: var(--error-color); font-weight: bold; }
        /* Style for example <pre> tag */
        .example-output pre {
             background: var(--background-medium); padding: 10px; border-radius: 4px;
             display: inline-block; margin-top: 10px; color: var(--text-dark);
             font-family: var(--code-font); font-size: 0.95em; line-height: 1.4;
             border: 1px solid #ccc; white-space: pre; /* Ensure line breaks are shown */
        }


        /* Activity 4: Spot the Tricky Comment (Same styling as basic) */
         .code-line-container { display: flex; align-items: center; margin-bottom: 8px; position: relative; }
         .feedback-icon-placeholder { width: 30px; height: 24px; margin-right: 10px; display: inline-flex; align-items: center; justify-content: center; transition: opacity var(--transition-speed); opacity: 0; font-size: 1.2rem; }
         .feedback-icon-placeholder.visible { opacity: 1; }
         #spot-tricky-comment .code-line-check { flex-grow: 1; background-color: var(--background-dark); color: var(--text-light); padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), border-left-color var(--transition-speed); font-family: var(--code-font); border-left: 4px solid transparent; user-select: none; -webkit-user-select: none; }
         #spot-tricky-comment .code-line-check:hover { background-color: #495057; transform: translateX(3px); }
         #spot-tricky-comment .code-line-check.selected-visual { background-color: var(--selection-highlight-bg); border-left-color: var(--selection-highlight-border); color: var(--text-dark); }
         #spot-tricky-comment .code-line-check.checked-state { cursor: default; }
         .feedback-icon-placeholder .fa-check { color: var(--success-color); animation: iconAppearCorrect 0.5s ease-out forwards; }
         .feedback-icon-placeholder .fa-times { color: var(--error-color); animation: iconAppearIncorrect 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
         .feedback-icon-placeholder .fa-eye { color: var(--accent-color); animation: iconAppearMissed 0.4s ease-in forwards; opacity: 0; }
         #reset-tricky-comment-btn { margin-left: 10px; }

        /* Activity 5: Code Correction (Same Style) */
        #code-correction .correction-item { margin-bottom: 2rem; border: 1px solid #ddd; padding: 1.5rem; border-radius: var(--border-radius); background-color: var(--background-light); }
        #code-correction h4 { margin-bottom: 0.5rem; color: var(--primary-color); }
        #code-correction .broken-code { background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 1rem; font-family: var(--code-font); border: 1px solid #f5c6cb; white-space: pre; }
        #code-correction .correction-editor { width: 100%; min-height: 60px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 0.5rem; }
        .correction-status { font-weight: bold; margin-left: 10px; }
        .correction-status .fa-check { color: var(--success-color); }
        .correction-status .fa-times { color: var(--error-color); }
        .correction-status .fa-question-circle { color: var(--secondary-color); }

        /* Activity 6: Output Prediction (Updated <pre> style) */
        #output-prediction .prediction-item { margin-bottom: 2rem; border: 1px solid #ddd; padding: 1.5rem; border-radius: var(--border-radius); background-color: var(--background-light); }
        #output-prediction h4 { margin-bottom: 0.5rem; color: var(--primary-color); }
        #output-prediction .code-to-predict { margin-bottom: 1.5rem; } /* Uses .code-block styling */
        #output-prediction .options-label { font-weight: bold; display: block; margin-bottom: 0.8rem; }
        #output-prediction .prediction-option { margin-bottom: 0.8rem; display: block; cursor: pointer; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc; transition: background-color 0.2s, border-color 0.2s; }
        #output-prediction .prediction-option input[type="radio"] { margin-right: 10px; vertical-align: middle; }
        #output-prediction .prediction-option:hover { background-color: #f0f0f0; }
        #output-prediction .prediction-option input[type="radio"]:checked + span { font-weight: bold; color: var(--primary-color); }
        /* **UPDATED** Style output options <pre> */
        #output-prediction .prediction-option pre {
            display: inline-block; background-color: #f1f1f1;
            padding: 5px 8px; border-radius: 3px; font-size: 0.95em;
            color: var(--text-dark); vertical-align: middle;
            white-space: pre; /* Display line breaks correctly */
            line-height: 1.4; margin: 0;
        }

        /* Activity 7: Advanced Mini Missions (Same Style, updated <pre>) */
        #adv-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; animation: iconAppearCorrect 0.6s ease-out; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        #adv-mini-missions .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #adv-mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        /* Style for example <pre> tag in mission description */
        #adv-mini-missions .mission pre {
             background: var(--background-medium); padding: 8px; border-radius: 4px;
             display: inline-block; margin: 5px 0; color: var(--text-dark);
             font-family: var(--code-font); font-size: 0.95em; line-height: 1.4;
             border: 1px solid #ccc; white-space: pre; /* Ensure line breaks are shown */
        }

        /* --- Final Section (Adjusted Links/Text) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Adjustments for smaller button if needed) --- */
        @media (max-width: 768px) { html { font-size: 15px; } .practice-header h1 { font-size: 2.2rem; } .practice-section h2 { font-size: 1.6rem; } .interactive-area { padding: 1.5rem; } .piece { padding: 6px 10px; font-size: 0.95rem; } #multi-drop-zone { min-height: 80px; padding: 10px; } .feedback-icon-placeholder { width: 25px; margin-right: 8px; font-size: 1.1rem;} .button-group { flex-direction: column; align-items: center; } }
        @media (max-width: 480px) { html { font-size: 14px; } .practice-header h1 { font-size: 1.8rem; } .practice-header p { font-size: 1rem; } .practice-section h2 { font-size: 1.4rem; } .interactive-area { padding: 1rem; } .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;} #adv-code-simulator .sim-editor, #adv-code-simulator .sim-output-area { font-size: 0.9rem; } #spot-tricky-comment .code-line-check { padding: 8px 12px; font-size: 0.9rem;} #adv-mini-missions .mission-editor { min-height: 90px; font-size: 0.95rem;} #adv-mini-missions .mission-output { font-size: 0.95rem;} .feedback-icon-placeholder { width: 20px; margin-right: 5px; font-size: 1rem;} .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; } #code-correction .correction-item { padding: 1rem; } #output-prediction .prediction-item { padding: 1rem; } /* Ensure smaller button still looks okay */ .action-button.smaller-button { padding: 0.5rem 1rem; font-size: 0.85rem; } }

    </style>
</head>
<body>

    <header class="practice-header">
        <i class="fas fa-rocket header-icon icon1"></i>
        <i class="fas fa-cogs header-icon icon2"></i>
        <div class="container">
            <h1>Module 0: Advanced Practice</h1>
            <p>You've grasped the basics. Let's solidify your understanding with more challenging tasks!</p>
        </div>
    </header>

    <main>
        <!-- ========= Activity 1: Anatomy Revisited ========= -->
        <section id="anatomy-advanced" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-search-plus"></i> Anatomy Revisited</h2>
                 <p class="section-description fade-in delay-1">
                     Let's look closer. This code uses `print()` multiple times, including one to create a blank line. Click each highlighted part to identify its role. The explanations will appear below (scroll if needed!).
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
<span class="code-part" data-part="comment1" title="Click to identify"><span class="code-comment"># First, greet the user</span></span>
<span class="code-part" data-part="function1" title="Click to identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open1" title="Click to identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="string1" title="Click to identify"><span class="code-string">"Welcome, Master Coder!"</span></span><!--
--><span class="code-part" data-part="paren-close1" title="Click to identify"><span class="code-paren">)</span></span>
<span class="code-part" data-part="function2" title="Click to identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open2" title="Click to identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="paren-close2" title="Click to identify"><span class="code-paren">)</span></span><!-- no space here is fine
--> <span class="code-part" data-part="comment2" title="Click to identify"><span class="code-comment"># Print a blank line for spacing</span></span>
<span class="code-part" data-part="function3" title="Click to identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open3" title="Click to identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="string2" title="Click to identify"><span class="code-string">"Let's begin."</span></span><!--
--><span class="code-part" data-part="paren-close3" title="Click to identify"><span class="code-paren">)</span></span>
                     </div>
                     <!-- **MODIFIED** Explanation Div for Scrolling -->
                     <div id="anatomy-advanced-explanations">
                         <!-- Explanations added by JS here -->
                     </div>
                     <!-- **UPDATED** Part Count -->
                     <p id="anatomy-advanced-status">Identify all 13 parts!</p>
                     <div id="anatomy-advanced-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Build Multiple Prints ========= -->
        <section id="build-multi-print" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-stream"></i> Build Multiple Print Statements</h2>
                 <p class="section-description fade-in delay-1">
                     Drag the pieces to construct <strong>two lines</strong> of Python code in the drop zone below.
                     Line 1 should print: `"AI is powerful."`
                     Line 2 should print: `"Handle with care."`
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="multi-draggable-pieces" class="draggable-pieces">
                         <!-- Pieces populated by JS -->
                     </div>
                     <div id="multi-drop-zone" class="code-font">
                         <span id="multi-drop-zone-placeholder">Drop pieces here to build two lines...</span>
                     </div>
                     <div class="text-center">
                         <button id="check-multi-build-btn" class="action-button">Check My Code</button>
                         <button id="reset-multi-build-btn" class="action-button secondary">Reset</button>
                     </div>
                     <div id="multi-build-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Advanced Code Simulator ========= -->
        <section id="adv-code-simulator" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-terminal"></i> Advanced Code Simulator</h2>
                 <p class="section-description fade-in delay-1">
                     Write Python code in the editor to produce the following output <strong>exactly</strong>, including the blank line between the text lines:
                     <!-- **UPDATED** Removed \n, using actual line breaks -->
                     <div class="example-output"><pre>> Line One
>
> Line Three</pre></div>
                     Use three separate `print()` commands. Add a comment explaining the purpose of the second `print()`.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="adv-sim-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;">Code Editor:</label>
                     <textarea id="adv-sim-editor-input" class="sim-editor" rows="5" placeholder='print("Line One")\n# Comment explaining the next line\nprint()\nprint("Line Three")'></textarea>
                     <div class="text-center">
                          <button id="run-adv-sim-btn" class="action-button">Run Simulation</button>
                     </div>
                     <label for="adv-sim-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;">Simulated Output:</label>
                     <div id="adv-sim-output" class="sim-output-area">
                         <span class="placeholder">Output will appear here...</span>
                     </div>
                     <div id="adv-sim-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4: Spot the Tricky Comment ========= -->
        <section id="spot-tricky-comment" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-user-secret"></i> Spot the Tricky Comment</h2>
                <p class="section-description fade-in delay-1">
                    Comments can be tricky! Click on <strong>all</strong> lines below that are entirely comments or contain a comment at the end. Remember the rules!
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="tricky-comment-lines">
                        <!-- Lines will be generated by JS -->
                    </div>
                     <div class="text-center">
                         <button id="check-tricky-comment-btn" class="action-button">Check Selection</button>
                         <button id="reset-tricky-comment-btn" class="action-button secondary hidden">Try Again</button>
                     </div>
                     <div id="tricky-comment-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 5: Code Correction Challenge ========= -->
        <section id="code-correction" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-wrench"></i> Code Correction Challenge</h2>
                <p class="section-description fade-in delay-1">
                    Uh oh! Spot the errors in each snippet and type the corrected code in the editor below it. Check for typos, missing symbols, and correct `print()` usage.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <!-- Correction Item 1 -->
                    <div class="correction-item" id="correction-1">
                         <h4>Challenge 1: Wrong Function Name</h4>
                         <p>Goal: Print the text "Syntax matters!"</p>
                         <div class="broken-code">prnt("Syntax matters!")</div>
                         <label for="correction-editor-1">Your Correction:</label>
                         <textarea id="correction-editor-1" class="correction-editor" rows="2" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="1">Check Fix 1</button>
                              <span class="correction-status" id="correction-status-1"><i class="fas fa-question-circle"></i></span>
                         </div>
                         <div id="correction-feedback-1" class="feedback-message"></div>
                    </div>
                    <!-- Correction Item 2 -->
                    <div class="correction-item" id="correction-2">
                         <h4>Challenge 2: Missing Parentheses</h4>
                         <p>Goal: Print the text "Python is fun"</p>
                         <div class="broken-code">print "Python is fun"</div> <!-- Python 2 style-like error -->
                         <label for="correction-editor-2">Your Correction:</label>
                         <textarea id="correction-editor-2" class="correction-editor" rows="2" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="2">Check Fix 2</button>
                              <span class="correction-status" id="correction-status-2"><i class="fas fa-question-circle"></i></span>
                         </div>
                          <div id="correction-feedback-2" class="feedback-message"></div>
                    </div>
                     <!-- Correction Item 3 -->
                    <div class="correction-item" id="correction-3">
                         <h4>Challenge 3: Missing Quotes</h4>
                         <p>Goal: Print the text: Hello</p>
                         <div class="broken-code">print(Hello)</div> <!-- Treats Hello as variable -->
                         <label for="correction-editor-3">Your Correction:</label>
                         <textarea id="correction-editor-3" class="correction-editor" rows="2" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="3">Check Fix 3</button>
                               <span class="correction-status" id="correction-status-3"><i class="fas fa-question-circle"></i></span>
                         </div>
                          <div id="correction-feedback-3" class="feedback-message"></div>
                    </div>
                    <div id="correction-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 6: Output Prediction ========= -->
        <section id="output-prediction" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-eye"></i> Output Prediction</h2>
                <p class="section-description fade-in delay-1">
                    Read the Python code snippets carefully. What will each one actually print? Select the correct output. Pay close attention to comments and blank `print()` calls! If you get it wrong, you can try again.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <!-- Prediction Item 1 -->
                    <div class="prediction-item" id="prediction-1" data-correct-option="B">
                         <h4>Prediction 1</h4>
                         <div class="code-to-predict code-block"><span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Step 1"</span><span class="code-paren">)</span>
<span class="code-comment"># Skip Step 2 for now</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Step 3"</span><span class="code-paren">)</span></div>
                         <label class="options-label">Choose the output:</label>
                         <!-- **UPDATED** Options use line breaks -->
                         <label class="prediction-option"><input type="radio" name="predict-1" value="A"> <span><pre>> Step 1
> # Skip Step 2 for now
> Step 3</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-1" value="B"> <span><pre>> Step 1
> Step 3</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-1" value="C"> <span><pre>> Step 1 Step 3</pre></span></label>
                         <div class="text-center"> <button class="action-button prediction-check-btn" data-prediction-id="1">Check Prediction 1</button> </div>
                         <div id="prediction-feedback-1" class="feedback-message"></div>
                    </div>
                    <!-- Prediction Item 2 -->
                    <div class="prediction-item" id="prediction-2" data-correct-option="C">
                         <h4>Prediction 2</h4>
                         <div class="code-to-predict code-block"><span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Start"</span><span class="code-paren">)</span> <span class="code-comment"># Begin process</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-paren">)</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"End"</span><span class="code-paren">)</span></div>
                         <label class="options-label">Choose the output:</label>
                         <!-- **UPDATED** Options use line breaks -->
                         <label class="prediction-option"><input type="radio" name="predict-2" value="A"> <span><pre>> Start # Begin process
>
> End</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-2" value="B"> <span><pre>> Start
> End</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-2" value="C"> <span><pre>> Start
>
> End</pre></span></label>
                         <div class="text-center"> <button class="action-button prediction-check-btn" data-prediction-id="2">Check Prediction 2</button> </div>
                         <div id="prediction-feedback-2" class="feedback-message"></div>
                    </div>
                     <div id="prediction-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </section>


         <!-- ========= Activity 7: Advanced Mini Missions ========= -->
        <section id="adv-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-bolt"></i> Advanced Mini Missions!</h2>
                 <p class="section-description fade-in delay-1">
                     Final challenge! Complete these missions precisely. Pay attention to exact text, blank lines, and comment placement. The required output is shown below each mission.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 (Advanced) -->
                     <div class="mission" id="adv-mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4>Mission 1: Precise Greeting</h4>
                         <p>Write Python code to print the following two lines exactly:</p>
                         <!-- **UPDATED** Use line breaks -->
                         <pre>> Hello, Pythonista!
> Ready to code?</pre>
                         <textarea class="sim-editor mission-editor" rows="4" placeholder='Use two print() commands...'></textarea>
                         <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-1"></div>
                     </div>
                     <!-- Mission 2 (Advanced) -->
                     <div class="mission" id="adv-mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4>Mission 2: Message with Spacer</h4>
                         <p>Print the message "Processing...", then print a blank line, then print "Done.". Use three `print()` commands. Required output:</p>
                         <!-- **UPDATED** Use line breaks -->
                         <pre>> Processing...
>
> Done.</pre>
                         <textarea class="sim-editor mission-editor" rows="5" placeholder='print("...")\nprint()\nprint("...")'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-2"></div>
                     </div>
                     <!-- Mission 3 (Advanced) -->
                     <div class="mission" id="adv-mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4>Mission 3: Comment First, Then Print</h4>
                         <p>First, write a comment: `# Displaying status.` On the next line, print the text: `Status: OK`. Required output:</p>
                          <!-- **UPDATED** Use line breaks -->
                         <pre>> Status: OK</pre>
                         <textarea class="sim-editor mission-editor" rows="4" placeholder='# Your comment here\nprint("...")'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-3"></div>
                     </div>
                      <!-- Mission 4 (Advanced) -->
                     <div class="mission" id="adv-mission-4" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4>Mission 4: Print with Trailing Comment</h4>
                         <p>Print the text `"Important message"`. Add a comment *after* the code on the same line: `# Needs attention`. Required output:</p>
                          <!-- **UPDATED** Use line breaks -->
                         <pre>> Important message</pre>
                         <textarea class="sim-editor mission-editor" rows="4" placeholder='print(...) # Your comment here'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="4">Test Mission 4</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-4"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section (Updated Links) ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in"> <!-- Animation applied via class -->
                    <i class="fas fa-star"></i> <i class="fas fa-trophy"></i> <i class="fas fa-star"></i>
                </div>
                <h2 class="fade-in delay-1">Advanced Practice Mastered!</h2>
                <p class="fade-in delay-2">
                    Outstanding! You've conquered the advanced challenges for Module 0.<br>
                    You have a strong grasp of `print()` and comments. Time for the video lesson!
                </p>
                <!-- **UPDATED** Button Group -->
                <div class="button-group">
                    <a href="ctp-theory-0.html" class="action-button secondary fade-in delay-3"><i class="fas fa-book-open"></i> Review Theory</a>
                    <a href="ctp-practice-0.html" class="action-button secondary fade-in delay-3"><i class="fas fa-level-down-alt"></i> Revisit Basic Practice</a>
                    <a href="ctp-video-0.html" class="action-button success fade-in delay-4"><i class="fas fa-play-circle"></i> Proceed to Video Lesson</a>
                    <a href="ctp.html" class="action-button smaller-button fade-in delay-4"><i class="fas fa-list"></i> Course Menu</a> <!-- Smaller Menu Button -->
                </div>
            </div>
        </section>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Helper Function for Feedback (Same as Basic) ---
        function showFeedback(elementId, messageHTML, type = 'info', isVisible = true) {
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            feedbackEl.innerHTML = messageHTML;
            feedbackEl.className = 'feedback-message';
            if (isVisible) {
                feedbackEl.classList.add('visible', type);
                const interactiveArea = feedbackEl.closest('.interactive-area, .correction-item, .prediction-item, .mission');
                if (interactiveArea) {
                    interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
                    void interactiveArea.offsetWidth;
                    if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
                    else if (type === 'incorrect' || type === 'warning') { interactiveArea.classList.add('shake-anim'); }
                }
            } else {
                feedbackEl.classList.remove('visible');
            }
        }

        // --- Activity 1: Anatomy Revisited ---
        const anatomyAdvanced = document.getElementById('anatomy-advanced');
        if (anatomyAdvanced) {
            const parts = anatomyAdvanced.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('anatomy-advanced-explanations');
            const statusP = document.getElementById('anatomy-advanced-status');
            const feedbackDiv = document.getElementById('anatomy-advanced-feedback');
            let identifiedCount = 0;
            const totalParts = 13; // **UPDATED** Count

            const partExplanations = { /* Same explanations */
                'comment1': "Comment: Explains the following code.",
                'function1': "Function: `print` command.", 'paren-open1': "Opening Parenthesis: Starts function input.", 'string1': "String: Text to be printed.", 'paren-close1': "Closing Parenthesis: Ends function input.",
                'function2': "Function: Another `print` command.", 'paren-open2': "Opening Parenthesis: Starts input.", 'paren-close2': "Closing Parenthesis: Ends input (empty print = blank line).",
                'comment2': "Comment: Explains the blank line print.",
                'function3': "Function: Final `print` command.", 'paren-open3': "Opening Parenthesis: Starts input.", 'string2': "String: More text to print.", 'paren-close3': "Closing Parenthesis: Ends input."
            };

            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.textContent = `Identify all ${totalParts} parts!`; // Updated text
            feedbackDiv.classList.remove('visible');
            identifiedCount = 0;

            parts.forEach(part => {
                part.addEventListener('click', () => {
                    const partType = part.dataset.part;
                    if (!part.classList.contains('identified') && partType && partExplanations[partType]) {
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        p.innerHTML = `<i class="fas fa-check-circle" style="color: var(--success-color);"></i> <strong>${part.textContent.trim() || '( )'}:</strong> ${partExplanations[partType]}`; // Handle empty parens display
                        explanationsDiv.appendChild(p);
                        // **NEW** Scroll to bottom when adding
                        explanationsDiv.scrollTop = explanationsDiv.scrollHeight;
                        statusP.textContent = `Identified ${identifiedCount} of ${totalParts} parts.`;
                        if (identifiedCount === totalParts) {
                            statusP.textContent = 'All parts identified!';
                            showFeedback('anatomy-advanced-feedback', 'Excellent! You dissected the code perfectly!', 'correct');
                        }
                    } else if (!partExplanations[partType]) {
                        console.error(`Explanation missing for part type: ${partType}`);
                    }
                });
            });
        }

        // --- Activity 2: Build Multiple Prints (Logic remains the same) ---
        const buildMultiPrintSection = document.getElementById('build-multi-print');
        if (buildMultiPrintSection) {
            const piecesContainer = document.getElementById('multi-draggable-pieces');
            const dropZone = document.getElementById('multi-drop-zone');
            const checkBtn = document.getElementById('check-multi-build-btn');
            const resetBtn = document.getElementById('reset-multi-build-btn');
            const feedbackDiv = document.getElementById('multi-build-feedback');
            const placeholder = document.getElementById('multi-drop-zone-placeholder');
            const initialPieces = [ /* Same pieces */ { value: 'print', type: 'function' }, { value: '(', type: 'paren-open' }, { value: ')', type: 'paren-close' }, { value: '"AI is powerful."', type: 'string' }, { value: '"Handle with care."', type: 'string' }, { value: 'print', type: 'function' }, { value: '(', type: 'paren-open' }, { value: ')', type: 'paren-close' }, { value: '# A comment', type: 'comment' }, { value: '"Wrong Text"', type: 'string' } ];
            let draggedElement = null; let touchDragElement = null; let originalPiece = null; let startX, startY, offsetX, offsetY;
            function createPieceElement(pieceData) { const piece = document.createElement('span'); piece.classList.add('piece', 'code-font'); piece.draggable = true; piece.dataset.value = pieceData.value; piece.dataset.type = pieceData.type; piece.textContent = pieceData.value; if (pieceData.type === 'string') piece.style.backgroundColor = '#b17a62'; if (pieceData.type === 'comment') piece.style.backgroundColor = '#5d8f4c'; addDragListeners(piece); addTouchListeners(piece); return piece; }
            function populatePieces() { piecesContainer.innerHTML = ''; initialPieces.sort(() => Math.random() - 0.5).forEach(pData => { piecesContainer.appendChild(createPieceElement(pData)); }); }
            function setupMultiBuildListeners() { populatePieces(); dropZone.innerHTML = ''; dropZone.appendChild(placeholder.cloneNode(true)); /* Clone placeholder */ feedbackDiv.classList.remove('visible'); checkBtn.classList.remove('success'); checkBtn.disabled = false; }
            function addDragListeners(element) { element.addEventListener('dragstart', (e) => { draggedElement = element; element.classList.add('ghosting'); e.dataTransfer.effectAllowed = 'move'; try { e.dataTransfer.setData('text/plain', element.dataset.value); } catch (err) {} }); element.addEventListener('dragend', () => { element.classList.remove('ghosting'); draggedElement = null; }); }
            function addTouchListeners(element) { element.addEventListener('touchstart', (e) => { if (touchDragElement) return; originalPiece = element; const touch = e.targetTouches[0]; startX = touch.clientX; startY = touch.clientY; const rect = element.getBoundingClientRect(); offsetX = startX - rect.left; offsetY = startY - rect.top; touchDragElement = element.cloneNode(true); touchDragElement.classList.add('dragging'); touchDragElement.style.position = 'fixed'; touchDragElement.style.left = `${startX - offsetX}px`; touchDragElement.style.top = `${startY - offsetY}px`; touchDragElement.style.width = `${rect.width}px`; touchDragElement.style.height = `${rect.height}px`; document.body.appendChild(touchDragElement); originalPiece.classList.add('ghosting'); e.preventDefault(); }, { passive: false }); element.addEventListener('touchmove', (e) => { if (!touchDragElement) return; e.preventDefault(); const touch = e.targetTouches[0]; const currentX = touch.clientX; const currentY = touch.clientY; touchDragElement.style.left = `${currentX - offsetX}px`; touchDragElement.style.top = `${currentY - offsetY}px`; const elemBelow = document.elementFromPoint(currentX, currentY); const isOverDropZone = elemBelow === dropZone || dropZone.contains(elemBelow); if (isOverDropZone) { dropZone.classList.add('over'); } else { dropZone.classList.remove('over'); } }, { passive: false }); element.addEventListener('touchend', (e) => { if (!touchDragElement || !originalPiece) return; const touch = e.changedTouches[0]; const finalX = touch.clientX; const finalY = touch.clientY; const elemBelow = document.elementFromPoint(finalX, finalY); const droppedInZone = elemBelow === dropZone || dropZone.contains(elemBelow); if (droppedInZone) { handleDrop(originalPiece, elemBelow); } else { originalPiece.classList.remove('ghosting'); } if (touchDragElement.parentNode === document.body) document.body.removeChild(touchDragElement); dropZone.classList.remove('over'); touchDragElement = null; originalPiece = null; }); }
            function handleDrop(droppedOriginal, targetElement) { document.getElementById('multi-drop-zone-placeholder')?.remove(); const droppedPiece = droppedOriginal.cloneNode(true); droppedPiece.classList.remove('ghosting'); droppedPiece.draggable = false; droppedPiece.style.cursor = 'default'; addTouchListeners(droppedPiece); let currentLine = dropZone.lastElementChild; if (!currentLine || droppedPiece.dataset.type === 'function' || !currentLine.classList.contains('code-line')) { currentLine = document.createElement('div'); currentLine.classList.add('code-line'); dropZone.appendChild(currentLine); } currentLine.appendChild(droppedPiece); droppedOriginal.remove(); }
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('over'); }); dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('over'); }); dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('over'); if (draggedElement) { handleDrop(draggedElement, e.target); draggedElement = null; } });
            checkBtn.addEventListener('click', () => { const lines = dropZone.querySelectorAll('.code-line'); let codeLine1 = '', codeLine2 = ''; let textLine1 = '', textLine2 = ''; if (lines.length >= 1) { const pieces1 = lines[0].querySelectorAll('.piece'); codeLine1 = Array.from(pieces1).map(p => p.dataset.type).join('-'); textLine1 = Array.from(pieces1).find(p => p.dataset.type === 'string')?.dataset.value || ''; } if (lines.length >= 2) { const pieces2 = lines[1].querySelectorAll('.piece'); codeLine2 = Array.from(pieces2).map(p => p.dataset.type).join('-'); textLine2 = Array.from(pieces2).find(p => p.dataset.type === 'string')?.dataset.value || ''; } const correctSeq = 'function-paren-open-string-paren-close'; const correctText1 = '"AI is powerful."'; const correctText2 = '"Handle with care."'; const isLine1Correct = codeLine1 === correctSeq && textLine1 === correctText1; const isLine2Correct = codeLine2 === correctSeq && textLine2 === correctText2; if (isLine1Correct && isLine2Correct && lines.length === 2) { showFeedback('multi-build-feedback', 'Perfect! Both lines constructed correctly!', 'correct'); checkBtn.classList.add('success'); checkBtn.disabled = true; } else if (lines.length !== 2) { showFeedback('multi-build-feedback', `Incorrect number of lines built (${lines.length}). Need exactly 2.`, 'incorrect'); checkBtn.classList.remove('success'); } else { let errors = []; if (!isLine1Correct) errors.push("Line 1 has errors (check pieces, order, or text)."); if (!isLine2Correct) errors.push("Line 2 has errors (check pieces, order, or text)."); showFeedback('multi-build-feedback', `Almost! ${errors.join(' ')}`, 'incorrect'); checkBtn.classList.remove('success'); } });
            resetBtn.addEventListener('click', setupMultiBuildListeners);
            setupMultiBuildListeners();
        }


        // --- Activity 3: Advanced Code Simulator (Adapted Check for Line Breaks) ---
        const advSimSection = document.getElementById('adv-code-simulator');
        if(advSimSection) {
            const editor = document.getElementById('adv-sim-editor-input');
            const outputArea = document.getElementById('adv-sim-output');
            const runBtn = document.getElementById('run-adv-sim-btn');
            const feedbackDiv = document.getElementById('adv-sim-feedback');

            runBtn.addEventListener('click', () => {
                const code = editor.value;
                const codeLines = code.split('\n'); // Keep raw lines
                const trimmedLines = codeLines.map(l => l.trim()); // Trimmed for analysis
                outputArea.innerHTML = '';
                feedbackDiv.classList.remove('visible');

                // **UPDATED** Expected output based on separate lines
                const expectedRawOutputLines = ["Line One", "", "Line Three"];

                let simulatedOutputLines = [];
                let errors = [];
                let lineNum = 0;
                let foundCommentForBlank = false;
                let printCommandCount = 0;

                for (const line of codeLines) {
                    lineNum++;
                    const trimmedLine = line.trim();

                    if (trimmedLine.startsWith('#')) {
                        // Check if it's the comment before print()
                        const currentIdx = codeLines.indexOf(line); // Find index in original lines
                         if (currentIdx !== -1 && currentIdx + 1 < trimmedLines.length && trimmedLines[currentIdx + 1] === 'print()') {
                             foundCommentForBlank = true;
                         }
                        continue;
                    }

                    if (trimmedLine === '') { continue; }

                    const printRegex = /^print\s*\(\s*(?:"(.*)"|)\s*\)\s*(?:#.*)?$/;
                    const match = trimmedLine.match(printRegex);

                    if (match) {
                        printCommandCount++;
                        const outputText = match[1];
                        simulatedOutputLines.push(outputText === undefined ? "" : outputText); // Add empty string for print()
                    } else if (trimmedLine) {
                        errors.push(`Syntax Error on line ${lineNum}: '${line}' - Check print format.`);
                    }
                }

                if (errors.length > 0) {
                    errors.forEach(err => {
                        const errLine = document.createElement('span');
                        errLine.classList.add('output-line', 'error');
                        errLine.textContent = err;
                        outputArea.appendChild(errLine);
                    });
                    showFeedback('adv-sim-feedback', 'Simulation failed due to syntax errors.', 'incorrect');
                } else {
                    // Display output with '>' prefix per line
                    outputArea.innerHTML = simulatedOutputLines.map(line => `<span class="output-line">> ${line}</span>`).join('');

                    // **UPDATED** Check against requirements
                    const isOutputCorrect = JSON.stringify(simulatedOutputLines) === JSON.stringify(expectedRawOutputLines); // Compare arrays

                    if (isOutputCorrect && foundCommentForBlank && printCommandCount === 3) {
                       showFeedback('adv-sim-feedback', 'Perfect! Output matches exactly, and comment is placed correctly.', 'correct');
                    } else {
                        let feedback = "Output generated, but doesn't meet all requirements. ";
                        if (!isOutputCorrect) feedback += "Check the printed text and the blank line. ";
                        if (printCommandCount !== 3) feedback += `Used ${printCommandCount} print commands, expected 3. `;
                        if (!foundCommentForBlank) feedback += "Missing the required comment before the blank line print. ";
                        showFeedback('adv-sim-feedback', feedback, 'warning');
                    }
                }
            });
        }


        // --- Activity 4: Spot the Tricky Comment (Logic remains the same) ---
        const spotTrickyCommentSection = document.getElementById('spot-tricky-comment');
        if (spotTrickyCommentSection) {
            const linesContainer = document.getElementById('tricky-comment-lines'); const checkBtn = document.getElementById('check-tricky-comment-btn'); const resetBtn = document.getElementById('reset-tricky-comment-btn'); const feedbackDiv = document.getElementById('tricky-comment-feedback');
            const trickyCommentCodeLines = [ { code: 'print("Starting analysis...") # Main entry point', isComment: true }, { code: '# Configuration settings', isComment: true }, { code: 'data = load_data()', isComment: false }, { code: '# print("Debug value:", x) # Old debug line', isComment: true }, { code: 'process(data) # Run the core logic', isComment: true }, { code: '## Section Separator ##', isComment: true }, { code: 'print("# Not a comment inside string") ', isComment: false }, { code: '#', isComment: true } ];
            function createTrickyCommentLineElement(lineData) { const container = document.createElement('div'); container.classList.add('code-line-container'); const iconPlaceholder = document.createElement('span'); iconPlaceholder.classList.add('feedback-icon-placeholder'); const codeLine = document.createElement('div'); codeLine.classList.add('code-line-check'); codeLine.dataset.isComment = lineData.isComment.toString(); codeLine.textContent = lineData.code; container.appendChild(iconPlaceholder); container.appendChild(codeLine); return container; }
            function setupTrickyCommentLines() { linesContainer.innerHTML = ''; trickyCommentCodeLines.forEach(lineData => { linesContainer.appendChild(createTrickyCommentLineElement(lineData)); }); feedbackDiv.classList.remove('visible'); resetBtn.classList.add('hidden'); checkBtn.disabled = false; }
            linesContainer.addEventListener('click', (event) => { const lineCheck = event.target.closest('.code-line-check'); if (!lineCheck || lineCheck.classList.contains('checked-state')) return; lineCheck.classList.toggle('selected-visual'); });
            checkBtn.addEventListener('click', () => { let correctSelections = 0; let incorrectSelections = 0; let missedComments = 0; const lineContainers = linesContainer.querySelectorAll('.code-line-container'); const totalComments = trickyCommentCodeLines.filter(l => l.isComment).length; let isCorrectOverall = false; lineContainers.forEach(container => { const lineCheck = container.querySelector('.code-line-check'); const iconPlaceholder = container.querySelector('.feedback-icon-placeholder'); const isCommentLine = lineCheck.dataset.isComment === 'true'; const isSelected = lineCheck.classList.contains('selected-visual'); iconPlaceholder.innerHTML = ''; iconPlaceholder.classList.remove('visible'); lineCheck.classList.add('checked-state'); let iconClass = ''; if (isSelected && isCommentLine) { iconClass = 'fas fa-check'; correctSelections++; iconPlaceholder.classList.add('visible'); } else if (isSelected && !isCommentLine) { iconClass = 'fas fa-times'; incorrectSelections++; iconPlaceholder.classList.add('visible'); } else if (!isSelected && isCommentLine) { iconClass = 'fas fa-eye'; missedComments++; iconPlaceholder.classList.add('visible'); } if (iconClass) { const icon = document.createElement('i'); icon.className = iconClass; iconPlaceholder.appendChild(icon); } }); let feedbackMsg = ''; if (incorrectSelections === 0 && missedComments === 0 && correctSelections === totalComments) { isCorrectOverall = true; feedbackMsg = `Perfect! You identified all ${totalComments} tricky comments/lines with comments. <i class="fas fa-thumbs-up"></i>`; showFeedback('tricky-comment-feedback', feedbackMsg, 'correct'); } else { let hints = []; if (incorrectSelections > 0) hints.push(`${incorrectSelections} incorrect selection(s) (<i class="fas fa-times"></i>)`); if (missedComments > 0) hints.push(`${missedComments} missed comment(s) (<i class="fas fa-eye"></i>)`); feedbackMsg = `Not quite right. ${hints.join(', and ')}. Remember comments start with '#', even after code! But '#' inside quotes is just text.`; showFeedback('tricky-comment-feedback', feedbackMsg, 'incorrect'); } if (isCorrectOverall) { resetBtn.classList.add('hidden'); checkBtn.disabled = true; lineContainers.forEach(c => c.querySelector('.code-line-check').classList.remove('selected-visual')); } else { resetBtn.classList.remove('hidden'); checkBtn.disabled = false; } });
            resetBtn.addEventListener('click', () => { const lineContainers = linesContainer.querySelectorAll('.code-line-container'); lineContainers.forEach(container => { const lineCheck = container.querySelector('.code-line-check'); const iconPlaceholder = container.querySelector('.feedback-icon-placeholder'); lineCheck.classList.remove('selected-visual', 'checked-state'); iconPlaceholder.innerHTML = ''; iconPlaceholder.classList.remove('visible'); }); feedbackDiv.classList.remove('visible'); resetBtn.classList.add('hidden'); checkBtn.disabled = false; });
            setupTrickyCommentLines();
        }


        // --- Activity 5: Code Correction Challenge (Updated Checks) ---
        const codeCorrectionSection = document.getElementById('code-correction');
        if (codeCorrectionSection) {
            const checkButtons = codeCorrectionSection.querySelectorAll('.correction-check-btn');
            // **UPDATED** Correct code map for new challenges
            const correctCodeMap = {
                '1': 'print("Syntax matters!")', // Fix 'prnt'
                '2': 'print("Python is fun")',   // Add parentheses
                '3': 'print("Hello")'            // Add quotes
            };
            let completedCorrections = 0;
            const totalCorrections = Object.keys(correctCodeMap).length;

            function normalizeCode(code) { return code.split('\n').map(line => line.trim()).filter(line => line !== '').join('\n'); }

            function updateCorrectionSummary() {
                const summaryFeedback = document.getElementById('correction-summary-feedback');
                if(!summaryFeedback) return;
                if (completedCorrections === totalCorrections) {
                    showFeedback(summaryFeedback.id, `Excellent! All ${totalCorrections} corrections made successfully!`, 'correct');
                } else if (completedCorrections > 0) {
                    showFeedback(summaryFeedback.id, `Completed ${completedCorrections} of ${totalCorrections} corrections. Keep debugging!`, 'info');
                } else {
                    summaryFeedback.classList.remove('visible');
                }
             }

            checkButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const correctionId = button.dataset.correctionId;
                    const editor = document.getElementById(`correction-editor-${correctionId}`);
                    const feedbackDiv = document.getElementById(`correction-feedback-${correctionId}`);
                    const statusIcon = document.getElementById(`correction-status-${correctionId}`).querySelector('i');
                    const userCode = editor.value;
                    const expectedCode = correctCodeMap[correctionId];
                    const normalizedUserCode = normalizeCode(userCode);
                    const normalizedExpectedCode = normalizeCode(expectedCode);
                    const correctionItem = document.getElementById(`correction-${correctionId}`);
                    const wasPreviouslyCorrect = correctionItem.dataset.completed === 'true';

                    if (normalizedUserCode === normalizedExpectedCode) {
                         showFeedback(feedbackDiv.id, 'Correct! Well spotted!', 'correct');
                         statusIcon.className = 'fas fa-check';
                         editor.disabled = true; button.disabled = true;
                         if (!wasPreviouslyCorrect) { correctionItem.dataset.completed = 'true'; completedCorrections++; }
                    } else {
                        let hint = 'Incorrect. ';
                        // **UPDATED** Hints for new challenges
                        if (correctionId === '1') hint += "Check the function name spelling.";
                        else if (correctionId === '2') hint += "Remember, the `print` function needs parentheses `()` around what you want to print.";
                        else if (correctionId === '3') hint += "Text you want to print needs to be inside quotes `\"\"`.";
                        else hint += "Review the required syntax and compare with your code.";
                        showFeedback(feedbackDiv.id, hint, 'incorrect');
                        statusIcon.className = 'fas fa-times';
                        if (wasPreviouslyCorrect) { correctionItem.dataset.completed = 'false'; completedCorrections--; }
                    }
                    updateCorrectionSummary(); // Call summary update
                });
            });
             updateCorrectionSummary(); // Initial call
        }


        // --- Activity 6: Output Prediction (Logic MODIFIED to allow retries) ---
        const outputPredictionSection = document.getElementById('output-prediction');
        if (outputPredictionSection) {
            const checkButtons = outputPredictionSection.querySelectorAll('.prediction-check-btn');
            let completedPredictions = 0;
            const totalPredictions = outputPredictionSection.querySelectorAll('.prediction-item').length;

            function updatePredictionSummary() {
                const summaryFeedback = document.getElementById('prediction-summary-feedback');
                if(!summaryFeedback) return;
                if (completedPredictions === totalPredictions) {
                    showFeedback(summaryFeedback.id, `Awesome! All ${totalPredictions} predictions were correct!`, 'correct');
                } else if (completedPredictions > 0) {
                    showFeedback(summaryFeedback.id, `Made ${completedPredictions} of ${totalPredictions} correct predictions.`, 'info');
                } else {
                    summaryFeedback.classList.remove('visible');
                }
            }

            checkButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const predictionId = button.dataset.predictionId;
                    const itemDiv = document.getElementById(`prediction-${predictionId}`);
                    const feedbackDiv = document.getElementById(`prediction-feedback-${predictionId}`);
                    const correctAnswer = itemDiv.dataset.correctOption;
                    const selectedOption = itemDiv.querySelector(`input[name="predict-${predictionId}"]:checked`);
                    const wasPreviouslyCorrect = itemDiv.dataset.completed === 'true';

                    if (!selectedOption) {
                        showFeedback(feedbackDiv.id, 'Please select an option first.', 'warning');
                        return;
                    }

                    const userAnswer = selectedOption.value;

                    // --- *** MODIFICATION START *** ---
                    if (userAnswer === correctAnswer) {
                        showFeedback(feedbackDiv.id, 'Correct! You predicted the output accurately.', 'correct');
                        // Disable radio buttons ONLY if correct
                        itemDiv.querySelectorAll(`input[name="predict-${predictionId}"]`).forEach(radio => radio.disabled = true);
                        button.disabled = true; // Disable button ONLY if correct

                        if (!wasPreviouslyCorrect) {
                            itemDiv.dataset.completed = 'true';
                            completedPredictions++;
                        }
                    } else {
                        showFeedback(feedbackDiv.id, `Not quite. The correct output was Option ${correctAnswer}. Think about how comments and blank prints affect output. Try again!`, 'incorrect');
                        // DO NOT disable buttons if incorrect
                        if (wasPreviouslyCorrect) {
                           itemDiv.dataset.completed = 'false'; // Mark as incomplete if changed from correct
                            completedPredictions--;
                        }
                    }
                    // --- *** MODIFICATION END *** ---

                    updatePredictionSummary();
                });
            });
            updatePredictionSummary(); // Initial call
        }


         // --- Activity 7: Advanced Mini Missions (Adapted Checks for Line Breaks) ---
         const advMissionsSection = document.getElementById('adv-mini-missions');
         if (advMissionsSection) {
             const missionRunButtons = advMissionsSection.querySelectorAll('.adv-mission-run-btn');
             const summaryFeedback = document.getElementById('adv-missions-summary-feedback');
             const totalMissions = advMissionsSection.querySelectorAll('.mission').length;
             let completedMissionsCount = 0;

            function updateAdvMissionSummary() {
                completedMissionsCount = advMissionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                const summaryFeedback = document.getElementById('adv-missions-summary-feedback'); // Ensure element exists
                if(!summaryFeedback) return; // Exit if not found
                if (completedMissionsCount === totalMissions) {
                    showFeedback(summaryFeedback.id, `All ${totalMissions} advanced missions complete! Master Coder!`, 'correct');
                } else if (completedMissionsCount > 0) {
                    showFeedback(summaryFeedback.id, `Completed ${completedMissionsCount} of ${totalMissions} advanced missions. Almost there!`, 'info');
                } else {
                    summaryFeedback.classList.remove('visible');
                }
            }

             // **UPDATED** Validation based on expected separate print calls
             function validateMissionCodeAdv(missionId, code) {
                 const codeLines = code.split('\n'); // Use raw lines for comment checks
                 const trimmedLines = codeLines.map(l => l.trim()).filter(l => l !== ''); // Trimmed non-empty lines for print checks

                 switch (missionId) {
                    case '1': // Precise Greeting
                         return trimmedLines.length === 2 &&
                                trimmedLines[0] === 'print("Hello, Pythonista!")' &&
                                trimmedLines[1] === 'print("Ready to code?")';
                    case '2': // Message with Spacer
                        return trimmedLines.length === 3 &&
                               trimmedLines[0] === 'print("Processing...")' &&
                               trimmedLines[1] === 'print()' &&
                               trimmedLines[2] === 'print("Done.")';
                    case '3': // Comment First, Then Print
                         // Check raw lines for comment then trimmed for print
                         const firstRawTrimmed = codeLines.length > 0 ? codeLines[0].trim() : '';
                         // Find the index of the first non-comment, non-empty trimmed line AFTER the comment
                         const commentLineIndex = codeLines.findIndex(line => line.trim() === '# Displaying status.');
                         if (commentLineIndex === -1) return false; // Comment not found
                         const printLine = trimmedLines.find((line, index) => {
                             // Find original index of this trimmed line more robustly
                             let originalIndex = -1;
                             let count = 0;
                             for(let i = 0; i < codeLines.length; i++) {
                                if (codeLines[i].trim() === line) {
                                     if (count === index) { // Match the index within the trimmedLines array
                                         originalIndex = i;
                                         break;
                                     }
                                     count++;
                                }
                             }
                             return originalIndex > commentLineIndex && line.startsWith('print');
                         });
                         return firstRawTrimmed === '# Displaying status.' &&
                                printLine === 'print("Status: OK")';
                    case '4': // Print with Trailing Comment
                        const lineRegex = /^print\("Important message"\)\s*# Needs attention$/;
                        // Check if *any* non-empty trimmed line matches
                        return trimmedLines.some(line => lineRegex.test(line));
                     default: return false;
                 }
             }

              // **UPDATED** Simulate output (generates array of lines)
              function simulateOutputAdv(code) {
                  let outputLines = [];
                  const lines = code.split('\n');
                  for (const line of lines) {
                      const trimmedLine = line.trim();
                      if (trimmedLine.startsWith('#') || trimmedLine === '') continue;
                      const printRegex = /^print\s*\(\s*(?:"(.*)"|)\s*\)/; // Doesn't capture trailing comment
                      const match = trimmedLine.match(printRegex);
                      if (match) {
                          outputLines.push(match[1] === undefined ? "" : match[1]); // Empty string for print()
                      } else { return null; } // Syntax error
                  }
                  return outputLines; // Return array of output lines
              }

             missionRunButtons.forEach(button => {
                 button.addEventListener('click', () => {
                     const missionId = button.dataset.missionId;
                     const missionDiv = document.getElementById(`adv-mission-${missionId}`);
                     const editor = missionDiv.querySelector('.mission-editor');
                     const outputArea = missionDiv.querySelector('.mission-output');
                     const feedbackDiv = missionDiv.querySelector(`#adv-mission-feedback-${missionId}`);
                     const statusIcon = missionDiv.querySelector('.mission-status i');
                     const code = editor.value;
                     const wasPreviouslyCorrect = missionDiv.dataset.completed === 'true';
                     outputArea.innerHTML = '';

                     const success = validateMissionCodeAdv(missionId, code);
                     let feedbackMessage = '';
                     let feedbackType = 'incorrect';

                      if (success) {
                          const simulatedLines = simulateOutputAdv(code);
                          if (simulatedLines !== null) {
                               // **UPDATED** Display output lines
                              outputArea.innerHTML = simulatedLines.map(line => `<span class="output-line">> ${line}</span>`).join('');
                              feedbackMessage = 'Mission Accomplished! Code is correct.';
                              feedbackType = 'correct';
                              statusIcon.className = 'fas fa-check-circle';
                              if (!wasPreviouslyCorrect) {
                                missionDiv.dataset.completed = 'true'; // Set only if newly correct
                                completedMissionsCount++;
                              }
                          } else {
                               // Should not happen if validation passes, but handle defensively
                               outputArea.innerHTML = '<span class="output-line error">Simulation Error</span>';
                               feedbackMessage = 'Code structure seems correct, but simulation failed unexpectedly.';
                               feedbackType = 'warning';
                               statusIcon.className = 'fas fa-times-circle'; // Indicate issue
                               if (wasPreviouslyCorrect) {
                                  missionDiv.dataset.completed = 'false';
                                  completedMissionsCount--;
                               }
                          }
                      } else {
                          const simulatedLines = simulateOutputAdv(code); // Try simulating even if validation failed
                           if (simulatedLines !== null) {
                               outputArea.innerHTML = simulatedLines.map(line => `<span class="output-line">> ${line}</span>`).join('');
                           } else {
                               outputArea.innerHTML = '<span class="output-line error">Syntax Error Detected</span>';
                           }
                           // Provide general feedback
                           feedbackMessage = `Incorrect. Review mission requirements: check syntax, exact text, line breaks, and comments.`;
                           // Add specific hints if possible (based on common errors for that mission)
                            if (missionId === '1') feedbackMessage += " Did you use two separate `print` commands with the exact text?";
                            if (missionId === '2') feedbackMessage += " Ensure you have three `print` commands in the correct order (text, blank, text).";
                            if (missionId === '3') feedbackMessage += " Is the comment `# Displaying status.` on the very first line, and the `print` command on the next?";
                            if (missionId === '4') feedbackMessage += " Check the `print` command syntax and make sure the comment `# Needs attention` is on the *same line* after the closing parenthesis.";

                           feedbackType = 'incorrect';
                           statusIcon.className = 'fas fa-times-circle';
                           if (wasPreviouslyCorrect) {
                                missionDiv.dataset.completed = 'false'; // Mark as false if changed from correct to incorrect
                                completedMissionsCount--;
                            } else {
                                missionDiv.dataset.completed = 'false'; // Ensure it's marked false
                            }
                      }
                      showFeedback(feedbackDiv.id, feedbackMessage, feedbackType);
                      updateAdvMissionSummary(); // Update summary after each check
                 });
             });
              updateAdvMissionSummary(); // Initial call to set summary state
         }


        // --- Fade-in animations on scroll (Same as Basic) ---
         const fadeElements = document.querySelectorAll('.fade-in');
         function animateOnScroll() {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 const rect = el.getBoundingClientRect();
                 if (rect.top < windowHeight - 50 && rect.bottom >= 0) {
                      if (el.style.opacity !== '1') {
                          el.style.opacity = '1';
                          el.style.transform = 'translateY(0)';
                      }
                 }
                 // Optional: Reset if scrolled out
                 // else if (el.style.opacity === '1' && (rect.top > windowHeight || rect.bottom < -50)) {
                 //     el.style.opacity = '0';
                 //     el.style.transform = 'translateY(20px)';
                 // }
             });
          }
         const scrollThrottle = (callback, limit) => {
            let wait = false;
            return function () {
                if (!wait) {
                    callback.call();
                    wait = true;
                    setTimeout(function () {
                        wait = false;
                    }, limit);
                }
            }
         };
         window.addEventListener('scroll', scrollThrottle(animateOnScroll, 100));
         animateOnScroll(); // Initial check


    }); // End DOMContentLoaded
    </script>

</body>
</html>
