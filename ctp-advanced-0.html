<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 0: Advanced Python Practice!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff; /* Primary Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa; /* Very Light Grey */
            --background-medium: #e9ecef; /* Light Grey */
            --background-dark: #343a40; /* Dark Grey/Black */
            --text-light: #f8f9fa; /* Light Text */
            --text-dark: #212529; /* Dark Text */
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --warning-color: #ff9800; /* Orange for warnings/hints */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
             /* Nav Colors */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }

        /* --- Advanced Animations --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; } .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; } .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav --- CORRECTED --- */
        .minimal-nav-button {
            position: fixed; top: 15px; right: 15px; z-index: 1001;
            background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none;
            border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer;
            transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed);
            font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1;
        }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav {
            position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark);
            border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem;
            opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right;
            pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            /* Limit width slightly more if needed */
            max-width: 280px;
        }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul {
            list-style: none; margin: 0; padding: 0;
            /* **NEW**: Add max-height and scrolling */
            max-height: calc(100vh - 120px); /* Limit height based on viewport minus header/footer margins */
            /* Example fixed height: max-height: 24rem; */
            overflow-y: auto; /* Enable vertical scroll only when needed */
            /* **NEW**: Add padding for scrollbar */
            padding-right: 8px; /* Space for scrollbar */
        }
        /* Style the scrollbar (optional, WebKit example) */
        .minimal-nav ul::-webkit-scrollbar { width: 6px; }
        .minimal-nav ul::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 3px; }
        .minimal-nav ul::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 3px; }
        .minimal-nav ul::-webkit-scrollbar-thumb:hover { background: #888; }

        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a {
            display: flex; align-items: center; color: var(--text-light); text-decoration: none;
            padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed);
            white-space: nowrap; font-weight: 400; font-size: 0.95rem;
        }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        /* Language Switcher */
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect {
            width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success);
            border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }
        /* --- End Minimal Retractable Nav --- */

        /* --- Practice Header --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; }
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; }

        /* --- Practice Section Styling --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 140px; /* Increased slightly more for longer feedback */ margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .feedback-message .fas { margin: 0 3px; }

        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .action-button.smaller-button { padding: 0.6rem 1.2rem; font-size: 0.9rem; background-color: var(--info-color); }
        .action-button.smaller-button:hover:not(:disabled) { background-color: #138496; }

        /* Code styling */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; white-space: pre; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; }

        /* --- Activity Specific Styles --- */

        /* Activity 1: Anatomy */
        #anatomy-advanced .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #anatomy-advanced .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #anatomy-advanced .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        #anatomy-advanced-explanations { max-height: 160px; overflow-y: auto; border: 1px solid var(--background-medium); padding: 10px 15px; margin-top: 1.2rem; background-color: var(--background-light); border-radius: var(--border-radius); scroll-behavior: smooth; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0; margin-bottom: 8px; background-color: transparent; }
        #anatomy-advanced-explanations::-webkit-scrollbar { width: 8px; } #anatomy-advanced-explanations::-webkit-scrollbar-track { background: var(--background-medium); border-radius: 4px; } #anatomy-advanced-explanations::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 4px; } #anatomy-advanced-explanations::-webkit-scrollbar-thumb:hover { background: #555; }
        #anatomy-advanced-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* Activity 2: Build-a-Print Advanced */
        #build-multi-print .draggable-pieces { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 1.5rem; padding: 1rem; background-color: var(--background-light); border: 1px dashed var(--secondary-color); border-radius: var(--border-radius); justify-content: center; user-select: none; -webkit-user-select: none; -ms-user-select: none; }
        .piece { display: inline-block; padding: 8px 12px; background-color: var(--primary-color); color: var(--text-light); border-radius: 4px; cursor: grab; font-family: var(--code-font); font-size: 1rem; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.1s ease, box-shadow var(--transition-speed); border: 1px solid #0056b3; touch-action: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .piece:active { cursor: grabbing; }
        .piece.dragging { opacity: 0.6 !important; transform: scale(1.05) rotate(3deg); position: fixed !important; pointer-events: none !important; z-index: 1000 !important; cursor: grabbing !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .piece.ghosting { opacity: 0.3; }
        .piece[data-type="string"] { background-color: #b17a62; border-color:#9d6c56; }
        .piece[data-type="comment"] { background-color: #5d8f4c; border-color:#4a723d; }
        #multi-drop-zone { min-height: 100px; background-color: var(--background-dark); border: 3px dashed var(--secondary-color); border-radius: var(--border-radius); padding: 15px; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; transition: border-color var(--transition-speed), background-color var(--transition-speed), box-shadow var(--transition-speed); }
        #multi-drop-zone.over { border-color: var(--accent-color); background-color: #495057; box-shadow: inset 0 0 10px rgba(255,193,7,0.2); }
        #multi-drop-zone .piece { cursor: default; margin: 0 2px; touch-action: auto; box-shadow: none; }
        #multi-drop-zone .code-line { display: flex; align-items: center; width: 100%; min-height: 1.5em; /* Ensure line div has height */ }
        #multi-drop-zone-placeholder { color: var(--secondary-color); font-style: italic; width: 100%; text-align: center; padding: 10px 0; }

        /* Activity 3: Advanced Simulator */
        #adv-code-simulator .sim-editor { width: 100%; min-height: 120px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #adv-code-simulator .sim-output-area { margin-top: 1rem; min-height: 80px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #adv-code-simulator .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #adv-code-simulator .sim-output-area .output-line { display: block; }
        #adv-code-simulator .sim-output-area .output-line.error { color: var(--error-color); font-weight: bold; }
        .example-output pre { background: var(--background-medium); padding: 10px; border-radius: 4px; display: inline-block; margin-top: 10px; color: var(--text-dark); font-family: var(--code-font); font-size: 0.95em; line-height: 1.4; border: 1px solid #ccc; white-space: pre; }

        /* Activity 4: Spot the Tricky Comment */
        .code-line-container { display: flex; align-items: center; margin-bottom: 8px; position: relative; }
        .feedback-icon-placeholder { width: 30px; height: 24px; margin-right: 10px; display: inline-flex; align-items: center; justify-content: center; transition: opacity var(--transition-speed); opacity: 0; font-size: 1.2rem; }
        .feedback-icon-placeholder.visible { opacity: 1; }
        #spot-tricky-comment .code-line-check { flex-grow: 1; background-color: var(--background-dark); color: var(--text-light); padding: 10px 15px; border-radius: 5px; cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), border-left-color var(--transition-speed); font-family: var(--code-font); border-left: 4px solid transparent; user-select: none; -webkit-user-select: none; }
        #spot-tricky-comment .code-line-check:hover:not(.checked-state) { background-color: #495057; transform: translateX(3px); } /* Only hover if not checked */
        #spot-tricky-comment .code-line-check.selected-visual { background-color: var(--selection-highlight-bg); border-left-color: var(--selection-highlight-border); color: var(--text-dark); }
        #spot-tricky-comment .code-line-check.checked-state { cursor: default; }
        .feedback-icon-placeholder .fa-check { color: var(--success-color); animation: iconAppearCorrect 0.5s ease-out forwards; }
        .feedback-icon-placeholder .fa-times { color: var(--error-color); animation: iconAppearIncorrect 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        .feedback-icon-placeholder .fa-eye { color: var(--accent-color); animation: iconAppearMissed 0.4s ease-in forwards; opacity: 0; }
        #reset-tricky-comment-btn { margin-left: 10px; }

        /* Activity 5: Code Correction */
        #code-correction .correction-item { margin-bottom: 2rem; border: 1px solid #ddd; padding: 1.5rem; border-radius: var(--border-radius); background-color: var(--background-light); }
        #code-correction h4 { margin-bottom: 0.5rem; color: var(--primary-color); }
        #code-correction .broken-code { background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom: 1rem; font-family: var(--code-font); border: 1px solid #f5c6cb; white-space: pre; }
        #code-correction .correction-editor { width: 100%; min-height: 60px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 0.5rem; }
        .correction-status { font-weight: bold; margin-left: 10px; } .correction-status .fa-check { color: var(--success-color); } .correction-status .fa-times { color: var(--error-color); } .correction-status .fa-question-circle { color: var(--secondary-color); }

        /* Activity 6: Output Prediction */
        #output-prediction .prediction-item { margin-bottom: 2rem; border: 1px solid #ddd; padding: 1.5rem; border-radius: var(--border-radius); background-color: var(--background-light); }
        #output-prediction h4 { margin-bottom: 0.5rem; color: var(--primary-color); }
        #output-prediction .code-to-predict { margin-bottom: 1.5rem; }
        #output-prediction .options-label { font-weight: bold; display: block; margin-bottom: 0.8rem; }
        #output-prediction .prediction-option { margin-bottom: 0.8rem; display: block; cursor: pointer; padding: 8px 12px; border-radius: 4px; border: 1px solid #ccc; transition: background-color 0.2s, border-color 0.2s; }
        #output-prediction .prediction-option:has(input:disabled):hover { background-color: initial; cursor: default; } /* Don't hover disabled */
        #output-prediction .prediction-option:has(input:enabled):hover { background-color: #f0f0f0; } /* Hover enabled */
        #output-prediction .prediction-option input[type="radio"] { margin-right: 10px; vertical-align: middle; }
        #output-prediction .prediction-option input[type="radio"]:checked + span { font-weight: bold; color: var(--primary-color); }
        #output-prediction .prediction-option pre { display: inline-block; background-color: #f1f1f1; padding: 5px 8px; border-radius: 3px; font-size: 0.95em; color: var(--text-dark); vertical-align: middle; white-space: pre; line-height: 1.4; margin: 0; }

        /* Activity 7: Advanced Mini Missions */
        #adv-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; animation: none; /* Remove default animation */ }
        .mission-status .fa-check-circle.animate { animation: iconAppearCorrect 0.6s ease-out; } /* Add class for animation */
        .mission-status .fa-times-circle { color: var(--error-color); } .mission-status .fa-question-circle { color: var(--secondary-color); }
        #adv-mini-missions .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #adv-mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        #adv-mini-missions .mission pre { background: var(--background-medium); padding: 8px; border-radius: 4px; display: inline-block; margin: 5px 0; color: var(--text-dark); font-family: var(--code-font); font-size: 0.95em; line-height: 1.4; border: 1px solid #ccc; white-space: pre; }

        /* --- Final Section --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design --- */
        @media (max-width: 768px) { /* Shared styles */ html { font-size: 15px; } .practice-header h1 { font-size: 2.2rem; } .practice-section h2 { font-size: 1.6rem; } .interactive-area { padding: 1.5rem; } .piece { padding: 6px 10px; font-size: 0.95rem; } .feedback-icon-placeholder { width: 25px; margin-right: 8px; font-size: 1.1rem;} .button-group { flex-direction: column; align-items: center; }
             #multi-drop-zone { min-height: 80px; padding: 10px; }
             /* Nav */ .minimal-nav { min-width: 180px; } .minimal-nav ul { max-height: calc(100vh - 130px); /* Adjust max-height for smaller screens */ } .minimal-nav ul li a { padding: 0.6rem 0.8rem; } #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) { /* Shared styles */ html { font-size: 14px; } .practice-header h1 { font-size: 1.8rem; } .practice-header p { font-size: 1rem; } .practice-section h2 { font-size: 1.4rem; } .interactive-area { padding: 1rem; } .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;} .feedback-icon-placeholder { width: 20px; margin-right: 5px; font-size: 1rem;} .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            #adv-code-simulator .sim-editor, #adv-code-simulator .sim-output-area { font-size: 0.9rem; } #spot-tricky-comment .code-line-check { padding: 8px 12px; font-size: 0.9rem;} #adv-mini-missions .mission-editor { min-height: 90px; font-size: 0.95rem;} #adv-mini-missions .mission-output { font-size: 0.95rem;} #code-correction .correction-item { padding: 1rem; } #output-prediction .prediction-item { padding: 1rem; } .action-button.smaller-button { padding: 0.5rem 1rem; font-size: 0.85rem; }
             /* Nav */ .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; } .minimal-nav { top: 48px; right: 10px; min-width: 160px; } .minimal-nav ul { max-height: calc(100vh - 100px); } .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;} .minimal-nav ul li a i.fas { margin-right: 8px; } #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu" aria-expanded="false">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <li><a href="ctp-theory-0.html"><i class="fas fa-book-open fa-fw"></i> <span data-translate="nav_theory">Theory M0</span></a></li>
            <li><a href="ctp-practice-0.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_basic_practice">Basic Practice M0</span></a></li>
             <li><a href="ctp-video-0.html"><i class="fas fa-play-circle fa-fw"></i> <span data-translate="nav_video">Video Lesson M0</span></a></li>
            <li><a href="ctp.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
             <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
             <!-- Same-page links -->
             <li><a href="#anatomy-advanced"><i class="fas fa-search-plus fa-fw"></i> <span data-translate="nav_anatomy_adv">Anatomy Revisited</span></a></li>
             <li><a href="#build-multi-print"><i class="fas fa-stream fa-fw"></i> <span data-translate="nav_build_multi">Build Multiple</span></a></li>
             <li><a href="#adv-code-simulator"><i class="fas fa-terminal fa-fw"></i> <span data-translate="nav_simulator_adv">Adv. Simulator</span></a></li>
             <li><a href="#spot-tricky-comment"><i class="fas fa-user-secret fa-fw"></i> <span data-translate="nav_spot_tricky">Tricky Comments</span></a></li>
             <li><a href="#code-correction"><i class="fas fa-wrench fa-fw"></i> <span data-translate="nav_correction">Code Correction</span></a></li>
             <li><a href="#output-prediction"><i class="fas fa-eye fa-fw"></i> <span data-translate="nav_prediction">Output Prediction</span></a></li>
             <li><a href="#adv-mini-missions"><i class="fas fa-bolt fa-fw"></i> <span data-translate="nav_missions_adv">Adv. Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <header class="practice-header">
        <i class="fas fa-rocket header-icon icon1"></i>
        <i class="fas fa-cogs header-icon icon2"></i>
        <div class="container">
            <h1 data-translate="header_title">Module 0: Advanced Practice</h1>
            <p data-translate="header_subtitle">You've grasped the basics. Let's solidify your understanding with more challenging tasks!</p>
        </div>
    </header>

    <main>
        <!-- ========= Activity 1: Anatomy Revisited ========= -->
        <section id="anatomy-advanced" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-search-plus"></i> <span data-translate="anatomy_adv_title">Anatomy Revisited</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="anatomy_adv_desc">
                     Let's look closer. This code uses `print()` multiple times, including one to create a blank line. Click each highlighted part to identify its role. The explanations will appear below (scroll if needed!).
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
<span class="code-part" data-part="comment1" data-translate-title="tooltip_click_identify"><span class="code-comment"># First, greet the user</span></span>
<span class="code-part" data-part="function1" data-translate-title="tooltip_click_identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open1" data-translate-title="tooltip_click_identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="string1" data-translate-title="tooltip_click_identify"><span class="code-string">"Welcome, Master Coder!"</span></span><!--
--><span class="code-part" data-part="paren-close1" data-translate-title="tooltip_click_identify"><span class="code-paren">)</span></span>
<span class="code-part" data-part="function2" data-translate-title="tooltip_click_identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open2" data-translate-title="tooltip_click_identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="paren-close2" data-translate-title="tooltip_click_identify"><span class="code-paren">)</span></span><!--
--> <span class="code-part" data-part="comment2" data-translate-title="tooltip_click_identify"><span class="code-comment"># Print a blank line for spacing</span></span>
<span class="code-part" data-part="function3" data-translate-title="tooltip_click_identify"><span class="code-function">print</span></span><!--
--><span class="code-part" data-part="paren-open3" data-translate-title="tooltip_click_identify"><span class="code-paren">(</span></span><!--
--><span class="code-part" data-part="string2" data-translate-title="tooltip_click_identify"><span class="code-string">"Let's begin."</span></span><!--
--><span class="code-part" data-part="paren-close3" data-translate-title="tooltip_click_identify"><span class="code-paren">)</span></span>
                     </div>
                     <div id="anatomy-advanced-explanations">
                         <!-- Explanations added by JS here -->
                     </div>
                     <p id="anatomy-advanced-status" data-translate="anatomy_adv_status_initial" data-translate-replacements='{"total": 13}'>Identify all 13 parts!</p>
                     <div id="anatomy-advanced-feedback" class="feedback-message"></div>
                       <!-- Hidden explanations for JS -->
                     <div id="explanation-texts-adv" style="display: none;">
                        <span data-key="comment1" data-translate="anatomy_adv_exp_comment1">Comment: Explains the following code.</span>
                        <span data-key="function1" data-translate="anatomy_adv_exp_function1">Function: `print` command.</span>
                        <span data-key="paren-open1" data-translate="anatomy_adv_exp_paren_open1">Opening Parenthesis: Starts function input.</span>
                        <span data-key="string1" data-translate="anatomy_adv_exp_string1">String: Text to be printed.</span>
                        <span data-key="paren-close1" data-translate="anatomy_adv_exp_paren_close1">Closing Parenthesis: Ends function input.</span>
                        <span data-key="function2" data-translate="anatomy_adv_exp_function2">Function: Another `print` command.</span>
                        <span data-key="paren-open2" data-translate="anatomy_adv_exp_paren_open2">Opening Parenthesis: Starts input.</span>
                        <span data-key="paren-close2" data-translate="anatomy_adv_exp_paren_close2">Closing Parenthesis: Ends input (empty print = blank line).</span>
                        <span data-key="comment2" data-translate="anatomy_adv_exp_comment2">Comment: Explains the blank line print.</span>
                        <span data-key="function3" data-translate="anatomy_adv_exp_function3">Function: Final `print` command.</span>
                        <span data-key="paren-open3" data-translate="anatomy_adv_exp_paren_open3">Opening Parenthesis: Starts input.</span>
                        <span data-key="string2" data-translate="anatomy_adv_exp_string2">String: More text to print.</span>
                        <span data-key="paren-close3" data-translate="anatomy_adv_exp_paren_close3">Closing Parenthesis: Ends input.</span>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Build Multiple Prints ========= -->
        <section id="build-multi-print" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-stream"></i> <span data-translate="build_multi_title">Build Multiple Print Statements</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="build_multi_desc">
                     Drag the pieces to construct <strong>two lines</strong> of Python code in the drop zone below.
                     Line 1 should print: `"AI is powerful."`
                     Line 2 should print: `"Handle with care."`
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="multi-draggable-pieces" class="draggable-pieces">
                         <!-- Pieces populated by JS -->
                     </div>
                     <div id="multi-drop-zone" class="code-font">
                         <span id="multi-drop-zone-placeholder" data-translate="build_multi_placeholder">Drop pieces here to build two lines...</span>
                     </div>
                     <div class="text-center">
                         <button id="check-multi-build-btn" class="action-button" data-translate="button_check_code">Check My Code</button>
                         <button id="reset-multi-build-btn" class="action-button secondary" data-translate="button_reset">Reset</button>
                     </div>
                     <div id="multi-build-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Advanced Code Simulator ========= -->
        <section id="adv-code-simulator" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-terminal"></i> <span data-translate="simulator_adv_title">Advanced Code Simulator</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="simulator_adv_desc">
                     Write Python code in the editor to produce the following output <strong>exactly</strong>, including the blank line between the text lines:
                     <div class="example-output"><pre>> Line One

> Line Three</pre></div>
                     Use three separate `print()` commands. Add a comment explaining the purpose of the second `print()`.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="adv-sim-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="editor_label">Code Editor:</label>
                     <textarea id="adv-sim-editor-input" class="sim-editor" rows="5" data-translate-placeholder="simulator_adv_placeholder" placeholder='print("Line One")\n# Comment explaining the next line\nprint()\nprint("Line Three")'></textarea>
                     <div class="text-center">
                          <button id="run-adv-sim-btn" class="action-button" data-translate="button_run_sim">Run Simulation</button>
                     </div>
                     <label for="adv-sim-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="output_label">Simulated Output:</label>
                     <div id="adv-sim-output" class="sim-output-area">
                         <span class="placeholder" data-translate="output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="adv-sim-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4: Spot the Tricky Comment ========= -->
        <section id="spot-tricky-comment" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-user-secret"></i> <span data-translate="spot_tricky_title">Spot the Tricky Comment</span></h2>
                <p class="section-description fade-in delay-1" data-translate="spot_tricky_desc">
                    Comments can be tricky! Click on <strong>all</strong> lines below that are entirely comments or contain a comment at the end. Remember the rules!
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="tricky-comment-lines">
                        <!-- Lines generated by JS -->
                    </div>
                     <div class="text-center">
                         <button id="check-tricky-comment-btn" class="action-button" data-translate="button_check_selection">Check Selection</button>
                         <button id="reset-tricky-comment-btn" class="action-button secondary hidden" data-translate="button_try_again">Try Again</button>
                     </div>
                     <div id="tricky-comment-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 5: Code Correction Challenge ========= -->
        <section id="code-correction" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-wrench"></i> <span data-translate="correction_title">Code Correction Challenge</span></h2>
                <p class="section-description fade-in delay-1" data-translate="correction_desc">
                    Uh oh! Spot the errors in each snippet and type the corrected code in the editor below it. Check for typos, missing symbols, and correct `print()` usage.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <!-- Correction Item 1 -->
                    <div class="correction-item" id="correction-1" data-completed="false">
                         <h4 data-translate="correction1_title">Challenge 1: Wrong Function Name</h4>
                         <p data-translate="correction1_goal">Goal: Print the text "Syntax matters!"</p>
                         <div class="broken-code">prnt("Syntax matters!")</div>
                         <label for="correction-editor-1" data-translate="correction_label">Your Correction:</label>
                         <textarea id="correction-editor-1" class="correction-editor" rows="2" data-translate-placeholder="correction_placeholder" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="1" data-translate="button_check_fix_1">Check Fix 1</button>
                              <span class="correction-status" id="correction-status-1"><i class="fas fa-question-circle"></i></span>
                         </div>
                         <div id="correction-feedback-1" class="feedback-message"></div>
                    </div>
                    <!-- Correction Item 2 -->
                    <div class="correction-item" id="correction-2" data-completed="false">
                         <h4 data-translate="correction2_title">Challenge 2: Missing Parentheses</h4>
                         <p data-translate="correction2_goal">Goal: Print the text "Python is fun"</p>
                         <div class="broken-code">print "Python is fun"</div>
                         <label for="correction-editor-2" data-translate="correction_label">Your Correction:</label>
                         <textarea id="correction-editor-2" class="correction-editor" rows="2" data-translate-placeholder="correction_placeholder" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="2" data-translate="button_check_fix_2">Check Fix 2</button>
                              <span class="correction-status" id="correction-status-2"><i class="fas fa-question-circle"></i></span>
                         </div>
                          <div id="correction-feedback-2" class="feedback-message"></div>
                    </div>
                     <!-- Correction Item 3 -->
                    <div class="correction-item" id="correction-3" data-completed="false">
                         <h4 data-translate="correction3_title">Challenge 3: Missing Quotes</h4>
                         <p data-translate="correction3_goal">Goal: Print the text: Hello</p>
                         <div class="broken-code">print(Hello)</div>
                         <label for="correction-editor-3" data-translate="correction_label">Your Correction:</label>
                         <textarea id="correction-editor-3" class="correction-editor" rows="2" data-translate-placeholder="correction_placeholder" placeholder='Fix the code here...'></textarea>
                         <div class="text-center">
                              <button class="action-button correction-check-btn" data-correction-id="3" data-translate="button_check_fix_3">Check Fix 3</button>
                               <span class="correction-status" id="correction-status-3"><i class="fas fa-question-circle"></i></span>
                         </div>
                          <div id="correction-feedback-3" class="feedback-message"></div>
                    </div>
                    <div id="correction-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 6: Output Prediction ========= -->
        <section id="output-prediction" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-eye"></i> <span data-translate="prediction_title">Output Prediction</span></h2>
                <p class="section-description fade-in delay-1" data-translate="prediction_desc">
                    Read the Python code snippets carefully. What will each one actually print? Select the correct output. Pay close attention to comments and blank `print()` calls! If you get it wrong, you can try again.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <!-- Prediction Item 1 -->
                    <div class="prediction-item" id="prediction-1" data-correct-option="B" data-completed="false">
                         <h4 data-translate="prediction1_title">Prediction 1</h4>
                         <div class="code-to-predict code-block"><span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Step 1"</span><span class="code-paren">)</span>
<span class="code-comment"># Skip Step 2 for now</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Step 3"</span><span class="code-paren">)</span></div>
                         <label class="options-label" data-translate="prediction_choose_label">Choose the output:</label>
                         <label class="prediction-option"><input type="radio" name="predict-1" value="A"> <span><pre>> Step 1
> # Skip Step 2 for now
> Step 3</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-1" value="B"> <span><pre>> Step 1
> Step 3</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-1" value="C"> <span><pre>> Step 1 Step 3</pre></span></label>
                         <div class="text-center"> <button class="action-button prediction-check-btn" data-prediction-id="1" data-translate="button_check_prediction_1">Check Prediction 1</button> </div>
                         <div id="prediction-feedback-1" class="feedback-message"></div>
                    </div>
                    <!-- Prediction Item 2 -->
                    <div class="prediction-item" id="prediction-2" data-correct-option="C" data-completed="false">
                         <h4 data-translate="prediction2_title">Prediction 2</h4>
                         <div class="code-to-predict code-block"><span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"Start"</span><span class="code-paren">)</span> <span class="code-comment"># Begin process</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-paren">)</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-string">"End"</span><span class="code-paren">)</span></div>
                         <label class="options-label" data-translate="prediction_choose_label">Choose the output:</label>
                         <label class="prediction-option"><input type="radio" name="predict-2" value="A"> <span><pre>> Start # Begin process

> End</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-2" value="B"> <span><pre>> Start
> End</pre></span></label>
                         <label class="prediction-option"><input type="radio" name="predict-2" value="C"> <span><pre>> Start

> End</pre></span></label>
                         <div class="text-center"> <button class="action-button prediction-check-btn" data-prediction-id="2" data-translate="button_check_prediction_2">Check Prediction 2</button> </div>
                         <div id="prediction-feedback-2" class="feedback-message"></div>
                    </div>
                     <div id="prediction-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </section>


         <!-- ========= Activity 7: Advanced Mini Missions ========= -->
        <section id="adv-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-bolt"></i> <span data-translate="missions_adv_title">Advanced Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_adv_desc">
                     Final challenge! Complete these missions precisely. Pay attention to exact text, blank lines, and comment placement. The required output is shown below each mission.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 (Advanced) -->
                     <div class="mission" id="adv-mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission1_title">Mission 1: Precise Greeting</h4>
                         <p data-translate="adv_mission1_desc">Write Python code to print the following two lines exactly:</p>
                         <pre>> Hello, Pythonista!
> Ready to code?</pre>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission1_placeholder" placeholder='Use two print() commands...'></textarea>
                         <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-1"></div>
                     </div>
                     <!-- Mission 2 (Advanced) -->
                     <div class="mission" id="adv-mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission2_title">Mission 2: Message with Spacer</h4>
                         <p data-translate="adv_mission2_desc">Print the message "Processing...", then print a blank line, then print "Done.". Use three `print()` commands. Required output:</p>
                         <pre>> Processing...

> Done.</pre>
                         <textarea class="sim-editor mission-editor" rows="5" data-translate-placeholder="adv_mission2_placeholder" placeholder='print("...")\nprint()\nprint("...")'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-2"></div>
                     </div>
                     <!-- Mission 3 (Advanced) -->
                     <div class="mission" id="adv-mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission3_title">Mission 3: Comment First, Then Print</h4>
                         <p data-translate="adv_mission3_desc">First, write a comment: `# Displaying status.` On the next line, print the text: `Status: OK`. Required output:</p>
                         <pre>> Status: OK</pre>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission3_placeholder" placeholder='# Your comment here\nprint("...")'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-3"></div>
                     </div>
                      <!-- Mission 4 (Advanced) -->
                     <div class="mission" id="adv-mission-4" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission4_title">Mission 4: Print with Trailing Comment</h4>
                         <p data-translate="adv_mission4_desc">Print the text `"Important message"`. Add a comment *after* the code on the same line: `# Needs attention`. Required output:</p>
                         <pre>> Important message</pre>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission4_placeholder" placeholder='print(...) # Your comment here'></textarea>
                          <div class="text-center"> <button class="action-button adv-mission-run-btn" data-mission-id="4" data-translate="button_test_mission_4">Test Mission 4</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div class="feedback-message mission-feedback" id="adv-mission-feedback-4"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in">
                    <i class="fas fa-star"></i> <i class="fas fa-trophy"></i> <i class="fas fa-star"></i>
                </div>
                <h2 class="fade-in delay-1" data-translate="completion_title">Advanced Practice Mastered!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Outstanding! You've conquered the advanced challenges for Module 0.<br>
                    You have a strong grasp of `print()` and comments. Time for the video lesson!
                </p>
                <div class="button-group">
                    <a href="ctp-theory-0.html" class="action-button secondary fade-in delay-3"><i class="fas fa-book-open"></i> <span data-translate="button_review_theory">Review Theory</span></a>
                    <a href="ctp-practice-0.html" class="action-button secondary fade-in delay-3"><i class="fas fa-level-down-alt"></i> <span data-translate="button_revisit_basic">Revisit Basic Practice</span></a>
                    <a href="ctp-video-0.html" class="action-button success fade-in delay-4"><i class="fas fa-play-circle"></i> <span data-translate="button_proceed_video">Proceed to Video Lesson</span></a>
                    <a href="ctp.html" class="action-button smaller-button fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="nav_menu">Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <script>
    // --- Translations Object (Comprehensive) ---
    const translations = {
        en: {
            "page_title": "Module 0: Advanced Python Practice!",
            "tooltip_click_identify": "Click to identify this part",
            // Nav
            "nav_theory": "Theory M0", "nav_basic_practice": "Basic Practice M0", "nav_video": "Video Lesson M0", "nav_menu": "Course Menu",
            "nav_anatomy_adv": "Anatomy Revisited", "nav_build_multi": "Build Multiple", "nav_simulator_adv": "Adv. Simulator", "nav_spot_tricky": "Tricky Comments",
            "nav_correction": "Code Correction", "nav_prediction": "Output Prediction", "nav_missions_adv": "Adv. Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "Module 0: Advanced Practice", "header_subtitle": "You've grasped the basics. Let's solidify your understanding with more challenging tasks!",
            // Anatomy Adv
            "anatomy_adv_title": "Anatomy Revisited", "anatomy_adv_desc": "Let's look closer. This code uses `print()` multiple times, including one to create a blank line. Click each highlighted part to identify its role. The explanations will appear below (scroll if needed!).",
            "anatomy_adv_status_initial": "Identify all {total} parts!", "anatomy_adv_status_progress": "Identified {count} of {total} parts.", "anatomy_adv_status_done": "All parts identified!",
            "anatomy_adv_exp_comment1": "Comment: Explains the following code.",
            "anatomy_adv_exp_function1": "Function: `print` command.", "anatomy_adv_exp_paren_open1": "Opening Parenthesis: Starts function input.", "anatomy_adv_exp_string1": "String: Text to be printed.", "anatomy_adv_exp_paren_close1": "Closing Parenthesis: Ends function input.",
            "anatomy_adv_exp_function2": "Function: Another `print` command.", "anatomy_adv_exp_paren_open2": "Opening Parenthesis: Starts input.", "anatomy_adv_exp_paren_close2": "Closing Parenthesis: Ends input (empty print = blank line).",
            "anatomy_adv_exp_comment2": "Comment: Explains the blank line print.",
            "anatomy_adv_exp_function3": "Function: Final `print` command.", "anatomy_adv_exp_paren_open3": "Opening Parenthesis: Starts input.", "anatomy_adv_exp_string2": "String: More text to print.", "anatomy_adv_exp_paren_close3": "Closing Parenthesis: Ends input.",
            "feedback_anatomy_adv_correct": "Excellent! You dissected the code perfectly!",
            // Build Multi
            "build_multi_title": "Build Multiple Print Statements", "build_multi_desc": "Drag the pieces to construct <strong>two lines</strong> of Python code in the drop zone below. Line 1 should print: `\"AI is powerful.\"` Line 2 should print: `\"Handle with care.\"`",
            "build_multi_placeholder": "Drop pieces here to build two lines...",
            "feedback_build_multi_correct": "Perfect! Both lines constructed correctly!", "feedback_build_multi_num_lines": "Incorrect number of lines built ({count}). Need exactly 2.", "feedback_build_multi_error_line1": "Line 1 has errors (check pieces, order, or text).", "feedback_build_multi_error_line2": "Line 2 has errors (check pieces, order, or text).", "feedback_build_multi_errors_combined": "Almost! {errors}",
            // Sim Adv
            "simulator_adv_title": "Advanced Code Simulator", "simulator_adv_desc": "Write Python code in the editor to produce the following output <strong>exactly</strong>, including the blank line between the text lines:\n<div class=\"example-output\"><pre>> Line One\n\n> Line Three</pre></div>\nUse three separate `print()` commands. Add a comment explaining the purpose of the second `print()`.",
            "editor_label": "Code Editor:", "simulator_adv_placeholder": 'print("Line One")\\n# Comment explaining the next line\\nprint()\\nprint("Line Three")',
            "output_label": "Simulated Output:", "output_placeholder": "Output will appear here...",
            "feedback_sim_adv_syntax_error": "Simulation failed due to syntax errors.", "feedback_sim_adv_success": "Perfect! Output matches exactly, and comment is placed correctly.", "feedback_sim_adv_warning": "Output generated, but doesn't meet all requirements. {issues}",
            "sim_adv_issue_output": "Check the printed text and the blank line.", "sim_adv_issue_count": "Used {count} print commands, expected 3.", "sim_adv_issue_comment": "Missing the required comment before the blank line print.",
             // Spot Tricky
            "spot_tricky_title": "Spot the Tricky Comment", "spot_tricky_desc": "Comments can be tricky! Click on <strong>all</strong> lines below that are entirely comments or contain a comment at the end. Remember the rules!",
            "spot_tricky_line_1": "print(\"Starting analysis...\") # Main entry point",
            "spot_tricky_line_2": "# Configuration settings",
            "spot_tricky_line_3": "data = load_data()",
            "spot_tricky_line_4": "# print(\"Debug value:\", x) # Old debug line",
            "spot_tricky_line_5": "process(data) # Run the core logic",
            "spot_tricky_line_6": "## Section Separator ##",
            "spot_tricky_line_7": "print(\"# Not a comment inside string\") ",
            "spot_tricky_line_8": "#",
            "feedback_spot_tricky_correct": "Perfect! You identified all {totalComments} tricky comments/lines with comments. <i class=\"fas fa-thumbs-up\"></i>",
            "feedback_spot_tricky_incorrect": "Not quite right. {hints}. Remember comments start with '#', even after code! But '#' inside quotes is just text.",
            "feedback_spot_hint_incorrect": "{count} incorrect selection(s) marked with <i class=\"fas fa-times\"></i>",
            "feedback_spot_hint_missed": "{count} missed comment(s) marked with <i class=\"fas fa-eye\"></i>",
            "feedback_spot_hints_joiner": ", and ",
            // Correction
            "correction_title": "Code Correction Challenge", "correction_desc": "Uh oh! Spot the errors in each snippet and type the corrected code in the editor below it. Check for typos, missing symbols, and correct `print()` usage.",
            "correction1_title": "Challenge 1: Wrong Function Name", "correction1_goal": "Goal: Print the text \"Syntax matters!\"",
            "correction2_title": "Challenge 2: Missing Parentheses", "correction2_goal": "Goal: Print the text \"Python is fun\"",
            "correction3_title": "Challenge 3: Missing Quotes", "correction3_goal": "Goal: Print the text: Hello",
            "correction_label": "Your Correction:", "correction_placeholder": "Fix the code here...",
            "button_check_fix_1": "Check Fix 1", "button_check_fix_2": "Check Fix 2", "button_check_fix_3": "Check Fix 3",
            "feedback_correction_correct": "Correct! Well spotted!", "feedback_correction_incorrect": "Incorrect. {hint}",
            "correction_hint_1": "Check the function name spelling.", "correction_hint_2": "Remember, the `print` function needs parentheses `()` around what you want to print.", "correction_hint_3": "Text you want to print needs to be inside quotes `\"\"` or `''`.", "correction_hint_generic": "Review the required syntax and compare with your code.",
            "feedback_correction_summary_all": "Excellent! All {total} corrections made successfully!", "feedback_correction_summary_progress": "Completed {count} of {total} corrections. Keep debugging!",
            // Prediction
            "prediction_title": "Output Prediction", "prediction_desc": "Read the Python code snippets carefully. What will each one actually print? Select the correct output. Pay close attention to comments and blank `print()` calls! If you get it wrong, you can try again.",
            "prediction1_title": "Prediction 1", "prediction2_title": "Prediction 2",
            "prediction_choose_label": "Choose the output:",
            "button_check_prediction_1": "Check Prediction 1", "button_check_prediction_2": "Check Prediction 2",
            "feedback_prediction_select_option": "Please select an option first.", "feedback_prediction_correct": "Correct! You predicted the output accurately.", "feedback_prediction_incorrect": "Not quite. The correct output was Option {correctOption}. Think about how comments and blank prints affect output. Try again!",
            "feedback_prediction_summary_all": "Awesome! All {total} predictions were correct!", "feedback_prediction_summary_progress": "Made {count} of {total} correct predictions.",
            // Missions Adv
            "missions_adv_title": "Advanced Mini Missions!", "missions_adv_desc": "Final challenge! Complete these missions precisely. Pay attention to exact text, blank lines, and comment placement. The required output is shown below each mission.",
            "adv_mission1_title": "Mission 1: Precise Greeting", "adv_mission1_desc": "Write Python code to print the following two lines exactly:", "adv_mission1_placeholder": "Use two print() commands...",
            "adv_mission2_title": "Mission 2: Message with Spacer", "adv_mission2_desc": "Print the message \"Processing...\", then print a blank line, then print \"Done.\". Use three `print()` commands. Required output:", "adv_mission2_placeholder": 'print("...")\\nprint()\\nprint("...")',
            "adv_mission3_title": "Mission 3: Comment First, Then Print", "adv_mission3_desc": "First, write a comment: `# Displaying status.` On the next line, print the text: `Status: OK`. Required output:", "adv_mission3_placeholder": '# Your comment here\\nprint("...")',
            "adv_mission4_title": "Mission 4: Print with Trailing Comment", "adv_mission4_desc": "Print the text `\"Important message\"`. Add a comment *after* the code on the same line: `# Needs attention`. Required output:", "adv_mission4_placeholder": 'print(...) # Your comment here',
            "feedback_adv_mission_success": "Mission Accomplished! Code is correct.", "feedback_adv_mission_syntax": "Simulation Error", "feedback_adv_mission_fail": "Incorrect. Review mission requirements: check syntax, exact text, line breaks, and comments.", // Generic fail message
            "adv_mission1_hint": "Did you use two separate `print` commands with the exact text?", // Added hint key
            "adv_mission2_hint": "Ensure you have three `print` commands in the correct order (text, blank, text).", // Added hint key
            "adv_mission3_hint": "Is the comment `# Displaying status.` on the very first line, and the `print` command on the next?", // Added hint key
            "adv_mission4_hint": "Check the `print` command syntax and make sure the comment `# Needs attention` is on the *same line* after the closing parenthesis.", // Added hint key
            "feedback_adv_mission_summary_all": "All {total} advanced missions complete! Master Coder!", "feedback_adv_mission_summary_progress": "Completed {count} of {total} advanced missions. Almost there!",
            // Completion
            "completion_title": "Advanced Practice Mastered!", "completion_desc": "Outstanding! You've conquered the advanced challenges for Module 0.<br>You have a strong grasp of `print()` and comments. Time for the video lesson!",
            "button_review_theory": "Review Theory", "button_revisit_basic": "Revisit Basic Practice", "button_proceed_video": "Proceed to Video Lesson",
             // Shared Buttons (Ensure consistency)
             "button_check_code": "Check My Code", "button_reset": "Reset", "button_run_sim": "Run Simulation", "button_check_selection": "Check Selection", "button_try_again": "Try Again",
             "button_test_mission_1": "Test Mission 1", "button_test_mission_2": "Test Mission 2", "button_test_mission_3": "Test Mission 3", "button_test_mission_4": "Test Mission 4"
        },
        pt: {
             "page_title": "Módulo 0: Prática Avançada de Python!",
            "tooltip_click_identify": "Clique para identificar esta parte",
            // Nav
            "nav_theory": "Teoria M0", "nav_basic_practice": "Prática Básica M0", "nav_video": "Videoaula M0", "nav_menu": "Menu do Curso",
            "nav_anatomy_adv": "Anatomia Revisitada", "nav_build_multi": "Construir Múltiplos", "nav_simulator_adv": "Simulador Avançado", "nav_spot_tricky": "Comentários Capciosos",
            "nav_correction": "Correção de Código", "nav_prediction": "Previsão de Saída", "nav_missions_adv": "Missões Avançadas",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "Módulo 0: Prática Avançada", "header_subtitle": "Você compreendeu o básico. Vamos solidificar seu entendimento com tarefas mais desafiadoras!",
            // Anatomy Adv
            "anatomy_adv_title": "Anatomia Revisitada", "anatomy_adv_desc": "Vamos olhar mais de perto. Este código usa `print()` várias vezes, incluindo uma para criar uma linha em branco. Clique em cada parte destacada para identificar seu papel. As explicações aparecerão abaixo (role se necessário!).",
            "anatomy_adv_status_initial": "Identifique todas as {total} partes!", "anatomy_adv_status_progress": "Identificadas {count} de {total} partes.", "anatomy_adv_status_done": "Todas as partes identificadas!",
            "anatomy_adv_exp_comment1": "Comentário: Explica o código seguinte.",
            "anatomy_adv_exp_function1": "Função: comando `print`.", "anatomy_adv_exp_paren_open1": "Parêntese de Abertura: Inicia a entrada da função.", "anatomy_adv_exp_string1": "String: Texto a ser impresso.", "anatomy_adv_exp_paren_close1": "Parêntese de Fechamento: Termina a entrada da função.",
            "anatomy_adv_exp_function2": "Função: Outro comando `print`.", "anatomy_adv_exp_paren_open2": "Parêntese de Abertura: Inicia a entrada.", "anatomy_adv_exp_paren_close2": "Parêntese de Fechamento: Termina a entrada (print vazio = linha em branco).",
            "anatomy_adv_exp_comment2": "Comentário: Explica o print da linha em branco.",
            "anatomy_adv_exp_function3": "Função: Comando `print` final.", "anatomy_adv_exp_paren_open3": "Parêntese de Abertura: Inicia a entrada.", "anatomy_adv_exp_string2": "String: Mais texto para imprimir.", "anatomy_adv_exp_paren_close3": "Parêntese de Fechamento: Termina a entrada.",
            "feedback_anatomy_adv_correct": "Excelente! Você dissecou o código perfeitamente!",
            // Build Multi
            "build_multi_title": "Construir Múltiplas Declarações Print", "build_multi_desc": "Arraste as peças para construir <strong>duas linhas</strong> de código Python na zona de soltar abaixo. Linha 1 deve imprimir: `\"AI is powerful.\"` Linha 2 deve imprimir: `\"Handle with care.\"`",
            "build_multi_placeholder": "Solte as peças aqui para construir duas linhas...",
            "feedback_build_multi_correct": "Perfeito! Ambas as linhas construídas corretamente!", "feedback_build_multi_num_lines": "Número incorreto de linhas construídas ({count}). Precisa de exatamente 2.", "feedback_build_multi_error_line1": "A Linha 1 tem erros (verifique peças, ordem ou texto).", "feedback_build_multi_error_line2": "A Linha 2 tem erros (verifique peças, ordem ou texto).", "feedback_build_multi_errors_combined": "Quase lá! {errors}",
            // Sim Adv
            "simulator_adv_title": "Simulador de Código Avançado", "simulator_adv_desc": "Escreva código Python no editor para produzir a seguinte saída <strong>exatamente</strong>, incluindo a linha em branco entre as linhas de texto:\n<div class=\"example-output\"><pre>> Line One\n\n> Line Three</pre></div>\nUse três comandos `print()` separados. Adicione um comentário explicando o propósito do segundo `print()`.",
            "editor_label": "Editor de Código:", "simulator_adv_placeholder": 'print("Line One")\\n# Comentário explicando a próxima linha\\nprint()\\nprint("Line Three")',
            "output_label": "Saída Simulada:", "output_placeholder": "A saída aparecerá aqui...",
            "feedback_sim_adv_syntax_error": "Simulação falhou devido a erros de sintaxe.", "feedback_sim_adv_success": "Perfeito! A saída corresponde exatamente e o comentário está posicionado corretamente.", "feedback_sim_adv_warning": "Saída gerada, mas não atende a todos os requisitos. {issues}",
            "sim_adv_issue_output": "Verifique o texto impresso e a linha em branco.", "sim_adv_issue_count": "Usou {count} comandos print, esperados 3.", "sim_adv_issue_comment": "Falta o comentário necessário antes do print da linha em branco.",
             // Spot Tricky
            "spot_tricky_title": "Ache o Comentário Capcioso", "spot_tricky_desc": "Comentários podem ser capciosos! Clique em <strong>todas</strong> as linhas abaixo que são inteiramente comentários ou contêm um comentário no final. Lembre-se das regras!",
            "spot_tricky_line_1": "print(\"Iniciando análise...\") # Ponto de entrada principal",
            "spot_tricky_line_2": "# Configurações",
            "spot_tricky_line_3": "dados = carregar_dados()",
            "spot_tricky_line_4": "# print(\"Valor de depuração:\", x) # Linha de depuração antiga",
            "spot_tricky_line_5": "processar(dados) # Executa a lógica principal",
            "spot_tricky_line_6": "## Separador de Seção ##",
            "spot_tricky_line_7": "print(\"# Não é um comentário dentro da string\") ",
            "spot_tricky_line_8": "#",
            "feedback_spot_tricky_correct": "Perfeito! Você identificou todos os {totalComments} comentários capciosos/linhas com comentários. <i class=\"fas fa-thumbs-up\"></i>",
            "feedback_spot_tricky_incorrect": "Não foi bem assim. {hints}. Lembre-se que comentários começam com '#', mesmo depois do código! Mas '#' dentro de aspas é apenas texto.",
            "feedback_spot_hint_incorrect": "{count} seleção(ões) incorreta(s) marcada(s) com <i class=\"fas fa-times\"></i>",
            "feedback_spot_hint_missed": "{count} comentário(s) não encontrado(s) marcado(s) com <i class=\"fas fa-eye\"></i>",
            "feedback_spot_hints_joiner": ", e ",
            // Correction
            "correction_title": "Desafio de Correção de Código", "correction_desc": "Ops! Encontre os erros em cada trecho e digite o código corrigido no editor abaixo. Verifique erros de digitação, símbolos ausentes e uso correto de `print()`.",
            "correction1_title": "Desafio 1: Nome de Função Errado", "correction1_goal": "Objetivo: Imprimir o texto \"Syntax matters!\"",
            "correction2_title": "Desafio 2: Parênteses Ausentes", "correction2_goal": "Objetivo: Imprimir o texto \"Python is fun\"",
            "correction3_title": "Desafio 3: Aspas Ausentes", "correction3_goal": "Objetivo: Imprimir o texto: Hello",
            "correction_label": "Sua Correção:", "correction_placeholder": "Corrija o código aqui...",
            "button_check_fix_1": "Verificar Correção 1", "button_check_fix_2": "Verificar Correção 2", "button_check_fix_3": "Verificar Correção 3",
            "feedback_correction_correct": "Correto! Bem observado!", "feedback_correction_incorrect": "Incorreto. {hint}",
            "correction_hint_1": "Verifique a ortografia do nome da função.", "correction_hint_2": "Lembre-se, a função `print` precisa de parênteses `()` ao redor do que você quer imprimir.", "correction_hint_3": "O texto que você quer imprimir precisa estar dentro de aspas `\"\"` ou `''`.", "correction_hint_generic": "Revise a sintaxe necessária e compare com seu código.",
            "feedback_correction_summary_all": "Excelente! Todas as {total} correções feitas com sucesso!", "feedback_correction_summary_progress": "Completou {count} de {total} correções. Continue depurando!",
            // Prediction
            "prediction_title": "Previsão de Saída", "prediction_desc": "Leia os trechos de código Python com atenção. O que cada um realmente imprimirá? Selecione a saída correta. Preste muita atenção aos comentários e chamadas `print()` vazias! Se errar, você pode tentar novamente.",
            "prediction1_title": "Previsão 1", "prediction2_title": "Previsão 2",
            "prediction_choose_label": "Escolha a saída:",
            "button_check_prediction_1": "Verificar Previsão 1", "button_check_prediction_2": "Verificar Previsão 2",
            "feedback_prediction_select_option": "Por favor, selecione uma opção primeiro.", "feedback_prediction_correct": "Correto! Você previu a saída com precisão.", "feedback_prediction_incorrect": "Não foi bem assim. A saída correta era a Opção {correctOption}. Pense em como comentários e prints vazios afetam a saída. Tente novamente!",
            "feedback_prediction_summary_all": "Incrível! Todas as {total} previsões estavam corretas!", "feedback_prediction_summary_progress": "Fez {count} de {total} previsões corretas.",
            // Missions Adv
            "missions_adv_title": "Mini Missões Avançadas!", "missions_adv_desc": "Desafio final! Complete estas missões precisamente. Preste atenção ao texto exato, linhas em branco e posicionamento dos comentários. A saída necessária é mostrada abaixo de cada missão.",
            "adv_mission1_title": "Missão 1: Saudação Precisa", "adv_mission1_desc": "Escreva código Python para imprimir as duas linhas seguintes exatamente:", "adv_mission1_placeholder": "Use dois comandos print()...",
            "adv_mission2_title": "Missão 2: Mensagem com Espaçador", "adv_mission2_desc": "Imprima a mensagem \"Processing...\", depois imprima uma linha em branco, depois imprima \"Done.\". Use três comandos `print()`. Saída necessária:", "adv_mission2_placeholder": 'print("...")\\nprint()\\nprint("...")',
            "adv_mission3_title": "Missão 3: Comentário Primeiro, Depois Imprimir", "adv_mission3_desc": "Primeiro, escreva um comentário: `# Displaying status.` Na linha seguinte, imprima o texto: `Status: OK`. Saída necessária:", "adv_mission3_placeholder": '# Seu comentário aqui\\nprint("...")',
            "adv_mission4_title": "Missão 4: Imprimir com Comentário no Final", "adv_mission4_desc": "Imprima o texto `\"Important message\"`. Adicione um comentário *após* o código na mesma linha: `# Needs attention`. Saída necessária:", "adv_mission4_placeholder": 'print(...) # Seu comentário aqui',
            "feedback_adv_mission_success": "Missão Cumprida! Código está correto.", "feedback_adv_mission_syntax": "Erro de Simulação", "feedback_adv_mission_fail": "Incorreto. Revise os requisitos da missão: verifique sintaxe, texto exato, quebras de linha e comentários.",
            "adv_mission1_hint": "Você usou dois comandos `print` separados com o texto exato?",
            "adv_mission2_hint": "Certifique-se de ter três comandos `print` na ordem correta (texto, vazio, texto).",
            "adv_mission3_hint": "O comentário `# Displaying status.` está na primeira linha e o comando `print` na seguinte?",
            "adv_mission4_hint": "Verifique a sintaxe do comando `print` e certifique-se de que o comentário `# Needs attention` está na *mesma linha* após o parêntese de fechamento.",
            "feedback_adv_mission_summary_all": "Todas as {total} missões avançadas completas! Mestre Coder!", "feedback_adv_mission_summary_progress": "Completou {count} de {total} missões avançadas. Quase lá!",
            // Completion
            "completion_title": "Prática Avançada Dominada!", "completion_desc": "Excepcional! Você conquistou os desafios avançados do Módulo 0.<br>Você tem um forte domínio de `print()` e comentários. Hora da videoaula!",
            "button_review_theory": "Revisar Teoria", "button_revisit_basic": "Revisitar Prática Básica", "button_proceed_video": "Prosseguir para Videoaula",
             // Shared Buttons
             "button_check_code": "Verificar Código", "button_reset": "Reiniciar", "button_run_sim": "Executar Simulação", "button_check_selection": "Verificar Seleção", "button_try_again": "Tentar Novamente",
             "button_test_mission_1": "Testar Missão 1", "button_test_mission_2": "Testar Missão 2", "button_test_mission_3": "Testar Missão 3", "button_test_mission_4": "Testar Missão 4"
        },
        zh: {
            "page_title": "模块 0：高级 Python 练习！",
            "tooltip_click_identify": "点击识别此部分",
            // Nav
            "nav_theory": "理论 M0", "nav_basic_practice": "基础练习 M0", "nav_video": "视频课程 M0", "nav_menu": "课程菜单",
            "nav_anatomy_adv": "再探剖析", "nav_build_multi": "构建多行", "nav_simulator_adv": "高级模拟器", "nav_spot_tricky": "刁钻注释",
            "nav_correction": "代码纠错", "nav_prediction": "输出预测", "nav_missions_adv": "高级任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "模块 0：高级练习", "header_subtitle": "你已掌握基础。让我们通过更具挑战性的任务来巩固你的理解！",
            // Anatomy Adv
            "anatomy_adv_title": "再探剖析", "anatomy_adv_desc": "让我们仔细看看。这段代码多次使用 `print()`，包括一次用于创建空行。点击每个高亮部分以识别其作用。说明将显示在下方（如果需要，请滚动！）。",
            "anatomy_adv_status_initial": "识别所有 {total} 个部分！", "anatomy_adv_status_progress": "已识别 {count} / {total} 个部分。", "anatomy_adv_status_done": "所有部分已识别！",
            "anatomy_adv_exp_comment1": "注释：解释以下代码。",
            "anatomy_adv_exp_function1": "函数：`print` 命令。", "anatomy_adv_exp_paren_open1": "左括号：开始函数输入。", "anatomy_adv_exp_string1": "字符串：要打印的文本。", "anatomy_adv_exp_paren_close1": "右括号：结束函数输入。",
            "anatomy_adv_exp_function2": "函数：另一个 `print` 命令。", "anatomy_adv_exp_paren_open2": "左括号：开始输入。", "anatomy_adv_exp_paren_close2": "右括号：结束输入（空 print = 空行）。",
            "anatomy_adv_exp_comment2": "注释：解释空行 print。",
            "anatomy_adv_exp_function3": "函数：最后的 `print` 命令。", "anatomy_adv_exp_paren_open3": "左括号：开始输入。", "anatomy_adv_exp_string2": "字符串：更多要打印的文本。", "anatomy_adv_exp_paren_close3": "右括号：结束输入。",
            "feedback_anatomy_adv_correct": "太棒了！你完美地剖析了代码！",
            // Build Multi
            "build_multi_title": "构建多个 Print 语句", "build_multi_desc": "拖动碎片，在下面的放置区域构建<strong>两行</strong> Python 代码。第 1 行应打印：`\"AI is powerful.\"` 第 2 行应打印：`\"Handle with care.\"`",
            "build_multi_placeholder": "在此处放置碎片以构建两行...",
            "feedback_build_multi_correct": "完美！两行都已正确构建！", "feedback_build_multi_num_lines": "构建的行数（{count}）不正确。需要正好 2 行。", "feedback_build_multi_error_line1": "第 1 行有错误（检查碎片、顺序或文本）。", "feedback_build_multi_error_line2": "第 2 行有错误（检查碎片、顺序或文本）。", "feedback_build_multi_errors_combined": "差不多了！{errors}",
            // Sim Adv
            "simulator_adv_title": "高级代码模拟器", "simulator_adv_desc": "在编辑器中编写 Python 代码，以<strong>完全</strong>生成以下输出，包括文本行之间的空行：\n<div class=\"example-output\"><pre>> Line One\n\n> Line Three</pre></div>\n使用三个独立的 `print()` 命令。添加一个注释来解释第二个 `print()` 的目的。",
            "editor_label": "代码编辑器：", "simulator_adv_placeholder": 'print("Line One")\\n# 解释下一行的注释\\nprint()\\nprint("Line Three")',
            "output_label": "模拟输出：", "output_placeholder": "输出将显示在此处...",
            "feedback_sim_adv_syntax_error": "由于语法错误，模拟失败。", "feedback_sim_adv_success": "完美！输出完全匹配，注释位置正确。", "feedback_sim_adv_warning": "生成了输出，但不符合所有要求。{issues}",
            "sim_adv_issue_output": "检查打印的文本和空行。", "sim_adv_issue_count": "使用了 {count} 个 print 命令，应为 3 个。", "sim_adv_issue_comment": "空行 print 前缺少必需的注释。",
             // Spot Tricky
            "spot_tricky_title": "找出刁钻的注释", "spot_tricky_desc": "注释可能很棘手！点击下面<strong>所有</strong>完全是注释或末尾包含注释的行。记住规则！",
            "spot_tricky_line_1": "print(\"开始分析...\") # 主要入口点",
            "spot_tricky_line_2": "# 配置设置",
            "spot_tricky_line_3": "data = load_data()",
            "spot_tricky_line_4": "# print(\"调试值:\", x) # 旧的调试行",
            "spot_tricky_line_5": "process(data) # 运行核心逻辑",
            "spot_tricky_line_6": "## 分段符 ##",
            "spot_tricky_line_7": "print(\"# 这不是字符串内的注释\") ",
            "spot_tricky_line_8": "#",
            "feedback_spot_tricky_correct": "完美！你找出了所有 {totalComments} 个刁钻的注释/带注释的行。 <i class=\"fas fa-thumbs-up\"></i>",
            "feedback_spot_tricky_incorrect": "不太对。{hints}。记住注释以 '#' 开头，即使在代码之后也是！但引号内的 '#' 只是文本。",
            "feedback_spot_hint_incorrect": "{count} 个错误选择，已用 <i class=\"fas fa-times\"></i> 标记",
            "feedback_spot_hint_missed": "{count} 个遗漏的注释，已用 <i class=\"fas fa-eye\"></i> 标记",
            "feedback_spot_hints_joiner": "，并且 ",
            // Correction
            "correction_title": "代码纠错挑战", "correction_desc": "哎呀！找出每个片段中的错误，并在下面的编辑器中输入更正后的代码。检查拼写错误、缺少符号和 `print()` 的正确用法。",
            "correction1_title": "挑战 1：函数名错误", "correction1_goal": "目标：打印文本 \"Syntax matters!\"",
            "correction2_title": "挑战 2：缺少括号", "correction2_goal": "目标：打印文本 \"Python is fun\"",
            "correction3_title": "挑战 3：缺少引号", "correction3_goal": "目标：打印文本：Hello",
            "correction_label": "你的更正：", "correction_placeholder": "在此处修正代码...",
            "button_check_fix_1": "检查修正 1", "button_check_fix_2": "检查修正 2", "button_check_fix_3": "检查修正 3",
            "feedback_correction_correct": "正确！观察仔细！", "feedback_correction_incorrect": "不正确。{hint}",
            "correction_hint_1": "检查函数名称拼写。", "correction_hint_2": "记住，`print` 函数需要用括号 `()` 将要打印的内容括起来。", "correction_hint_3": "要打印的文本需要放在引号 `\"\"` 或 `''` 内。", "correction_hint_generic": "检查所需语法并与你的代码进行比较。",
            "feedback_correction_summary_all": "太棒了！所有 {total} 个修正都成功了！", "feedback_correction_summary_progress": "已完成 {count} / {total} 个修正。继续调试！",
            // Prediction
            "prediction_title": "输出预测", "prediction_desc": "仔细阅读 Python 代码片段。它们各自实际会打印什么？选择正确的输出。特别注意注释和空的 `print()` 调用！如果错了，可以再试一次。",
            "prediction1_title": "预测 1", "prediction2_title": "预测 2",
            "prediction_choose_label": "选择输出：",
            "button_check_prediction_1": "检查预测 1", "button_check_prediction_2": "检查预测 2",
            "feedback_prediction_select_option": "请先选择一个选项。", "feedback_prediction_correct": "正确！你准确地预测了输出。", "feedback_prediction_incorrect": "不太对。正确的输出是选项 {correctOption}。想一想注释和空 print 如何影响输出。再试一次！",
            "feedback_prediction_summary_all": "厉害！所有 {total} 个预测都正确！", "feedback_prediction_summary_progress": "做出了 {count} / {total} 个正确预测。",
            // Missions Adv
            "missions_adv_title": "高级迷你任务！", "missions_adv_desc": "最终挑战！精确完成这些任务。注意确切的文本、空行和注释位置。所需输出显示在每个任务下方。",
            "adv_mission1_title": "任务 1：精确问候", "adv_mission1_desc": "编写 Python 代码以精确打印以下两行：", "adv_mission1_placeholder": "使用两个 print() 命令...",
            "adv_mission2_title": "任务 2：带分隔符的消息", "adv_mission2_desc": "打印消息 “Processing...”，然后打印一个空行，然后打印 “Done.”。使用三个 `print()` 命令。所需输出：", "adv_mission2_placeholder": 'print("...")\\nprint()\\nprint("...")',
            "adv_mission3_title": "任务 3：先注释，后打印", "adv_mission3_desc": "首先，写一个注释：`# Displaying status.` 在下一行，打印文本：`Status: OK`。所需输出：", "adv_mission3_placeholder": '# 你的注释在这里\\nprint("...")',
            "adv_mission4_title": "任务 4：带行尾注释的打印", "adv_mission4_desc": "打印文本 `\"Important message\"`。在代码*之后*的同一行添加注释：`# Needs attention`。所需输出：", "adv_mission4_placeholder": 'print(...) # 你的注释在这里',
            "feedback_adv_mission_success": "任务完成！代码正确。", "feedback_adv_mission_syntax": "模拟错误", "feedback_adv_mission_fail": "不正确。检查任务要求：检查语法、确切文本、换行符和注释。",
            "adv_mission1_hint": "你是否使用了两个独立的 `print` 命令并带有确切的文本？",
            "adv_mission2_hint": "确保你有三个 `print` 命令，顺序正确（文本、空、文本）。",
            "adv_mission3_hint": "注释 `# Displaying status.` 是否在第一行，而 `print` 命令在下一行？",
            "adv_mission4_hint": "检查 `print` 命令语法，并确保注释 `# Needs attention` 在右括号*之后*的*同一行*上。",
            "feedback_adv_mission_summary_all": "所有 {total} 个高级任务已完成！编程大师！", "feedback_adv_mission_summary_progress": "已完成 {count} / {total} 个高级任务。就快完成了！",
            // Completion
            "completion_title": "高级练习已掌握！", "completion_desc": "太出色了！你征服了模块 0 的高级挑战。<br>你对 `print()` 和注释有了深入的掌握。是时候看视频课程了！",
            "button_review_theory": "复习理论", "button_revisit_basic": "重温基础练习", "button_proceed_video": "进入视频课程",
             // Shared Buttons
             "button_check_code": "检查代码", "button_reset": "重置", "button_run_sim": "运行模拟", "button_check_selection": "检查选择", "button_try_again": "再试一次",
             "button_test_mission_1": "测试任务 1", "button_test_mission_2": "测试任务 2", "button_test_mission_3": "测试任务 3", "button_test_mission_4": "测试任务 4"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             // Re-initialize activities that build content based on language
             if (anatomyAdvanced) setupAnatomyAdvanced();
             if (buildMultiPrintSection) setupMultiBuildListeners();
             if (spotTrickyCommentSection) setupTrickyCommentLines();
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; // Fallback shows key
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
            if (!translations[lang]) lang = 'en';

            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const replacements = JSON.parse(el.getAttribute('data-translate-replacements') || '{}'); // Get replacements if any
                const translation = getTranslation(key, lang, replacements);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Skip placeholders */ }
                 else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else {
                     if (/<[a-z][\s\S]*>/i.test(translation)) { el.innerHTML = translation; }
                     else { el.textContent = translation; }
                 }
            });

            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });

             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });
        }

        // --- Initialize Language ---
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;

        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
            document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target)) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
            document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => { setLanguage(e.target.value); });
        }

        // --- Helper Function for Feedback (using keys) ---
         function showFeedback(elementId, messageKey, type = 'info', isVisible = true, replacements = {}) {
             const feedbackEl = document.getElementById(elementId);
             if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
             const currentLang = getStoredLanguage();
             const translatedMessage = getTranslation(messageKey, currentLang, replacements);

             feedbackEl.className = 'feedback-message'; // Reset classes
             if (isVisible && messageKey) {
                 if (translatedMessage.includes('<') && translatedMessage.includes('>')) { feedbackEl.innerHTML = translatedMessage; }
                 else { feedbackEl.textContent = translatedMessage; }
                 feedbackEl.classList.add('visible', type);

                 const interactiveArea = feedbackEl.closest('.interactive-area, .correction-item, .prediction-item, .mission');
                 if (interactiveArea) {
                     interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
                     void interactiveArea.offsetWidth;
                     if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
                     else if (type === 'incorrect' || type === 'warning') { interactiveArea.classList.add('shake-anim'); }
                 }
             } else {
                 feedbackEl.textContent = '';
                 feedbackEl.classList.remove('visible', 'correct', 'incorrect', 'info', 'warning');
             }
         }


        // --- Activity 1: Anatomy Revisited --- CORRECTED LISTENER ---
        const anatomyAdvanced = document.getElementById('anatomy-advanced');
        let currentAnatomyAdvListeners = [];

        function setupAnatomyAdvanced() {
            if (!anatomyAdvanced) return;
            const currentLang = getStoredLanguage(); // Get lang at setup time
            const parts = anatomyAdvanced.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('anatomy-advanced-explanations');
            const statusP = document.getElementById('anatomy-advanced-status');
            const feedbackDivId = 'anatomy-advanced-feedback';
            let identifiedCount = 0;
            const totalParts = 13;

            // Remove old listeners
            currentAnatomyAdvListeners.forEach(({ element, listener }) => element.removeEventListener('click', listener));
            currentAnatomyAdvListeners = [];

            // Reset visual state & Translate static texts
            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = ''; // Clear explanations
            statusP.innerHTML = getTranslation('anatomy_adv_status_initial', currentLang, { total: totalParts });
            showFeedback(feedbackDivId, '', 'info', false);

            parts.forEach(part => {
                const clickListener = () => { // Define listener function
                    const partType = part.dataset.part;
                    const explanationKey = `anatomy_adv_exp_${partType}`;
                    // Fetch translation *inside* the click listener
                    const currentClickLang = getStoredLanguage(); // Get language at time of click
                    const explanationText = getTranslation(explanationKey, currentClickLang);

                    if (!part.classList.contains('identified') && partType && explanationText !== `[${explanationKey}]`) { // Check if translation was found
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        // Construct the explanation element safely
                        p.innerHTML = `<i class="fas fa-check-circle" style="color: var(--success-color);"></i> <strong>${part.textContent.trim() || '( )'}:</strong> `;
                        p.appendChild(document.createTextNode(explanationText)); // Append fetched translation text

                        explanationsDiv.appendChild(p);
                        explanationsDiv.scrollTop = explanationsDiv.scrollHeight;

                        statusP.innerHTML = getTranslation('anatomy_adv_status_progress', currentClickLang, { count: identifiedCount, total: totalParts });
                        if (identifiedCount === totalParts) {
                            statusP.innerHTML = getTranslation('anatomy_adv_status_done', currentClickLang);
                            showFeedback(feedbackDivId, 'feedback_anatomy_adv_correct', 'correct');
                        }
                    } else if (explanationText === `[${explanationKey}]`) {
                        console.error(`Adv Anatomy Explanation missing for key: ${explanationKey} in lang: ${currentClickLang}`);
                    }
                };
                part.addEventListener('click', clickListener);
                currentAnatomyAdvListeners.push({ element: part, listener: clickListener }); // Store reference
            });
        }
        // --- END Activity 1 Correction ---


        // --- Activity 2: Build Multiple Prints ---
        const buildMultiPrintSection = document.getElementById('build-multi-print');
        let multiDropZone;

        if (buildMultiPrintSection) {
            const piecesContainer = document.getElementById('multi-draggable-pieces'); multiDropZone = document.getElementById('multi-drop-zone'); const checkBtn = document.getElementById('check-multi-build-btn'); const resetBtn = document.getElementById('reset-multi-build-btn'); const feedbackDivId = 'multi-build-feedback'; const initialPieces = [ { value: 'print', type: 'function' }, { value: '(', type: 'paren-open' }, { value: ')', type: 'paren-close' }, { value: '"AI is powerful."', type: 'string' }, { value: '"Handle with care."', type: 'string' }, { value: 'print', type: 'function' }, { value: '(', type: 'paren-open' }, { value: ')', type: 'paren-close' }, { value: '# A comment', type: 'comment' }, { value: '"Wrong Text"', type: 'string' } ]; let draggedElement = null; let touchDragElement = null; let originalPiece = null; let startX, startY, offsetX, offsetY;
            function createPieceElement(pieceData) { const piece = document.createElement('span'); piece.classList.add('piece', 'code-font'); piece.draggable = true; piece.dataset.value = pieceData.value; piece.dataset.type = pieceData.type; piece.textContent = pieceData.value; if (pieceData.type === 'string') piece.style.backgroundColor = '#b17a62'; if (pieceData.type === 'comment') piece.style.backgroundColor = '#5d8f4c'; addDragListeners(piece); addTouchListeners(piece); return piece; }
            function populatePieces() { piecesContainer.innerHTML = ''; initialPieces.sort(() => Math.random() - 0.5).forEach(pData => { piecesContainer.appendChild(createPieceElement(pData)); }); }
            function setupMultiBuildListeners() { populatePieces(); multiDropZone.innerHTML = ''; const placeholder = document.createElement('span'); placeholder.id = 'multi-drop-zone-placeholder'; placeholder.dataset.translate = 'build_multi_placeholder'; placeholder.textContent = getTranslation('build_multi_placeholder', getStoredLanguage()); multiDropZone.appendChild(placeholder); showFeedback(feedbackDivId, '', 'info', false); checkBtn.classList.remove('success'); checkBtn.disabled = false; }
            function addDragListeners(element) { element.addEventListener('dragstart', (e) => { if (e.target.closest('#multi-drop-zone')) { e.preventDefault(); return; } draggedElement = element; element.classList.add('ghosting'); e.dataTransfer.effectAllowed = 'move'; try { e.dataTransfer.setData('text/plain', element.dataset.value); } catch (err) {} }); element.addEventListener('dragend', () => { element.classList.remove('ghosting'); draggedElement = null; multiDropZone.classList.remove('over'); }); }
            function handleTouchStart(e) { if (touchDragElement || e.target.closest('#multi-drop-zone')) return; originalPiece = e.target.closest('.piece'); if (!originalPiece || !piecesContainer.contains(originalPiece)) return; const touch = e.targetTouches[0]; startX = touch.clientX; startY = touch.clientY; const rect = originalPiece.getBoundingClientRect(); offsetX = startX - rect.left; offsetY = startY - rect.top; touchDragElement = originalPiece.cloneNode(true); touchDragElement.classList.add('dragging'); touchDragElement.style.position = 'fixed'; touchDragElement.style.left = `${startX - offsetX}px`; touchDragElement.style.top = `${startY - offsetY}px`; touchDragElement.style.width = `${rect.width}px`; touchDragElement.style.height = `${rect.height}px`; document.body.appendChild(touchDragElement); originalPiece.classList.add('ghosting'); e.preventDefault(); }
            function handleTouchMove(e) { if (!touchDragElement) return; e.preventDefault(); const touch = e.targetTouches[0]; const currentX = touch.clientX; const currentY = touch.clientY; touchDragElement.style.left = `${currentX - offsetX}px`; touchDragElement.style.top = `${currentY - offsetY}px`; touchDragElement.style.display = 'none'; const elemBelow = document.elementFromPoint(currentX, currentY); touchDragElement.style.display = ''; const isOverDropZone = elemBelow === multiDropZone || multiDropZone.contains(elemBelow); if (isOverDropZone) { multiDropZone.classList.add('over'); } else { multiDropZone.classList.remove('over'); } }
            function handleTouchEnd(e) { if (!touchDragElement || !originalPiece) return; const touch = e.changedTouches[0]; const finalX = touch.clientX; const finalY = touch.clientY; touchDragElement.style.display = 'none'; const elemBelow = document.elementFromPoint(finalX, finalY); touchDragElement.style.display = ''; const droppedInZone = elemBelow === multiDropZone || multiDropZone.contains(elemBelow); if (droppedInZone) { handleDrop(originalPiece, elemBelow); } else { originalPiece.classList.remove('ghosting'); } if (touchDragElement.parentNode === document.body) { document.body.removeChild(touchDragElement); } multiDropZone.classList.remove('over'); touchDragElement = null; originalPiece = null; }
            function addTouchListeners(element) { element.addEventListener('touchstart', handleTouchStart, { passive: false }); element.addEventListener('touchmove', handleTouchMove, { passive: false }); element.addEventListener('touchend', handleTouchEnd); }
            function handleDrop(droppedOriginal, targetElement) { document.getElementById('multi-drop-zone-placeholder')?.remove(); const droppedPiece = droppedOriginal.cloneNode(true); droppedPiece.classList.remove('ghosting'); droppedPiece.draggable = false; droppedPiece.style.cursor = 'default'; droppedPiece.removeEventListener('touchstart', handleTouchStart); droppedPiece.removeEventListener('touchmove', handleTouchMove); droppedPiece.removeEventListener('touchend', handleTouchEnd); let currentLine = multiDropZone.lastElementChild; if (!currentLine || !currentLine.classList.contains('code-line')) { currentLine = document.createElement('div'); currentLine.classList.add('code-line'); multiDropZone.appendChild(currentLine); } else { const isNewLineNeeded = currentLine.querySelector('.piece[data-type="paren-close"]'); if (isNewLineNeeded && droppedPiece.dataset.type === 'function') { currentLine = document.createElement('div'); currentLine.classList.add('code-line'); multiDropZone.appendChild(currentLine); } } currentLine.appendChild(droppedPiece); droppedOriginal.remove(); }
            multiDropZone.addEventListener('dragover', (e) => { e.preventDefault(); multiDropZone.classList.add('over'); }); multiDropZone.addEventListener('dragleave', () => { multiDropZone.classList.remove('over'); }); multiDropZone.addEventListener('drop', (e) => { e.preventDefault(); multiDropZone.classList.remove('over'); if (draggedElement && piecesContainer.contains(draggedElement)) { handleDrop(draggedElement, e.target); draggedElement = null; } });
            checkBtn.addEventListener('click', () => { const lines = multiDropZone.querySelectorAll('.code-line'); let codeLine1 = '', codeLine2 = '', textLine1 = '', textLine2 = ''; if (lines.length >= 1) { const pieces1 = lines[0].querySelectorAll('.piece'); codeLine1 = Array.from(pieces1).map(p => p.dataset.type).join('-'); textLine1 = Array.from(pieces1).find(p => p.dataset.type === 'string')?.dataset.value || ''; } if (lines.length >= 2) { const pieces2 = lines[1].querySelectorAll('.piece'); codeLine2 = Array.from(pieces2).map(p => p.dataset.type).join('-'); textLine2 = Array.from(pieces2).find(p => p.dataset.type === 'string')?.dataset.value || ''; } const correctSeq = 'function-paren-open-string-paren-close'; const correctText1 = '"AI is powerful."'; const correctText2 = '"Handle with care."'; const isLine1Correct = codeLine1 === correctSeq && textLine1 === correctText1; const isLine2Correct = codeLine2 === correctSeq && textLine2 === correctText2; if (isLine1Correct && isLine2Correct && lines.length === 2) { showFeedback(feedbackDivId, 'feedback_build_multi_correct', 'correct'); checkBtn.classList.add('success'); checkBtn.disabled = true; } else if (lines.length !== 2) { showFeedback(feedbackDivId, 'feedback_build_multi_num_lines', 'incorrect', true, { count: lines.length }); checkBtn.classList.remove('success'); } else { let errors = []; if (!isLine1Correct) errors.push(getTranslation('feedback_build_multi_error_line1', getStoredLanguage())); if (!isLine2Correct) errors.push(getTranslation('feedback_build_multi_error_line2', getStoredLanguage())); showFeedback(feedbackDivId, 'feedback_build_multi_errors_combined', 'incorrect', true, { errors: errors.join(' ') }); checkBtn.classList.remove('success'); } });
            resetBtn.addEventListener('click', setupMultiBuildListeners);
            // setupMultiBuildListeners deferred
        }

        // --- Activity 3: Advanced Code Simulator ---
        const advSimSection = document.getElementById('adv-code-simulator');
        if(advSimSection) {
            const editor = document.getElementById('adv-sim-editor-input'); const outputArea = document.getElementById('adv-sim-output'); const runBtn = document.getElementById('run-adv-sim-btn'); const feedbackDivId = 'adv-sim-feedback';
            runBtn.addEventListener('click', () => { const code = editor.value; const codeLines = code.split('\n'); const trimmedLines = codeLines.map(l => l.trim()); outputArea.innerHTML = ''; showFeedback(feedbackDivId, '', 'info', false); const expectedRawOutputLines = ["Line One", "", "Line Three"]; let simulatedOutputLines = []; let errors = []; let lineNum = 0; let foundCommentForBlank = false; let printCommandCount = 0;
            for (const line of codeLines) { lineNum++; const trimmedLine = line.trim(); if (trimmedLine.startsWith('#')) { const currentIdx = codeLines.indexOf(line); if (currentIdx !== -1 && currentIdx + 1 < codeLines.length && codeLines[currentIdx + 1].trim() === 'print()') { foundCommentForBlank = true; } continue; } if (trimmedLine === '') { continue; } const printRegex = /^print\s*\(\s*(?:"(.*)"|)\s*\)\s*(?:#.*)?$/; const match = trimmedLine.match(printRegex); if (match) { printCommandCount++; simulatedOutputLines.push(match[1] === undefined ? "" : match[1]); } else if (trimmedLine) { errors.push(`Syntax Error on line ${lineNum}: '${line}'`); } }
            if (errors.length > 0) { outputArea.innerHTML = errors.map(err => `<span class="output-line error">${err}</span>`).join(''); showFeedback(feedbackDivId, 'feedback_sim_adv_syntax_error', 'incorrect'); } else { outputArea.innerHTML = simulatedOutputLines.map(line => `<span class="output-line">> ${line}</span>`).join(''); const isOutputCorrect = JSON.stringify(simulatedOutputLines) === JSON.stringify(expectedRawOutputLines); if (isOutputCorrect && foundCommentForBlank && printCommandCount === 3) { showFeedback(feedbackDivId, 'feedback_sim_adv_success', 'correct'); } else { let issues = []; if (!isOutputCorrect) issues.push(getTranslation('sim_adv_issue_output', getStoredLanguage())); if (printCommandCount !== 3) issues.push(getTranslation('sim_adv_issue_count', getStoredLanguage(), { count: printCommandCount })); if (!foundCommentForBlank) issues.push(getTranslation('sim_adv_issue_comment', getStoredLanguage())); showFeedback(feedbackDivId, 'feedback_sim_adv_warning', 'warning', true, { issues: issues.join(' ') }); } } });
        }

        // --- Activity 4: Spot the Tricky Comment ---
        const spotTrickyCommentSection = document.getElementById('spot-tricky-comment');
        let trickyCommentListeners = [];
        const trickyCommentCodeLinesData = [ { key: 'spot_tricky_line_1', isComment: true }, { key: 'spot_tricky_line_2', isComment: true }, { key: 'spot_tricky_line_3', isComment: false }, { key: 'spot_tricky_line_4', isComment: true }, { key: 'spot_tricky_line_5', isComment: true }, { key: 'spot_tricky_line_6', isComment: true }, { key: 'spot_tricky_line_7', isComment: false }, { key: 'spot_tricky_line_8', isComment: true } ];

        if (spotTrickyCommentSection) {
            const linesContainer = document.getElementById('tricky-comment-lines'); const checkBtn = document.getElementById('check-tricky-comment-btn'); const resetBtn = document.getElementById('reset-tricky-comment-btn'); const feedbackDivId = 'tricky-comment-feedback';
            function createTrickyCommentLineElement(lineData, currentLang) { const container = document.createElement('div'); container.classList.add('code-line-container'); const iconPlaceholder = document.createElement('span'); iconPlaceholder.classList.add('feedback-icon-placeholder'); const codeLine = document.createElement('div'); codeLine.classList.add('code-line-check'); codeLine.dataset.isComment = lineData.isComment.toString(); codeLine.textContent = getTranslation(lineData.key, currentLang); container.appendChild(iconPlaceholder); container.appendChild(codeLine); return container; }
            function setupTrickyCommentLines() { const currentLang = getStoredLanguage(); trickyCommentListeners.forEach(({ element, listener }) => element.removeEventListener('click', listener)); trickyCommentListeners = []; linesContainer.innerHTML = ''; trickyCommentCodeLinesData.forEach(lineData => { const lineElementContainer = createTrickyCommentLineElement(lineData, currentLang); linesContainer.appendChild(lineElementContainer); const lineCheckDiv = lineElementContainer.querySelector('.code-line-check'); const lineClickListener = () => { if (lineCheckDiv.classList.contains('checked-state')) return; lineCheckDiv.classList.toggle('selected-visual'); }; lineCheckDiv.addEventListener('click', lineClickListener); trickyCommentListeners.push({ element: lineCheckDiv, listener: lineClickListener }); }); showFeedback(feedbackDivId, '', 'info', false); resetBtn.classList.add('hidden'); checkBtn.disabled = false; checkBtn.classList.remove('success'); }
            checkBtn.addEventListener('click', () => { let correctSelections = 0; let incorrectSelections = 0; let missedComments = 0; const lineContainers = linesContainer.querySelectorAll('.code-line-container'); const totalComments = trickyCommentCodeLinesData.filter(l => l.isComment).length; let isCorrectOverall = false; const currentLang = getStoredLanguage(); lineContainers.forEach(container => { const lineCheck = container.querySelector('.code-line-check'); const iconPlaceholder = container.querySelector('.feedback-icon-placeholder'); const isCommentLine = lineCheck.dataset.isComment === 'true'; const isSelected = lineCheck.classList.contains('selected-visual'); iconPlaceholder.innerHTML = ''; iconPlaceholder.classList.remove('visible'); lineCheck.classList.add('checked-state'); let iconClass = ''; if (isSelected && isCommentLine) { iconClass = 'fas fa-check'; correctSelections++; iconPlaceholder.classList.add('visible'); } else if (isSelected && !isCommentLine) { iconClass = 'fas fa-times'; incorrectSelections++; iconPlaceholder.classList.add('visible'); } else if (!isSelected && isCommentLine) { iconClass = 'fas fa-eye'; missedComments++; iconPlaceholder.classList.add('visible'); } if (iconClass) { const icon = document.createElement('i'); icon.className = iconClass; iconPlaceholder.appendChild(icon); } }); if (incorrectSelections === 0 && missedComments === 0 && correctSelections === totalComments) { isCorrectOverall = true; showFeedback(feedbackDivId, 'feedback_spot_tricky_correct', 'correct', true, { totalComments: totalComments }); checkBtn.classList.add('success'); } else { let hints = []; if (incorrectSelections > 0) hints.push(getTranslation('feedback_spot_hint_incorrect', currentLang, { count: incorrectSelections })); if (missedComments > 0) hints.push(getTranslation('feedback_spot_hint_missed', currentLang, { count: missedComments })); showFeedback(feedbackDivId, 'feedback_spot_tricky_incorrect', 'incorrect', true, { hints: hints.join(getTranslation('feedback_spot_hints_joiner', currentLang)) }); checkBtn.classList.remove('success'); } if (isCorrectOverall) { resetBtn.classList.add('hidden'); checkBtn.disabled = true; } else { resetBtn.classList.remove('hidden'); checkBtn.disabled = true; } });
            resetBtn.addEventListener('click', setupTrickyCommentLines);
            // setupTrickyCommentLines deferred
        }

        // --- Activity 5: Code Correction Challenge ---
        const codeCorrectionSection = document.getElementById('code-correction');
        if (codeCorrectionSection) {
            const checkButtons = codeCorrectionSection.querySelectorAll('.correction-check-btn'); const correctCodeMap = { '1': 'print("Syntax matters!")', '2': 'print("Python is fun")', '3': 'print("Hello")' }; let completedCorrections = 0; const totalCorrections = Object.keys(correctCodeMap).length;
            function normalizeCode(code) { return code.split('\n').map(line => line.trim()).filter(line => line !== '').join('\n'); }
            function updateCorrectionSummary() { const summaryFeedbackEl = document.getElementById('correction-summary-feedback'); if (!summaryFeedbackEl) return; const currentLang = getStoredLanguage(); if (completedCorrections === totalCorrections) { showFeedback(summaryFeedbackEl.id, 'feedback_correction_summary_all', 'correct', true, { total: totalCorrections }); } else if (completedCorrections > 0) { showFeedback(summaryFeedbackEl.id, 'feedback_correction_summary_progress', 'info', true, { count: completedCorrections, total: totalCorrections }); } else { showFeedback(summaryFeedbackEl.id, '', 'info', false); } }
            checkButtons.forEach(button => { button.addEventListener('click', () => { const correctionId = button.dataset.correctionId; const editor = document.getElementById(`correction-editor-${correctionId}`); const feedbackDivId = `correction-feedback-${correctionId}`; const statusIcon = document.getElementById(`correction-status-${correctionId}`).querySelector('i'); const userCode = editor.value; const expectedCode = correctCodeMap[correctionId]; const normalizedUserCode = normalizeCode(userCode); const normalizedExpectedCode = normalizeCode(expectedCode); const correctionItem = document.getElementById(`correction-${correctionId}`); const wasPreviouslyCorrect = correctionItem.dataset.completed === 'true'; if (normalizedUserCode === normalizedExpectedCode) { showFeedback(feedbackDivId, 'feedback_correction_correct', 'correct'); statusIcon.className = 'fas fa-check'; editor.disabled = true; button.disabled = true; if (!wasPreviouslyCorrect) { correctionItem.dataset.completed = 'true'; completedCorrections++; } } else { const hintKey = `correction_hint_${correctionId}`; const hint = getTranslation(hintKey, getStoredLanguage()) || getTranslation('correction_hint_generic', getStoredLanguage()); showFeedback(feedbackDivId, 'feedback_correction_incorrect', 'incorrect', true, { hint: hint }); statusIcon.className = 'fas fa-times'; if (wasPreviouslyCorrect) { correctionItem.dataset.completed = 'false'; completedCorrections--; } } updateCorrectionSummary(); }); }); updateCorrectionSummary();
        }

        // --- Activity 6: Output Prediction ---
        const outputPredictionSection = document.getElementById('output-prediction');
        if (outputPredictionSection) {
            const checkButtons = outputPredictionSection.querySelectorAll('.prediction-check-btn'); let completedPredictions = 0; const totalPredictions = outputPredictionSection.querySelectorAll('.prediction-item').length;
            function updatePredictionSummary() { const summaryFeedbackEl = document.getElementById('prediction-summary-feedback'); if (!summaryFeedbackEl) return; const currentLang = getStoredLanguage(); if (completedPredictions === totalPredictions) { showFeedback(summaryFeedbackEl.id, 'feedback_prediction_summary_all', 'correct', true, { total: totalPredictions }); } else if (completedPredictions > 0) { showFeedback(summaryFeedbackEl.id, 'feedback_prediction_summary_progress', 'info', true, { count: completedPredictions, total: totalPredictions }); } else { showFeedback(summaryFeedbackEl.id, '', 'info', false); } }
            checkButtons.forEach(button => { button.addEventListener('click', () => { const predictionId = button.dataset.predictionId; const itemDiv = document.getElementById(`prediction-${predictionId}`); const feedbackDivId = `prediction-feedback-${predictionId}`; const correctAnswer = itemDiv.dataset.correctOption; const selectedOption = itemDiv.querySelector(`input[name="predict-${predictionId}"]:checked`); const wasPreviouslyCorrect = itemDiv.dataset.completed === 'true'; if (!selectedOption) { showFeedback(feedbackDivId, 'feedback_prediction_select_option', 'warning'); return; } const userAnswer = selectedOption.value; if (userAnswer === correctAnswer) { showFeedback(feedbackDivId, 'feedback_prediction_correct', 'correct'); itemDiv.querySelectorAll(`input[name="predict-${predictionId}"]`).forEach(radio => radio.disabled = true); button.disabled = true; if (!wasPreviouslyCorrect) { itemDiv.dataset.completed = 'true'; completedPredictions++; } } else { showFeedback(feedbackDivId, 'feedback_prediction_incorrect', 'incorrect', true, { correctOption: correctAnswer }); if (wasPreviouslyCorrect) { itemDiv.dataset.completed = 'false'; completedPredictions--; } } updatePredictionSummary(); }); }); updatePredictionSummary();
        }

        // --- Activity 7: Advanced Mini Missions ---
         const advMissionsSection = document.getElementById('adv-mini-missions');
         if (advMissionsSection) {
             const missionRunButtons = advMissionsSection.querySelectorAll('.adv-mission-run-btn'); const totalMissions = advMissionsSection.querySelectorAll('.mission').length; let completedMissionsCount = 0;
            function updateAdvMissionSummary() { const summaryDiv = document.getElementById('adv-missions-summary-feedback'); if (!summaryDiv) return; const currentLang = getStoredLanguage(); completedMissionsCount = advMissionsSection.querySelectorAll('.mission[data-completed="true"]').length; if (completedMissionsCount === totalMissions) { showFeedback(summaryDiv.id, 'feedback_adv_mission_summary_all', 'correct', true, { total: totalMissions }); } else if (completedMissionsCount > 0) { showFeedback(summaryDiv.id, 'feedback_adv_mission_summary_progress', 'info', true, { count: completedMissionsCount, total: totalMissions }); } else { showFeedback(summaryDiv.id, '', 'info', false); } }
             function validateMissionCodeAdv(missionId, code) { const codeLines = code.split('\n'); const trimmedLines = codeLines.map(l => l.trim()).filter(l => l !== ''); try{ switch (missionId) { case '1': return trimmedLines.length === 2 && trimmedLines[0] === 'print("Hello, Pythonista!")' && trimmedLines[1] === 'print("Ready to code?")'; case '2': return trimmedLines.length === 3 && trimmedLines[0] === 'print("Processing...")' && trimmedLines[1] === 'print()' && trimmedLines[2] === 'print("Done.")'; case '3': const commentLineIndex = codeLines.findIndex(line => line.trim() === '# Displaying status.'); if (commentLineIndex === -1) return false; let printLineIndex = -1; let trimmedCount = 0; let firstPrintLine = null; for(let i=0; i < codeLines.length; i++) { const trimmed = codeLines[i].trim(); if (trimmed && !trimmed.startsWith('#')) { if(trimmedCount === 0) { firstPrintLine = trimmed; printLineIndex = i; break;} trimmedCount++; } } return commentLineIndex < printLineIndex && firstPrintLine === 'print("Status: OK")'; case '4': const lineRegex = /^print\("Important message"\)\s*# Needs attention$/; return trimmedLines.some(line => lineRegex.test(line)); default: return false; } } catch(e){ console.error("Validation error:", e); return false; } }
             function simulateOutputAdv(code) { let outputLines = []; const lines = code.split('\n'); try { for (const line of lines) { const trimmedLine = line.trim(); if (trimmedLine.startsWith('#') || trimmedLine === '') continue; const printRegex = /^print\s*\(\s*(?:(["'])(.*?)\1|)\s*\)/; const match = trimmedLine.match(printRegex); if (match) { outputLines.push(match[2] === undefined ? "" : match[2]); } else { return null; /* Syntax error */ } } } catch(e) { console.error("Simulation error:", e); return null; } return outputLines; }
             missionRunButtons.forEach(button => { button.addEventListener('click', () => { const missionId = button.dataset.missionId; const missionDiv = document.getElementById(`adv-mission-${missionId}`); const editor = missionDiv.querySelector('.mission-editor'); const outputArea = missionDiv.querySelector('.mission-output'); const feedbackDivId = `adv-mission-feedback-${missionId}`; const statusIcon = missionDiv.querySelector('.mission-status i'); const code = editor.value; const wasPreviouslyCorrect = missionDiv.dataset.completed === 'true'; outputArea.innerHTML = ''; const success = validateMissionCodeAdv(missionId, code); let feedbackKey = 'feedback_adv_mission_fail'; let feedbackType = 'incorrect'; let hintKey = `adv_mission${missionId}_hint`; statusIcon.classList.remove('animate');
             if (success) { const simulatedLines = simulateOutputAdv(code); if (simulatedLines !== null) { outputArea.innerHTML = simulatedLines.map(line => `<span class="output-line">> ${line}</span>`).join(''); feedbackKey = 'feedback_adv_mission_success'; feedbackType = 'correct'; statusIcon.className = 'fas fa-check-circle animate'; if (!wasPreviouslyCorrect) { missionDiv.dataset.completed = 'true'; completedMissionsCount++; } } else { outputArea.innerHTML = `<span class="output-line error">${getTranslation('feedback_adv_mission_syntax', getStoredLanguage())}</span>`; feedbackKey = 'feedback_adv_mission_fail'; feedbackType = 'warning'; statusIcon.className = 'fas fa-times-circle'; if (wasPreviouslyCorrect) { missionDiv.dataset.completed = 'false'; completedMissionsCount--; } } } else { const simulatedLines = simulateOutputAdv(code); if (simulatedLines !== null) { outputArea.innerHTML = simulatedLines.map(line => `<span class="output-line">> ${line}</span>`).join(''); } else { outputArea.innerHTML = `<span class="output-line error">${getTranslation('feedback_adv_mission_syntax', getStoredLanguage())}</span>`; } feedbackKey = hintKey && translations[getStoredLanguage()]?.[hintKey] ? hintKey : 'feedback_adv_mission_fail'; feedbackType = 'incorrect'; statusIcon.className = 'fas fa-times-circle'; if (wasPreviouslyCorrect) { missionDiv.dataset.completed = 'false'; completedMissionsCount--; } else { missionDiv.dataset.completed = 'false'; } } showFeedback(feedbackDivId, feedbackKey, feedbackType); updateAdvMissionSummary(); }); });
              updateAdvMissionSummary();
         }

        // --- Fade-in animations on scroll ---
         const fadeElements = document.querySelectorAll('.fade-in');
         function animateOnScroll() { const windowHeight = window.innerHeight; fadeElements.forEach(el => { if (el.style.opacity === '1') return; const rect = el.getBoundingClientRect(); if (rect.top < windowHeight - 50 && rect.bottom >= 0) { el.style.opacity = '1'; el.style.transform = 'translateY(0)'; } }); }
         const scrollThrottle = (callback, limit) => { let wait = false; return function () { if (!wait) { callback.call(); wait = true; setTimeout(function () { wait = false; }, limit); } } };
         window.addEventListener('scroll', scrollThrottle(animateOnScroll, 100));

        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST
        animateOnScroll(); // Trigger initial check for fades
        // Call initial setups for activities that need it after language is set
        if (anatomyAdvanced) setupAnatomyAdvanced();
        if (buildMultiPrintSection) setupMultiBuildListeners();
        if (spotTrickyCommentSection) setupTrickyCommentLines();

    }); // End DOMContentLoaded
    </script>

</body>
</html>
