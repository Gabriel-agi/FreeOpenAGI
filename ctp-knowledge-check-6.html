<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 6 - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Use this for quiz elements */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--check-color); /* Changed to match quiz theme */
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--check-color); /* Changed to match quiz theme */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Knowledge Check Header --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .kc-header .return-link {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.4rem 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }
        .kc-header .return-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }
        .kc-header .return-link i { margin-right: 5px; }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.5rem;
            margin: 0;
            text-align: center;
            flex-grow: 1; /* Allow title to take space */
        }
        .kc-header .lang-switcher-container {
             /* Position language switcher */
        }

         /* Language Switcher Styles (Adapted for Header) */
         .language-switcher select {
            background: var(--lang-select-bg);
            color: var(--text-light); /* Light text on dark header */
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            /* Custom Arrow using the variable color */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--lang-arrow-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         .language-switcher select:hover { background-color: var(--lang-select-bg-hover); }
         .language-switcher select:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         .language-switcher select option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
         }

        /* --- Main Content Area --- */
        .kc-main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            flex-grow: 1; /* Takes up remaining space */
        }

        /* --- Quiz Styling --- */
        .quiz-instructions {
            background-color: #e7f1ff; /* Light blue background */
            border-left: 5px solid var(--primary-color);
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 4px;
            font-size: 0.95rem;
            color: var(--text-dark);
        }
        .quiz-instructions p { margin-bottom: 0.5rem;}
        .quiz-instructions p:last-child { margin-bottom: 0; }
        .quiz-instructions strong { color: var(--primary-color); }
        .quiz-instructions code { background: #d1e7ff; padding: 2px 5px; border-radius: 3px; font-family: monospace; }

        #quiz-form .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        #quiz-form .question-block:last-of-type {
             border-bottom: none;
             margin-bottom: 0;
             padding-bottom: 0;
        }

        .question-number {
            display: inline-block;
            background-color: var(--check-color);
            color: var(--text-light);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-right: 10px;
            min-width: 30px;
            text-align: center;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            display: inline; /* Keep number and text together */
        }
         .question-text code, .options code { /* Style code within questions/options */
             font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
             background-color: #e9ecef;
             padding: 0.15em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e; /* Bootstrap's code color */
         }

        .options label {
            display: block;
            margin-bottom: 0.8rem;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            position: relative;
        }
        .options label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }
        .options input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--check-color); /* Modern browser color */
        }

        /* Feedback Styling */
        .feedback {
            font-size: 0.9rem;
            margin-top: 0.7rem;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: none; /* Hidden by default */
        }
        .feedback.correct {
            background-color: #d1e7dd;
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
            display: block;
        }
        .feedback.incorrect {
            background-color: #f8d7da;
            border-left: 4px solid var(--error-color);
            color: var(--error-color);
            display: block;
        }
        .feedback strong { font-weight: 700; }

        /* Result Styling */
        #results-area {
            margin-top: 2.5rem;
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            text-align: center;
            display: none; /* Hidden initially */
        }
        #results-area.pass {
            background-color: #e9f7ef; /* Light green */
            border: 1px solid var(--success-color);
        }
        #results-area.fail {
            background-color: #fdeeee; /* Light red */
            border: 1px solid var(--error-color);
        }
        #results-area h3 {
            font-family: var(--font-title);
            margin-bottom: 1rem;
            font-size: 1.6rem;
        }
        #results-area h3.pass { color: var(--success-color); }
        #results-area h3.fail { color: var(--error-color); }
        #score-display {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        #pass-fail-message {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        #pass-fail-message strong { font-weight: 700; }

        /* Button Styling */
        .quiz-button {
            display: inline-block;
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            padding: 0.8rem 1.8rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            margin-top: 1rem; /* Add some space above buttons */
        }
        .quiz-button:hover {
            background-color: #5a35a2; /* Darker purple */
            transform: translateY(-2px);
        }
        .quiz-button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            transform: none;
            opacity: 0.7;
        }
        #retry-button {
            background-color: var(--secondary-color);
        }
         #retry-button:hover {
            background-color: #5a6268;
        }

        /* Utility Classes */
        .hidden { display: none; }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: 2rem; /* Ensure space above footer */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
             .kc-main { width: 90%; padding: 1.5rem; margin: 1.5rem auto; }
             .kc-header h1 { font-size: 1.3rem; }
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header { padding: 0.8rem 1rem; flex-wrap: wrap; }
            .kc-header .return-link { order: 1; margin-bottom: 5px; font-size: 0.85rem; padding: 0.3rem 0.6rem; }
            .kc-header h1 { order: 3; width: 100%; text-align: center; margin-top: 5px; font-size: 1.2rem; }
            .kc-header .lang-switcher-container { order: 2; margin-bottom: 5px;}
            .language-switcher select { font-size: 0.85rem; padding: 5px 25px 5px 8px; }
            .kc-main { padding: 1rem; }
            .question-text { font-size: 1rem; }
            .options label { padding: 0.7rem 0.8rem; }
            #results-area { padding: 1rem 1.5rem; }
            .quiz-button { padding: 0.7rem 1.5rem; font-size: 0.95rem; }
        }
         @media (max-width: 576px) {
             html { font-size: 14px; }
             .kc-header { padding: 0.6rem 0.8rem; }
             .kc-header h1 { font-size: 1.1rem; }
             .options label { font-size: 0.9rem; padding: 0.6rem 0.7rem;}
             .feedback { font-size: 0.85rem; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="return-link">
            <i class="fas fa-arrow-left"></i> <span data-translate="return_btn">Return to Dashboard</span>
        </a>
        <h1 data-translate="quiz_title">Knowledge Check: Module 6</h1>
        <div class="lang-switcher-container language-switcher">
             <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                 <option value="en" data-translate="lang_en">🇬🇧 English</option>
                 <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                 <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
             </select>
         </div>
    </header>

    <main class="kc-main">
        <div class="quiz-instructions">
            <p data-translate="instructions_p1">Answer the following 10 questions about Module 6: Simple Decisions - <code>if</code>.</p>
            <p data-translate="instructions_p2">You need to score at least <strong>6 out of 10</strong> to pass.</p>
            <p data-translate="instructions_p3">You can retry as many times as you like. Passing will update your progress on the dashboard.</p>
        </div>

        <form id="quiz-form">
            <!-- Questions will be injected here by JavaScript -->
        </form>

        <div style="text-align: center;"> <!-- Center the button -->
            <button type="submit" id="submit-button" class="quiz-button" data-translate="submit_btn">Check Answers</button>
        </div>

        <div id="results-area">
            <h3 id="results-title"></h3>
            <p id="score-display"></p>
            <p id="pass-fail-message"></p>
             <p id="save-confirm-message" style="font-style: italic; font-size: 0.9em; color: var(--text-muted); margin-top: -10px; margin-bottom: 15px;"></p>
            <button type="button" id="retry-button" class="quiz-button" data-translate="retry_btn">Retry Quiz</button>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 6; // <-- *** SET THIS FOR EACH KNOWLEDGE CHECK ***
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const PASSING_SCORE = 6; // Need 6 out of 10 to pass
        const LANGUAGE_STORAGE_KEY = 'userLanguage'; // Key for storing language

        // --- Quiz Data for Module 6 ---
        const quizData = [
            { id: 1, text_key: "q1_text", options: { a: "q1_opt_a", b: "q1_opt_b", c: "q1_opt_c", d: "q1_opt_d" }, correct_answer: "c" },
            { id: 2, text_key: "q2_text", options: { a: "q2_opt_a", b: "q2_opt_b", c: "q2_opt_c", d: "q2_opt_d" }, correct_answer: "a" },
            { id: 3, text_key: "q3_text", options: { a: "q3_opt_a", b: "q3_opt_b", c: "q3_opt_c", d: "q3_opt_d" }, correct_answer: "b" },
            { id: 4, text_key: "q4_text", options: { a: "q4_opt_a", b: "q4_opt_b", c: "q4_opt_c", d: "q4_opt_d" }, correct_answer: "d" },
            { id: 5, text_key: "q5_text", options: { a: "q5_opt_a", b: "q5_opt_b", c: "q5_opt_c", d: "q5_opt_d" }, correct_answer: "a" },
            { id: 6, text_key: "q6_text", options: { a: "q6_opt_a", b: "q6_opt_b", c: "q6_opt_c", d: "q6_opt_d" }, correct_answer: "c" },
            { id: 7, text_key: "q7_text", options: { a: "q7_opt_a", b: "q7_opt_b", c: "q7_opt_c", d: "q7_opt_d" }, correct_answer: "b" },
            { id: 8, text_key: "q8_text", options: { a: "q8_opt_a", b: "q8_opt_b", c: "q8_opt_c", d: "q8_opt_d" }, correct_answer: "d" },
            { id: 9, text_key: "q9_text", options: { a: "q9_opt_a", b: "q9_opt_b", c: "q9_opt_c", d: "q9_opt_d" }, correct_answer: "a" },
            { id: 10, text_key: "q10_text", options: { a: "q10_opt_a", b: "q10_opt_b", c: "q10_opt_c", d: "q10_opt_d" }, correct_answer: "c" }
        ];

        // --- Translations ---
        const translations = {
            en: {
                "page_title": `Knowledge Check: Module ${MODULE_ID} - Complete Python`,
                "return_btn": "Return to Dashboard",
                "quiz_title": `Knowledge Check: Module ${MODULE_ID}`,
                "instructions_p1": `Answer the following ${quizData.length} questions about Module ${MODULE_ID}: Simple Decisions - <code>if</code>.`,
                "instructions_p2": `You need to score at least <strong>${PASSING_SCORE} out of ${quizData.length}</strong> to pass.`,
                "instructions_p3": "You can retry as many times as you like. Passing will update your progress on the dashboard.",
                "submit_btn": "Check Answers",
                "retry_btn": "Retry Quiz",
                "results_title_pass": "Passed!",
                "results_title_fail": "Try Again",
                "score_display_text": "Your Score: {score}/{total}",
                "pass_message": "Congratulations! You passed the knowledge check for this module.",
                "fail_message": "You didn't pass this time. Review the material and try again!",
                "feedback_correct": "<strong>Correct!</strong>",
                "feedback_incorrect": "<strong>Incorrect.</strong> The correct answer was: {correct_option}",
                "progress_saved": "Your progress has been saved.",
                "footer_text": "Part of the Road to Free Open AGI Project",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                // Module 6 Questions (EN)
                "q1_text": "What is the primary purpose of an <code>if</code> statement in Python?",
                "q1_opt_a": "To repeat a block of code multiple times.",
                "q1_opt_b": "To store a value in a variable.",
                "q1_opt_c": "To execute a block of code only if a certain condition is true.",
                "q1_opt_d": "To define a new function.",
                "q2_text": "Which symbol marks the end of the <code>if</code> statement line and indicates the start of the indented block?",
                "q2_opt_a": ": (colon)",
                "q2_opt_b": "; (semicolon)",
                "q2_opt_c": "} (curly brace)",
                "q2_opt_d": "# (hash symbol)",
                "q3_text": "Consider the code: <code>temperature = 25\nif temperature > 20:\n    print('Warm')</code>. What will be printed?",
                "q3_opt_a": "Nothing",
                "q3_opt_b": "Warm",
                "q3_opt_c": "temperature > 20",
                "q3_opt_d": "An error",
                "q4_text": "What is crucial for Python to understand which lines of code belong inside an <code>if</code> block?",
                "q4_opt_a": "Using parentheses () around the code.",
                "q4_opt_b": "Using curly braces {} around the code.",
                "q4_opt_c": "Writing the code in all capital letters.",
                "q4_opt_d": "Consistent indentation (usually 4 spaces).",
                "q5_text": "What type of value does the condition in an <code>if</code> statement typically evaluate to?",
                "q5_opt_a": "Boolean (True or False)",
                "q5_opt_b": "Integer",
                "q5_opt_c": "String",
                "q5_opt_d": "List",
                "q6_text": "If the condition <code>x < 10</code> in <code>if x < 10: print('Small')</code> is <code>False</code>, what happens?",
                "q6_opt_a": "The program prints 'Small'.",
                "q6_opt_b": "The program produces an error.",
                "q6_opt_c": "The <code>print('Small')</code> line is skipped.",
                "q6_opt_d": "The program asks for a different value for x.",
                "q7_text": "Look at this code: <code>if True:\n print('Always')</code>. Will 'Always' be printed?",
                "q7_opt_a": "No, because 'True' is not a variable.",
                "q7_opt_b": "Yes, because the condition is directly True.",
                "q7_opt_c": "Only if a variable named True exists.",
                "q7_opt_d": "It depends on the indentation.",
                "q8_text": "Which comparison operator checks if two values are *equal*?",
                "q8_opt_a": "=",
                "q8_opt_b": "!=",
                "q8_opt_c": "=>",
                "q8_opt_d": "==",
                 "q9_text": "Consider: <code>score = 50\nif score >= 50:\n    print('Pass')</code>. What is the output?",
                 "q9_opt_a": "Pass",
                 "q9_opt_b": "Nothing",
                 "q9_opt_c": "An error",
                 "q9_opt_d": "score >= 50",
                 "q10_text": "What happens if the indentation is inconsistent within an <code>if</code> block?",
                 "q10_opt_a": "Python ignores the extra spaces.",
                 "q10_opt_b": "The code runs, but might be confusing.",
                 "q10_opt_c": "Python raises an IndentationError.",
                 "q10_opt_d": "Python automatically fixes the indentation."
            },
            pt: {
                "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Python Completo`,
                "return_btn": "Voltar ao Painel",
                "quiz_title": `Verificação de Conhecimento: Módulo ${MODULE_ID}`,
                "instructions_p1": `Responda às ${quizData.length} perguntas seguintes sobre o Módulo ${MODULE_ID}: Decisões Simples - <code>if</code>.`,
                "instructions_p2": `Você precisa acertar pelo menos <strong>${PASSING_SCORE} de ${quizData.length}</strong> para passar.`,
                "instructions_p3": "Você pode tentar quantas vezes quiser. Passar atualizará seu progresso no painel.",
                "submit_btn": "Verificar Respostas",
                "retry_btn": "Tentar Novamente",
                "results_title_pass": "Aprovado!",
                "results_title_fail": "Tente Novamente",
                "score_display_text": "Sua Pontuação: {score}/{total}",
                "pass_message": "Parabéns! Você passou na verificação de conhecimento para este módulo.",
                "fail_message": "Você não passou desta vez. Revise o material e tente novamente!",
                "feedback_correct": "<strong>Correto!</strong>",
                "feedback_incorrect": "<strong>Incorreto.</strong> A resposta correta era: {correct_option}",
                "progress_saved": "Seu progresso foi salvo.",
                "footer_text": "Parte do Projeto Road to Free Open AGI",
                "lang_select_aria": "Selecionar Idioma",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                // Module 6 Questions (PT)
                "q1_text": "Qual é o propósito principal de uma declaração <code>if</code> em Python?",
                "q1_opt_a": "Repetir um bloco de código várias vezes.",
                "q1_opt_b": "Armazenar um valor em uma variável.",
                "q1_opt_c": "Executar um bloco de código somente se uma determinada condição for verdadeira.",
                "q1_opt_d": "Definir uma nova função.",
                "q2_text": "Qual símbolo marca o fim da linha da declaração <code>if</code> e indica o início do bloco indentado?",
                "q2_opt_a": ": (dois pontos)",
                "q2_opt_b": "; (ponto e vírgula)",
                "q2_opt_c": "} (chave)",
                "q2_opt_d": "# (cerquilha)",
                "q3_text": "Considere o código: <code>temperatura = 25\nif temperatura > 20:\n    print('Quente')</code>. O que será impresso?",
                "q3_opt_a": "Nada",
                "q3_opt_b": "Quente",
                "q3_opt_c": "temperatura > 20",
                "q3_opt_d": "Um erro",
                "q4_text": "O que é crucial para o Python entender quais linhas de código pertencem a um bloco <code>if</code>?",
                "q4_opt_a": "Usar parênteses () ao redor do código.",
                "q4_opt_b": "Usar chaves {} ao redor do código.",
                "q4_opt_c": "Escrever o código todo em letras maiúsculas.",
                "q4_opt_d": "Indentação consistente (geralmente 4 espaços).",
                "q5_text": "Que tipo de valor a condição em uma declaração <code>if</code> tipicamente avalia?",
                "q5_opt_a": "Booleano (True ou False)",
                "q5_opt_b": "Inteiro",
                "q5_opt_c": "String",
                "q5_opt_d": "Lista",
                "q6_text": "Se a condição <code>x < 10</code> em <code>if x < 10: print('Pequeno')</code> for <code>False</code>, o que acontece?",
                "q6_opt_a": "O programa imprime 'Pequeno'.",
                "q6_opt_b": "O programa produz um erro.",
                "q6_opt_c": "A linha <code>print('Pequeno')</code> é pulada.",
                "q6_opt_d": "O programa pede um valor diferente para x.",
                "q7_text": "Observe este código: <code>if True:\n print('Sempre')</code>. 'Sempre' será impresso?",
                "q7_opt_a": "Não, porque 'True' não é uma variável.",
                "q7_opt_b": "Sim, porque a condição é diretamente True.",
                "q7_opt_c": "Apenas se existir uma variável chamada True.",
                "q7_opt_d": "Depende da indentação.",
                "q8_text": "Qual operador de comparação verifica se dois valores são *iguais*?",
                "q8_opt_a": "=",
                "q8_opt_b": "!=",
                "q8_opt_c": "=>",
                "q8_opt_d": "==",
                 "q9_text": "Considere: <code>pontos = 50\nif pontos >= 50:\n    print('Aprovado')</code>. Qual é a saída?",
                 "q9_opt_a": "Aprovado",
                 "q9_opt_b": "Nada",
                 "q9_opt_c": "Um erro",
                 "q9_opt_d": "pontos >= 50",
                 "q10_text": "O que acontece se a indentação for inconsistente dentro de um bloco <code>if</code>?",
                 "q10_opt_a": "Python ignora os espaços extras.",
                 "q10_opt_b": "O código roda, mas pode ser confuso.",
                 "q10_opt_c": "Python levanta um IndentationError.",
                 "q10_opt_d": "Python corrige automaticamente a indentação."
            },
            zh: {
                "page_title": `知识测验: 模块 ${MODULE_ID} - Python 完全指南`,
                "return_btn": "返回仪表板",
                "quiz_title": `知识测验: 模块 ${MODULE_ID}`,
                "instructions_p1": `回答以下关于模块 ${MODULE_ID} 的 ${quizData.length} 个问题: 简单决策 - <code>if</code>。`,
                "instructions_p2": `您需要至少答对 <strong>${quizData.length} 题中的 ${PASSING_SCORE} 题</strong> 才能通过。`,
                "instructions_p3": "您可以不限次数重试。通过后将更新您在仪表板上的进度。",
                "submit_btn": "检查答案",
                "retry_btn": "重新测验",
                "results_title_pass": "通过!",
                "results_title_fail": "再试一次",
                "score_display_text": "您的得分: {score}/{total}",
                "pass_message": "恭喜！您已通过本模块的知识测验。",
                "fail_message": "您这次未能通过。请复习相关内容后重试！",
                "feedback_correct": "<strong>正确!</strong>",
                "feedback_incorrect": "<strong>错误。</strong> 正确答案是: {correct_option}",
                "progress_saved": "您的进度已保存。",
                "footer_text": "通往自由开放AGI之路项目的一部分",
                "lang_select_aria": "选择语言",
                "lang_en": "🇬🇧 English",
                "lang_pt": "🇧🇷 Português",
                "lang_zh": "🇨🇳 中文",
                 // Module 6 Questions (ZH)
                 "q1_text": "Python 中 <code>if</code> 语句的主要目的是什么？",
                 "q1_opt_a": "重复执行一个代码块多次。",
                 "q1_opt_b": "将一个值存储在变量中。",
                 "q1_opt_c": "仅在特定条件为真时执行一个代码块。",
                 "q1_opt_d": "定义一个新函数。",
                 "q2_text": "哪个符号标记 <code>if</code> 语句行的结束并指示缩进块的开始？",
                 "q2_opt_a": ": (冒号)",
                 "q2_opt_b": "; (分号)",
                 "q2_opt_c": "} (花括号)",
                 "q2_opt_d": "# (井号)",
                 "q3_text": "考虑代码: <code>temperature = 25\nif temperature > 20:\n    print('Warm')</code>。将会打印什么？",
                 "q3_opt_a": "什么也不打印",
                 "q3_opt_b": "Warm",
                 "q3_opt_c": "temperature > 20",
                 "q3_opt_d": "一个错误",
                 "q4_text": "对于 Python 理解哪些代码行属于 <code>if</code> 块内，什么是至关重要的？",
                 "q4_opt_a": "在代码周围使用圆括号 ()。",
                 "q4_opt_b": "在代码周围使用花括号 {}。",
                 "q4_opt_c": "用全大写字母书写代码。",
                 "q4_opt_d": "一致的缩进 (通常是 4 个空格)。",
                 "q5_text": "<code>if</code> 语句中的条件通常计算为何种类型的值？",
                 "q5_opt_a": "布尔型 (True 或 False)",
                 "q5_opt_b": "整型",
                 "q5_opt_c": "字符串",
                 "q5_opt_d": "列表",
                 "q6_text": "如果在 <code>if x < 10: print('Small')</code> 中条件 <code>x < 10</code> 为 <code>False</code>，会发生什么？",
                 "q6_opt_a": "程序打印 'Small'。",
                 "q6_opt_b": "程序产生错误。",
                 "q6_opt_c": "<code>print('Small')</code> 这一行被跳过。",
                 "q6_opt_d": "程序要求为 x 输入一个不同的值。",
                 "q7_text": "看这段代码: <code>if True:\n print('Always')</code>。'Always' 会被打印吗？",
                 "q7_opt_a": "不会，因为 'True' 不是一个变量。",
                 "q7_opt_b": "会，因为条件直接就是 True。",
                 "q7_opt_c": "仅当存在名为 True 的变量时。",
                 "q7_opt_d": "这取决于缩进。",
                 "q8_text": "哪个比较运算符检查两个值是否 *相等*？",
                 "q8_opt_a": "=",
                 "q8_opt_b": "!=",
                 "q8_opt_c": "=>",
                 "q8_opt_d": "==",
                 "q9_text": "考虑: <code>score = 50\nif score >= 50:\n    print('Pass')</code>。输出是什么？",
                 "q9_opt_a": "Pass",
                 "q9_opt_b": "什么都没有",
                 "q9_opt_c": "一个错误",
                 "q9_opt_d": "score >= 50",
                 "q10_text": "如果 <code>if</code> 块内的缩进不一致会发生什么？",
                 "q10_opt_a": "Python 会忽略多余的空格。",
                 "q10_opt_b": "代码会运行，但可能令人困惑。",
                 "q10_opt_c": "Python 会引发 IndentationError。",
                 "q10_opt_d": "Python 会自动修复缩进。"
            }
        };

        // --- DOM Elements ---
        const quizForm = document.getElementById('quiz-form');
        const submitButton = document.getElementById('submit-button');
        const resultsArea = document.getElementById('results-area');
        const resultsTitle = document.getElementById('results-title');
        const scoreDisplay = document.getElementById('score-display');
        const passFailMessage = document.getElementById('pass-fail-message');
        const retryButton = document.getElementById('retry-button');
        const languageSelect = document.getElementById('languageSelect');
        const saveConfirmMessage = document.getElementById('save-confirm-message');


        // --- Core Functions ---

        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            document.documentElement.lang = lang;
            if (languageSelect) languageSelect.value = lang;
            translatePage(lang);
            renderQuiz(lang); // Re-render quiz with new language
            resetQuizVisuals(); // Reset results/feedback if language is changed mid-quiz
        }

        function getTranslation(key, lang, replacements = {}) {
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            // Handle potential HTML in translations
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            return tempDiv.innerHTML; // Return potentially sanitized HTML
        }

         function translatePage(lang) {
             if (!translations[lang]) lang = 'en';
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') {
                     document.title = translation.replace(/<[^>]*>/g, ""); // Strip HTML for title
                 } else {
                      // Check if the element itself should contain HTML or just text
                      if (['STRONG', 'CODE', 'I'].includes(el.nodeName) || el.closest('.quiz-instructions, .feedback, #pass-fail-message')) {
                          el.innerHTML = translation; // Allow HTML for specific elements/parents
                      } else {
                          el.textContent = translation.replace(/<[^>]*>/g, ""); // Default strip HTML
                      }
                 }
             });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang).replace(/<[^>]*>/g, ""));
             });
         }


        function renderQuiz(lang) {
            quizForm.innerHTML = ''; // Clear previous questions
            quizData.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.dataset.questionId = q.id;

                const questionNumber = document.createElement('span');
                questionNumber.classList.add('question-number');
                questionNumber.textContent = index + 1;

                const questionText = document.createElement('p');
                questionText.classList.add('question-text');
                questionText.innerHTML = getTranslation(q.text_key, lang); // Use innerHTML for potential <code> tags

                questionBlock.appendChild(questionNumber);
                questionBlock.appendChild(questionText);


                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options');

                for (const key in q.options) {
                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q${q.id}`;
                    input.value = key;
                    input.required = true; // Make selection mandatory

                    const optionText = document.createElement('span');
                    optionText.innerHTML = getTranslation(q.options[key], lang); // Use innerHTML

                    label.appendChild(input);
                    label.appendChild(optionText);
                    optionsDiv.appendChild(label);
                }

                questionBlock.appendChild(optionsDiv);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.classList.add('feedback'); // Initially hidden
                questionBlock.appendChild(feedbackDiv);

                quizForm.appendChild(questionBlock);
            });
        }

        function checkAnswers() {
            let score = 0;
            const lang = getStoredLanguage();

            quizData.forEach(q => {
                const questionBlock = quizForm.querySelector(`.question-block[data-question-id="${q.id}"]`);
                const feedbackDiv = questionBlock.querySelector('.feedback');
                const selectedOptionInput = quizForm.querySelector(`input[name="q${q.id}"]:checked`);
                const options = questionBlock.querySelectorAll('.options label');

                // Disable options after checking
                questionBlock.querySelectorAll('input[type="radio"]').forEach(inp => inp.disabled = true);

                feedbackDiv.innerHTML = ''; // Clear previous feedback
                feedbackDiv.classList.remove('correct', 'incorrect'); // Reset classes
                 options.forEach(optLabel => {
                     optLabel.classList.remove('correct', 'incorrect');
                     optLabel.style.borderColor = ''; // Reset border
                     optLabel.style.backgroundColor = ''; // Reset background
                 });


                if (selectedOptionInput) {
                    const userAnswer = selectedOptionInput.value;
                    const correctOptionLabel = questionBlock.querySelector(`input[value="${q.correct_answer}"]`).parentElement;
                    const selectedLabel = selectedOptionInput.parentElement;

                    if (userAnswer === q.correct_answer) {
                        score++;
                        feedbackDiv.innerHTML = getTranslation('feedback_correct', lang);
                        feedbackDiv.classList.add('correct');
                        selectedLabel.style.borderColor = 'var(--success-color)';
                        selectedLabel.style.backgroundColor = '#e9f7ef'; // Light green background
                    } else {
                         const correctOptionText = correctOptionLabel.querySelector('span').innerHTML;
                         feedbackDiv.innerHTML = getTranslation('feedback_incorrect', lang, { correct_option: `<strong>${correctOptionText}</strong>` });
                         feedbackDiv.classList.add('incorrect');
                         selectedLabel.style.borderColor = 'var(--error-color)';
                         selectedLabel.style.backgroundColor = '#fdeeee'; // Light red background
                         // Also highlight the correct one
                         correctOptionLabel.style.borderColor = 'var(--success-color)';
                         correctOptionLabel.style.fontWeight = 'bold';
                    }
                } else {
                    // Handle unanswered question (though 'required' should prevent this)
                    feedbackDiv.innerHTML = getTranslation('feedback_incorrect', lang, { correct_option: `<strong>${questionBlock.querySelector(`input[value="${q.correct_answer}"]`).parentElement.querySelector('span').innerHTML}</strong>` });
                    feedbackDiv.classList.add('incorrect');
                     // Highlight the correct one
                     const correctOptionLabel = questionBlock.querySelector(`input[value="${q.correct_answer}"]`).parentElement;
                     correctOptionLabel.style.borderColor = 'var(--success-color)';
                     correctOptionLabel.style.fontWeight = 'bold';
                }
            });

            displayResults(score, lang);
        }

        function displayResults(score, lang) {
            const totalQuestions = quizData.length;
            const passed = score >= PASSING_SCORE;

            // Update results area visibility and styling
            resultsArea.style.display = 'block';
            resultsArea.className = passed ? 'pass' : 'fail'; // Add pass/fail class for background

            // Set title and score
            resultsTitle.textContent = getTranslation(passed ? 'results_title_pass' : 'results_title_fail', lang);
            resultsTitle.className = passed ? 'pass' : 'fail';
            scoreDisplay.textContent = getTranslation('score_display_text', lang, { score: score, total: totalQuestions });

            // Set pass/fail message
            passFailMessage.innerHTML = getTranslation(passed ? 'pass_message' : 'fail_message', lang);

             // Show save confirmation only if passed
             saveConfirmMessage.textContent = passed ? getTranslation('progress_saved', lang) : '';


            // Hide submit, show retry
            submitButton.style.display = 'none';
            retryButton.style.display = 'inline-block'; // Make retry visible

            // Scroll to results
             resultsArea.scrollIntoView({ behavior: 'smooth', block: 'center' });


            // Save progress if passed
            if (passed) {
                saveProgress();
            }
        }

        function saveProgress() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const statusObject = storedStatus ? JSON.parse(storedStatus) : {};
                statusObject[MODULE_ID] = true; // Mark this module as complete
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
                console.log(`Knowledge Check ${MODULE_ID} passed and saved.`);
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
                // Optional: Display an error message to the user
            }
        }

         function resetQuizVisuals() {
             // Hide results, show submit button
             resultsArea.style.display = 'none';
             submitButton.style.display = 'inline-block';
             retryButton.style.display = 'none';

             // Clear feedback and styles from all questions
             quizForm.querySelectorAll('.feedback').forEach(fb => {
                 fb.innerHTML = '';
                 fb.classList.remove('correct', 'incorrect');
                 fb.style.display = 'none'; // Ensure it's hidden again
             });
              quizForm.querySelectorAll('.options label').forEach(optLabel => {
                 optLabel.classList.remove('correct', 'incorrect');
                 optLabel.style.borderColor = '';
                 optLabel.style.backgroundColor = '';
                 optLabel.style.fontWeight = ''; // Reset bolding of correct answer
             });

             // Enable inputs
             quizForm.querySelectorAll('input[type="radio"]').forEach(inp => inp.disabled = false);

             // Reset form selections
             quizForm.reset();
         }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            setLanguage(initialLang); // This also calls renderQuiz and translatePage

            quizForm.addEventListener('submit', (e) => {
                e.preventDefault();
                checkAnswers();
            });

            retryButton.addEventListener('click', () => {
                resetQuizVisuals();
                 // Scroll back to the top of the quiz
                quizForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });

             languageSelect.addEventListener('change', (e) => {
                 setLanguage(e.target.value);
             });
        });

    </script>

</body>
</html>