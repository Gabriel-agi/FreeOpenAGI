<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 10: Advanced Python Practice - Lists!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Same as Module 0 / Practice 10) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            /* Colors matching news.html for consistency in switcher potentially */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
            /* List colors */
            --list-literal-color: #ffd700; /* Gold for brackets */
            --list-element-color: #9cdcfe; /* Light blue for elements */
            --variable-color: #4ec9b0;     /* Teal for variables */
            --index-color: #b5cea8;       /* Light green for index numbers */
            --method-color: #c586c0;      /* Pink/Purple for methods */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Same as Module 0 / Practice 10) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }

        /* --- Advanced Animations (Same as Module 0 / Practice 10) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav (Same as Module 0 / Practice 10) --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }


        /* --- Practice Header (Same visual style, content changed by JS) --- */
        .practice-header { background: linear-gradient(135deg, var(--nav-success), var(--nav-primary)); /* Adjusted gradient for advanced feel */ color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        /* *** MODIFIED: Header icons for Advanced *** */
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* fa-cogs or fa-atom */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* fa-lightbulb or fa-rocket */

        /* --- Practice Section Styling (Same as Module 0 / Practice 10) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Same as Module 0 / Practice 10) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 150px; /* Increased max-height slightly */ margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        /* Code styling (Add method color) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; white-space: pre; /* Preserve whitespace */ }
        .code-keyword { color: #569cd6; } /* e.g., print */
        .code-string { color: #ce9178; } /* e.g., "CPU" */
        .code-comment { color: #6a9955; }
        .code-function { color: #dcdcaa; } /* e.g., print, len */
        .code-method { color: var(--method-color); } /* e.g., .append() */
        .code-paren { color: #ffd700; } /* () */
        .code-variable { color: var(--variable-color); } /* e.g., my_list */
        .code-list-literal { color: var(--list-literal-color); } /* [] */
        .code-element { color: var(--list-element-color); } /* Items inside list */
        .code-number { color: #b5cea8; } /* Numbers */
        .code-operator { color: #d4d4d4; } /* = , */
        .code-index { color: var(--index-color); } /* Index number inside [] */

        /* --- Activity 1 (Advanced): List Modification Simulator --- */
        #list-modify-simulator .sim-context { background-color: var(--background-medium); padding: 0.8rem 1rem; border-radius: var(--border-radius); margin-bottom: 1rem; font-family: var(--code-font); color: var(--text-dark); border: 1px solid #ccc; }
        #list-modify-simulator .sim-editor { width: 100%; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; }
        #list-modify-simulator .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #list-modify-simulator .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #list-modify-simulator .sim-output-area .output-line { display: block; }
        #list-modify-simulator .sim-output-area .error-line { display: block; color: var(--error-color); font-weight: bold; }

        /* --- Activity 2 (Advanced): List Slicing Explorer --- */
        #list-slicing-explorer .slice-context { font-family: var(--code-font); background: var(--background-medium); padding: 0.5rem 1rem; margin-bottom: 1.5rem; border-radius: var(--border-radius); border: 1px dashed var(--secondary-color); text-align: center; }
        #list-slicing-explorer .slice-controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; margin-bottom: 1.5rem; font-family: var(--code-font); }
        #list-slicing-explorer .slice-controls label { font-weight: bold; color: var(--secondary-color); }
        #list-slicing-explorer .slice-controls input[type="text"] { padding: 8px 10px; border: 1px solid #ccc; border-radius: 4px; font-family: var(--code-font); width: 60px; text-align: center; background-color: var(--background-light); }
        #list-slicing-explorer .slice-controls .code-variable { color: var(--variable-color); font-weight: bold; font-size: 1.1em;}
        #list-slicing-explorer .slice-controls .code-list-literal { color: var(--list-literal-color); font-weight: bold; font-size: 1.1em; }
        #list-slicing-explorer .slice-controls .code-operator { color: #d4d4d4; margin: 0 3px;} /* Colon */
        #list-slicing-explorer .slice-output { min-height: 40px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; text-align: center; }
        #list-slicing-explorer .slice-output .placeholder { color: var(--secondary-color); font-style: italic; }

        /* --- Activity 3 (Advanced): Method Match-Up --- */
        #method-matchup .match-container { display: flex; flex-wrap: wrap; gap: 2rem; justify-content: space-around; margin-top: 1rem;}
        #method-matchup .draggable-methods { display: flex; flex-direction: column; gap: 10px; padding: 1rem; background-color: var(--background-light); border: 1px dashed var(--secondary-color); border-radius: var(--border-radius); user-select: none; -webkit-user-select: none; -ms-user-select: none; min-width: 150px; }
        #method-matchup .method-piece { display: block; padding: 8px 12px; background-color: var(--method-color); color: var(--text-light); border-radius: 4px; cursor: grab; font-family: var(--code-font); font-size: 1rem; transition: background-color var(--transition-speed), transform var(--transition-speed), opacity 0.1s ease, box-shadow var(--transition-speed); border: 1px solid #a16aa1; touch-action: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center; }
        #method-matchup .method-piece:active { cursor: grabbing; }
        #method-matchup .method-piece.dragging { opacity: 0.6 !important; transform: scale(1.05) rotate(3deg); position: fixed !important; pointer-events: none !important; z-index: 1000 !important; cursor: grabbing !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        #method-matchup .method-piece.ghosting { opacity: 0.3; }
        #method-matchup .description-targets { display: flex; flex-direction: column; gap: 15px; flex-grow: 1; }
        #method-matchup .desc-target { min-height: 60px; background-color: var(--background-medium); border: 2px dashed var(--secondary-color); border-radius: var(--border-radius); padding: 15px; display: flex; align-items: center; justify-content: center; gap: 5px; transition: border-color var(--transition-speed), background-color var(--transition-speed), box-shadow var(--transition-speed); position: relative; }
        #method-matchup .desc-target.over { border-color: var(--accent-color); background-color: #dde2e6; box-shadow: inset 0 0 10px rgba(255,193,7,0.2); }
        #method-matchup .desc-target .desc-text { color: var(--text-dark); font-size: 0.95rem; text-align: center; flex-grow: 1;}
        #method-matchup .desc-target .method-piece { cursor: default; margin: 0; touch-action: auto; box-shadow: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: auto; /* Allow piece to resize slightly if needed */ }
        #method-matchup .desc-target.filled .desc-text { opacity: 0.3; } /* Dim description when filled */
        #method-matchup .desc-target.correct-match { border-style: solid; border-color: var(--success-color); background-color: #e9f7ec;}
        #method-matchup .desc-target.incorrect-match { border-style: solid; border-color: var(--error-color); background-color: #fbe L;}


        /* --- Activity 4 (Advanced): Mini Missions --- */
        /* Reusing styles from .practice-section #mini-missions */
        #adv-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        #adv-mini-missions .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        #adv-mini-missions .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        #adv-mini-missions .mission-status .fa-times-circle { color: var(--error-color); }
        #adv-mini-missions .mission-status .fa-question-circle { color: var(--secondary-color); }
        #adv-mini-missions .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #adv-mini-missions .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #adv-mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        #adv-mini-missions .mission-output .error-line { color: var(--error-color); font-weight: bold; }

        /* --- Final Section (Same as Module 0 / Practice 10) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Same as Module 0 / Practice 10) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            #list-slicing-explorer .slice-controls { gap: 10px; flex-direction: column; align-items: stretch;}
            #list-slicing-explorer .slice-controls input[type="text"] { width: 80%; margin: 0 auto; }
            #method-matchup .match-container { flex-direction: column; gap: 1rem;}
            #method-matchup .draggable-methods { flex-direction: row; flex-wrap: wrap; justify-content: center; }
            .button-group { flex-direction: column; align-items: center; }
             .minimal-nav { min-width: 180px; }
             .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
             #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            #list-modify-simulator .sim-editor, #list-modify-simulator .sim-output-area { font-size: 0.9rem; }
            #list-slicing-explorer .slice-controls input[type="text"] { width: 100px; } /* Maybe back to smaller width */
            #list-slicing-explorer .slice-output { font-size: 0.95rem;}
            #method-matchup .method-piece { padding: 6px 10px; font-size: 0.9rem;}
            #method-matchup .desc-target { padding: 10px; min-height: 50px;}
            #method-matchup .desc-text { font-size: 0.9rem;}
            #adv-mini-missions .mission-editor { min-height: 90px; font-size: 0.95rem;}
            #adv-mini-missions .mission-output { font-size: 0.95rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
             .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
             .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
             .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
             .minimal-nav ul li a i.fas { margin-right: 8px; }
             #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** MODIFIED: Updated links for Module 10 Advanced *** -->
            <li><a href="ctp-practice-10.html"><i class="fas fa-pencil-alt fa-fw"></i> <span data-translate="nav_standard_practice">Standard Practice</span></a></li>
            <li><a href="ctp-video-10.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video">View Video Lesson</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** MODIFIED: Activity links for this page *** -->
            <li><a href="#list-modify-simulator"><i class="fas fa-edit fa-fw"></i> <span data-translate="nav_modify">Modify</span></a></li>
            <li><a href="#list-slicing-explorer"><i class="fas fa-cut fa-fw"></i> <span data-translate="nav_slice">Slice</span></a></li>
            <li><a href="#method-matchup"><i class="fas fa-exchange-alt fa-fw"></i> <span data-translate="nav_match">Match Methods</span></a></li>
            <li><a href="#adv-mini-missions"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_adv_missions">Missions</span></a></li>
            <!-- Language Switcher Item (Same as Module 0 / Practice 10) -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- *** MODIFIED: Header icons for Advanced *** -->
        <i class="fas fa-cogs header-icon icon1"></i>
        <i class="fas fa-lightbulb header-icon icon2"></i>
        <div class="container">
            <!-- *** MODIFIED: Header text set by JS for Module 10 Advanced *** -->
            <h1 data-translate="header_title">Module 10: Advanced Practice</h1>
            <p data-translate="header_subtitle">Modify, slice, and use list methods!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1 (Advanced): List Modification Simulator ========= -->
        <section id="list-modify-simulator" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-edit"></i> <span data-translate="modify_title">List Modification Simulator</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="modify_desc">
                     Practice changing list elements. Try commands like <code class="code-font">items[0] = "New"</code>, <code class="code-font">items.append("End")</code>, or <code class="code-font">items.insert(1, "Middle")</code>.
                     This demonstrates list <span class="highlight">Mutability</span>.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="modify-sim-context" class="sim-context" data-translate="modify_context">Initial List: <code class="code-variable">items</code> = [<code class="code-string">"Laptop"</code>, <code class="code-string">"Keyboard"</code>]</div>
                     <label for="modify-sim-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="modify_editor_label">Modification Command:</label>
                     <input type="text" id="modify-sim-editor-input" class="sim-editor" data-translate-placeholder="modify_editor_placeholder" placeholder='e.g., items[1] = "Monitor"'>
                     <div class="text-center">
                          <button id="run-modify-sim-btn" class="action-button" data-translate="button_run_modify_sim">Run Command</button>
                          <button id="reset-modify-sim-btn" class="action-button secondary" data-translate="button_reset">Reset List</button>
                     </div>
                     <label for="modify-sim-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="modify_output_label">List State After Command:</label>
                     <div id="modify-sim-output" class="sim-output-area">
                         <span class="placeholder" data-translate="modify_output_placeholder">Updated list will appear here...</span>
                     </div>
                     <div id="modify-sim-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2 (Advanced): List Slicing Explorer ========= -->
        <section id="list-slicing-explorer" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-cut"></i> <span data-translate="slice_title">List Slicing Explorer</span></h2>
                <p class="section-description fade-in delay-1" data-translate="slice_desc">
                    Experiment with list slicing! Enter start, end, and step indices (leave blank for defaults). See the resulting sub-list. Negative indices work too!
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="slice-context-display" class="slice-context" data-translate="slice_context">Source List: <code class="code-variable">elements</code> = [<code class="code-string">"A"</code>, <code class="code-string">"B"</code>, <code class="code-string">"C"</code>, <code class="code-string">"D"</code>, <code class="code-string">"E"</code>, <code class="code-string">"F"</code>]</div>
                    <div class="slice-controls">
                        <span class="code-variable">elements</span>
                        <span class="code-list-literal">[</span>
                        <input type="text" id="slice-start" aria-label="Slice start index" data-translate-placeholder="slice_start_placeholder" placeholder="start">
                        <span class="code-operator">:</span>
                        <input type="text" id="slice-end" aria-label="Slice end index" data-translate-placeholder="slice_end_placeholder" placeholder="end">
                        <span class="code-operator">:</span>
                        <input type="text" id="slice-step" aria-label="Slice step" data-translate-placeholder="slice_step_placeholder" placeholder="step">
                        <span class="code-list-literal">]</span>
                    </div>
                     <div class="text-center">
                         <button id="run-slice-btn" class="action-button" data-translate="button_show_slice">Show Slice</button>
                     </div>
                    <label for="slice-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="slice_output_label">Resulting Slice:</label>
                    <div id="slice-output" class="slice-output">
                        <span class="placeholder" data-translate="slice_output_placeholder">Slice result appears here...</span>
                    </div>
                     <div id="slice-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 3 (Advanced): Method Match-Up ========= -->
        <section id="method-matchup" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-exchange-alt"></i> <span data-translate="match_title">Method Match-Up</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="match_desc">
                     Drag the list method name to its correct description or action. Understanding methods is key to efficient list manipulation.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="match-container">
                         <div id="draggable-methods" class="draggable-methods">
                             <!-- Method pieces populated by JS -->
                             <span class="placeholder" data-translate="match_drag_placeholder">Drag methods from here...</span>
                         </div>
                         <div id="description-targets" class="description-targets">
                             <!-- Description targets populated by JS -->
                             <span class="placeholder" data-translate="match_drop_placeholder">...to the matching description below.</span>
                         </div>
                     </div>
                     <div class="text-center">
                         <button id="check-match-btn" class="action-button" data-translate="button_check_match">Check Matches</button>
                         <button id="reset-match-btn" class="action-button secondary" data-translate="button_reset_match">Reset</button>
                     </div>
                     <div id="match-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 4 (Advanced): Mini Missions ========= -->
        <section id="adv-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="adv_missions_title">Advanced List Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="adv_missions_desc">
                     Apply your knowledge of list modification and methods to solve these challenges. Check the output carefully!
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Adv Mission 10-1 -->
                     <div class="mission" id="adv-mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission1_title">Adv Mission 1: Append and Print</h4>
                         <p data-translate="adv_mission1_desc">Create a list `gadgets = ["Phone", "Watch"]`. Then, append the string "Tablet" to the list. Finally, print the entire `gadgets` list.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission1_placeholder" placeholder='gadgets = ["item1", "item2"]\ngadgets.append("new_item")\nprint(gadgets)'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_adv_mission_1">Test Adv Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="adv-mission-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Adv Mission 10-2 -->
                     <div class="mission" id="adv-mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission2_title">Adv Mission 2: Pop and Print</h4>
                         <p data-translate="adv_mission2_desc">Create a list `scores = [85, 92, 78, 99]`. Use the `pop()` method to remove and retrieve the *last* score. Then, print the score that was removed.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission2_placeholder" placeholder='scores = [n1, n2, n3, n4]\nremoved_score = scores.pop()\nprint(removed_score)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_adv_mission_2">Test Adv Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="adv-mission-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Adv Mission 10-3 -->
                     <div class="mission" id="adv-mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="adv_mission3_title">Adv Mission 3: Insert and Check Length</h4>
                         <p data-translate="adv_mission3_desc">Create a list `queue = ["Alice", "Charlie"]`. Insert "Bob" at index 1 (between Alice and Charlie). Then, print the length of the updated `queue` list.</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="adv_mission3_placeholder" placeholder='queue = ["p1", "p2"]\nqueue.insert(index, "new_p")\nprint(len(queue))'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_adv_mission_3">Test Adv Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="adv-mission-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="adv-missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in"> <!-- Animation applied -->
                     <i class="fas fa-graduation-cap"></i> <i class="fas fa-clipboard-check"></i> <i class="fas fa-star"></i>
                </div>
                <!-- *** MODIFIED: Completion text for Module 10 Advanced *** -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 10 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Fantastic! You've practiced modifying lists, slicing them, and using key methods. These are powerful tools in Python.
                    <br>Review the standard practice or watch the video lesson if needed, or proceed to the next module!
                </p>
                <div class="button-group">
                    <!-- *** MODIFIED: Updated links for Module 10 Advanced *** -->
                    <a href="ctp-practice-10.html" class="action-button secondary fade-in delay-3"><i class="fas fa-arrow-left"></i> <span data-translate="button_back_standard">Back to Standard Practice</span></a>
                    <a href="ctp-video-10.html" class="action-button success fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_watch_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 10: Advanced Python Practice - Lists!",
            "nav_standard_practice": "Standard Practice", "nav_video": "View Video Lesson", "nav_menu": "Course Menu",
            "nav_modify": "Modify", "nav_slice": "Slice", "nav_match": "Match Methods", "nav_adv_missions": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 10: Advanced Practice", "header_subtitle": "Modify, slice, and use list methods!",
            // Activity 1: Modify Simulator
            "modify_title": "List Modification Simulator", "modify_desc": "Practice changing list elements. Try commands like <code class=\"code-font\">items[0] = \"New\"</code>, <code class=\"code-font\">items.append(\"End\")</code>, or <code class=\"code-font\">items.insert(1, \"Middle\")</code>. This demonstrates list <span class=\"highlight\">Mutability</span>.",
            "modify_context": "Initial List: <code class=\"code-variable\">items</code> = [<code class=\"code-string\">\"Laptop\"</code>, <code class=\"code-string\">\"Keyboard\"</code>]",
            "modify_editor_label": "Modification Command:", "modify_editor_placeholder": "e.g., items[1] = \"Monitor\"",
            "button_run_modify_sim": "Run Command", "button_reset": "Reset List",
            "modify_output_label": "List State After Command:", "modify_output_placeholder": "Updated list will appear here...",
            "feedback_modify_success": "Modification successful! List updated.",
            "feedback_modify_empty": "Input is empty.",
            "feedback_modify_list_mismatch": "Incorrect list name. Use `items`.",
            "feedback_modify_index_error": "IndexError! Index is outside the valid range for assignment/insert.",
            "feedback_modify_value_error": "ValueError! Check the value provided (e.g., for `remove`).",
            "feedback_modify_syntax_assign": "Syntax Error. For assignment use: `items[index] = value` (ensure value has quotes if string).",
            "feedback_modify_syntax_append": "Syntax Error. For append use: `items.append(value)` (ensure value has quotes if string).",
            "feedback_modify_syntax_insert": "Syntax Error. For insert use: `items.insert(index, value)` (ensure value has quotes if string).",
            "feedback_modify_syntax_pop": "Syntax Error. For pop use: `items.pop()` or `items.pop(index)`.",
            "feedback_modify_syntax_remove": "Syntax Error. For remove use: `items.remove(value)` (ensure value has quotes if string).",
            "feedback_modify_unknown_command": "Unknown command or syntax. Try assignment, append, insert, pop, or remove.",
            "feedback_modify_list_reset": "List reset to initial state.",
            // Activity 2: Slice Explorer
            "slice_title": "List Slicing Explorer", "slice_desc": "Experiment with list slicing! Enter start, end, and step indices (leave blank for defaults). See the resulting sub-list. Negative indices work too!",
            "slice_context": "Source List: <code class=\"code-variable\">elements</code> = [<code class=\"code-string\">\"A\"</code>, <code class=\"code-string\">\"B\"</code>, <code class=\"code-string\">\"C\"</code>, <code class=\"code-string\">\"D\"</code>, <code class=\"code-string\">\"E\"</code>, <code class=\"code-string\">\"F\"</code>]",
            "slice_start_placeholder": "start", "slice_end_placeholder": "end", "slice_step_placeholder": "step",
            "button_show_slice": "Show Slice", "slice_output_label": "Resulting Slice:", "slice_output_placeholder": "Slice result appears here...",
            "feedback_slice_success": "Slice generated!",
            "feedback_slice_invalid_input": "Invalid input. Indices and step must be integers (or blank). Step cannot be 0.",
            // Activity 3: Method Match-Up
            "match_title": "Method Match-Up", "match_desc": "Drag the list method name to its correct description or action. Understanding methods is key to efficient list manipulation.",
            "match_drag_placeholder": "Drag methods from here...", "match_drop_placeholder": "...to the matching description below.",
            "method_piece_append": "append()", "method_piece_insert": "insert()", "method_piece_pop": "pop()", "method_piece_remove": "remove()", // Method Names
            "method_desc_append": "Adds an element to the very end of the list.", "method_desc_insert": "Adds an element at a specific index.",
            "method_desc_pop": "Removes and returns element at an index (default: last).", "method_desc_remove": "Removes the first occurrence of a specific value.", // Descriptions
            "button_check_match": "Check Matches", "button_reset_match": "Reset",
            "feedback_match_correct": "Perfect match! All methods correctly identified. <i class=\"fas fa-check-circle\"></i>",
            "feedback_match_incorrect": "Not quite right. {count} incorrect match(es). Try again!",
            "feedback_match_incomplete": "Drag all methods to a description before checking.",
            // Activity 4: Advanced Mini Missions
            "adv_missions_title": "Advanced List Missions!", "adv_missions_desc": "Apply your knowledge of list modification and methods to solve these challenges. Check the output carefully!",
            "adv_mission1_title": "Adv Mission 1: Append and Print", "adv_mission1_desc": "Create a list `gadgets = [\"Phone\", \"Watch\"]`. Then, append the string \"Tablet\" to the list. Finally, print the entire `gadgets` list.", "adv_mission1_placeholder": "gadgets = [\"item1\", \"item2\"]\ngadgets.append(\"new_item\")\nprint(gadgets)",
            "button_test_adv_mission_1": "Test Adv Mission 1",
            "adv_mission2_title": "Adv Mission 2: Pop and Print", "adv_mission2_desc": "Create a list `scores = [85, 92, 78, 99]`. Use the `pop()` method to remove and retrieve the *last* score. Then, print the score that was removed.", "adv_mission2_placeholder": "scores = [n1, n2, n3, n4]\nremoved_score = scores.pop()\nprint(removed_score)",
            "button_test_adv_mission_2": "Test Adv Mission 2",
            "adv_mission3_title": "Adv Mission 3: Insert and Check Length", "adv_mission3_desc": "Create a list `queue = [\"Alice\", \"Charlie\"]`. Insert \"Bob\" at index 1 (between Alice and Charlie). Then, print the length of the updated `queue` list.", "adv_mission3_placeholder": "queue = [\"p1\", \"p2\"]\nqueue.insert(index, \"new_p\")\nprint(len(queue))",
            "button_test_adv_mission_3": "Test Adv Mission 3",
            "feedback_adv_mission_success": "Advanced Mission Accomplished!", "feedback_adv_mission_syntax_error": "Syntax error or wrong approach. Check list creation, method calls (parentheses, arguments), or print statement.",
            "feedback_adv_mission1_hint_list": "Ensure `gadgets` list is created correctly: `[\"Phone\", \"Watch\"]`.",
            "feedback_adv_mission1_hint_append": "Use `gadgets.append(\"Tablet\")` correctly.",
            "feedback_adv_mission1_hint_print": "Ensure the final line is `print(gadgets)`.",
            "feedback_adv_mission2_hint_list": "Ensure `scores` list is `[85, 92, 78, 99]`.",
            "feedback_adv_mission2_hint_pop": "Use `scores.pop()` to get the last item. Store the result if needed for printing.",
            "feedback_adv_mission2_hint_print": "Print the value returned by `pop()`. Expected output: 99.",
            "feedback_adv_mission3_hint_list": "Ensure `queue` list is `[\"Alice\", \"Charlie\"]`.",
            "feedback_adv_mission3_hint_insert": "Use `queue.insert(1, \"Bob\")` to insert at the correct index.",
            "feedback_adv_mission3_hint_len": "Use `print(len(queue))` after inserting. Expected output: 3.",
            "feedback_adv_mission_generic_error": "Check the code against the mission requirements carefully. Did you print the expected result?",
            "feedback_adv_missions_summary_all_done": "All {totalMissions} advanced missions complete! Well done!", "feedback_adv_missions_summary_progress": "Completed {completedCount} of {totalMissions} advanced missions. Keep going!",
            // Completion Section
            "completion_title": "Module 10 Advanced Practice Complete!", "completion_desc": "Fantastic! You've practiced modifying lists, slicing them, and using key methods. These are powerful tools in Python.<br>Review the standard practice or watch the video lesson if needed, or proceed to the next module!",
            "button_back_standard": "Back to Standard Practice", "button_watch_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu" // back_menu is reused
        },
        pt: {
            "page_title": "Módulo 10: Prática Avançada Python - Listas!",
            "nav_standard_practice": "Prática Padrão", "nav_video": "Ver Lição em Vídeo", "nav_menu": "Menu do Curso",
            "nav_modify": "Modificar", "nav_slice": "Fatiar", "nav_match": "Combinar Métodos", "nav_adv_missions": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 10: Prática Avançada", "header_subtitle": "Modifique, fatie e use métodos de lista!",
            // Activity 1: Modify Simulator
            "modify_title": "Simulador de Modificação de Lista", "modify_desc": "Pratique a alteração de elementos da lista. Tente comandos como <code class=\"code-font\">items[0] = \"Novo\"</code>, <code class=\"code-font\">items.append(\"Fim\")</code>, ou <code class=\"code-font\">items.insert(1, \"Meio\")</code>. Isso demonstra a <span class=\"highlight\">Mutabilidade</span> da lista.",
            "modify_context": "Lista Inicial: <code class=\"code-variable\">items</code> = [<code class=\"code-string\">\"Laptop\"</code>, <code class=\"code-string\">\"Teclado\"</code>]", // PT context
            "modify_editor_label": "Comando de Modificação:", "modify_editor_placeholder": "ex: items[1] = \"Monitor\"",
            "button_run_modify_sim": "Executar Comando", "button_reset": "Resetar Lista",
            "modify_output_label": "Estado da Lista Após Comando:", "modify_output_placeholder": "Lista atualizada aparecerá aqui...",
            "feedback_modify_success": "Modificação bem-sucedida! Lista atualizada.",
            "feedback_modify_empty": "Entrada vazia.",
            "feedback_modify_list_mismatch": "Nome da lista incorreto. Use `items`.",
            "feedback_modify_index_error": "IndexError! Índice fora do intervalo válido para atribuição/inserção.",
            "feedback_modify_value_error": "ValueError! Verifique o valor fornecido (ex: para `remove`).",
            "feedback_modify_syntax_assign": "Erro de Sintaxe. Para atribuição use: `items[indice] = valor` (valor string entre aspas).",
            "feedback_modify_syntax_append": "Erro de Sintaxe. Para append use: `items.append(valor)` (valor string entre aspas).",
            "feedback_modify_syntax_insert": "Erro de Sintaxe. Para insert use: `items.insert(indice, valor)` (valor string entre aspas).",
            "feedback_modify_syntax_pop": "Erro de Sintaxe. Para pop use: `items.pop()` ou `items.pop(indice)`.",
            "feedback_modify_syntax_remove": "Erro de Sintaxe. Para remove use: `items.remove(valor)` (valor string entre aspas).",
            "feedback_modify_unknown_command": "Comando ou sintaxe desconhecida. Tente atribuição, append, insert, pop, ou remove.",
            "feedback_modify_list_reset": "Lista resetada para o estado inicial.",
            // Activity 2: Slice Explorer
            "slice_title": "Explorador de Fatiamento de Lista", "slice_desc": "Experimente fatiar listas! Insira índices de início, fim e passo (deixe em branco para padrões). Veja a sub-lista resultante. Índices negativos também funcionam!",
            "slice_context": "Lista Fonte: <code class=\"code-variable\">elementos</code> = [<code class=\"code-string\">\"A\"</code>, <code class=\"code-string\">\"B\"</code>, <code class=\"code-string\">\"C\"</code>, <code class=\"code-string\">\"D\"</code>, <code class=\"code-string\">\"E\"</code>, <code class=\"code-string\">\"F\"</code>]", // PT context
            "slice_start_placeholder": "início", "slice_end_placeholder": "fim", "slice_step_placeholder": "passo",
            "button_show_slice": "Mostrar Fatia", "slice_output_label": "Fatia Resultante:", "slice_output_placeholder": "Resultado da fatia aparece aqui...",
            "feedback_slice_success": "Fatia gerada!",
            "feedback_slice_invalid_input": "Entrada inválida. Índices e passo devem ser inteiros (ou em branco). Passo não pode ser 0.",
            // Activity 3: Method Match-Up
            "match_title": "Combinação de Métodos", "match_desc": "Arraste o nome do método da lista para sua descrição ou ação correta. Entender métodos é chave para manipulação eficiente de listas.",
            "match_drag_placeholder": "Arraste métodos daqui...", "match_drop_placeholder": "...para a descrição correspondente abaixo.",
            "method_piece_append": "append()", "method_piece_insert": "insert()", "method_piece_pop": "pop()", "method_piece_remove": "remove()",
            "method_desc_append": "Adiciona um elemento ao final da lista.", "method_desc_insert": "Adiciona um elemento em um índice específico.",
            "method_desc_pop": "Remove e retorna elemento em um índice (padrão: último).", "method_desc_remove": "Remove a primeira ocorrência de um valor específico.",
            "button_check_match": "Verificar Combinações", "button_reset_match": "Resetar",
            "feedback_match_correct": "Combinação perfeita! Todos os métodos identificados corretamente. <i class=\"fas fa-check-circle\"></i>",
            "feedback_match_incorrect": "Não está certo. {count} combinação(ões) incorreta(s). Tente de novo!",
            "feedback_match_incomplete": "Arraste todos os métodos para uma descrição antes de verificar.",
             // Activity 4: Advanced Mini Missions
            "adv_missions_title": "Missões Avançadas de Lista!", "adv_missions_desc": "Aplique seu conhecimento de modificação e métodos de lista para resolver estes desafios. Verifique a saída cuidadosamente!",
            "adv_mission1_title": "Missão Avançada 1: Anexar e Imprimir", "adv_mission1_desc": "Crie uma lista `gadgets = [\"Phone\", \"Watch\"]`. Então, anexe a string \"Tablet\" à lista. Finalmente, imprima a lista `gadgets` inteira.", "adv_mission1_placeholder": "gadgets = [\"item1\", \"item2\"]\ngadgets.append(\"novo_item\")\nprint(gadgets)",
            "button_test_adv_mission_1": "Testar Missão Avançada 1",
            "adv_mission2_title": "Missão Avançada 2: Pop e Imprimir", "adv_mission2_desc": "Crie uma lista `scores = [85, 92, 78, 99]`. Use o método `pop()` para remover e obter a *última* pontuação. Então, imprima a pontuação que foi removida.", "adv_mission2_placeholder": "scores = [n1, n2, n3, n4]\npont_removida = scores.pop()\nprint(pont_removida)",
            "button_test_adv_mission_2": "Testar Missão Avançada 2",
            "adv_mission3_title": "Missão Avançada 3: Inserir e Verificar Tamanho", "adv_mission3_desc": "Crie uma lista `queue = [\"Alice\", \"Charlie\"]`. Insira \"Bob\" no índice 1 (entre Alice e Charlie). Então, imprima o tamanho da lista `queue` atualizada.", "adv_mission3_placeholder": "queue = [\"p1\", \"p2\"]\nqueue.insert(indice, \"novo_p\")\nprint(len(queue))",
            "button_test_adv_mission_3": "Testar Missão Avançada 3",
            "feedback_adv_mission_success": "Missão Avançada Cumprida!", "feedback_adv_mission_syntax_error": "Erro de sintaxe ou abordagem errada. Verifique criação da lista, chamadas de método (parênteses, argumentos) ou comando print.",
            "feedback_adv_mission1_hint_list": "Garanta que a lista `gadgets` está correta: `[\"Phone\", \"Watch\"]`.",
            "feedback_adv_mission1_hint_append": "Use `gadgets.append(\"Tablet\")` corretamente.",
            "feedback_adv_mission1_hint_print": "Garanta que a linha final é `print(gadgets)`.",
            "feedback_adv_mission2_hint_list": "Garanta que a lista `scores` é `[85, 92, 78, 99]`.",
            "feedback_adv_mission2_hint_pop": "Use `scores.pop()` para pegar o último item. Guarde o resultado se precisar imprimir.",
            "feedback_adv_mission2_hint_print": "Imprima o valor retornado por `pop()`. Saída esperada: 99.",
            "feedback_adv_mission3_hint_list": "Garanta que a lista `queue` é `[\"Alice\", \"Charlie\"]`.",
            "feedback_adv_mission3_hint_insert": "Use `queue.insert(1, \"Bob\")` para inserir no índice correto.",
            "feedback_adv_mission3_hint_len": "Use `print(len(queue))` após inserir. Saída esperada: 3.",
            "feedback_adv_mission_generic_error": "Verifique o código cuidadosamente contra os requisitos da missão. Você imprimiu o resultado esperado?",
            "feedback_adv_missions_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Muito bem!", "feedback_adv_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões avançadas. Continue!",
            // Completion Section
            "completion_title": "Prática Avançada do Módulo 10 Completa!", "completion_desc": "Fantástico! Você praticou modificar listas, fatiá-las e usar métodos chave. Estas são ferramentas poderosas em Python.<br>Revise a prática padrão ou assista a lição em vídeo se necessário, ou prossiga para o próximo módulo!",
            "button_back_standard": "Voltar à Prática Padrão", "button_watch_video": "Ver Lição em Vídeo", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 10：高级 Python 实践 - 列表！",
            "nav_standard_practice": "标准练习", "nav_video": "观看视频课程", "nav_menu": "课程菜单",
            "nav_modify": "修改", "nav_slice": "切片", "nav_match": "匹配方法", "nav_adv_missions": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 10：高级练习", "header_subtitle": "修改、切片和使用列表方法！",
            // Activity 1: Modify Simulator
            "modify_title": "列表修改模拟器", "modify_desc": "练习更改列表元素。尝试像 <code class=\"code-font\">items[0] = \"New\"</code>, <code class=\"code-font\">items.append(\"End\")</code>, 或 <code class=\"code-font\">items.insert(1, \"Middle\")</code> 这样的命令。这演示了列表的<span class=\"highlight\">可变性</span>。",
            "modify_context": "初始列表: <code class=\"code-variable\">items</code> = [<code class=\"code-string\">\"笔记本电脑\"</code>, <code class=\"code-string\">\"键盘\"</code>]", // ZH context
            "modify_editor_label": "修改命令：", "modify_editor_placeholder": "例如：items[1] = \"显示器\"",
            "button_run_modify_sim": "运行命令", "button_reset": "重置列表",
            "modify_output_label": "命令后列表状态：", "modify_output_placeholder": "更新后的列表将显示在此处...",
            "feedback_modify_success": "修改成功！列表已更新。",
            "feedback_modify_empty": "输入为空。",
            "feedback_modify_list_mismatch": "列表名称错误。请使用 `items`。",
            "feedback_modify_index_error": "IndexError! 索引超出了赋值/插入的有效范围。",
            "feedback_modify_value_error": "ValueError! 检查提供的值（例如，用于 `remove`）。",
            "feedback_modify_syntax_assign": "语法错误。赋值请使用：`items[索引] = 值`（确保字符串值有引号）。",
            "feedback_modify_syntax_append": "语法错误。追加请使用：`items.append(值)`（确保字符串值有引号）。",
            "feedback_modify_syntax_insert": "语法错误。插入请使用：`items.insert(索引, 值)`（确保字符串值有引号）。",
            "feedback_modify_syntax_pop": "语法错误。弹出请使用：`items.pop()` 或 `items.pop(索引)`。",
            "feedback_modify_syntax_remove": "语法错误。移除请使用：`items.remove(值)`（确保字符串值有引号）。",
            "feedback_modify_unknown_command": "未知命令或语法。请尝试赋值、append、insert、pop 或 remove。",
            "feedback_modify_list_reset": "列表已重置为初始状态。",
            // Activity 2: Slice Explorer
            "slice_title": "列表切片探索器", "slice_desc": "实验列表切片！输入开始、结束和步长索引（留空为默认值）。查看生成的子列表。负数索引也可以！",
            "slice_context": "源列表: <code class=\"code-variable\">elements</code> = [<code class=\"code-string\">\"A\"</code>, <code class=\"code-string\">\"B\"</code>, <code class=\"code-string\">\"C\"</code>, <code class=\"code-string\">\"D\"</code>, <code class=\"code-string\">\"E\"</code>, <code class=\"code-string\">\"F\"</code>]", // ZH context
            "slice_start_placeholder": "开始", "slice_end_placeholder": "结束", "slice_step_placeholder": "步长",
            "button_show_slice": "显示切片", "slice_output_label": "结果切片：", "slice_output_placeholder": "切片结果显示在此处...",
            "feedback_slice_success": "切片已生成！",
            "feedback_slice_invalid_input": "输入无效。索引和步长必须是整数（或空白）。步长不能为 0。",
             // Activity 3: Method Match-Up
            "match_title": "方法匹配", "match_desc": "将列表方法名称拖动到其正确的描述或操作上。理解方法是高效列表操作的关键。",
            "match_drag_placeholder": "从这里拖动方法...", "match_drop_placeholder": "...到下面匹配的描述。",
            "method_piece_append": "append()", "method_piece_insert": "insert()", "method_piece_pop": "pop()", "method_piece_remove": "remove()",
            "method_desc_append": "将一个元素添加到列表的最末尾。", "method_desc_insert": "在指定索引处添加一个元素。",
            "method_desc_pop": "移除并返回指定索引的元素（默认为最后一个）。", "method_desc_remove": "移除第一个出现的指定值。",
            "button_check_match": "检查匹配", "button_reset_match": "重置",
            "feedback_match_correct": "完美匹配！所有方法均已正确识别。 <i class=\"fas fa-check-circle\"></i>",
            "feedback_match_incorrect": "不太对。{count} 个匹配错误。再试一次！",
            "feedback_match_incomplete": "检查前请将所有方法拖到描述区。",
            // Activity 4: Advanced Mini Missions
            "adv_missions_title": "高级列表任务！", "adv_missions_desc": "运用你所学的列表修改和方法知识来解决这些挑战。仔细检查输出！",
            "adv_mission1_title": "高级任务 1：追加并打印", "adv_mission1_desc": "创建一个列表 `gadgets = [\"Phone\", \"Watch\"]`。然后，将字符串 \"Tablet\" 追加到列表末尾。最后，打印整个 `gadgets` 列表。", "adv_mission1_placeholder": "gadgets = [\"item1\", \"item2\"]\ngadgets.append(\"new_item\")\nprint(gadgets)",
            "button_test_adv_mission_1": "测试高级任务 1",
            "adv_mission2_title": "高级任务 2：弹出并打印", "adv_mission2_desc": "创建一个列表 `scores = [85, 92, 78, 99]`。使用 `pop()` 方法移除并获取*最后*一个分数。然后，打印被移除的分数。", "adv_mission2_placeholder": "scores = [n1, n2, n3, n4]\nremoved_score = scores.pop()\nprint(removed_score)",
            "button_test_adv_mission_2": "测试高级任务 2",
            "adv_mission3_title": "高级任务 3：插入并检查长度", "adv_mission3_desc": "创建一个列表 `queue = [\"Alice\", \"Charlie\"]`。在索引 1 处（Alice 和 Charlie 之间）插入 \"Bob\"。然后，打印更新后的 `queue` 列表的长度。", "adv_mission3_placeholder": "queue = [\"p1\", \"p2\"]\nqueue.insert(index, \"new_p\")\nprint(len(queue))",
            "button_test_adv_mission_3": "测试高级任务 3",
            "feedback_adv_mission_success": "高级任务完成！", "feedback_adv_mission_syntax_error": "语法错误或方法错误。检查列表创建、方法调用（括号、参数）或打印语句。",
            "feedback_adv_mission1_hint_list": "确保 `gadgets` 列表正确创建：`[\"Phone\", \"Watch\"]`。",
            "feedback_adv_mission1_hint_append": "正确使用 `gadgets.append(\"Tablet\")`。",
            "feedback_adv_mission1_hint_print": "确保最后一行是 `print(gadgets)`。",
            "feedback_adv_mission2_hint_list": "确保 `scores` 列表是 `[85, 92, 78, 99]`。",
            "feedback_adv_mission2_hint_pop": "使用 `scores.pop()` 获取最后一项。如果需要打印，请存储结果。",
            "feedback_adv_mission2_hint_print": "打印 `pop()` 返回的值。预期输出：99。",
            "feedback_adv_mission3_hint_list": "确保 `queue` 列表是 `[\"Alice\", \"Charlie\"]`。",
            "feedback_adv_mission3_hint_insert": "使用 `queue.insert(1, \"Bob\")` 在正确的索引处插入。",
            "feedback_adv_mission3_hint_len": "插入后使用 `print(len(queue))`。预期输出：3。",
            "feedback_adv_mission_generic_error": "请仔细对照任务要求检查代码。您打印了预期的结果吗？",
            "feedback_adv_missions_summary_all_done": "所有 {totalMissions} 个高级任务已完成！做得好！", "feedback_adv_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个高级任务。继续努力！",
            // Completion Section
            "completion_title": "模块 10 高级练习完成！", "completion_desc": "太棒了！你练习了修改列表、进行切片以及使用关键方法。这些都是 Python 中的强大工具。<br>如果需要，可以复习标准练习或观看视频课程，或者继续学习下一个模块！",
            "button_back_standard": "返回标准练习", "button_watch_video": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Same as Practice 10) ---
        function getStoredLanguage() { /* ... Same code ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en';
        }
        function setLanguage(lang) { /* ... Same code, but re-init NEW activities ... */
            if (!translations[lang]) lang = 'en';
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang);
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

            // Re-initialize activities dependent on language
            if (listModifySimulator) setupListModifySimulator(); // New
            if (listSlicingExplorer) setupListSlicingExplorer(); // New
            if (methodMatchup) setupMethodMatchup();          // New
            if (advMissionsSection && typeof updateAdvMissionSummary === 'function') updateAdvMissionSummary(); // New
        }
        function getTranslation(key, lang, replacements = {}) { /* ... Same code ... */
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
         }
        function translatePage(lang) { /* ... Same code ... */
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else {
                     // Basic check to allow simple HTML like <code> or <span>
                     if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                     else { el.textContent = translation; }
                 }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });
        }
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Same as Practice 10) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
            document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target)) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
            document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Same as Practice 10) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => setLanguage(e.target.value));
        }

        // --- Helper Function for Feedback (Same as Practice 10) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) { /* ... Same code ... */
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
            // Use innerHTML carefully to allow simple tags like <i> for icons
            feedbackEl.innerHTML = translatedMessage;
            feedbackEl.className = 'feedback-message'; // Reset classes first
            feedbackEl.classList.add('visible', type);

            // Animation trigger (optional, but nice)
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') {
                interactiveArea.classList.add('success-glow-anim');
            } else if (type === 'incorrect') {
                interactiveArea.classList.add('shake-anim');
            }
        }


        // --- Activity 1 (Advanced): List Modification Simulator ---
        const listModifySimulator = document.getElementById('list-modify-simulator');
        let simModifyListContent = []; // State variable for the list

        function setupListModifySimulator() {
            if (!listModifySimulator) return;
            const editor = document.getElementById('modify-sim-editor-input');
            const outputArea = document.getElementById('modify-sim-output');
            const feedbackDiv = document.getElementById('modify-sim-feedback');
            const contextDiv = document.getElementById('modify-sim-context');
            const runBtn = document.getElementById('run-modify-sim-btn');
            const resetBtn = document.getElementById('reset-modify-sim-btn');
            const currentLang = getStoredLanguage();

            // Reset list to initial state based on translated context if needed
            // For simplicity, we'll use the English base ["Laptop", "Keyboard"]
            // If context changes drastically by language, adjust this.
            simModifyListContent = ["Laptop", "Keyboard"];

            editor.value = '';
            outputArea.innerHTML = `<span class="placeholder">${getTranslation('modify_output_placeholder', currentLang)}</span>`;
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
            contextDiv.innerHTML = getTranslation('modify_context', currentLang); // Update context display
            runBtn.disabled = false;
        }

        if (listModifySimulator) {
            const editor = document.getElementById('modify-sim-editor-input');
            const outputArea = document.getElementById('modify-sim-output');
            const feedbackDiv = document.getElementById('modify-sim-feedback');
            const runBtn = document.getElementById('run-modify-sim-btn');
            const resetBtn = document.getElementById('reset-modify-sim-btn');

            resetBtn.addEventListener('click', () => {
                setupListModifySimulator();
                 showFeedback('modify-sim-feedback', 'feedback_modify_list_reset', 'info');
            });

            runBtn.addEventListener('click', () => {
                const command = editor.value.trim();
                const currentLang = getStoredLanguage();
                outputArea.innerHTML = ''; // Clear previous output
                feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
                let success = false;
                let feedbackKey = 'feedback_modify_unknown_command';
                let errorOccurred = false;
                let outputValue = null; // For pop()

                if (command === '') {
                     showFeedback('modify-sim-feedback', 'feedback_modify_empty', 'info');
                     outputArea.innerHTML = `<span class="placeholder">${getTranslation('modify_output_placeholder', currentLang)}</span>`; // Show placeholder if empty
                     return;
                 }

                // Basic parsing - Improve regex for robustness if needed
                const assignmentRegex = /^(\w+)\s*\[\s*(-?\d+)\s*\]\s*=\s*(.*)$/; // Capture value
                const appendRegex = /^(\w+)\.append\(\s*(.*)\s*\)$/; // Capture value
                const insertRegex = /^(\w+)\.insert\(\s*(-?\d+)\s*,\s*(.*)\s*\)$/; // Capture index and value
                const popIndexRegex = /^(\w+)\.pop\(\s*(-?\d+)\s*\)$/; // Capture index
                const popRegex = /^(\w+)\.pop\(\s*\)$/; // No index
                const removeRegex = /^(\w+)\.remove\(\s*(.*)\s*\)$/; // Capture value

                let match;

                try {
                    if ((match = command.match(assignmentRegex))) {
                        const listName = match[1];
                        const index = parseInt(match[2], 10);
                        let value = match[3].trim();

                        if (listName !== 'items') throw new Error('list_mismatch');
                        if (index < -simModifyListContent.length || index >= simModifyListContent.length) throw new Error('index_error');

                        // Attempt to parse value - simple check for quotes
                        if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
                            value = value.slice(1, -1); // Remove quotes for storage
                        } else {
                             // Try to parse as number, otherwise treat as potential syntax error (missing quotes)
                            const numValue = parseFloat(value);
                            if (!isNaN(numValue) && value === numValue.toString()) {
                                value = numValue; // Store as number
                            } else {
                                throw new Error('syntax_assign'); // Likely missing quotes
                            }
                        }

                        const actualIndex = index < 0 ? simModifyListContent.length + index : index;
                        if (actualIndex < 0 || actualIndex >= simModifyListContent.length) throw new Error('index_error'); // Re-check after negative conversion
                        simModifyListContent[actualIndex] = value;
                        success = true;

                    } else if ((match = command.match(appendRegex))) {
                        const listName = match[1];
                        let value = match[2].trim();
                        if (listName !== 'items') throw new Error('list_mismatch');

                         if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
                            value = value.slice(1, -1);
                        } else {
                            const numValue = parseFloat(value);
                             if (!isNaN(numValue) && value === numValue.toString()) { value = numValue; }
                             else { throw new Error('syntax_append'); }
                         }
                        simModifyListContent.push(value);
                        success = true;

                    } else if ((match = command.match(insertRegex))) {
                        const listName = match[1];
                        const index = parseInt(match[2], 10);
                        let value = match[3].trim();

                        if (listName !== 'items') throw new Error('list_mismatch');
                        // Insert allows index up to length
                        if (index < -simModifyListContent.length || index > simModifyListContent.length) throw new Error('index_error');

                         if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
                            value = value.slice(1, -1);
                        } else {
                             const numValue = parseFloat(value);
                             if (!isNaN(numValue) && value === numValue.toString()) { value = numValue; }
                             else { throw new Error('syntax_insert'); }
                         }
                        // Python's insert behavior: index > length appends, index < -length inserts at 0
                        const actualIndex = index < 0 ? Math.max(0, simModifyListContent.length + index) : Math.min(simModifyListContent.length, index);
                        simModifyListContent.splice(actualIndex, 0, value);
                        success = true;

                    } else if ((match = command.match(popIndexRegex))) {
                        const listName = match[1];
                        const index = parseInt(match[2], 10);
                        if (listName !== 'items') throw new Error('list_mismatch');
                        if (simModifyListContent.length === 0) throw new Error('index_error'); // Pop from empty
                        if (index < -simModifyListContent.length || index >= simModifyListContent.length) throw new Error('index_error');

                        const actualIndex = index < 0 ? simModifyListContent.length + index : index;
                         if (actualIndex < 0 || actualIndex >= simModifyListContent.length) throw new Error('index_error'); // Re-check after negative conversion

                        outputValue = simModifyListContent.splice(actualIndex, 1)[0];
                        success = true;

                    } else if ((match = command.match(popRegex))) {
                        const listName = match[1];
                        if (listName !== 'items') throw new Error('list_mismatch');
                         if (simModifyListContent.length === 0) throw new Error('index_error'); // Pop from empty

                        outputValue = simModifyListContent.pop();
                        success = true;

                    } else if ((match = command.match(removeRegex))) {
                        const listName = match[1];
                        let value = match[2].trim();
                        if (listName !== 'items') throw new Error('list_mismatch');

                        if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
                           value = value.slice(1, -1);
                       } else {
                           const numValue = parseFloat(value);
                           if (!isNaN(numValue) && value === numValue.toString()) { value = numValue; }
                           else { throw new Error('syntax_remove'); }
                       }

                        const indexToRemove = simModifyListContent.indexOf(value);
                        if (indexToRemove === -1) throw new Error('value_error'); // Value not found

                        simModifyListContent.splice(indexToRemove, 1);
                        success = true;
                    } else {
                         // Default: Unknown command
                        errorOccurred = true; // Keep error flag
                    }

                } catch (error) {
                    errorOccurred = true;
                    switch (error.message) {
                        case 'list_mismatch': feedbackKey = 'feedback_modify_list_mismatch'; break;
                        case 'index_error': feedbackKey = 'feedback_modify_index_error'; break;
                        case 'value_error': feedbackKey = 'feedback_modify_value_error'; break;
                        case 'syntax_assign': feedbackKey = 'feedback_modify_syntax_assign'; break;
                        case 'syntax_append': feedbackKey = 'feedback_modify_syntax_append'; break;
                        case 'syntax_insert': feedbackKey = 'feedback_modify_syntax_insert'; break;
                        case 'syntax_pop': feedbackKey = 'feedback_modify_syntax_pop'; break;
                        case 'syntax_remove': feedbackKey = 'feedback_modify_syntax_remove'; break;
                        default: feedbackKey = 'feedback_modify_unknown_command'; console.error("Sim error:", error);
                    }
                }

                // Display results
                const formattedList = JSON.stringify(simModifyListContent)
                                        .replace(/,/g, ', ') // Add space after comma
                                        .replace(/"([^"]*)"/g, '<code class="code-string">"$1"</code>') // Style strings
                                        .replace(/(\b\d+\.?\d*\b)/g, '<code class="code-number">$1</code>'); // Style numbers

                if (success) {
                    feedbackKey = 'feedback_modify_success';
                    showFeedback('modify-sim-feedback', feedbackKey, 'correct');
                    // Display updated list
                    outputArea.innerHTML = `<span class="output-line">> ${formattedList}</span>`;
                    if(outputValue !== null) { // If pop returned a value, show it
                        const poppedValStr = typeof outputValue === 'string' ? `<code class="code-string">"${outputValue}"</code>` : `<code class="code-number">${outputValue}</code>`;
                         outputArea.innerHTML += `<span class="output-line" style="color: var(--info-color); font-style: italic;">  (Popped: ${poppedValStr})</span>`;
                    }
                } else {
                    showFeedback('modify-sim-feedback', feedbackKey, 'incorrect');
                    // Show list state *before* the failed command, or initial if first command failed
                    outputArea.innerHTML = `<span class="error-line">> Error! Current list: ${formattedList}</span>`;
                }
            });
        }

        // --- Activity 2 (Advanced): List Slicing Explorer ---
        const listSlicingExplorer = document.getElementById('list-slicing-explorer');
        const sliceElements = ["A", "B", "C", "D", "E", "F"]; // Base list

        function setupListSlicingExplorer() {
            if (!listSlicingExplorer) return;
            const startInput = document.getElementById('slice-start');
            const endInput = document.getElementById('slice-end');
            const stepInput = document.getElementById('slice-step');
            const outputArea = document.getElementById('slice-output');
            const feedbackDiv = document.getElementById('slice-feedback');
            const contextDiv = document.getElementById('slice-context-display');
            const currentLang = getStoredLanguage();

            startInput.value = '';
            endInput.value = '';
            stepInput.value = '';
            outputArea.innerHTML = `<span class="placeholder">${getTranslation('slice_output_placeholder', currentLang)}</span>`;
            feedbackDiv.classList.remove('visible');
            contextDiv.innerHTML = getTranslation('slice_context', currentLang); // Ensure context text is updated
        }

        if (listSlicingExplorer) {
            const startInput = document.getElementById('slice-start');
            const endInput = document.getElementById('slice-end');
            const stepInput = document.getElementById('slice-step');
            const runBtn = document.getElementById('run-slice-btn');
            const outputArea = document.getElementById('slice-output');
            const feedbackDiv = document.getElementById('slice-feedback');

            runBtn.addEventListener('click', () => {
                const startStr = startInput.value.trim();
                const endStr = endInput.value.trim();
                const stepStr = stepInput.value.trim();
                outputArea.innerHTML = ''; // Clear previous
                feedbackDiv.classList.remove('visible');

                let start = null, end = null, step = null;
                let error = false;

                try {
                    if (startStr !== '') {
                        start = parseInt(startStr);
                        if (isNaN(start)) throw new Error();
                    }
                    if (endStr !== '') {
                        end = parseInt(endStr);
                        if (isNaN(end)) throw new Error();
                    }
                    if (stepStr !== '') {
                        step = parseInt(stepStr);
                        if (isNaN(step) || step === 0) throw new Error(); // Step cannot be 0
                    }

                    // --- Pythonic Slice Simulation ---
                    // Create a copy to avoid modifying original
                    let result = [];
                    const len = sliceElements.length;

                    // Determine effective start, end, step based on Python rules
                    let effStep = (step === null) ? 1 : step;
                    let effStart, effEnd;

                    if (effStep > 0) {
                        effStart = (start === null) ? 0 : start;
                        effEnd = (end === null) ? len : end;
                        if (effStart < 0) effStart += len;
                        if (effEnd < 0) effEnd += len;
                        // Clamp to valid range ends
                        effStart = Math.max(0, Math.min(len, effStart));
                        effEnd = Math.max(0, Math.min(len, effEnd));
                    } else { // Negative step
                        effStart = (start === null) ? len - 1 : start;
                        effEnd = (end === null) ? -1 : end; // End boundary adjusted for negative step
                         if (effStart < 0) effStart += len;
                         if (effEnd < 0 && end !== null) effEnd += len; // Only adjust if end was specified
                        // Clamp to valid range ends (note reversed logic)
                        effStart = Math.max(-1, Math.min(len - 1, effStart));
                        effEnd = Math.max(-1, Math.min(len - 1, effEnd));
                    }


                    // Iterate based on step direction
                    if (effStep > 0) {
                        for (let i = effStart; i < effEnd; i += effStep) {
                            if (i >= 0 && i < len) { // Double check index validity during loop
                                result.push(sliceElements[i]);
                            }
                        }
                    } else { // Negative step
                        for (let i = effStart; i > effEnd; i += effStep) {
                             if (i >= 0 && i < len) { // Double check index validity
                                result.push(sliceElements[i]);
                            }
                        }
                    }
                    // --- End Simulation ---

                    const formattedResult = JSON.stringify(result)
                        .replace(/,/g, ', ')
                        .replace(/"([^"]*)"/g, '<code class="code-string">"$1"</code>')
                         .replace(/(\b\d+\.?\d*\b)/g, '<code class="code-number">$1</code>'); // Style result
                    outputArea.innerHTML = `<span class="output-line">${formattedResult || '[]'}</span>`; // Show empty list if result is empty
                    showFeedback('slice-feedback', 'feedback_slice_success', 'correct');

                } catch (e) {
                     outputArea.innerHTML = `<span class="placeholder">${getTranslation('slice_output_placeholder', getStoredLanguage())}</span>`;
                     showFeedback('slice-feedback', 'feedback_slice_invalid_input', 'incorrect');
                }
            });
        }


        // --- Activity 3 (Advanced): Method Match-Up ---
        const methodMatchup = document.getElementById('method-matchup');
        let draggedMethodElement = null; let originalMethodPiece = null; let touchDragMethodElement = null;
        let startMX, startMY, offsetMX, offsetMY; // Touch coords for methods

        const methodsData = [
            { key: 'method_piece_append', id: 'append', desc_key: 'method_desc_append' },
            { key: 'method_piece_insert', id: 'insert', desc_key: 'method_desc_insert' },
            { key: 'method_piece_pop', id: 'pop', desc_key: 'method_desc_pop' },
            { key: 'method_piece_remove', id: 'remove', desc_key: 'method_desc_remove' }
        ];

        function createMethodPiece(methodData, lang) {
            const piece = document.createElement('span');
            piece.classList.add('method-piece', 'code-font');
            piece.draggable = true;
            piece.textContent = getTranslation(methodData.key, lang);
            piece.dataset.methodId = methodData.id;
            piece.dataset.transKey = methodData.key;
            addMethodDragListeners(piece);
            addMethodTouchListeners(piece);
            return piece;
        }

        function createDescriptionTarget(methodData, lang) {
            const target = document.createElement('div');
            target.classList.add('desc-target');
            target.dataset.targetId = methodData.id; // Target should match method ID
            const descText = document.createElement('span');
            descText.classList.add('desc-text');
            descText.textContent = getTranslation(methodData.desc_key, lang);
            descText.dataset.transKey = methodData.desc_key;
            target.appendChild(descText);
            addDropTargetListeners(target);
            return target;
        }

        function setupMethodMatchup() {
            if (!methodMatchup) return;
            const methodsContainer = document.getElementById('draggable-methods');
            const targetsContainer = document.getElementById('description-targets');
            const feedbackDiv = document.getElementById('match-feedback');
            const checkBtn = document.getElementById('check-match-btn');
            const resetBtn = document.getElementById('reset-match-btn');
            const currentLang = getStoredLanguage();

            methodsContainer.innerHTML = '';
            targetsContainer.innerHTML = '';
            feedbackDiv.classList.remove('visible');
            checkBtn.disabled = false;
            checkBtn.classList.remove('success');

            const shuffledMethods = [...methodsData].sort(() => Math.random() - 0.5);
            const shuffledTargets = [...methodsData].sort(() => Math.random() - 0.5); // Shuffle targets independently

            shuffledMethods.forEach(m => methodsContainer.appendChild(createMethodPiece(m, currentLang)));
            shuffledTargets.forEach(t => targetsContainer.appendChild(createDescriptionTarget(t, currentLang))); // Use t for target creation loop

            // Update placeholders if they exist
             const dragPlaceholder = methodsContainer.querySelector('.placeholder');
             const dropPlaceholder = targetsContainer.querySelector('.placeholder');
             if (dragPlaceholder) dragPlaceholder.textContent = getTranslation('match_drag_placeholder', currentLang);
             if (dropPlaceholder) dropPlaceholder.textContent = getTranslation('match_drop_placeholder', currentLang);
        }


        // Drag/Drop/Touch Listeners specifically for Method Matchup
        function addMethodDragListeners(element) {
            element.addEventListener('dragstart', (e) => {
                draggedMethodElement = element;
                element.classList.add('ghosting');
                e.dataTransfer.effectAllowed = 'move';
                try { e.dataTransfer.setData('text/plain', element.dataset.methodId); } catch (err) {}
            });
            element.addEventListener('dragend', () => {
                if (draggedMethodElement) draggedMethodElement.classList.remove('ghosting');
                document.querySelectorAll('.desc-target.over').forEach(t => t.classList.remove('over'));
                draggedMethodElement = null;
            });
        }
        function addDropTargetListeners(target) {
            target.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (!target.querySelector('.method-piece')) { // Only allow drop if empty
                     target.classList.add('over');
                }
                 e.dataTransfer.dropEffect = target.querySelector('.method-piece') ? 'none' : 'move';
            });
            target.addEventListener('dragleave', () => target.classList.remove('over'));
            target.addEventListener('drop', (e) => {
                e.preventDefault();
                target.classList.remove('over');
                if (draggedMethodElement && !target.querySelector('.method-piece')) {
                     // Return any existing piece in the source container if replacing
                    const sourceContainer = document.getElementById('draggable-methods');
                    const existingPieceInTarget = target.querySelector('.method-piece'); // Should be null based on dragover check, but safety first
                    if(existingPieceInTarget) sourceContainer.appendChild(existingPieceInTarget);

                    // Move dragged piece
                    target.appendChild(draggedMethodElement);
                    draggedMethodElement.classList.remove('ghosting');
                    draggedMethodElement.style.cursor = 'default'; // Make it look placed
                    draggedMethodElement = null;
                }
            });
            // Click listener to return piece to source
             target.addEventListener('click', (e) => {
                const pieceInside = target.querySelector('.method-piece');
                 if (pieceInside && e.target === pieceInside) { // Only if clicking the piece itself
                    const sourceContainer = document.getElementById('draggable-methods');
                    sourceContainer.appendChild(pieceInside);
                     pieceInside.style.cursor = 'grab'; // Make draggable again
                     target.classList.remove('filled', 'correct-match', 'incorrect-match');
                 }
             });
        }
        function handleMethodTouchStart(e) { /* Adapt touch logic for methods */
            if (touchDragMethodElement) return;
            originalMethodPiece = e.target.closest('.method-piece');
            if (!originalMethodPiece) return;

            // Prevent dragging from target back to source container for now (simplifies)
            if (originalMethodPiece.closest('.desc-target')) return;

            const touch = e.targetTouches[0]; startMX = touch.clientX; startMY = touch.clientY;
            const rect = originalMethodPiece.getBoundingClientRect(); offsetMX = startMX - rect.left; offsetMY = startMY - rect.top;

            touchDragMethodElement = originalMethodPiece.cloneNode(true);
            touchDragMethodElement.classList.add('dragging');
            touchDragMethodElement.style.position = 'fixed';
            touchDragMethodElement.style.left = `${startMX - offsetMX}px`;
            touchDragMethodElement.style.top = `${startMY - offsetMY}px`;
            touchDragMethodElement.style.width = `${rect.width}px`;
            touchDragMethodElement.style.height = `${rect.height}px`;
            document.body.appendChild(touchDragMethodElement);
            originalMethodPiece.classList.add('ghosting');
            e.preventDefault(); // Prevent scrolling
        }
        function handleMethodTouchMove(e) { /* Adapt touch logic for methods */
             if (!touchDragMethodElement) return;
             e.preventDefault();
             const touch = e.targetTouches[0];
             const currentX = touch.clientX;
             const currentY = touch.clientY;
             touchDragMethodElement.style.left = `${currentX - offsetMX}px`;
             touchDragMethodElement.style.top = `${currentY - offsetMY}px`;

             // Check for drop zone overlap
             touchDragMethodElement.style.display = 'none'; // Hide ghost to check element below
             const elemBelow = document.elementFromPoint(currentX, currentY);
             touchDragMethodElement.style.display = ''; // Show ghost again

            document.querySelectorAll('.desc-target').forEach(target => {
                const isOverTarget = (elemBelow === target || target.contains(elemBelow)) && !target.querySelector('.method-piece');
                target.classList.toggle('over', isOverTarget);
            });
        }
        function handleMethodTouchEnd(e) { /* Adapt touch logic for methods */
            if (!touchDragMethodElement || !originalMethodPiece) return;

            const touch = e.changedTouches[0];
            const finalX = touch.clientX;
            const finalY = touch.clientY;

            touchDragMethodElement.style.display = 'none';
            const elemBelow = document.elementFromPoint(finalX, finalY);
            touchDragMethodElement.style.display = '';

            let droppedInTarget = null;
            document.querySelectorAll('.desc-target').forEach(target => {
                target.classList.remove('over'); // Clean up highlight
                if ((elemBelow === target || target.contains(elemBelow)) && !target.querySelector('.method-piece')) {
                    droppedInTarget = target;
                }
            });

            if (droppedInTarget) {
                droppedInTarget.appendChild(originalMethodPiece);
                originalMethodPiece.classList.remove('ghosting');
                originalMethodPiece.style.cursor = 'default';
            } else {
                // Return to source container if not dropped correctly
                const sourceContainer = document.getElementById('draggable-methods');
                sourceContainer.appendChild(originalMethodPiece);
                originalMethodPiece.classList.remove('ghosting');
                originalMethodPiece.style.cursor = 'grab';
            }

            if (touchDragMethodElement.parentNode === document.body) {
               document.body.removeChild(touchDragMethodElement);
            }
            touchDragMethodElement = null;
            originalMethodPiece = null;
        }
        function addMethodTouchListeners(element) { /* Adapt touch logic for methods */
            element.addEventListener('touchstart', handleMethodTouchStart, { passive: false });
            element.addEventListener('touchmove', handleMethodTouchMove, { passive: false });
            element.addEventListener('touchend', handleMethodTouchEnd);
        }

        if (methodMatchup) {
            const checkBtn = document.getElementById('check-match-btn');
            const resetBtn = document.getElementById('reset-match-btn');
            const targetsContainer = document.getElementById('description-targets');
            const methodsContainer = document.getElementById('draggable-methods');


            checkBtn.addEventListener('click', () => {
                const targets = targetsContainer.querySelectorAll('.desc-target');
                let correctCount = 0;
                let incorrectCount = 0;
                let filledCount = 0;

                targets.forEach(target => {
                    const piece = target.querySelector('.method-piece');
                    target.classList.remove('correct-match', 'incorrect-match'); // Reset visual feedback
                     if (piece) {
                        filledCount++;
                        const pieceId = piece.dataset.methodId;
                        const targetId = target.dataset.targetId;
                        if (pieceId === targetId) {
                            target.classList.add('correct-match');
                            correctCount++;
                        } else {
                            target.classList.add('incorrect-match');
                            incorrectCount++;
                        }
                    }
                });

                if (filledCount < methodsData.length) {
                     showFeedback('match-feedback', 'feedback_match_incomplete', 'info');
                } else if (incorrectCount === 0) {
                     showFeedback('match-feedback', 'feedback_match_correct', 'correct');
                     checkBtn.disabled = true;
                     checkBtn.classList.add('success');
                 } else {
                    showFeedback('match-feedback', 'feedback_match_incorrect', 'incorrect', { count: incorrectCount });
                 }
            });
            resetBtn.addEventListener('click', setupMethodMatchup);
        }


        // --- Activity 4 (Advanced): Mini Missions ---
        const advMissionsSection = document.getElementById('adv-mini-missions');
        let updateAdvMissionSummary; // Hoist function definition access

        if (advMissionsSection) {
            const missionRunButtons = advMissionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('adv-missions-summary-feedback');
            const totalMissions = advMissionsSection.querySelectorAll('.mission').length;
            let completedMissionsCount = 0;

            updateAdvMissionSummary = function() { // Define function
                 completedMissionsCount = advMissionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_adv_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('adv-missions-summary-feedback', 'feedback_adv_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible', 'correct', 'incorrect', 'info');
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`adv-mission-${missionId}`);
                    if (!missionDiv) { console.error(`Adv Mission div adv-mission-${missionId} not found`); return; }

                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `adv-mission-feedback-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                     if (!feedbackDiv) { console.error(`Feedback div ${feedbackDivId} not found`); return; }
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();

                    outputArea.innerHTML = ''; // Clear previous output
                    feedbackDiv.classList.remove('visible'); // Hide previous feedback first
                    statusIcon.className = 'fas fa-question-circle'; // Reset icon
                    missionDiv.dataset.completed = 'false';

                    let success = false;
                    let feedbackMessageKey = 'feedback_adv_mission_generic_error'; // Default error
                    let feedbackType = 'incorrect';
                    let specificHintKey = '';
                    let simulatedOutput = ''; // Store expected output for display/check
                    let consoleOutput = []; // Capture print statements

                    /* Validation Logic for Advanced Module 10 Missions */
                    // Basic simulation - does not handle complex logic or errors perfectly
                    try {
                        // Create a simple sandbox using an object as local scope
                        let scope = {};
                        let originalConsoleLog = console.log; // Backup original console.log
                        consoleOutput = []; // Reset captured output
                        console.log = (...args) => { // Capture print calls
                            consoleOutput.push(args.map(arg => {
                                // Basic formatting similar to Python's print
                                if (typeof arg === 'string') return arg;
                                if (Array.isArray(arg)) return `[${arg.map(item => typeof item === 'string' ? `'${item}'` : item).join(', ')}]`;
                                return String(arg);
                            }).join(' '));
                        };

                        // "Execute" the code line by line (very simplified eval)
                         const lines = code.split('\n');
                         lines.forEach(line => {
                             line = line.trim();
                             if (!line || line.startsWith('#')) return;

                             // Super basic simulation of assignments and method calls
                             // WARNING: This is NOT a safe or complete Python interpreter!
                             // It only handles the exact patterns needed for these missions.
                             let match;
                             if ((match = line.match(/^(\w+)\s*=\s*(\[.*\])$/))) { // List assignment
                                 try { scope[match[1]] = JSON.parse(match[2].replace(/'/g, '"')); } // Simple parse
                                 catch (e) { throw new Error("List creation syntax error"); }
                             } else if ((match = line.match(/^(\w+)\.append\((.*)\)$/))) { // Append
                                 let list = scope[match[1]]; let valStr = match[2].trim();
                                 if (!Array.isArray(list)) throw new Error(`Variable '${match[1]}' is not a list`);
                                 try { list.push(JSON.parse(valStr.replace(/'/g,'"'))); } // Parse value
                                 catch(e) { throw new Error("Append value error or syntax"); }
                             } else if ((match = line.match(/^(\w+)\.pop\(\s*(-?\d*)\s*\)$/))) { // Pop
                                let list = scope[match[1]]; let indexStr = match[2];
                                if (!Array.isArray(list)) throw new Error(`Variable '${match[1]}' is not a list`);
                                if (list.length === 0) throw new Error("Pop from empty list");
                                let poppedVal;
                                if(indexStr === '') { poppedVal = list.pop(); }
                                else { let idx = parseInt(indexStr); if(isNaN(idx)) throw new Error("Invalid pop index"); poppedVal = list.splice(idx, 1)[0]; }
                                // Check if pop result is assigned (crude check)
                                if(line.includes('=')) {
                                    let assignVar = line.substring(0, line.indexOf('=')).trim();
                                    scope[assignVar] = poppedVal;
                                } else {
                                    // Pop was called but result not assigned (allowed, but print check is key)
                                }
                             } else if ((match = line.match(/^(\w+)\.insert\((.*)\)$/))) { // Insert
                                let list = scope[match[1]]; let args = match[2].split(',');
                                if (!Array.isArray(list)) throw new Error(`Variable '${match[1]}' is not a list`);
                                if(args.length !== 2) throw new Error("Insert needs index and value");
                                let idx = parseInt(args[0].trim()); let valStr = args[1].trim();
                                if(isNaN(idx)) throw new Error("Invalid insert index");
                                try { list.splice(idx, 0, JSON.parse(valStr.replace(/'/g,'"'))); }
                                catch(e) { throw new Error("Insert value error or syntax"); }
                             } else if ((match = line.match(/^print\((.*)\)$/))) { // Print
                                 let argStr = match[1].trim();
                                 // Super simple eval for print: variable, len(variable), or variable.pop() result
                                 if(scope.hasOwnProperty(argStr)) { console.log(scope[argStr]); }
                                 else if ((match = argStr.match(/^len\((\w+)\)$/)) && scope.hasOwnProperty(match[1])) { console.log(scope[match[1]].length); }
                                 else { console.log("?"); /* Placeholder if print arg is complex */ } // Cannot simulate complex prints easily
                             } else {
                                 // Ignore other lines for this basic simulation
                             }
                         });

                        console.log = originalConsoleLog; // Restore console.log

                        // --- Now check results against mission goals ---
                        if (missionId === '1') {
                            const expectedList = ["Phone", "Watch", "Tablet"];
                            const finalOutput = consoleOutput.join('\n');
                            const expectedOutput = `['Phone', 'Watch', 'Tablet']`; // Python format
                            if (JSON.stringify(scope.gadgets) === JSON.stringify(expectedList) && finalOutput === expectedOutput) {
                                success = true; simulatedOutput = `> ${expectedOutput}`;
                            } else {
                                if (JSON.stringify(scope.gadgets) !== JSON.stringify(expectedList)) specificHintKey = 'feedback_adv_mission1_hint_append';
                                else specificHintKey = 'feedback_adv_mission1_hint_print';
                             }
                        } else if (missionId === '2') {
                            const expectedOutput = '99';
                             const finalOutput = consoleOutput.join('\n');
                            // Check if the *last* print output was 99
                            if (consoleOutput.length > 0 && consoleOutput[consoleOutput.length - 1] === expectedOutput) {
                                success = true; simulatedOutput = `> ${expectedOutput}`;
                            } else {
                                if(!scope.scores) specificHintKey = 'feedback_adv_mission2_hint_list'; // Crude check
                                else specificHintKey = 'feedback_adv_mission2_hint_print'; // Assume pop/print issue
                            }
                        } else if (missionId === '3') {
                             const expectedList = ["Alice", "Bob", "Charlie"];
                             const expectedOutput = '3';
                             const finalOutput = consoleOutput.join('\n');
                             if (JSON.stringify(scope.queue) === JSON.stringify(expectedList) && finalOutput === expectedOutput) {
                                success = true; simulatedOutput = `> ${expectedOutput}`;
                             } else {
                                 if(JSON.stringify(scope.queue) !== JSON.stringify(expectedList)) specificHintKey = 'feedback_adv_mission3_hint_insert';
                                 else specificHintKey = 'feedback_adv_mission3_hint_len';
                             }
                        }

                    } catch (error) {
                         console.log = originalConsoleLog; // Restore console.log on error too
                         console.error("Adv Mission validation error:", error);
                         feedbackMessageKey = 'feedback_adv_mission_syntax_error'; // Use a generic syntax error message
                         simulatedOutput = `> Error: ${error.message}`;
                         outputArea.classList.add('error-line');
                    }
                    /* End Validation */

                    // Display results
                    outputArea.innerHTML = ''; // Clear first
                    if (simulatedOutput) {
                        const outputLine = document.createElement('span');
                        outputLine.classList.add('output-line');
                        // Basic styling for simulated output
                        if (simulatedOutput.startsWith('> Error:')) {
                             outputLine.classList.add('error-line');
                             outputLine.textContent = simulatedOutput;
                        } else {
                            // Attempt to format like Python output
                            outputLine.innerHTML = simulatedOutput.replace(/'([^']*)'/g, '<code class="code-string">"$1"</code>')
                                                        .replace(/(\b\d+\.?\d*\b)/g, '<code class="code-number">$1</code>');
                        }

                        outputArea.appendChild(outputLine);
                    } else if (!success && !simulatedOutput.includes("Error")) {
                         // If failed but no specific output, show generic failure message
                         const errorLine = document.createElement('span');
                         errorLine.classList.add('error-line');
                         errorLine.textContent = '> (Incorrect execution or output)';
                         outputArea.appendChild(errorLine);
                    }


                    if (success) {
                        feedbackMessageKey = 'feedback_adv_mission_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey; // Use specific hint if available
                        feedbackType = 'incorrect';
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                    }
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    updateAdvMissionSummary(); // Update overall progress
                });
            });
             updateAdvMissionSummary(); // Initial call
        }


        // --- Fade-in animations on scroll (Same as Practice 10) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => { /* ... Same code ... */
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return; // Already visible
                 const rect = el.getBoundingClientRect();
                 // Adjust trigger point slightly if needed
                 const triggerPoint = windowHeight * 0.85;
                 if (rect.top < triggerPoint && rect.bottom >= 50) {
                     // Directly apply style for simplicity, matching original behavior
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Setup Calls ---
        setLanguage(initialLang); // Apply language and trigger dependent setups
        animateOnScroll(); // Trigger initial animation check

    }); // End DOMContentLoaded
    </script>

</body>
</html>