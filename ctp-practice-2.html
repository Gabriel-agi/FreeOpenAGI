<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 2: Working with Numbers!</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables --- */
        :root {
            --primary-color: #007bff; /* Keeping consistent blue */
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --operator-color: #e83e8c; /* Pink for operators */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }

        /* --- Advanced Animations --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; } .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; } .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearInfo { 0% { transform: scale(0.8) translateY(5px); opacity: 0; } 100% { transform: scale(1) translateY(0px); opacity: 1; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Practice Header --- */
        .practice-header { background: linear-gradient(135deg, var(--primary-color), #0056b3); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* Calculator */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* Sort Numeric */

        /* --- Practice Section Styling --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; }
        .code-number { color: #b5cea8; }
        .code-operator { color: var(--operator-color); font-weight: bold; }

        /* --- Activity 1: Operator Spotlight --- */
        #operator-spotlight .code-expression { display: block; margin-bottom: 1rem; font-size: 1.1rem; text-align: center; }
        #operator-spotlight .code-op { cursor: pointer; border-bottom: 2px dashed var(--operator-color); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 4px; display: inline-block; color: var(--operator-color); font-weight: bold;}
        #operator-spotlight .code-op:hover { background-color: rgba(232, 62, 140, 0.15); border-bottom-color: var(--accent-color); }
        #operator-spotlight .code-op.identified { background-color: rgba(40, 167, 69, 0.2); border-bottom: 2px solid var(--success-color); cursor: default; }
        .op-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #operator-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 2: Calculation Simulator --- */
        #calc-simulator .sim-editor { width: 100%; min-height: 60px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #calc-simulator .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #calc-simulator .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #calc-simulator .sim-output-area .output-line { display: block; }
        #calc-simulator .sim-output-area .output-error { color: var(--error-color); font-weight: bold; }

        /* --- Activity 3: Precedence Check --- */
        #precedence-check .expression-display { font-size: 1.2rem; font-family: var(--code-font); margin-bottom: 1.5rem; text-align: center; background: var(--background-medium); padding: 1rem; border-radius: var(--border-radius); border: 1px solid #ccc;}
        #precedence-check .expression-display .op-choice { cursor: pointer; border-bottom: 3px solid transparent; transition: border-bottom-color var(--transition-speed), background-color var(--transition-speed); padding: 2px 5px; margin: 0 2px; border-radius: 3px;}
        #precedence-check .expression-display .op-choice:hover { background-color: var(--selection-highlight-bg); border-bottom-color: var(--selection-highlight-border); }
        #precedence-check .expression-display .op-choice.selected { background-color: rgba(0, 123, 255, 0.2); border-bottom-color: var(--primary-color); }
        #precedence-check .explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 1.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #precedence-check .explanation strong { color: var(--primary-color); }

        /* --- Activity 4: Predict the Output --- */
        #predict-output .code-to-predict { margin-bottom: 1.5rem; }
        #predict-output .prediction-input-area label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        #predict-output #prediction-input { width: 100%; max-width: 250px; padding: 0.6rem 1rem; border: 1px solid var(--secondary-color); border-radius: var(--border-radius); font-size: 1rem; text-align: center; font-family: var(--code-font); margin: 0 auto 1rem; display: block;}
        #predict-output .actual-result-display { margin-top: 1rem; font-weight: bold; }
        #predict-output .actual-result-display .label { color: var(--secondary-color); }
        #predict-output .actual-result-display .value { color: var(--primary-color); font-family: var(--code-font); font-size: 1.1em; }

        /* --- Activity 5: Numerical Mini Missions --- */
        #num-mini-missions .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #num-mini-missions .mission-editor { width: 100%; min-height: 80px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #num-mini-missions .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        #num-mini-missions .mission-output .output-error { color: var(--error-color); }

        /* --- Final Section --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            #calc-simulator .sim-editor, #calc-simulator .sim-output-area { font-size: 0.95rem; }
            #precedence-check .expression-display { font-size: 1.1rem; }
            #predict-output #prediction-input { max-width: 200px; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            .code-block, #num-mini-missions .mission-editor, #num-mini-missions .mission-output { font-size: 0.9rem; }
            #operator-spotlight .code-expression { font-size: 1rem; }
            #precedence-check .expression-display { font-size: 1rem; padding: 0.8rem; }
            #predict-output #prediction-input { max-width: 150px; font-size: 0.9rem; }
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- !!! UPDATE MODULE NUMBER HERE !!! -->
            <li><a href="ctp-theory-2.html"><i class="fas fa-book-open fa-fw"></i> <span data-translate="nav_theory">View Theory</span></a></li>
            <li><a href="ctp-advanced-2.html"><i class="fas fa-flask fa-fw"></i> <span data-translate="nav_advanced">Advanced Practice</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- Update anchors for Module 2 Activities -->
            <li><a href="#operator-spotlight"><i class="fas fa-search-plus fa-fw"></i> <span data-translate="nav_spotlight">Spotlight</span></a></li>
            <li><a href="#calc-simulator"><i class="fas fa-calculator fa-fw"></i> <span data-translate="nav_simulator">Simulator</span></a></li>
            <li><a href="#precedence-check"><i class="fas fa-sort-amount-down-alt fa-fw"></i> <span data-translate="nav_precedence">Precedence</span></a></li>
            <li><a href="#predict-output"><i class="fas fa-question-circle fa-fw"></i> <span data-translate="nav_predict">Predict</span></a></li>
            <li><a href="#num-mini-missions"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_missions">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- Updated icons -->
        <i class="fas fa-calculator header-icon icon1"></i>
        <i class="fas fa-sort-numeric-down header-icon icon2"></i>
        <div class="container">
            <!-- !!! UPDATE MODULE NUMBER HERE !!! -->
            <h1 data-translate="header_title">Module 2: Practice Zone</h1>
            <p data-translate="header_subtitle">Let's crunch some numbers and understand Python's arithmetic!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Operator Spotlight ========= -->
        <section id="operator-spotlight" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-search-plus"></i> <span data-translate="spotlight_title">Operator Spotlight</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="spotlight_desc">
                     Python uses symbols for math. Click on the <span class="code-operator">highlighted operator</span> in each expression below to learn its name.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div id="spotlight-expressions" class="code-font">
                        <!-- Expressions populated by JS -->
                     </div>
                     <div id="spotlight-explanations"></div>
                     <p id="operator-status" data-translate="spotlight_status_initial">Identify all operators!</p>
                     <div id="spotlight-feedback" class="feedback-message"></div>
                     <!-- Hidden elements for storing translated explanation parts -->
                     <div id="explanation-texts" style="display: none;">
                        <span data-key="+" data-translate="spotlight_exp_add">Addition `+`: Adds two numbers together (e.g., 5 + 3 = 8).</span>
                        <span data-key="-" data-translate="spotlight_exp_sub">Subtraction `-`: Subtracts the second number from the first (e.g., 10 - 4 = 6).</span>
                        <span data-key="*" data-translate="spotlight_exp_mul">Multiplication `*`: Multiplies two numbers (e.g., 7 * 3 = 21).</span>
                        <span data-key="/" data-translate="spotlight_exp_div">Division `/`: Divides the first number by the second, result is always a float (e.g., 10 / 4 = 2.5).</span>
                        <span data-key="//" data-translate="spotlight_exp_floor">Floor Division `//`: Divides and rounds down to the nearest whole number (integer) (e.g., 10 // 4 = 2).</span>
                        <span data-key="%" data-translate="spotlight_exp_mod">Modulo `%`: Gives the remainder of a division (e.g., 10 % 4 = 2).</span>
                        <span data-key="**" data-translate="spotlight_exp_pow">Exponentiation `**`: Raises the first number to the power of the second (e.g., 2 ** 3 = 8).</span>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Calculation Simulator ========= -->
        <section id="calc-simulator" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-calculator"></i> <span data-translate="simulator_title">Calculation Simulator</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="simulator_desc">
                     Use the `print()` function to perform simple calculations. Try things like `print(100 + 50)`, `print(25 * 4)`, or `print(30 / 5)`. Click "Run Simulation" to see the result.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="sim-editor-input" class="code-font" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="simulator_editor_label">Code Editor:</label>
                     <textarea id="sim-editor-input" class="sim-editor" rows="3" data-translate-placeholder="simulator_editor_placeholder" placeholder='e.g., print(15 - 7) or print(8 * 9)'></textarea>
                     <div class="text-center">
                          <button id="run-sim-btn" class="action-button" data-translate="button_run_sim">Run Simulation</button>
                     </div>
                     <label for="sim-output" class="code-font" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="simulator_output_label">Simulated Output:</label>
                     <div id="sim-output" class="sim-output-area">
                         <span class="placeholder" data-translate="simulator_output_placeholder">Result will appear here...</span>
                     </div>
                     <div id="sim-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Activity 3: Precedence Check ========= -->
        <section id="precedence-check" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-sort-amount-down-alt"></i> <span data-translate="precedence_title">Order of Operations</span></h2>
                <p class="section-description fade-in delay-1" data-translate="precedence_desc">
                    Python follows mathematical order of operations (like PEMDAS/BODMAS). In the expression below, click on the operator (`+` or `*`) that Python will calculate <strong data-translate="precedence_desc_strong">first</strong>. Then click "Check Answer".
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="precedence-expression" class="expression-display code-font">
                        <!-- Expression like 10 + 5 * 2 generated by JS -->
                    </div>
                     <div class="text-center">
                         <button id="check-precedence-btn" class="action-button" data-translate="button_check_precedence" disabled>Check Answer</button>
                     </div>
                     <div id="precedence-feedback" class="feedback-message"></div>
                     <div id="precedence-explanation" class="explanation hidden"></div>
                     <!-- Hidden text for explanation -->
                     <div id="precedence-explanation-text" style="display: none;">
                         <span data-translate="precedence_exp_correct">Correct! Python performs multiplication (`*`) and division (`/`, `//`, `%`) before addition (`+`) and subtraction (`-`).</span>
                         <span data-translate="precedence_exp_incorrect">Not quite. Remember the order: Parentheses first, then Exponents (`**`), then Multiplication/Division/Modulo (from left to right), and finally Addition/Subtraction (from left to right). In this case, multiplication (`*`) has higher precedence than addition (`+`).</span>
                         <span data-translate="precedence_rule_summary">Rule Reminder: <strong class="code-font">PEMDAS/BODMAS</strong> (Parentheses/Brackets, Exponents/Orders, Multiplication/Division, Addition/Subtraction). `*`, `/`, `//`, `%` have higher precedence than `+`, `-`.</span>
                     </div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 4: Predict the Output ========= -->
        <section id="predict-output" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-question-circle"></i> <span data-translate="predict_title">Predict the Output</span></h2>
                <p class="section-description fade-in delay-1" data-translate="predict_desc">
                    Calculate the result of the following Python code in your head or on paper, considering operator precedence. Type your predicted answer in the box and check it.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div class="code-block code-font code-to-predict">
                        <span class="code-function">print</span><span class="code-paren">(</span><span class="code-paren">(</span><span class="code-number">4</span> <span class="code-operator">+</span> <span class="code-number">6</span><span class="code-paren">)</span> <span class="code-operator">*</span> <span class="code-number">3</span> <span class="code-operator">-</span> <span class="code-number">8</span> <span class="code-operator">/</span> <span class="code-number">2</span><span class="code-paren">)</span>
                    </div>
                    <div class="prediction-input-area text-center">
                        <label for="prediction-input" data-translate="predict_input_label">Your Predicted Output:</label>
                        <input type="text" id="prediction-input" class="code-font" placeholder="e.g., 10.0 or 26">
                    </div>
                     <div class="text-center">
                         <button id="check-prediction-btn" class="action-button" data-translate="button_check_prediction">Check Prediction</button>
                     </div>
                     <div id="prediction-feedback" class="feedback-message"></div>
                     <div id="prediction-actual-result" class="actual-result-display text-center hidden">
                         <span class="label" data-translate="predict_actual_label">Actual Result: </span><span class="value"></span>
                     </div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 5: Numerical Mini Missions ========= -->
        <section id="num-mini-missions" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="missions_title">Numerical Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_desc">
                     Apply your knowledge! Complete these coding tasks involving arithmetic operators. Use the simulated output to check your results.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="mission-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission1_title">Mission 1: Rectangle Area</h4>
                         <p data-translate="mission1_desc">Write a Python command using `print()` to calculate the area of a rectangle with width `12` and height `5`. (Area = width * height).</p>
                         <textarea class="sim-editor mission-editor" rows="3" data-translate-placeholder="mission1_placeholder" placeholder='print(width * height)'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="mission-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission2_title">Mission 2: Average Score</h4>
                         <p data-translate="mission2_desc">Calculate the average of three test scores: `85`, `92`, and `78`. Use `print()` and remember parentheses might be needed for correct order!</p>
                         <textarea class="sim-editor mission-editor" rows="3" data-translate-placeholder="mission2_placeholder" placeholder='print((score1 + score2 + score3) / 3)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="mission-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission3_title">Mission 3: Division Details</h4>
                         <p data-translate="mission3_desc">Use two separate `print()` commands. The first should show the result of `17` floor divided by `5` (`//`). The second should show the remainder of `17` divided by `5` (`%`).</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="mission3_placeholder" placeholder='print(17 // 5)\nprint(17 % 5)'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="missions-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                    <i class="fas fa-star"></i> <i class="fas fa-calculator"></i> <i class="fas fa-star"></i>
                </div>
                 <!-- !!! UPDATE MODULE NUMBER HERE !!! -->
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 2 Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Great calculation skills! You've grasped Python's arithmetic operators and precedence. <br>
                    Ready for more complex challenges? Head to the <strong>Advanced Practice</strong> for Module 2!
                </p>
                <div class="button-group">
                     <!-- !!! UPDATE MODULE NUMBER HERE !!! -->
                    <a href="ctp-theory-2.html" class="action-button secondary fade-in delay-3"><i class="fas fa-book-open"></i> <span data-translate="button_view_theory">View Theory Again</span></a>
                    <a href="ctp-advanced-2.html" class="action-button success fade-in delay-3"><i class="fas fa-arrow-right"></i> <span data-translate="button_start_advanced">Start Advanced Practice</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 2: Working with Numbers!",
            "nav_theory": "View Theory", "nav_advanced": "Advanced Practice", "nav_menu": "Course Menu",
            "nav_spotlight": "Spotlight", "nav_simulator": "Simulator", "nav_precedence": "Precedence", "nav_predict": "Predict", "nav_missions": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 2: Practice Zone", "header_subtitle": "Let's crunch some numbers and understand Python's arithmetic!",
            // Activity 1: Spotlight
            "spotlight_title": "Operator Spotlight", "spotlight_desc": "Python uses symbols for math. Click on the highlighted operator in each expression below to learn its name.",
            "spotlight_status_initial": "Identify all operators!", "spotlight_status_progress": "Identified {count} of {total} operators.", "spotlight_status_done": "All operators identified!",
            "spotlight_exp_add": "Addition `+`: Adds two numbers together (e.g., 5 + 3 = 8).",
            "spotlight_exp_sub": "Subtraction `-`: Subtracts the second number from the first (e.g., 10 - 4 = 6).",
            "spotlight_exp_mul": "Multiplication `*`: Multiplies two numbers (e.g., 7 * 3 = 21).",
            "spotlight_exp_div": "Division `/`: Divides the first number by the second, result is always a float (e.g., 10 / 4 = 2.5).",
            "spotlight_exp_floor": "Floor Division `//`: Divides and rounds down to the nearest whole number (integer) (e.g., 10 // 4 = 2).",
            "spotlight_exp_mod": "Modulo `%`: Gives the remainder of a division (e.g., 10 % 4 = 2).",
            "spotlight_exp_pow": "Exponentiation `**`: Raises the first number to the power of the second (e.g., 2 ** 3 = 8).",
            "feedback_spotlight_correct": "Excellent! You've identified all the arithmetic operators!",
            "tooltip_click_identify_op": "Click to identify this operator",
            // Activity 2: Simulator
            "simulator_title": "Calculation Simulator", "simulator_desc": "Use the `print()` function to perform simple calculations. Try things like `print(100 + 50)`, `print(25 * 4)`, or `print(30 / 5)`. Click \"Run Simulation\" to see the result.",
            "simulator_editor_label": "Code Editor:", "simulator_editor_placeholder": "e.g., print(15 - 7) or print(8 * 9)",
            "button_run_sim": "Run Simulation", "simulator_output_label": "Simulated Output:", "simulator_output_placeholder": "Result will appear here...",
            "feedback_sim_success": "Calculation successful!", "feedback_sim_empty": "Editor is empty.", "feedback_sim_invalid_print": "Looks like a `print` statement, but check the calculation inside the parentheses `()`. Use numbers and operators like `+`, `-`, `*`, `/`, `//`, `%`, `**`.",
            "feedback_sim_syntax": "Invalid syntax. Use the format `print(number operator number)` e.g., `print(5 + 3)`.",
            "feedback_sim_div_zero": "Error: Cannot divide by zero!",
            // Activity 3: Precedence
            "precedence_title": "Order of Operations", "precedence_desc": "Python follows mathematical order of operations (like PEMDAS/BODMAS). In the expression below, click on the operator (`+` or `*`) that Python will calculate ",
            "precedence_desc_strong": "first", "button_check_precedence": "Check Answer",
            "feedback_precedence_select": "Please click on the operator you think runs first.",
            "feedback_precedence_correct": "Correct! Multiplication comes before addition.",
            "feedback_precedence_incorrect": "Not quite. Multiplication has higher precedence here.",
            "precedence_exp_correct": "Correct! Python performs multiplication (`*`) and division (`/`, `//`, `%`) before addition (`+`) and subtraction (`-`).",
            "precedence_exp_incorrect": "Not quite. Remember the order: Parentheses first, then Exponents (`**`), then Multiplication/Division/Modulo (from left to right), and finally Addition/Subtraction (from left to right). In this case, multiplication (`*`) has higher precedence than addition (`+`).",
            "precedence_rule_summary": "Rule Reminder: <strong class=\"code-font\">PEMDAS/BODMAS</strong> (Parentheses/Brackets, Exponents/Orders, Multiplication/Division, Addition/Subtraction). `*`, `/`, `//`, `%` have higher precedence than `+`, `-`.",
            // Activity 4: Predict
            "predict_title": "Predict the Output", "predict_desc": "Calculate the result of the following Python code in your head or on paper, considering operator precedence. Type your predicted answer in the box and check it.",
            "predict_input_label": "Your Predicted Output:", "button_check_prediction": "Check Prediction",
            "predict_actual_label": "Actual Result: ",
            "feedback_predict_correct": "Spot on! You correctly calculated the result.",
            "feedback_predict_incorrect": "Close, but not quite right. Check the order of operations.",
            "feedback_predict_empty": "Please enter your prediction in the box.",
            "feedback_predict_invalid": "Please enter a valid number as your prediction.",
            // Activity 5: Missions
            "missions_title": "Numerical Mini Missions!", "missions_desc": "Apply your knowledge! Complete these coding tasks involving arithmetic operators. Use the simulated output to check your results.",
            "mission1_title": "Mission 1: Rectangle Area", "mission1_desc": "Write a Python command using `print()` to calculate the area of a rectangle with width `12` and height `5`. (Area = width * height).", "mission1_placeholder": "print(width * height)", "button_test_mission_1": "Test Mission 1",
            "mission2_title": "Mission 2: Average Score", "mission2_desc": "Calculate the average of three test scores: `85`, `92`, and `78`. Use `print()` and remember parentheses might be needed for correct order!", "mission2_placeholder": "print((score1 + score2 + score3) / 3)", "button_test_mission_2": "Test Mission 2",
            "mission3_title": "Mission 3: Division Details", "mission3_desc": "Use two separate `print()` commands. The first should show the result of `17` floor divided by `5` (`//`). The second should show the remainder of `17` divided by `5` (`%`).", "mission3_placeholder": "print(17 // 5)\\nprint(17 % 5)", "button_test_mission_3": "Test Mission 3",
            "feedback_mission_success": "Mission Accomplished!", "feedback_mission_syntax_error": "Syntax Error. Check your `print()` statement and operators.",
            "feedback_mission_incorrect_output": "Code runs, but the output isn't the expected result. Check your calculation.",
            "feedback_mission1_hint": "Use `print(12 * 5)`.",
            "feedback_mission2_hint": "Use `print((85 + 92 + 78) / 3)`. Don't forget the parentheses!",
            "feedback_mission3_hint": "Need two lines: `print(17 // 5)` and `print(17 % 5)`.",
            "feedback_mission_runtime_error": "Runtime Error (e.g., division by zero).",
            "feedback_missions_summary_all_done": "All {totalMissions} missions complete! Great calculation work!", "feedback_missions_summary_progress": "Completed {completedCount} of {totalMissions} missions. Keep calculating!",
            // Completion
            "completion_title": "Module 2 Practice Complete!", "completion_desc": "Great calculation skills! You've grasped Python's arithmetic operators and precedence. <br> Ready for more complex challenges? Head to the <strong>Advanced Practice</strong> for Module 2!",
            "button_view_theory": "View Theory Again", "button_start_advanced": "Start Advanced Practice", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 2: Trabalhando com Números!",
            "nav_theory": "Ver Teoria", "nav_advanced": "Prática Avançada", "nav_menu": "Menu do Curso",
            "nav_spotlight": "Destaque", "nav_simulator": "Simulador", "nav_precedence": "Precedência", "nav_predict": "Prever", "nav_missions": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 2: Zona de Prática", "header_subtitle": "Vamos calcular alguns números e entender a aritmética do Python!",
            // Activity 1: Spotlight
            "spotlight_title": "Destaque do Operador", "spotlight_desc": "Python usa símbolos para matemática. Clique no operador destacado em cada expressão abaixo para aprender seu nome.",
            "spotlight_status_initial": "Identifique todos os operadores!", "spotlight_status_progress": "Identificados {count} de {total} operadores.", "spotlight_status_done": "Todos os operadores identificados!",
            "spotlight_exp_add": "Adição `+`: Soma dois números (ex: 5 + 3 = 8).",
            "spotlight_exp_sub": "Subtração `-`: Subtrai o segundo número do primeiro (ex: 10 - 4 = 6).",
            "spotlight_exp_mul": "Multiplicação `*`: Multiplica dois números (ex: 7 * 3 = 21).",
            "spotlight_exp_div": "Divisão `/`: Divide o primeiro número pelo segundo, resultado é sempre float (ex: 10 / 4 = 2.5).",
            "spotlight_exp_floor": "Divisão Inteira `//`: Divide e arredonda para baixo para o número inteiro mais próximo (ex: 10 // 4 = 2).",
            "spotlight_exp_mod": "Módulo `%`: Retorna o resto de uma divisão (ex: 10 % 4 = 2).",
            "spotlight_exp_pow": "Exponenciação `**`: Eleva o primeiro número à potência do segundo (ex: 2 ** 3 = 8).",
            "feedback_spotlight_correct": "Excelente! Você identificou todos os operadores aritméticos!",
            "tooltip_click_identify_op": "Clique para identificar este operador",
            // Activity 2: Simulator
            "simulator_title": "Simulador de Cálculos", "simulator_desc": "Use a função `print()` para realizar cálculos simples. Tente coisas como `print(100 + 50)`, `print(25 * 4)`, ou `print(30 / 5)`. Clique em \"Executar Simulação\" para ver o resultado.",
            "simulator_editor_label": "Editor de Código:", "simulator_editor_placeholder": "ex: print(15 - 7) ou print(8 * 9)",
            "button_run_sim": "Executar Simulação", "simulator_output_label": "Saída Simulada:", "simulator_output_placeholder": "O resultado aparecerá aqui...",
            "feedback_sim_success": "Cálculo bem-sucedido!", "feedback_sim_empty": "O editor está vazio.", "feedback_sim_invalid_print": "Parece uma declaração `print`, mas verifique o cálculo dentro dos parênteses `()`. Use números e operadores como `+`, `-`, `*`, `/`, `//`, `%`, `**`.",
            "feedback_sim_syntax": "Sintaxe inválida. Use o formato `print(numero operador numero)` ex: `print(5 + 3)`.",
            "feedback_sim_div_zero": "Erro: Impossível dividir por zero!",
            // Activity 3: Precedence
            "precedence_title": "Ordem das Operações", "precedence_desc": "Python segue a ordem matemática das operações (como PEMDAS/BODMAS). Na expressão abaixo, clique no operador (`+` ou `*`) que o Python calculará ",
            "precedence_desc_strong": "primeiro", "button_check_precedence": "Verificar Resposta",
            "feedback_precedence_select": "Por favor, clique no operador que você acha que executa primeiro.",
            "feedback_precedence_correct": "Correto! Multiplicação vem antes da adição.",
            "feedback_precedence_incorrect": "Não exatamente. Multiplicação tem maior precedência aqui.",
            "precedence_exp_correct": "Correto! Python realiza multiplicação (`*`) e divisão (`/`, `//`, `%`) antes da adição (`+`) e subtração (`-`).",
            "precedence_exp_incorrect": "Não exatamente. Lembre-se da ordem: Parênteses primeiro, depois Expoentes (`**`), depois Multiplicação/Divisão/Módulo (da esquerda para a direita), e finalmente Adição/Subtração (da esquerda para a direita). Neste caso, multiplicação (`*`) tem maior precedência que adição (`+`).",
            "precedence_rule_summary": "Lembrete da Regra: <strong class=\"code-font\">PEMDAS/BODMAS</strong> (Parênteses/Colchetes, Expoentes/Ordens, Multiplicação/Divisão, Adição/Subtração). `*`, `/`, `//`, `%` têm maior precedência que `+`, `-`.",
             // Activity 4: Predict
            "predict_title": "Preveja a Saída", "predict_desc": "Calcule o resultado do seguinte código Python de cabeça ou no papel, considerando a precedência dos operadores. Digite sua resposta prevista na caixa e verifique.",
            "predict_input_label": "Sua Saída Prevista:", "button_check_prediction": "Verificar Previsão",
            "predict_actual_label": "Resultado Real: ",
            "feedback_predict_correct": "Na mosca! Você calculou o resultado corretamente.",
            "feedback_predict_incorrect": "Perto, mas não exatamente certo. Verifique a ordem das operações.",
            "feedback_predict_empty": "Por favor, insira sua previsão na caixa.",
            "feedback_predict_invalid": "Por favor, insira um número válido como sua previsão.",
            // Activity 5: Missions
            "missions_title": "Mini Missões Numéricas!", "missions_desc": "Aplique seu conhecimento! Complete estas tarefas de codificação envolvendo operadores aritméticos. Use a saída simulada para verificar seus resultados.",
            "mission1_title": "Missão 1: Área do Retângulo", "mission1_desc": "Escreva um comando Python usando `print()` para calcular a área de um retângulo com largura `12` e altura `5`. (Área = largura * altura).", "mission1_placeholder": "print(largura * altura)", "button_test_mission_1": "Testar Missão 1",
            "mission2_title": "Missão 2: Média de Notas", "mission2_desc": "Calcule a média de três notas de teste: `85`, `92` e `78`. Use `print()` e lembre-se que parênteses podem ser necessários para a ordem correta!", "mission2_placeholder": "print((nota1 + nota2 + nota3) / 3)", "button_test_mission_2": "Testar Missão 2",
            "mission3_title": "Missão 3: Detalhes da Divisão", "mission3_desc": "Use dois comandos `print()` separados. O primeiro deve mostrar o resultado de `17` dividido por `5` com divisão inteira (`//`). O segundo deve mostrar o resto de `17` dividido por `5` (`%`).", "mission3_placeholder": "print(17 // 5)\\nprint(17 % 5)", "button_test_mission_3": "Testar Missão 3",
            "feedback_mission_success": "Missão Cumprida!", "feedback_mission_syntax_error": "Erro de Sintaxe. Verifique sua declaração `print()` e operadores.",
            "feedback_mission_incorrect_output": "Código executa, mas a saída não é o resultado esperado. Verifique seu cálculo.",
            "feedback_mission1_hint": "Use `print(12 * 5)`.",
            "feedback_mission2_hint": "Use `print((85 + 92 + 78) / 3)`. Não esqueça os parênteses!",
            "feedback_mission3_hint": "Precisa de duas linhas: `print(17 // 5)` e `print(17 % 5)`.",
            "feedback_mission_runtime_error": "Erro de Execução (ex: divisão por zero).",
            "feedback_missions_summary_all_done": "Todas as {totalMissions} missões completas! Ótimo trabalho de cálculo!", "feedback_missions_summary_progress": "Completou {completedCount} de {totalMissions} missões. Continue calculando!",
            // Completion
            "completion_title": "Prática do Módulo 2 Completa!", "completion_desc": "Ótimas habilidades de cálculo! Você compreendeu os operadores aritméticos e a precedência do Python. <br> Pronto para desafios mais complexos? Vá para a <strong>Prática Avançada</strong> do Módulo 2!",
            "button_view_theory": "Ver Teoria Novamente", "button_start_advanced": "Iniciar Prática Avançada", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 2：处理数字！",
            "nav_theory": "查看理论", "nav_advanced": "高级练习", "nav_menu": "课程菜单",
            "nav_spotlight": "聚焦", "nav_simulator": "模拟器", "nav_precedence": "优先级", "nav_predict": "预测", "nav_missions": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 2：练习区", "header_subtitle": "让我们处理一些数字，理解 Python 的算术运算！",
            // Activity 1: Spotlight
            "spotlight_title": "运算符聚焦", "spotlight_desc": "Python 使用符号进行数学运算。点击下面每个表达式中高亮的运算符来了解它的名称。",
            "spotlight_status_initial": "识别所有运算符！", "spotlight_status_progress": "已识别 {count} / {total} 个运算符。", "spotlight_status_done": "所有运算符已识别！",
            "spotlight_exp_add": "加法 `+`: 将两个数相加 (例如 5 + 3 = 8)。",
            "spotlight_exp_sub": "减法 `-`: 从第一个数中减去第二个数 (例如 10 - 4 = 6)。",
            "spotlight_exp_mul": "乘法 `*`: 将两个数相乘 (例如 7 * 3 = 21)。",
            "spotlight_exp_div": "除法 `/`: 将第一个数除以第二个数，结果始终是浮点数 (例如 10 / 4 = 2.5)。",
            "spotlight_exp_floor": "整除 `//`: 相除并向下取整到最接近的整数 (例如 10 // 4 = 2)。",
            "spotlight_exp_mod": "取模 `%`: 返回除法的余数 (例如 10 % 4 = 2)。",
            "spotlight_exp_pow": "幂运算 `**`: 计算第一个数的第二个数次方 (例如 2 ** 3 = 8)。",
            "feedback_spotlight_correct": "太棒了！你识别了所有的算术运算符！",
            "tooltip_click_identify_op": "点击识别此运算符",
            // Activity 2: Simulator
            "simulator_title": "计算模拟器", "simulator_desc": "使用 `print()` 函数执行简单的计算。尝试像 `print(100 + 50)`、`print(25 * 4)` 或 `print(30 / 5)` 这样的命令。点击“运行模拟”查看结果。",
            "simulator_editor_label": "代码编辑器：", "simulator_editor_placeholder": "例如：print(15 - 7) 或 print(8 * 9)",
            "button_run_sim": "运行模拟", "simulator_output_label": "模拟输出：", "simulator_output_placeholder": "结果将显示在此处...",
            "feedback_sim_success": "计算成功！", "feedback_sim_empty": "编辑器是空的。", "feedback_sim_invalid_print": "看起来像 `print` 语句，但请检查括号 `()` 内的计算。使用数字和运算符，如 `+`, `-`, `*`, `/`, `//`, `%`, `**`。",
            "feedback_sim_syntax": "语法无效。使用格式 `print(数字 运算符 数字)` 例如 `print(5 + 3)`。",
            "feedback_sim_div_zero": "错误：不能除以零！",
            // Activity 3: Precedence
            "precedence_title": "运算顺序", "precedence_desc": "Python 遵循数学运算顺序（如 PEMDAS/BODMAS）。在下面的表达式中，点击 Python 将",
            "precedence_desc_strong": "首先", "button_check_precedence": "检查答案",
            "precedence_desc_cont": "计算的运算符（`+` 或 `*`）。然后点击“检查答案”。",
            "feedback_precedence_select": "请点击您认为首先运行的运算符。",
            "feedback_precedence_correct": "正确！乘法优先于加法。",
            "feedback_precedence_incorrect": "不太对。乘法在这里具有更高的优先级。",
            "precedence_exp_correct": "正确！Python 先执行乘法 (`*`) 和除法 (`/`, `//`, `%`)，然后执行加法 (`+`) 和减法 (`-`)。",
            "precedence_exp_incorrect": "不太对。请记住顺序：先括号，然后幂 (`**`)，然后乘法/除法/取模（从左到右），最后加法/减法（从左到右）。在这种情况下，乘法 (`*`) 的优先级高于加法 (`+`)。",
            "precedence_rule_summary": "规则提醒：<strong class=\"code-font\">PEMDAS/BODMAS</strong>（括号/括号，指数/顺序，乘法/除法，加法/减法）。`*`、`/`、`//`、`%` 的优先级高于 `+`、`-`。",
            // Activity 4: Predict
            "predict_title": "预测输出", "predict_desc": "在脑海中或纸上计算以下 Python 代码的结果，注意运算符优先级。在框中输入您预测的答案并检查。",
            "predict_input_label": "您预测的输出：", "button_check_prediction": "检查预测",
            "predict_actual_label": "实际结果：",
            "feedback_predict_correct": "完全正确！您正确地计算了结果。",
            "feedback_predict_incorrect": "很接近，但不太对。检查运算顺序。",
            "feedback_predict_empty": "请在框中输入您的预测。",
            "feedback_predict_invalid": "请输入一个有效的数字作为您的预测。",
            // Activity 5: Missions
            "missions_title": "数值迷你任务！", "missions_desc": "运用你的知识！完成这些涉及算术运算符的编码任务。使用模拟输出来检查您的结果。",
            "mission1_title": "任务 1：矩形面积", "mission1_desc": "编写一个 Python 命令，使用 `print()` 计算宽度为 `12`、高度为 `5` 的矩形面积。（面积 = 宽 * 高）。", "mission1_placeholder": "print(宽 * 高)", "button_test_mission_1": "测试任务 1",
            "mission2_title": "任务 2：平均分", "mission2_desc": "计算三个测试分数 `85`、`92` 和 `78` 的平均值。使用 `print()`，并记住可能需要括号来保证正确的顺序！", "mission2_placeholder": "print((分数1 + 分数2 + 分数3) / 3)", "button_test_mission_2": "测试任务 2",
            "mission3_title": "任务 3：除法细节", "mission3_desc": "使用两个独立的 `print()` 命令。第一个应显示 `17` 整除 `5` 的结果 (`//`)。第二个应显示 `17` 除以 `5` 的余数 (`%`)。", "mission3_placeholder": "print(17 // 5)\\nprint(17 % 5)", "button_test_mission_3": "测试任务 3",
            "feedback_mission_success": "任务完成！", "feedback_mission_syntax_error": "语法错误。检查您的 `print()` 语句和运算符。",
            "feedback_mission_incorrect_output": "代码运行，但输出不是预期结果。检查您的计算。",
            "feedback_mission1_hint": "使用 `print(12 * 5)`。",
            "feedback_mission2_hint": "使用 `print((85 + 92 + 78) / 3)`。别忘了括号！",
            "feedback_mission3_hint": "需要两行：`print(17 // 5)` 和 `print(17 % 5)`。",
            "feedback_mission_runtime_error": "运行时错误（例如，除以零）。",
            "feedback_missions_summary_all_done": "所有 {totalMissions} 个任务已完成！出色的计算工作！", "feedback_missions_summary_progress": "已完成 {completedCount} / {totalMissions} 个任务。继续计算！",
            // Completion
            "completion_title": "模块 2 练习完成！", "completion_desc": "出色的计算能力！您已经掌握了 Python 的算术运算符和优先级。<br> 准备好迎接更复杂的挑战了吗？前往模块 2 的<strong>高级练习</strong>！",
            "button_view_theory": "再次查看理论", "button_start_advanced": "开始高级练习", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions ---
        function getStoredLanguage() { /* ... (same as M0) ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) { /* ... (adapting setup calls) ... */
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang); // Apply generic translations first

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

            // Re-initialize or update language-dependent interactive content
            if (spotlightSection) setupOperatorSpotlight();
            if (calcSimulatorSection) { /* Update placeholders via translatePage */ }
            if (precedenceSection) setupPrecedenceCheck(); // Re-renders expression and resets
            if (predictSection) { /* Update placeholders via translatePage */ }
            if (missionsSection && typeof updateMissionSummary === 'function') {
                updateMissionSummary(); // Updates summary text
            }
        }

        function getTranslation(key, lang, replacements = {}) { /* ... (same as M0) ... */
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; // Fallback shows key
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
         }


        function translatePage(lang) { /* ... (same as M0) ... */
            if (!translations[lang]) lang = 'en';
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Handled by placeholder */ }
                 else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else {
                     if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                     else { el.textContent = translation; }
                 }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                const key = el.getAttribute('data-translate-placeholder');
                el.setAttribute('placeholder', getTranslation(key, lang));
            });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 el.setAttribute('title', getTranslation(key, lang));
             });
        }

        // --- Initialize Language ---
        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic ---
        /* ... (same as M0) ... */
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;

        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => {
                event.stopPropagation(); body.classList.toggle('nav-active');
                navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
             });
            document.addEventListener('click', (event) => {
                if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) {
                    body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false');
                }
             });
            navPanel.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); });
             });
             document.addEventListener('keydown', (event) => {
                 if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }
             });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup ---
        /* ... (same as M0) ... */
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => setLanguage(e.target.value));
        }

        // --- Helper Function for Feedback ---
        /* ... (same as M0) ... */
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) {
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             if (translatedMessage.includes('<') && translatedMessage.includes('>')) { feedbackEl.innerHTML = translatedMessage; }
             else { feedbackEl.textContent = translatedMessage; }
            feedbackEl.className = 'feedback-message'; // Reset classes
            feedbackEl.classList.add('visible', type);
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
            else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
        }

        // --- Activity 1: Operator Spotlight ---
        const spotlightSection = document.getElementById('operator-spotlight');
        let operatorExplanations = {};
        const spotlightOperators = ['+', '-', '*', '/', '//', '%', '**']; // Operators to cycle through
        let currentSpotlightListeners = [];

        function setupOperatorSpotlight() {
            if (!spotlightSection) return;
            const currentLang = getStoredLanguage();
            operatorExplanations = {}; // Clear previous
            document.querySelectorAll('#explanation-texts span[data-key]').forEach(span => {
                const key = span.getAttribute('data-key');
                if (spotlightOperators.includes(key)) { // Only load explanations for relevant operators
                    operatorExplanations[key] = getTranslation(`spotlight_exp_${key}`, currentLang);
                }
            });

            const expressionsDiv = document.getElementById('spotlight-expressions');
            const explanationsDiv = document.getElementById('spotlight-explanations');
            const statusP = document.getElementById('operator-status');
            const feedbackDiv = document.getElementById('spotlight-feedback');
            let identifiedCount = 0;
            const totalOperators = spotlightOperators.length;

            // Remove old listeners
            currentSpotlightListeners.forEach(({ element, listener }) => {
                element.removeEventListener('click', listener);
            });
            currentSpotlightListeners = [];

            // Reset visual state
            expressionsDiv.innerHTML = '';
            explanationsDiv.innerHTML = '';
            statusP.textContent = getTranslation('spotlight_status_initial', currentLang);
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

            // Create example expressions
            const examples = {
                '+': '5 <span class="code-op" data-op="+">+</span> 3',
                '-': '10 <span class="code-op" data-op="-">-</span> 4',
                '*': '7 <span class="code-op" data-op="*">*</span> 3',
                '/': '10 <span class="code-op" data-op="/">/</span> 4',
                '//': '10 <span class="code-op" data-op="//">//</span> 4',
                '%': '10 <span class="code-op" data-op="%">%</span> 4',
                '**': '2 <span class="code-op" data-op="**">**</span> 3'
            };

            spotlightOperators.forEach(op => {
                const p = document.createElement('p');
                p.classList.add('code-expression');
                p.innerHTML = examples[op];
                const opSpan = p.querySelector('.code-op');
                opSpan.setAttribute('title', getTranslation('tooltip_click_identify_op', currentLang));
                opSpan.dataset.translateTitle = 'tooltip_click_identify_op'; // For potential re-translation

                const clickListener = () => {
                    if (!opSpan.classList.contains('identified')) {
                        opSpan.classList.add('identified');
                        identifiedCount++;

                        const expP = document.createElement('p');
                        expP.classList.add('op-explanation');
                        const icon = document.createElement('i');
                        icon.className = 'fas fa-check-circle';
                        icon.style.color = 'var(--success-color)';
                        expP.appendChild(icon);
                        expP.appendChild(document.createTextNode(' ')); // Add space
                        // Use innerHTML because explanation text has `<code>` tags potentially
                        expP.innerHTML += operatorExplanations[op];
                        explanationsDiv.appendChild(expP);

                        statusP.textContent = getTranslation('spotlight_status_progress', currentLang, { count: identifiedCount, total: totalOperators });

                        if (identifiedCount === totalOperators) {
                            statusP.textContent = getTranslation('spotlight_status_done', currentLang);
                            showFeedback('spotlight-feedback', 'feedback_spotlight_correct', 'correct');
                        }
                    }
                };
                opSpan.addEventListener('click', clickListener);
                currentSpotlightListeners.push({ element: opSpan, listener: clickListener });
                expressionsDiv.appendChild(p);
            });
        }

        // --- Activity 2: Calculation Simulator ---
        const calcSimulatorSection = document.getElementById('calc-simulator');
        if (calcSimulatorSection) {
            const editor = document.getElementById('sim-editor-input');
            const outputArea = document.getElementById('sim-output');
            const runBtn = document.getElementById('run-sim-btn');
            const feedbackDiv = document.getElementById('sim-feedback');

            // Safer calculation function
            function safeCalculate(expression) {
                // Very basic check for allowed characters: numbers, ., +, -, *, /, %, (, ), whitespace, //, **
                if (!/^[\d\.\s\+\-\*\/\%\(\)\/]{1,100}$/.test(expression.replace(/\/\/|\*\*/g, ''))) {
                   // Allow // and ** by replacing them temporarily
                   if (!/^[\d\.\s\+\-\*\/\%\(\)]{1,100}$/.test(expression)) {
                       throw new Error("Invalid characters in expression.");
                   }
                }
                 // Simple check for division by zero involving / or // followed by 0 not preceded by a digit
                 if (/\/\s*0(?![.\d])/.test(expression) || /\/\/\s*0(?![.\d])/.test(expression)) {
                    throw new Error("Division by zero attempt detected.");
                 }

                // Use Function constructor for slightly safer evaluation than direct eval
                try {
                    // Need to handle Python's // and ** which aren't standard JS operators
                    // Replace // with Math.floor(a/b) - this is tricky to do generally with regex
                    // Replace ** with Math.pow(a,b) - also tricky
                    // For simple cases print(num op num) it's easier. Let's handle that.
                    const simpleMatch = expression.match(/^\s*([\d\.]+)\s*(\/\/|\*\*|\+|-|\*|\/|%)\s*([\d\.]+)\s*$/);
                    if (simpleMatch) {
                        const num1 = parseFloat(simpleMatch[1]);
                        const op = simpleMatch[2];
                        const num2 = parseFloat(simpleMatch[3]);
                        if (isNaN(num1) || isNaN(num2)) throw new Error("Invalid number format.");

                        switch (op) {
                            case '+': return num1 + num2;
                            case '-': return num1 - num2;
                            case '*': return num1 * num2;
                            case '/': return num2 === 0 ? Infinity : num1 / num2; // Handle simple div by zero
                            case '//': return num2 === 0 ? Infinity : Math.floor(num1 / num2);
                            case '%': return num2 === 0 ? NaN : num1 % num2; // Modulo by zero is NaN
                            case '**': return Math.pow(num1, num2);
                            default: throw new Error("Unknown operator");
                        }
                    } else {
                         // Fallback for more complex expressions (use Function constructor)
                         // WARNING: Still potentially unsafe if not carefully validated!
                         // This simplified version won't handle // or ** correctly.
                        return new Function(`return ${expression}`)();
                    }
                } catch (e) {
                    console.error("Calculation error:", e);
                    throw new Error(`Calculation Error: ${e.message}`);
                }
            }


            runBtn.addEventListener('click', () => {
                 const code = editor.value.trim();
                 const currentLang = getStoredLanguage();
                 outputArea.innerHTML = ''; // Clear previous output
                 const placeholder = document.createElement('span');
                 placeholder.className = 'placeholder';
                 placeholder.textContent = getTranslation('simulator_output_placeholder', currentLang);
                 feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

                 if (code === '') {
                     outputArea.appendChild(placeholder);
                     showFeedback('sim-feedback', 'feedback_sim_empty', 'info');
                     return;
                 }

                 // Check if it looks like print(expression)
                 const printRegex = /^print\s*\((.*)\)\s*$/i;
                 const match = code.match(printRegex);

                 if (match) {
                     const expression = match[1].trim();
                     if (expression === '') {
                        outputArea.appendChild(placeholder);
                        showFeedback('sim-feedback', 'feedback_sim_invalid_print', 'incorrect');
                        return;
                     }
                     try {
                         const result = safeCalculate(expression);
                         if (result === Infinity || result === -Infinity || isNaN(result)) {
                             if (isNaN(result)) { // Specifically Modulo by zero
                                throw new Error("Result is Not a Number (e.g. Modulo by zero).")
                             } else { // Division by zero
                                 throw new Error("Division by zero attempt detected.");
                             }
                         }

                         const outputLine = document.createElement('span');
                         outputLine.classList.add('output-line');
                         // Format nicely (avoid excessive decimals for simple results)
                         outputLine.textContent = `> ${Number.isInteger(result) ? result : result.toFixed(4).replace(/\.?0+$/, '')}`;
                         outputArea.appendChild(outputLine);
                         showFeedback('sim-feedback', 'feedback_sim_success', 'correct');
                     } catch (e) {
                         console.error("Sim Error:", e);
                         outputArea.innerHTML = `<span class="output-error">Error</span>`;
                         if (e.message.includes("Division by zero")) {
                            showFeedback('sim-feedback', 'feedback_sim_div_zero', 'incorrect');
                         } else {
                            showFeedback('sim-feedback', 'feedback_sim_invalid_print', 'incorrect');
                         }
                     }
                 } else {
                     outputArea.appendChild(placeholder);
                     showFeedback('sim-feedback', 'feedback_sim_syntax', 'incorrect');
                 }
             });
        }

        // --- Activity 3: Precedence Check ---
        const precedenceSection = document.getElementById('precedence-check');
        let selectedOperator = null;
        let precedenceCheckBtn;

        function setupPrecedenceCheck() {
            if (!precedenceSection) return;
            const expressionDiv = document.getElementById('precedence-expression');
            precedenceCheckBtn = document.getElementById('check-precedence-btn');
            const feedbackDiv = document.getElementById('precedence-feedback');
            const explanationDiv = document.getElementById('precedence-explanation');
            const currentLang = getStoredLanguage();

            selectedOperator = null; // Reset selection
            precedenceCheckBtn.disabled = true;
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
            explanationDiv.classList.add('hidden');
            explanationDiv.innerHTML = ''; // Clear previous explanation

            // Example expression: 10 + 5 * 2. '*' should be chosen.
            expressionDiv.innerHTML = `
                <span class="code-number">10</span>
                <span class="code-operator op-choice" data-op="+">+</span>
                <span class="code-number">5</span>
                <span class="code-operator op-choice" data-op="*">*</span>
                <span class="code-number">2</span>
            `;

            expressionDiv.querySelectorAll('.op-choice').forEach(op => {
                op.classList.remove('selected'); // Clear visual selection
                op.addEventListener('click', () => {
                    // Remove selection from others
                    expressionDiv.querySelectorAll('.op-choice').forEach(otherOp => otherOp.classList.remove('selected'));
                    // Select this one
                    op.classList.add('selected');
                    selectedOperator = op.dataset.op;
                    precedenceCheckBtn.disabled = false; // Enable check button
                });
            });
        }

        if (precedenceSection) {
            precedenceCheckBtn = document.getElementById('check-precedence-btn'); // Ensure it's assigned
            const feedbackDiv = document.getElementById('precedence-feedback');
            const explanationDiv = document.getElementById('precedence-explanation');
            const explanationTextCorrect = document.querySelector('#precedence-explanation-text [data-translate="precedence_exp_correct"]');
            const explanationTextIncorrect = document.querySelector('#precedence-explanation-text [data-translate="precedence_exp_incorrect"]');
            const ruleSummaryText = document.querySelector('#precedence-explanation-text [data-translate="precedence_rule_summary"]');

            precedenceCheckBtn.addEventListener('click', () => {
                const currentLang = getStoredLanguage();
                if (!selectedOperator) {
                    showFeedback('precedence-feedback', 'feedback_precedence_select', 'info');
                    return;
                }

                // Correct answer for '10 + 5 * 2' is '*'
                const correctAnswer = '*';
                explanationDiv.classList.remove('hidden');
                explanationDiv.innerHTML = ''; // Clear first

                 if (selectedOperator === correctAnswer) {
                     showFeedback('precedence-feedback', 'feedback_precedence_correct', 'correct');
                     explanationDiv.innerHTML = getTranslation('precedence_exp_correct', currentLang);
                     precedenceCheckBtn.classList.add('success');
                 } else {
                     showFeedback('precedence-feedback', 'feedback_precedence_incorrect', 'incorrect');
                     explanationDiv.innerHTML = getTranslation('precedence_exp_incorrect', currentLang);
                      precedenceCheckBtn.classList.remove('success');
                 }
                 // Always show the rule summary
                 const summaryP = document.createElement('p');
                 summaryP.style.marginTop = '10px';
                 summaryP.style.fontSize = '0.9em';
                 summaryP.innerHTML = getTranslation('precedence_rule_summary', currentLang);
                 explanationDiv.appendChild(summaryP);

                 precedenceCheckBtn.disabled = true; // Disable after check
            });

            // Initial setup
             // setupPrecedenceCheck(); // Called by setLanguage
        }

        // --- Activity 4: Predict the Output ---
        const predictSection = document.getElementById('predict-output');
        if (predictSection) {
            const inputField = document.getElementById('prediction-input');
            const checkBtn = document.getElementById('check-prediction-btn');
            const feedbackDiv = document.getElementById('prediction-feedback');
            const actualResultDiv = document.getElementById('prediction-actual-result');
            const actualResultValueSpan = actualResultDiv.querySelector('.value');

            // The expression: (4 + 6) * 3 - 8 / 2
            const actualResult = (4 + 6) * 3 - 8 / 2; // JS calculates this as 26.0

            checkBtn.addEventListener('click', () => {
                const prediction = inputField.value.trim();
                const currentLang = getStoredLanguage();
                feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
                actualResultDiv.classList.add('hidden');

                if (prediction === '') {
                    showFeedback('prediction-feedback', 'feedback_predict_empty', 'info');
                    return;
                }

                const predictionNum = parseFloat(prediction);
                 if (isNaN(predictionNum)) {
                     showFeedback('prediction-feedback', 'feedback_predict_invalid', 'incorrect');
                     return;
                 }

                // Compare prediction with actual result (handle potential float issues if needed, but 26.0 is exact here)
                 if (Math.abs(predictionNum - actualResult) < 0.0001) { // Use tolerance for float comparison
                     showFeedback('prediction-feedback', 'feedback_predict_correct', 'correct');
                     checkBtn.classList.add('success');
                     checkBtn.disabled = true;
                     inputField.disabled = true;
                 } else {
                     showFeedback('prediction-feedback', 'feedback_predict_incorrect', 'incorrect');
                     checkBtn.classList.remove('success');
                     // Show the actual result only on incorrect guess
                     actualResultValueSpan.textContent = actualResult;
                     actualResultDiv.classList.remove('hidden');
                 }
            });
        }


        // --- Activity 5: Numerical Mini Missions ---
        const missionsSection = document.getElementById('num-mini-missions');
        let updateMissionSummary; // Define function scope
        if (missionsSection) {
            const missionRunButtons = missionsSection.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('missions-summary-feedback');
            const totalMissions = missionsSection.querySelectorAll('.mission').length;

            updateMissionSummary = function() { // Assign function definition
                 const completedMissionsCount = missionsSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('missions-summary-feedback', 'feedback_missions_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('missions-summary-feedback', 'feedback_missions_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible', 'correct', 'incorrect', 'info');
                 }
            }

            // Simplified evaluation for missions - assumes simple print(expression)
            function evaluateMissionCode(code, expectedOutputs) {
                const lines = code.split('\n').map(l => l.trim()).filter(l => l !== '');
                if (lines.length !== expectedOutputs.length) {
                    return { success: false, error: 'Incorrect number of print lines.' };
                }

                let actualOutputs = [];
                const printRegex = /^print\s*\((.*)\)\s*$/i;

                for (const line of lines) {
                    const match = line.match(printRegex);
                    if (!match) return { success: false, error: 'Syntax Error: Use print(...).' };
                    const expression = match[1].trim();
                    try {
                         // Use Function constructor for basic eval - less safe but handles precedence
                         // Add Math object for potential functions if needed later
                         const result = new Function('return ' + expression)();
                        if (result === Infinity || result === -Infinity || isNaN(result)) {
                            throw new Error("Calculation resulted in Infinity or NaN.");
                        }
                         actualOutputs.push(result);
                    } catch (e) {
                         console.error("Mission Eval Error:", e);
                         return { success: false, error: `Runtime Error: ${e.message}` };
                    }
                }

                // Compare actual outputs with expected outputs (allow small float tolerance)
                for (let i = 0; i < expectedOutputs.length; i++) {
                    if (Math.abs(actualOutputs[i] - expectedOutputs[i]) > 0.0001) {
                        return { success: false, error: 'Incorrect output.', actualOutputs };
                    }
                }

                return { success: true, actualOutputs };
            }


            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`mission-${missionId}`);
                    if (!missionDiv) return;

                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-feedback-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();
                    const currentLang = getStoredLanguage();

                    outputArea.innerHTML = ''; // Clear previous
                    feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

                    let expectedOutputs = [];
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error';
                    let feedbackType = 'incorrect';
                    let specificHintKey = '';

                    try {
                         if (missionId === '1') { expectedOutputs = [12 * 5]; specificHintKey = 'feedback_mission1_hint'; }
                         else if (missionId === '2') { expectedOutputs = [(85 + 92 + 78) / 3]; specificHintKey = 'feedback_mission2_hint'; }
                         else if (missionId === '3') { expectedOutputs = [Math.floor(17 / 5), 17 % 5]; specificHintKey = 'feedback_mission3_hint'; }

                         const result = evaluateMissionCode(code, expectedOutputs);

                         if (result.success) {
                             success = true;
                             feedbackMessageKey = 'feedback_mission_success';
                             feedbackType = 'correct';
                             outputArea.innerHTML = result.actualOutputs.map(o => `<span class="output-line">> ${o}</span>`).join('');
                         } else {
                             feedbackType = 'incorrect';
                             if (result.error === 'Incorrect output.') {
                                 feedbackMessageKey = 'feedback_mission_incorrect_output';
                                 outputArea.innerHTML = result.actualOutputs.map(o => `<span class="output-line">> ${o}</span>`).join('');
                             } else if (result.error.startsWith('Runtime Error')) {
                                feedbackMessageKey = 'feedback_mission_runtime_error';
                                outputArea.innerHTML = `<span class="output-error">${result.error}</span>`;
                             } else {
                                 feedbackMessageKey = specificHintKey || 'feedback_mission_syntax_error'; // Default or specific hint
                                 outputArea.innerHTML = `<span class="output-error">Error</span>`;
                             }
                         }
                    } catch (evalError) { // Catch errors from evaluation itself
                         console.error("Mission Button Handler Error:", evalError);
                         feedbackMessageKey = 'feedback_mission_syntax_error';
                         feedbackType = 'incorrect';
                         outputArea.innerHTML = `<span class="output-error">Error during execution</span>`;
                    }

                    // Update UI
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    statusIcon.className = success ? 'fas fa-check-circle' : 'fas fa-times-circle';
                    missionDiv.dataset.completed = success.toString();
                    updateMissionSummary();
                });
            });
            updateMissionSummary(); // Initial call
        }


        // --- Fade-in animations on scroll ---
        /* ... (same as M0) ... */
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => {
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                 if (el.style.opacity === '1') return; // Already visible
                 const rect = el.getBoundingClientRect();
                 if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                     el.style.opacity = '1';
                     el.style.transform = 'translateY(0)';
                 }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Setup ---
        setLanguage(initialLang); // Apply language FIRST and trigger activity setups
        animateOnScroll(); // Trigger initial animation check for elements already in view

    }); // End DOMContentLoaded
    </script>

</body>
</html>