<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 17: Advanced Function Parameters</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Mostly Copied from previous) --- */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Grey */
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --abstraction-color: #9c27b0; /* Purple for Abstraction */
            --decomposition-color: #ff9800; /* Orange for Decomposition */
            --keyword-arg-color: #c586c0; /* Magenta-ish for Keyword Args */
            --default-value-color: #4ec9b0; /* Teal-ish for Default Values */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Mostly Copied) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group { margin-top: 2rem; display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
        .ct-badge { display: inline-block; padding: 0.2em 0.6em; margin: 0 0.2em; font-size: 0.8rem; border-radius: 4px; color: var(--text-light); font-weight: bold; vertical-align: middle; text-transform: uppercase; }
        .ct-abstraction { background-color: var(--abstraction-color); }
        .ct-decomposition { background-color: var(--decomposition-color); }

        /* --- Advanced Animations (Copied) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; }
        .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; }
        .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; filter: brightness(1); } 50% { transform: scale(1.05); opacity: 0.25; filter: brightness(1.2); } 100% { transform: scale(1); opacity: 0.1; filter: brightness(1); } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); transform: scale(1.01); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); transform: scale(1); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav (Copied, links updated later via JS/HTML) --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Practice Header (Adjusted for Advanced) --- */
        .practice-header { background: linear-gradient(135deg, var(--decomposition-color), #b36b00); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--abstraction-color); } /* Swapped border/gradient colors */
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 5.5s; } /* Slightly different timing */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 7.5s; }

        /* --- Practice Section Styling (Copied) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Copied) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        /* Code styling (Copied & Extended) */
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } /* def */
        .code-function { color: #dcdcaa; } /* function name */
        .code-parameter { color: #9cdcfe; font-style: italic; } /* parameter */
        .code-argument { color: #b5cea8; font-weight: bold; } /* argument value */
        .code-string { color: #ce9178; }
        .code-number { color: #b5cea8; }
        .code-comment { color: #6a9955; }
        .code-paren { color: #ffd700; }
        .code-colon { color: #ffd700; } /* Colon */
        .code-equals { color: #d4d4d4; } /* Equals sign for defaults/keywords */
        .code-default-value { color: var(--default-value-color); } /* Default parameter value */
        .code-keyword-arg { color: var(--keyword-arg-color); } /* Keyword argument name=value */


        /* --- Activity 1: Anatomy of Default Parameters --- */
        #anatomy-default .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #anatomy-default .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #anatomy-default .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #anatomy-default-status { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 2: Spot the Keyword Argument --- */
         .clickable-code-container { display: flex; align-items: center; margin-bottom: 8px; position: relative; }
         .feedback-icon-placeholder { width: 30px; height: 24px; margin-right: 10px; display: inline-flex; align-items: center; justify-content: center; transition: opacity var(--transition-speed); opacity: 0; font-size: 1.2rem; }
         .feedback-icon-placeholder.visible { opacity: 1; }
         #spot-keyword .code-line-content { flex-grow: 1; background-color: var(--background-dark); color: var(--text-light); padding: 10px 15px; border-radius: 5px; font-family: var(--code-font); border-left: 4px solid transparent; user-select: none; -webkit-user-select: none; }
         #spot-keyword .clickable-code { cursor: pointer; border-bottom: 2px dotted rgba(255, 255, 255, 0.4); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 3px; }
         #spot-keyword .clickable-code:hover { background-color: rgba(255, 255, 255, 0.1); border-bottom-color: var(--accent-color); }
         #spot-keyword .clickable-code.selected-visual { background-color: var(--selection-highlight-bg); border-bottom: 2px solid var(--selection-highlight-border); color: var(--accent-color); }
         #spot-keyword .clickable-code.checked-state { cursor: default; border-bottom-style: solid; }
         .feedback-icon-placeholder .fa-check { color: var(--success-color); animation: iconAppearCorrect 0.5s ease-out forwards; }
         .feedback-icon-placeholder .fa-times { color: var(--error-color); animation: iconAppearIncorrect 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
         .feedback-icon-placeholder .fa-eye { color: var(--accent-color); animation: iconAppearMissed 0.4s ease-in forwards; opacity: 0; }
         #reset-keyword-btn { margin-left: 10px; }

        /* --- Activity 3: Simulator (Defaults & Keywords) --- */
        #simulator-defaults .sim-editor { width: 100%; min-height: 60px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #simulator-defaults .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #simulator-defaults .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #simulator-defaults .sim-output-area .output-line { display: block; }
        #simulator-defaults .function-display { background-color: var(--background-medium); border: 1px dashed var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; margin-bottom: 1rem; font-family: var(--code-font);}

        /* --- Activity 4: Mini Missions (Advanced) --- */
        #mini-missions-adv-m17 .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        #mini-missions-adv-m17 .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        #mini-missions-adv-m17 .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        #mini-missions-adv-m17 .mission-status .fa-times-circle { color: var(--error-color); }
        #mini-missions-adv-m17 .mission-status .fa-question-circle { color: var(--secondary-color); }
        #mini-missions-adv-m17 .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #mini-missions-adv-m17 .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; }
        #mini-missions-adv-m17 .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }


        /* --- Final Section (Adjusted Links) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Copied) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .feedback-icon-placeholder { width: 25px; margin-right: 8px; font-size: 1.1rem;}
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            #simulator-defaults .sim-editor, #simulator-defaults .sim-output-area { font-size: 0.9rem; }
            #spot-keyword .code-line-content { padding: 8px 12px; font-size: 0.9rem;}
            #mini-missions-adv-m17 .mission-editor { min-height: 90px; font-size: 0.95rem;}
            #mini-missions-adv-m17 .mission-output { font-size: 0.95rem;}
            .feedback-icon-placeholder { width: 20px; margin-right: 5px; font-size: 1rem;}
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
             <!-- *** UPDATED LINKS FOR ADVANCED MODULE 17 *** -->
            <li><a href="ctp-practice-17.html"><i class="fas fa-puzzle-piece fa-fw"></i> <span data-translate="nav_basic_practice">Basic Practice</span></a></li>
            <li><a href="ctp-video-17.html"><i class="fas fa-video fa-fw"></i> <span data-translate="nav_video">Watch Video</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
             <!-- *** UPDATED ACTIVITY LINKS FOR ADVANCED MODULE 17 *** -->
            <li><a href="#anatomy-default"><i class="fas fa-microscope fa-fw"></i> <span data-translate="nav_anatomy_default">Anatomy (Defaults)</span></a></li>
            <li><a href="#spot-keyword"><i class="fas fa-search-plus fa-fw"></i> <span data-translate="nav_spot_keyword">Spot Keyword Args</span></a></li>
            <li><a href="#simulator-defaults"><i class="fas fa-sliders-h fa-fw"></i> <span data-translate="nav_simulator_defaults">Simulator (Defaults)</span></a></li>
            <li><a href="#mini-missions-adv-m17"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_missions_adv_m17">Advanced Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <i class="fas fa-level-up-alt header-icon icon1"></i> <!-- Changed icon -->
        <i class="fas fa-lightbulb header-icon icon2"></i> <!-- Changed icon -->
        <div class="container">
            <!-- *** UPDATED TEXT FOR ADVANCED MODULE 17 *** -->
            <h1 data-translate="header_title">Module 17: Advanced Parameters</h1>
            <p data-translate="header_subtitle">Explore default values and keyword arguments for flexible functions.</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Anatomy of Default Parameters ========= -->
        <section id="anatomy-default" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-microscope"></i> <span data-translate="anatomy_default_title">Anatomy: Default Parameters</span> <span class="ct-badge ct-abstraction" data-translate="ct_abstraction">Abstraction</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="anatomy_default_desc">
                     Functions can have optional parameters with default values. Click each part of this definition to see how it works.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
                         <span class="code-part" data-part="def" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-keyword">def</span></span> <span class="code-part" data-part="func-name" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-function">power_up</span></span><!--
                         --><span class="code-part" data-part="paren-open" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-paren">(</span></span><!--
                         --><span class="code-part" data-part="param-req" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-parameter">character</span></span><!--
                         --><span class="code-part" data-part="comma" data-translate-title="tooltip_click_identify" title="Click to identify this part">,</span> <span class="code-part" data-part="param-opt" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-parameter">level</span></span><!--
                         --><span class="code-part" data-part="equals" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-equals">=</span></span><!--
                         --><span class="code-part" data-part="default-val" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-default-value">1</span></span><!--
                         --><span class="code-part" data-part="paren-close" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-paren">)</span></span><!--
                         --><span class="code-part" data-part="colon" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-colon">:</span></span>
                         <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment" data-translate="anatomy_default_comment"># Increase power level</span>
                     </div>
                     <div id="anatomy-default-explanations"></div>
                     <p id="anatomy-default-status" data-translate="anatomy_default_status_initial">Identify all 9 parts!</p>
                     <div id="anatomy-default-feedback" class="feedback-message"></div>
                     <!-- Hidden elements for storing translated explanation parts -->
                     <div id="explanation-texts-adv-m17-anatomy" style="display: none;">
                        <span data-key="def" data-translate="anatomy_adv_exp_def">`def`: Starts the function definition.</span>
                        <span data-key="func-name" data-translate="anatomy_adv_exp_func_name">`power_up`: Name of the function.</span>
                        <span data-key="paren-open" data-translate="anatomy_adv_exp_paren_open">`(`: Starts parameter list.</span>
                        <span data-key="param-req" data-translate="anatomy_adv_exp_param_req">`character`: A *required* parameter (must be provided when calling).</span>
                        <span data-key="comma" data-translate="anatomy_adv_exp_comma">`,`: Separates parameters.</span>
                        <span data-key="param-opt" data-translate="anatomy_adv_exp_param_opt">`level`: An *optional* parameter (has a default value).</span>
                        <span data-key="equals" data-translate="anatomy_adv_exp_equals">`=`: Assigns a default value to the parameter.</span>
                        <span data-key="default-val" data-translate="anatomy_adv_exp_default_val">`1`: The default value for `level` if not provided in the call.</span>
                        <span data-key="paren-close" data-translate="anatomy_adv_exp_paren_close">`)`: Ends parameter list.</span>
                        <span data-key="colon" data-translate="anatomy_adv_exp_colon">`:`: Ends the function header.</span>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Spot the Keyword Argument ========= -->
        <section id="spot-keyword" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-search-plus"></i> <span data-translate="spot_keyword_title">Spot the Keyword Argument</span></h2>
                <p class="section-description fade-in delay-1" data-translate="spot_keyword_desc">
                     You can pass arguments by position or by name (keyword). Click on the argument(s) below that are passed using the <span class="highlight code-font">parameter_name=value</span> syntax (keyword arguments).
                </p>
                <div class="interactive-area fade-in delay-2">
                    <div id="keyword-lines">
                         <!-- Lines will be generated by JS -->
                        <div class="clickable-code-container">
                             <span class="feedback-icon-placeholder"></span>
                             <div class="code-line-content">
                                 <span class="code-comment"># Function definition</span><br>
                                 <span class="code-keyword">def</span> <span class="code-function">create_profile</span>(<span class="code-parameter">user_id</span>, <span class="code-parameter">active</span><span class="code-equals">=</span><span class="code-default-value">True</span>): ...
                             </div>
                        </div>
                         <div class="clickable-code-container">
                              <span class="feedback-icon-placeholder"></span>
                              <div class="code-line-content">
                                  <span class="code-function">create_profile</span>(<span class="clickable-code" data-type="positional"><span class="code-number">101</span></span>) <span class="code-comment"># Call 1 (Positional)</span>
                              </div>
                         </div>
                          <div class="clickable-code-container">
                              <span class="feedback-icon-placeholder"></span>
                              <div class="code-line-content">
                                  <span class="code-function">create_profile</span>(<span class="clickable-code" data-type="positional"><span class="code-number">102</span></span>, <span class="clickable-code" data-type="positional"><span class="code-default-value">False</span></span>) <span class="code-comment"># Call 2 (Positional)</span>
                              </div>
                         </div>
                          <div class="clickable-code-container">
                              <span class="feedback-icon-placeholder"></span>
                              <div class="code-line-content">
                                  <span class="code-function">create_profile</span>(<span class="clickable-code" data-type="keyword"><span class="code-keyword-arg">user_id</span><span class="code-equals">=</span><span class="code-number">103</span></span>) <span class="code-comment"># Call 3 (Keyword)</span>
                              </div>
                         </div>
                         <div class="clickable-code-container">
                              <span class="feedback-icon-placeholder"></span>
                              <div class="code-line-content">
                                  <span class="code-function">create_profile</span>(<span class="clickable-code" data-type="keyword"><span class="code-keyword-arg">user_id</span><span class="code-equals">=</span><span class="code-number">104</span></span>, <span class="clickable-code" data-type="keyword"><span class="code-keyword-arg">active</span><span class="code-equals">=</span><span class="code-default-value">False</span></span>) <span class="code-comment"># Call 4 (Keyword)</span>
                              </div>
                         </div>
                    </div>
                     <div class="text-center">
                         <button id="check-keyword-btn" class="action-button" data-translate="button_check_keyword">Check Selection</button>
                         <button id="reset-keyword-btn" class="action-button secondary hidden" data-translate="button_try_again">Try Again</button>
                     </div>
                     <div id="keyword-feedback" class="feedback-message"></div>
                </div>
            </div>
        </section>

         <!-- ========= Activity 3: Simulator (Defaults & Keywords) ========= -->
        <section id="simulator-defaults" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-sliders-h"></i> <span data-translate="simulator_defaults_title">Simulator: Defaults & Keywords</span> <span class="ct-badge ct-abstraction" data-translate="ct_abstraction">Abstraction</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="simulator_defaults_desc">
                     Below is a function `configure_system` with default parameters. Your task: Call this function to set the `retries` parameter to `5`, but let `timeout` use its default value.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="simulator_defaults_defined_label">Defined Function:</label>
                     <div class="function-display code-block">
                         <span class="code-keyword">def</span> <span class="code-function">configure_system</span>(<span class="code-parameter">mode</span><span class="code-equals">=</span><span class="code-string">"auto"</span>, <span class="code-parameter">timeout</span><span class="code-equals">=</span><span class="code-number">30</span>, <span class="code-parameter">retries</span><span class="code-equals">=</span><span class="code-number">3</span>)<span class="code-colon">:</span>
                         <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">print</span>(<span class="code-string">f"Mode: {</span><span class="code-parameter">mode</span><span class="code-string">}, Timeout: {</span><span class="code-parameter">timeout</span><span class="code-string">}, Retries: {</span><span class="code-parameter">retries</span><span class="code-string">}"</span>)
                     </div>

                     <label for="sim-editor-input-defaults" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="simulator_defaults_editor_label">Your Code (Function Call):</label>
                     <textarea id="sim-editor-input-defaults" class="sim-editor" rows="2" data-translate-placeholder="simulator_defaults_editor_placeholder" placeholder='e.g., configure_system(retries=5)'></textarea>
                     <div class="text-center">
                          <button id="run-defaults-sim-btn" class="action-button" data-translate="button_run_sim">Run Simulation</button>
                     </div>
                     <label style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="simulator_defaults_output_label">Simulated Output:</label>
                     <div id="sim-output-defaults" class="sim-output-area">
                         <span class="placeholder" data-translate="simulator_output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="sim-defaults-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>


         <!-- ========= Activity 4: Mini Missions (Advanced Module 17) ========= -->
        <section id="mini-missions-adv-m17" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="missions_adv_m17_title">Advanced Mini Missions!</span> <span class="ct-badge ct-decomposition" data-translate="ct_decomposition">Decomposition</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_adv_m17_desc">
                     Combine your knowledge of defaults and keywords to solve these challenges.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="mission-adv-17-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv17_1_title">Mission 1: Greeting with Default</h4>
                         <p data-translate="mission_adv17_1_desc">Define a function `greet_user(name, greeting="Hi")`. Then, call it once just with the name `"Alex"` (using the default greeting).</p>
                         <textarea class="sim-editor mission-editor" rows="5" data-translate-placeholder="mission_adv17_1_placeholder" placeholder='def greet_user(name, greeting="Hi"):\n    print(greeting + ", " + name)\n\ngreet_user("Alex")'></textarea>
                         <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-17-1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-adv-17-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="mission-adv-17-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv17_2_title">Mission 2: Keyword Power</h4>
                         <p data-translate="mission_adv17_2_desc">A function `set_config(ip_address, port=80, protocol="http")` exists. Call this function providing `"192.168.1.100"` for `ip_address` and `"https"` for `protocol` using keyword arguments (let `port` use its default).</p>
                         <textarea class="sim-editor mission-editor" rows="4" data-translate-placeholder="mission_adv17_2_placeholder" placeholder='set_config(ip_address="192...", protocol="https...")'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-17-2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-adv-17-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="mission-adv-17-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_adv17_3_title">Mission 3: Flexible Plotting</h4>
                          <p data-translate="mission_adv17_3_desc">Define `plot_data(data, color="blue", linestyle="-")`. Call it twice: first with just `my_data` (imagine this variable exists). Second time, call it with `my_data`, setting `color` to `"red"` using a keyword argument.</p>
                         <textarea class="sim-editor mission-editor" rows="7" data-translate-placeholder="mission_adv17_3_placeholder" placeholder='def plot_data(data, color="blue", linestyle="-"):\n    print(f"Plotting {data} with {color}/{linestyle}")\n\nmy_data = [1,2,3] # Assume exists\nplot_data(my_data)\nplot_data(my_data, color="red")'></textarea>
                          <div class="text-center"> <button class="action-button mission-run-btn" data-mission-id="adv-17-3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="sim-output-area mission-output"></div>
                         <div id="mission-feedback-adv-17-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="missions-adv-m17-summary-feedback" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                     <i class="fas fa-star"></i> <i class="fas fa-cogs"></i> <i class="fas fa-star"></i> <!-- Changed icon -->
                </div>
                 <!-- *** UPDATED TEXT FOR ADVANCED MODULE 17 COMPLETION *** -->
                <h2 class="fade-in delay-1" data-translate="completion_adv_title">Module 17 Advanced Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_adv_desc">
                    You've mastered defaults and keywords, making your function calls much more flexible! Great job stepping up the complexity. <span class="ct-badge ct-abstraction" data-translate="ct_abstraction">Abstraction</span>
                </p>
                <div class="button-group">
                    <!-- *** UPDATED LINKS FOR ADVANCED MODULE 17 COMPLETION *** -->
                    <a href="ctp-practice-17.html" class="action-button secondary fade-in delay-3"><i class="fas fa-arrow-left"></i> <span data-translate="button_back_basic">Back to Basic Practice</span></a>
                    <a href="ctp-video-17.html" class="action-button success fade-in delay-3"><i class="fas fa-video"></i> <span data-translate="button_watch_video">Watch Video Lesson</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 17: Advanced Function Parameters",
            "tooltip_click_identify": "Click to identify this part",
            "tooltip_click_select": "Click to select this code part",
            "ct_abstraction": "Abstraction", "ct_decomposition": "Decomposition",
            "nav_basic_practice": "Basic Practice", "nav_video": "Watch Video", "nav_menu": "Course Menu",
            "nav_anatomy_default": "Anatomy (Defaults)", "nav_spot_keyword": "Spot Keyword Args", "nav_simulator_defaults": "Simulator (Defaults)", "nav_missions_adv_m17": "Advanced Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Module 17: Advanced Parameters", "header_subtitle": "Explore default values and keyword arguments for flexible functions.",
            // Activity 1: Anatomy (Defaults)
            "anatomy_default_title": "Anatomy: Default Parameters",
            "anatomy_default_desc": "Functions can have optional parameters with default values. Click each part of this definition to see how it works.",
            "anatomy_default_status_initial": "Identify all 9 parts!", "anatomy_default_status_progress": "Identified {count} of {total} parts.", "anatomy_default_status_done": "All parts identified!",
            "anatomy_adv_exp_def": "`def`: Starts the function definition.",
            "anatomy_adv_exp_func_name": "`power_up`: Name of the function.",
            "anatomy_adv_exp_paren_open": "`(`: Starts parameter list.",
            "anatomy_adv_exp_param_req": "`character`: A *required* parameter (must be provided when calling).",
            "anatomy_adv_exp_comma": "`,` : Separates parameters.",
            "anatomy_adv_exp_param_opt": "`level`: An *optional* parameter (has a default value).",
            "anatomy_adv_exp_equals": "`=`: Assigns a default value to the parameter.",
            "anatomy_adv_exp_default_val": "`1`: The default value for `level` if not provided in the call.",
            "anatomy_adv_exp_paren_close": "`)`: Ends parameter list.",
            "anatomy_adv_exp_colon": "`: `: Ends the function header.",
            "anatomy_default_comment": "# Increase power level",
            "feedback_anatomy_default_correct": "Great! You understand default parameter syntax!",
             // Activity 2: Spot Keyword Args
            "spot_keyword_title": "Spot the Keyword Argument",
            "spot_keyword_desc": "You can pass arguments by position or by name (keyword). Click on the argument(s) below that are passed using the parameter_name=value syntax (keyword arguments).",
            "button_check_keyword": "Check Selection", "button_try_again": "Try Again",
            "feedback_spot_keyword_correct": "Exactly! You identified all {count} keyword arguments. <i class='fas fa-key'></i>",
            "feedback_spot_keyword_incorrect": "Not quite. {hints}. Keyword args use `name=value`.",
            "feedback_spot_hint_keyword_incorrect": "{count} incorrect selection(s) marked with <i class=\"fas fa-times\"></i>.",
            "feedback_spot_hint_keyword_missed": "{count} missed keyword argument(s) marked with <i class=\"fas fa-eye\"></i>.",
            "feedback_spot_keyword_hints_joiner": ", and ",
            // Activity 3: Simulator (Defaults/Keywords)
            "simulator_defaults_title": "Simulator: Defaults & Keywords",
            "simulator_defaults_desc": "Below is a function `configure_system` with default parameters. Your task: Call this function to set the `retries` parameter to `5`, but let `timeout` use its default value.",
            "simulator_defaults_defined_label": "Defined Function:",
            "simulator_defaults_editor_label": "Your Code (Function Call):", "simulator_defaults_editor_placeholder": "e.g., configure_system(retries=5)",
            "button_run_sim": "Run Simulation", "simulator_defaults_output_label": "Simulated Output:", "simulator_output_placeholder": "Output will appear here...",
            "feedback_simdefaults_success": "Simulation successful! Correct use of keyword argument.",
            "feedback_simdefaults_empty": "Editor is empty. Call the function.",
            "feedback_simdefaults_no_call": "Call `configure_system`.",
            "feedback_simdefaults_wrong_keyword": "Use the keyword `retries=5`.",
            "feedback_simdefaults_extra_args": "You only need to set `retries`. `mode` and `timeout` have defaults.",
            "feedback_simdefaults_syntax": "Check syntax: `configure_system(retries=5)`.",
            // Activity 4: Mini Missions (Advanced M17)
            "missions_adv_m17_title": "Advanced Mini Missions!",
            "missions_adv_m17_desc": "Combine your knowledge of defaults and keywords to solve these challenges.",
            "mission_adv17_1_title": "Mission 1: Greeting with Default",
            "mission_adv17_1_desc": "Define a function `greet_user(name, greeting=\"Hi\")`. Then, call it once just with the name `\"Alex\"` (using the default greeting).",
            "mission_adv17_1_placeholder": "def greet_user(name, greeting=\"Hi\"):\n    print(greeting + \", \" + name)\n\ngreet_user(\"Alex\")",
            "button_test_mission_1": "Test Mission 1",
            "mission_adv17_2_title": "Mission 2: Keyword Power",
            "mission_adv17_2_desc": "A function `set_config(ip_address, port=80, protocol=\"http\")` exists. Call this function providing `\"192.168.1.100\"` for `ip_address` and `\"https\"` for `protocol` using keyword arguments (let `port` use its default).",
            "mission_adv17_2_placeholder": "set_config(ip_address=\"192...\", protocol=\"https\")",
            "button_test_mission_2": "Test Mission 2",
            "mission_adv17_3_title": "Mission 3: Flexible Plotting",
            "mission_adv17_3_desc": "Define `plot_data(data, color=\"blue\", linestyle=\"-\")`. Call it twice: first with just `my_data` (imagine this variable exists). Second time, call it with `my_data`, setting `color` to `\"red\"` using a keyword argument.",
            "mission_adv17_3_placeholder": "def plot_data(data, color=\"blue\", linestyle=\"-\"):\n    print(f\"Plotting {data} with {color}/{linestyle}\")\n\nmy_data = [1,2,3] # Assume exists\nplot_data(my_data)\nplot_data(my_data, color=\"red\")",
            "button_test_mission_3": "Test Mission 3",
            "feedback_mission_success": "Mission Accomplished!", "feedback_mission_syntax_error": "Syntax error or code logic incorrect.",
            "feedback_mission_adv17_1_hint_def": "Check `greet_user` definition with default `greeting`.",
            "feedback_mission_adv17_1_hint_call": "Call `greet_user` with only the `name` argument.",
            "feedback_mission_adv17_2_hint": "Call `set_config` using `ip_address=...` and `protocol=...` keywords.",
            "feedback_mission_adv17_3_hint_def": "Check `plot_data` definition with defaults for `color` and `linestyle`.",
            "feedback_mission_adv17_3_hint_call1": "First call should be just `plot_data(my_data)`.",
            "feedback_mission_adv17_3_hint_call2": "Second call needs `plot_data(my_data, color=\"red\")`.",
            "feedback_missions_adv_summary_all_done": "All {totalMissions} advanced missions complete! You're wielding function parameters like a pro!",
            "feedback_missions_adv_summary_progress": "Completed {completedCount} of {totalMissions} advanced missions. Keep going!",
            // Completion Section
            "completion_adv_title": "Module 17 Advanced Practice Complete!",
            "completion_adv_desc": "You've mastered defaults and keywords, making your function calls much more flexible! Great job stepping up the complexity. <span class=\"ct-badge ct-abstraction\">Abstraction</span>",
            "button_back_basic": "Back to Basic Practice", "button_watch_video": "Watch Video Lesson", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 17: Parâmetros de Função Avançados",
            "tooltip_click_identify": "Clique para identificar esta parte",
            "tooltip_click_select": "Clique para selecionar esta parte do código",
            "ct_abstraction": "Abstração", "ct_decomposition": "Decomposição",
            "nav_basic_practice": "Prática Básica", "nav_video": "Ver Vídeo", "nav_menu": "Menu do Curso",
            "nav_anatomy_default": "Anatomia (Padrões)", "nav_spot_keyword": "Achar Arg Chave", "nav_simulator_defaults": "Simulador (Padrões)", "nav_missions_adv_m17": "Missões Avançadas",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "Módulo 17: Parâmetros Avançados", "header_subtitle": "Explore valores padrão e argumentos nomeados para funções flexíveis.",
            "anatomy_default_title": "Anatomia: Parâmetros Padrão",
            "anatomy_default_desc": "Funções podem ter parâmetros opcionais com valores padrão. Clique em cada parte desta definição para ver como funciona.",
            "anatomy_default_status_initial": "Identifique todas as 9 partes!", "anatomy_default_status_progress": "Identificadas {count} de {total} partes.", "anatomy_default_status_done": "Todas as partes identificadas!",
            "anatomy_adv_exp_def": "`def`: Inicia a definição da função.",
            "anatomy_adv_exp_func_name": "`power_up`: Nome da função.",
            "anatomy_adv_exp_paren_open": "`(`: Inicia a lista de parâmetros.",
            "anatomy_adv_exp_param_req": "`character`: Um parâmetro *obrigatório* (deve ser fornecido na chamada).",
            "anatomy_adv_exp_comma": "`,` : Separa parâmetros.",
            "anatomy_adv_exp_param_opt": "`level`: Um parâmetro *opcional* (possui valor padrão).",
            "anatomy_adv_exp_equals": "`=`: Atribui um valor padrão ao parâmetro.",
            "anatomy_adv_exp_default_val": "`1`: O valor padrão para `level` se não for fornecido na chamada.",
            "anatomy_adv_exp_paren_close": "`)`: Termina a lista de parâmetros.",
            "anatomy_adv_exp_colon": "`: `: Termina o cabeçalho da função.",
            "anatomy_default_comment": "# Aumentar nível de poder",
            "feedback_anatomy_default_correct": "Ótimo! Você entendeu a sintaxe de parâmetros padrão!",
            "spot_keyword_title": "Ache o Argumento Nomeado",
            "spot_keyword_desc": "Você pode passar argumentos por posição ou por nome (palavra-chave). Clique no(s) argumento(s) abaixo que são passados usando a sintaxe nome_parametro=valor (argumentos nomeados).",
            "button_check_keyword": "Verificar Seleção", "button_try_again": "Tentar Novamente",
            "feedback_spot_keyword_correct": "Exatamente! Você identificou todos os {count} argumentos nomeados. <i class='fas fa-key'></i>",
            "feedback_spot_keyword_incorrect": "Não exatamente. {hints}. Argumentos nomeados usam `nome=valor`.",
            "feedback_spot_hint_keyword_incorrect": "{count} seleção(ões) incorreta(s) marcada(s) com <i class=\"fas fa-times\"></i>.",
            "feedback_spot_hint_keyword_missed": "{count} argumento(s) nomeado(s) não encontrado(s) marcado(s) com <i class=\"fas fa-eye\"></i>.",
            "feedback_spot_keyword_hints_joiner": ", e ",
            "simulator_defaults_title": "Simulador: Padrões & Nomeados",
            "simulator_defaults_desc": "Abaixo está uma função `configure_system` com parâmetros padrão. Sua tarefa: Chame esta função para definir o parâmetro `retries` como `5`, mas deixe `timeout` usar seu valor padrão.",
            "simulator_defaults_defined_label": "Função Definida:",
            "simulator_defaults_editor_label": "Seu Código (Chamada de Função):", "simulator_defaults_editor_placeholder": "ex: configure_system(retries=5)",
            "button_run_sim": "Executar Simulação", "simulator_defaults_output_label": "Saída Simulada:", "simulator_output_placeholder": "A saída aparecerá aqui...",
            "feedback_simdefaults_success": "Simulação bem-sucedida! Uso correto de argumento nomeado.",
            "feedback_simdefaults_empty": "Editor vazio. Chame a função.",
            "feedback_simdefaults_no_call": "Chame `configure_system`.",
            "feedback_simdefaults_wrong_keyword": "Use o argumento nomeado `retries=5`.",
            "feedback_simdefaults_extra_args": "Você só precisa definir `retries`. `mode` e `timeout` têm padrões.",
            "feedback_simdefaults_syntax": "Verifique a sintaxe: `configure_system(retries=5)`.",
            "missions_adv_m17_title": "Mini Missões Avançadas!",
            "missions_adv_m17_desc": "Combine seu conhecimento de padrões e argumentos nomeados para resolver estes desafios.",
            "mission_adv17_1_title": "Missão 1: Saudação com Padrão",
            "mission_adv17_1_desc": "Defina uma função `greet_user(name, greeting=\"Oi\")`. Então, chame-a uma vez apenas com o nome `\"Alex\"` (usando a saudação padrão).",
            "mission_adv17_1_placeholder": "def greet_user(name, greeting=\"Oi\"):\n    print(greeting + \", \" + name)\n\ngreet_user(\"Alex\")",
            "button_test_mission_1": "Testar Missão 1",
            "mission_adv17_2_title": "Missão 2: Poder Nomeado",
            "mission_adv17_2_desc": "Uma função `set_config(ip_address, port=80, protocol=\"http\")` existe. Chame esta função fornecendo `\"192.168.1.100\"` para `ip_address` e `\"https\"` para `protocol` usando argumentos nomeados (deixe `port` usar seu padrão).",
            "mission_adv17_2_placeholder": "set_config(ip_address=\"192...\", protocol=\"https\")",
            "button_test_mission_2": "Testar Missão 2",
            "mission_adv17_3_title": "Missão 3: Plotagem Flexível",
            "mission_adv17_3_desc": "Defina `plot_data(data, color=\"blue\", linestyle=\"-\")`. Chame-a duas vezes: primeiro apenas com `my_data` (imagine que esta variável existe). Na segunda vez, chame-a com `my_data`, definindo `color` como `\"red\"` usando um argumento nomeado.",
            "mission_adv17_3_placeholder": "def plot_data(data, color=\"blue\", linestyle=\"-\"):\n    print(f\"Plotando {data} com {color}/{linestyle}\")\n\nmy_data = [1,2,3] # Assume que existe\nplot_data(my_data)\nplot_data(my_data, color=\"red\")",
            "button_test_mission_3": "Testar Missão 3",
            "feedback_mission_success": "Missão Cumprida!", "feedback_mission_syntax_error": "Erro de sintaxe ou lógica do código incorreta.",
            "feedback_mission_adv17_1_hint_def": "Verifique a definição de `greet_user` com `greeting` padrão.",
            "feedback_mission_adv17_1_hint_call": "Chame `greet_user` apenas com o argumento `name`.",
            "feedback_mission_adv17_2_hint": "Chame `set_config` usando os argumentos nomeados `ip_address=...` e `protocol=...`.",
            "feedback_mission_adv17_3_hint_def": "Verifique a definição de `plot_data` com padrões para `color` e `linestyle`.",
            "feedback_mission_adv17_3_hint_call1": "A primeira chamada deve ser apenas `plot_data(my_data)`.",
            "feedback_mission_adv17_3_hint_call2": "A segunda chamada precisa de `plot_data(my_data, color=\"red\")`.",
            "feedback_missions_adv_summary_all_done": "Todas as {totalMissions} missões avançadas completas! Você está dominando parâmetros de função como um profissional!",
            "feedback_missions_adv_summary_progress": "Completou {completedCount} de {totalMissions} missões avançadas. Continue!",
            "completion_adv_title": "Prática Avançada do Módulo 17 Completa!",
            "completion_adv_desc": "Você dominou padrões e argumentos nomeados, tornando suas chamadas de função muito mais flexíveis! Ótimo trabalho aumentando a complexidade. <span class=\"ct-badge ct-abstraction\">Abstração</span>",
            "button_back_basic": "Voltar à Prática Básica", "button_watch_video": "Ver Lição em Vídeo", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 17：高级函数参数",
            "tooltip_click_identify": "点击识别此部分",
            "tooltip_click_select": "点击选择此代码部分",
            "ct_abstraction": "抽象", "ct_decomposition": "分解",
            "nav_basic_practice": "基础练习", "nav_video": "观看视频", "nav_menu": "课程菜单",
            "nav_anatomy_default": "剖析 (默认值)", "nav_spot_keyword": "找关键字参数", "nav_simulator_defaults": "模拟器 (默认值)", "nav_missions_adv_m17": "高级任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            "header_title": "模块 17：高级参数", "header_subtitle": "探索默认值和关键字参数，实现灵活的函数。",
            "anatomy_default_title": "剖析：默认参数",
            "anatomy_default_desc": "函数可以有带默认值的可选参数。点击此定义的每个部分，看看它是如何工作的。",
            "anatomy_default_status_initial": "识别所有 9 个部分！", "anatomy_default_status_progress": "已识别 {count} / {total} 个部分。", "anatomy_default_status_done": "所有部分已识别！",
            "anatomy_adv_exp_def": "`def`：开始函数定义。",
            "anatomy_adv_exp_func_name": "`power_up`：函数名称。",
            "anatomy_adv_exp_paren_open": "`(`：开始参数列表。",
            "anatomy_adv_exp_param_req": "`character`：一个*必需*参数（调用时必须提供）。",
            "anatomy_adv_exp_comma": "`,`：分隔参数。",
            "anatomy_adv_exp_param_opt": "`level`：一个*可选*参数（有默认值）。",
            "anatomy_adv_exp_equals": "`=`：为参数分配默认值。",
            "anatomy_adv_exp_default_val": "`1`：如果调用时未提供 `level`，则其默认值为 1。",
            "anatomy_adv_exp_paren_close": "`)`：结束参数列表。",
            "anatomy_adv_exp_colon": "`:`：结束函数头。",
            "anatomy_default_comment": "# 提升能量等级",
            "feedback_anatomy_default_correct": "很好！你理解了默认参数的语法！",
            "spot_keyword_title": "找出关键字参数",
            "spot_keyword_desc": "你可以按位置或按名称（关键字）传递参数。点击下面使用 `parameter_name=value` 语法传递的参数（关键字参数）。",
            "button_check_keyword": "检查选择", "button_try_again": "再试一次",
            "feedback_spot_keyword_correct": "完全正确！你找出了所有 {count} 个关键字参数。 <i class='fas fa-key'></i>",
            "feedback_spot_keyword_incorrect": "不太对。{hints}。关键字参数使用 `name=value`。",
            "feedback_spot_hint_keyword_incorrect": "{count} 个错误选择，已用 <i class=\"fas fa-times\"></i> 标记。",
            "feedback_spot_hint_keyword_missed": "{count} 个遗漏的关键字参数，已用 <i class=\"fas fa-eye\"></i> 标记。",
            "feedback_spot_keyword_hints_joiner": "，以及 ",
            "simulator_defaults_title": "模拟器：默认值与关键字",
            "simulator_defaults_desc": "下面是一个带有默认参数的函数 `configure_system`。你的任务是：调用此函数将 `retries` 参数设置为 `5`，但让 `timeout` 使用其默认值。",
            "simulator_defaults_defined_label": "已定义函数：",
            "simulator_defaults_editor_label": "你的代码（函数调用）：", "simulator_defaults_editor_placeholder": "例如：configure_system(retries=5)",
            "button_run_sim": "运行模拟", "simulator_defaults_output_label": "模拟输出：", "simulator_output_placeholder": "输出将显示在此处...",
            "feedback_simdefaults_success": "模拟成功！正确使用了关键字参数。",
            "feedback_simdefaults_empty": "编辑器为空。请调用函数。",
            "feedback_simdefaults_no_call": "请调用 `configure_system`。",
            "feedback_simdefaults_wrong_keyword": "请使用关键字参数 `retries=5`。",
            "feedback_simdefaults_extra_args": "你只需要设置 `retries`。`mode` 和 `timeout` 有默认值。",
            "feedback_simdefaults_syntax": "检查语法：`configure_system(retries=5)`。",
            "missions_adv_m17_title": "高级迷你任务！",
            "missions_adv_m17_desc": "结合你对默认值和关键字的知识来解决这些挑战。",
            "mission_adv17_1_title": "任务 1：带默认值的问候",
            "mission_adv17_1_desc": "定义一个函数 `greet_user(name, greeting=\"Hi\")`。然后，仅用名字 `\"Alex\"` 调用它一次（使用默认问候语）。",
            "mission_adv17_1_placeholder": "def greet_user(name, greeting=\"Hi\"):\n    print(greeting + \", \" + name)\n\ngreet_user(\"Alex\")",
            "button_test_mission_1": "测试任务 1",
            "mission_adv17_2_title": "任务 2：关键字的力量",
            "mission_adv17_2_desc": "存在一个函数 `set_config(ip_address, port=80, protocol=\"http\")`。使用关键字参数调用此函数，为 `ip_address` 提供 `\"192.168.1.100\"`，为 `protocol` 提供 `\"https\"`（让 `port` 使用其默认值）。",
            "mission_adv17_2_placeholder": "set_config(ip_address=\"192...\", protocol=\"https\")",
            "button_test_mission_2": "测试任务 2",
            "mission_adv17_3_title": "任务 3：灵活绘图",
            "mission_adv17_3_desc": "定义 `plot_data(data, color=\"blue\", linestyle=\"-\")`。调用它两次：第一次只使用 `my_data`（假设此变量存在）。第二次调用时，使用 `my_data`，并使用关键字参数将 `color` 设置为 `\"red\"`。",
            "mission_adv17_3_placeholder": "def plot_data(data, color=\"blue\", linestyle=\"-\"):\n    print(f\"绘制 {data} 使用 {color}/{linestyle}\")\n\nmy_data = [1,2,3] # 假设存在\nplot_data(my_data)\nplot_data(my_data, color=\"red\")",
            "button_test_mission_3": "测试任务 3",
            "feedback_mission_success": "任务完成！", "feedback_mission_syntax_error": "语法错误或代码逻辑不正确。",
            "feedback_mission_adv17_1_hint_def": "检查带有默认 `greeting` 的 `greet_user` 定义。",
            "feedback_mission_adv17_1_hint_call": "仅使用 `name` 参数调用 `greet_user`。",
            "feedback_mission_adv17_2_hint": "使用 `ip_address=...` 和 `protocol=...` 关键字参数调用 `set_config`。",
            "feedback_mission_adv17_3_hint_def": "检查带有 `color` 和 `linestyle` 默认值的 `plot_data` 定义。",
            "feedback_mission_adv17_3_hint_call1": "第一次调用应仅为 `plot_data(my_data)`。",
            "feedback_mission_adv17_3_hint_call2": "第二次调用需要 `plot_data(my_data, color=\"red\")`。",
            "feedback_missions_adv_summary_all_done": "所有 {totalMissions} 个高级任务已完成！你像专家一样运用函数参数！",
            "feedback_missions_adv_summary_progress": "已完成 {completedCount} / {totalMissions} 个高级任务。继续努力！",
            "completion_adv_title": "模块 17 高级练习完成！",
            "completion_adv_desc": "你已经掌握了默认值和关键字参数，使你的函数调用更加灵活！在提高复杂性方面做得很好。<span class=\"ct-badge ct-abstraction\">抽象</span>",
            "button_back_basic": "返回基础练习", "button_watch_video": "观看视频课程", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Copied) ---
        function getStoredLanguage() { /* ... same ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
         }

        function setLanguage(lang) { /* ... slightly adapted ... */
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang); // Apply generic translations first

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

            // --- Re-initialize Advanced Module 17 Activities ---
            setupAnatomyDefaultActivity();
            setupSpotKeywordActivity();
            // Simulators/Missions placeholders/descriptions handled by translatePage
            if (typeof updateMissionSummaryAdvM17 === 'function') {
                 updateMissionSummaryAdvM17();
            }
         }

        function getTranslation(key, lang, replacements = {}) { /* ... same ... */
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }

        function translatePage(lang) { /* ... same ... */
              if (!translations[lang]) lang = 'en';
              document.querySelectorAll('[data-translate]').forEach(el => {
                  const key = el.getAttribute('data-translate');
                  const translation = getTranslation(key, lang);
                   if (el.tagName === 'TITLE') { document.title = translation; }
                   else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Placeholders handled below */ }
                   else if (el.tagName === 'OPTION') { el.textContent = translation; }
                   else if (el.hasAttribute('data-translate-html') || (translation.includes('<') && translation.includes('>'))) {
                      // Use innerHTML if specifically requested or if simple tags detected
                      el.innerHTML = translation;
                   } else {
                       el.textContent = translation;
                   }
              });
              document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                  const key = el.getAttribute('data-translate-placeholder');
                  const translation = getTranslation(key, lang);
                  el.setAttribute('placeholder', translation);
              });
               document.querySelectorAll('[data-translate-title]').forEach(el => {
                   const key = el.getAttribute('data-translate-title');
                   const translation = getTranslation(key, lang);
                   el.setAttribute('title', translation);
               });
         }

        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Copied) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle');
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) { /* ... same nav logic ... */
             navToggleButton.addEventListener('click', (event) => {
                 event.stopPropagation();
                 body.classList.toggle('nav-active');
                 navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active'));
              });
             document.addEventListener('click', (event) => {
                 if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target) ) {
                     body.classList.remove('nav-active');
                     navToggleButton.setAttribute('aria-expanded', 'false');
                 }
              });
             navPanel.querySelectorAll('a').forEach(link => {
                 link.addEventListener('click', () => {
                     body.classList.remove('nav-active');
                     navToggleButton.setAttribute('aria-expanded', 'false');
                 });
              });
              document.addEventListener('keydown', (event) => {
                  if (event.key === 'Escape' && body.classList.contains('nav-active')) {
                     body.classList.remove('nav-active');
                     navToggleButton.setAttribute('aria-expanded', 'false');
                  }
              });
             navToggleButton.setAttribute('aria-expanded', 'false');
        }

        // --- Language Switcher Setup (Copied) ---
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) {
            langSelect.addEventListener('change', (e) => setLanguage(e.target.value));
        }

        // --- Helper Function for Feedback (Copied) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) { /* ... same ... */
             const feedbackEl = document.getElementById(elementId);
             if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
             const currentLang = getStoredLanguage();
             const translatedMessage = getTranslation(messageKey, currentLang, replacements);
             if (translatedMessage.includes('<i class="fas') || translatedMessage.includes('<strong>') || translatedMessage.includes('<span class="ct-badge')) {
                 feedbackEl.innerHTML = translatedMessage;
             } else {
                 feedbackEl.textContent = translatedMessage;
             }
             feedbackEl.className = 'feedback-message';
             feedbackEl.classList.add('visible', type);
             const interactiveArea = feedbackEl.closest('.interactive-area');
             if (!interactiveArea) return;
             interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
             void interactiveArea.offsetWidth;
             if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
             else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
         }


        // --- Activity 1: Anatomy of Default Parameters ---
        const anatomyDefaultSection = document.getElementById('anatomy-default');
        let currentAnatomyDefaultListeners = [];
        let defaultPartExplanations = {};
        const totalDefaultAnatomyParts = 9; // def, name, (, req_param, comma, opt_param, =, default_val, ), :

        function setupAnatomyDefaultActivity() {
            if (!anatomyDefaultSection) return;
            const currentLang = getStoredLanguage();
            defaultPartExplanations = {}; // Clear previous
             document.querySelectorAll('#explanation-texts-adv-m17-anatomy span[data-key]').forEach(span => {
                const key = span.getAttribute('data-key');
                defaultPartExplanations[key] = getTranslation(`anatomy_adv_exp_${key}`, currentLang);
             });

            const parts = anatomyDefaultSection.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('anatomy-default-explanations');
            const statusP = document.getElementById('anatomy-default-status');
            const feedbackDiv = document.getElementById('anatomy-default-feedback');
            let identifiedCount = 0;

            // Remove old listeners
            currentAnatomyDefaultListeners.forEach(({element, listener}) => element.removeEventListener('click', listener));
            currentAnatomyDefaultListeners = [];

            // Reset visual state
            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.innerHTML = getTranslation('anatomy_default_status_initial', currentLang);
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

            parts.forEach(part => {
                 const clickListener = () => {
                    const partType = part.dataset.part;
                    if (!part.classList.contains('identified') && partType && defaultPartExplanations[partType]) {
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                        // Use innerHTML for potential formatting in explanations
                        p.innerHTML = `<i class="fas fa-check-circle" style="color: var(--success-color);"></i> <strong>${part.textContent.trim()}:</strong> ${defaultPartExplanations[partType]}`;
                        explanationsDiv.appendChild(p);

                        statusP.innerHTML = getTranslation('anatomy_default_status_progress', currentLang, { count: identifiedCount, total: totalDefaultAnatomyParts });

                        if (identifiedCount === totalDefaultAnatomyParts) {
                            statusP.innerHTML = getTranslation('anatomy_default_status_done', currentLang);
                            showFeedback('anatomy-default-feedback', 'feedback_anatomy_default_correct', 'correct');
                        }
                    } else if (!defaultPartExplanations[partType]) {
                        console.warn(`Explanation missing or part already identified: ${partType}`);
                    }
                 };
                part.addEventListener('click', clickListener);
                currentAnatomyDefaultListeners.push({ element: part, listener: clickListener });
            });
        }


        // --- Activity 2: Spot the Keyword Argument ---
        const spotKeywordSection = document.getElementById('spot-keyword');
        let currentKeywordSpotListeners = [];

        function setupSpotKeywordActivity() {
            if (!spotKeywordSection) return;
            const linesContainer = document.getElementById('keyword-lines');
            const checkBtn = document.getElementById('check-keyword-btn');
            const resetBtn = document.getElementById('reset-keyword-btn');
            const feedbackDiv = document.getElementById('keyword-feedback');
            const clickableCodes = linesContainer.querySelectorAll('.clickable-code');

            // Remove old listeners
            currentKeywordSpotListeners.forEach(({ element, listener }) => {
                element.removeEventListener('click', listener);
            });
            currentKeywordSpotListeners = [];

            // Reset visual state
            clickableCodes.forEach(codeEl => {
                codeEl.classList.remove('selected-visual', 'checked-state');
            });
            linesContainer.querySelectorAll('.feedback-icon-placeholder').forEach(iconEl => {
                iconEl.innerHTML = '';
                iconEl.classList.remove('visible');
            });
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
            resetBtn.classList.add('hidden');
            checkBtn.disabled = false;
            checkBtn.classList.remove('success');

            // Add new listeners
            clickableCodes.forEach(codeEl => {
                 const clickListener = () => {
                    if (codeEl.classList.contains('checked-state')) return;
                    codeEl.classList.toggle('selected-visual');
                };
                 codeEl.addEventListener('click', clickListener);
                 currentKeywordSpotListeners.push({ element: codeEl, listener: clickListener });
            });
        }

        if (spotKeywordSection) {
            const checkBtn = document.getElementById('check-keyword-btn');
            const resetBtn = document.getElementById('reset-keyword-btn');
            const linesContainer = document.getElementById('keyword-lines');

            checkBtn.addEventListener('click', () => {
                let correctKeywordSelections = 0;
                let incorrectSelections = 0; // Selected positional as keyword
                let missedKeywords = 0;
                const totalKeywords = linesContainer.querySelectorAll('.clickable-code[data-type="keyword"]').length;
                const currentLang = getStoredLanguage();

                linesContainer.querySelectorAll('.clickable-code-container').forEach(container => {
                     container.querySelectorAll('.clickable-code').forEach(codePart => {
                        const iconPlaceholder = container.querySelector('.feedback-icon-placeholder'); // Assumes one icon per line/container
                        const type = codePart.dataset.type;
                        const isSelected = codePart.classList.contains('selected-visual');

                        iconPlaceholder.innerHTML = ''; // Clear existing icons for the line
                        iconPlaceholder.classList.remove('visible');
                        codePart.classList.add('checked-state'); // Mark as checked

                        let iconClass = '';
                        if (type === 'keyword') {
                            if (isSelected) {
                                iconClass = 'fas fa-check';
                                correctKeywordSelections++;
                                iconPlaceholder.classList.add('visible');
                            } else {
                                iconClass = 'fas fa-eye'; // Missed keyword
                                missedKeywords++;
                                iconPlaceholder.classList.add('visible'); // Show missed icon too
                            }
                        } else if (type === 'positional') {
                            if (isSelected) {
                                iconClass = 'fas fa-times'; // Incorrectly selected positional
                                incorrectSelections++;
                                iconPlaceholder.classList.add('visible');
                            }
                            // No icon needed if positional and not selected
                        }

                        if (iconClass) {
                            const icon = document.createElement('i');
                            icon.className = iconClass;
                            // Append icon - might overwrite if multiple clickables per line cause issues,
                            // but for this layout it should be okay as we clear first.
                            iconPlaceholder.appendChild(icon);
                        }
                     });
                });

                const isCorrectOverall = (correctKeywordSelections === totalKeywords) && (incorrectSelections === 0);

                 if (isCorrectOverall) {
                     showFeedback('keyword-feedback', 'feedback_spot_keyword_correct', 'correct', { count: totalKeywords });
                     checkBtn.classList.add('success');
                     checkBtn.disabled = true;
                     resetBtn.classList.add('hidden');
                 } else {
                     let hints = [];
                     if (incorrectSelections > 0) {
                        hints.push(getTranslation('feedback_spot_hint_keyword_incorrect', currentLang, { count: incorrectSelections }));
                     }
                     if (missedKeywords > 0) {
                         hints.push(getTranslation('feedback_spot_hint_keyword_missed', currentLang, { count: missedKeywords }));
                     }
                     const hintText = hints.join(getTranslation('feedback_spot_keyword_hints_joiner', currentLang));

                     showFeedback('keyword-feedback', 'feedback_spot_keyword_incorrect', 'incorrect', { hints: hintText || "Check your selections." });
                     checkBtn.disabled = true;
                     resetBtn.classList.remove('hidden');
                 }
            });

            resetBtn.addEventListener('click', setupSpotKeywordActivity);
        } else {
             setupSpotKeywordActivity = () => {}; // Define empty if section doesn't exist
        }


        // --- Activity 3: Simulator (Defaults & Keywords) ---
        const simDefaultsSection = document.getElementById('simulator-defaults');
        if (simDefaultsSection) {
             const editor = document.getElementById('sim-editor-input-defaults');
             const outputArea = document.getElementById('sim-output-defaults');
             const runBtn = document.getElementById('run-defaults-sim-btn');
             const feedbackDiv = document.getElementById('sim-defaults-feedback');
             const functionName = "configure_system";

             runBtn.addEventListener('click', () => {
                 const code = editor.value.trim();
                 let placeholder = outputArea.querySelector('.placeholder');
                 outputArea.innerHTML = ''; // Clear previous output
                 if (!placeholder) {
                     placeholder = document.createElement('span');
                     placeholder.className = 'placeholder';
                     placeholder.dataset.translate = 'simulator_output_placeholder';
                 }
                 placeholder.textContent = getTranslation('simulator_output_placeholder', getStoredLanguage());
                 feedbackDiv.classList.remove('visible');

                 // Expected call: configure_system(retries=5)
                 // Regex allows optional whitespace
                 const correctCallRegex = /^\s*configure_system\s*\(\s*retries\s*=\s*5\s*\)\s*$/;
                 // Check if they provided other args unnecessarily
                 const otherArgsRegex = /mode\s*=|timeout\s*=/;

                 if (code === '') {
                     outputArea.appendChild(placeholder);
                     showFeedback('sim-defaults-feedback', 'feedback_simdefaults_empty', 'info');
                 } else if (correctCallRegex.test(code)) {
                     // Correct call simulation
                     const outputLine = document.createElement('span');
                     outputLine.classList.add('output-line');
                     outputLine.textContent = `> Mode: auto, Timeout: 30, Retries: 5`; // Simulate output
                     outputArea.appendChild(outputLine);
                     showFeedback('sim-defaults-feedback', 'feedback_simdefaults_success', 'correct');
                 } else {
                     // Incorrect call - provide hints
                     outputArea.appendChild(placeholder);
                     if (!code.includes(functionName)) {
                         showFeedback('sim-defaults-feedback', 'feedback_simdefaults_no_call', 'incorrect');
                     } else if (!code.includes('retries=5')) {
                          showFeedback('sim-defaults-feedback', 'feedback_simdefaults_wrong_keyword', 'incorrect');
                     } else if (otherArgsRegex.test(code)) {
                          showFeedback('sim-defaults-feedback', 'feedback_simdefaults_extra_args', 'incorrect');
                     } else {
                         showFeedback('sim-defaults-feedback', 'feedback_simdefaults_syntax', 'incorrect');
                     }
                 }
             });
        }


        // --- Activity 4: Mini Missions (Advanced Module 17) ---
        const missionsAdvSectionM17 = document.getElementById('mini-missions-adv-m17');
        let updateMissionSummaryAdvM17; // Define scope

        if (missionsAdvSectionM17) {
            const missionRunButtons = missionsAdvSectionM17.querySelectorAll('.mission-run-btn');
            const summaryFeedback = document.getElementById('missions-adv-m17-summary-feedback');
            const totalMissions = missionsAdvSectionM17.querySelectorAll('.mission').length;
            let completedMissionsCount = 0;

            // Simulate pre-defined functions for validation
            const simulatedAdvFunctions = {
                'set_config': function(ip_address, port=80, protocol="http") {
                    // Basic validation - just check types roughly for simulation
                     if (typeof ip_address !== 'string' || typeof port !== 'number' || typeof protocol !== 'string') {
                        return "[Error: Invalid arguments type for set_config]";
                     }
                    return `> Config set: IP=${ip_address}, Port=${port}, Protocol=${protocol}`;
                }
                // greet_user and plot_data are defined within the mission textareas
            };

            updateMissionSummaryAdvM17 = function() { // Assign function
                 completedMissionsCount = missionsAdvSectionM17.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('missions-adv-m17-summary-feedback', 'feedback_missions_adv_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('missions-adv-m17-summary-feedback', 'feedback_missions_adv_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible');
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId; // e.g., "adv-17-1"
                    const missionDiv = document.getElementById(`mission-${missionId}`);
                    if (!missionDiv) return;
                    const editor = missionDiv.querySelector('.mission-editor');
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-feedback-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    if (!feedbackDiv) { console.error(`Feedback div ${feedbackDivId} not found`); return; }
                    const statusIcon = missionDiv.querySelector('.mission-status i');
                    const code = editor.value.trim();
                    outputArea.innerHTML = ''; // Clear output
                    feedbackDiv.classList.remove('visible'); // Hide feedback

                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_syntax_error';
                    let feedbackType = 'incorrect';
                    let outputText = "";
                    let specificHintKey = '';

                    /* Adv M17 Validation Logic */
                    try {
                        const lines = code.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#')); // Ignore empty/comment lines

                        if (missionId === 'adv-17-1') {
                            // Def: greet_user(name, greeting="Hi"): print(...) ; Call: greet_user("Alex")
                            const defRegex = /^\s*def\s+greet_user\s*\(\s*name\s*,\s*greeting\s*=\s*(["'])Hi\1\s*\)\s*:/;
                            const callRegex = /^\s*greet_user\s*\(\s*(["'])Alex\1\s*\)\s*$/;
                             let defFound = lines.some(line => defRegex.test(line));
                             let callFound = lines.some(line => callRegex.test(line));

                            if (defFound && callFound) {
                                 success = true;
                                 outputText = "> Hi, Alex"; // Simulated output
                            } else if (!defFound) {
                                specificHintKey = 'feedback_mission_adv17_1_hint_def';
                            } else {
                                specificHintKey = 'feedback_mission_adv17_1_hint_call';
                            }
                        } else if (missionId === 'adv-17-2') {
                            // Call: set_config(ip_address="192...", protocol="https")
                            // Allows flexible spacing and quote types
                            const callRegex = /^\s*set_config\s*\(\s*ip_address\s*=\s*(["'])192\.168\.1\.100\1\s*,\s*protocol\s*=\s*(["'])https\2\s*\)\s*$/;
                            const callRegexAlt = /^\s*set_config\s*\(\s*protocol\s*=\s*(["'])https\1\s*,\s*ip_address\s*=\s*(["'])192\.168\.1\.100\2\s*\)\s*$/; // Allow different keyword order

                            if (callRegex.test(code) || callRegexAlt.test(code)) {
                                success = true;
                                outputText = simulatedAdvFunctions.set_config("192.168.1.100", undefined, "https"); // Port uses default in simulation too
                            } else {
                                specificHintKey = 'feedback_mission_adv17_2_hint';
                            }
                        } else if (missionId === 'adv-17-3') {
                             // Def: plot_data(data, color="blue", linestyle="-") ; Call1: plot_data(my_data) ; Call2: plot_data(my_data, color="red")
                            const defRegex = /^\s*def\s+plot_data\s*\(\s*data\s*,\s*color\s*=\s*(["'])blue\1\s*,\s*linestyle\s*=\s*(["'])-?\2\s*\)\s*:/; // Allow '-' or "-"
                            const call1Regex = /^\s*plot_data\s*\(\s*my_data\s*\)\s*$/;
                            const call2Regex = /^\s*plot_data\s*\(\s*my_data\s*,\s*color\s*=\s*(["'])red\1\s*\)\s*$/;
                            const dataDefRegex = /^\s*my_data\s*=\s*\[\s*1\s*,\s*2\s*,\s*3\s*\]\s*$/; // Check data definition roughly

                            let defFound = false, call1Found = false, call2Found = false, dataDefFound = false;
                            lines.forEach(line => {
                                if (defRegex.test(line)) defFound = true;
                                if (call1Regex.test(line)) call1Found = true;
                                if (call2Regex.test(line)) call2Found = true;
                                if (dataDefRegex.test(line)) dataDefFound = true;
                            });

                            if (defFound && call1Found && call2Found && dataDefFound) {
                                 success = true;
                                 outputText = "> Plotting [1, 2, 3] with blue/-\n> Plotting [1, 2, 3] with red/-"; // Simulated output
                            } else if (!defFound) {
                                specificHintKey = 'feedback_mission_adv17_3_hint_def';
                            } else if (!call1Found) {
                                specificHintKey = 'feedback_mission_adv17_3_hint_call1';
                            } else if (!call2Found) {
                                specificHintKey = 'feedback_mission_adv17_3_hint_call2';
                            } // Ignore missing dataDef for now as it's assumed
                        }
                    } catch (error) {
                        console.error("Adv Mission validation error:", error);
                        feedbackMessageKey = 'feedback_mission_syntax_error';
                    }
                    /* End Adv M17 Validation */

                    outputArea.textContent = outputText || getTranslation('simulator_output_placeholder', getStoredLanguage());
                    if (success) {
                        feedbackMessageKey = 'feedback_mission_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey;
                        feedbackType = 'incorrect';
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                    }
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    updateMissionSummaryAdvM17(); // Update overall progress
                });
            });
            updateMissionSummaryAdvM17(); // Initial call
        } else {
             updateMissionSummaryAdvM17 = () => {}; // Define empty if section doesn't exist
        }


        // --- Fade-in animations on scroll (Copied) ---
        const fadeElements = document.querySelectorAll('.fade-in');
        const animateOnScroll = () => { /* ... same ... */
             const windowHeight = window.innerHeight;
             fadeElements.forEach(el => {
                  if (el.style.opacity === '1') return;
                  const rect = el.getBoundingClientRect();
                  if (rect.top < windowHeight - 80 && rect.bottom >= 50) {
                      el.style.opacity = '1';
                      el.style.transform = 'translateY(0)';
                  }
             });
        };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);

        // --- Initial Setup ---
        setLanguage(initialLang); // Apply language FIRST
        animateOnScroll(); // Trigger initial animation check

        // Initial setups called by setLanguage

    }); // End DOMContentLoaded
    </script>

</body>
</html>