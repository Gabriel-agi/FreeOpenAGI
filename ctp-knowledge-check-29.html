<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 29 - OOP Intro</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca); /* Simplified header */
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Use this for correct answers? */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
             --certificate-color: #d63384; /* Ensure this is defined if used by switcher */

             /* Quiz specific */
             --option-bg-hover: #e9ecef;
             --option-bg-selected: #cfe2ff;
             --option-border-selected: var(--primary-color);
             --option-bg-correct: #d1e7dd;
             --option-border-correct: var(--success-color);
             --option-bg-incorrect: #f8d7da;
             --option-border-incorrect: var(--error-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        .quiz-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .quiz-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .header-controls {
             display: flex;
             align-items: center;
             gap: 1rem;
        }
        .return-button {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.4rem 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }
        .return-button i { margin-right: 5px; }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--text-light);
        }
         /* Language Switcher Styles (Copied and slightly adapted) */
         .language-switcher { position: relative; }
         #languageSelect {
            min-width: 130px;
            background: var(--lang-select-bg);
            color: var(--text-light); /* Light text on dark header */
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px; /* Adjust padding */
            cursor: pointer;
            font-size: 0.9rem; /* Slightly smaller */
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--text-light').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         #languageSelect:hover { background-color: var(--lang-select-bg-hover); border-color: var(--accent-color); }
         #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Quiz Container --- */
        .quiz-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1;
        }

        /* --- Quiz Area --- */
        #quiz-area { display: block; } /* Show by default */
        #question-counter {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: right;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        #question-text {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
            line-height: 1.4;
        }
        #options-container {
            display: grid;
            gap: 0.8rem;
            margin-bottom: 2rem;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 0.9rem 1.2rem;
            font-size: 1rem;
            text-align: left;
            background-color: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            line-height: 1.5;
        }
        .option-button:hover {
            background-color: var(--option-bg-hover);
            border-color: var(--secondary-color);
        }
        .option-button.selected {
            background-color: var(--option-bg-selected);
            border-color: var(--option-border-selected);
            font-weight: 500;
        }
        /* Feedback styles (applied after submission if showing answers) */
        .option-button.correct {
             background-color: var(--option-bg-correct);
             border-color: var(--option-border-correct);
             color: var(--success-color);
             font-weight: 700;
         }
         .option-button.incorrect {
             background-color: var(--option-bg-incorrect);
             border-color: var(--option-border-incorrect);
             color: var(--error-color);
             opacity: 0.8; /* Slightly fade incorrect choices */
         }
         .option-button.correct.selected { /* If user selected the correct one */
            /* Keep correct styling */
         }
         .option-button.incorrect.selected { /* If user selected an incorrect one */
            /* Keep incorrect styling, maybe add a specific icon? */
            font-weight: 500; /* Don't make selected incorrect bold */
         }


        .quiz-navigation {
            display: flex;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        .quiz-button {
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s ease;
        }
        .quiz-button:disabled {
            background-color: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.7;
        }
        #next-submit-button {
            background-color: var(--primary-color);
            color: var(--text-light);
        }
        #next-submit-button:not(:disabled):hover {
            background-color: #0b5ed7;
            transform: scale(1.02);
        }

        /* --- Results Area --- */
        #results-area {
            display: none; /* Hide by default */
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: #f8f9fa;
            text-align: center;
        }
        #results-area h2 {
            font-family: var(--font-title);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        #score-display {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
         #score-display .final-score { color: var(--check-color); }
         #score-display .total-questions { color: var(--text-muted); }
        #result-message {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
            padding: 0.8rem;
            border-radius: 5px;
        }
        #result-message.passed {
            color: var(--success-color);
            background-color: var(--option-bg-correct);
            border: 1px solid var(--success-color);
        }
         #result-message.failed {
            color: var(--error-color);
            background-color: var(--option-bg-incorrect);
            border: 1px solid var(--error-color);
         }
        .result-info {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }
        #retry-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
        }
         #retry-button:hover {
            background-color: #5a6268;
            transform: scale(1.02);
         }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1rem; margin-top: 2rem;
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .quiz-header h1 { font-size: 1.4rem; }
            .quiz-container { margin: 1.5rem; padding: 1.5rem; }
            #question-text { font-size: 1.2rem; }
            .option-button { padding: 0.8rem 1rem; font-size: 0.95rem; }
            .header-controls { gap: 0.8rem; }
            .return-button { font-size: 0.85rem; padding: 0.3rem 0.6rem; }
             #languageSelect { min-width: 110px; font-size: 0.85rem; padding: 5px 25px 5px 10px; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .quiz-header { padding: 0.8rem 1rem; flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .quiz-header h1 { font-size: 1.3rem; margin-bottom: 0.5rem; }
            .header-controls { width: 100%; justify-content: space-between; }
            .quiz-container { margin: 1rem; padding: 1rem; }
            #question-text { font-size: 1.1rem; }
            .option-button { padding: 0.7rem 0.9rem; font-size: 0.9rem; }
            .quiz-button { font-size: 0.95rem; padding: 0.6rem 1.2rem; }
            #results-area h2 { font-size: 1.6rem; }
            #score-display { font-size: 1.3rem; }
            #result-message { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <header class="quiz-header">
        <h1 data-translate="quiz_header_title">Module 29: OOP Intro</h1>
        <div class="header-controls">
            <a href="ctp-dashboard.html" class="return-button">
                <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
            </a>
            <div class="language-switcher">
                <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                    <option value="en" data-translate="lang_en">🇬🇧 English</option>
                    <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                    <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                </select>
            </div>
        </div>
    </header>

    <main class="quiz-container">
        <div id="quiz-area">
            <div id="question-counter">Question 1 / 10</div>
            <h2 id="question-text">Loading question...</h2>
            <div id="options-container">
                <!-- Option buttons will be loaded here by JS -->
            </div>
            <div class="quiz-navigation">
                <button id="next-submit-button" class="quiz-button" disabled data-translate="next_button">Next Question</button>
            </div>
        </div>

        <div id="results-area">
            <h2 data-translate="results_title">Quiz Complete!</h2>
            <div id="score-display">
                <span data-translate="results_score_label">Your Score:</span>
                <span class="final-score">0</span> / <span class="total-questions">10</span>
            </div>
            <div id="result-message" class="">
                <!-- Pass/Fail message loaded here -->
            </div>
            <p class="result-info" data-translate="pass_info">You need 6 out of 10 questions correct to pass.</p>
            <button id="retry-button" class="quiz-button" data-translate="retry_button">Retry Quiz</button>
        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 29;
        const TOTAL_QUESTIONS = 10;
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Question Data (Module 29: OOP Intro) ---
        // Using keys for translation lookup
        const quizData = [
            { // 1
                question_key: "m29_q1",
                options_keys: ["m29_q1_opt1", "m29_q1_opt2", "m29_q1_opt3", "m29_q1_opt4"],
                correct_answer_key: "m29_q1_opt1" // The *key* of the correct option
            },
            { // 2
                question_key: "m29_q2",
                options_keys: ["m29_q2_opt1", "m29_q2_opt2", "m29_q2_opt3", "m29_q2_opt4"],
                correct_answer_key: "m29_q2_opt2"
            },
            { // 3
                question_key: "m29_q3",
                options_keys: ["m29_q3_opt1", "m29_q3_opt2", "m29_q3_opt3", "m29_q3_opt4"],
                correct_answer_key: "m29_q3_opt3"
            },
            { // 4
                question_key: "m29_q4",
                options_keys: ["m29_q4_opt1", "m29_q4_opt2", "m29_q4_opt3", "m29_q4_opt4"],
                correct_answer_key: "m29_q4_opt1"
            },
            { // 5
                question_key: "m29_q5",
                options_keys: ["m29_q5_opt1", "m29_q5_opt2", "m29_q5_opt3", "m29_q5_opt4"],
                correct_answer_key: "m29_q5_opt4"
            },
            { // 6
                question_key: "m29_q6",
                options_keys: ["m29_q6_opt1", "m29_q6_opt2", "m29_q6_opt3", "m29_q6_opt4"],
                correct_answer_key: "m29_q6_opt1"
            },
            { // 7
                question_key: "m29_q7",
                options_keys: ["m29_q7_opt1", "m29_q7_opt2", "m29_q7_opt3", "m29_q7_opt4"],
                correct_answer_key: "m29_q7_opt2"
            },
            { // 8
                question_key: "m29_q8",
                options_keys: ["m29_q8_opt1", "m29_q8_opt2", "m29_q8_opt3", "m29_q8_opt4"],
                correct_answer_key: "m29_q8_opt3"
            },
            { // 9
                question_key: "m29_q9",
                options_keys: ["m29_q9_opt1", "m29_q9_opt2", "m29_q9_opt3", "m29_q9_opt4"],
                correct_answer_key: "m29_q9_opt4"
            },
            { // 10
                question_key: "m29_q10",
                options_keys: ["m29_q10_opt1", "m29_q10_opt2", "m29_q10_opt3", "m29_q10_opt4"],
                correct_answer_key: "m29_q10_opt1"
            }
        ];

        // --- Translations Object ---
        const translations = {
            en: {
                "page_title": "Knowledge Check: Module 29 - OOP Intro",
                "quiz_header_title": "Module 29: OOP Intro",
                "return_button": "Return to Dashboard",
                "lang_select_aria": "Select Language",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "question_counter_text": "Question {current} / {total}",
                "next_button": "Next Question",
                "submit_button": "Submit Quiz",
                "results_title": "Quiz Complete!",
                "results_score_label": "Your Score:",
                "pass_info": "You need {required} out of {total} questions correct to pass.",
                "result_message_passed": "Congratulations! You passed! Progress saved.",
                "result_message_failed": "Keep trying! You didn't pass this time, but you can retry.",
                "retry_button": "Retry Quiz",
                "footer_text": "Part of the Road to Free Open AGI Project",
                // Module 29 Questions & Options (English)
                "m29_q1": "What keyword is used to define a blueprint for creating objects in Python?",
                "m29_q1_opt1": "class", "m29_q1_opt2": "def", "m29_q1_opt3": "object", "m29_q1_opt4": "struct",
                "m29_q2": "What is the term for creating a specific object from a class blueprint?",
                "m29_q2_opt1": "Defining", "m29_q2_opt2": "Instantiation", "m29_q2_opt3": "Declaration", "m29_q2_opt4": "Construction",
                "m29_q3": "What is the special method used to initialize the state of a new object when it's created?",
                "m29_q3_opt1": "__new__()", "m29_q3_opt2": "initialize()", "m29_q3_opt3": "__init__()", "m29_q3_opt4": "setup()",
                "m29_q4": "What is the conventional name for the first parameter of any method within a class, which refers to the instance itself?",
                "m29_q4_opt1": "self", "m29_q4_opt2": "this", "m29_q4_opt3": "instance", "m29_q4_opt4": "object",
                "m29_q5": "Variables that belong to an instance of a class are called:",
                "m29_q5_opt1": "Class variables", "m29_q5_opt2": "Global variables", "m29_q5_opt3": "Static variables", "m29_q5_opt4": "Instance attributes (or variables)",
                "m29_q6": "Consider `my_car = Car()`. What is `my_car` in this context?",
                "m29_q6_opt1": "An instance (or object) of the Car class", "m29_q6_opt2": "The Car class itself", "m29_q6_opt3": "A method of the Car class", "m29_q6_opt4": "A function call",
                "m29_q7": "How would you typically access an attribute named `color` of an instance `my_car`?",
                "m29_q7_opt1": "my_car(color)", "m29_q7_opt2": "my_car.color", "m29_q7_opt3": "color(my_car)", "m29_q7_opt4": "my_car['color']",
                "m29_q8": "Functions defined inside a class are called:",
                "m29_q8_opt1": "Procedures", "m29_q8_opt2": "Functions", "m29_q8_opt3": "Methods", "m29_q8_opt4": "Lambdas",
                "m29_q9": "What is the primary purpose of using classes and objects?",
                "m29_q9_opt1": "To make code run faster", "m29_q9_opt2": "To reduce the number of lines of code", "m29_q9_opt3": "To handle mathematical calculations", "m29_q9_opt4": "To model real-world entities and organize code",
                "m29_q10": "In the `__init__` method, what does `self.name = name` typically do?",
                "m29_q10_opt1": "Assigns the value of the parameter `name` to an instance attribute called `name`", "m29_q10_opt2": "Compares `self.name` with the parameter `name`", "m29_q10_opt3": "Creates a new local variable called `name`", "m29_q10_opt4": "Calls a method named `name` on the instance"
            },
            pt: {
                "page_title": "Verificação de Conhecimento: Módulo 29 - Intro POO",
                "quiz_header_title": "Módulo 29: Intro POO",
                "return_button": "Voltar ao Painel",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "question_counter_text": "Questão {current} / {total}",
                "next_button": "Próxima Questão",
                "submit_button": "Enviar Quiz",
                "results_title": "Quiz Concluído!",
                "results_score_label": "Sua Pontuação:",
                "pass_info": "Você precisa de {required} de {total} questões corretas para passar.",
                "result_message_passed": "Parabéns! Você passou! Progresso salvo.",
                "result_message_failed": "Continue tentando! Você não passou desta vez, mas pode tentar novamente.",
                "retry_button": "Tentar Novamente",
                "footer_text": "Parte do Projeto Road to Free Open AGI",
                // Module 29 Questions & Options (Portuguese)
                "m29_q1": "Qual palavra-chave é usada para definir um modelo (blueprint) para criar objetos em Python?",
                "m29_q1_opt1": "class", "m29_q1_opt2": "def", "m29_q1_opt3": "object", "m29_q1_opt4": "struct",
                "m29_q2": "Qual é o termo para criar um objeto específico a partir de um modelo de classe?",
                "m29_q2_opt1": "Definir", "m29_q2_opt2": "Instanciação", "m29_q2_opt3": "Declaração", "m29_q2_opt4": "Construção",
                "m29_q3": "Qual método especial é usado para inicializar o estado de um novo objeto quando ele é criado?",
                "m29_q3_opt1": "__new__()", "m29_q3_opt2": "initialize()", "m29_q3_opt3": "__init__()", "m29_q3_opt4": "setup()",
                "m29_q4": "Qual é o nome convencional para o primeiro parâmetro de qualquer método dentro de uma classe, que se refere à própria instância?",
                "m29_q4_opt1": "self", "m29_q4_opt2": "this", "m29_q4_opt3": "instance", "m29_q4_opt4": "object",
                "m29_q5": "Variáveis que pertencem a uma instância de uma classe são chamadas de:",
                "m29_q5_opt1": "Variáveis de classe", "m29_q5_opt2": "Variáveis globais", "m29_q5_opt3": "Variáveis estáticas", "m29_q5_opt4": "Atributos (ou variáveis) de instância",
                "m29_q6": "Considere `meu_carro = Carro()`. O que é `meu_carro` neste contexto?",
                "m29_q6_opt1": "Uma instância (ou objeto) da classe Carro", "m29_q6_opt2": "A própria classe Carro", "m29_q6_opt3": "Um método da classe Carro", "m29_q6_opt4": "Uma chamada de função",
                "m29_q7": "Como você normalmente acessaria um atributo chamado `cor` de uma instância `meu_carro`?",
                "m29_q7_opt1": "meu_carro(cor)", "m29_q7_opt2": "meu_carro.cor", "m29_q7_opt3": "cor(meu_carro)", "m29_q7_opt4": "meu_carro['cor']",
                "m29_q8": "Funções definidas dentro de uma classe são chamadas de:",
                "m29_q8_opt1": "Procedimentos", "m29_q8_opt2": "Funções", "m29_q8_opt3": "Métodos", "m29_q8_opt4": "Lambdas",
                "m29_q9": "Qual é o propósito principal de usar classes e objetos?",
                "m29_q9_opt1": "Para fazer o código rodar mais rápido", "m29_q9_opt2": "Para reduzir o número de linhas de código", "m29_q9_opt3": "Para lidar com cálculos matemáticos", "m29_q9_opt4": "Para modelar entidades do mundo real e organizar o código",
                "m29_q10": "No método `__init__`, o que `self.nome = nome` normalmente faz?",
                "m29_q10_opt1": "Atribui o valor do parâmetro `nome` a um atributo de instância chamado `nome`", "m29_q10_opt2": "Compara `self.nome` com o parâmetro `nome`", "m29_q10_opt3": "Cria uma nova variável local chamada `nome`", "m29_q10_opt4": "Chama um método chamado `nome` na instância"
            },
            zh: {
                "page_title": "知识测验：模块 29 - 面向对象入门",
                "quiz_header_title": "模块 29: 面向对象入门",
                "return_button": "返回仪表板",
                "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                "question_counter_text": "问题 {current} / {total}",
                "next_button": "下一题",
                "submit_button": "提交测验",
                "results_title": "测验完成！",
                "results_score_label": "你的分数:",
                "pass_info": "你需要答对 {total} 题中的 {required} 题才能通过。",
                "result_message_passed": "恭喜！你通过了！进度已保存。",
                "result_message_failed": "再接再厉！这次你没有通过，但可以重试。",
                "retry_button": "重试测验",
                "footer_text": "通往自由开放AGI之路项目的一部分",
                // Module 29 Questions & Options (Chinese)
                "m29_q1": "在 Python 中，使用哪个关键字来定义创建对象的蓝图？",
                "m29_q1_opt1": "class", "m29_q1_opt2": "def", "m29_q1_opt3": "object", "m29_q1_opt4": "struct",
                "m29_q2": "根据类蓝图创建特定对象的过程叫什么？",
                "m29_q2_opt1": "定义 (Defining)", "m29_q2_opt2": "实例化 (Instantiation)", "m29_q2_opt3": "声明 (Declaration)", "m29_q2_opt4": "构造 (Construction)",
                "m29_q3": "用于在创建新对象时初始化其状态的特殊方法是什么？",
                "m29_q3_opt1": "__new__()", "m29_q3_opt2": "initialize()", "m29_q3_opt3": "__init__()", "m29_q3_opt4": "setup()",
                "m29_q4": "类中任何方法的第一个参数，用于引用实例本身的约定名称是什么？",
                "m29_q4_opt1": "self", "m29_q4_opt2": "this", "m29_q4_opt3": "instance", "m29_q4_opt4": "object",
                "m29_q5": "属于类实例的变量被称为：",
                "m29_q5_opt1": "类变量", "m29_q5_opt2": "全局变量", "m29_q5_opt3": "静态变量", "m29_q5_opt4": "实例属性（或变量）",
                "m29_q6": "考虑 `my_car = Car()`。在这个上下文中 `my_car` 是什么？",
                "m29_q6_opt1": "Car 类的一个实例（或对象）", "m29_q6_opt2": "Car 类本身", "m29_q6_opt3": "Car 类的一个方法", "m29_q6_opt4": "一个函数调用",
                "m29_q7": "你通常如何访问实例 `my_car` 的名为 `color` 的属性？",
                "m29_q7_opt1": "my_car(color)", "m29_q7_opt2": "my_car.color", "m29_q7_opt3": "color(my_car)", "m29_q7_opt4": "my_car['color']",
                "m29_q8": "在类内部定义的函数被称为：",
                "m29_q8_opt1": "过程 (Procedures)", "m29_q8_opt2": "函数 (Functions)", "m29_q8_opt3": "方法 (Methods)", "m29_q8_opt4": "Lambda 表达式",
                "m29_q9": "使用类和对象的主要目的是什么？",
                "m29_q9_opt1": "使代码运行更快", "m29_q9_opt2": "减少代码行数", "m29_q9_opt3": "处理数学计算", "m29_q9_opt4": "模拟现实世界实体并组织代码",
                "m29_q10": "在 `__init__` 方法中，`self.name = name` 通常做什么？",
                "m29_q10_opt1": "将参数 `name` 的值赋给名为 `name` 的实例属性", "m29_q10_opt2": "将 `self.name` 与参数 `name` 进行比较", "m29_q10_opt3": "创建一个名为 `name` 的新局部变量", "m29_q10_opt4": "在实例上调用名为 `name` 的方法"
            }
        };

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let userAnswers = {}; // Store selected answer *key* for each question index
        let score = 0;
        let currentLanguage = 'en'; // Default language

        // --- DOM Elements ---
        const questionCounterEl = document.getElementById('question-counter');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const nextSubmitButtonEl = document.getElementById('next-submit-button');
        const quizAreaEl = document.getElementById('quiz-area');
        const resultsAreaEl = document.getElementById('results-area');
        const scoreDisplayEl = document.getElementById('score-display');
        const resultMessageEl = document.getElementById('result-message');
        const retryButtonEl = document.getElementById('retry-button');
        const languageSelectEl = document.getElementById('languageSelect');
        const passInfoEl = document.querySelector('.result-info');

        // --- Translation Functions ---
         function getStoredLanguage() {
             const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
             if (storedLang && translations[storedLang]) return storedLang;
             const browserLang = navigator.language || navigator.userLanguage;
             if (browserLang.startsWith('pt')) return 'pt';
             if (browserLang.startsWith('zh')) return 'zh';
             return 'en';
         }

         function setLanguage(lang) {
             if (!translations[lang]) lang = 'en'; // Fallback
             currentLanguage = lang;
             localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
             document.documentElement.lang = lang;
             if (languageSelectEl) languageSelectEl.value = lang; // Update dropdown
             translatePage(lang);
             // Re-display current question/results with new language if quiz is active/finished
             if (quizAreaEl.style.display !== 'none') {
                 displayQuestion();
             } else if (resultsAreaEl.style.display !== 'none') {
                 // Re-display results text in new language
                 displayResults(); // Need to adjust this to just update text
             }
         }

         function getTranslation(key, lang, replacements = {}) {
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
             for (const placeholder in replacements) {
                 const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }

         function translatePage(lang) {
             // Translate static elements with data-translate attribute
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang, { required: PASSING_SCORE, total: TOTAL_QUESTIONS }); // Add replacements for pass_info
                 if (el.tagName === 'TITLE') {
                     document.title = translation;
                 } else if (key === 'pass_info') { // Handle specific element update
                      el.textContent = translation;
                 } else if (translation.includes('<') && translation.includes('>')) {
                     // Be careful with innerHTML on user-generated content
                     // For controlled translations, it might be okay
                     el.innerHTML = translation;
                 } else {
                     el.textContent = translation;
                 }
             });
             // Translate elements with data-translate-aria-label
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang));
             });

             // Update dynamic button text (Next/Submit) if quiz is active
             if (quizAreaEl.style.display !== 'none') {
                 updateNextSubmitButtonText();
             }
             // Update results text if results are showing
             if (resultsAreaEl.style.display !== 'none') {
                 const isPassed = score >= PASSING_SCORE;
                 resultMessageEl.textContent = getTranslation(isPassed ? "result_message_passed" : "result_message_failed", lang);
             }
         }

        // --- Quiz Logic ---
        function initQuiz() {
            currentLanguage = getStoredLanguage();
            languageSelectEl.value = currentLanguage;
            document.documentElement.lang = currentLanguage;

            currentQuestionIndex = 0;
            userAnswers = {};
            score = 0;

            quizAreaEl.style.display = 'block';
            resultsAreaEl.style.display = 'none';
            nextSubmitButtonEl.disabled = true;

            translatePage(currentLanguage); // Translate static elements first
            displayQuestion(); // Display the first question (includes translation)
        }

        function displayQuestion() {
            if (currentQuestionIndex >= TOTAL_QUESTIONS) {
                calculateAndShowResults();
                return;
            }

            const questionData = quizData[currentQuestionIndex];
            const lang = currentLanguage;

            // Update question counter
            questionCounterEl.textContent = getTranslation("question_counter_text", lang, {
                current: currentQuestionIndex + 1,
                total: TOTAL_QUESTIONS
            });

            // Update question text
            questionTextEl.textContent = getTranslation(questionData.question_key, lang);

            // Clear previous options and create new ones
            optionsContainerEl.innerHTML = '';
            questionData.options_keys.forEach(optionKey => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = getTranslation(optionKey, lang);
                button.dataset.key = optionKey; // Store the option key
                button.addEventListener('click', handleAnswerSelection);
                optionsContainerEl.appendChild(button);
            });

             // Check if an answer was previously selected for this question (e.g., when changing language)
             const previouslySelectedKey = userAnswers[currentQuestionIndex];
             if (previouslySelectedKey) {
                 const selectedButton = optionsContainerEl.querySelector(`[data-key="${previouslySelectedKey}"]`);
                 if (selectedButton) {
                     selectedButton.classList.add('selected');
                     nextSubmitButtonEl.disabled = false; // Re-enable button if answer was already selected
                 } else {
                     nextSubmitButtonEl.disabled = true; // Disable if previous selection is somehow invalid now
                 }
             } else {
                 nextSubmitButtonEl.disabled = true; // Disable button for new questions
             }

            updateNextSubmitButtonText();
        }

        function updateNextSubmitButtonText() {
             const lang = currentLanguage;
             if (currentQuestionIndex === TOTAL_QUESTIONS - 1) {
                 nextSubmitButtonEl.textContent = getTranslation("submit_button", lang);
             } else {
                 nextSubmitButtonEl.textContent = getTranslation("next_button", lang);
             }
         }


        function handleAnswerSelection(event) {
            const selectedButton = event.target;
            const selectedKey = selectedButton.dataset.key;

            // Remove 'selected' class from all buttons in this question
            optionsContainerEl.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add 'selected' class to the clicked button
            selectedButton.classList.add('selected');

            // Store the selected answer key
            userAnswers[currentQuestionIndex] = selectedKey;

            // Enable the Next/Submit button
            nextSubmitButtonEl.disabled = false;
        }

        function handleNextSubmit() {
            // Optional: Add feedback for the current question before moving on
            // This version calculates score only at the end.

            currentQuestionIndex++;
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                displayQuestion();
            } else {
                calculateAndShowResults();
            }
        }

         function calculateAndShowResults() {
             score = 0;
             for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                 const questionData = quizData[i];
                 const userAnswerKey = userAnswers[i];
                 if (userAnswerKey && userAnswerKey === questionData.correct_answer_key) {
                     score++;
                 }
             }
             displayResults(); // Call a separate function to handle DOM updates for results
             saveProgressIfPassed();
         }

         function displayResults() {
             const lang = currentLanguage;
             const isPassed = score >= PASSING_SCORE;

             // Update score display
             scoreDisplayEl.querySelector('.final-score').textContent = score;
             scoreDisplayEl.querySelector('.total-questions').textContent = TOTAL_QUESTIONS;

             // Update result message and styling
             resultMessageEl.textContent = getTranslation(isPassed ? "result_message_passed" : "result_message_failed", lang);
             resultMessageEl.className = isPassed ? 'passed' : 'failed'; // Set class for styling

            // Update pass info text (if not already handled by translatePage)
            passInfoEl.textContent = getTranslation("pass_info", lang, { required: PASSING_SCORE, total: TOTAL_QUESTIONS });

             // Show results, hide quiz
             quizAreaEl.style.display = 'none';
             resultsAreaEl.style.display = 'block';
         }


        function saveProgressIfPassed() {
            if (score >= PASSING_SCORE) {
                try {
                    const storedStatusRaw = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                    let knowledgeCheckStatus = {};
                     // Safely parse JSON
                     if (storedStatusRaw) {
                         try {
                             const parsed = JSON.parse(storedStatusRaw);
                              if (typeof parsed === 'object' && parsed !== null) {
                                  knowledgeCheckStatus = parsed;
                              } else {
                                   console.warn("Invalid KC status found in localStorage, resetting.");
                              }
                         } catch (e) {
                             console.error("Error parsing KC status from localStorage, resetting.", e);
                         }
                     }

                    knowledgeCheckStatus[MODULE_ID] = true; // Mark this module as passed
                    localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(knowledgeCheckStatus));
                    console.log(`Module ${MODULE_ID} KC passed. Progress saved.`);

                } catch (e) {
                    console.error("Could not save progress to localStorage:", e);
                    // Optionally inform the user that progress couldn't be saved
                    const lang = currentLanguage;
                     // A simple alert, or better, a non-intrusive message on the page
                     alert(getTranslation("error_saving_progress", lang) || "Error: Could not save your progress. Please ensure localStorage is enabled.");
                }
            }
        }

         // Add a fallback translation for the saving error
         translations.en["error_saving_progress"] = "Error: Could not save your progress. Please ensure localStorage is enabled.";
         translations.pt["error_saving_progress"] = "Erro: Não foi possível salvar seu progresso. Verifique se o localStorage está habilitado.";
         translations.zh["error_saving_progress"] = "错误：无法保存您的进度。请确保 localStorage 已启用。";


        // --- Event Listeners ---
        nextSubmitButtonEl.addEventListener('click', handleNextSubmit);
        retryButtonEl.addEventListener('click', initQuiz);
        languageSelectEl.addEventListener('change', (e) => {
            setLanguage(e.target.value);
        });

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', initQuiz);

    </script>

</body>
</html>