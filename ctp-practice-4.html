<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Module 4: User Input Practice</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Same as Module 0) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-light: #f8f9fa;
            --background-medium: #e9ecef;
            --background-dark: #343a40;
            --text-light: #f8f9fa;
            --text-dark: #212529;
            --accent-color: #ffc107; /* Yellow */
            --success-color: #28a745; /* Green */
            --error-color: #dc3545;   /* Red */
            --info-color: #17a2b8;    /* Teal */
            --border-radius: 8px;
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --selection-highlight-bg: rgba(0, 123, 255, 0.1);
            --selection-highlight-border: rgba(0, 123, 255, 0.4);
            /* Colors matching news.html for consistency */
            --nav-primary: #6e48aa;
            --nav-success: #4cc9f0;
            --nav-dark: #1a1a2e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.7;
            background-color: var(--background-light); color: var(--text-dark);
            overflow-x: hidden;
        }

        /* --- Utility Classes (Same as Module 0) --- */
        .container { max-width: 960px; margin: 0 auto; padding: 0 15px; }
        .text-center { text-align: center; }
        .highlight { color: var(--primary-color); font-weight: bold; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .hidden { display: none !important; }
        .button-group {
            margin-top: 2rem; display: flex; flex-wrap: wrap;
            justify-content: center; gap: 1rem;
        }

        /* --- Advanced Animations (Same as Module 0) --- */
        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.8s ease-out forwards; }
        .fade-in.delay-1 { animation-delay: 0.2s; } .fade-in.delay-2 { animation-delay: 0.4s; }
        .fade-in.delay-3 { animation-delay: 0.6s; } .fade-in.delay-4 { animation-delay: 0.8s; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseHeaderIcon { 0% { transform: scale(1); opacity: 0.1; } 50% { transform: scale(1.05); opacity: 0.25; } 100% { transform: scale(1); opacity: 0.1; } }
        @keyframes successGlow { 0% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); } 50% { box-shadow: 0 0 12px 5px rgba(40, 167, 69, 0.5); } 100% { box-shadow: 0 0 3px rgba(40, 167, 69, 0.3); } }
        .success-glow-anim { animation: successGlow 0.9s ease-out; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(3px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-5px, 0, 0); } 40%, 60% { transform: translate3d(5px, 0, 0); } }
        .shake-anim { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes iconAppearCorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 60% { transform: scale(1.2) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearIncorrect { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 50% { transform: scale(1.2) rotate(10deg); opacity: 1; } 70% { transform: scale(0.9) rotate(-5deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        @keyframes iconAppearMissed { 0% { transform: scale(0.8) rotateY(90deg); opacity: 0; } 100% { transform: scale(1) rotateY(0deg); opacity: 0.8; } }
        .action-button:active:not(:disabled) { transform: translateY(1px) scale(0.98); filter: brightness(0.95); }

        /* --- Minimal Retractable Nav (Same as Module 0, with Language Switcher) --- */
        .minimal-nav-button { position: fixed; top: 15px; right: 15px; z-index: 1001; background-color: rgba(52, 58, 64, 0.75); color: var(--text-light); border: none; border-radius: var(--border-radius); padding: 8px 12px; cursor: pointer; transition: background-color var(--transition-speed), opacity var(--transition-speed), transform var(--transition-speed); font-size: 1.1rem; opacity: 0.6; box-shadow: 0 2px 5px rgba(0,0,0,0.2); line-height: 1; }
        .minimal-nav-button:hover { background-color: rgba(52, 58, 64, 0.95); opacity: 1; transform: scale(1.05); }
        .minimal-nav { position: fixed; top: 60px; right: 15px; z-index: 1000; background-color: var(--background-dark); border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); padding: 0.8rem; opacity: 0; transform: translateY(-15px) scale(0.95); transform-origin: top right; pointer-events: none; transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; min-width: 200px; }
        body.nav-active .minimal-nav { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        .minimal-nav ul { list-style: none; margin: 0; padding: 0; }
        .minimal-nav ul li { margin-bottom: 5px; }
        .minimal-nav ul li:last-child { margin-bottom: 0; }
        .minimal-nav ul li a { display: flex; align-items: center; color: var(--text-light); text-decoration: none; padding: 0.6rem 1rem; border-radius: 4px; transition: background-color var(--transition-speed), color var(--transition-speed); white-space: nowrap; font-weight: 400; font-size: 0.95rem; }
        .minimal-nav ul li a i.fas { margin-right: 10px; width: 1.2em; text-align: center; opacity: 0.8; transition: opacity var(--transition-speed); }
        .minimal-nav ul li a:hover { background-color: var(--primary-color); color: var(--text-light); }
        .minimal-nav ul li a:hover i.fas { opacity: 1; }
        .minimal-nav .language-switcher-item { padding: 0.5rem 1rem; border-top: 1px solid var(--secondary-color); margin-top: 8px; padding-top: 13px; }
        #languageSelect { width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--nav-success); border-radius: 5px; padding: 6px 30px 6px 12px; cursor: pointer; font-size: 0.9rem; appearance: none; -webkit-appearance: none; -moz-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234CC9F0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 10px center; background-size: 10px auto; transition: background-color 0.3s ease; }
        #languageSelect:hover { background-color: rgba(255,255,255,0.15); }
        #languageSelect option { background: var(--nav-dark); color: var(--text-light); }

        /* --- Practice Header (Module 4 Theme) --- */
        .practice-header { background: linear-gradient(135deg, var(--info-color), #0a6b7b); color: var(--text-light); padding: 3rem 0 4rem; text-align: center; position: relative; overflow: hidden; border-bottom: 5px solid var(--accent-color); }
        .practice-header h1 { font-family: var(--font-title); font-size: 2.8rem; margin-bottom: 0.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); animation: fadeInAnimation 1s ease-out; }
        .practice-header p { font-size: 1.1rem; font-weight: 300; opacity: 0.9; animation: fadeInAnimation 1s ease-out 0.3s forwards; opacity: 0; }
        .header-icon { position: absolute; font-size: 4rem; color: var(--text-light); animation: pulseHeaderIcon 6s infinite ease-in-out alternate; }
        .icon1 { top: 20%; left: 15%; animation-duration: 7s; } /* Keyboard */
        .icon2 { bottom: 15%; right: 20%; animation-duration: 5s; } /* User icon */

        /* --- Practice Section Styling (Same as Module 0) --- */
        .practice-section { padding: 3rem 0; background-color: var(--background-medium); border-bottom: 1px solid #d6d8db; }
        .practice-section:nth-child(odd) { background-color: var(--background-light); }
        .practice-section:last-of-type { border-bottom: none; }
        .practice-section h2 { font-family: var(--font-title); font-size: 1.8rem; color: var(--primary-color); margin-bottom: 1rem; text-align: center; }
        .practice-section .section-description { text-align: center; margin-bottom: 2.5rem; color: var(--secondary-color); font-size: 1.05rem; max-width: 700px; margin-left: auto; margin-right: auto; }

        /* --- General Interactive Elements (Same as Module 0) --- */
        .interactive-area { background-color: #fff; padding: 2rem; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-top: 1.5rem; position: relative; transition: box-shadow 0.5s ease-out; }
        .feedback-message { padding: 0.8rem 1rem; margin-top: 1rem; border-radius: var(--border-radius); font-weight: bold; text-align: center; opacity: 0; max-height: 0; overflow: hidden; transition: opacity var(--transition-speed) ease, max-height var(--transition-speed) ease, margin-top var(--transition-speed) ease; }
        .feedback-message.visible { opacity: 1; max-height: 100px; margin-top: 1.5rem; }
        .feedback-message.correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .feedback-message.incorrect { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .feedback-message.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .feedback-message .fas { margin: 0 3px; }
        .action-button { display: inline-block; padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: bold; color: var(--text-light); background-color: var(--primary-color); border: none; border-radius: var(--border-radius); cursor: pointer; transition: background-color var(--transition-speed), transform var(--transition-speed), filter var(--transition-speed), box-shadow var(--transition-speed); margin-top: 1rem; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-decoration: none; }
        .action-button:hover:not(:disabled) { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .action-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .action-button.success { background-color: var(--success-color); }
        .action-button.success:hover:not(:disabled) { background-color: #218838; }
        .action-button.secondary { background-color: var(--secondary-color); }
        .action-button.secondary:hover:not(:disabled) { background-color: #5a6268; }
        .code-block { background-color: var(--background-dark); color: var(--text-light); padding: 1.5rem; border-radius: var(--border-radius); font-family: var(--code-font); font-size: 1rem; position: relative; overflow-x: auto; margin: 1rem 0; }
        .code-keyword { color: #569cd6; } .code-string { color: #ce9178; } .code-comment { color: #6a9955; } .code-function { color: #dcdcaa; } .code-paren { color: #ffd700; } .code-variable { color: #9cdcfe; } .code-operator { color: #d4d4d4; }

        /* --- Activity 1: Anatomy of input() --- */
        #anatomy-input .code-part { cursor: pointer; border-bottom: 2px dashed rgba(255, 255, 255, 0.3); transition: background-color var(--transition-speed), border-bottom-color var(--transition-speed); padding: 0 2px; display: inline-block; }
        #anatomy-input .code-part:hover { background-color: rgba(255, 255, 255, 0.15); border-bottom-color: var(--accent-color); }
        #anatomy-input .code-part.identified { background-color: rgba(40, 167, 69, 0.3); border-bottom: 2px solid var(--success-color); cursor: default; }
        .part-explanation { font-size: 0.95rem; color: var(--info-color); border-left: 3px solid var(--info-color); padding: 5px 10px; margin-top: 0.5rem; background-color: rgba(23, 162, 184, 0.05); }
        #anatomy-status-input { margin-top: 1rem; font-style: italic; color: var(--secondary-color); }

        /* --- Activity 2: Input/Output Flow --- */
        #input-flow .sim-editor { width: 100%; min-height: 50px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-bottom: 1rem; }
        #input-flow .sim-input-entry { display: flex; align-items: center; gap: 10px; margin-top: 0.5rem; margin-bottom: 1rem; }
        #input-flow .sim-input-entry label { font-weight: bold; color: var(--secondary-color); white-space: nowrap; }
        #input-flow .sim-input-entry input[type="text"] { flex-grow: 1; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-family: var(--code-font); font-size: 1rem; background-color: var(--background-light); color: var(--text-dark); }
        #input-flow .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--text-light); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #input-flow .sim-output-area .prompt { color: var(--accent-color); display: inline; } /* Style for the input prompt */
        #input-flow .sim-output-area .user-input-display { color: var(--success-color); font-style: italic; display: inline;} /* Style for simulated user entry display */
        #input-flow .sim-output-area .output-line { display: block; color: #dcdcaa; margin-top: 5px; } /* Style for final print output */
        #input-flow .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }

        /* --- Activity 3: Type Mystery --- */
        #type-mystery .mystery-case { margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #ddd; border-radius: var(--border-radius); background-color: var(--background-light); }
        #type-mystery .code-block { margin-bottom: 1rem; }
        #type-mystery h4 { margin-bottom: 0.8rem; color: var(--primary-color); }
        #type-mystery .options label { display: block; margin-bottom: 0.5rem; cursor: pointer; padding: 8px 12px; border-radius: 4px; transition: background-color 0.2s ease; }
        #type-mystery .options label:hover { background-color: var(--background-medium); }
        #type-mystery .options input[type="radio"] { margin-right: 8px; vertical-align: middle; }
        #type-mystery .explanation { margin-top: 1rem; font-size: 0.95rem; padding: 0.8rem 1rem; border-radius: 4px; border-left: 4px solid; }
        #type-mystery .explanation.correct { border-color: var(--success-color); background-color: #d4edda; color: #155724; }
        #type-mystery .explanation.incorrect { border-color: var(--error-color); background-color: #f8d7da; color: #721c24; }

        /* --- Activity 4: Conversion Practice --- */
        #conversion-practice .sim-editor { width: 100%; min-height: 80px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; }
        #conversion-practice .sim-input-entry { /* Reusing styles from Activity 2 */ display: flex; align-items: center; gap: 10px; margin-top: 0.5rem; margin-bottom: 1rem; }
        #conversion-practice .sim-input-entry label { font-weight: bold; color: var(--secondary-color); white-space: nowrap; }
        #conversion-practice .sim-input-entry input[type="text"] { flex-grow: 1; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-family: var(--code-font); font-size: 1rem; background-color: var(--background-light); color: var(--text-dark); }
        #conversion-practice .sim-output-area { margin-top: 1rem; min-height: 50px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 1rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1.05rem; white-space: pre-wrap; word-wrap: break-word; }
        #conversion-practice .sim-output-area .placeholder { color: var(--secondary-color); font-style: italic; font-size: 0.9rem; }
        #conversion-practice .sim-output-area .output-line { display: block; }
        #conversion-practice .sim-output-area .prompt { color: var(--accent-color); display: inline; }
        #conversion-practice .sim-output-area .user-input-display { color: var(--success-color); font-style: italic; display: inline;}

        /* --- Activity 5: Mini Missions (Input Theme - Same CSS structure as Mod 0) --- */
        #mini-missions-input .mission { padding: 1.5rem; border: 1px solid #d6d8db; border-radius: var(--border-radius); margin-bottom: 1.5rem; background-color: var(--background-light); position: relative; }
        .mission-status { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; transition: transform 0.3s ease; }
        .mission-status .fa-check-circle { color: var(--success-color); transform-origin: center; }
        .mission-status .fa-times-circle { color: var(--error-color); }
        .mission-status .fa-question-circle { color: var(--secondary-color); }
        .mission[data-completed="true"] .mission-status .fa-check-circle { animation: iconAppearCorrect 0.6s ease-out; }
        #mini-missions-input .mission-editor { width: 100%; min-height: 100px; background-color: var(--background-dark); color: var(--text-light); border: 1px solid var(--secondary-color); border-radius: var(--border-radius); padding: 1rem; font-family: var(--code-font); font-size: 1rem; line-height: 1.5; resize: vertical; margin-top: 1rem; margin-bottom: 1rem; }
        #mini-missions-input .sim-input-entry { /* Reusing styles */ display: flex; align-items: center; gap: 10px; margin-top: 0; margin-bottom: 1rem; }
        #mini-missions-input .sim-input-entry label { font-weight: bold; color: var(--secondary-color); white-space: nowrap; }
        #mini-missions-input .sim-input-entry input[type="text"] { flex-grow: 1; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-family: var(--code-font); font-size: 1rem; background-color: var(--background-light); color: var(--text-dark); }
        #mini-missions-input .mission-output { margin-top: 1rem; min-height: 30px; background-color: #1a1a1a; border: 1px solid #444; border-radius: var(--border-radius); padding: 0.8rem; color: var(--accent-color); font-family: var(--code-font); font-size: 1rem; white-space: pre-wrap; word-wrap: break-word; }
        #mini-missions-input .mission-output .prompt { color: var(--accent-color); display: inline; }
        #mini-missions-input .mission-output .user-input-display { color: var(--success-color); font-style: italic; display: inline;}
        #mini-missions-input .mission-output .output-line { display: block; color: #dcdcaa; }

        /* --- Final Section (Same as Module 0) --- */
        .completion-section { padding: 4rem 0; text-align: center; }
        .completion-section .icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; display: inline-block; opacity: 0; animation: iconAppearCorrect 1s ease-out 0.5s forwards; }
        .completion-section h2 { font-family: var(--font-title); font-size: 2.2rem; color: var(--primary-color); }
        .completion-section p { font-size: 1.1rem; margin-top: 1rem; color: var(--secondary-color); }

        /* --- Responsive Design (Same as Module 0) --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .practice-header h1 { font-size: 2.2rem; }
            .practice-section h2 { font-size: 1.6rem; }
            .interactive-area { padding: 1.5rem; }
            .button-group { flex-direction: column; align-items: center; }
            .minimal-nav { min-width: 180px; }
            .minimal-nav ul li a { padding: 0.6rem 0.8rem; }
            #languageSelect { font-size: 0.85rem; padding: 5px 25px 5px 10px;}
            #input-flow .sim-input-entry, #conversion-practice .sim-input-entry, #mini-missions-input .sim-input-entry { flex-direction: column; align-items: flex-start; gap: 5px; }
            #input-flow .sim-input-entry input, #conversion-practice .sim-input-entry input, #mini-missions-input .sim-input-entry input { width: 100%; }
        }
        @media (max-width: 480px) {
            html { font-size: 14px; }
            .practice-header h1 { font-size: 1.8rem; }
            .practice-header p { font-size: 1rem; }
            .practice-section h2 { font-size: 1.4rem; }
            .interactive-area { padding: 1rem; }
            .action-button { font-size: 0.9rem; padding: 0.7rem 1.2rem; width: 90%; max-width: 300px;}
            .code-block, .sim-editor, .sim-output-area, .mission-editor, .mission-output { font-size: 0.9rem; }
            #mini-missions-input .mission-editor { min-height: 90px; }
            .button-group a.action-button { width: 90%; max-width: 300px; margin-bottom: 0.5rem; }
            .minimal-nav-button { top: 10px; right: 10px; padding: 6px 10px; font-size: 1rem; }
            .minimal-nav { top: 48px; right: 10px; min-width: 160px; }
            .minimal-nav ul li a { padding: 0.5rem 0.7rem; font-size: 0.9rem;}
            .minimal-nav ul li a i.fas { margin-right: 8px; }
            #languageSelect { font-size: 0.8rem; padding: 4px 20px 4px 8px;}
        }
    </style>
</head>
<body>

    <!-- ========= Minimal Nav Handle ========= -->
    <button id="minimal-nav-toggle" class="minimal-nav-button" aria-label="Toggle Navigation Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ========= Minimal Nav Panel (with Language Switcher) ========= -->
    <nav id="minimal-nav-panel" class="minimal-nav">
        <ul>
            <!-- *** MODIFIED: Links updated to Module 4 *** -->
            <li><a href="ctp-theory-4.html"><i class="fas fa-book-open fa-fw"></i> <span data-translate="nav_theory">View Theory</span></a></li>
            <li><a href="ctp-advanced-4.html"><i class="fas fa-flask fa-fw"></i> <span data-translate="nav_advanced">Advanced Practice</span></a></li>
            <li><a href="ctp-dashboard.html"><i class="fas fa-list fa-fw"></i> <span data-translate="nav_menu">Course Menu</span></a></li>
            <hr style="border: none; border-top: 1px solid var(--secondary-color); margin: 8px 0;">
            <!-- *** MODIFIED: Nav links for Module 4 activities *** -->
            <li><a href="#anatomy-input"><i class="fas fa-microscope fa-fw"></i> <span data-translate="nav_anatomy_input">Anatomy</span></a></li>
            <li><a href="#input-flow"><i class="fas fa-exchange-alt fa-fw"></i> <span data-translate="nav_flow">Input Flow</span></a></li>
            <li><a href="#type-mystery"><i class="fas fa-question-circle fa-fw"></i> <span data-translate="nav_mystery">Type Mystery</span></a></li>
            <li><a href="#conversion-practice"><i class="fas fa-cogs fa-fw"></i> <span data-translate="nav_conversion">Conversion</span></a></li>
            <li><a href="#mini-missions-input"><i class="fas fa-rocket fa-fw"></i> <span data-translate="nav_missions">Missions</span></a></li>
            <!-- Language Switcher Item -->
            <li class="language-switcher-item">
                 <select id="languageSelect" aria-label="Select Language">
                     <option value="en" data-translate="lang_en">🇬🇧 English</option>
                     <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                     <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
                 </select>
            </li>
        </ul>
    </nav>

    <!-- ========= Header ========= -->
    <header class="practice-header">
        <!-- *** MODIFIED: Icons changed for Module 4 theme *** -->
        <i class="fas fa-keyboard header-icon icon1"></i>
        <i class="fas fa-user-edit header-icon icon2"></i>
        <div class="container">
            <!-- *** MODIFIED: Header text updated for Module 4 *** -->
            <h1 data-translate="header_title">Module 4: User Input Practice</h1>
            <p data-translate="header_subtitle">Let's practice interacting with the user and handling their input!</p>
        </div>
    </header>

    <!-- ========= Main Content ========= -->
    <main>
        <!-- ========= Activity 1: Anatomy of input() ========= -->
        <section id="anatomy-input" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-microscope"></i> <span data-translate="anatomy_input_title">Anatomy of Getting Input</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="anatomy_input_desc">
                     The `input()` function lets your program ask the user for information. Click the parts below to identify them.
                     <br>Focus: <strong class="highlight">Interaction</strong>.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <div class="code-block">
                        <span class="code-part" data-part="variable" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-variable">user_name</span></span><!--
                         --><span class="code-part" data-part="assignment" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-operator"> = </span></span><!--
                         --><span class="code-part" data-part="function" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-function">input</span></span><!--
                         --><span class="code-part" data-part="parentheses-open" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-paren">(</span></span><!--
                         --><span class="code-part" data-part="prompt-string" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-string" data-translate="anatomy_input_code_prompt">"Enter your name: "</span></span><!-- *** MODIFIED: Added data-translate *** -->
                         <span class="code-part" data-part="parentheses-close" data-translate-title="tooltip_click_identify" title="Click to identify this part"><span class="code-paren">)</span></span>
                     </div>
                     <div id="anatomy-explanations-input"></div>
                     <p id="anatomy-status-input" data-translate="anatomy_status_initial_input">Identify all 6 parts!</p>
                     <div id="anatomy-feedback-input" class="feedback-message"></div>
                     <!-- Hidden elements for storing translated explanation parts -->
                     <div id="explanation-texts-input" style="display: none;">
                        <span data-key="variable" data-translate="anatomy_exp_variable">A variable (`user_name`): Stores the data received from the user.</span>
                        <span data-key="assignment" data-translate="anatomy_exp_assignment">Assignment operator (`=`): Puts the result of `input()` into the variable.</span>
                        <span data-key="function" data-translate="anatomy_exp_input_function">The `input` function: Pauses and waits for user text entry.</span>
                        <span data-key="parentheses-open" data-translate="anatomy_exp_paren_open_input">Opening parenthesis `(`: Starts the options for the `input` function.</span>
                        <span data-key="prompt-string" data-translate="anatomy_exp_prompt">A "string" prompt: Text displayed to the user to ask for input.</span>
                        <span data-key="parentheses-close" data-translate="anatomy_exp_paren_close_input">Closing parenthesis `)`: Ends the options for the `input` function.</span>
                     </div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 2: Input/Output Flow ========= -->
        <section id="input-flow" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-exchange-alt"></i> <span data-translate="flow_title">Input & Output Flow</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="flow_desc">
                     See how `input()` works with `print()`. Write code to ask for a favorite color, then print a message using it.
                     Enter a sample color in the "Simulated Input" box *before* running.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="flow-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="flow_editor_label">Code Editor:</label>
                     <textarea id="flow-editor-input" class="sim-editor" rows="4" data-translate-placeholder="flow_editor_placeholder" placeholder='color = input("Fav color? ")\nprint("Cool, I like " + color + " too!")'></textarea>

                     <div class="sim-input-entry">
                         <label for="flow-sim-input" data-translate="flow_sim_input_label">Simulated Input:</label>
                         <input type="text" id="flow-sim-input" data-translate-placeholder="flow_sim_input_placeholder" placeholder="e.g., blue">
                     </div>

                     <div class="text-center">
                          <button id="run-flow-btn" class="action-button" data-translate="button_run_flow">Run Simulation</button>
                     </div>

                     <label style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="flow_output_label">Simulated Output:</label>
                     <div id="flow-output" class="sim-output-area">
                         <span class="placeholder" data-translate="flow_output_placeholder">Output appears here...</span>
                     </div>
                     <div id="flow-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>

        <!-- ========= Activity 3: Type Mystery ========= -->
        <section id="type-mystery" class="practice-section">
            <div class="container">
                <h2 class="fade-in"><i class="fas fa-question-circle"></i> <span data-translate="mystery_title">The Type Mystery</span></h2>
                <p class="section-description fade-in delay-1" data-translate="mystery_desc">
                    `input()` always gives back text (a string), even if the user types numbers! This can cause surprises. Predict the outcome for each case below.
                    <br>Focus: <strong class="highlight">Data Manipulation (Types)</strong>.
                </p>
                <div class="interactive-area fade-in delay-2">
                    <!-- Case 1: String Concatenation -->
                    <div class="mystery-case" id="mystery-case-1">
                        <h4 data-translate="mystery_case1_title">Case 1: Adding Numbers?</h4>
                        <p data-translate="mystery_case1_desc">Imagine the user enters '5' when asked for `num1` and '3' for `num2`.</p>
                        <div class="code-block">
<span class="code-variable">num1_str</span> <span class="code-operator">=</span> <span class="code-function">input</span><span class="code-paren">(</span><span class="code-string">"Enter first number: "</span><span class="code-paren">)</span>
<span class="code-variable">num2_str</span> <span class="code-operator">=</span> <span class="code-function">input</span><span class="code-paren">(</span><span class="code-string">"Enter second number: "</span><span class="code-paren">)</span>
<span class="code-variable">result</span> <span class="code-operator">=</span> <span class="code-variable">num1_str</span> <span class="code-operator">+</span> <span class="code-variable">num2_str</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-variable">result</span><span class="code-paren">)</span>
                        </div>
                        <p><strong data-translate="mystery_question">What will be printed?</strong></p>
                        <div class="options">
                            <label><input type="radio" name="mystery1" value="8"> 8</label>
                            <label><input type="radio" name="mystery1" value="53" data-correct="true"> 53</label>
                            <label><input type="radio" name="mystery1" value="error"> An Error Message</label>
                        </div>
                        <div class="text-center"> <button class="action-button check-mystery-btn" data-case="1" data-translate="button_check_answer">Check Answer</button> </div>
                        <div id="mystery-feedback-1" class="feedback-message"></div>
                        <div id="mystery-explanation-1" class="explanation hidden"></div>
                    </div>

                    <!-- Case 2: Introducing int() -->
                    <div class="mystery-case" id="mystery-case-2">
                        <h4 data-translate="mystery_case2_title">Case 2: The Fix with `int()`</h4>
                         <p data-translate="mystery_case2_desc">Now we use `int()` to convert the input. User enters '10' then '4'.</p>
                        <div class="code-block">
<span class="code-variable">num1_str</span> <span class="code-operator">=</span> <span class="code-function">input</span><span class="code-paren">(</span><span class="code-string">"Enter first number: "</span><span class="code-paren">)</span>
<span class="code-variable">num2_str</span> <span class="code-operator">=</span> <span class="code-function">input</span><span class="code-paren">(</span><span class="code-string">"Enter second number: "</span><span class="code-paren">)</span>
<span class="code-variable">num1_int</span> <span class="code-operator">=</span> <span class="code-function">int</span><span class="code-paren">(</span><span class="code-variable">num1_str</span><span class="code-paren">)</span> <span class="code-comment"># Convert to integer</span>
<span class="code-variable">num2_int</span> <span class="code-operator">=</span> <span class="code-function">int</span><span class="code-paren">(</span><span class="code-variable">num2_str</span><span class="code-paren">)</span> <span class="code-comment"># Convert to integer</span>
<span class="code-variable">result</span> <span class="code-operator">=</span> <span class="code-variable">num1_int</span> <span class="code-operator">+</span> <span class="code-variable">num2_int</span>
<span class="code-function">print</span><span class="code-paren">(</span><span class="code-variable">result</span><span class="code-paren">)</span>
                        </div>
                         <p><strong data-translate="mystery_question">What will be printed?</strong></p>
                        <div class="options">
                            <label><input type="radio" name="mystery2" value="104"> 104</label>
                            <label><input type="radio" name="mystery2" value="error"> An Error Message</label>
                             <label><input type="radio" name="mystery2" value="14" data-correct="true"> 14</label>
                        </div>
                         <div class="text-center"> <button class="action-button check-mystery-btn" data-case="2" data-translate="button_check_answer">Check Answer</button> </div>
                        <div id="mystery-feedback-2" class="feedback-message"></div>
                        <div id="mystery-explanation-2" class="explanation hidden"></div>
                    </div>
                    <!-- Hidden Explanation Texts -->
                    <div id="mystery-explanation-texts" style="display: none;">
                        <span data-case="1" data-correct="true" data-translate="mystery_exp_1_correct">Correct! Without conversion, '+' joins strings ('5' + '3' becomes '53'). This is string concatenation.</span>
                        <span data-case="1" data-correct="false" data-translate="mystery_exp_1_incorrect">Not quite. `input()` gives strings. '+' on strings joins them, not adds mathematically. Try again!</span>
                        <span data-case="2" data-correct="true" data-translate="mystery_exp_2_correct">Exactly! `int()` converts the string input ('10', '4') into numbers (10, 4), so '+' performs mathematical addition (10 + 4 = 14).</span>
                        <span data-case="2" data-correct="false" data-translate="mystery_exp_2_incorrect">Think about what `int()` does. It converts the text from `input()` into actual numbers before the addition happens.</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========= Activity 4: Conversion Practice ========= -->
        <section id="conversion-practice" class="practice-section">
             <div class="container">
                 <h2 class="fade-in"><i class="fas fa-cogs"></i> <span data-translate="conversion_title">Practice Type Conversion</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="conversion_desc">
                     Now you try! Write code to ask the user for their birth year. Convert it to an integer using `int()`, calculate their approximate age in 2024, and print the age. Use the simulator below.
                     <br>Focus: <strong class="highlight">Interaction</strong> & <strong class="highlight">Data Manipulation</strong>.
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <label for="conversion-editor-input" style="font-weight: bold; display:block; margin-bottom: 8px;" data-translate="conversion_editor_label">Code Editor:</label>
                     <textarea id="conversion-editor-input" class="sim-editor" rows="5" data-translate-placeholder="conversion_editor_placeholder" placeholder='year_str = input("Birth Year: ")\nyear_int = int(year_str)\nage = 2024 - year_int\nprint(age)'></textarea>

                     <div class="sim-input-entry">
                         <label for="conversion-sim-input" data-translate="conversion_sim_input_label">Simulated Input (Year):</label>
                         <input type="text" id="conversion-sim-input" data-translate-placeholder="conversion_sim_input_placeholder" placeholder="e.g., 1995">
                     </div>

                     <div class="text-center">
                          <button id="run-conversion-btn" class="action-button" data-translate="button_run_conversion">Run Simulation</button>
                     </div>

                     <label for="conversion-output" style="font-weight: bold; display:block; margin-top: 1.5rem; margin-bottom: 8px;" data-translate="conversion_output_label">Simulated Output:</label>
                     <div id="conversion-output" class="sim-output-area">
                         <span class="placeholder" data-translate="conversion_output_placeholder">Output will appear here...</span>
                     </div>
                     <div id="conversion-feedback" class="feedback-message"></div>
                 </div>
             </div>
        </section>


         <!-- ========= Activity 5: Mini Missions (Input Theme) ========= -->
        <section id="mini-missions-input" class="practice-section">
             <div class="container">
                  <h2 class="fade-in"><i class="fas fa-rocket"></i> <span data-translate="missions_input_title">Input Mini Missions!</span></h2>
                 <p class="section-description fade-in delay-1" data-translate="missions_input_desc">
                     Combine `input()` and type conversion to solve these tasks. Enter sample input before testing each mission!
                 </p>
                 <div class="interactive-area fade-in delay-2">
                     <!-- Mission 1 -->
                     <div class="mission" id="mission-input-1" data-completed="false">
                         <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_input1_title">Mission 1: Simple Greeting</h4>
                         <p data-translate="mission_input1_desc">Ask the user for their name and print a greeting like "Hello, [Name]!". (No type conversion needed here!)</p>
                         <textarea class="mission-editor" rows="4" data-translate-placeholder="mission_input1_placeholder" placeholder='name = input("Name? ")\nprint("Hello, " + name + "!")'></textarea>
                         <div class="sim-input-entry">
                             <label for="mission-input-1-sim" data-translate="mission_input_sim_label">Simulated Name:</label>
                             <input type="text" id="mission-input-1-sim" data-translate-placeholder="mission_input_sim_placeholder_name" placeholder="e.g., Ada">
                         </div>
                         <div class="text-center"> <button class="action-button mission-run-btn-input" data-mission-id="1" data-translate="button_test_mission_1">Test Mission 1</button> </div>
                         <div class="mission-output"></div>
                         <div id="mission-feedback-input-1" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 2 -->
                     <div class="mission" id="mission-input-2" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_input2_title">Mission 2: Age Next Year</h4>
                         <p data-translate="mission_input2_desc">Ask the user for their current age (as a number). Convert it to an integer using `int()` and print their age next year.</p>
                         <textarea class="mission-editor" rows="4" data-translate-placeholder="mission_input2_placeholder" placeholder='age_str = input("Age? ")\nage_int = int(age_str)\nprint(age_int + 1)'></textarea>
                         <div class="sim-input-entry">
                             <label for="mission-input-2-sim" data-translate="mission_input_sim_label">Simulated Age:</label>
                             <input type="text" id="mission-input-2-sim" data-translate-placeholder="mission_input_sim_placeholder_age" placeholder="e.g., 30">
                         </div>
                          <div class="text-center"> <button class="action-button mission-run-btn-input" data-mission-id="2" data-translate="button_test_mission_2">Test Mission 2</button> </div>
                         <div class="mission-output"></div>
                         <div id="mission-feedback-input-2" class="feedback-message mission-feedback"></div>
                     </div>
                     <!-- Mission 3 -->
                     <div class="mission" id="mission-input-3" data-completed="false">
                          <span class="mission-status"><i class="fas fa-question-circle"></i></span>
                         <h4 data-translate="mission_input3_title">Mission 3: Price + Tax</h4>
                         <p data-translate="mission_input3_desc">Ask for an item price (can have decimals). Convert it to a float using `float()`. Calculate a 10% tax (price * 0.10) and print *only* the tax amount.</p>
                         <textarea class="mission-editor" rows="5" data-translate-placeholder="mission_input3_placeholder" placeholder='price_str = input("Price? ")\nprice_float = float(price_str)\ntax = price_float * 0.10\nprint(tax)'></textarea>
                          <div class="sim-input-entry">
                             <label for="mission-input-3-sim" data-translate="mission_input_sim_label">Simulated Price:</label>
                             <input type="text" id="mission-input-3-sim" data-translate-placeholder="mission_input_sim_placeholder_price" placeholder="e.g., 49.95">
                         </div>
                          <div class="text-center"> <button class="action-button mission-run-btn-input" data-mission-id="3" data-translate="button_test_mission_3">Test Mission 3</button> </div>
                         <div class="mission-output"></div>
                         <div id="mission-feedback-input-3" class="feedback-message mission-feedback"></div>
                     </div>
                     <div id="missions-summary-feedback-input" class="feedback-message" style="margin-top: 2rem;"></div>
                 </div>
             </div>
        </section>

         <!-- ========= Completion Section ========= -->
        <section class="completion-section">
            <div class="container">
                <!-- Using input/user related icons -->
                <div class="icon fade-in" style="animation: iconAppearCorrect 1s ease-out 0.5s forwards;">
                     <i class="fas fa-keyboard"></i> <i class="fas fa-check-double"></i> <i class="fas fa-user-check"></i>
                </div>
                <h2 class="fade-in delay-1" data-translate="completion_title">Module 4 Practice Complete!</h2>
                <p class="fade-in delay-2" data-translate="completion_desc">
                    Excellent work! You've practiced getting user input and handling different data types. <br>
                    Ready for a bigger challenge? Try the <strong>Advanced Practice</strong> for Module 4!
                </p>
                <div class="button-group">
                     <!-- *** MODIFIED: Links updated to Module 4 *** -->
                    <a href="ctp-theory-4.html" class="action-button secondary fade-in delay-3"><i class="fas fa-book-open"></i> <span data-translate="button_view_theory">View Theory Again</span></a>
                    <a href="ctp-advanced-4.html" class="action-button success fade-in delay-3"><i class="fas fa-arrow-right"></i> <span data-translate="button_start_advanced">Start Advanced Practice</span></a>
                    <a href="ctp-dashboard.html" class="action-button secondary fade-in delay-4"><i class="fas fa-list"></i> <span data-translate="button_back_menu">Back to Course Menu</span></a>
                </div>
            </div>
        </section>
    </main>

    <!-- ========= Script ========= -->
    <script>
    // --- Translations Object ---
    const translations = {
        en: {
            "page_title": "Module 4: User Input Practice",
            "tooltip_click_identify": "Click to identify this part",
            // Nav
            "nav_theory": "View Theory", "nav_advanced": "Advanced Practice", "nav_menu": "Course Menu",
            "nav_anatomy_input": "Anatomy", "nav_flow": "Input Flow", "nav_mystery": "Type Mystery", "nav_conversion": "Conversion", "nav_missions": "Missions",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "Module 4: User Input Practice", "header_subtitle": "Let's practice interacting with the user and handling their input!",
            // Activity 1: Anatomy
            "anatomy_input_title": "Anatomy of Getting Input", "anatomy_input_desc": "The `input()` function lets your program ask the user for information. Click the parts below to identify them.<br>Focus: <strong class=\"highlight\">Interaction</strong>.",
            "anatomy_input_code_prompt": "\"Enter your name: \"",
            "anatomy_exp_variable": "A variable (`user_name`): Stores the data received from the user.",
            "anatomy_exp_assignment": "Assignment operator (`=`): Puts the result of `input()` into the variable.",
            "anatomy_exp_input_function": "The `input` function: Pauses and waits for user text entry.",
            "anatomy_exp_paren_open_input": "Opening parenthesis `(`: Starts the options for the `input` function.",
            "anatomy_exp_prompt": "A \"string\" prompt: Text displayed to the user to ask for input.",
            "anatomy_exp_paren_close_input": "Closing parenthesis `)`: Ends the options for the `input` function.",
            "anatomy_status_initial_input": "Identify all 6 parts!", "anatomy_status_progress_input": "Identified {count} of {total} parts.", "anatomy_status_done_input": "All parts identified!",
            "feedback_anatomy_input_correct": "Great! You've dissected the input statement!",
            // Activity 2: Flow
            "flow_title": "Input & Output Flow", "flow_desc": "See how `input()` works with `print()`. Write code to ask for a favorite color, then print a message using it. Enter a sample color in the \"Simulated Input\" box *before* running.",
            "flow_editor_label": "Code Editor:", "flow_editor_placeholder": "color = input(\"Fav color? \")\\nprint(\"Cool, I like \" + color + \" too!\")",
            "flow_sim_input_label": "Simulated Input:", "flow_sim_input_placeholder": "e.g., blue",
            "button_run_flow": "Run Simulation", "flow_output_label": "Simulated Output:", "flow_output_placeholder": "Output appears here...",
            "feedback_flow_success": "Simulation successful! Input used.", "feedback_flow_no_input_call": "Code doesn't seem to use `input()`.", "feedback_flow_no_print_call": "Code doesn't seem to use `print()` after input.", "feedback_flow_no_sim_input": "Please enter simulated input first.", "feedback_flow_general_error": "Check your code structure (input then print).",
             "feedback_flow_var_not_used": "Make sure the variable holding the input result is used in the print statement.",
            // Activity 3: Mystery
            "mystery_title": "The Type Mystery", "mystery_desc": "`input()` always gives back text (a string), even if the user types numbers! This can cause surprises. Predict the outcome for each case below.<br>Focus: <strong class=\"highlight\">Data Manipulation (Types)</strong>.",
            "mystery_case1_title": "Case 1: Adding Numbers?", "mystery_case1_desc": "Imagine the user enters '5' when asked for `num1` and '3' for `num2`.",
            "mystery_case2_title": "Case 2: The Fix with `int()`", "mystery_case2_desc": "Now we use `int()` to convert the input. User enters '10' then '4'.",
            "mystery_question": "What will be printed?", "button_check_answer": "Check Answer",
            "feedback_mystery_correct": "Correct!", "feedback_mystery_incorrect": "Not quite right. Think about data types.", "feedback_mystery_select_answer": "Please select an answer first.",
            "mystery_exp_1_correct": "Correct! Without conversion, '+' joins strings ('5' + '3' becomes '53'). This is string concatenation.",
            "mystery_exp_1_incorrect": "Not quite. `input()` gives strings. '+' on strings joins them, not adds mathematically. Try again!",
            "mystery_exp_2_correct": "Exactly! `int()` converts the string input ('10', '4') into numbers (10, 4), so '+' performs mathematical addition (10 + 4 = 14).",
            "mystery_exp_2_incorrect": "Think about what `int()` does. It converts the text from `input()` into actual numbers before the addition happens.",
            // Activity 4: Conversion
            "conversion_title": "Practice Type Conversion", "conversion_desc": "Now you try! Write code to ask the user for their birth year. Convert it to an integer using `int()`, calculate their approximate age in 2024, and print the age. Use the simulator below.<br>Focus: <strong class=\"highlight\">Interaction</strong> & <strong class=\"highlight\">Data Manipulation</strong>.",
            "conversion_editor_label": "Code Editor:", "conversion_editor_placeholder": "year_str = input(\"Birth Year: \")\\nyear_int = int(year_str)\\nage = 2024 - year_int\\nprint(age)",
            "conversion_sim_input_label": "Simulated Input (Year):", "conversion_sim_input_placeholder": "e.g., 1995",
            "button_run_conversion": "Run Simulation", "conversion_output_label": "Simulated Output:", "conversion_output_placeholder": "Output will appear here...",
            "feedback_conversion_success": "Simulation successful! Conversion used correctly.", "feedback_conversion_no_int": "Missing `int()` conversion.", "feedback_conversion_no_input": "Missing `input()` call.", "feedback_conversion_no_print": "Missing `print()` call.", "feedback_conversion_no_sim_input": "Please enter a simulated year first.", "feedback_conversion_wrong_logic": "Check calculation or print logic.", "feedback_conversion_general_error": "Check code: input -> int() -> calculate -> print.",
            // Activity 5: Missions
            "missions_input_title": "Input Mini Missions!", "missions_input_desc": "Combine `input()` and type conversion to solve these tasks. Enter sample input before testing each mission!",
            "mission_input_sim_label": "Simulated Input:", "mission_input_sim_placeholder_name": "e.g., Ada", "mission_input_sim_placeholder_age": "e.g., 30", "mission_input_sim_placeholder_price": "e.g., 49.95",
            "mission_input1_title": "Mission 1: Simple Greeting", "mission_input1_desc": "Ask the user for their name and print a greeting like \"Hello, [Name]!\". (No type conversion needed here!)", "mission_input1_placeholder": "name = input(\"Name? \")\\nprint(\"Hello, \" + name + \"!\")",
            "button_test_mission_1": "Test Mission 1",
            "mission_input2_title": "Mission 2: Age Next Year", "mission_input2_desc": "Ask the user for their current age (as a number). Convert it to an integer using `int()` and print their age next year.", "mission_input2_placeholder": "age_str = input(\"Age? \")\\nage_int = int(age_str)\\nprint(age_int + 1)",
            "button_test_mission_2": "Test Mission 2",
            "mission_input3_title": "Mission 3: Price + Tax", "mission_input3_desc": "Ask for an item price (can have decimals). Convert it to a float using `float()`. Calculate a 10% tax (price * 0.10) and print *only* the tax amount.", "mission_input3_placeholder": "price_str = input(\"Price? \")\\nprice_float = float(price_str)\\ntax = price_float * 0.10\\nprint(tax)",
            "button_test_mission_3": "Test Mission 3",
            "feedback_mission_input_success": "Mission Accomplished!", "feedback_mission_input_syntax_error": "Syntax/logic error.", "feedback_mission_input_no_sim_input": "Enter simulated input first!", "feedback_mission_input_conversion_fail": "Conversion failed. Did user enter valid input type?",
            "feedback_mission1_input_hint": "Need `input()` and `print()` with concatenation (+).",
            "feedback_mission2_input_hint": "Need `input()`, `int()`, add 1, then `print()`.",
            "feedback_mission3_input_hint": "Need `input()`, `float()`, multiply by 0.10, then `print()` tax.",
            "feedback_missions_input_summary_all_done": "All {totalMissions} input missions complete! Great job!", "feedback_missions_input_summary_progress": "Completed {completedCount} of {totalMissions} input missions. Keep going!",
            // Completion
            "completion_title": "Module 4 Practice Complete!", "completion_desc": "Excellent work! You've practiced getting user input and handling different data types. <br> Ready for a bigger challenge? Try the <strong>Advanced Practice</strong> for Module 4!",
            "button_view_theory": "View Theory Again", "button_start_advanced": "Start Advanced Practice", "button_back_menu": "Back to Course Menu"
        },
        pt: {
            "page_title": "Módulo 4: Prática de Entrada do Usuário",
            "tooltip_click_identify": "Clique para identificar esta parte",
            // Nav
            "nav_theory": "Ver Teoria", "nav_advanced": "Prática Avançada", "nav_menu": "Menu do Curso",
            "nav_anatomy_input": "Anatomia", "nav_flow": "Fluxo Entrada", "nav_mystery": "Mistério Tipo", "nav_conversion": "Conversão", "nav_missions": "Missões",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "Módulo 4: Prática de Entrada do Usuário", "header_subtitle": "Vamos praticar a interação com o usuário e o tratamento de suas entradas!",
            // Activity 1: Anatomy
            "anatomy_input_title": "Anatomia da Obtenção de Entrada", "anatomy_input_desc": "A função `input()` permite que seu programa peça informações ao usuário. Clique nas partes abaixo para identificá-las.<br>Foco: <strong class=\"highlight\">Interação</strong>.",
            "anatomy_input_code_prompt": "\"Digite seu nome: \"",
            "anatomy_exp_variable": "Uma variável (`user_name`): Armazena os dados recebidos do usuário.",
            "anatomy_exp_assignment": "Operador de atribuição (`=`): Coloca o resultado de `input()` na variável.",
            "anatomy_exp_input_function": "A função `input`: Pausa e aguarda a entrada de texto do usuário.",
            "anatomy_exp_paren_open_input": "Parêntese de abertura `(`: Inicia as opções para a função `input`.",
            "anatomy_exp_prompt": "Um prompt de \"string\": Texto exibido ao usuário para pedir a entrada.",
            "anatomy_exp_paren_close_input": "Parêntese de fechamento `)`: Termina as opções para a função `input`.",
            "anatomy_status_initial_input": "Identifique todas as 6 partes!", "anatomy_status_progress_input": "Identificadas {count} de {total} partes.", "anatomy_status_done_input": "Todas as partes identificadas!",
            "feedback_anatomy_input_correct": "Ótimo! Você dissecou a declaração de input!",
            // Activity 2: Flow
            "flow_title": "Fluxo de Entrada e Saída", "flow_desc": "Veja como `input()` funciona com `print()`. Escreva código para perguntar a cor favorita e depois imprimir uma mensagem usando-a. Insira uma cor de exemplo na caixa \"Entrada Simulada\" *antes* de executar.",
            "flow_editor_label": "Editor de Código:", "flow_editor_placeholder": "cor = input(\"Cor fav? \")\\nprint(\"Legal, eu gosto de \" + cor + \" também!\")",
            "flow_sim_input_label": "Entrada Simulada:", "flow_sim_input_placeholder": "ex: azul",
            "button_run_flow": "Executar Simulação", "flow_output_label": "Saída Simulada:", "flow_output_placeholder": "A saída aparece aqui...",
            "feedback_flow_success": "Simulação bem-sucedida! Entrada utilizada.", "feedback_flow_no_input_call": "O código não parece usar `input()`.", "feedback_flow_no_print_call": "O código não parece usar `print()` após o input.", "feedback_flow_no_sim_input": "Por favor, insira a entrada simulada primeiro.", "feedback_flow_general_error": "Verifique a estrutura do seu código (input e depois print).",
            "feedback_flow_var_not_used": "Certifique-se de que a variável que guarda o resultado do input é usada na declaração print.",
           // Activity 3: Mystery
            "mystery_title": "O Mistério do Tipo", "mystery_desc": "`input()` sempre retorna texto (uma string), mesmo que o usuário digite números! Isso pode causar surpresas. Preveja o resultado para cada caso abaixo.<br>Foco: <strong class=\"highlight\">Manipulação de Dados (Tipos)</strong>.",
            "mystery_case1_title": "Caso 1: Somando Números?", "mystery_case1_desc": "Imagine que o usuário digite '5' quando perguntado por `num1` e '3' por `num2`.",
            "mystery_case2_title": "Caso 2: A Correção com `int()`", "mystery_case2_desc": "Agora usamos `int()` para converter a entrada. Usuário digita '10' e depois '4'.",
            "mystery_question": "O que será impresso?", "button_check_answer": "Verificar Resposta",
            "feedback_mystery_correct": "Correto!", "feedback_mystery_incorrect": "Não está certo. Pense nos tipos de dados.", "feedback_mystery_select_answer": "Por favor, selecione uma resposta primeiro.",
            "mystery_exp_1_correct": "Correto! Sem conversão, '+' junta strings ('5' + '3' vira '53'). Isso é concatenação de strings.",
            "mystery_exp_1_incorrect": "Quase. `input()` retorna strings. '+' em strings as junta, não soma matematicamente. Tente de novo!",
            "mystery_exp_2_correct": "Exatamente! `int()` converte a entrada string ('10', '4') em números (10, 4), então '+' realiza adição matemática (10 + 4 = 14).",
            "mystery_exp_2_incorrect": "Pense no que `int()` faz. Ele converte o texto do `input()` em números reais antes da adição acontecer.",
            // Activity 4: Conversion
            "conversion_title": "Praticar Conversão de Tipo", "conversion_desc": "Agora é sua vez! Escreva código para perguntar ao usuário seu ano de nascimento. Converta para inteiro usando `int()`, calcule a idade aproximada em 2024 e imprima a idade. Use o simulador abaixo.<br>Foco: <strong class=\"highlight\">Interação</strong> & <strong class=\"highlight\">Manipulação de Dados</strong>.",
            "conversion_editor_label": "Editor de Código:", "conversion_editor_placeholder": "ano_str = input(\"Ano Nasc: \")\\nano_int = int(ano_str)\\nidade = 2024 - ano_int\\nprint(idade)",
            "conversion_sim_input_label": "Entrada Simulada (Ano):", "conversion_sim_input_placeholder": "ex: 1995",
            "button_run_conversion": "Executar Simulação", "conversion_output_label": "Saída Simulada:", "conversion_output_placeholder": "A saída aparecerá aqui...",
            "feedback_conversion_success": "Simulação bem-sucedida! Conversão usada corretamente.", "feedback_conversion_no_int": "Faltando conversão `int()`.", "feedback_conversion_no_input": "Faltando chamada `input()`.", "feedback_conversion_no_print": "Faltando chamada `print()`.", "feedback_conversion_no_sim_input": "Por favor, insira um ano simulado primeiro.", "feedback_conversion_wrong_logic": "Verifique a lógica de cálculo ou impressão.", "feedback_conversion_general_error": "Verifique o código: input -> int() -> calcular -> print.",
            // Activity 5: Missions
            "missions_input_title": "Mini Missões de Entrada!", "missions_input_desc": "Combine `input()` e conversão de tipo para resolver estas tarefas. Insira entrada de exemplo antes de testar cada missão!",
            "mission_input_sim_label": "Entrada Simulada:", "mission_input_sim_placeholder_name": "ex: Ada", "mission_input_sim_placeholder_age": "ex: 30", "mission_input_sim_placeholder_price": "ex: 49.95",
            "mission_input1_title": "Missão 1: Saudação Simples", "mission_input1_desc": "Pergunte o nome do usuário e imprima uma saudação como \"Olá, [Nome]!\". (Nenhuma conversão de tipo necessária aqui!)", "mission_input1_placeholder": "nome = input(\"Nome? \")\\nprint(\"Olá, \" + nome + \"!\")",
            "button_test_mission_1": "Testar Missão 1",
            "mission_input2_title": "Missão 2: Idade Ano Que Vem", "mission_input2_desc": "Pergunte a idade atual do usuário (como número). Converta para inteiro usando `int()` e imprima a idade dele no próximo ano.", "mission_input2_placeholder": "idade_str = input(\"Idade? \")\\nidade_int = int(idade_str)\\nprint(idade_int + 1)",
            "button_test_mission_2": "Testar Missão 2",
            "mission_input3_title": "Missão 3: Preço + Imposto", "mission_input3_desc": "Peça o preço de um item (pode ter decimais). Converta para float usando `float()`. Calcule um imposto de 10% (preço * 0.10) e imprima *apenas* o valor do imposto.", "mission_input3_placeholder": "preco_str = input(\"Preço? \")\\npreco_float = float(preco_str)\\nimposto = preco_float * 0.10\\nprint(imposto)",
            "button_test_mission_3": "Testar Missão 3",
            "feedback_mission_input_success": "Missão Cumprida!", "feedback_mission_input_syntax_error": "Erro de sintaxe/lógica.", "feedback_mission_input_no_sim_input": "Insira a entrada simulada primeiro!", "feedback_mission_input_conversion_fail": "Falha na conversão. O usuário inseriu um tipo de entrada válido?",
            "feedback_mission1_input_hint": "Precisa de `input()` e `print()` com concatenação (+).",
            "feedback_mission2_input_hint": "Precisa de `input()`, `int()`, somar 1, depois `print()`.",
            "feedback_mission3_input_hint": "Precisa de `input()`, `float()`, multiplicar por 0.10, depois `print()` imposto.",
            "feedback_missions_input_summary_all_done": "Todas as {totalMissions} missões de entrada completas! Ótimo trabalho!", "feedback_missions_input_summary_progress": "Completou {completedCount} de {totalMissions} missões de entrada. Continue!",
            // Completion
            "completion_title": "Prática do Módulo 4 Completa!", "completion_desc": "Excelente trabalho! Você praticou obter entrada do usuário e lidar com diferentes tipos de dados. <br> Pronto para um desafio maior? Tente a <strong>Prática Avançada</strong> do Módulo 4!",
            "button_view_theory": "Ver Teoria Novamente", "button_start_advanced": "Iniciar Prática Avançada", "button_back_menu": "Voltar ao Menu do Curso"
        },
        zh: {
            "page_title": "模块 4：用户输入练习",
            "tooltip_click_identify": "点击识别此部分",
            // Nav
            "nav_theory": "查看理论", "nav_advanced": "高级练习", "nav_menu": "课程菜单",
            "nav_anatomy_input": "剖析", "nav_flow": "输入流程", "nav_mystery": "类型之谜", "nav_conversion": "转换", "nav_missions": "任务",
            "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
            // Header
            "header_title": "模块 4：用户输入练习", "header_subtitle": "让我们练习与用户交互并处理他们的输入！",
            // Activity 1: Anatomy
            "anatomy_input_title": "剖析获取输入", "anatomy_input_desc": "`input()` 函数让你的程序可以向用户询问信息。点击下面的部分来识别它们。<br>重点：<strong class=\"highlight\">交互</strong>。",
            "anatomy_input_code_prompt": "\"输入你的名字: \"",
            "anatomy_exp_variable": "变量 (`user_name`)：存储从用户那里接收的数据。",
            "anatomy_exp_assignment": "赋值运算符 (`=`)：将 `input()` 的结果放入变量中。",
            "anatomy_exp_input_function": "`input` 函数：暂停并等待用户输入文本。",
            "anatomy_exp_paren_open_input": "左括号 `(`：开始 `input` 函数的选项。",
            "anatomy_exp_prompt": "“字符串”提示：显示给用户以请求输入的文本。",
            "anatomy_exp_paren_close_input": "右括号 `)`：结束 `input` 函数的选项。",
            "anatomy_status_initial_input": "识别所有 6 个部分！", "anatomy_status_progress_input": "已识别 {count} / {total} 个部分。", "anatomy_status_done_input": "所有部分已识别！",
            "feedback_anatomy_input_correct": "太棒了！你成功剖析了 input 语句！",
            // Activity 2: Flow
            "flow_title": "输入与输出流程", "flow_desc": "看看 `input()` 如何与 `print()` 一起工作。编写代码询问喜欢的颜色，然后使用它打印一条消息。在运行*之前*，在“模拟输入”框中输入一个示例颜色。",
            "flow_editor_label": "代码编辑器：", "flow_editor_placeholder": "color = input(\"喜欢的颜色？ \")\\nprint(\"酷，我也喜欢 \" + color + \"!\")",
            "flow_sim_input_label": "模拟输入：", "flow_sim_input_placeholder": "例如：蓝色",
            "button_run_flow": "运行模拟", "flow_output_label": "模拟输出：", "flow_output_placeholder": "输出显示在此...",
            "feedback_flow_success": "模拟成功！输入已使用。", "feedback_flow_no_input_call": "代码似乎没有使用 `input()`。", "feedback_flow_no_print_call": "代码似乎在输入后没有使用 `print()`。", "feedback_flow_no_sim_input": "请先输入模拟输入。", "feedback_flow_general_error": "检查你的代码结构（先 input 后 print）。",
             "feedback_flow_var_not_used": "确保保存输入结果的变量在 print 语句中被使用了。",
            // Activity 3: Mystery
            "mystery_title": "类型之谜", "mystery_desc": "`input()` 总是返回文本（字符串），即使用户输入数字！这可能会导致意外。预测下面每种情况的结果。<br>重点：<strong class=\"highlight\">数据处理（类型）</strong>。",
            "mystery_case1_title": "情况 1：数字相加？", "mystery_case1_desc": "假设用户在被询问 `num1` 时输入 '5'，询问 `num2` 时输入 '3'。",
            "mystery_case2_title": "情况 2：使用 `int()` 修复", "mystery_case2_desc": "现在我们使用 `int()` 转换输入。用户输入 '10' 然后输入 '4'。",
            "mystery_question": "将打印什么？", "button_check_answer": "检查答案",
            "feedback_mystery_correct": "正确！", "feedback_mystery_incorrect": "不太对。考虑一下数据类型。", "feedback_mystery_select_answer": "请先选择一个答案。",
            "mystery_exp_1_correct": "正确！没有转换，'+' 连接字符串（'5' + '3' 变成 '53'）。这是字符串拼接。",
            "mystery_exp_1_incorrect": "不太对。`input()` 给出字符串。对字符串使用 '+' 会连接它们，而不是数学相加。再试一次！",
            "mystery_exp_2_correct": "完全正确！`int()` 将字符串输入（'10', '4'）转换为数字（10, 4），所以 '+' 执行数学加法（10 + 4 = 14）。",
            "mystery_exp_2_incorrect": "想想 `int()` 的作用。它在加法发生之前将 `input()` 的文本转换为实际数字。",
            // Activity 4: Conversion
            "conversion_title": "练习类型转换", "conversion_desc": "现在你来试试！编写代码询问用户的出生年份。使用 `int()` 将其转换为整数，计算他们在 2024 年的大致年龄，并打印年龄。使用下面的模拟器。<br>重点：<strong class=\"highlight\">交互</strong> & <strong class=\"highlight\">数据处理</strong>。",
            "conversion_editor_label": "代码编辑器：", "conversion_editor_placeholder": "year_str = input(\"出生年份: \")\\nyear_int = int(year_str)\\nage = 2024 - year_int\\nprint(age)",
            "conversion_sim_input_label": "模拟输入 (年份)：", "conversion_sim_input_placeholder": "例如：1995",
            "button_run_conversion": "运行模拟", "conversion_output_label": "模拟输出：", "conversion_output_placeholder": "输出将显示在此处...",
            "feedback_conversion_success": "模拟成功！转换使用正确。", "feedback_conversion_no_int": "缺少 `int()` 转换。", "feedback_conversion_no_input": "缺少 `input()` 调用。", "feedback_conversion_no_print": "缺少 `print()` 调用。", "feedback_conversion_no_sim_input": "请先输入模拟年份。", "feedback_conversion_wrong_logic": "检查计算或打印逻辑。", "feedback_conversion_general_error": "检查代码：input -> int() -> calculate -> print。",
            // Activity 5: Missions
            "missions_input_title": "输入迷你任务！", "missions_input_desc": "结合 `input()` 和类型转换来完成这些任务。在测试每个任务前输入示例输入！",
            "mission_input_sim_label": "模拟输入：", "mission_input_sim_placeholder_name": "例如：Ada", "mission_input_sim_placeholder_age": "例如：30", "mission_input_sim_placeholder_price": "例如：49.95",
            "mission_input1_title": "任务 1：简单问候", "mission_input1_desc": "询问用户的名字并打印像“你好，[名字]！”这样的问候语。（这里不需要类型转换！）", "mission_input1_placeholder": "name = input(\"名字？ \")\\nprint(\"你好， \" + name + \"!\")",
            "button_test_mission_1": "测试任务 1",
            "mission_input2_title": "任务 2：明年年龄", "mission_input2_desc": "询问用户当前年龄（作为数字）。使用 `int()` 将其转换为整数，并打印他们明年的年龄。", "mission_input2_placeholder": "age_str = input(\"年龄？ \")\\nage_int = int(age_str)\\nprint(age_int + 1)",
            "button_test_mission_2": "测试任务 2",
            "mission_input3_title": "任务 3：价格 + 税", "mission_input3_desc": "询问商品价格（可以有小数）。使用 `float()` 将其转换为浮点数。计算 10% 的税（价格 * 0.10）并*仅*打印税额。", "mission_input3_placeholder": "price_str = input(\"价格？ \")\\nprice_float = float(price_str)\\ntax = price_float * 0.10\\nprint(tax)",
            "button_test_mission_3": "测试任务 3",
            "feedback_mission_input_success": "任务完成！", "feedback_mission_input_syntax_error": "语法/逻辑错误。", "feedback_mission_input_no_sim_input": "请先输入模拟输入！", "feedback_mission_input_conversion_fail": "转换失败。用户是否输入了有效的输入类型？",
            "feedback_mission1_input_hint": "需要 `input()` 和 `print()` 以及连接 (+)。",
            "feedback_mission2_input_hint": "需要 `input()`、`int()`、加 1，然后 `print()`。",
            "feedback_mission3_input_hint": "需要 `input()`、`float()`、乘以 0.10，然后 `print()` 税额。",
            "feedback_missions_input_summary_all_done": "所有 {totalMissions} 个输入任务已完成！做得好！", "feedback_missions_input_summary_progress": "已完成 {completedCount} / {totalMissions} 个输入任务。继续努力！",
            // Completion
            "completion_title": "模块 4 练习完成！", "completion_desc": "干得漂亮！你已经练习了获取用户输入和处理不同数据类型。<br>准备好迎接更大的挑战了吗？试试模块 4 的<strong>高级练习</strong>！",
            "button_view_theory": "再次查看理论", "button_start_advanced": "开始高级练习", "button_back_menu": "返回课程菜单"
        }
    };


    document.addEventListener('DOMContentLoaded', () => {

        // --- Language Management Functions (Same as Module 0) ---
        function getStoredLanguage() { /* ... Keep original ... */
            const storedLang = localStorage.getItem('userLanguage');
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default to English
        }

        function setLanguage(lang) { /* ... Keep original, ensure it calls translatePage and activity setups ... */
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem('userLanguage', lang);
            document.documentElement.lang = lang;
            translatePage(lang); // Apply generic translations first

            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

             // Re-initialize or update language-dependent interactive content
             // *** MODIFIED: Call Module 4 activity setups ***
             if (document.getElementById('anatomy-input')) setupAnatomyInputActivity();
             if (document.getElementById('input-flow')) resetInputFlowSimulation();
             if (document.getElementById('type-mystery')) setupTypeMysteryActivity();
             if (document.getElementById('conversion-practice')) resetConversionPracticeSimulation();
             if (document.getElementById('mini-missions-input') && typeof updateMissionInputSummary === 'function') {
                 updateMissionInputSummary(); // Update summary text if visible
                 // Reset individual mission states visually if needed upon language change? Maybe not essential.
             }
        }

        function getTranslation(key, lang, replacements = {}) { /* ... Keep original ... */
            let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) { /* ... Keep original ... */
             if (!translations[lang]) lang = 'en';
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') { /* Placeholders handled below */ }
                 else if (el.tagName === 'OPTION') { el.textContent = translation; }
                 else {
                     if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; }
                     else { el.textContent = translation; }
                 }
             });
             document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                 const key = el.getAttribute('data-translate-placeholder');
                 const translation = getTranslation(key, lang);
                 el.setAttribute('placeholder', translation);
             });
             document.querySelectorAll('[data-translate-title]').forEach(el => {
                 const key = el.getAttribute('data-translate-title');
                 const translation = getTranslation(key, lang);
                 el.setAttribute('title', translation);
             });
        }

        const initialLang = getStoredLanguage();

        // --- Minimal Nav Logic (Same as Module 0) ---
        const navToggleButton = document.getElementById('minimal-nav-toggle'); /* ... Keep original ... */
        const navPanel = document.getElementById('minimal-nav-panel');
        const body = document.body;
        if (navToggleButton && navPanel) {
            navToggleButton.addEventListener('click', (event) => { event.stopPropagation(); body.classList.toggle('nav-active'); navToggleButton.setAttribute('aria-expanded', body.classList.contains('nav-active')); });
            document.addEventListener('click', (event) => { if (body.classList.contains('nav-active') && !navPanel.contains(event.target) && event.target !== navToggleButton && !navToggleButton.contains(event.target)) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navPanel.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); }); });
            document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && body.classList.contains('nav-active')) { body.classList.remove('nav-active'); navToggleButton.setAttribute('aria-expanded', 'false'); } });
            navToggleButton.setAttribute('aria-expanded', 'false');
        }


        // --- Language Switcher Setup (Same as Module 0) ---
        const langSelect = document.getElementById('languageSelect'); /* ... Keep original ... */
        if (langSelect) { langSelect.addEventListener('change', (e) => setLanguage(e.target.value)); }

        // --- Helper Function for Feedback (Same as Module 0) ---
        function showFeedback(elementId, messageKey, type = 'info', replacements = {}) { /* ... Keep original ... */
            const feedbackEl = document.getElementById(elementId);
            if (!feedbackEl) { console.error(`Feedback element not found: ${elementId}`); return; }
            const currentLang = getStoredLanguage();
            const translatedMessage = getTranslation(messageKey, currentLang, replacements);
            if (translatedMessage.includes('<') && translatedMessage.includes('>')) { feedbackEl.innerHTML = translatedMessage; }
            else { feedbackEl.textContent = translatedMessage; }
            feedbackEl.className = 'feedback-message'; // Reset classes first
            feedbackEl.classList.add('visible', type);
            const interactiveArea = feedbackEl.closest('.interactive-area');
            if (!interactiveArea) return;
            interactiveArea.classList.remove('success-glow-anim', 'shake-anim');
            void interactiveArea.offsetWidth; // Trigger reflow
            if (type === 'correct') { interactiveArea.classList.add('success-glow-anim'); }
            else if (type === 'incorrect') { interactiveArea.classList.add('shake-anim'); }
        }

        // --- Activity 1: Anatomy of input() ---
        const anatomyInputSection = document.getElementById('anatomy-input');
        let currentAnatomyInputListeners = [];

        function setupAnatomyInputActivity() {
            if (!anatomyInputSection) return;
            const currentLang = getStoredLanguage();
            const partExplanations = {}; // Fetch explanations specific to input
            document.querySelectorAll('#explanation-texts-input span[data-key]').forEach(span => {
                const key = span.getAttribute('data-key');
                partExplanations[key] = getTranslation(`anatomy_exp_${key}`, currentLang); // Fetch explanation for current lang
            });

            const parts = anatomyInputSection.querySelectorAll('.code-part');
            const explanationsDiv = document.getElementById('anatomy-explanations-input');
            const statusP = document.getElementById('anatomy-status-input');
            const feedbackDiv = document.getElementById('anatomy-feedback-input');
            const totalAnatomyParts = 6; // Updated count for input anatomy
            let identifiedCount = 0;

            // Remove old listeners
            currentAnatomyInputListeners.forEach(({element, listener}) => {
                element.removeEventListener('click', listener);
            });
            currentAnatomyInputListeners = [];

            // Reset visual state
            parts.forEach(p => p.classList.remove('identified'));
            explanationsDiv.innerHTML = '';
            statusP.innerHTML = getTranslation('anatomy_status_initial_input', currentLang, {total: totalAnatomyParts});
            feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');

            parts.forEach(part => {
                const clickListener = () => {
                    const partType = part.dataset.part;
                    if (!part.classList.contains('identified') && partType && partExplanations[partType]) {
                        part.classList.add('identified');
                        identifiedCount++;
                        const p = document.createElement('p');
                        p.classList.add('part-explanation');
                         const icon = document.createElement('i'); icon.className = 'fas fa-check-circle'; icon.style.color = 'var(--success-color)';
                         const strong = document.createElement('strong');
                         const displayedTextElement = part.querySelector('span[class^="code-"]');
                         strong.textContent = (displayedTextElement ? displayedTextElement.textContent.trim() : part.textContent.trim()) + ': ';
                         p.appendChild(icon); p.appendChild(strong); p.appendChild(document.createTextNode(partExplanations[partType]));
                        explanationsDiv.appendChild(p);

                        statusP.innerHTML = getTranslation('anatomy_status_progress_input', currentLang, { count: identifiedCount, total: totalAnatomyParts });

                        if (identifiedCount === totalAnatomyParts) {
                            statusP.innerHTML = getTranslation('anatomy_status_done_input', currentLang);
                            showFeedback('anatomy-feedback-input', 'feedback_anatomy_input_correct', 'correct');
                        }
                    }
                };
                part.addEventListener('click', clickListener);
                currentAnatomyInputListeners.push({ element: part, listener: clickListener });
            });
        }

        // --- Activity 2: Input/Output Flow ---
        const inputFlowSection = document.getElementById('input-flow');
        if (inputFlowSection) {
            const editor = document.getElementById('flow-editor-input');
            const simInput = document.getElementById('flow-sim-input');
            const outputArea = document.getElementById('flow-output');
            const runBtn = document.getElementById('run-flow-btn');
            const feedbackDiv = document.getElementById('flow-feedback');

            function resetInputFlowSimulation() {
                outputArea.innerHTML = `<span class="placeholder" data-translate="flow_output_placeholder">${getTranslation('flow_output_placeholder', getStoredLanguage())}</span>`;
                feedbackDiv.classList.remove('visible', 'correct', 'incorrect', 'info');
                // Keep editor and sim input values
            }

            runBtn.addEventListener('click', () => {
                const code = editor.value.trim();
                const simulatedInputValue = simInput.value.trim();
                const currentLang = getStoredLanguage();
                outputArea.innerHTML = ''; // Clear previous output
                feedbackDiv.classList.remove('visible');

                if (simulatedInputValue === '') {
                    showFeedback('flow-feedback', 'feedback_flow_no_sim_input', 'info');
                    resetInputFlowSimulation(); // Show placeholder again
                    return;
                }

                // Regex to find: variable = input("prompt")
                const inputRegex = /(\w+)\s*=\s*input\(\s*(["'])(.*?)\2\s*\)/;
                const inputMatch = code.match(inputRegex);

                if (!inputMatch) {
                    showFeedback('flow-feedback', 'feedback_flow_no_input_call', 'incorrect');
                    resetInputFlowSimulation();
                    return;
                }

                const inputVarName = inputMatch[1];
                const inputPrompt = inputMatch[3];

                // Regex to find: print(...) using the variable
                 // Allows for concatenation or f-string (basic check)
                 const printRegex = new RegExp(`print\\(\\s*(.*${inputVarName}.*)\\s*\\)`);
                const printMatch = code.match(printRegex);

                if (!printMatch) {
                     showFeedback('flow-feedback', 'feedback_flow_no_print_call', 'incorrect');
                     resetInputFlowSimulation();
                     return;
                 }
                 // More robust check: is the variable actually *used* within the print?
                if (!printMatch[1].includes(inputVarName)) {
                    showFeedback('flow-feedback', 'feedback_flow_var_not_used', 'incorrect');
                     resetInputFlowSimulation();
                     return;
                }


                 // Simulate execution
                 // 1. Show prompt
                 const promptSpan = document.createElement('span');
                 promptSpan.className = 'prompt';
                 promptSpan.textContent = inputPrompt;
                 outputArea.appendChild(promptSpan);

                 // 2. Show simulated user input (on the same line conceptually)
                 const userInputSpan = document.createElement('span');
                 userInputSpan.className = 'user-input-display';
                 userInputSpan.textContent = simulatedInputValue;
                 outputArea.appendChild(userInputSpan);

                 // 3. Simulate the print output
                 try {
                    // Very basic simulation: replace variable name with value in print's content
                    // This is NOT a real Python interpreter! Handles simple cases.
                    let printContent = printMatch[1];
                    // Handle basic string concatenation: "string" + var + "string"
                    printContent = printContent.replace(new RegExp(`(["']).*?\\1\\s*\\+\\s*${inputVarName}\\s*\\+\\s*(["']).*?\\2`), (match, q1, q2) => {
                         const parts = match.split(new RegExp(`\\s*\\+\\s*${inputVarName}\\s*\\+\\s*`));
                         return `${parts[0].slice(1,-1)}${simulatedInputValue}${parts[1].slice(1,-1)}`;
                    });
                    // Handle simple cases like print("Hello " + name) or print(name + "!")
                     printContent = printContent.replace(new RegExp(`(["']).*?\\1\\s*\\+\\s*${inputVarName}`), (match, q1) => `${match.split(`"`)[1]}${simulatedInputValue}`);
                     printContent = printContent.replace(new RegExp(`${inputVarName}\\s*\\+\\s*(["']).*?\\1`), (match, q1) => `${simulatedInputValue}${match.split(`"`)[1]}`);

                    // If it was just print(variable)
                     if (printContent.trim() === inputVarName) {
                         printContent = simulatedInputValue;
                     }

                    // Crude f-string simulation: print(f"Hello {name}")
                    printContent = printContent.replace(new RegExp(`f(["']).*?\\{${inputVarName}\\}.*?\\1`), (match, q1) => {
                        return match.substring(2, match.length - 1).replace(`{${inputVarName}}`, simulatedInputValue);
                    });


                    const outputLine = document.createElement('span');
                    outputLine.classList.add('output-line');
                    outputLine.textContent = printContent; // Show the processed content
                    outputArea.appendChild(outputLine);

                    showFeedback('flow-feedback', 'feedback_flow_success', 'correct');

                 } catch (e) {
                     console.error("Flow Simulation Error:", e);
                     showFeedback('flow-feedback', 'feedback_flow_general_error', 'incorrect');
                 }
            });
             resetInputFlowSimulation(); // Initial setup
        }


        // --- Activity 3: Type Mystery ---
        const typeMysterySection = document.getElementById('type-mystery');
        function setupTypeMysteryActivity() { // Function to allow reset on language change etc.
            if (!typeMysterySection) return;
            const checkButtons = typeMysterySection.querySelectorAll('.check-mystery-btn');
            const explanationTexts = {};
            document.querySelectorAll('#mystery-explanation-texts span').forEach(span => {
                explanationTexts[`case-${span.dataset.case}-${span.dataset.correct}`] = span.getAttribute('data-translate');
            });

            // Reset state
            typeMysterySection.querySelectorAll('.mystery-case').forEach(mc => {
                 mc.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
                 mc.querySelector('.explanation')?.classList.add('hidden');
                 mc.querySelector('.explanation')?.textContent = '';
                 mc.querySelector('.feedback-message')?.classList.remove('visible');
                 const btn = mc.querySelector('.check-mystery-btn');
                 if(btn) { btn.disabled = false; btn.classList.remove('success'); }
             });

            checkButtons.forEach(button => {
                // Remove potential old listener before adding new one
                button.replaceWith(button.cloneNode(true)); // Simple way to remove listeners
            });
            // Re-query buttons after cloning
            typeMysterySection.querySelectorAll('.check-mystery-btn').forEach(button => {
                 button.addEventListener('click', () => {
                    const caseId = button.dataset.case;
                    const caseDiv = document.getElementById(`mystery-case-${caseId}`);
                    const feedbackDiv = document.getElementById(`mystery-feedback-${caseId}`);
                    const explanationDiv = document.getElementById(`mystery-explanation-${caseId}`);
                    const options = caseDiv.querySelectorAll(`input[name="mystery${caseId}"]`);
                    const currentLang = getStoredLanguage();
                    let selectedOption = null;

                    options.forEach(opt => { if (opt.checked) selectedOption = opt; });

                    if (!selectedOption) {
                        showFeedback(`mystery-feedback-${caseId}`, 'feedback_mystery_select_answer', 'info');
                        return;
                    }

                    const isCorrect = selectedOption.dataset.correct === 'true';
                    const explanationKey = explanationTexts[`case-${caseId}-${isCorrect}`];

                    if (isCorrect) {
                        showFeedback(`mystery-feedback-${caseId}`, 'feedback_mystery_correct', 'correct');
                        button.classList.add('success');
                        explanationDiv.className = 'explanation correct'; // Show with correct styling
                    } else {
                        showFeedback(`mystery-feedback-${caseId}`, 'feedback_mystery_incorrect', 'incorrect');
                        button.classList.remove('success');
                        explanationDiv.className = 'explanation incorrect'; // Show with incorrect styling
                    }
                    explanationDiv.innerHTML = getTranslation(explanationKey, currentLang); // Use innerHTML for potential formatting
                    explanationDiv.classList.remove('hidden');
                    button.disabled = true; // Disable after checking
                 });
             });
        }


        // --- Activity 4: Conversion Practice ---
        const conversionPracticeSection = document.getElementById('conversion-practice');
        if (conversionPracticeSection) {
            const editor = document.getElementById('conversion-editor-input');
            const simInput = document.getElementById('conversion-sim-input');
            const outputArea = document.getElementById('conversion-output');
            const runBtn = document.getElementById('run-conversion-btn');
            const feedbackDiv = document.getElementById('conversion-feedback');

            function resetConversionPracticeSimulation() {
                outputArea.innerHTML = `<span class="placeholder" data-translate="conversion_output_placeholder">${getTranslation('conversion_output_placeholder', getStoredLanguage())}</span>`;
                feedbackDiv.classList.remove('visible');
                // Keep editor/input values
            }

            runBtn.addEventListener('click', () => {
                const code = editor.value.trim();
                const simulatedYear = simInput.value.trim();
                const currentLang = getStoredLanguage();
                outputArea.innerHTML = '';
                feedbackDiv.classList.remove('visible');

                if (simulatedYear === '') {
                    showFeedback('conversion-feedback', 'feedback_conversion_no_sim_input', 'info');
                    resetConversionPracticeSimulation();
                    return;
                }

                // Basic checks
                if (!code.includes('input(')) {
                     showFeedback('conversion-feedback', 'feedback_conversion_no_input', 'incorrect');
                     resetConversionPracticeSimulation(); return;
                }
                 if (!code.includes('int(')) {
                     showFeedback('conversion-feedback', 'feedback_conversion_no_int', 'incorrect');
                     resetConversionPracticeSimulation(); return;
                 }
                 if (!code.includes('print(')) {
                     showFeedback('conversion-feedback', 'feedback_conversion_no_print', 'incorrect');
                     resetConversionPracticeSimulation(); return;
                 }

                 // Simulation
                 try {
                     // 1. Find input prompt
                     const inputRegex = /input\(\s*(["'])(.*?)\1\s*\)/;
                     const inputMatch = code.match(inputRegex);
                     const inputPrompt = inputMatch ? inputMatch[2] : '';

                     // Display prompt and simulated input
                     const promptSpan = document.createElement('span');
                     promptSpan.className = 'prompt';
                     promptSpan.textContent = inputPrompt;
                     outputArea.appendChild(promptSpan);
                     const userInputSpan = document.createElement('span');
                     userInputSpan.className = 'user-input-display';
                     userInputSpan.textContent = simulatedYear;
                     outputArea.appendChild(userInputSpan);

                    // 2. Attempt conversion and calculation (SIMULATED)
                    let ageResult;
                    const yearInt = parseInt(simulatedYear); // Simulate int()
                    if (isNaN(yearInt)) {
                         throw new Error("Invalid number input"); // Simulate Python error
                    }
                    // Check if code calculates age (approx)
                    if (code.includes('2024') && code.includes('-')) {
                         ageResult = 2024 - yearInt;
                    } else {
                         showFeedback('conversion-feedback', 'feedback_conversion_wrong_logic', 'incorrect');
                         return; // Stop simulation if logic seems wrong
                    }

                     // 3. Check if print displays the age
                     // Very basic check: does print() seem to use a variable that likely holds the age?
                     const printRegex = /print\(\s*(.*?)\s*\)/;
                     const printMatch = code.match(printRegex);
                    const likelyAgeVar = code.match(/(\w+)\s*=\s*2024\s*-\s*\w+/)?.[1]; // Find var name like 'age'

                    if (printMatch && likelyAgeVar && printMatch[1].includes(likelyAgeVar)) {
                        const outputLine = document.createElement('span');
                        outputLine.classList.add('output-line');
                        outputLine.textContent = ageResult; // Display calculated age
                        outputArea.appendChild(outputLine);
                         showFeedback('conversion-feedback', 'feedback_conversion_success', 'correct');
                    } else if (printMatch) { // Print call exists, but maybe prints wrong thing
                        showFeedback('conversion-feedback', 'feedback_conversion_wrong_logic', 'incorrect');
                        // Optionally simulate the incorrect print output
                        const outputLine = document.createElement('span');
                        outputLine.classList.add('output-line');
                        outputLine.textContent = `(Output depends on what ${printMatch[1]} is)`;
                        outputArea.appendChild(outputLine);

                    } else { // No print call found after calculation logic
                         showFeedback('conversion-feedback', 'feedback_conversion_no_print', 'incorrect');
                    }

                 } catch (e) {
                     console.error("Conversion Sim Error:", e);
                      // Display Python-like error for invalid input during int()
                     if (e.message.includes("Invalid number input")) {
                          outputArea.innerHTML += `\n<span class="output-line" style="color: var(--error-color);">ValueError: invalid literal for int() with base 10: '${simulatedYear}'</span>`;
                          showFeedback('conversion-feedback', 'feedback_mission_input_conversion_fail', 'incorrect');
                     } else {
                          showFeedback('conversion-feedback', 'feedback_conversion_general_error', 'incorrect');
                     }
                 }

            });
             resetConversionPracticeSimulation(); // Initial setup
        }


        // --- Activity 5: Mini Missions (Input Theme) ---
        const missionsInputSection = document.getElementById('mini-missions-input');
        let updateMissionInputSummary; // Define function scope

        if (missionsInputSection) {
            const missionRunButtons = missionsInputSection.querySelectorAll('.mission-run-btn-input');
            const summaryFeedback = document.getElementById('missions-summary-feedback-input');
            const totalMissions = missionsInputSection.querySelectorAll('.mission').length;

            updateMissionInputSummary = function() { // Assign function
                 const completedMissionsCount = missionsInputSection.querySelectorAll('.mission[data-completed="true"]').length;
                 const currentLang = getStoredLanguage();
                 if (completedMissionsCount === totalMissions) {
                     showFeedback('missions-summary-feedback-input', 'feedback_missions_input_summary_all_done', 'correct', { totalMissions: totalMissions });
                 } else if (completedMissionsCount > 0) {
                     showFeedback('missions-summary-feedback-input', 'feedback_missions_input_summary_progress', 'info', { completedCount: completedMissionsCount, totalMissions: totalMissions });
                 } else {
                     summaryFeedback.classList.remove('visible');
                 }
            }

            missionRunButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const missionId = button.dataset.missionId;
                    const missionDiv = document.getElementById(`mission-input-${missionId}`);
                    if (!missionDiv) return;

                    const editor = missionDiv.querySelector('.mission-editor');
                    const simInput = missionDiv.querySelector('.sim-input-entry input'); // Find the input in this mission
                    const outputArea = missionDiv.querySelector('.mission-output');
                    const feedbackDivId = `mission-feedback-input-${missionId}`;
                    const feedbackDiv = document.getElementById(feedbackDivId);
                    const statusIcon = missionDiv.querySelector('.mission-status i');

                    const code = editor.value.trim();
                    const simulatedInputValue = simInput.value.trim();
                    const currentLang = getStoredLanguage();

                    outputArea.innerHTML = '';
                    feedbackDiv.classList.remove('visible');
                    let success = false;
                    let feedbackMessageKey = 'feedback_mission_input_syntax_error';
                    let feedbackType = 'incorrect';
                    let specificHintKey = ''; // More specific feedback

                    if (simulatedInputValue === '') {
                        showFeedback(feedbackDivId, 'feedback_mission_input_no_sim_input', 'info');
                        return; // Stop if no simulated input provided
                    }

                    // Display prompt and simulated input first
                    const inputRegex = /input\(\s*(["'])(.*?)\1\s*\)/;
                    const inputMatch = code.match(inputRegex);
                    const inputPrompt = inputMatch ? inputMatch[2] : '';
                    outputArea.innerHTML = `<span class="prompt">${inputPrompt}</span><span class="user-input-display">${simulatedInputValue}</span>`;

                    /* Validation Logic (SIMPLIFIED SIMULATION) */
                    try {
                        let finalOutput = null; // What the print should output

                        if (missionId === '1') { // Greeting
                            const nameVarMatch = code.match(/(\w+)\s*=\s*input\(/);
                            const printMatch = code.match(/print\(\s*.*\+\s*(\w+)\s*.*\)/); // Basic concat check
                            if (nameVarMatch && printMatch && printMatch[1] === nameVarMatch[1] && code.includes("Hello,")) {
                                 finalOutput = `Hello, ${simulatedInputValue}!`; // Construct expected output
                                 success = true;
                            } else { specificHintKey = 'feedback_mission1_input_hint'; }
                        }
                        else if (missionId === '2') { // Age next year
                            const ageVarStrMatch = code.match(/(\w+)\s*=\s*input\(/);
                            const ageVarIntMatch = code.match(/(\w+)\s*=\s*int\(\s*(\w+)\s*\)/);
                             const printMatch = code.match(/print\(\s*(\w+)\s*\+\s*1\s*\)/) || code.match(/print\(\s*1\s*\+\s*(\w+)\s*\)/) ;

                             if (ageVarStrMatch && ageVarIntMatch && ageVarIntMatch[2] === ageVarStrMatch[1] && // Input var used in int()
                                 printMatch && printMatch[1] === ageVarIntMatch[1]) { // int var used in print + 1
                                 const ageInt = parseInt(simulatedInputValue);
                                 if (isNaN(ageInt)) throw new Error("Invalid age input");
                                 finalOutput = ageInt + 1;
                                 success = true;
                             } else { specificHintKey = 'feedback_mission2_input_hint'; }
                        }
                        else if (missionId === '3') { // Price + Tax
                            const priceVarStrMatch = code.match(/(\w+)\s*=\s*input\(/);
                            const priceVarFloatMatch = code.match(/(\w+)\s*=\s*float\(\s*(\w+)\s*\)/);
                             const taxVarMatch = code.match(/(\w+)\s*=\s*(\w+)\s*\*\s*0\.10/); // Or 0.1
                             const printMatch = code.match(/print\(\s*(\w+)\s*\)/);

                            if (priceVarStrMatch && priceVarFloatMatch && priceVarFloatMatch[2] === priceVarStrMatch[1] && // Input -> float
                                taxVarMatch && taxVarMatch[2] === priceVarFloatMatch[1] && // float used in calc
                                printMatch && printMatch[1] === taxVarMatch[1]) { // tax var printed
                                const priceFloat = parseFloat(simulatedInputValue);
                                if (isNaN(priceFloat)) throw new Error("Invalid price input");
                                finalOutput = priceFloat * 0.10;
                                // Handle potential floating point inaccuracies for display
                                finalOutput = parseFloat(finalOutput.toFixed(10)); // Limit precision for comparison/display
                                success = true;
                             } else { specificHintKey = 'feedback_mission3_input_hint'; }
                        }

                        // Display final output if successful
                        if (finalOutput !== null) {
                             outputArea.innerHTML += `<span class="output-line">${finalOutput}</span>`;
                        }

                    } catch (error) {
                         console.error("Mission Sim Error:", error);
                        if (error.message.includes("Invalid")) { // Catch our specific conversion errors
                            outputArea.innerHTML += `<br><span class="output-line" style="color: var(--error-color);">ValueError: invalid literal</span>`;
                            feedbackMessageKey = 'feedback_mission_input_conversion_fail';
                         } else {
                             feedbackMessageKey = 'feedback_mission_input_syntax_error'; // General catch-all
                         }
                         success = false; // Ensure failure state
                    }
                    /* End Validation */

                    if (success) {
                        feedbackMessageKey = 'feedback_mission_input_success';
                        feedbackType = 'correct';
                        statusIcon.className = 'fas fa-check-circle';
                        missionDiv.dataset.completed = 'true';
                    } else {
                        feedbackMessageKey = specificHintKey || feedbackMessageKey; // Use specific hint if available
                        feedbackType = 'incorrect';
                        statusIcon.className = 'fas fa-times-circle';
                        missionDiv.dataset.completed = 'false';
                        // Add error hint to output if not already shown (e.g., for logic errors)
                        if (!outputArea.innerHTML.includes('ValueError') && !specificHintKey) {
                            outputArea.innerHTML += `<br><span class="output-line" style="color: var(--error-color);">Check logic/syntax...</span>`;
                        }
                    }
                    showFeedback(feedbackDivId, feedbackMessageKey, feedbackType);
                    updateMissionInputSummary();
                });
            });
             updateMissionInputSummary(); // Initial call
        }

        // --- Fade-in animations on scroll (Same as Module 0) ---
        const fadeElements = document.querySelectorAll('.fade-in'); /* ... Keep original ... */
        const animateOnScroll = () => { const windowHeight = window.innerHeight; fadeElements.forEach(el => { if (el.style.opacity === '1') return; const rect = el.getBoundingClientRect(); if (rect.top < windowHeight - 80 && rect.bottom >= 50) { el.style.opacity = '1'; el.style.transform = 'translateY(0)'; } }); };
        const scrollHandler = () => window.requestAnimationFrame(animateOnScroll);
        window.addEventListener('scroll', scrollHandler);


        // --- Initial Language Application and Activity Setups ---
        setLanguage(initialLang); // Apply language FIRST
        animateOnScroll(); // Trigger initial animation check after content is placed

        // *** Call initial setups for Module 4 activities AFTER language set ***
        // setupAnatomyInputActivity(); // Called by setLanguage
        // resetInputFlowSimulation(); // Called by setLanguage
        // setupTypeMysteryActivity(); // Called by setLanguage
        // resetConversionPracticeSimulation(); // Called by setLanguage
        // updateMissionInputSummary(); // Called by setLanguage

    }); // End DOMContentLoaded
    </script>

</body>
</html>