<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check: Module 23 - Reading from Files</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Less relevant here */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14;
            --check-color: #6f42c1;
            --certificate-color: #d63384;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            padding-top: 20px; /* Space for return button */
        }

        /* --- Page Header --- */
        .page-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        .header-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }
        .page-header h1 {
            font-family: var(--font-title);
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
         .page-header .module-topics {
            font-size: 0.9rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 0.8rem auto;
        }
         .page-header .module-topics code { background-color: rgba(0,0,0,0.2); color: var(--text-light); padding: 0.1em 0.4em; border-radius: 3px; font-size: 0.9em;}

        /* --- Return Button --- */
        .return-link {
            position: absolute;
            top: 25px;
            left: 25px;
            display: inline-flex;
            align-items: center;
            padding: 0.6rem 1.2rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: background-color var(--transition-speed);
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 10; /* Ensure it's above header gradient if overlapping */
        }
        .return-link:hover {
            background-color: rgba(255, 255, 255, 0.25);
            color: #fff;
        }
        .return-link i {
            margin-right: 8px;
        }

        /* --- Quiz Container --- */
        .kc-container {
            max-width: 900px;
            margin: 0 auto 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        /* --- Language Switcher (Standalone) --- */
        .language-switcher-standalone {
             max-width: 200px; /* Limit width */
             margin: 0 auto 1.5rem auto; /* Center it */
        }
        .language-switcher-standalone select {
            width: 100%;
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 8px 35px 8px 15px; /* More padding */
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease;
         }
        .language-switcher-standalone select:hover { border-color: #b02a6e; }
        .language-switcher-standalone select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
        .language-switcher-standalone select option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Quiz Instructions & Questions --- */
        .kc-instructions {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .kc-instructions strong { color: var(--text-dark); }

        .question-block {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .question-block:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .question-block p {
            font-weight: 500;
            margin-bottom: 1rem;
            font-size: 1.05rem;
        }
        .question-block p code { /* Style code within questions */
             background-color: #e9ecef;
             padding: 0.1em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e;
        }

        .options-group {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        .options-group label {
            display: block;
            padding: 0.7rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
            background-color: #fdfdfd;
        }
        .options-group label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }
        .options-group input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--primary-color); /* Modern browser styling for radio */
        }
         .options-group label code { /* Style code within options */
             background-color: #e0e0e0;
             padding: 0.1em 0.4em;
             border-radius: 3px;
             font-size: 0.9em;
             color: #c7254e;
        }


        /* --- Submit Button --- */
        #submit-quiz {
            display: block;
            width: 100%;
            padding: 0.9rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-light);
            background-color: var(--check-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s ease;
            margin-top: 2.5rem;
            font-family: var(--font-title);
        }
        #submit-quiz:hover {
            background-color: #5a359a; /* Darker purple */
        }
         #submit-quiz:active {
             transform: scale(0.99);
         }

        /* --- Results Area --- */
        #quiz-results {
            display: none; /* Hidden initially */
            padding: 2rem;
            margin-top: 2rem;
            border-radius: var(--border-radius);
            text-align: center;
        }
        #quiz-results.pass {
            background-color: #d1e7dd; /* Light green */
            border: 1px solid var(--success-color);
        }
        #quiz-results.fail {
            background-color: #f8d7da; /* Light red */
            border: 1px solid var(--error-color);
        }
        #quiz-results h3 {
            font-family: var(--font-title);
            margin-bottom: 0.8rem;
            font-size: 1.6rem;
        }
        #quiz-results .score-display {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        #quiz-results .result-message {
            margin-bottom: 1.5rem;
            font-size: 1.05rem;
        }
         #quiz-results .pass .result-message { color: var(--success-color); }
         #quiz-results .fail .result-message { color: var(--error-color); }

        #retry-button {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
            margin-top: 1rem;
        }
        #retry-button:hover {
            background-color: #5a6268;
        }

        /* --- Footer --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 992px) {
            .kc-container { padding: 1.5rem; margin: 0 1rem 2rem 1rem; }
            .page-header h1 { font-size: 1.8rem; }
            .return-link { top: 15px; left: 15px; padding: 0.5rem 1rem; }
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
             .kc-container { padding: 1rem; margin: 0 0.5rem 1.5rem 0.5rem; }
            .page-header { padding: 1rem 1rem 0.8rem 1rem; }
            .page-header h1 { font-size: 1.6rem; }
            .return-link { top: 10px; left: 10px; font-size: 0.9rem; padding: 0.4rem 0.8rem; }
            .question-block p { font-size: 1rem; }
            .options-group label { padding: 0.6rem 0.8rem; font-size: 0.95rem;}
            #submit-quiz { font-size: 1rem; padding: 0.8rem 1rem;}
            #quiz-results { padding: 1.5rem; }
            #quiz-results h3 { font-size: 1.4rem; }
        }
         @media (max-width: 576px) {
             body { padding-top: 60px; /* More space for smaller return button */ }
             .return-link { top: 10px; left: 10px; width: calc(100% - 20px); /* Full width */ justify-content: center; }
             .page-header { margin-top: 10px; border-radius: 0;} /* Adjust margin */
             .language-switcher-standalone { max-width: 100%; padding: 0 1rem;}
             .kc-container { margin: 0; border-radius: 0; box-shadow: none; border: none; border-top: 1px solid var(--border-color); padding: 1rem 0.5rem;}

         }
    </style>
</head>
<body>

    <a href="ctp-dashboard.html" class="return-link">
        <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
    </a>

    <header class="page-header">
        <div class="header-content">
            <h1 data-translate="kc_title">Module 23: Knowledge Check</h1>
            <p class="module-topics" data-translate="kc_module_topics">Topics: <code>open('r')</code>, <code>.read()</code>, <code>.readline()</code>, <code>.readlines()</code>, <code>with</code> statement, file handling.</p>
        </div>
    </header>

    <main class="kc-container">

        <!-- Language Switcher -->
        <div class="language-switcher-standalone">
             <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>

        <p class="kc-instructions" data-translate="kc_instructions">
            Answer the following 10 questions about reading from files in Python. You need at least <strong>6 correct answers</strong> to pass. You can retake this check as many times as you need. Good luck!
        </p>

        <form id="quiz-form">
            <div id="quiz-questions">
                <!-- Questions will be loaded here by JavaScript -->
                <p data-translate="loading_text">Loading questions...</p>
            </div>

            <button type="submit" id="submit-quiz" data-translate="submit_button">Submit Answers</button>
        </form>

        <div id="quiz-results">
            <h3 data-translate="results_title">Quiz Results</h3>
            <p class="score-display" id="score-display" data-translate="score_template">Your Score: {score}/10</p>
            <p class="result-message" id="result-message"></p>
            <button type="button" id="retry-button" data-translate="retry_button">Retry Quiz</button>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const MODULE_ID = 23; // <<< Set the Module ID here
        const PASSING_SCORE = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1'; // Same key as dashboard
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object ---
        const translations = {
             en: {
                 "page_title": `Knowledge Check: Module ${MODULE_ID} - Reading from Files`,
                 "return_button": "Return to Dashboard",
                 "kc_title": `Module ${MODULE_ID}: Knowledge Check`,
                 "kc_module_topics": "Topics: <code>open('r')</code>, <code>.read()</code>, <code>.readline()</code>, <code>.readlines()</code>, <code>with</code> statement, file handling.",
                 "kc_instructions": "Answer the following 10 questions about reading from files in Python. You need at least <strong>6 correct answers</strong> to pass. You can retake this check as many times as you need. Good luck!",
                 "loading_text": "Loading questions...",
                 "submit_button": "Submit Answers",
                 "results_title": "Quiz Results",
                 "score_template": "Your Score: {score}/10",
                 "result_pass": "Congratulations! You passed the knowledge check for this module. Your progress has been updated.",
                 "result_fail": "You didn't pass this time ({score}/10). Review the material and try again!",
                 "retry_button": "Retry Quiz",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 "lang_select_aria": "Select Language",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 23 Questions (English) ---
                 "kc23_q1_question": "Which mode is used with the `open()` function to read an existing text file?",
                 "kc23_q1_op1": "`'r'` (read mode)",
                 "kc23_q1_op2": "`'w'` (write mode)",
                 "kc23_q1_op3": "`'a'` (append mode)",
                 "kc23_q1_op4": "`'x'` (exclusive creation mode)",
                 "kc23_q2_question": "What does the `file.read()` method typically return when called without arguments?",
                 "kc23_q2_op1": "The entire content of the file as a single string.",
                 "kc23_q2_op2": "The first line of the file as a string.",
                 "kc23_q2_op3": "A list containing each line of the file as separate strings.",
                 "kc23_q2_op4": "The number of characters in the file.",
                 "kc23_q3_question": "What is the primary advantage of using the `with open(...) as f:` syntax?",
                 "kc23_q3_op1": "It automatically closes the file, even if errors occur.",
                 "kc23_q3_op2": "It automatically reads the entire file into memory.",
                 "kc23_q3_op3": "It makes the file read-only.",
                 "kc23_q3_op4": "It allows writing and reading simultaneously.",
                 "kc23_q4_question": "Which method reads a single line from a file, including the newline character (`\\n`) if present?",
                 "kc23_q4_op1": "`file.readline()`",
                 "kc23_q4_op2": "`file.read()`",
                 "kc23_q4_op3": "`file.readlines()`",
                 "kc23_q4_op4": "`file.getline()`",
                 "kc23_q5_question": "What does `file.readlines()` return?",
                 "kc23_q5_op1": "A list where each element is a string representing a line from the file.",
                 "kc23_q5_op2": "A single string containing all lines.",
                 "kc23_q5_op3": "An iterator object to loop over lines.",
                 "kc23_q5_op4": "The total number of lines in the file.",
                 "kc23_q6_question": "If you open a file that doesn't exist using mode `'r'`, what happens?",
                 "kc23_q6_op1": "A `FileNotFoundError` occurs.",
                 "kc23_q6_op2": "An empty file is created.",
                 "kc23_q6_op3": "The program waits indefinitely.",
                 "kc23_q6_op4": "It returns `None`.",
                 "kc23_q7_question": "How can you typically iterate over the lines of a file object `f` opened with `with`?",
                 "kc23_q7_op1": "`for line in f:`",
                 "kc23_q7_op2": "`for line in f.read():`",
                 "kc23_q7_op3": "`while f.has_line():`",
                 "kc23_q7_op4": "`f.iterate_lines()`",
                 "kc23_q8_question": "After executing `line = f.readline()` once, where is the file's 'cursor' or current position?",
                 "kc23_q8_op1": "At the beginning of the next line.",
                 "kc23_q8_op2": "At the end of the file.",
                 "kc23_q8_op3": "At the beginning of the file.",
                 "kc23_q8_op4": "Still at the beginning of the first line.",
                 "kc23_q9_question": "Consider the file `data.txt` contains:\n`Line 1\nLine 2`\nWhat will `f.read(5)` return after opening the file?",
                 "kc23_q9_op1": "`'Line '`",
                 "kc23_q9_op2": "`'Line 1'`",
                 "kc23_q9_op3": "`'Line 1\\n'`",
                 "kc23_q9_op4": "`'Line 1\\nL'`",
                 "kc23_q10_question": "Why is it generally recommended to use `with open(...)` instead of manually calling `f.close()`?",
                 "kc23_q10_op1": "It ensures the file is closed even if errors happen inside the `with` block.",
                 "kc23_q10_op2": "It makes the code significantly faster.",
                 "kc23_q10_op3": "`f.close()` doesn't always work reliably.",
                 "kc23_q10_op4": "The `with` statement automatically handles file encoding.",
             },
             pt: {
                 "page_title": `Verificação de Conhecimento: Módulo ${MODULE_ID} - Lendo Arquivos`,
                 "return_button": "Voltar ao Painel",
                 "kc_title": `Módulo ${MODULE_ID}: Verificação de Conhecimento`,
                 "kc_module_topics": "Tópicos: <code>open('r')</code>, <code>.read()</code>, <code>.readline()</code>, <code>.readlines()</code>, declaração <code>with</code>, manipulação de arquivos.",
                 "kc_instructions": "Responda às 10 perguntas seguintes sobre leitura de arquivos em Python. Você precisa de pelo menos <strong>6 respostas corretas</strong> para passar. Você pode refazer esta verificação quantas vezes precisar. Boa sorte!",
                 "loading_text": "Carregando perguntas...",
                 "submit_button": "Enviar Respostas",
                 "results_title": "Resultados do Quiz",
                 "score_template": "Sua Pontuação: {score}/10",
                 "result_pass": "Parabéns! Você passou na verificação de conhecimento para este módulo. Seu progresso foi atualizado.",
                 "result_fail": "Você não passou desta vez ({score}/10). Revise o material e tente novamente!",
                 "retry_button": "Tentar Novamente",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 "lang_select_aria": "Selecionar Idioma",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 23 Questions (Portuguese) ---
                 "kc23_q1_question": "Qual modo é usado com a função `open()` para ler um arquivo de texto existente?",
                 "kc23_q1_op1": "`'r'` (modo leitura)",
                 "kc23_q1_op2": "`'w'` (modo escrita)",
                 "kc23_q1_op3": "`'a'` (modo anexar)",
                 "kc23_q1_op4": "`'x'` (modo criação exclusiva)",
                 "kc23_q2_question": "O que o método `file.read()` normalmente retorna quando chamado sem argumentos?",
                 "kc23_q2_op1": "Todo o conteúdo do arquivo como uma única string.",
                 "kc23_q2_op2": "A primeira linha do arquivo como uma string.",
                 "kc23_q2_op3": "Uma lista contendo cada linha do arquivo como strings separadas.",
                 "kc23_q2_op4": "O número de caracteres no arquivo.",
                 "kc23_q3_question": "Qual é a principal vantagem de usar a sintaxe `with open(...) as f:`?",
                 "kc23_q3_op1": "Ele fecha automaticamente o arquivo, mesmo que ocorram erros.",
                 "kc23_q3_op2": "Ele lê automaticamente o arquivo inteiro para a memória.",
                 "kc23_q3_op3": "Torna o arquivo somente leitura.",
                 "kc23_q3_op4": "Permite escrever e ler simultaneamente.",
                 "kc23_q4_question": "Qual método lê uma única linha de um arquivo, incluindo o caractere de nova linha (`\\n`) se presente?",
                 "kc23_q4_op1": "`file.readline()`",
                 "kc23_q4_op2": "`file.read()`",
                 "kc23_q4_op3": "`file.readlines()`",
                 "kc23_q4_op4": "`file.getline()`",
                 "kc23_q5_question": "O que `file.readlines()` retorna?",
                 "kc23_q5_op1": "Uma lista onde cada elemento é uma string representando uma linha do arquivo.",
                 "kc23_q5_op2": "Uma única string contendo todas as linhas.",
                 "kc23_q5_op3": "Um objeto iterador para percorrer as linhas.",
                 "kc23_q5_op4": "O número total de linhas no arquivo.",
                 "kc23_q6_question": "Se você abrir um arquivo que não existe usando o modo `'r'`, o que acontece?",
                 "kc23_q6_op1": "Ocorre um `FileNotFoundError`.",
                 "kc23_q6_op2": "Um arquivo vazio é criado.",
                 "kc23_q6_op3": "O programa espera indefinidamente.",
                 "kc23_q6_op4": "Retorna `None`.",
                 "kc23_q7_question": "Como você pode tipicamente iterar sobre as linhas de um objeto de arquivo `f` aberto com `with`?",
                 "kc23_q7_op1": "`for line in f:`",
                 "kc23_q7_op2": "`for line in f.read():`",
                 "kc23_q7_op3": "`while f.has_line():`",
                 "kc23_q7_op4": "`f.iterate_lines()`",
                 "kc23_q8_question": "Após executar `line = f.readline()` uma vez, onde está o 'cursor' ou posição atual do arquivo?",
                 "kc23_q8_op1": "No início da próxima linha.",
                 "kc23_q8_op2": "No final do arquivo.",
                 "kc23_q8_op3": "No início do arquivo.",
                 "kc23_q8_op4": "Ainda no início da primeira linha.",
                 "kc23_q9_question": "Considere que o arquivo `data.txt` contém:\n`Line 1\nLine 2`\nO que `f.read(5)` retornará após abrir o arquivo?",
                 "kc23_q9_op1": "`'Line '`",
                 "kc23_q9_op2": "`'Line 1'`",
                 "kc23_q9_op3": "`'Line 1\\n'`",
                 "kc23_q9_op4": "`'Line 1\\nL'`",
                 "kc23_q10_question": "Por que geralmente é recomendado usar `with open(...)` em vez de chamar manualmente `f.close()`?",
                 "kc23_q10_op1": "Garante que o arquivo seja fechado mesmo se ocorrerem erros dentro do bloco `with`.",
                 "kc23_q10_op2": "Torna o código significativamente mais rápido.",
                 "kc23_q10_op3": "`f.close()` nem sempre funciona de forma confiável.",
                 "kc23_q10_op4": "A declaração `with` lida automaticamente com a codificação do arquivo.",
             },
             zh: {
                 "page_title": `知识测验：模块 ${MODULE_ID} - 读取文件`,
                 "return_button": "返回仪表板",
                 "kc_title": `模块 ${MODULE_ID}：知识测验`,
                 "kc_module_topics": "主题：<code>open('r')</code>, <code>.read()</code>, <code>.readline()</code>, <code>.readlines()</code>, <code>with</code> 语句, 文件处理。",
                 "kc_instructions": "回答以下关于在 Python 中读取文件的 10 个问题。您至少需要答对 <strong>6 道题</strong> 才能通过。您可以根据需要多次重做此测验。祝您好运！",
                 "loading_text": "正在加载问题...",
                 "submit_button": "提交答案",
                 "results_title": "测验结果",
                 "score_template": "您的得分：{score}/10",
                 "result_pass": "恭喜！您通过了本模块的知识测验。您的进度已更新。",
                 "result_fail": "您这次没有通过 ({score}/10)。请复习相关内容后重试！",
                 "retry_button": "重新测验",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 "lang_select_aria": "选择语言",
                 "lang_en": "🇬🇧 English",
                 "lang_pt": "🇧🇷 Português",
                 "lang_zh": "🇨🇳 中文",
                 // --- Module 23 Questions (Chinese) ---
                 "kc23_q1_question": "使用 `open()` 函数读取现有文本文件时，应使用哪种模式？",
                 "kc23_q1_op1": "`'r'` (读取模式)",
                 "kc23_q1_op2": "`'w'` (写入模式)",
                 "kc23_q1_op3": "`'a'` (追加模式)",
                 "kc23_q1_op4": "`'x'` (独占创建模式)",
                 "kc23_q2_question": "不带参数调用 `file.read()` 方法通常返回什么？",
                 "kc23_q2_op1": "文件的全部内容，作为一个字符串。",
                 "kc23_q2_op2": "文件的第一行，作为一个字符串。",
                 "kc23_q2_op3": "一个列表，包含文件的每一行作为独立的字符串。",
                 "kc23_q2_op4": "文件中的字符数。",
                 "kc23_q3_question": "使用 `with open(...) as f:` 语法的主要优点是什么？",
                 "kc23_q3_op1": "即使发生错误，它也能自动关闭文件。",
                 "kc23_q3_op2": "它自动将整个文件读入内存。",
                 "kc23_q3_op3": "它使文件变为只读。",
                 "kc23_q3_op4": "它允许同时进行读写操作。",
                 "kc23_q4_question": "哪个方法从文件中读取单行，如果存在换行符 (`\\n`) 则包含它？",
                 "kc23_q4_op1": "`file.readline()`",
                 "kc23_q4_op2": "`file.read()`",
                 "kc23_q4_op3": "`file.readlines()`",
                 "kc23_q4_op4": "`file.getline()`",
                 "kc23_q5_question": "`file.readlines()` 返回什么？",
                 "kc23_q5_op1": "一个列表，其中每个元素是代表文件中一行的字符串。",
                 "kc23_q5_op2": "一个包含所有行的单一字符串。",
                 "kc23_q5_op3": "一个用于遍历行的迭代器对象。",
                 "kc23_q5_op4": "文件中的总行数。",
                 "kc23_q6_question": "如果你使用 `'r'` 模式打开一个不存在的文件，会发生什么？",
                 "kc23_q6_op1": "发生 `FileNotFoundError` 错误。",
                 "kc23_q6_op2": "创建一个空文件。",
                 "kc23_q6_op3": "程序无限期等待。",
                 "kc23_q6_op4": "返回 `None`。",
                 "kc23_q7_question": "对于用 `with` 打开的文件对象 `f`，通常如何迭代其行？",
                 "kc23_q7_op1": "`for line in f:`",
                 "kc23_q7_op2": "`for line in f.read():`",
                 "kc23_q7_op3": "`while f.has_line():`",
                 "kc23_q7_op4": "`f.iterate_lines()`",
                 "kc23_q8_question": "执行一次 `line = f.readline()` 后，文件的“光标”或当前位置在哪里？",
                 "kc23_q8_op1": "在下一行的开头。",
                 "kc23_q8_op2": "在文件的末尾。",
                 "kc23_q8_op3": "在文件的开头。",
                 "kc23_q8_op4": "仍然在第一行的开头。",
                 "kc23_q9_question": "假设文件 `data.txt` 包含：\n`Line 1\nLine 2`\n打开文件后，`f.read(5)` 将返回什么？",
                 "kc23_q9_op1": "`'Line '`",
                 "kc23_q9_op2": "`'Line 1'`",
                 "kc23_q9_op3": "`'Line 1\\n'`",
                 "kc23_q9_op4": "`'Line 1\\nL'`",
                 "kc23_q10_question": "为什么通常推荐使用 `with open(...)` 而不是手动调用 `f.close()`？",
                 "kc23_q10_op1": "即使 `with` 块内部发生错误，它也能确保文件被关闭。",
                 "kc23_q10_op2": "它使代码运行速度显著加快。",
                 "kc23_q10_op3": "`f.close()` 并不总是可靠地工作。",
                 "kc23_q10_op4": "`with` 语句会自动处理文件编码。",
             }
         };

        // --- Quiz Data Structure ---
        const quizData = [
            // Q1
            { question_key: "kc23_q1_question", options_keys: ["kc23_q1_op1", "kc23_q1_op2", "kc23_q1_op3", "kc23_q1_op4"], correct_index: 0 },
            // Q2
            { question_key: "kc23_q2_question", options_keys: ["kc23_q2_op1", "kc23_q2_op2", "kc23_q2_op3", "kc23_q2_op4"], correct_index: 0 },
             // Q3
            { question_key: "kc23_q3_question", options_keys: ["kc23_q3_op1", "kc23_q3_op2", "kc23_q3_op3", "kc23_q3_op4"], correct_index: 0 },
            // Q4
            { question_key: "kc23_q4_question", options_keys: ["kc23_q4_op1", "kc23_q4_op2", "kc23_q4_op3", "kc23_q4_op4"], correct_index: 0 },
             // Q5
            { question_key: "kc23_q5_question", options_keys: ["kc23_q5_op1", "kc23_q5_op2", "kc23_q5_op3", "kc23_q5_op4"], correct_index: 0 },
            // Q6
            { question_key: "kc23_q6_question", options_keys: ["kc23_q6_op1", "kc23_q6_op2", "kc23_q6_op3", "kc23_q6_op4"], correct_index: 0 },
             // Q7
            { question_key: "kc23_q7_question", options_keys: ["kc23_q7_op1", "kc23_q7_op2", "kc23_q7_op3", "kc23_q7_op4"], correct_index: 0 },
            // Q8
            { question_key: "kc23_q8_question", options_keys: ["kc23_q8_op1", "kc23_q8_op2", "kc23_q8_op3", "kc23_q8_op4"], correct_index: 0 },
             // Q9
            { question_key: "kc23_q9_question", options_keys: ["kc23_q9_op1", "kc23_q9_op2", "kc23_q9_op3", "kc23_q9_op4"], correct_index: 0 },
            // Q10
            { question_key: "kc23_q10_question", options_keys: ["kc23_q10_op1", "kc23_q10_op2", "kc23_q10_op3", "kc23_q10_op4"], correct_index: 0 },
        ];


        // --- Core Functions ---
        function getStoredLanguage() {
            const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
            if (storedLang && translations[storedLang]) return storedLang;
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith('pt')) return 'pt';
            if (browserLang.startsWith('zh')) return 'zh';
            return 'en'; // Default
        }

         function getTranslation(key, lang, replacements = {}) {
             let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; // Fallback chain
             for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                 text = text.replace(regex, replacements[placeholder]);
             }
             return text;
         }

        function translatePage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback

            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = getTranslation(key, lang);
                if (el.tagName === 'TITLE') {
                    document.title = getTranslation(key, lang, {MODULE_ID: MODULE_ID}); // Update title with module ID
                } else if (key === 'kc_title') {
                     el.innerHTML = getTranslation(key, lang, {MODULE_ID: MODULE_ID}); // Update header with module ID
                } else if (translation.includes('<') && translation.includes('>')) { // Allow HTML in translations
                    el.innerHTML = translation;
                } else {
                    el.textContent = translation;
                }
            });

             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang));
             });
        }

        function setLanguage(lang) {
            if (!translations[lang]) lang = 'en'; // Fallback
            localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
            document.documentElement.lang = lang;

            // Update language selector value
            const langSelect = document.getElementById('languageSelect');
            if (langSelect) langSelect.value = lang;

            // Re-translate page elements AND re-render the quiz
            translatePage(lang);
            renderQuiz(lang); // Important: Re-render quiz with new language
        }

        // --- LocalStorage for Progress ---
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                // Basic validation: ensure it's an object
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {}; // Return empty object on error
            }
        }

        function saveKnowledgeCheckStatus(statusObject) {
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }

        function markModuleComplete(moduleId) {
            const currentStatus = loadKnowledgeCheckStatus();
            currentStatus[moduleId] = true; // Mark as complete (passed)
            saveKnowledgeCheckStatus(currentStatus);
            console.log(`Module ${moduleId} marked as complete in localStorage.`);
        }

        // --- Quiz Rendering ---
        function renderQuiz(lang) {
            const questionsContainer = document.getElementById('quiz-questions');
            questionsContainer.innerHTML = ''; // Clear previous questions/loading text

            quizData.forEach((qData, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';

                const questionText = document.createElement('p');
                // Use innerHTML for questions to allow <code> tags from translation
                questionText.innerHTML = `${index + 1}. ${getTranslation(qData.question_key, lang)}`;
                questionBlock.appendChild(questionText);

                const optionsGroup = document.createElement('div');
                optionsGroup.className = 'options-group';

                qData.options_keys.forEach((optionKey, optionIndex) => {
                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q${index}`;
                    input.value = optionIndex; // Store the index as the value

                    const optionText = document.createElement('span');
                     // Use innerHTML for options to allow <code> tags
                    optionText.innerHTML = ` ${getTranslation(optionKey, lang)}`; // Add space after radio

                    label.appendChild(input);
                    label.appendChild(optionText);
                    optionsGroup.appendChild(label);
                });

                questionBlock.appendChild(optionsGroup);
                questionsContainer.appendChild(questionBlock);
            });
        }

         // --- Quiz Submission and Results ---
         function handleSubmitQuiz(event) {
             event.preventDefault(); // Prevent default form submission

             let score = 0;
             const questions = document.querySelectorAll('.question-block');

             questions.forEach((question, index) => {
                 const selectedOption = question.querySelector(`input[name="q${index}"]:checked`);
                 if (selectedOption) {
                     const selectedIndex = parseInt(selectedOption.value, 10);
                     if (selectedIndex === quizData[index].correct_index) {
                         score++;
                     }
                 }
             });

             displayResults(score);
         }

         function displayResults(score) {
             const resultsDiv = document.getElementById('quiz-results');
             const scoreDisplay = document.getElementById('score-display');
             const resultMessage = document.getElementById('result-message');
             const questionsDiv = document.getElementById('quiz-questions');
             const submitButton = document.getElementById('submit-quiz');
             const lang = getStoredLanguage();

             const passed = score >= PASSING_SCORE;

             // Update score text
             scoreDisplay.textContent = getTranslation('score_template', lang, { score: score });

             // Set result message and styling
             if (passed) {
                 resultMessage.textContent = getTranslation('result_pass', lang);
                 resultsDiv.className = 'pass'; // Add pass class
                 markModuleComplete(MODULE_ID); // Update localStorage only if passed
             } else {
                 resultMessage.textContent = getTranslation('result_fail', lang, { score: score });
                 resultsDiv.className = 'fail'; // Add fail class
             }

             // Show/Hide elements
             questionsDiv.style.display = 'none';
             submitButton.style.display = 'none';
             resultsDiv.style.display = 'block';
         }

         function handleRetryQuiz() {
             const resultsDiv = document.getElementById('quiz-results');
             const questionsDiv = document.getElementById('quiz-questions');
             const submitButton = document.getElementById('submit-quiz');
             const form = document.getElementById('quiz-form');

             // Reset form selections
             form.reset();

             // Hide results, show questions/submit button
             resultsDiv.style.display = 'none';
             resultsDiv.className = ''; // Remove pass/fail class
             questionsDiv.style.display = 'block';
             submitButton.style.display = 'block';

             // Optional: Scroll back to the top
             window.scrollTo(0, 0);
         }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            const initialLang = getStoredLanguage();
            const languageSelect = document.getElementById('languageSelect');
            const quizForm = document.getElementById('quiz-form');
            const retryButton = document.getElementById('retry-button');

             // Set initial language state
            document.documentElement.lang = initialLang;
            if (languageSelect) languageSelect.value = initialLang;

             // Initial translation and quiz rendering
            translatePage(initialLang);
            renderQuiz(initialLang);

            // Language switcher listener
            if (languageSelect) {
                languageSelect.addEventListener('change', (e) => {
                    setLanguage(e.target.value);
                });
            }

            // Quiz submit listener
            if (quizForm) {
                quizForm.addEventListener('submit', handleSubmitQuiz);
            }

            // Retry button listener
            if (retryButton) {
                retryButton.addEventListener('click', handleRetryQuiz);
            }
        });

    </script>

</body>
</html>
