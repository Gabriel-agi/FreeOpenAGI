<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="page_title">Knowledge Check - Module 23</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Used for progress */
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            /* Colors for lang switcher (Might not be needed directly on this page, but good for consistency) */
            --lang-select-border: var(--certificate-color); /* Reuse a distinct color */
            --lang-select-bg: rgba(255, 255, 255, 0.1);
            --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
            --lang-option-bg: var(--background-card);
            --lang-option-text: var(--text-dark);
            --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Knowledge Check Specific Styles --- */
        .kc-header {
            background: linear-gradient(135deg, #0d6efd, #0a58ca); /* Match dashboard header */
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            text-decoration: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .back-button i { margin-right: 6px; }
        .back-button:hover { background-color: rgba(255, 255, 255, 0.25); }

        .kc-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            flex-grow: 1; /* Makes container take available space */
        }

        .kc-instructions {
            margin-bottom: 1.5rem;
            font-size: 1rem;
            color: var(--text-muted);
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 1rem;
        }
        .kc-instructions strong { color: var(--text-dark); }
        .kc-instructions i { color: var(--check-color); margin-right: 4px;}


        #question-counter {
             font-size: 0.9rem;
             color: var(--text-muted);
             text-align: right;
             margin-bottom: 0.5rem;
             font-weight: 500;
        }

        .kc-question-area {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-dark);
        }
        .kc-question-area code {
            background-color: #e9ecef;
            padding: 0.15em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
            color: #c7254e;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            display: block; /* Make code blocks stand alone */
            margin-top: 0.5em;
            white-space: pre-wrap; /* Wrap long code lines */
            border: 1px solid #ddd;
        }

        .kc-options {
            list-style: none;
            padding: 0;
            margin: 0 0 1.5rem 0;
        }

        .kc-option {
            margin-bottom: 0.8rem;
        }

        .kc-option label {
            display: block; /* Make label take full width */
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            position: relative; /* For pseudo-elements if needed */
            background-color: #fdfdfd;
        }
        .kc-option label:hover {
            background-color: #f8f9fa;
            border-color: var(--secondary-color);
        }

        .kc-option input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
            accent-color: var(--primary-color); /* Style the radio button itself */
            width: 16px;
            height: 16px;
        }

        /* Styles for feedback after submission */
        .kc-option input[type="radio"]:disabled + label {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .kc-option label.correct {
            border-color: var(--success-color);
            background-color: #d1e7dd;
            color: #0f5132;
            font-weight: 500;
        }
         .kc-option label.correct::after {
             content: '\f00c'; /* Font Awesome check icon */
             font-family: 'Font Awesome 6 Free';
             font-weight: 900;
             position: absolute;
             right: 1rem;
             top: 50%;
             transform: translateY(-50%);
             color: var(--success-color);
         }
        .kc-option label.incorrect {
            border-color: var(--error-color);
            background-color: #f8d7da;
            color: #842029;
        }
        .kc-option input[type="radio"]:checked + label.incorrect::after {
             content: '\f00d'; /* Font Awesome times icon */
             font-family: 'Font Awesome 6 Free';
             font-weight: 900;
             position: absolute;
             right: 1rem;
             top: 50%;
             transform: translateY(-50%);
             color: var(--error-color);
         }


        .kc-feedback {
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            padding: 0.8rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
        }
        .kc-feedback.correct {
            background-color: #d1e7dd; /* Lighter success */
            color: #0f5132; /* Darker success text */
            border: 1px solid var(--success-color);
        }
        .kc-feedback.incorrect {
            background-color: #f8d7da; /* Lighter error */
            color: #842029; /* Darker error text */
            border: 1px solid var(--error-color);
        }
        .kc-feedback strong {
            display: block;
            margin-bottom: 0.3rem;
        }
        .kc-feedback code {
             background-color: rgba(0, 0, 0, 0.05);
             padding: 0.1em 0.3em;
             border-radius: 3px;
             font-size: 0.9em;
        }

        .kc-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            background-color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, transform 0.1s ease;
            text-align: center;
            min-width: 120px;
        }
        .kc-button:hover { background-color: #0b5ed7; }
        .kc-button:active { transform: scale(0.98); }
        .kc-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }
        .kc-button.retry-button { background-color: var(--success-color); }
        .kc-button.retry-button:hover { background-color: #157347; }

        .kc-navigation {
             margin-top: 1.5rem;
             text-align: right; /* Position button to the right */
        }

        .kc-results {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: center;
        }
        .kc-results.passed { background-color: #d1e7dd; border: 1px solid var(--success-color); }
        .kc-results.failed { background-color: #f8d7da; border: 1px solid var(--error-color); }

        .kc-results h2 {
            font-family: var(--font-title);
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
        .kc-results p { margin-bottom: 1rem; font-size: 1.1rem; }
        .kc-results .score { font-weight: 700; font-size: 1.3rem; color: var(--primary-color); }
        .kc-results.passed .score { color: var(--success-color); }
        .kc-results.failed .score { color: var(--error-color); }
        .kc-results .pass-fail-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .kc-results.passed .pass-fail-icon { color: var(--success-color); }
        .kc-results.failed .pass-fail-icon { color: var(--error-color); }
        .kc-results .message { font-weight: 500; }

        /* Language Switcher Styles */
        .language-switcher {
           position: relative; /* Needed for absolute positioning of dropdown arrow */
           display: inline-block; /* Fit content width */
           margin-left: 1rem;
        }

        #languageSelect {
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 6px 30px 6px 12px; /* Space for text and arrow */
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            /* Simple inline SVG arrow */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 8px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: var(--lang-select-bg-hover); }
        #languageSelect:focus { outline: none; border-color: var(--accent-color); }
        #languageSelect option {
             background: var(--lang-option-bg);
             color: var(--lang-option-text);
             padding: 5px;
        }


        footer {
             text-align: center;
             padding: 1.5rem;
             margin-top: 2rem; /* Ensure space above footer */
             background-color: var(--background-card);
             border-top: 1px solid var(--border-color);
             color: var(--text-muted);
             font-size: 0.9rem;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header h1 { font-size: 1.4rem; }
            .back-button { padding: 0.4rem 0.8rem; font-size: 0.85rem;}
            .kc-container { margin: 1rem; padding: 1.5rem; }
            .kc-question-area { font-size: 1.05rem; }
            .kc-option label { padding: 0.7rem 0.9rem; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .kc-header { padding: 0.8rem 1rem; flex-direction: column; align-items: flex-start;}
            .kc-header h1 { margin-bottom: 0.5rem; font-size: 1.3rem; }
            .language-switcher { margin-left: 0; margin-top: 0.5rem;} /* Adjust lang switcher position */
            .kc-container { margin: 1rem 0.5rem; padding: 1rem; }
            .kc-question-area { font-size: 1rem; }
            .kc-option label { padding: 0.6rem 0.8rem; }
            .kc-button { width: 100%; /* Make buttons full width */}
            .kc-navigation { text-align: center; } /* Center button on small screens */
             footer { font-size: 0.85rem; }
        }

    </style>
</head>
<body>

    <header class="kc-header">
         <a href="ctp-dashboard.html" class="back-button">
             <i class="fas fa-arrow-left"></i> <span data-translate="back_button">Back to Dashboard</span>
         </a>
        <h1 data-translate="module_23_kc.title">Knowledge Check - Module 23: Reading from Files</h1>
         <!-- Language Switcher -->
         <div class="language-switcher">
             <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                 <option value="en" data-translate="lang_en">🇬🇧 English</option>
                 <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                 <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
             </select>
         </div>
    </header>

    <main class="kc-container">
        <div class="kc-instructions">
            <p><i class="fas fa-tasks"></i> <span data-translate="module_23_kc.instructions">Answer the 10 questions below. You need at least 6 correct answers to pass this check. Good luck!</span></p>
        </div>

        <div id="quiz-area">
             <div id="question-counter"></div>
             <div class="kc-question-area" id="question-text">
                 <!-- Question text loads here -->
             </div>
             <ul class="kc-options" id="options-list">
                 <!-- Options load here -->
             </ul>
             <div class="kc-feedback" id="feedback-area" style="display: none;">
                 <!-- Feedback loads here -->
             </div>
             <div class="kc-navigation">
                 <button class="kc-button" id="submit-button" data-translate="module_23_kc.submit_button">Submit Answer</button>
             </div>
        </div>

        <div class="kc-results" id="results-area" style="display: none;">
            <h2 data-translate="module_23_kc.results_title">Quiz Results</h2>
            <div id="results-icon" class="pass-fail-icon"></div>
            <p><span data-translate="module_23_kc.score_label">Your Score:</span> <span id="score-value" class="score">0 / 10</span></p>
            <p id="results-message" class="message"></p>
            <button class="kc-button retry-button" id="retry-button" data-translate="module_23_kc.retry_button">Retry Quiz</button>
        </div>

    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        const translations = {
             en: {
                 "page_title": "Knowledge Check - Module 23",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "Select Language",
                 "back_button": "Back to Dashboard",
                 "footer_text": "Part of the Road to Free Open AGI Project",
                 "module_23_kc": {
                     "title": "Knowledge Check - Module 23: Reading from Files",
                     "instructions": "Answer the 10 questions below. You need at least 6 correct answers to pass this check. Good luck!",
                     "question_label": "Question {current} of {total}",
                     "correct_feedback": "Correct!",
                     "incorrect_feedback": "Incorrect. The correct answer was:",
                     "select_option_alert": "Please select an answer before submitting.",
                     "submit_button": "Submit Answer",
                     "next_button": "Next Question",
                     "results_title": "Quiz Results",
                     "score_label": "Your Score:",
                     "passed_message": "Congratulations! You passed this knowledge check. Your progress has been updated.",
                     "failed_message": "You scored {score} out of {total}. You need {passingScore} correct answers to pass. Keep trying!",
                     "retry_button": "Retry Quiz",
                     "questions": [
                         { // Q1
                             question: "What is the standard mode argument used with `open()` to open a file for reading text?",
                             options: ["'r'", "'w'", "'a'", "'rb'"],
                             correctAnswer: 0
                         },
                         { // Q2
                             question: "What is the primary advantage of using the `with open(...) as file:` syntax?",
                             options: [
                                 "It automatically imports the necessary file modules.",
                                 "It makes the code shorter.",
                                 "It ensures the file is automatically closed, even if errors occur.",
                                 "It reads the file much faster than regular `open()`."
                             ],
                             correctAnswer: 2
                         },
                         { // Q3
                             question: "Which file reading method reads the entire content of the file into a single string?",
                             options: ["`.readline()`", "`.readlines()`", "`.read()`", "`.seek()`"],
                             correctAnswer: 2
                         },
                         { // Q4
                             question: "If you have a file object `f`, what does `line = f.readline()` do?",
                             options: [
                                 "Reads all lines into a list called `line`.",
                                 "Reads the very first line of the file, regardless of previous reads.",
                                 "Reads the next available line from the file into the `line` variable, including the newline character.",
                                 "Reads the entire file content into the `line` variable."
                             ],
                             correctAnswer: 2
                         },
                         { // Q5
                             question: "What data type does the `.readlines()` method typically return?",
                             options: ["A single string", "A list of strings", "A tuple of strings", "An integer (number of lines)"],
                             correctAnswer: 1
                         },
                         { // Q6
                             question: "Consider the following code:\n```python\nlines = []\nwith open('data.txt', 'r') as f:\n    for line in f:\n        lines.append(line.strip())\n```\nWhat is this code snippet doing?",
                             options: [
                                 "Writing the list `lines` to 'data.txt'.",
                                 "Reading each line from 'data.txt', removing leading/trailing whitespace, and adding it to the `lines` list.",
                                 "Counting the number of lines in 'data.txt'.",
                                 "Creating an empty file named 'data.txt'."
                             ],
                             correctAnswer: 1
                         },
                         { // Q7
                             question: "What is the most likely result if you try to open a file that does *not* exist using `open('myfile.txt', 'r')`?",
                             options: [
                                 "An empty string is returned.",
                                 "Python automatically creates the file.",
                                 "A `FileNotFoundError` exception is raised.",
                                 "The program waits indefinitely."
                             ],
                             correctAnswer: 2
                         },
                         { // Q8
                             question: "When reading lines using `.readline()` or iterating directly over the file object (`for line in f:`), what character is usually included at the end of each line (except possibly the last one)?",
                             options: ["A space (' ')", "A tab ('\\t')", "A newline character ('\\n')", "Nothing is added"],
                             correctAnswer: 2
                         },
                         { // Q9
                             question: "True or False: After opening a file using `f = open('notes.txt', 'r')`, it's crucial to call `f.close()` later, especially if you are *not* using a `with` statement.",
                             options: ["True", "False"],
                             correctAnswer: 0 // True
                         },
                         { // Q10
                             question: "If `f.readlines()` returns `['Hello\\n', 'World']`, what does this likely represent?",
                             options: [
                                 "A file with the single line 'Hello\\nWorld'.",
                                 "A file with two lines: 'Hello' on the first, and 'World' on the second.",
                                 "An error during file reading.",
                                 "A file containing only the word 'HelloWorld'."
                             ],
                             correctAnswer: 1
                         }
                     ]
                 }
             },
             pt: {
                 "page_title": "Verificação de Conhecimento - Módulo 23",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "Selecionar Idioma",
                 "back_button": "Voltar ao Painel",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 "module_23_kc": {
                     "title": "Verificação - Módulo 23: Lendo Arquivos",
                     "instructions": "Responda às 10 perguntas abaixo. Você precisa de pelo menos 6 respostas corretas para passar. Boa sorte!",
                     "question_label": "Questão {current} de {total}",
                     "correct_feedback": "Correto!",
                     "incorrect_feedback": "Incorreto. A resposta correta era:",
                     "select_option_alert": "Por favor, selecione uma resposta antes de enviar.",
                     "submit_button": "Enviar Resposta",
                     "next_button": "Próxima Questão",
                     "results_title": "Resultados do Quiz",
                     "score_label": "Sua Pontuação:",
                     "passed_message": "Parabéns! Você passou nesta verificação de conhecimento. Seu progresso foi atualizado.",
                     "failed_message": "Você acertou {score} de {total}. Você precisa de {passingScore} respostas corretas para passar. Continue tentando!",
                     "retry_button": "Tentar Novamente",
                     "questions": [
                         { // Q1
                             question: "Qual é o argumento de modo padrão usado com `open()` para abrir um arquivo para leitura de texto?",
                             options: ["'r'", "'w'", "'a'", "'rb'"],
                             correctAnswer: 0
                         },
                         { // Q2
                             question: "Qual é a principal vantagem de usar a sintaxe `with open(...) as file:`?",
                             options: [
                                 "Importa automaticamente os módulos de arquivo necessários.",
                                 "Torna o código mais curto.",
                                 "Garante que o arquivo seja fechado automaticamente, mesmo se ocorrerem erros.",
                                 "Lê o arquivo muito mais rápido que o `open()` normal."
                             ],
                             correctAnswer: 2
                         },
                         { // Q3
                             question: "Qual método de leitura de arquivo lê todo o conteúdo do arquivo em uma única string?",
                             options: ["`.readline()`", "`.readlines()`", "`.read()`", "`.seek()`"],
                             correctAnswer: 2
                         },
                         { // Q4
                             question: "Se você tem um objeto de arquivo `f`, o que `line = f.readline()` faz?",
                             options: [
                                 "Lê todas as linhas para uma lista chamada `line`.",
                                 "Lê a primeira linha do arquivo, independentemente de leituras anteriores.",
                                 "Lê a próxima linha disponível do arquivo na variável `line`, incluindo o caractere de nova linha.",
                                 "Lê todo o conteúdo do arquivo na variável `line`."
                             ],
                             correctAnswer: 2
                         },
                         { // Q5
                             question: "Qual tipo de dado o método `.readlines()` normalmente retorna?",
                             options: ["Uma única string", "Uma lista de strings", "Uma tupla de strings", "Um inteiro (número de linhas)"],
                             correctAnswer: 1
                         },
                         { // Q6
                             question: "Considere o seguinte código:\n```python\nlines = []\nwith open('data.txt', 'r') as f:\n    for line in f:\n        lines.append(line.strip())\n```\nO que este trecho de código está fazendo?",
                             options: [
                                 "Escrevendo a lista `lines` em 'data.txt'.",
                                 "Lendo cada linha de 'data.txt', removendo espaços em branco no início/fim e adicionando-a à lista `lines`.",
                                 "Contando o número de linhas em 'data.txt'.",
                                 "Criando um arquivo vazio chamado 'data.txt'."
                             ],
                             correctAnswer: 1
                         },
                         { // Q7
                             question: "Qual é o resultado mais provável se você tentar abrir um arquivo que *não* existe usando `open('myfile.txt', 'r')`?",
                             options: [
                                 "Uma string vazia é retornada.",
                                 "Python cria o arquivo automaticamente.",
                                 "Uma exceção `FileNotFoundError` é levantada.",
                                 "O programa espera indefinidamente."
                             ],
                             correctAnswer: 2
                         },
                         { // Q8
                             question: "Ao ler linhas usando `.readline()` ou iterando diretamente sobre o objeto de arquivo (`for line in f:`), qual caractere geralmente é incluído no final de cada linha (exceto possivelmente a última)?",
                             options: ["Um espaço (' ')", "Uma tabulação ('\\t')", "Um caractere de nova linha ('\\n')", "Nada é adicionado"],
                             correctAnswer: 2
                         },
                         { // Q9
                             question: "Verdadeiro ou Falso: Após abrir um arquivo usando `f = open('notes.txt', 'r')`, é crucial chamar `f.close()` depois, especialmente se você *não* estiver usando uma declaração `with`.",
                             options: ["Verdadeiro", "Falso"],
                             correctAnswer: 0 // True
                         },
                         { // Q10
                             question: "Se `f.readlines()` retorna `['Hello\\n', 'World']`, o que isso provavelmente representa?",
                             options: [
                                 "Um arquivo com a linha única 'Hello\\nWorld'.",
                                 "Um arquivo com duas linhas: 'Hello' na primeira e 'World' na segunda.",
                                 "Um erro durante a leitura do arquivo.",
                                 "Um arquivo contendo apenas a palavra 'HelloWorld'."
                             ],
                             correctAnswer: 1
                         }
                     ]
                 }
             },
             zh: {
                "page_title": "知识测验 - 模块 23",
                 "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "lang_select_aria": "选择语言",
                 "back_button": "返回仪表板",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 "module_23_kc": {
                     "title": "知识测验 - 模块 23: 读取文件",
                     "instructions": "请回答以下10个问题。您至少需要答对6题才能通过此测验。祝您好运！",
                     "question_label": "问题 {current} / {total}",
                     "correct_feedback": "正确！",
                     "incorrect_feedback": "错误。正确答案是:",
                     "select_option_alert": "提交前请选择一个答案。",
                     "submit_button": "提交答案",
                     "next_button": "下一题",
                     "results_title": "测验结果",
                     "score_label": "您的分数:",
                     "passed_message": "恭喜！您已通过本次知识测验。您的进度已更新。",
                     "failed_message": "您答对了 {score} 题 (共 {total} 题)。您需要答对 {passingScore} 题才能通过。请继续努力！",
                     "retry_button": "重新测验",
                     "questions": [
                         { // Q1
                             question: "使用 `open()` 打开文件以读取文本时，标准的模式参数是什么？",
                             options: ["'r'", "'w'", "'a'", "'rb'"],
                             correctAnswer: 0
                         },
                         { // Q2
                             question: "使用 `with open(...) as file:` 语法的主要优点是什么？",
                             options: [
                                 "它会自动导入所需的文件模块。",
                                 "它使代码更短。",
                                 "它确保文件被自动关闭，即使发生错误也是如此。",
                                 "它比常规 `open()` 读取文件快得多。"
                             ],
                             correctAnswer: 2
                         },
                         { // Q3
                             question: "哪种文件读取方法将文件的全部内容读入单个字符串？",
                             options: ["`.readline()`", "`.readlines()`", "`.read()`", "`.seek()`"],
                             correctAnswer: 2
                         },
                         { // Q4
                             question: "如果你有一个文件对象 `f`，`line = f.readline()` 会做什么？",
                             options: [
                                 "将所有行读入名为 `line` 的列表。",
                                 "读取文件的第一行，无论之前是否读取过。",
                                 "将文件中下一个可用的行读入 `line` 变量，包括换行符。",
                                 "将整个文件内容读入 `line` 变量。"
                             ],
                             correctAnswer: 2
                         },
                         { // Q5
                             question: "`.readlines()` 方法通常返回什么数据类型？",
                             options: ["单个字符串", "字符串列表", "字符串元组", "整数（行数）"],
                             correctAnswer: 1
                         },
                         { // Q6
                             question: "考虑以下代码：\n```python\nlines = []\nwith open('data.txt', 'r') as f:\n    for line in f:\n        lines.append(line.strip())\n```\n这段代码在做什么？",
                             options: [
                                 "将列表 `lines` 写入 'data.txt'。",
                                 "从 'data.txt' 读取每一行，去除首尾空白，并将其添加到 `lines` 列表中。",
                                 "计算 'data.txt' 中的行数。",
                                 "创建一个名为 'data.txt' 的空文件。"
                             ],
                             correctAnswer: 1
                         },
                         { // Q7
                             question: "如果你尝试使用 `open('myfile.txt', 'r')` 打开一个*不存在*的文件，最可能的结果是什么？",
                             options: [
                                 "返回一个空字符串。",
                                 "Python 自动创建该文件。",
                                 "引发 `FileNotFoundError` 异常。",
                                 "程序无限期等待。"
                             ],
                             correctAnswer: 2
                         },
                         { // Q8
                             question: "使用 `.readline()` 读取行或直接迭代文件对象（`for line in f:`）时，每行（除了最后一行可能）末尾通常包含什么字符？",
                             options: ["空格 (' ')", "制表符 ('\\t')", "换行符 ('\\n')", "不添加任何内容"],
                             correctAnswer: 2
                         },
                         { // Q9
                             question: "判断题：使用 `f = open('notes.txt', 'r')` 打开文件后，之后调用 `f.close()` 至关重要，尤其是在*没有*使用 `with` 语句的情况下。",
                             options: ["正确", "错误"],
                             correctAnswer: 0 // True
                         },
                         { // Q10
                             question: "如果 `f.readlines()` 返回 `['Hello\\n', 'World']`，这可能代表什么？",
                             options: [
                                 "一个包含单行 'Hello\\nWorld' 的文件。",
                                 "一个包含两行的文件：第一行是 'Hello'，第二行是 'World'。",
                                 "文件读取过程中出错。",
                                 "一个只包含单词 'HelloWorld' 的文件。"
                             ],
                             correctAnswer: 1
                         }
                     ]
                 }
             }
        };

        // --- Quiz Logic ---
        const moduleId = 23; // *** CHANGE THIS FOR EACH MODULE'S PAGE ***
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';
        const passingScore = 6; // Need 6 out of 10 to pass

        let currentQuestionIndex = 0;
        let score = 0;
        let questions = []; // Will be loaded based on language
        let knowledgeCheckStatus = {}; // Loaded from localStorage

        // DOM Elements
        const questionCounterEl = document.getElementById('question-counter');
        const questionTextEl = document.getElementById('question-text');
        const optionsListEl = document.getElementById('options-list');
        const feedbackAreaEl = document.getElementById('feedback-area');
        const submitButtonEl = document.getElementById('submit-button');
        const resultsAreaEl = document.getElementById('results-area');
        const scoreValueEl = document.getElementById('score-value');
        const resultsIconEl = document.getElementById('results-icon');
        const resultsMessageEl = document.getElementById('results-message');
        const retryButtonEl = document.getElementById('retry-button');
        const quizAreaEl = document.getElementById('quiz-area');
        const languageSelectEl = document.getElementById('languageSelect');

        // --- Translation & Language Functions ---
        function getStoredLanguage() {
             const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
             if (storedLang && translations[storedLang]) return storedLang;
             const browserLang = navigator.language || navigator.userLanguage;
             if (browserLang.startsWith('pt')) return 'pt';
             if (browserLang.startsWith('zh')) return 'zh';
             return 'en';
        }

        function getTranslation(key, lang, replacements = {}) {
            const keys = key.split('.');
            let text = translations[lang];
            try {
                for (const k of keys) {
                    text = text[k];
                }
                if (typeof text !== 'string') throw new Error('Not a string');
            } catch (e) {
                 // Fallback to English
                 try {
                     text = translations['en'];
                     for (const k of keys) {
                         text = text[k];
                     }
                     if (typeof text !== 'string') throw new Error('Not a string in EN');
                 } catch (enError) {
                     console.warn(`Translation key "${key}" not found in "${lang}" or "en".`);
                     return `[${key}]`; // Return key as placeholder
                 }
            }

            for (const placeholder in replacements) {
                const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                text = text.replace(regex, replacements[placeholder]);
            }
            return text;
        }

        function translatePage(lang) {
             document.documentElement.lang = lang;
             document.querySelectorAll('[data-translate]').forEach(el => {
                 const key = el.getAttribute('data-translate');
                 const translation = getTranslation(key, lang);
                 if (el.tagName === 'TITLE') { document.title = translation; }
                 else if (el.tagName === 'BUTTON' && key.endsWith('_button')) { // Set button text
                    el.textContent = translation;
                 }
                 else if (translation.includes('<') && translation.includes('>')) { // Allow basic HTML in translations
                     el.innerHTML = translation;
                 } else {
                     el.textContent = translation;
                 }
             });
             document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                 const key = el.getAttribute('data-translate-aria-label');
                 el.setAttribute('aria-label', getTranslation(key, lang));
             });

             // Update dynamic elements like button text if needed (already handled by data-translate generally)
             // submitButtonEl.textContent = getTranslation(`module_${moduleId}_kc.submit_button`, lang);
             // retryButtonEl.textContent = getTranslation(`module_${moduleId}_kc.retry_button`, lang);
        }

        // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() {
            try {
                const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                return typeof parsed === 'object' && parsed !== null ? parsed : {};
            } catch (e) {
                console.error("Error reading KC status from localStorage:", e);
                return {};
            }
        }

        function saveKnowledgeCheckStatus() {
            try {
                localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(knowledgeCheckStatus));
            } catch (e) {
                console.error("Error saving KC status to localStorage:", e);
            }
        }


        // --- Quiz Logic Functions ---

        function loadQuestion(index) {
            const lang = getStoredLanguage();
            questions = translations[lang][`module_${moduleId}_kc`].questions; // Load correct language questions
            const questionData = questions[index];

            // Update question counter
            questionCounterEl.textContent = getTranslation(`module_${moduleId}_kc.question_label`, lang, { current: index + 1, total: questions.length });


            // Display question text (handle code blocks)
             if (questionData.question.includes('```')) {
                 const parts = questionData.question.split('```');
                 questionTextEl.innerHTML = ''; // Clear previous
                 parts.forEach((part, i) => {
                     if (i % 2 === 0) { // Regular text
                         questionTextEl.appendChild(document.createTextNode(part));
                     } else { // Code block
                         const codeEl = document.createElement('code');
                         codeEl.textContent = part.replace(/^\s*python\s*\n?/, '').trim(); // Remove ```python and trim
                         questionTextEl.appendChild(codeEl);
                     }
                 });
             } else {
                 questionTextEl.textContent = questionData.question;
             }

            optionsListEl.innerHTML = ''; // Clear previous options
            questionData.options.forEach((option, i) => {
                const li = document.createElement('li');
                li.className = 'kc-option';
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'answer';
                input.value = i;
                input.id = `option${i}`;
                const label = document.createElement('label');
                label.htmlFor = `option${i}`;
                label.textContent = option;

                li.appendChild(input);
                li.appendChild(label);
                optionsListEl.appendChild(li);
            });

            feedbackAreaEl.style.display = 'none'; // Hide feedback
            submitButtonEl.disabled = false; // Enable submit button
            submitButtonEl.textContent = getTranslation(`module_${moduleId}_kc.submit_button`, lang); // Reset button text
            submitButtonEl.onclick = submitAnswer; // Set action to submit
        }

        function submitAnswer() {
            const selectedOption = optionsListEl.querySelector('input[name="answer"]:checked');
            const lang = getStoredLanguage();

            if (!selectedOption) {
                alert(getTranslation(`module_${moduleId}_kc.select_option_alert`, lang));
                return;
            }

            const selectedIndex = parseInt(selectedOption.value);
            const correctAnswerIndex = questions[currentQuestionIndex].correctAnswer;
            const optionsLabels = optionsListEl.querySelectorAll('label');
            const optionsInputs = optionsListEl.querySelectorAll('input[type="radio"]');

            // Disable all options
            optionsInputs.forEach(input => input.disabled = true);

            // Show feedback
            feedbackAreaEl.style.display = 'block';
            if (selectedIndex === correctAnswerIndex) {
                score++;
                feedbackAreaEl.className = 'kc-feedback correct';
                feedbackAreaEl.textContent = getTranslation(`module_${moduleId}_kc.correct_feedback`, lang);
                optionsLabels[selectedIndex].classList.add('correct');
            } else {
                feedbackAreaEl.className = 'kc-feedback incorrect';
                const correctOptionText = questions[currentQuestionIndex].options[correctAnswerIndex];
                feedbackAreaEl.innerHTML = `${getTranslation(`module_${moduleId}_kc.incorrect_feedback`, lang)} <strong>${correctOptionText}</strong>`;
                optionsLabels[selectedIndex].classList.add('incorrect'); // Mark selected as wrong
                optionsLabels[correctAnswerIndex].classList.add('correct'); // Highlight the correct one
            }

            // Change button to "Next" or "Show Results"
            submitButtonEl.textContent = (currentQuestionIndex < questions.length - 1)
                ? getTranslation(`module_${moduleId}_kc.next_button`, lang)
                : getTranslation(`module_${moduleId}_kc.results_title`, lang); // Or use results title as button text
            submitButtonEl.onclick = nextQuestion; // Set action to next
        }

        function nextQuestion() {
             currentQuestionIndex++;
             if (currentQuestionIndex < questions.length) {
                 loadQuestion(currentQuestionIndex);
             } else {
                 showResults();
             }
         }

        function showResults() {
            const lang = getStoredLanguage();
            quizAreaEl.style.display = 'none'; // Hide questions
            resultsAreaEl.style.display = 'block'; // Show results

            scoreValueEl.textContent = `${score} / ${questions.length}`;

            if (score >= passingScore) {
                resultsAreaEl.className = 'kc-results passed';
                resultsIconEl.innerHTML = '<i class="fas fa-check-circle"></i>';
                resultsMessageEl.textContent = getTranslation(`module_${moduleId}_kc.passed_message`, lang);
                 // Update progress in localStorage only if passed
                 if (knowledgeCheckStatus[moduleId] !== true) {
                    knowledgeCheckStatus[moduleId] = true;
                    saveKnowledgeCheckStatus();
                 }
            } else {
                resultsAreaEl.className = 'kc-results failed';
                resultsIconEl.innerHTML = '<i class="fas fa-times-circle"></i>';
                resultsMessageEl.textContent = getTranslation(`module_${moduleId}_kc.failed_message`, lang, {
                     score: score, total: questions.length, passingScore: passingScore
                 });
            }
        }

        function retryQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            resultsAreaEl.style.display = 'none'; // Hide results
            quizAreaEl.style.display = 'block'; // Show questions
            loadQuestion(currentQuestionIndex); // Load the first question
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            knowledgeCheckStatus = loadKnowledgeCheckStatus(); // Load status first
            const initialLang = getStoredLanguage();

            // Set language dropdown to stored language
            languageSelectEl.value = initialLang;

             // Initial Page Translation and Quiz Load
            translatePage(initialLang);
            loadQuestion(currentQuestionIndex); // Load the first question using the initial language

            // Add event listeners
            retryButtonEl.addEventListener('click', retryQuiz);
             languageSelectEl.addEventListener('change', (e) => {
                 const newLang = e.target.value;
                 localStorage.setItem(LANGUAGE_STORAGE_KEY, newLang);
                 translatePage(newLang);
                 // Reload the current state of the quiz with the new language
                 // If quiz active: reload current question; If results shown: update results text
                  if (resultsAreaEl.style.display === 'block') {
                     // Re-translate results text
                     showResults(); // Re-call to apply new translations
                  } else {
                     // Re-load current question with new language
                     loadQuestion(currentQuestionIndex);
                     // Re-apply feedback if an answer was just submitted
                     const selectedOption = optionsListEl.querySelector('input[name="answer"]:checked');
                      if (selectedOption && submitButtonEl.textContent !== getTranslation(`module_${moduleId}_kc.submit_button`, newLang)) {
                          // Re-show feedback state if we were showing feedback/next button
                          submitAnswer(); // Will re-apply styles based on selection
                      }
                  }
             });
        });

    </script>

</body>
</html>