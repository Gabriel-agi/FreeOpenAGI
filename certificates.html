<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="certificates_page_title">My Certificates - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fonts for Certificate -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <!-- Fonts for Dashboard UI -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Dashboard) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14;
            --check-color: #6f42c1;
            --certificate-color: #d63384; /* Pinkish */
            --chat-panel-bg: #ffffff;
            --chat-box-bg: #f8f9fa;
            --chat-bot-bg: #e9ecef;
            --chat-bot-text: #343a40;
            --chat-user-bg: #d1e7ff;
            --chat-user-text: #0a58ca;
            --chat-error-bg: #f8d7da;
            --chat-error-text: #842029;
            --chat-border-color: #dee2e6;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --sidebar-width: 260px;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
             /* Certificate specific variables */
            --cert-locked-color: var(--secondary-color);
            --cert-inprogress-color: var(--accent-color);
            --cert-earned-color: var(--success-color);
            --cert-generate-button-bg: var(--success-color);
            --cert-generate-button-hover-bg: #157347;
            /* Certificate Template Variables */
            --cert-template-gold: #D4AF37;
            --cert-template-dark-blue: #0F2D53;
            --cert-template-parchment: #F8F3E6;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
        }
        body.chat-open { overflow: hidden; }
        body.certificate-view { overflow: hidden; } /* Hide scrollbars when cert is shown */

        /* --- Animations (Dashboard) --- */
        .card-fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.6s ease-out forwards; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }

        /* --- Page Header (Dashboard) --- */
        .page-header { background: var(--background-header); color: var(--text-light); padding: 2rem 1.5rem 2rem 1.5rem; margin-bottom: 2rem; position: relative; }
        .header-content { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; text-align: center; }
        .page-header h1 { font-family: var(--font-title); font-size: 2.2rem; margin-bottom: 0; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); }

        /* --- Page Layout (Dashboard) --- */
        .page-container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; display: flex; gap: 2rem; align-items: flex-start; }

        /* --- Sidebar (Dashboard) --- */
        .page-sidebar { width: var(--sidebar-width); flex-shrink: 0; position: sticky; top: 20px; height: calc(100vh - 40px); overflow-y: auto; padding-right: 10px; scrollbar-width: thin; scrollbar-color: var(--secondary-color) var(--background-page); }
        .page-sidebar::-webkit-scrollbar { width: 6px; }
        .page-sidebar::-webkit-scrollbar-track { background: var(--background-page); }
        .page-sidebar::-webkit-scrollbar-thumb { background-color: var(--secondary-color); border-radius: 3px; }
        .sidebar-widget { background-color: var(--background-sidebar); border-radius: var(--border-radius); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--card-shadow); border: 1px solid var(--border-color); }
        .sidebar-widget h4 { font-family: var(--font-title); font-size: 1.1rem; margin-bottom: 1rem; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; display: flex; align-items: center; }
        .sidebar-widget h4 i { margin-right: 8px; color: var(--primary-color); opacity: 0.8; }
        .sidebar-widget ul { list-style: none; padding: 0; margin: 0; }
        /* Language Switcher Styles (Dashboard) */
         .language-switcher { margin-top: 1rem; }
         #languageSelect {
            width: 100%; background: var(--background-card); color: var(--text-dark); border: 1px solid var(--lang-select-border); border-radius: 5px; padding: 8px 35px 8px 15px; cursor: pointer; font-size: 0.95rem; font-weight: 500; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 12px center; background-size: 10px auto; transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: #b02a6e; }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option { background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px; }
        /* Links Widget Styles (Dashboard) */
        .sidebar-links ul li { margin-bottom: 0.75rem; }
        .sidebar-links ul li a { display: inline-flex; align-items: center; text-decoration: none; border-radius: 5px; padding: 0.6rem 1rem; font-size: 0.9rem; font-weight: 500; transition: all var(--transition-speed) ease; border: 1px solid transparent; }
        .sidebar-links ul li a i { margin-right: 6px; }
        .sidebar-links .link-dashboard { background-color: var(--primary-color); color: var(--text-light); border-color: var(--primary-color); }
        .sidebar-links .link-dashboard:hover { background-color: #0b5ed7; }
        .sidebar-links .link-main-site { background-color: var(--secondary-color); color: var(--text-light); border-color: var(--secondary-color); }
        .sidebar-links .link-main-site:hover { background-color: #5a6268; }

        /* --- Main Content Area --- */
        .page-main { flex-grow: 1; min-width: 0; }

        /* --- Testing Checkboxes --- */
        .testing-controls { background-color: var(--background-card); padding: 1rem 1.5rem; margin-bottom: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--card-shadow); border: 1px solid var(--border-color); }
        .testing-controls h4 { font-family: var(--font-title); font-size: 1rem; margin-bottom: 0.8rem; color: var(--text-dark); }
        .testing-controls label { display: inline-block; margin-right: 1rem; font-size: 0.9rem; cursor: pointer; }
        .testing-controls input[type="checkbox"] { margin-right: 5px; vertical-align: middle; }

        /* --- Certificate Card Grid --- */
        .certificates-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }

        /* --- Certificate Card Styling (Dashboard) --- */
        .certificate-card {
            background-color: var(--background-card); border-radius: var(--border-radius);
            box-shadow: var(--card-shadow); transition: all var(--transition-speed) ease-in-out;
            display: flex; flex-direction: column; border: 1px solid var(--border-color);
            border-left: 5px solid var(--cert-locked-color); /* Default border */
            overflow: hidden; position: relative; opacity: 0; transform: translateY(20px);
            padding: 1.5rem;
        }
        .certificate-card:hover { transform: translateY(-5px); box-shadow: var(--card-shadow-hover); }
        /* Status specific styles */
        .certificate-card.status-locked { border-left-color: var(--cert-locked-color); }
        .certificate-card.status-inprogress { border-left-color: var(--cert-inprogress-color); }
        .certificate-card.status-earned { border-left-color: var(--cert-earned-color); }
        .certificate-card.status-earned .certificate-locked-info { display: none; }
        .certificate-card:not(.status-earned) .certificate-generate-form { display: none; }

        .certificate-card h3 {
            font-family: var(--font-title); font-size: 1.3rem; color: var(--text-dark);
            margin-bottom: 0.8rem; line-height: 1.3; display: flex; align-items: center;
        }
        .certificate-card h3 i { margin-right: 10px; color: var(--certificate-color); }
        .certificate-status {
            font-size: 0.95rem; font-weight: 500; margin-bottom: 1rem;
            padding: 0.4rem 0.8rem; border-radius: 4px; display: inline-block;
            border: 1px solid transparent;
        }
        .certificate-card.status-locked .certificate-status { color: var(--cert-locked-color); background-color: #e9ecef; border-color: var(--cert-locked-color); }
        .certificate-card.status-inprogress .certificate-status { color: #856404; background-color: #fff3cd; border-color: var(--cert-inprogress-color); }
         .certificate-card.status-earned .certificate-status { color: var(--cert-earned-color); background-color: #d1e7dd; border-color: var(--cert-earned-color); }
        .certificate-status i { margin-right: 6px; }

        .certificate-locked-info p { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .certificate-locked-info strong { color: var(--text-dark); }

        .certificate-generate-form { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px dashed var(--border-color); }
        .certificate-generate-form label { display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .certificate-generate-form input[type="text"] { width: 100%; padding: 0.7rem 1rem; margin-bottom: 1rem; border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .certificate-generate-form input[type="text"]:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); }
        .generate-button { background-color: var(--cert-generate-button-bg); color: var(--text-light); border: none; border-radius: 5px; padding: 0.7rem 1.5rem; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: background-color var(--transition-speed) ease; display: inline-flex; align-items: center; }
        .generate-button:hover { background-color: var(--cert-generate-button-hover-bg); }
        .generate-button i { margin-right: 8px; }
        .generate-message { font-size: 0.85rem; margin-top: 0.5rem; }
        .generate-message.success { color: var(--success-color); }
        .generate-message.error { color: var(--error-color); }

        /* --- Certificate Display Overlay --- */
        #certificate-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            display: none; /* Hidden by default */ align-items: center; justify-content: center;
            z-index: 1100; /* Above chat */ padding: 20px;
            overflow-y: auto; /* Allow scroll if needed */
        }
        body.certificate-view #certificate-overlay { display: flex; }

        /* --- Certificate Template Styles --- */
        .certificate-template {
            width: 900px; height: 630px;
            background: var(--cert-template-parchment);
            border: 15px solid var(--cert-template-gold);
            padding: 30px 50px; position: relative;
            text-align: center; margin: 20px auto; /* Center horizontally */
            box-sizing: border-box; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden; font-family: 'Montserrat', sans-serif; /* Default font */
            color: #333;
            transform: scale(0.95); /* Start slightly small */
            transition: transform 0.3s ease-out;
            max-width: 100%; /* Ensure it fits screen */
        }
        body.certificate-view .certificate-template { transform: scale(1); } /* Scale up */

        .certificate-template:before { /* Watermark */
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M20,100 Q50,40 100,20 Q150,40 180,100 Q150,160 100,180 Q50,160 20,100 Z" fill="none" stroke="%23D4AF3720" stroke-width="1"/></svg>');
            opacity: 0.1; pointer-events: none;
        }
        .certificate-template h1 { font-family: 'Playfair Display', serif; color: var(--cert-template-dark-blue); font-size: 36px; margin: 15px 0; letter-spacing: 1px; }
        .certificate-template .subtitle { font-size: 18px; color: #555; margin-bottom: 25px; font-weight: 600; }
        .certificate-template .recipient { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 700; color: var(--cert-template-dark-blue); margin: 20px 0; padding: 10px 0; display: inline-block; min-width: 300px; /* Ensure space */ }
        .certificate-template .description { font-size: 16px; line-height: 1.6; margin: 20px 0; position: relative; min-height: 60px; /* Ensure space */}
        .certificate-template .description strong { color: var(--cert-template-dark-blue); font-weight: 600;} /* Highlight skill */
        .certificate-template .description:before, .certificate-template .description:after { content: '"'; font-size: 50px; color: var(--cert-template-gold); position: absolute; opacity: 0.2; }
        .certificate-template .description:before { left: -15px; top: -25px; }
        .certificate-template .description:after { right: -15px; bottom: -30px; } /* Adjusted */
        .certificate-template .signatures { display: flex; justify-content: center; margin-top: 30px; margin-bottom: 10px; }
        .certificate-template .signature-line { height: 1px; background: var(--cert-template-dark-blue); width: 180px; margin: 8px auto; }
        .certificate-template .signature div { font-size: 14px; line-height: 1.4;}
        .certificate-template .footer { position: absolute; bottom: 30px; left: 0; right: 0; padding: 0 50px; font-size: 13px; color: #666; }
        .certificate-template .footer .disclaimer { font-size: 10px; color: #888; margin-top: 3px; font-style: italic; }
        .certificate-template .agi-seal { position: absolute; top: 30px; right: 30px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--cert-template-gold); border-radius: 50%; font-family: 'Playfair Display', serif; font-weight: bold; color: var(--cert-template-dark-blue); font-size: 20px; }
        .certificate-template .decoration { position: absolute; bottom: 90px; left: 30px; width: 80px; opacity: 0.6; }
        .certificate-template .badge { position: absolute; bottom: 90px; right: 30px; width: 60px; opacity: 0.7; }

         /* --- Certificate Action Buttons --- */
        .certificate-actions {
            text-align: center; margin-top: 15px; /* Below the certificate */
        }
        .certificate-actions button {
            padding: 10px 20px; font-size: 15px; border: none;
            border-radius: 8px; cursor: pointer; font-weight: 600;
            margin: 5px; background-color: var(--background-card);
            color: var(--text-dark); box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .certificate-actions button:hover { transform: translateY(-2px); }
        #certDownloadBtn { background: linear-gradient(135deg, var(--cert-template-dark-blue), #2C5282); color: white; }
        #certCloseBtn { background-color: var(--error-color); color: white; }

        /* --- Footer (Dashboard) --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Chat Panel & FAB Styles (Dashboard - Keep as is) --- */
        #chatbot-fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(45deg, var(--primary-color), #0b5ed7); color: white; border: none; border-radius: 50%; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); transition: all var(--transition-speed) ease; z-index: 1010; }
        #chatbot-fab:hover { transform: scale(1.1); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25); }
        #chatbot-fab i { transition: transform 0.3s ease; }
        body.chat-open #chatbot-fab { background: linear-gradient(45deg, var(--secondary-color), #5a6268); }
        body.chat-open #chatbot-fab i { transform: rotate(135deg); }
        #chat-panel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); backdrop-filter: blur(2px); opacity: 0; visibility: hidden; transition: opacity var(--transition-speed) ease, visibility 0s var(--transition-speed); z-index: 1000; }
        body.chat-open #chat-panel-overlay { opacity: 1; visibility: visible; transition-delay: 0s; }
        #chat-panel { position: fixed; bottom: 30px; right: 100px; width: 90vw; max-width: 450px; height: 75vh; max-height: 650px; background-color: var(--chat-panel-bg); border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 1px solid var(--chat-border-color); display: flex; flex-direction: column; z-index: 1005; opacity: 0; transform: translateY(20px) scale(0.98); visibility: hidden; transition: opacity var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1), transform var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1), visibility 0s var(--transition-speed); transform-origin: bottom right; }
        body.chat-open #chat-panel { opacity: 1; transform: translateY(0) scale(1); visibility: visible; transition-delay: 0s; }
        .chat-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 1.2rem; border-bottom: 1px solid var(--chat-border-color); background-color: var(--background-page); border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .chat-panel-header h5 { margin: 0; font-family: var(--font-title); font-size: 1.1rem; color: var(--primary-color); display: flex; align-items: center; }
        .chat-panel-header h5 i { margin-right: 8px; color: var(--certificate-color); }
        #chat-close-button { background: none; border: none; font-size: 1.5rem; color: var(--text-muted); cursor: pointer; padding: 0.2rem; line-height: 1; transition: color var(--transition-speed); }
        #chat-close-button:hover { color: var(--text-dark); }
        #chatbox { flex-grow: 1; overflow-y: auto; padding: 1.5rem; background-color: var(--chat-box-bg); font-family: var(--font-body); line-height: 1.6; scrollbar-width: thin; scrollbar-color: var(--secondary-color) var(--chat-box-bg); }
        #chatbox::-webkit-scrollbar { width: 6px; }
        #chatbox::-webkit-scrollbar-track { background: var(--chat-box-bg); }
        #chatbox::-webkit-scrollbar-thumb { background-color: var(--secondary-color); border-radius: 3px; }
        #chatbox .message-container { display: flex; margin-bottom: 1rem; align-items: flex-end; }
        #chatbox .message-avatar { width: 35px; height: 35px; border-radius: 50%; background-color: var(--secondary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; margin-right: 10px; }
        #chatbox .user-message-container .message-avatar { background-color: var(--primary-color); }
        #chatbox .bot-message-container .message-avatar { background-color: var(--certificate-color); }
        #chatbox .message { padding: 10px 15px; border-radius: 18px; max-width: 80%; word-wrap: break-word; font-size: 0.95rem; position: relative; border: 1px solid var(--chat-border-color); box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        #chatbox .user-message-container { justify-content: flex-end; }
        #chatbox .user-message-container .message-avatar { margin-right: 0; margin-left: 10px; order: 2; }
        #chatbox .user-message-container .message { order: 1; }
        #chatbox .user-message { background-color: var(--chat-user-bg); color: var(--chat-user-text); border-color: var(--chat-user-bg); border-top-right-radius: 4px; }
        #chatbox .bot-message { background-color: var(--chat-bot-bg); color: var(--chat-bot-text); border-color: var(--chat-bot-bg); border-top-left-radius: 4px; }
        #chatbox .error-message { background-color: var(--chat-error-bg); color: var(--chat-error-text); border-color: #f5c6cb; margin-bottom: 1rem; }
        #chatbox .message strong { display: none; }
        #chatbox .typing-indicator { display: flex; align-items: center; color: var(--text-muted); font-style: italic; margin-bottom: 1rem; padding: 8px 15px; font-size: 0.9rem; }
        #chatbox .typing-indicator i { margin-right: 8px; color: var(--certificate-color); }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .typing-dot { width: 6px; height: 6px; background-color: var(--text-muted); border-radius: 50%; display: inline-block; margin: 0 2px; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        #input-area { display: flex; padding: 0.8rem; border-top: 1px solid var(--chat-border-color); background-color: var(--background-page); align-items: center; }
        #userInput { flex-grow: 1; border: 1px solid var(--chat-border-color); border-radius: 18px; padding: 0.7rem 1rem; font-size: 0.95rem; background-color: var(--background-card); color: var(--text-dark); outline: none; transition: border-color var(--transition-speed); resize: none; max-height: 80px; font-family: var(--font-body); }
        #userInput:focus { border-color: var(--primary-color); }
        #sendButton { background-color: var(--primary-color); color: var(--text-light); border: none; border-radius: 50%; width: 40px; height: 40px; margin-left: 0.7rem; padding: 0; cursor: pointer; font-size: 1.1rem; transition: background-color var(--transition-speed); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        #sendButton:hover { background-color: #0b5ed7; }
        #sendButton:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }

        /* --- Responsive Design (Combined & Checked) --- */
        @media (max-width: 1200px) { .page-container { padding: 0 1rem; gap: 1.5rem; } :root { --sidebar-width: 240px; } #chat-panel { right: 85px; max-width: 420px;} }
        @media (max-width: 992px) {
            .page-container { flex-direction: column; }
            .page-sidebar { width: 100%; position: static; height: auto; overflow-y: visible; padding-right: 0; margin-bottom: 2rem; }
            .sidebar-widget { padding: 1.2rem; }
            .certificates-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
            .certificate-template { width: 100%; max-width: 800px; height: auto; aspect-ratio: 900 / 630; padding: 20px 30px; } /* Adjust for smaller screens */
            .certificate-template h1 { font-size: 30px; }
            .certificate-template .recipient { font-size: 28px; }
            .certificate-template .description { font-size: 15px; }
            #chat-panel { right: 30px; bottom: 90px; max-width: 400px; height: 70vh;}
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .page-header h1 { font-size: 1.8rem; }
            .certificates-grid { grid-template-columns: 1fr; gap: 1rem; }
            .certificate-card { padding: 1.2rem; }
            .testing-controls label { display: block; margin-bottom: 0.5rem; }
            .certificate-template { width: 100%; max-width: 650px; padding: 15px 25px; border-width: 10px; }
            .certificate-template h1 { font-size: 26px; }
            .certificate-template .subtitle { font-size: 16px; }
            .certificate-template .recipient { font-size: 24px; }
            .certificate-template .description { font-size: 14px; }
            .certificate-template .footer { font-size: 12px; }
             #chat-panel { right: 15px; bottom: 80px; left: 15px; width: auto; max-width: none; height: 65vh; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .page-header { padding: 1.5rem 1rem 1.5rem 1rem; }
            .page-header h1 { font-size: 1.6rem; }
            .certificate-card h3 { font-size: 1.15rem; }
            .certificate-generate-form input[type="text"] { font-size: 0.95rem; }
            .generate-button { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
            .certificate-template { padding: 10px 15px; border-width: 8px; }
            .certificate-template h1 { font-size: 22px; }
            .certificate-template .subtitle { font-size: 14px; }
            .certificate-template .recipient { font-size: 20px; }
            .certificate-template .description { font-size: 13px; }
            .certificate-template .signatures { margin-top: 15px; }
            .certificate-template .signature div { font-size: 12px;}
            .certificate-template .footer { font-size: 10px; padding: 0 15px; bottom: 15px; }
            .certificate-template .disclaimer { font-size: 9px; }
            .certificate-template .agi-seal { width: 45px; height: 45px; font-size: 16px; top: 15px; right: 15px; }
            .certificate-template .decoration { width: 50px; bottom: 60px; left: 15px;}
            .certificate-template .badge { width: 40px; bottom: 60px; right: 15px;}
            #chatbot-fab { width: 50px; height: 50px; font-size: 1.5rem; bottom: 20px; right: 20px; }
            #chat-panel { bottom: 75px; right: 10px; left: 10px; height: 60vh; }
            #chatbox { padding: 1rem; }
            #chatbox .message-avatar { width: 30px; height: 30px; font-size: 1rem; }
            #chatbox .message { font-size: 0.9rem; padding: 8px 12px;}
            #input-area { padding: 0.6rem; }
            #userInput { padding: 0.6rem 0.8rem; font-size: 0.9rem; border-radius: 15px;}
            #sendButton { width: 35px; height: 35px; font-size: 1rem; margin-left: 0.5rem;}
        }

        /* --- Print Styles --- */
        @media print {
            body, html {
                background: none; padding: 0; margin: 0; height: 100%; width: 100%;
                -webkit-print-color-adjust: exact !important; /* Chrome, Safari */
                color-adjust: exact !important; /* Firefox, Edge */
                 print-color-adjust: exact !important; /* Standard */
            }
            .page-header, .page-sidebar, .page-main > :not(#certificate-overlay), footer, #chatbot-fab, #chat-panel-overlay, #chat-panel, .certificate-actions {
                display: none !important;
            }
             #certificate-overlay {
                position: absolute !important; /* Use absolute for print */
                top: 0; left: 0; width: 100%; height: 100%;
                background: none !important; backdrop-filter: none !important;
                padding: 0 !important; margin: 0 !important;
                display: block !important; /* Ensure it prints */
                overflow: hidden !important;
            }
            .certificate-template {
                position: absolute !important;
                top: 0; left: 0; right: 0; bottom: 0;
                width: 100% !important; height: 100% !important;
                margin: 0 !important; padding: 30px 50px !important; /* Adjust padding as needed */
                border: 15px solid var(--cert-template-gold) !important;
                box-shadow: none !important;
                transform: scale(1) !important;
                transform-origin: 0 0 !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                font-size: 16px; /* Reset base size for print */
            }
            /* Ensure colors print */
            .certificate-template, .certificate-template h1, .certificate-template .recipient, .signature div, .footer div, .agi-seal, .badge path, .decoration path {
                 color: var(--cert-template-dark-blue) !important; /* Force color */
                 background-color: transparent !important; /* Prevent unwanted backgrounds */
            }
             .certificate-template {
                 background-color: var(--cert-template-parchment) !important;
             }
            .certificate-template .badge path { fill: var(--cert-template-gold) !important;}
            .certificate-template .decoration path { stroke: var(--cert-template-gold) !important;}
            .certificate-template .agi-seal { border-color: var(--cert-template-gold) !important; }
            .certificate-template .signature-line { background-color: var(--cert-template-dark-blue) !important; }
            .certificate-template .description strong { color: var(--cert-template-dark-blue) !important;}
            .certificate-template .footer { color: #666 !important; }
            .certificate-template .disclaimer { color: #888 !important; }

            @page {
                size: landscape;
                margin: 0mm !important;
            }
        }

    </style>
</head>
<body>

    <header class="page-header">
        <div class="header-content">
            <h1 data-translate="certificates_header_title">My Certificates</h1>
        </div>
    </header>

    <div class="page-container">

        <!-- === Sidebar === -->
        <aside class="page-sidebar">
            <!-- Language Switcher Widget -->
            <div class="sidebar-widget">
                <h4><i class="fas fa-language"></i> <span data-translate="widget_lang_title">Language</span></h4>
                 <div class="language-switcher">
                    <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                        <option value="en" data-translate="lang_en">ðŸ‡¬ðŸ‡§ English</option>
                        <option value="pt" data-translate="lang_pt">ðŸ‡§ðŸ‡· PortuguÃªs</option>
                        <option value="zh" data-translate="lang_zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
                    </select>
                </div>
            </div>

             <!-- Links Widget -->
             <div class="sidebar-widget sidebar-links">
                 <h4><i class="fas fa-link"></i> <span data-translate="widget_links_title">Quick Links</span></h4>
                  <ul>
                    <li><a href="dashboard.html" class="link-dashboard"><i class="fas fa-tachometer-alt"></i> <span data-translate="link_dashboard">Back to Dashboard</span></a></li>
                    <li><a href="index.html" class="link-main-site"><i class="fas fa-home"></i> <span data-translate="link_main_site">Main Site</span></a></li>
                  </ul>
             </div>
        </aside>

        <!-- === Main Content === -->
        <main class="page-main">

            <!-- Testing Controls -->
            <div class="testing-controls">
                <h4 data-translate="testing_controls_title">Testing: Toggle Certificate Status</h4>
                <div id="testing-checkboxes">
                    <!-- Checkboxes will be added by JS -->
                </div>
            </div>

            <div class="certificates-grid">

                <!-- Certificate Card: Basics & I/O -->
                <div class="certificate-card card-fade-in" data-certificate-id="basics" data-modules="0,1,2,3,4">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_card_title_basics">Basics & I/O</span></h3>
                    <div class="certificate-status"> <!-- Status text set by JS --> </div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_basics">Complete Knowledge Checks for modules 0-4.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-basics" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-basics" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="basics" data-translate-aria-label="cert_generate_button_aria" aria-label="Generate Basics Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-basics"></div>
                    </div>
                </div>

                <!-- Certificate Card: Flow Control -->
                 <div class="certificate-card card-fade-in" data-certificate-id="flow" data-modules="5,6,7,8,9,12,13,14,15">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_card_title_flow">Flow Control</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_flow">Complete Knowledge Checks for modules 5-9 & 12-15.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-flow" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-flow" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="flow" data-translate-aria-label="cert_generate_button_aria_flow" aria-label="Generate Flow Control Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-flow"></div>
                    </div>
                </div>

                <!-- Certificate Card: Data Structures -->
                 <div class="certificate-card card-fade-in" data-certificate-id="data" data-modules="10,11,20,21,22">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_card_title_data">Data Structures</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_data">Complete Knowledge Checks for modules 10-11 & 20-22.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-data" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-data" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="data" data-translate-aria-label="cert_generate_button_aria_data" aria-label="Generate Data Structures Certificate">
                           <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-data"></div>
                    </div>
                </div>

                <!-- Certificate Card: Functions -->
                 <div class="certificate-card card-fade-in" data-certificate-id="functions" data-modules="16,17,18,19">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_card_title_functions">Functions</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_functions">Complete Knowledge Checks for modules 16-19.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-functions" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-functions" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="functions" data-translate-aria-label="cert_generate_button_aria_functions" aria-label="Generate Functions Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-functions"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Files & Errors -->
                 <div class="certificate-card card-fade-in" data-certificate-id="files" data-modules="23,24,25">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_card_title_files">Files & Errors</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_files">Complete Knowledge Checks for modules 23-25.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-files" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-files" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="files" data-translate-aria-label="cert_generate_button_aria_files" aria-label="Generate Files & Errors Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-files"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Advanced Topics -->
                 <div class="certificate-card card-fade-in" data-certificate-id="advanced" data-modules="26,27,28,29,30,31,32">
                    <h3><i class="fas fa-star"></i> <span data-translate="cert_card_title_advanced">Advanced Topics</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_advanced">Complete Knowledge Checks for modules 26-32.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-advanced" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-advanced" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="advanced" data-translate-aria-label="cert_generate_button_aria_advanced" aria-label="Generate Advanced Topics Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-advanced"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Full Course -->
                 <div class="certificate-card card-fade-in" data-certificate-id="full" data-modules="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32">
                    <h3><i class="fas fa-graduation-cap"></i> <span data-translate="cert_card_title_full">Full Course Completion</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info"> <p data-translate="cert_progress_info_full">Complete <strong>ALL</strong> Knowledge Checks in the course.</p> </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-full" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-full" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="full" data-translate-aria-label="cert_generate_button_aria_full" aria-label="Generate Full Course Certificate">
                             <i class="fas fa-file-signature"></i> <span data-translate="cert_form_view_button">View Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-full"></div>
                    </div>
                </div>

            </div><!-- /.certificates-grid -->
        </main>

    </div><!-- /.page-container -->

    <!-- Certificate Display Overlay -->
    <div id="certificate-overlay">
        <div id="certificate-display-content"> <!-- Added a wrapper for better control -->
            <div id="certificate-template" class="certificate-template">
                <div class="agi-seal">AGI</div>

                <svg class="decoration" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                    <path d="M20,50 Q35,20 50,50 Q65,80 80,50" fill="none" stroke="var(--cert-template-gold)" stroke-width="1.5"/>
                </svg>

                <svg class="badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                    <path d="M50,10 L60,40 L90,40 L65,60 L75,90 L50,75 L25,90 L35,60 L10,40 L40,40 Z" fill="var(--cert-template-gold)" opacity="0.8"/>
                </svg>

                <h1 data-translate="cert_template_title">CERTIFICATE OF COMPLETION</h1>
                <div class="subtitle" data-translate="cert_template_subtitle">Presented with Honor by Road to Free Open AGI</div>

                <div class="description">
                    <span data-translate="cert_template_desc_prefix">This certificate recognizes that</span> <span id="recipientName" class="recipient">[Name]</span>
                    <span id="certDescriptionText">
                        <!-- Dynamic description text loaded here by JS -->
                    </span>
                </div>

                <div class="signatures">
                    <div class="signature">
                        <div class="signature-line"></div>
                        <div style="font-weight: bold; margin-top: 5px;">Gabriel M.</div>
                        <div data-translate="cert_template_signature_title">Founder & Instructor</div>
                        <div data-translate="cert_template_project_name">Road to Free Open AGI</div>
                    </div>
                </div>

                <div class="footer">
                    <div id="currentDate" style="font-style: italic; margin-bottom: 5px;"></div>
                    <div style="font-weight: bold; color: var(--cert-template-dark-blue); margin-bottom: 5px;">gabriel-agi.github.io/FreeOpenAGI/</div>
                    <div data-translate="cert_template_footer_note">This certificate recognizes achievement in open learning.</div>
                    <div class="disclaimer" data-translate="cert_template_disclaimer">Disclaimer: This certificate is generated based on locally stored progress without server-side verification or official accreditation. It serves as a personal marker of completion within this specific open learning resource.</div>
                </div>
            </div>
            <!-- Action Buttons Moved Below Certificate -->
            <div class="certificate-actions">
                <button id="certDownloadBtn"><i class="fas fa-download"></i> <span data-translate="cert_action_download">Download PDF</span></button>
                <button id="certCloseBtn"><i class="fas fa-times"></i> <span data-translate="cert_action_close">Close</span></button>
            </div>
        </div>
    </div>

    <!-- Chat Panel Overlay (Same as dashboard) -->
    <div id="chat-panel-overlay"></div>

    <!-- Chat Panel (Same as dashboard) -->
    <div id="chat-panel">
        <div class="chat-panel-header"> <h5 data-translate="chat_title"><i class="fas fa-cat"></i> Cat Assistant</h5> <button id="chat-close-button" data-translate-aria-label="chat_close_button_aria" aria-label="Close Chat">Ã—</button> </div>
        <div id="chatbox" aria-live="polite"> <!-- Initial message dynamically added --> </div>
        <div id="input-area"> <input id="userInput" type="text" autofocus data-translate-placeholder="chat_input_placeholder" placeholder="Ask Cat Assistant..."> <button id="sendButton" data-translate-aria-label="chat_send_button_aria" aria-label="Send Message"><i class="fas fa-paper-plane"></i></button> </div>
    </div>

    <!-- Floating Action Button (FAB) (Same as dashboard) -->
    <button id="chatbot-fab" data-translate-aria-label="chat_open_button_aria" aria-label="Open Course Assistant"> <i class="fas fa-comment-dots"></i> </button>

    <footer> <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p> </footer>

    <script>
        // --- Certificate Data Configuration ---
        // Maps certificate ID to its required modules and translation keys
        const certificateData = {
            basics: { modules: [0,1,2,3,4], nameKey: 'cert_card_title_basics', descKey: 'cert_desc_basics' },
            flow: { modules: [5,6,7,8,9,12,13,14,15], nameKey: 'cert_card_title_flow', descKey: 'cert_desc_flow' },
            data: { modules: [10,11,20,21,22], nameKey: 'cert_card_title_data', descKey: 'cert_desc_data' },
            functions: { modules: [16,17,18,19], nameKey: 'cert_card_title_functions', descKey: 'cert_desc_functions' },
            files: { modules: [23,24,25], nameKey: 'cert_card_title_files', descKey: 'cert_desc_files' },
            advanced: { modules: [26,27,28,29,30,31,32], nameKey: 'cert_card_title_advanced', descKey: 'cert_desc_advanced' },
            full: { modules: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32], nameKey: 'cert_card_title_full', descKey: 'cert_desc_full' }
        };

        // --- Translations Object (Expanded for Certificates Page & Template) ---
        const translations = {
             en: {
                 // Dashboard Keys (Keep relevant ones for reuse & chat)
                 "widget_lang_title": "Language", "lang_select_aria": "Select Language", "lang_en": "ðŸ‡¬ðŸ‡§ English", "lang_pt": "ðŸ‡§ðŸ‡· PortuguÃªs", "lang_zh": "ðŸ‡¨ðŸ‡³ ä¸­æ–‡", "widget_links_title": "Quick Links", "link_main_site": "Main Site", "footer_text": "Part of the Road to Free Open AGI Project", "chat_title": "Cat Assistant", /* ... other chat keys ... */"chat_close_button_aria": "Close Chat", "chat_send_button_aria": "Send Message", "chat_open_button_aria": "Open Course Assistant", "chat_input_placeholder":"Ask Cat Assistant...", "chat_initial_greeting": "Meow! I'm Cat Assistant...", "chat_typing_indicator": "Cat Assistant is pondering...", "chat_error_fetch": "Meow... sorry, couldn't connect ({status}).", "chat_error_generic": "Hiss! A network error occurred.", "chat_error_invalid_response": "Purr..don me, I received a strange response.", "chat_system_prompt": "You are Cat Assistant...",
                 // Certificate Page Specific Keys
                 "certificates_page_title": "My Certificates - Complete Python", "certificates_header_title": "My Certificates", "link_dashboard": "Back to Dashboard", "testing_controls_title": "Testing: Toggle Certificate Status",
                 "cert_card_title_basics": "Basics & I/O", "cert_card_title_flow": "Flow Control", "cert_card_title_data": "Data Structures", "cert_card_title_functions": "Functions", "cert_card_title_files": "Files & Errors", "cert_card_title_advanced": "Advanced Topics", "cert_card_title_full": "Full Course Completion",
                 "cert_status_locked": "<i class='fas fa-lock'></i> Locked", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> In Progress", "cert_status_earned": "<i class='fas fa-check-circle'></i> Earned!",
                 "cert_progress_info_basics": "Complete Knowledge Checks for modules 0-4.", "cert_progress_info_flow": "Complete Knowledge Checks for modules 5-9 & 12-15.", "cert_progress_info_data": "Complete Knowledge Checks for modules 10-11 & 20-22.", "cert_progress_info_functions": "Complete Knowledge Checks for modules 16-19.", "cert_progress_info_files": "Complete Knowledge Checks for modules 23-25.", "cert_progress_info_advanced": "Complete Knowledge Checks for modules 26-32.", "cert_progress_info_full": "Complete <strong>ALL</strong> Knowledge Checks in the course.",
                 "cert_form_name_label": "Full Name for Certificate:", "cert_form_name_placeholder": "Enter your full name", "cert_form_view_button": "View Certificate", "cert_generate_button_aria": "View Basics Certificate", /* ... other aria labels ... */ "cert_generate_button_aria_full": "View Full Course Certificate",
                 "cert_generate_error_name": "Please enter your full name.",
                 // Certificate Template Keys
                 "cert_template_title": "CERTIFICATE OF COMPLETION", "cert_template_subtitle": "Presented with Honor by Road to Free Open AGI", "cert_template_desc_prefix": "This certificate recognizes that",
                 "cert_desc_basics": "has demonstrated proficiency in Python <strong>Basics & Input/Output</strong>, mastering foundational concepts including variables, data types, operators, and user interaction.",
                 "cert_desc_flow": "has demonstrated proficiency in Python <strong>Flow Control</strong>, mastering conditional statements (if/elif/else) and looping structures (for/while).",
                 "cert_desc_data": "has demonstrated proficiency in Python <strong>Data Structures</strong>, mastering the use and manipulation of lists, dictionaries, and tuples.",
                 "cert_desc_functions": "has demonstrated proficiency in Python <strong>Functions</strong>, mastering function definition, parameters, return values, and basic scope.",
                 "cert_desc_files": "has demonstrated proficiency in Python <strong>File Handling & Errors</strong>, mastering reading from and writing to files, and basic exception handling.",
                 "cert_desc_advanced": "has demonstrated proficiency in <strong>Advanced Python Topics</strong>, including module imports, basic algorithms, and optional concepts like OOP and recursion.",
                 "cert_desc_full": "has successfully completed the <strong>Complete Python Course</strong>, demonstrating comprehensive understanding across all modules from basics to advanced topics.",
                 "cert_template_signature_title": "Founder & Instructor", "cert_template_project_name": "Road to Free Open AGI",
                 "cert_template_date_prefix": "Awarded on",
                 "cert_template_footer_note": "This certificate recognizes achievement in open learning.",
                 "cert_template_disclaimer": "Disclaimer: This certificate is generated based on locally stored progress without server-side verification or official accreditation. It serves as a personal marker of completion within this specific open learning resource.",
                 "cert_action_download": "Download PDF", "cert_action_close": "Close",
                 "day_suffix_st": "st", "day_suffix_nd": "nd", "day_suffix_rd": "rd", "day_suffix_th": "th" // For date formatting
             },
             pt: {
                 // Dashboard Keys
                 "widget_lang_title": "Idioma", "lang_select_aria": "Selecionar Idioma", "lang_en": "ðŸ‡¬ðŸ‡§ English", "lang_pt": "ðŸ‡§ðŸ‡· PortuguÃªs", "lang_zh": "ðŸ‡¨ðŸ‡³ ä¸­æ–‡", "widget_links_title": "Links RÃ¡pidos", "link_main_site": "Site Principal", "footer_text": "Parte do Projeto Road to Free Open AGI", "chat_title": "Gato Assistente", /* ... other chat keys ... */"chat_close_button_aria": "Fechar Chat", "chat_send_button_aria": "Enviar Mensagem", "chat_open_button_aria": "Abrir Assistente do Curso", "chat_input_placeholder":"Pergunte ao Gato Assistente...", "chat_initial_greeting": "Miau! Sou o Gato Assistente...", "chat_typing_indicator": "Gato Assistente estÃ¡ pensando...", "chat_error_fetch": "Miau... desculpe, nÃ£o consegui conectar ({status}).", "chat_error_generic": "Grrr! Ocorreu um erro de rede.", "chat_error_invalid_response": "Ronron..desculpe, recebi uma resposta estranha.", "chat_system_prompt": "VocÃª Ã© o Gato Assistente...",
                 // Certificate Page Specific Keys
                 "certificates_page_title": "Meus Certificados - Python Completo", "certificates_header_title": "Meus Certificados", "link_dashboard": "Voltar ao Painel", "testing_controls_title": "Teste: Alternar Status do Certificado",
                 "cert_card_title_basics": "BÃ¡sico & I/O", "cert_card_title_flow": "Controle de Fluxo", "cert_card_title_data": "Estruturas de Dados", "cert_card_title_functions": "FunÃ§Ãµes", "cert_card_title_files": "Arquivos & Erros", "cert_card_title_advanced": "TÃ³picos AvanÃ§ados", "cert_card_title_full": "ConclusÃ£o do Curso Completo",
                 "cert_status_locked": "<i class='fas fa-lock'></i> Bloqueado", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> Em Progresso", "cert_status_earned": "<i class='fas fa-check-circle'></i> Obtido!",
                 "cert_progress_info_basics": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 0-4.", "cert_progress_info_flow": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 5-9 e 12-15.", "cert_progress_info_data": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 10-11 e 20-22.", "cert_progress_info_functions": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 16-19.", "cert_progress_info_files": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 23-25.", "cert_progress_info_advanced": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 26-32.", "cert_progress_info_full": "Complete <strong>TODAS</strong> as VerificaÃ§Ãµes de Conhecimento do curso.",
                 "cert_form_name_label": "Nome Completo para o Certificado:", "cert_form_name_placeholder": "Digite seu nome completo", "cert_form_view_button": "Ver Certificado", "cert_generate_button_aria": "Ver Certificado BÃ¡sico", /* ... other aria labels ... */ "cert_generate_button_aria_full": "Ver Certificado Curso Completo",
                 "cert_generate_error_name": "Por favor, digite seu nome completo.",
                  // Certificate Template Keys
                 "cert_template_title": "CERTIFICADO DE CONCLUSÃƒO", "cert_template_subtitle": "Apresentado com Honra por Road to Free Open AGI", "cert_template_desc_prefix": "Este certificado reconhece que",
                 "cert_desc_basics": "demonstrou proficiÃªncia em <strong>BÃ¡sico & Entrada/SaÃ­da</strong> de Python, dominando conceitos fundamentais incluindo variÃ¡veis, tipos de dados, operadores e interaÃ§Ã£o com o usuÃ¡rio.",
                 "cert_desc_flow": "demonstrou proficiÃªncia em <strong>Controle de Fluxo</strong> em Python, dominando declaraÃ§Ãµes condicionais (if/elif/else) e estruturas de repetiÃ§Ã£o (for/while).",
                 "cert_desc_data": "demonstrou proficiÃªncia em <strong>Estruturas de Dados</strong> em Python, dominando o uso e manipulaÃ§Ã£o de listas, dicionÃ¡rios e tuplas.",
                 "cert_desc_functions": "demonstrou proficiÃªncia em <strong>FunÃ§Ãµes</strong> em Python, dominando definiÃ§Ã£o de funÃ§Ãµes, parÃ¢metros, valores de retorno e escopo bÃ¡sico.",
                 "cert_desc_files": "demonstrou proficiÃªncia em <strong>ManipulaÃ§Ã£o de Arquivos & Erros</strong> em Python, dominando leitura e escrita em arquivos e tratamento bÃ¡sico de exceÃ§Ãµes.",
                 "cert_desc_advanced": "demonstrou proficiÃªncia em <strong>TÃ³picos AvanÃ§ados de Python</strong>, incluindo importaÃ§Ã£o de mÃ³dulos, algoritmos bÃ¡sicos e conceitos opcionais como POO e recursÃ£o.",
                 "cert_desc_full": "concluiu com sucesso o <strong>Curso Completo de Python</strong>, demonstrando compreensÃ£o abrangente em todos os mÃ³dulos, do bÃ¡sico aos tÃ³picos avanÃ§ados.",
                 "cert_template_signature_title": "Fundador & Instrutor", "cert_template_project_name": "Road to Free Open AGI",
                 "cert_template_date_prefix": "Concedido em",
                 "cert_template_footer_note": "Este certificado reconhece a conquista em aprendizado aberto.",
                 "cert_template_disclaimer": "Aviso: Este certificado Ã© gerado com base no progresso armazenado localmente, sem verificaÃ§Ã£o no servidor ou acreditaÃ§Ã£o oficial. Serve como um marcador pessoal de conclusÃ£o dentro deste recurso especÃ­fico de aprendizado aberto.",
                 "cert_action_download": "Baixar PDF", "cert_action_close": "Fechar",
                 "day_suffix_st": "Âº", "day_suffix_nd": "Âº", "day_suffix_rd": "Âº", "day_suffix_th": "Âº" // Simple ordinal for Portuguese
             },
             zh: {
                 // Dashboard Keys
                 "widget_lang_title": "è¯­è¨€", "lang_select_aria": "é€‰æ‹©è¯­è¨€", "lang_en": "ðŸ‡¬ðŸ‡§ English", "lang_pt": "ðŸ‡§ðŸ‡· PortuguÃªs", "lang_zh": "ðŸ‡¨ðŸ‡³ ä¸­æ–‡", "widget_links_title": "å¿«é€Ÿé“¾æŽ¥", "link_main_site": "ä¸»ç½‘ç«™", "footer_text": "é€šå¾€è‡ªç”±å¼€æ”¾AGIä¹‹è·¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†", "chat_title": "çŒ«å’ªåŠ©æ‰‹", /* ... other chat keys ... */"chat_close_button_aria": "å…³é—­èŠå¤©", "chat_send_button_aria": "å‘é€æ¶ˆæ¯", "chat_open_button_aria": "æ‰“å¼€è¯¾ç¨‹åŠ©æ‰‹", "chat_input_placeholder":"è¯¢é—®çŒ«å’ªåŠ©æ‰‹...", "chat_initial_greeting": "å–µï¼æˆ‘æ˜¯çŒ«å’ªåŠ©æ‰‹...", "chat_typing_indicator": "çŒ«å’ªåŠ©æ‰‹æ­£åœ¨æ€è€ƒä¸­...", "chat_error_fetch": "å–µå‘œ...æŠ±æ­‰ï¼Œæ— æ³•è¿žæŽ¥ ({status})ã€‚", "chat_error_generic": "å˜¶ï¼å‘ç”Ÿäº†ç½‘ç»œé”™è¯¯ã€‚", "chat_error_invalid_response": "å‘œå–µ..ä¸å¥½æ„æ€ï¼Œæˆ‘æ”¶åˆ°äº†å¥‡æ€ªçš„å›žåº”ã€‚", "chat_system_prompt": "ä½ æ˜¯çŒ«å’ªåŠ©æ‰‹...",
                 // Certificate Page Specific Keys
                 "certificates_page_title": "æˆ‘çš„è¯ä¹¦ - Python å®Œå…¨æŒ‡å—", "certificates_header_title": "æˆ‘çš„è¯ä¹¦", "link_dashboard": "è¿”å›žä»ªè¡¨æ¿", "testing_controls_title": "æµ‹è¯•ï¼šåˆ‡æ¢è¯ä¹¦çŠ¶æ€",
                 "cert_card_title_basics": "åŸºç¡€ä¸Ž I/O", "cert_card_title_flow": "æµç¨‹æŽ§åˆ¶", "cert_card_title_data": "æ•°æ®ç»“æž„", "cert_card_title_functions": "å‡½æ•°", "cert_card_title_files": "æ–‡ä»¶ä¸Žé”™è¯¯", "cert_card_title_advanced": "é«˜çº§ä¸»é¢˜", "cert_card_title_full": "å®Œæ•´è¯¾ç¨‹ç»“ä¸š",
                 "cert_status_locked": "<i class='fas fa-lock'></i> æœªè§£é”", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> è¿›è¡Œä¸­", "cert_status_earned": "<i class='fas fa-check-circle'></i> å·²èŽ·å¾—!",
                 "cert_progress_info_basics": "å®Œæˆæ¨¡å— 0-4 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_flow": "å®Œæˆæ¨¡å— 5-9 å’Œ 12-15 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_data": "å®Œæˆæ¨¡å— 10-11 å’Œ 20-22 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_functions": "å®Œæˆæ¨¡å— 16-19 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_files": "å®Œæˆæ¨¡å— 23-25 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_advanced": "å®Œæˆæ¨¡å— 26-32 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_full": "å®Œæˆè¯¾ç¨‹ä¸­<strong>æ‰€æœ‰</strong>çš„çŸ¥è¯†æµ‹éªŒã€‚",
                 "cert_form_name_label": "è¯ä¹¦ä¸Šçš„å…¨å:", "cert_form_name_placeholder": "è¯·è¾“å…¥æ‚¨çš„å…¨å", "cert_form_view_button": "æŸ¥çœ‹è¯ä¹¦", "cert_generate_button_aria": "æŸ¥çœ‹åŸºç¡€è¯ä¹¦", /* ... other aria labels ... */ "cert_generate_button_aria_full": "æŸ¥çœ‹å®Œæ•´è¯¾ç¨‹è¯ä¹¦",
                 "cert_generate_error_name": "è¯·è¾“å…¥æ‚¨çš„å…¨åã€‚",
                  // Certificate Template Keys
                 "cert_template_title": "ç»“ä¸šè¯ä¹¦", "cert_template_subtitle": "ç”± Road to Free Open AGI è£èª‰é¢å‘", "cert_template_desc_prefix": "å…¹è¯æ˜Ž",
                 "cert_desc_basics": "å·²æŽŒæ¡ Python <strong>åŸºç¡€ä¸Žè¾“å…¥/è¾“å‡º</strong>ï¼Œç²¾é€šåŒ…æ‹¬å˜é‡ã€æ•°æ®ç±»åž‹ã€è¿ç®—ç¬¦å’Œç”¨æˆ·äº¤äº’åœ¨å†…çš„åŸºæœ¬æ¦‚å¿µã€‚",
                 "cert_desc_flow": "å·²æŽŒæ¡ Python <strong>æµç¨‹æŽ§åˆ¶</strong>ï¼Œç²¾é€šæ¡ä»¶è¯­å¥ (if/elif/else) å’Œå¾ªçŽ¯ç»“æž„ (for/while)ã€‚",
                 "cert_desc_data": "å·²æŽŒæ¡ Python <strong>æ•°æ®ç»“æž„</strong>ï¼Œç²¾é€šåˆ—è¡¨ã€å­—å…¸å’Œå…ƒç»„çš„ä½¿ç”¨ä¸Žæ“ä½œã€‚",
                 "cert_desc_functions": "å·²æŽŒæ¡ Python <strong>å‡½æ•°</strong>ï¼Œç²¾é€šå‡½æ•°å®šä¹‰ã€å‚æ•°ã€è¿”å›žå€¼å’ŒåŸºæœ¬ä½œç”¨åŸŸã€‚",
                 "cert_desc_files": "å·²æŽŒæ¡ Python <strong>æ–‡ä»¶å¤„ç†ä¸Žé”™è¯¯</strong>ï¼Œç²¾é€šæ–‡ä»¶è¯»å†™å’ŒåŸºæœ¬å¼‚å¸¸å¤„ç†ã€‚",
                 "cert_desc_advanced": "å·²æŽŒæ¡ <strong>Python é«˜çº§ä¸»é¢˜</strong>ï¼ŒåŒ…æ‹¬æ¨¡å—å¯¼å…¥ã€åŸºæœ¬ç®—æ³•ä»¥åŠé¢å‘å¯¹è±¡å’Œé€’å½’ç­‰å¯é€‰æ¦‚å¿µã€‚",
                 "cert_desc_full": "å·²æˆåŠŸå®Œæˆ <strong>Python å®Œå…¨æŒ‡å—è¯¾ç¨‹</strong>ï¼Œå±•ç¤ºäº†ä»ŽåŸºç¡€åˆ°é«˜çº§ä¸»é¢˜çš„å…¨é¢ç†è§£ã€‚",
                 "cert_template_signature_title": "åˆ›å§‹äººå…¼è®²å¸ˆ", "cert_template_project_name": "Road to Free Open AGI",
                 "cert_template_date_prefix": "æŽˆäºˆæ—¥æœŸï¼š",
                 "cert_template_footer_note": "æ­¤è¯ä¹¦æ—¨åœ¨è¡¨å½°åœ¨å¼€æ”¾å­¦ä¹ ä¸­å–å¾—çš„æˆå°±ã€‚",
                 "cert_template_disclaimer": "å…è´£å£°æ˜Žï¼šæ­¤è¯ä¹¦åŸºäºŽæœ¬åœ°å­˜å‚¨çš„è¿›åº¦ç”Ÿæˆï¼Œæœªç»æœåŠ¡å™¨ç«¯éªŒè¯æˆ–å®˜æ–¹è®¤è¯ã€‚å®ƒä»…ä½œä¸ºåœ¨æ­¤ç‰¹å®šå¼€æ”¾å­¦ä¹ èµ„æºä¸­ä¸ªäººå®Œæˆåº¦çš„æ ‡è®°ã€‚",
                 "cert_action_download": "ä¸‹è½½ PDF", "cert_action_close": "å…³é—­",
                 "day_suffix_st": "æ—¥", "day_suffix_nd": "æ—¥", "day_suffix_rd": "æ—¥", "day_suffix_th": "æ—¥" // Simple suffix for Chinese
             }
         };

        // --- JavaScript (Combined & Adapted) ---
        document.addEventListener('DOMContentLoaded', () => {

            const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
            const LANGUAGE_STORAGE_KEY = 'userLanguage';
            const bodyEl = document.body;

            // --- Core Elements ---
            const languageSelectElement = document.getElementById('languageSelect');
            const testingCheckboxesContainer = document.getElementById('testing-checkboxes');
            const certificateOverlay = document.getElementById('certificate-overlay');
            const certificateTemplate = document.getElementById('certificate-template');
            const recipientNameEl = document.getElementById('recipientName');
            const certDescriptionTextEl = document.getElementById('certDescriptionText');
            const currentDateEl = document.getElementById('currentDate');
            const certDownloadBtn = document.getElementById('certDownloadBtn');
            const certCloseBtn = document.getElementById('certCloseBtn');

            // --- Data Loading & Saving ---
            function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
            function saveKnowledgeCheckStatus(status) { try { localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(status)); } catch (e) { console.error("Error saving KC status to localStorage:", e); } }
            let knowledgeCheckStatus = loadKnowledgeCheckStatus();

            // --- Certificate Status Calculation ---
            function getCertificateStatus(moduleIds, statusObject) { if (!Array.isArray(moduleIds) || moduleIds.length === 0) return 'locked'; const allComplete = moduleIds.every(id => statusObject[id] === true); if (allComplete) return 'earned'; const anyComplete = moduleIds.some(id => statusObject[id] === true); return anyComplete ? 'inprogress' : 'locked'; }

            // --- Translation Functions ---
            function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); if (storedLang && translations[storedLang]) return storedLang; const browserLang = navigator.language || navigator.userLanguage; if (browserLang.startsWith('pt')) return 'pt'; if (browserLang.startsWith('zh')) return 'zh'; return 'en'; }
            function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
            function translatePage(lang) { if (!translations[lang]) lang = 'en'; document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang); if (el.tagName === 'TITLE') { document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; // Allow HTML in status messages } else { el.textContent = translation; } }); document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); }); document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); }); }
            function setLanguage(lang) { if (!translations[lang]) lang = 'en'; localStorage.setItem(LANGUAGE_STORAGE_KEY, lang); document.documentElement.lang = lang; if (languageSelectElement) languageSelectElement.value = lang; updatePageUI(); initializeChat(); /* Also update visible certificate if shown */ if (bodyEl.classList.contains('certificate-view')) { const currentCertId = certificateTemplate.dataset.certId; const currentName = recipientNameEl.textContent; if (currentCertId && currentName) displayCertificate(currentName, currentCertId); } }

            // --- UI Update Functions ---
            function updateCertificateCards(statusObject) {
                const certificateCards = document.querySelectorAll('.certificate-card[data-certificate-id]');
                const lang = getStoredLanguage();
                certificateCards.forEach(card => {
                    const certId = card.dataset.certificateId;
                    const certConfig = certificateData[certId];
                    if (!certConfig) return;
                    const status = getCertificateStatus(certConfig.modules, statusObject);
                    const statusElement = card.querySelector('.certificate-status');
                    card.classList.remove('status-locked', 'status-inprogress', 'status-earned');
                    card.classList.add(`status-${status}`);
                    if (statusElement) statusElement.innerHTML = getTranslation(`cert_status_${status}`, lang);
                    const messageElement = card.querySelector('.generate-message');
                    if (messageElement) { messageElement.textContent = ''; messageElement.className = 'generate-message'; }
                });
            }
             function updateTestingCheckboxes(statusObject) {
                 testingCheckboxesContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                     const certId = checkbox.value;
                     const certConfig = certificateData[certId];
                     if (certConfig) {
                         const status = getCertificateStatus(certConfig.modules, statusObject);
                         checkbox.checked = (status === 'earned');
                     }
                 });
             }
            function updatePageUI() {
                const lang = getStoredLanguage();
                translatePage(lang);
                updateCertificateCards(knowledgeCheckStatus);
                updateTestingCheckboxes(knowledgeCheckStatus); // Update checkboxes based on current status
            }

            // --- Certificate Display & Generation Logic ---
            function formatAwardDate(lang) {
                const today = new Date();
                const day = today.getDate();
                let suffixKey = 'day_suffix_th';
                if (lang === 'en') {
                    if (day % 10 === 1 && day !== 11) suffixKey = 'day_suffix_st';
                    else if (day % 10 === 2 && day !== 12) suffixKey = 'day_suffix_nd';
                    else if (day % 10 === 3 && day !== 13) suffixKey = 'day_suffix_rd';
                }
                const suffix = getTranslation(suffixKey, lang);

                let options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                // Adjust locale for display
                let locale = 'en-US';
                if (lang === 'pt') locale = 'pt-BR';
                else if (lang === 'zh') locale = 'zh-CN'; // Use appropriate Chinese locale

                let dateString = today.toLocaleDateString(locale, options);

                // Apply suffix correctly
                if (lang === 'en') {
                    dateString = dateString.replace(/\d+/, day + suffix);
                } else if (lang === 'pt') {
                    dateString = dateString.replace(day.toString(), day + suffix); // Add suffix after number for pt
                } else if (lang === 'zh') {
                     dateString = dateString.replace(day.toString(), day + suffix); // Add suffix after number for zh
                 }


                return `${getTranslation('cert_template_date_prefix', lang)} ${dateString}`;
            }

            function displayCertificate(name, certificateId) {
                const lang = getStoredLanguage();
                const certConfig = certificateData[certificateId];
                if (!name || !certConfig) return;

                // Populate Template
                recipientNameEl.textContent = name;
                certDescriptionTextEl.innerHTML = getTranslation(certConfig.descKey, lang); // Use innerHTML for potential <strong>
                currentDateEl.textContent = formatAwardDate(lang);
                certificateTemplate.dataset.certId = certificateId; // Store which cert is showing

                // Translate static parts of the template just in case
                translatePage(lang); // Re-translate everything including template parts

                // Show Overlay
                bodyEl.classList.add('certificate-view');
                certificateOverlay.scrollTop = 0; // Scroll overlay to top
            }

            function closeCertificate() {
                 bodyEl.classList.remove('certificate-view');
                 certificateTemplate.removeAttribute('data-cert-id');
            }

            function downloadAsPDF() {
                 console.log("Attempting to print/download certificate...");
                 window.print();
            }

            // --- Event Listeners ---
            // Language Selector
            if (languageSelectElement) { languageSelectElement.addEventListener('change', (e) => { setLanguage(e.target.value); }); }

            // View Certificate Buttons (on cards)
            document.querySelectorAll('.generate-button').forEach(button => {
                button.addEventListener('click', () => {
                    const certId = button.dataset.certificateId;
                    const nameInput = document.getElementById(`certNameInput-${certId}`);
                    const messageElement = document.getElementById(`generateMessage-${certId}`);
                    const userName = nameInput ? nameInput.value.trim() : '';
                    const lang = getStoredLanguage();

                    if (!userName) {
                        if (messageElement) { messageElement.textContent = getTranslation('cert_generate_error_name', lang); messageElement.className = 'generate-message error'; }
                        if (nameInput) nameInput.focus();
                        return;
                    }
                    if (messageElement) { messageElement.textContent = ''; messageElement.className = 'generate-message'; } // Clear error on success
                    displayCertificate(userName, certId);
                });
            });

             // Certificate Overlay Action Buttons
             if (certDownloadBtn) certDownloadBtn.addEventListener('click', downloadAsPDF);
             if (certCloseBtn) certCloseBtn.addEventListener('click', closeCertificate);
             // Close on clicking overlay background (optional)
             if (certificateOverlay) certificateOverlay.addEventListener('click', (e) => { if (e.target === certificateOverlay) closeCertificate(); });
             // Close on Escape key
             document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && bodyEl.classList.contains('certificate-view')) closeCertificate(); });

            // Testing Checkboxes Setup & Listener
            Object.keys(certificateData).forEach(certId => {
                const certConfig = certificateData[certId];
                const lang = getStoredLanguage();
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = certId;
                checkbox.id = `test-check-${certId}`;
                // Initial state set in updateTestingCheckboxes
                label.htmlFor = checkbox.id;
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(` ${getTranslation(certConfig.nameKey, lang)}`)); // Add translated name
                testingCheckboxesContainer.appendChild(label);

                checkbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const modulesToToggle = certConfig.modules;
                    modulesToToggle.forEach(moduleId => {
                        knowledgeCheckStatus[moduleId] = isChecked; // Set status based on checkbox
                    });
                    saveKnowledgeCheckStatus(knowledgeCheckStatus); // Save updated status
                    updatePageUI(); // Refresh card display and checkbox states
                });
            });


            // --- Staggered Card Animation ---
            const cards = document.querySelectorAll('.certificate-card');
            cards.forEach((card, index) => { const delay = index * 0.05; card.style.animationDelay = `${delay}s`; card.classList.add('card-fade-in'); });

            // --- Chat Panel Logic (Copied from previous version) ---
            const chatbotFab = document.getElementById('chatbot-fab');
            const chatPanel = document.getElementById('chat-panel');
            const chatCloseButton = document.getElementById('chat-close-button');
            const chatPanelOverlay = document.getElementById('chat-panel-overlay');
            const chatboxEl = document.getElementById('chatbox');
            const userInputEl = document.getElementById('userInput');
            const sendButtonEl = document.getElementById('sendButton');
            function openChatPanel() { bodyEl.classList.add('chat-open'); chatbotFab.setAttribute('aria-expanded', 'true'); try { userInputEl.focus(); } catch(e){} }
            function closeChatPanel() { bodyEl.classList.remove('chat-open'); chatbotFab.setAttribute('aria-expanded', 'false'); }
            if (chatbotFab && chatPanel && chatCloseButton && chatPanelOverlay && userInputEl) {
                chatbotFab.addEventListener('click', () => { bodyEl.classList.contains('chat-open') ? closeChatPanel() : openChatPanel(); });
                chatCloseButton.addEventListener('click', closeChatPanel);
                chatPanelOverlay.addEventListener('click', closeChatPanel);
                document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && bodyEl.classList.contains('chat-open')) { closeChatPanel(); } });
            }
            let conversationHistory = [];
            function displayMessage(role, textKey, replacements = {}, isRawText = false) {
                const lang = getStoredLanguage(); const text = isRawText ? textKey : getTranslation(textKey, lang, replacements);
                 const messageContainer = document.createElement('div'); messageContainer.classList.add('message-container');
                 const avatar = document.createElement('div'); avatar.classList.add('message-avatar');
                 const messageBubble = document.createElement('div'); messageBubble.classList.add('message');
                 if (role === 'user') { messageContainer.classList.add('user-message-container'); avatar.innerHTML = '<i class="fas fa-user"></i>'; messageBubble.classList.add('user-message'); }
                  else if (role === 'assistant') { messageContainer.classList.add('bot-message-container'); avatar.innerHTML = '<i class="fas fa-cat"></i>'; messageBubble.classList.add('bot-message'); }
                  else if (role === 'error') { messageBubble.classList.add('error-message'); messageBubble.innerHTML = `<strong>Error:</strong> ${text}`; chatboxEl.appendChild(messageBubble); chatboxEl.scrollTop = chatboxEl.scrollHeight; return; }
                  else if (role === 'typing') { const typingDiv = document.createElement('div'); typingDiv.classList.add('typing-indicator'); typingDiv.innerHTML = `<i class="fas fa-paw"></i> <span>${getTranslation('chat_typing_indicator', lang)}</span> <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>`; chatboxEl.appendChild(typingDiv); chatboxEl.scrollTop = chatboxEl.scrollHeight; return typingDiv; }
                  messageBubble.textContent = text; // Safer default
                  messageContainer.appendChild(avatar); messageContainer.appendChild(messageBubble); chatboxEl.appendChild(messageContainer); chatboxEl.scrollTop = chatboxEl.scrollHeight;
            }
             async function sendMessage() {
                 const userText = userInputEl.value.trim(); if (!userText) return;
                 displayMessage('user', userText, {}, true); conversationHistory.push({ role: "user", content: userText });
                 userInputEl.value = ''; sendButtonEl.disabled = true;
                 const typingIndicator = displayMessage('typing', '');
                 const proxyUrl = '/api/proxy'; const lang = getStoredLanguage();
                 const systemPrompt = { role: "system", content: getTranslation('chat_system_prompt', lang) };
                 const messagesToSend = [systemPrompt, ...conversationHistory.slice(-10)]; // Keep history manageable
                 try {
                     const response = await fetch(proxyUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ model: "glm-4-flash", messages: messagesToSend, temperature: 0.6, max_tokens: 150 }) });
                     if (typingIndicator) typingIndicator.remove();
                     if (!response.ok) { const errorText = await response.text(); console.error(`Proxy/API Error (${response.status}):`, errorText); displayMessage('error', getTranslation('chat_error_fetch', lang, { status: response.status }), {}, true); throw new Error(`HTTP error! status: ${response.status}`); }
                     const data = await response.json();
                     if (data.choices?.[0]?.message?.content) { const botText = data.choices[0].message.content.trim(); conversationHistory.push({ role: "assistant", content: botText }); displayMessage('assistant', botText, {}, true); }
                     else { console.error("Invalid API response:", data); displayMessage('error', getTranslation('chat_error_invalid_response', lang), {}, true); }
                 } catch (error) { console.error('Chat fetch error:', error); if (typingIndicator && typingIndicator.parentNode === chatboxEl) typingIndicator.remove(); if (!chatboxEl.querySelector('.error-message')) { displayMessage('error', getTranslation('chat_error_generic', lang), {}, true); }
                 } finally { sendButtonEl.disabled = false; if (bodyEl.classList.contains('chat-open')) try{userInputEl.focus();}catch(e){} }
             }
             if (sendButtonEl && userInputEl) { sendButtonEl.addEventListener('click', sendMessage); userInputEl.addEventListener('keypress', (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); } }); }
             function initializeChat() { const lang = getStoredLanguage(); const initialGreeting = getTranslation('chat_initial_greeting', lang); conversationHistory = [{ role: "assistant", content: initialGreeting }]; chatboxEl.innerHTML = ''; displayMessage('assistant', initialGreeting, {}, true); }
            // --- Final Initialization ---
            initializeChat(); // Initialize chat first
            updatePageUI(); // Then update the rest of the UI, including initial translations and checkbox setup

        }); // End DOMContentLoaded
    </script>

</body>
</html>
