<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set by JS -->
    <title data-translate="certificates_page_title">My Certificates - Complete Python</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Same as dashboard.html) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14;
            --check-color: #6f42c1;
            --certificate-color: #d63384; /* Pinkish */
            --chat-panel-bg: #ffffff;
            --chat-box-bg: #f8f9fa;
            --chat-bot-bg: #e9ecef;
            --chat-bot-text: #343a40;
            --chat-user-bg: #d1e7ff;
            --chat-user-text: #0a58ca;
            --chat-error-bg: #f8d7da;
            --chat-error-text: #842029;
            --chat-border-color: #dee2e6;
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --sidebar-width: 260px;
             /* Colors for lang switcher (Same as dashboard) */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
             /* Certificate specific variables */
            --cert-locked-color: var(--secondary-color);
            --cert-inprogress-color: var(--accent-color);
            --cert-earned-color: var(--success-color);
            --cert-generate-button-bg: var(--success-color);
            --cert-generate-button-hover-bg: #157347;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            overflow-x: hidden;
        }
        body.chat-open { overflow: hidden; } /* Same as dashboard */

        /* --- Animations (Same as dashboard) --- */
        .card-fade-in { opacity: 0; transform: translateY(20px); animation: fadeInAnimation 0.6s ease-out forwards; }
        @keyframes fadeInAnimation { to { opacity: 1; transform: translateY(0); } }

        /* --- Page Header (Simplified from dashboard) --- */
        .page-header { background: var(--background-header); color: var(--text-light); padding: 2rem 1.5rem 2rem 1.5rem; /* Adjusted padding */ margin-bottom: 2rem; position: relative; }
        .header-content { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; text-align: center; /* Center title */ }
        .page-header h1 { font-family: var(--font-title); font-size: 2.2rem; margin-bottom: 0; /* Remove margin */ text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); }

        /* --- Page Layout (Same as dashboard) --- */
        .page-container { max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; display: flex; gap: 2rem; align-items: flex-start; }

        /* --- Sidebar (Simplified from dashboard) --- */
        .page-sidebar { width: var(--sidebar-width); flex-shrink: 0; position: sticky; top: 20px; height: calc(100vh - 40px); overflow-y: auto; padding-right: 10px; scrollbar-width: thin; scrollbar-color: var(--secondary-color) var(--background-page); }
        .page-sidebar::-webkit-scrollbar { width: 6px; }
        .page-sidebar::-webkit-scrollbar-track { background: var(--background-page); }
        .page-sidebar::-webkit-scrollbar-thumb { background-color: var(--secondary-color); border-radius: 3px; }
        .sidebar-widget { background-color: var(--background-sidebar); border-radius: var(--border-radius); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--card-shadow); border: 1px solid var(--border-color); }
        .sidebar-widget h4 { font-family: var(--font-title); font-size: 1.1rem; margin-bottom: 1rem; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; display: flex; align-items: center; }
        .sidebar-widget h4 i { margin-right: 8px; color: var(--primary-color); opacity: 0.8; }
        .sidebar-widget ul { list-style: none; padding: 0; margin: 0; }
        /* Language Switcher Styles (Same as dashboard) */
         .language-switcher { margin-top: 1rem; }
         #languageSelect {
            width: 100%; background: var(--background-card); color: var(--text-dark); border: 1px solid var(--lang-select-border); border-radius: 5px; padding: 8px 35px 8px 15px; cursor: pointer; font-size: 0.95rem; font-weight: 500; appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 12px center; background-size: 10px auto; transition: border-color 0.3s ease;
         }
         #languageSelect:hover { border-color: #b02a6e; }
         #languageSelect:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
         #languageSelect option { background: var(--lang-option-bg); color: var(--lang-option-text); padding: 5px; }
        /* Links Widget Styles (Simplified) */
        .sidebar-links ul li { margin-bottom: 0.75rem; }
        .sidebar-links ul li a { display: inline-flex; align-items: center; text-decoration: none; border-radius: 5px; padding: 0.6rem 1rem; font-size: 0.9rem; font-weight: 500; transition: all var(--transition-speed) ease; border: 1px solid transparent; }
        .sidebar-links ul li a i { margin-right: 6px; }
        .sidebar-links .link-dashboard { background-color: var(--primary-color); color: var(--text-light); border-color: var(--primary-color); }
        .sidebar-links .link-dashboard:hover { background-color: #0b5ed7; }
        .sidebar-links .link-main-site { background-color: var(--secondary-color); color: var(--text-light); border-color: var(--secondary-color); }
        .sidebar-links .link-main-site:hover { background-color: #5a6268; }

        /* --- Main Content Area --- */
        .page-main { flex-grow: 1; min-width: 0; }
        .certificates-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }

        /* --- Certificate Card Styling --- */
        .certificate-card {
            background-color: var(--background-card); border-radius: var(--border-radius);
            box-shadow: var(--card-shadow); transition: all var(--transition-speed) ease-in-out;
            display: flex; flex-direction: column; border: 1px solid var(--border-color);
            border-left: 5px solid var(--cert-locked-color); /* Default border */
            overflow: hidden; position: relative; opacity: 0; transform: translateY(20px);
            padding: 1.5rem;
        }
        .certificate-card:hover { transform: translateY(-5px); box-shadow: var(--card-shadow-hover); }
        /* Status specific styles */
        .certificate-card.status-locked { border-left-color: var(--cert-locked-color); }
        .certificate-card.status-inprogress { border-left-color: var(--cert-inprogress-color); }
        .certificate-card.status-earned { border-left-color: var(--cert-earned-color); }
        .certificate-card.status-earned .certificate-locked-info { display: none; }
        .certificate-card:not(.status-earned) .certificate-generate-form { display: none; }

        .certificate-card h3 {
            font-family: var(--font-title); font-size: 1.3rem; color: var(--text-dark);
            margin-bottom: 0.8rem; line-height: 1.3; display: flex; align-items: center;
        }
        .certificate-card h3 i { margin-right: 10px; color: var(--certificate-color); /* Pinkish icon */ }
        .certificate-status {
            font-size: 0.95rem; font-weight: 500; margin-bottom: 1rem;
            padding: 0.4rem 0.8rem; border-radius: 4px; display: inline-block;
            border: 1px solid transparent;
        }
        .certificate-card.status-locked .certificate-status {
            color: var(--cert-locked-color); background-color: #e9ecef;
            border-color: var(--cert-locked-color);
        }
        .certificate-card.status-inprogress .certificate-status {
            color: #856404; background-color: #fff3cd; /* Darker yellow text */
            border-color: var(--cert-inprogress-color);
        }
         .certificate-card.status-earned .certificate-status {
            color: var(--cert-earned-color); background-color: #d1e7dd; /* Lighter green background */
            border-color: var(--cert-earned-color);
        }
        .certificate-status i { margin-right: 6px; }

        .certificate-locked-info p { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        .certificate-locked-info strong { color: var(--text-dark); }

        .certificate-generate-form { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px dashed var(--border-color); }
        .certificate-generate-form label { display: block; font-weight: 500; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .certificate-generate-form input[type="text"] {
            width: 100%; padding: 0.7rem 1rem; margin-bottom: 1rem;
            border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .certificate-generate-form input[type="text"]:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }
        .generate-button {
            background-color: var(--cert-generate-button-bg); color: var(--text-light);
            border: none; border-radius: 5px; padding: 0.7rem 1.5rem;
            font-size: 0.95rem; font-weight: 500; cursor: pointer;
            transition: background-color var(--transition-speed) ease; display: inline-flex; align-items: center;
        }
        .generate-button:hover { background-color: var(--cert-generate-button-hover-bg); }
        .generate-button i { margin-right: 8px; }
        .generate-message { font-size: 0.85rem; margin-top: 0.5rem; }
        .generate-message.success { color: var(--success-color); }
        .generate-message.error { color: var(--error-color); }

        /* --- Footer (Same as dashboard) --- */
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; background-color: var(--background-card); border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.9rem; }

        /* --- Chat Panel & FAB Styles (Same as dashboard) --- */
        #chatbot-fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(45deg, var(--primary-color), #0b5ed7); color: white; border: none; border-radius: 50%; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); transition: all var(--transition-speed) ease; z-index: 1010; }
        #chatbot-fab:hover { transform: scale(1.1); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25); }
        #chatbot-fab i { transition: transform 0.3s ease; }
        body.chat-open #chatbot-fab { background: linear-gradient(45deg, var(--secondary-color), #5a6268); }
        body.chat-open #chatbot-fab i { transform: rotate(135deg); }
        #chat-panel-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); backdrop-filter: blur(2px); opacity: 0; visibility: hidden; transition: opacity var(--transition-speed) ease, visibility 0s var(--transition-speed); z-index: 1000; }
        body.chat-open #chat-panel-overlay { opacity: 1; visibility: visible; transition-delay: 0s; }
        #chat-panel { position: fixed; bottom: 30px; right: 100px; width: 90vw; max-width: 450px; height: 75vh; max-height: 650px; background-color: var(--chat-panel-bg); border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 1px solid var(--chat-border-color); display: flex; flex-direction: column; z-index: 1005; opacity: 0; transform: translateY(20px) scale(0.98); visibility: hidden; transition: opacity var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1), transform var(--transition-speed) cubic-bezier(0.165, 0.84, 0.44, 1), visibility 0s var(--transition-speed); transform-origin: bottom right; }
        body.chat-open #chat-panel { opacity: 1; transform: translateY(0) scale(1); visibility: visible; transition-delay: 0s; }
        .chat-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 1.2rem; border-bottom: 1px solid var(--chat-border-color); background-color: var(--background-page); border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .chat-panel-header h5 { margin: 0; font-family: var(--font-title); font-size: 1.1rem; color: var(--primary-color); display: flex; align-items: center; }
        .chat-panel-header h5 i { margin-right: 8px; color: var(--certificate-color); }
        #chat-close-button { background: none; border: none; font-size: 1.5rem; color: var(--text-muted); cursor: pointer; padding: 0.2rem; line-height: 1; transition: color var(--transition-speed); }
        #chat-close-button:hover { color: var(--text-dark); }
        #chatbox { flex-grow: 1; overflow-y: auto; padding: 1.5rem; background-color: var(--chat-box-bg); font-family: var(--font-body); line-height: 1.6; scrollbar-width: thin; scrollbar-color: var(--secondary-color) var(--chat-box-bg); }
        #chatbox::-webkit-scrollbar { width: 6px; }
        #chatbox::-webkit-scrollbar-track { background: var(--chat-box-bg); }
        #chatbox::-webkit-scrollbar-thumb { background-color: var(--secondary-color); border-radius: 3px; }
        #chatbox .message-container { display: flex; margin-bottom: 1rem; align-items: flex-end; }
        #chatbox .message-avatar { width: 35px; height: 35px; border-radius: 50%; background-color: var(--secondary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; margin-right: 10px; }
        #chatbox .user-message-container .message-avatar { background-color: var(--primary-color); /* Consistent user avatar */}
        #chatbox .bot-message-container .message-avatar { background-color: var(--certificate-color); /* Consistent bot avatar */}
        #chatbox .message { padding: 10px 15px; border-radius: 18px; max-width: 80%; word-wrap: break-word; font-size: 0.95rem; position: relative; border: 1px solid var(--chat-border-color); box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        #chatbox .user-message-container { justify-content: flex-end; }
        #chatbox .user-message-container .message-avatar { margin-right: 0; margin-left: 10px; order: 2; }
        #chatbox .user-message-container .message { order: 1; }
        #chatbox .user-message { background-color: var(--chat-user-bg); color: var(--chat-user-text); border-color: var(--chat-user-bg); border-top-right-radius: 4px; }
        #chatbox .bot-message { background-color: var(--chat-bot-bg); color: var(--chat-bot-text); border-color: var(--chat-bot-bg); border-top-left-radius: 4px; }
        #chatbox .error-message { background-color: var(--chat-error-bg); color: var(--chat-error-text); border-color: #f5c6cb; margin-bottom: 1rem; }
        #chatbox .message strong { display: none; } /* Keep this if dashboard uses it */
        #chatbox .typing-indicator { display: flex; align-items: center; color: var(--text-muted); font-style: italic; margin-bottom: 1rem; padding: 8px 15px; font-size: 0.9rem; }
        #chatbox .typing-indicator i { margin-right: 8px; color: var(--certificate-color); }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .typing-dot { width: 6px; height: 6px; background-color: var(--text-muted); border-radius: 50%; display: inline-block; margin: 0 2px; animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        #input-area { display: flex; padding: 0.8rem; border-top: 1px solid var(--chat-border-color); background-color: var(--background-page); align-items: center; }
        #userInput { flex-grow: 1; border: 1px solid var(--chat-border-color); border-radius: 18px; padding: 0.7rem 1rem; font-size: 0.95rem; background-color: var(--background-card); color: var(--text-dark); outline: none; transition: border-color var(--transition-speed); resize: none; max-height: 80px; font-family: var(--font-body); }
        #userInput:focus { border-color: var(--primary-color); }
        #sendButton { background-color: var(--primary-color); color: var(--text-light); border: none; border-radius: 50%; width: 40px; height: 40px; margin-left: 0.7rem; padding: 0; cursor: pointer; font-size: 1.1rem; transition: background-color var(--transition-speed); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        #sendButton:hover { background-color: #0b5ed7; }
        #sendButton:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }

        /* --- Responsive Design (Adjustments from dashboard) --- */
        @media (max-width: 1200px) { .page-container { padding: 0 1rem; gap: 1.5rem; } :root { --sidebar-width: 240px; } #chat-panel { right: 85px; max-width: 420px;} }
        @media (max-width: 992px) {
            .page-container { flex-direction: column; }
            .page-sidebar { width: 100%; position: static; height: auto; overflow-y: visible; padding-right: 0; margin-bottom: 2rem; }
            .sidebar-widget { padding: 1.2rem; }
            .certificates-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
             #chat-panel { right: 30px; bottom: 90px; max-width: 400px; height: 70vh;}
        }
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .page-header h1 { font-size: 1.8rem; }
            .certificates-grid { grid-template-columns: 1fr; gap: 1rem; }
            .certificate-card { padding: 1.2rem; }
             #chat-panel { right: 15px; bottom: 80px; left: 15px; width: auto; max-width: none; height: 65vh; }
        }
        @media (max-width: 576px) {
            html { font-size: 14px; }
            .page-header { padding: 1.5rem 1rem 1.5rem 1rem; }
            .page-header h1 { font-size: 1.6rem; }
            .certificate-card h3 { font-size: 1.15rem; }
            .certificate-generate-form input[type="text"] { font-size: 0.95rem; }
            .generate-button { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
            /* Chat adjustments same as dashboard */
            #chatbot-fab { width: 50px; height: 50px; font-size: 1.5rem; bottom: 20px; right: 20px; }
            #chat-panel { bottom: 75px; right: 10px; left: 10px; height: 60vh; }
            #chatbox { padding: 1rem; }
            #chatbox .message-avatar { width: 30px; height: 30px; font-size: 1rem; }
            #chatbox .message { font-size: 0.9rem; padding: 8px 12px;}
            #input-area { padding: 0.6rem; }
            #userInput { padding: 0.6rem 0.8rem; font-size: 0.9rem; border-radius: 15px;}
            #sendButton { width: 35px; height: 35px; font-size: 1rem; margin-left: 0.5rem;}
        }

    </style>
</head>
<body>

    <header class="page-header">
        <div class="header-content">
            <h1 data-translate="certificates_header_title">My Certificates</h1>
        </div>
    </header>

    <div class="page-container">

        <!-- === Sidebar === -->
        <aside class="page-sidebar">
            <!-- Language Switcher Widget -->
            <div class="sidebar-widget">
                <h4><i class="fas fa-language"></i> <span data-translate="widget_lang_title">Language</span></h4>
                 <div class="language-switcher">
                    <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                        <option value="en" data-translate="lang_en">ğŸ‡¬ğŸ‡§ English</option>
                        <option value="pt" data-translate="lang_pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                        <option value="zh" data-translate="lang_zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    </select>
                </div>
            </div>

             <!-- Links Widget -->
             <div class="sidebar-widget sidebar-links">
                 <h4><i class="fas fa-link"></i> <span data-translate="widget_links_title">Quick Links</span></h4>
                  <ul>
                    <li><a href="dashboard.html" class="link-dashboard"><i class="fas fa-tachometer-alt"></i> <span data-translate="link_dashboard">Back to Dashboard</span></a></li>
                    <li><a href="index.html" class="link-main-site"><i class="fas fa-home"></i> <span data-translate="link_main_site">Main Site</span></a></li>
                  </ul>
             </div>
        </aside>

        <!-- === Main Content === -->
        <main class="page-main">
            <div class="certificates-grid">

                <!-- Certificate Card: Basics & I/O -->
                <div class="certificate-card card-fade-in" data-certificate-id="basics" data-modules="0,1,2,3,4">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_basics_name">Basics & I/O</span></h3>
                    <div class="certificate-status">
                        <!-- Status text set by JS -->
                    </div>
                    <div class="certificate-locked-info">
                        <p data-translate="cert_progress_info">Complete Knowledge Checks for modules 0-4.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-basics" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-basics" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="basics" data-translate-aria-label="cert_generate_button_aria" aria-label="Generate Basics Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-basics"></div>
                    </div>
                </div>

                <!-- Certificate Card: Flow Control -->
                 <div class="certificate-card card-fade-in" data-certificate-id="flow" data-modules="5,6,7,8,9,12,13,14,15">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_flow_name">Flow Control</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                        <p data-translate="cert_progress_info_flow">Complete Knowledge Checks for modules 5-9 & 12-15.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-flow" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-flow" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="flow" data-translate-aria-label="cert_generate_button_aria_flow" aria-label="Generate Flow Control Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-flow"></div>
                    </div>
                </div>

                <!-- Certificate Card: Data Structures -->
                 <div class="certificate-card card-fade-in" data-certificate-id="data" data-modules="10,11,20,21,22">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_data_name">Data Structures</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                         <p data-translate="cert_progress_info_data">Complete Knowledge Checks for modules 10-11 & 20-22.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-data" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-data" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="data" data-translate-aria-label="cert_generate_button_aria_data" aria-label="Generate Data Structures Certificate">
                           <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-data"></div>
                    </div>
                </div>

                <!-- Certificate Card: Functions -->
                 <div class="certificate-card card-fade-in" data-certificate-id="functions" data-modules="16,17,18,19">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_functions_name">Functions</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                         <p data-translate="cert_progress_info_functions">Complete Knowledge Checks for modules 16-19.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-functions" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-functions" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="functions" data-translate-aria-label="cert_generate_button_aria_functions" aria-label="Generate Functions Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-functions"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Files & Errors -->
                 <div class="certificate-card card-fade-in" data-certificate-id="files" data-modules="23,24,25">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_files_name">Files & Errors</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                         <p data-translate="cert_progress_info_files">Complete Knowledge Checks for modules 23-25.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-files" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-files" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="files" data-translate-aria-label="cert_generate_button_aria_files" aria-label="Generate Files & Errors Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-files"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Advanced Topics -->
                 <div class="certificate-card card-fade-in" data-certificate-id="advanced" data-modules="26,27,28,29,30,31,32">
                    <h3><i class="fas fa-award"></i> <span data-translate="cert_advanced_name">Advanced Topics</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                         <p data-translate="cert_progress_info_advanced">Complete Knowledge Checks for modules 26-32.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-advanced" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-advanced" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="advanced" data-translate-aria-label="cert_generate_button_aria_advanced" aria-label="Generate Advanced Topics Certificate">
                            <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                         <div class="generate-message" id="generateMessage-advanced"></div>
                    </div>
                </div>

                 <!-- Certificate Card: Full Course -->
                 <div class="certificate-card card-fade-in" data-certificate-id="full" data-modules="0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32">
                    <h3><i class="fas fa-graduation-cap"></i> <span data-translate="cert_full_name">Full Course Completion</span></h3>
                    <div class="certificate-status"></div>
                    <div class="certificate-locked-info">
                         <p data-translate="cert_progress_info_full">Complete <strong>ALL</strong> Knowledge Checks in the course.</p>
                    </div>
                    <div class="certificate-generate-form">
                        <label for="certNameInput-full" data-translate="cert_form_name_label">Full Name for Certificate:</label>
                        <input type="text" id="certNameInput-full" data-translate-placeholder="cert_form_name_placeholder" placeholder="Enter your full name">
                        <button type="button" class="generate-button" data-certificate-id="full" data-translate-aria-label="cert_generate_button_aria_full" aria-label="Generate Full Course Certificate">
                             <i class="fas fa-file-signature"></i> <span data-translate="cert_form_generate_button">Generate Certificate</span>
                        </button>
                        <div class="generate-message" id="generateMessage-full"></div>
                    </div>
                </div>

            </div><!-- /.certificates-grid -->
        </main>

    </div><!-- /.page-container -->

    <!-- Chat Panel Overlay (Same as dashboard) -->
    <div id="chat-panel-overlay"></div>

    <!-- Chat Panel (Same as dashboard) -->
    <div id="chat-panel">
        <div class="chat-panel-header">
            <h5 data-translate="chat_title"><i class="fas fa-cat"></i> Cat Assistant</h5>
            <button id="chat-close-button" data-translate-aria-label="chat_close_button_aria" aria-label="Close Chat">Ã—</button>
        </div>
        <div id="chatbox" aria-live="polite">
            <!-- Initial message dynamically added -->
        </div>
        <div id="input-area">
            <input id="userInput" type="text" autofocus data-translate-placeholder="chat_input_placeholder" placeholder="Ask Cat Assistant...">
            <button id="sendButton" data-translate-aria-label="chat_send_button_aria" aria-label="Send Message"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- Floating Action Button (FAB) (Same as dashboard) -->
    <button id="chatbot-fab" data-translate-aria-label="chat_open_button_aria" aria-label="Open Course Assistant">
        <i class="fas fa-comment-dots"></i>
    </button>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Translations Object (Expanded for Certificates Page) ---
        const translations = {
             en: {
                 // Dashboard Keys (Keep relevant ones for reuse & chat)
                 "widget_lang_title": "Language", "lang_select_aria": "Select Language", "lang_en": "ğŸ‡¬ğŸ‡§ English", "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs", "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡", "widget_links_title": "Quick Links", "link_main_site": "Main Site", "footer_text": "Part of the Road to Free Open AGI Project", "chat_title": "Cat Assistant", "chat_initial_greeting": "Meow! I'm Cat Assistant, ready to help with Python & Computational Thinking. Ask me anything!", "chat_typing_indicator": "Cat Assistant is pondering", "chat_input_placeholder": "Ask Cat Assistant...", "chat_error_fetch": "Meow... sorry, couldn't connect ({status}).", "chat_error_generic": "Hiss! A network error occurred.", "chat_error_invalid_response": "Purr..don me, I received a strange response.", "chat_system_prompt": "You are Cat Assistant, a friendly, cute, and helpful cat-themed AI assistant for a Python programming and Computational Thinking course. You know a lot about Python syntax, concepts like loops, functions, data structures, and Computational Thinking principles (like decomposition, pattern recognition, abstraction, algorithms). Respond concisely and clearly, like a helpful cat guiding a student. Use cat puns sparingly and appropriately. Keep answers focused and relatively short.", "chat_close_button_aria": "Close Chat", "chat_send_button_aria": "Send Message", "chat_open_button_aria": "Open Course Assistant",
                 // Certificate Keys (Reused from dashboard sidebar where applicable)
                 "cert_basics_name": "Basics & I/O Certificate", "cert_flow_name": "Flow Control Certificate", "cert_data_name": "Data Structures Certificate", "cert_functions_name": "Functions Certificate", "cert_files_name": "Files & Errors Certificate", "cert_advanced_name": "Advanced Topics Certificate", "cert_full_name": "Full Course Completion",
                 // New Certificate Page Specific Keys
                 "certificates_page_title": "My Certificates - Complete Python", "certificates_header_title": "My Certificates", "link_dashboard": "Back to Dashboard", "cert_status_locked": "<i class='fas fa-lock'></i> Locked", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> In Progress", "cert_status_earned": "<i class='fas fa-check-circle'></i> Earned!", "cert_progress_info": "Complete Knowledge Checks for modules 0-4.", "cert_progress_info_flow": "Complete Knowledge Checks for modules 5-9 & 12-15.", "cert_progress_info_data": "Complete Knowledge Checks for modules 10-11 & 20-22.", "cert_progress_info_functions": "Complete Knowledge Checks for modules 16-19.", "cert_progress_info_files": "Complete Knowledge Checks for modules 23-25.", "cert_progress_info_advanced": "Complete Knowledge Checks for modules 26-32.", "cert_progress_info_full": "Complete <strong>ALL</strong> Knowledge Checks in the course.", "cert_form_name_label": "Full Name for Certificate:", "cert_form_name_placeholder": "Enter your full name", "cert_form_generate_button": "Generate Certificate", "cert_generate_button_aria": "Generate Basics Certificate", "cert_generate_button_aria_flow": "Generate Flow Control Certificate", "cert_generate_button_aria_data": "Generate Data Structures Certificate", "cert_generate_button_aria_functions": "Generate Functions Certificate", "cert_generate_button_aria_files": "Generate Files & Errors Certificate", "cert_generate_button_aria_advanced": "Generate Advanced Topics Certificate", "cert_generate_button_aria_full": "Generate Full Course Certificate", "cert_generate_success": "Success! Certificate ready to be generated (feature coming soon).", "cert_generate_error_name": "Please enter your full name."
             },
             pt: {
                 // Dashboard Keys
                 "widget_lang_title": "Idioma", "lang_select_aria": "Selecionar Idioma", "lang_en": "ğŸ‡¬ğŸ‡§ English", "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs", "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡", "widget_links_title": "Links RÃ¡pidos", "link_main_site": "Site Principal", "footer_text": "Parte do Projeto Road to Free Open AGI", "chat_title": "Gato Assistente", "chat_initial_greeting": "Miau! Sou o Gato Assistente, pronto para ajudar com Python e Pensamento Computacional. Pergunte-me qualquer coisa!", "chat_typing_indicator": "Gato Assistente estÃ¡ pensando", "chat_input_placeholder": "Pergunte ao Gato Assistente...", "chat_error_fetch": "Miau... desculpe, nÃ£o consegui conectar ({status}).", "chat_error_generic": "Grrr! Ocorreu um erro de rede.", "chat_error_invalid_response": "Ronron..desculpe, recebi uma resposta estranha.", "chat_system_prompt": "VocÃª Ã© o Gato Assistente, um assistente IA amigÃ¡vel, fofo e prestativo com tema de gato para um curso de programaÃ§Ã£o Python e Pensamento Computacional. VocÃª sabe muito sobre sintaxe Python, conceitos como loops, funÃ§Ãµes, estruturas de dados e princÃ­pios de Pensamento Computacional (como decomposiÃ§Ã£o, reconhecimento de padrÃµes, abstraÃ§Ã£o, algoritmos). Responda de forma concisa e clara, como um gato prestativo guiando um aluno. Use trocadilhos de gato com moderaÃ§Ã£o e apropriadamente. Mantenha as respostas focadas e relativamente curtas.", "chat_close_button_aria": "Fechar Chat", "chat_send_button_aria": "Enviar Mensagem", "chat_open_button_aria": "Abrir Assistente do Curso",
                 // Certificate Keys
                 "cert_basics_name": "Certificado BÃ¡sico & I/O", "cert_flow_name": "Certificado Controle de Fluxo", "cert_data_name": "Certificado Estruturas de Dados", "cert_functions_name": "Certificado FunÃ§Ãµes", "cert_files_name": "Certificado Arquivos & Erros", "cert_advanced_name": "Certificado TÃ³picos AvanÃ§ados", "cert_full_name": "ConclusÃ£o do Curso Completo",
                 // New Certificate Page Specific Keys
                 "certificates_page_title": "Meus Certificados - Python Completo", "certificates_header_title": "Meus Certificados", "link_dashboard": "Voltar ao Painel", "cert_status_locked": "<i class='fas fa-lock'></i> Bloqueado", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> Em Progresso", "cert_status_earned": "<i class='fas fa-check-circle'></i> Obtido!", "cert_progress_info": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 0-4.", "cert_progress_info_flow": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 5-9 e 12-15.", "cert_progress_info_data": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 10-11 e 20-22.", "cert_progress_info_functions": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 16-19.", "cert_progress_info_files": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 23-25.", "cert_progress_info_advanced": "Complete as VerificaÃ§Ãµes de Conhecimento dos mÃ³dulos 26-32.", "cert_progress_info_full": "Complete <strong>TODAS</strong> as VerificaÃ§Ãµes de Conhecimento do curso.", "cert_form_name_label": "Nome Completo para o Certificado:", "cert_form_name_placeholder": "Digite seu nome completo", "cert_form_generate_button": "Gerar Certificado", "cert_generate_button_aria": "Gerar Certificado BÃ¡sico", "cert_generate_button_aria_flow": "Gerar Certificado Controle de Fluxo", "cert_generate_button_aria_data": "Gerar Certificado Estruturas de Dados", "cert_generate_button_aria_functions": "Gerar Certificado FunÃ§Ãµes", "cert_generate_button_aria_files": "Gerar Certificado Arquivos & Erros", "cert_generate_button_aria_advanced": "Gerar Certificado TÃ³picos AvanÃ§ados", "cert_generate_button_aria_full": "Gerar Certificado Curso Completo", "cert_generate_success": "Sucesso! Certificado pronto para ser gerado (funcionalidade em breve).", "cert_generate_error_name": "Por favor, digite seu nome completo."
             },
             zh: {
                 // Dashboard Keys
                 "widget_lang_title": "è¯­è¨€", "lang_select_aria": "é€‰æ‹©è¯­è¨€", "lang_en": "ğŸ‡¬ğŸ‡§ English", "lang_pt": "ğŸ‡§ğŸ‡· PortuguÃªs", "lang_zh": "ğŸ‡¨ğŸ‡³ ä¸­æ–‡", "widget_links_title": "å¿«é€Ÿé“¾æ¥", "link_main_site": "ä¸»ç½‘ç«™", "footer_text": "é€šå¾€è‡ªç”±å¼€æ”¾AGIä¹‹è·¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†", "chat_title": "çŒ«å’ªåŠ©æ‰‹", "chat_initial_greeting": "å–µï¼æˆ‘æ˜¯çŒ«å’ªåŠ©æ‰‹ï¼Œéšæ—¶å‡†å¤‡å¸®åŠ©ä½ å­¦ä¹  Python å’Œè®¡ç®—æ€ç»´ã€‚éšä¾¿é—®ï¼", "chat_typing_indicator": "çŒ«å’ªåŠ©æ‰‹æ­£åœ¨æ€è€ƒä¸­", "chat_input_placeholder": "è¯¢é—®çŒ«å’ªåŠ©æ‰‹...", "chat_error_fetch": "å–µå‘œ...æŠ±æ­‰ï¼Œæ— æ³•è¿æ¥ ({status})ã€‚", "chat_error_generic": "å˜¶ï¼å‘ç”Ÿäº†ç½‘ç»œé”™è¯¯ã€‚", "chat_error_invalid_response": "å‘œå–µ..ä¸å¥½æ„æ€ï¼Œæˆ‘æ”¶åˆ°äº†å¥‡æ€ªçš„å›åº”ã€‚", "chat_system_prompt": "ä½ æ˜¯çŒ«å’ªåŠ©æ‰‹ï¼Œä¸€ä¸ªå‹å¥½ã€å¯çˆ±ã€ä¹äºåŠ©äººçš„çŒ«ä¸»é¢˜ AI åŠ©æ‰‹ï¼Œç”¨äº Python ç¼–ç¨‹å’Œè®¡ç®—æ€ç»´è¯¾ç¨‹ã€‚ä½ éå¸¸äº†è§£ Python è¯­æ³•ã€å¾ªç¯ã€å‡½æ•°ã€æ•°æ®ç»“æ„ç­‰æ¦‚å¿µï¼Œä»¥åŠè®¡ç®—æ€ç»´åŸåˆ™ï¼ˆå¦‚åˆ†è§£ã€æ¨¡å¼è¯†åˆ«ã€æŠ½è±¡ã€ç®—æ³•ï¼‰ã€‚åƒä¸€åªä¹äºåŠ©äººçš„çŒ«æŒ‡å¯¼å­¦ç”Ÿä¸€æ ·ï¼Œç®€æ´æ˜äº†åœ°å›ç­”é—®é¢˜ã€‚é€‚åº¦ä¸”æ°å½“åœ°ä½¿ç”¨çŒ«å’ªç›¸å…³çš„ä¿çš®è¯ã€‚ä¿æŒå›ç­”é‡ç‚¹çªå‡ºä¸”ç›¸å¯¹ç®€çŸ­ã€‚", "chat_close_button_aria": "å…³é—­èŠå¤©", "chat_send_button_aria": "å‘é€æ¶ˆæ¯", "chat_open_button_aria": "æ‰“å¼€è¯¾ç¨‹åŠ©æ‰‹",
                 // Certificate Keys
                 "cert_basics_name": "åŸºç¡€ä¸ I/O è¯ä¹¦", "cert_flow_name": "æµç¨‹æ§åˆ¶è¯ä¹¦", "cert_data_name": "æ•°æ®ç»“æ„è¯ä¹¦", "cert_functions_name": "å‡½æ•°è¯ä¹¦", "cert_files_name": "æ–‡ä»¶ä¸é”™è¯¯è¯ä¹¦", "cert_advanced_name": "é«˜çº§ä¸»é¢˜è¯ä¹¦", "cert_full_name": "å®Œæ•´è¯¾ç¨‹ç»“ä¸šè¯ä¹¦",
                 // New Certificate Page Specific Keys
                 "certificates_page_title": "æˆ‘çš„è¯ä¹¦ - Python å®Œå…¨æŒ‡å—", "certificates_header_title": "æˆ‘çš„è¯ä¹¦", "link_dashboard": "è¿”å›ä»ªè¡¨æ¿", "cert_status_locked": "<i class='fas fa-lock'></i> æœªè§£é”", "cert_status_inprogress": "<i class='fas fa-spinner fa-spin'></i> è¿›è¡Œä¸­", "cert_status_earned": "<i class='fas fa-check-circle'></i> å·²è·å¾—!", "cert_progress_info": "å®Œæˆæ¨¡å— 0-4 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_flow": "å®Œæˆæ¨¡å— 5-9 å’Œ 12-15 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_data": "å®Œæˆæ¨¡å— 10-11 å’Œ 20-22 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_functions": "å®Œæˆæ¨¡å— 16-19 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_files": "å®Œæˆæ¨¡å— 23-25 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_advanced": "å®Œæˆæ¨¡å— 26-32 çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_progress_info_full": "å®Œæˆè¯¾ç¨‹ä¸­<strong>æ‰€æœ‰</strong>çš„çŸ¥è¯†æµ‹éªŒã€‚", "cert_form_name_label": "è¯ä¹¦ä¸Šçš„å…¨å:", "cert_form_name_placeholder": "è¯·è¾“å…¥æ‚¨çš„å…¨å", "cert_form_generate_button": "ç”Ÿæˆè¯ä¹¦", "cert_generate_button_aria": "ç”ŸæˆåŸºç¡€è¯ä¹¦", "cert_generate_button_aria_flow": "ç”Ÿæˆæµç¨‹æ§åˆ¶è¯ä¹¦", "cert_generate_button_aria_data": "ç”Ÿæˆæ•°æ®ç»“æ„è¯ä¹¦", "cert_generate_button_aria_functions": "ç”Ÿæˆå‡½æ•°è¯ä¹¦", "cert_generate_button_aria_files": "ç”Ÿæˆæ–‡ä»¶ä¸é”™è¯¯è¯ä¹¦", "cert_generate_button_aria_advanced": "ç”Ÿæˆé«˜çº§ä¸»é¢˜è¯ä¹¦", "cert_generate_button_aria_full": "ç”Ÿæˆå®Œæ•´è¯¾ç¨‹è¯ä¹¦", "cert_generate_success": "æˆåŠŸï¼è¯ä¹¦å·²å‡†å¤‡å¥½ç”Ÿæˆï¼ˆåŠŸèƒ½å³å°†æ¨å‡ºï¼‰ã€‚", "cert_generate_error_name": "è¯·è¾“å…¥æ‚¨çš„å…¨åã€‚"
             }
         };

        // --- JavaScript (Adapted from dashboard, focused on Certificates) ---
        document.addEventListener('DOMContentLoaded', () => {

            const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
            const TOTAL_MODULES = 33; // Needs to match dashboard
            const LANGUAGE_STORAGE_KEY = 'userLanguage'; // Key for storing language

            // --- Data Loading & Saving (LocalStorage - Same as dashboard) ---
            function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
            const knowledgeCheckStatus = loadKnowledgeCheckStatus();

            // --- Certificate Calculation (Same as dashboard) ---
            function getCertificateStatus(moduleIds, statusObject) { if (!Array.isArray(moduleIds) || moduleIds.length === 0) return 'locked'; const allComplete = moduleIds.every(id => statusObject[id] === true); if (allComplete) return 'earned'; const anyComplete = moduleIds.some(id => statusObject[id] === true); return anyComplete ? 'inprogress' : 'locked'; }

            // --- Translation Functions (Same as dashboard) ---
            function getStoredLanguage() { const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); if (storedLang && translations[storedLang]) return storedLang; const browserLang = navigator.language || navigator.userLanguage; if (browserLang.startsWith('pt')) return 'pt'; if (browserLang.startsWith('zh')) return 'zh'; return 'en'; }
            function setLanguage(lang) { if (!translations[lang]) lang = 'en'; localStorage.setItem(LANGUAGE_STORAGE_KEY, lang); document.documentElement.lang = lang; const langSelect = document.getElementById('languageSelect'); if (langSelect) langSelect.value = lang; updatePageUI(); initializeChat(); } // Use updatePageUI
            function getTranslation(key, lang, replacements = {}) { let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }
            function translatePage(lang) { if (!translations[lang]) lang = 'en'; document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const translation = getTranslation(key, lang); if (el.tagName === 'TITLE') { document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } }); document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); }); document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); }); }

            // --- UI Update Function for Certificates ---
            function updateCertificateCards(statusObject) {
                const certificateCards = document.querySelectorAll('.certificate-card[data-certificate-id]');
                const lang = getStoredLanguage();

                certificateCards.forEach(card => {
                    const certId = card.dataset.certificateId;
                    const modulesAttr = card.dataset.modules;
                    if (!modulesAttr) return;

                    const moduleIds = modulesAttr.split(',').map(Number);
                    const status = getCertificateStatus(moduleIds, statusObject);
                    const statusElement = card.querySelector('.certificate-status');
                    const generateForm = card.querySelector('.certificate-generate-form');
                    const lockedInfo = card.querySelector('.certificate-locked-info');

                    // Update card class for styling
                    card.classList.remove('status-locked', 'status-inprogress', 'status-earned');
                    card.classList.add(`status-${status}`);

                    // Update status text
                    if (statusElement) {
                        statusElement.innerHTML = getTranslation(`cert_status_${status}`, lang);
                    }

                    // Show/hide form and locked info (handled by CSS via status classes now)

                     // Clear any previous generate messages
                     const messageElement = card.querySelector('.generate-message');
                     if(messageElement) {
                         messageElement.textContent = '';
                         messageElement.className = 'generate-message'; // Reset class
                     }
                });
            }

            // --- Main Page Update Function ---
            function updatePageUI() {
                const lang = getStoredLanguage();
                translatePage(lang); // Translate all static elements
                updateCertificateCards(knowledgeCheckStatus); // Update dynamic certificate elements
            }

            // --- Language Switcher Setup (Same as dashboard) ---
            const languageSelectElement = document.getElementById('languageSelect');
            if (languageSelectElement) { languageSelectElement.value = getStoredLanguage(); languageSelectElement.addEventListener('change', (e) => { setLanguage(e.target.value); }); }

            // --- Staggered Card Animation (Same as dashboard) ---
            const cards = document.querySelectorAll('.certificate-card');
            cards.forEach((card, index) => { const delay = index * 0.05; card.style.animationDelay = `${delay}s`; card.classList.add('card-fade-in'); });

            // --- Certificate Generation Button Logic ---
            const generateButtons = document.querySelectorAll('.generate-button');
            generateButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const certId = button.dataset.certificateId;
                    const nameInput = document.getElementById(`certNameInput-${certId}`);
                    const messageElement = document.getElementById(`generateMessage-${certId}`);
                    const userName = nameInput ? nameInput.value.trim() : '';
                    const lang = getStoredLanguage();

                    if (!userName) {
                        if(messageElement) {
                            messageElement.textContent = getTranslation('cert_generate_error_name', lang);
                            messageElement.className = 'generate-message error'; // Add error class
                        }
                        if(nameInput) nameInput.focus();
                        return;
                    }

                    // --- Placeholder for Actual Certificate Generation ---
                    console.log(`Simulating certificate generation for '${certId}' with name: ${userName}`);
                    // In a real scenario, you'd call a function here to:
                    // 1. Fetch certificate template
                    // 2. Populate with name, date, course section
                    // 3. Generate PDF/Image (likely server-side or using a client-side library)
                    // 4. Offer download
                    // ------------------------------------------------------

                     if(messageElement) {
                         messageElement.textContent = getTranslation('cert_generate_success', lang);
                         messageElement.className = 'generate-message success'; // Add success class
                     }
                     // Optional: Disable button after "generation"
                     // button.disabled = true;
                });
            });

            // --- Chat Panel Logic (Same as dashboard) ---
            const chatbotFab = document.getElementById('chatbot-fab');
            const chatPanel = document.getElementById('chat-panel');
            const chatCloseButton = document.getElementById('chat-close-button');
            const chatPanelOverlay = document.getElementById('chat-panel-overlay');
            const chatboxEl = document.getElementById('chatbox');
            const userInputEl = document.getElementById('userInput');
            const sendButtonEl = document.getElementById('sendButton');
            const bodyEl = document.body;
            function openChatPanel() { bodyEl.classList.add('chat-open'); chatbotFab.setAttribute('aria-expanded', 'true'); userInputEl.focus(); }
            function closeChatPanel() { bodyEl.classList.remove('chat-open'); chatbotFab.setAttribute('aria-expanded', 'false'); }
            if (chatbotFab && chatPanel && chatCloseButton && chatPanelOverlay && userInputEl) {
                chatbotFab.addEventListener('click', () => { bodyEl.classList.contains('chat-open') ? closeChatPanel() : openChatPanel(); });
                chatCloseButton.addEventListener('click', closeChatPanel);
                chatPanelOverlay.addEventListener('click', closeChatPanel);
                document.addEventListener('keydown', (event) => { if (event.key === 'Escape' && bodyEl.classList.contains('chat-open')) { closeChatPanel(); } });
            }

            // --- Chatbot Messaging Logic (Same as dashboard, ensure displayMessage uses getTranslation correctly) ---
            let conversationHistory = [];
            function displayMessage(role, textKey, replacements = {}, isRawText = false) {
                const lang = getStoredLanguage();
                const text = isRawText ? textKey : getTranslation(textKey, lang, replacements);
                const messageContainer = document.createElement('div'); messageContainer.classList.add('message-container');
                const avatar = document.createElement('div'); avatar.classList.add('message-avatar');
                const messageBubble = document.createElement('div'); messageBubble.classList.add('message');

                if (role === 'user') { messageContainer.classList.add('user-message-container'); avatar.innerHTML = '<i class="fas fa-user"></i>'; messageBubble.classList.add('user-message'); }
                 else if (role === 'assistant') { messageContainer.classList.add('bot-message-container'); avatar.innerHTML = '<i class="fas fa-cat"></i>'; messageBubble.classList.add('bot-message'); }
                 else if (role === 'error') { messageBubble.classList.add('error-message'); /* Ensure error message is also translated or kept simple */ messageBubble.innerHTML = `<strong>Error:</strong> ${text}`; chatboxEl.appendChild(messageBubble); chatboxEl.scrollTop = chatboxEl.scrollHeight; return; }
                 else if (role === 'typing') { const typingDiv = document.createElement('div'); typingDiv.classList.add('typing-indicator'); typingDiv.innerHTML = `<i class="fas fa-paw"></i> <span>${getTranslation('chat_typing_indicator', lang)}</span> <span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>`; chatboxEl.appendChild(typingDiv); chatboxEl.scrollTop = chatboxEl.scrollHeight; return typingDiv; }

                // Handle potential HTML in messages carefully if needed, or stick to textNode
                 messageBubble.textContent = text; // Safer default

                messageContainer.appendChild(avatar); messageContainer.appendChild(messageBubble); chatboxEl.appendChild(messageContainer); chatboxEl.scrollTop = chatboxEl.scrollHeight;
            }
            async function sendMessage() {
                const userText = userInputEl.value.trim(); if (!userText) return;
                displayMessage('user', userText, {}, true); conversationHistory.push({ role: "user", content: userText });
                userInputEl.value = ''; sendButtonEl.disabled = true;
                const typingIndicator = displayMessage('typing', ''); // Typing indicator uses its own text
                const proxyUrl = '/api/proxy'; const lang = getStoredLanguage();
                const systemPrompt = { role: "system", content: getTranslation('chat_system_prompt', lang) };
                const messagesToSend = [systemPrompt, ...conversationHistory];

                try {
                    const response = await fetch(proxyUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ model: "glm-4-flash", messages: messagesToSend, temperature: 0.6, max_tokens: 150 }) }); // Use same settings as dashboard
                    if (typingIndicator) typingIndicator.remove();
                    if (!response.ok) { const errorText = await response.text(); console.error(`Proxy/API Error (${response.status}):`, errorText); displayMessage('error', getTranslation('chat_error_fetch', lang, { status: response.status }), {}, true); throw new Error(`HTTP error! status: ${response.status}`); } // Translate error
                    const data = await response.json();
                    if (data.choices?.[0]?.message?.content) { const botText = data.choices[0].message.content.trim(); conversationHistory.push({ role: "assistant", content: botText }); displayMessage('assistant', botText, {}, true); }
                    else { console.error("Invalid API response:", data); displayMessage('error', getTranslation('chat_error_invalid_response', lang), {}, true); } // Translate error
                } catch (error) { console.error('Chat fetch error:', error); if (typingIndicator && typingIndicator.parentNode === chatboxEl) typingIndicator.remove(); if (!chatboxEl.querySelector('.error-message')) { displayMessage('error', getTranslation('chat_error_generic', lang), {}, true); } // Translate error
                } finally { sendButtonEl.disabled = false; if (bodyEl.classList.contains('chat-open')) userInputEl.focus(); }
            }
            if (sendButtonEl && userInputEl) { sendButtonEl.addEventListener('click', sendMessage); userInputEl.addEventListener('keypress', (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); } }); }
            function initializeChat() {
                const lang = getStoredLanguage();
                const initialGreeting = getTranslation('chat_initial_greeting', lang);
                conversationHistory = [{ role: "assistant", content: initialGreeting }];
                chatboxEl.innerHTML = ''; // Clear previous messages
                displayMessage('assistant', initialGreeting, {}, true); // Display the translated greeting
            }

            // --- Final Initialization ---
            updatePageUI(); // Initial render with correct language and certificate statuses
            initializeChat(); // Sets up chat with correct initial language message


        }); // End DOMContentLoaded
    </script>

</body>
</html>
