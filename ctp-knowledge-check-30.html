<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set dynamically by JS -->
    <title data-translate="page_title">Knowledge Check: Module 30</title>
    <!-- Fonts & Icons (Same as dashboard) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (Copied from dashboard, slightly adjusted) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --check-color: #6f42c1; /* Keep check color */
            --certificate-color: #d63384;
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            min-height: 100vh; display: flex; flex-direction: column;
        }

        /* --- Header (Simplified) --- */
        .kc-header {
            background: var(--background-header); color: var(--text-light);
            padding: 1rem 1.5rem; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .header-content {
            max-width: 1000px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; /* Allow wrapping */
        }
        .kc-header h1 {
            font-family: var(--font-title); font-size: 1.6rem; margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            flex-grow: 1; /* Allow title to take space */
            text-align: center; /* Center title on smaller screens */
            padding: 0.5rem 0; /* Add padding for spacing */
        }
        .kc-header .header-actions {
            display: flex; align-items: center; gap: 1rem;
            margin-left: auto; /* Push actions to the right */
        }

        /* --- Return Button --- */
        .return-button {
            display: inline-flex; align-items: center; gap: 0.5rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light); border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem; border-radius: var(--border-radius);
            text-decoration: none; font-weight: 500; font-size: 0.9rem;
            transition: background-color var(--transition-speed), border-color var(--transition-speed);
        }
        .return-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }
        .return-button i { opacity: 0.8; }

        /* Language Switcher Styles (Copied) */
        .language-switcher { position: relative; }
        #languageSelect {
            width: auto; min-width: 130px;
            background: var(--lang-select-bg);
            color: var(--text-light);
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 8px 35px 8px 15px;
            cursor: pointer;
            font-size: 0.9rem; font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        #languageSelect:hover { background-color: var(--lang-select-bg-hover); border-color: var(--text-light); }
        #languageSelect:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3); }
        #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
        }

        /* --- Main Content --- */
        .kc-main {
            flex-grow: 1;
            width: 100%; max-width: 1000px;
            margin: 2rem auto; padding: 0 1.5rem;
        }

        /* --- Quiz Container Styling --- */
        .quiz-container {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }
        .quiz-instructions {
            margin-bottom: 2rem; padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 1rem; color: var(--text-muted);
        }
        .quiz-instructions h2 {
            font-family: var(--font-title); color: var(--primary-color);
            font-size: 1.4rem; margin-bottom: 0.5rem;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .quiz-instructions h2 i { color: var(--check-color); }
        .quiz-instructions p { margin-bottom: 0.5rem; line-height: 1.5; }
        .quiz-instructions strong { color: var(--text-dark); }

        /* --- Question Styling --- */
        .question-block {
            margin-bottom: 2rem; padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
        }
        .question-block:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .question-text { font-weight: 500; margin-bottom: 1rem; font-size: 1.1rem; }
        .question-text code { font-size: 0.95em; background: #eee; padding: 2px 5px; border-radius: 4px; color: #c7254e; }
        .options-list { list-style: none; padding: 0; margin: 0; }
        .options-list li { margin-bottom: 0.8rem; }
        .options-list label {
            display: block; padding: 0.8rem 1rem;
            border: 1px solid var(--border-color); border-radius: 6px;
            cursor: pointer; transition: background-color var(--transition-speed), border-color var(--transition-speed);
            position: relative; padding-left: 3rem;
        }
        .options-list input[type="radio"] {
            position: absolute; left: 1rem; top: 50%; transform: translateY(-50%);
            margin: 0; cursor: pointer;
            accent-color: var(--primary-color); /* Modern way to style radio */
            height: 1.1rem; width: 1.1rem;
        }
        .options-list label:hover { background-color: #f8f9fa; border-color: var(--secondary-color); }
        .options-list input[type="radio"]:checked + label {
            background-color: #e7f1ff; border-color: var(--primary-color);
            font-weight: 500; color: var(--primary-color);
        }
        /* Answer Highlighting */
        .options-list label.correct-answer {
            background-color: #d1e7dd; border-color: var(--success-color); color: #0f5132; font-weight: bold;
        }
        .options-list label.incorrect-answer {
            background-color: #f8d7da; border-color: var(--error-color); color: #842029;
        }
        .options-list label.correct-answer::after, .options-list label.incorrect-answer::after {
            font-family: 'Font Awesome 6 Free'; font-weight: 900;
            position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);
            font-size: 1rem;
        }
        .options-list label.correct-answer::after { content: '\f00c'; color: var(--success-color); }
        .options-list label.incorrect-answer::after { content: '\f00d'; color: var(--error-color); }
        /* Disabled state after submission */
        .quiz-form.submitted .options-list label { cursor: default; }
        .quiz-form.submitted .options-list label:hover { background-color: inherit; /* Prevent hover effect */ }
        .quiz-form.submitted .options-list input[type="radio"] { display: none; /* Hide radio after submission */ }
        .quiz-form.submitted .options-list input[type="radio"]:checked + label.correct-answer,
        .quiz-form.submitted .options-list input[type="radio"]:checked + label.incorrect-answer {
             /* Keep styles for selected answers */
            background-color: #d1e7dd; border-color: var(--success-color); color: #0f5132; font-weight: bold; /* Correct */
        }
        .quiz-form.submitted .options-list input[type="radio"]:checked + label.incorrect-answer {
            background-color: #f8d7da; border-color: var(--error-color); color: #842029; font-weight: normal; /* Incorrect */
        }
         /* Show the actual correct answer if user was wrong */
        .quiz-form.submitted .options-list label.reveal-correct {
            background-color: #d1e7dd !important; border-color: var(--success-color) !important; color: #0f5132 !important; font-weight: bold !important;
        }
        .quiz-form.submitted .options-list label.reveal-correct::after { content: '\f00c'; color: var(--success-color); }


        /* --- Submit Button --- */
        .submit-button {
            display: block; width: 100%; max-width: 300px;
            margin: 2rem auto 0 auto; padding: 0.9rem 1.5rem;
            font-size: 1.1rem; font-weight: 500;
            color: var(--text-light); background-color: var(--check-color);
            border: none; border-radius: 6px; cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            text-align: center;
        }
        .submit-button:hover { background-color: #5a35a2; transform: translateY(-2px); }
        .submit-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.7; }

        /* --- Results Area --- */
        #results-area {
            margin-top: 2.5rem; padding: 1.5rem;
            border-radius: var(--border-radius); text-align: center;
            font-size: 1.1rem; display: none; /* Hidden initially */
        }
        #results-area.pass { background-color: #d1e7dd; border: 1px solid var(--success-color); color: #0f5132; }
        #results-area.fail { background-color: #f8d7da; border: 1px solid var(--error-color); color: #842029; }
        #results-area p { margin-bottom: 0.5rem; }
        #results-area strong { font-weight: 700; }
        #results-area .result-icon { font-size: 1.5rem; margin-right: 0.5rem; }

        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design Adjustments --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header h1 { font-size: 1.4rem; }
            .header-content { flex-direction: column; gap: 0.8rem; }
            .kc-header .header-actions { margin-left: 0; width: 100%; justify-content: space-between;}
            .quiz-container { padding: 1.5rem; }
            .question-text { font-size: 1rem; }
            .options-list label { padding: 0.7rem 0.8rem; padding-left: 2.5rem; }
            .options-list input[type="radio"] { left: 0.8rem; }
            #results-area { font-size: 1rem; }
        }
         @media (max-width: 480px) {
            html { font-size: 14px; }
            .kc-header { padding: 0.8rem 1rem; }
            .kc-header h1 { font-size: 1.2rem; }
            .return-button { padding: 0.4rem 0.8rem; font-size: 0.8rem;}
            #languageSelect { padding: 6px 30px 6px 12px; font-size: 0.8rem; min-width: 110px; background-position: right 8px center;}
            .quiz-container { padding: 1rem; }
            .quiz-instructions { margin-bottom: 1.5rem; padding-bottom: 1rem; font-size: 0.9rem;}
            .quiz-instructions h2 { font-size: 1.2rem; }
            .question-block { margin-bottom: 1.5rem; padding-bottom: 1rem; }
            .options-list label { padding: 0.6rem 0.7rem; padding-left: 2.2rem; font-size: 0.9rem;}
            .options-list input[type="radio"] { left: 0.6rem; height: 1rem; width: 1rem; }
            .submit-button { padding: 0.8rem 1rem; font-size: 1rem; }
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <div class="header-content">
             <a href="ctp-dashboard.html" class="return-button">
                 <i class="fas fa-arrow-left"></i> <span data-translate="return_button">Return to Dashboard</span>
             </a>
            <h1 data-translate="header_title">Knowledge Check: Module 30</h1>
            <div class="header-actions">
                 <div class="language-switcher">
                    <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                        <option value="en" data-translate="lang_en">üá¨üáß English</option>
                        <option value="pt" data-translate="lang_pt">üáßüá∑ Portugu√™s</option>
                        <option value="zh" data-translate="lang_zh">üá®üá≥ ‰∏≠Êñá</option>
                    </select>
                 </div>
            </div>
        </div>
    </header>

    <main class="kc-main">
        <div class="quiz-container">
            <div class="quiz-instructions">
                <h2 data-translate="quiz_instructions_title"><i class="fas fa-tasks"></i> Instructions</h2>
                <p data-translate="quiz_instructions_p1">Answer the following 10 questions about **Recursion**.</p>
                <p data-translate="quiz_instructions_p2">You need to answer at least <strong data-translate="quiz_pass_score">6</strong> questions correctly to pass.</p>
                <p data-translate="quiz_instructions_p3">You can retake this check as many times as you need. Passing will update your progress on the dashboard.</p>
            </div>

            <form id="quiz-form" class="quiz-form">

                <!-- Question 1 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q1_text">1. What is the fundamental characteristic of a recursive function?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q1a" name="q1" value="a"><label for="q1a" data-translate="q1_op_a">It uses a `for` loop to repeat code.</label></li>
                        <li><input type="radio" id="q1b" name="q1" value="b"><label for="q1b" data-translate="q1_op_b">It calls itself within its own definition.</label></li>
                        <li><input type="radio" id="q1c" name="q1" value="c"><label for="q1c" data-translate="q1_op_c">It must always return an integer.</label></li>
                        <li><input type="radio" id="q1d" name="q1" value="d"><label for="q1d" data-translate="q1_op_d">It only works with lists or strings.</label></li>
                    </ul>
                </div>

                <!-- Question 2 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q2_text">2. What is the purpose of a "base case" in recursion?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q2a" name="q2" value="a"><label for="q2a" data-translate="q2_op_a">To perform the main calculation.</label></li>
                        <li><input type="radio" id="q2b" name="q2" value="b"><label for="q2b" data-translate="q2_op_b">To stop the recursion and prevent infinite loops.</label></li>
                        <li><input type="radio" id="q2c" name="q2" value="c"><label for="q2c" data-translate="q2_op_c">To initialize variables used in the function.</label></li>
                        <li><input type="radio" id="q2d" name="q2" value="d"><label for="q2d" data-translate="q2_op_d">To make the recursive call to itself.</label></li>
                    </ul>
                </div>

                <!-- Question 3 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q3_text">3. Consider the following recursive function to calculate factorial:
                    <br><code>def factorial(n):</code>
                    <br><code>&nbsp;&nbsp;if n == 0: # Base Case</code>
                    <br><code>&nbsp;&nbsp;&nbsp;&nbsp;return 1</code>
                    <br><code>&nbsp;&nbsp;else: # Recursive Step</code>
                    <br><code>&nbsp;&nbsp;&nbsp;&nbsp;return n * factorial(n - 1)</code>
                    <br>What is the result of `factorial(3)`?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q3a" name="q3" value="a"><label for="q3a" data-translate="q3_op_a">3</label></li>
                        <li><input type="radio" id="q3b" name="q3" value="b"><label for="q3b" data-translate="q3_op_b">1</label></li>
                        <li><input type="radio" id="q3c" name="q3" value="c"><label for="q3c" data-translate="q3_op_c">6</label></li>
                        <li><input type="radio" id="q3d" name="q3" value="d"><label for="q3d" data-translate="q3_op_d">0</label></li>
                    </ul>
                </div>

                <!-- Question 4 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q4_text">4. What potential problem can occur if a recursive function lacks a proper base case or doesn't reach it?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q4a" name="q4" value="a"><label for="q4a" data-translate="q4_op_a">Syntax Error</label></li>
                        <li><input type="radio" id="q4b" name="q4" value="b"><label for="q4b" data-translate="q4_op_b">Infinite recursion (leading to a Stack Overflow Error)</label></li>
                        <li><input type="radio" id="q4c" name="q4" value="c"><label for="q4c" data-translate="q4_op_c">TypeError</label></li>
                        <li><input type="radio" id="q4d" name="q4" value="d"><label for="q4d" data-translate="q4_op_d">The function will return `None` automatically.</label></li>
                    </ul>
                </div>

                <!-- Question 5 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q5_text">5. In the factorial example (`return n * factorial(n - 1)`), which part represents the "recursive step"?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q5a" name="q5" value="a"><label for="q5a" data-translate="q5_op_a">`n == 0`</label></li>
                        <li><input type="radio" id="q5b" name="q5" value="b"><label for="q5b" data-translate="q5_op_b">`return 1`</label></li>
                        <li><input type="radio" id="q5c" name="q5" value="c"><label for="q5c" data-translate="q5_op_c">`factorial(n - 1)`</label></li>
                        <li><input type="radio" id="q5d" name="q5" value="d"><label for="q5d" data-translate="q5_op_d">`return n * ...`</label></li>
                    </ul>
                </div>

                <!-- Question 6 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q6_text">6. Which of these problems is NOT typically well-suited for a recursive solution?</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q6a" name="q6" value="a"><label for="q6a" data-translate="q6_op_a">Calculating the sum of numbers from 1 to N.</label></li>
                        <li><input type="radio" id="q6b" name="q6" value="b"><label for="q6b" data-translate="q6_op_b">Calculating factorials.</label></li>
                        <li><input type="radio" id="q6c" name="q6" value="c"><label for="q6c" data-translate="q6_op_c">Navigating tree-like data structures.</label></li>
                        <li><input type="radio" id="q6d" name="q6" value="d"><label for="q6d" data-translate="q6_op_d">Generating Fibonacci numbers.</label></li>
                    </ul>
                    <!-- Note: While sum can be done recursively, iteratively is often simpler/more efficient for beginners. -->
                </div>

                <!-- Question 7 -->
                <div class="question-block">
                     <p class="question-text" data-translate="q7_text">7. What does "Stack Overflow Error" typically indicate in the context of recursion?</p>
                     <ul class="options-list">
                         <li><input type="radio" id="q7a" name="q7" value="a"><label for="q7a" data-translate="q7_op_a">The program used too much disk space.</label></li>
                         <li><input type="radio" id="q7b" name="q7" value="b"><label for="q7b" data-translate="q7_op_b">The recursive calls went too deep, exhausting the call stack memory.</label></li>
                         <li><input type="radio" id="q7c" name="q7" value="c"><label for="q7c" data-translate="q7_op_c">There was an error reading input from the user.</label></li>
                         <li><input type="radio" id="q7d" name="q7" value="d"><label for="q7d" data-translate="q7_op_d">A mathematical division by zero occurred.</label></li>
                     </ul>
                 </div>

                <!-- Question 8 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q8_text">8. Every recursive solution can also be implemented using...</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q8a" name="q8" value="a"><label for="q8a" data-translate="q8_op_a">Only `if/else` statements.</label></li>
                        <li><input type="radio" id="q8b" name="q8" value="b"><label for="q8b" data-translate="q8_op_b">Iteration (loops like `for` or `while`).</label></li>
                        <li><input type="radio" id="q8c" name="q8" value="c"><label for="q8c" data-translate="q8_op_c">Dictionaries only.</label></li>
                        <li><input type="radio" id="q8d" name="q8" value="d"><label for="q8d" data-translate="q8_op_d">File reading operations.</label></li>
                    </ul>
                </div>

                <!-- Question 9 -->
                 <div class="question-block">
                     <p class="question-text" data-translate="q9_text">9. Consider this function:
                     <br><code>def countdown(n):</code>
                     <br><code>&nbsp;&nbsp;if n <= 0:</code>
                     <br><code>&nbsp;&nbsp;&nbsp;&nbsp;print("Blast off!")</code>
                     <br><code>&nbsp;&nbsp;else:</code>
                     <br><code>&nbsp;&nbsp;&nbsp;&nbsp;print(n)</code>
                     <br><code>&nbsp;&nbsp;&nbsp;&nbsp;# MISSING LINE</code>
                     <br>What should the MISSING LINE be to make this a correct recursive countdown?</p>
                     <ul class="options-list">
                         <li><input type="radio" id="q9a" name="q9" value="a"><label for="q9a" data-translate="q9_op_a">`countdown(n + 1)`</label></li>
                         <li><input type="radio" id="q9b" name="q9" value="b"><label for="q9b" data-translate="q9_op_b">`return n`</label></li>
                         <li><input type="radio" id="q9c" name="q9" value="c"><label for="q9c" data-translate="q9_op_c">`countdown(n)`</label></li>
                         <li><input type="radio" id="q9d" name="q9" value="d"><label for="q9d" data-translate="q9_op_d">`countdown(n - 1)`</label></li>
                     </ul>
                 </div>

                <!-- Question 10 -->
                <div class="question-block">
                    <p class="question-text" data-translate="q10_text">10. Recursion often leads to code that is considered more _______ compared to an iterative solution, especially for problems with naturally recursive structures.</p>
                    <ul class="options-list">
                        <li><input type="radio" id="q10a" name="q10" value="a"><label for="q10a" data-translate="q10_op_a">Efficient in terms of memory usage.</label></li>
                        <li><input type="radio" id="q10b" name="q10" value="b"><label for="q10b" data-translate="q10_op_b">Difficult to debug.</label></li>
                        <li><input type="radio" id="q10c" name="q10" value="c"><label for="q10c" data-translate="q10_op_c">Elegant or easier to read/understand (conceptually).</label></li>
                        <li><input type="radio" id="q10d" name="q10" value="d"><label for="q10d" data-translate="q10_op_d">Faster in execution speed.</label></li>
                    </ul>
                </div>

                <div id="results-area">
                    <!-- Results will be displayed here -->
                </div>

                <button type="submit" id="submit-button" class="submit-button" data-translate="submit_button">Submit Answers</button>

            </form>
        </div>
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Module Specific ---
        const MODULE_ID = 30;
        const REQUIRED_SCORE = 6;
        const TOTAL_QUESTIONS = 10;
        const CORRECT_ANSWERS = ['b', 'b', 'c', 'b', 'c', 'a', 'b', 'b', 'd', 'c']; // Correct answers for Q1-Q10

        // --- Translations Object (Add Keys for this page) ---
        const translations = {
             en: {
                 "page_title": `Knowledge Check: Module ${MODULE_ID} - Recursion`,
                 "header_title": `Knowledge Check: Module ${MODULE_ID}`,
                 "return_button": "Return to Dashboard",
                 "quiz_instructions_title": "Instructions",
                 "quiz_instructions_p1": "Answer the following 10 questions about **Recursion**.",
                 "quiz_instructions_p2": "You need to answer at least <strong data-translate=\"quiz_pass_score\">6</strong> questions correctly to pass.",
                 "quiz_instructions_p3": "You can retake this check as many times as you need. Passing will update your progress on the dashboard.",
                 "quiz_pass_score": "6",
                 "submit_button": "Submit Answers",
                 "retake_button": "Retake Quiz",
                 "result_pass_message": "<i class='fas fa-check-circle result-icon'></i>Congratulations! You passed. Your progress has been updated.",
                 "result_fail_message": "<i class='fas fa-times-circle result-icon'></i>You didn't pass this time. Keep trying!",
                 "result_score_prefix": "Your score:",
                 "result_score_suffix": "out of 10.",
                 "q1_text": "1. What is the fundamental characteristic of a recursive function?",
                 "q1_op_a": "It uses a `for` loop to repeat code.", "q1_op_b": "It calls itself within its own definition.", "q1_op_c": "It must always return an integer.", "q1_op_d": "It only works with lists or strings.",
                 "q2_text": "2. What is the purpose of a \"base case\" in recursion?",
                 "q2_op_a": "To perform the main calculation.", "q2_op_b": "To stop the recursion and prevent infinite loops.", "q2_op_c": "To initialize variables used in the function.", "q2_op_d": "To make the recursive call to itself.",
                 "q3_text": "3. Consider the following recursive function...What is the result of `factorial(3)`?", // Truncated for brevity
                 "q3_op_a": "3", "q3_op_b": "1", "q3_op_c": "6", "q3_op_d": "0",
                 "q4_text": "4. What potential problem can occur if a recursive function lacks a proper base case or doesn't reach it?",
                 "q4_op_a": "Syntax Error", "q4_op_b": "Infinite recursion (leading to a Stack Overflow Error)", "q4_op_c": "TypeError", "q4_op_d": "The function will return `None` automatically.",
                 "q5_text": "5. In the factorial example (`return n * factorial(n - 1)`), which part represents the \"recursive step\"?",
                 "q5_op_a": "`n == 0`", "q5_op_b": "`return 1`", "q5_op_c": "`factorial(n - 1)`", "q5_op_d": "`return n * ...`",
                 "q6_text": "6. Which of these problems is NOT typically well-suited for a recursive solution?",
                 "q6_op_a": "Calculating the sum of numbers from 1 to N.", "q6_op_b": "Calculating factorials.", "q6_op_c": "Navigating tree-like data structures.", "q6_op_d": "Generating Fibonacci numbers.",
                 "q7_text": "7. What does \"Stack Overflow Error\" typically indicate in the context of recursion?",
                 "q7_op_a": "The program used too much disk space.", "q7_op_b": "The recursive calls went too deep, exhausting the call stack memory.", "q7_op_c": "There was an error reading input from the user.", "q7_op_d": "A mathematical division by zero occurred.",
                 "q8_text": "8. Every recursive solution can also be implemented using...",
                 "q8_op_a": "Only `if/else` statements.", "q8_op_b": "Iteration (loops like `for` or `while`).", "q8_op_c": "Dictionaries only.", "q8_op_d": "File reading operations.",
                 "q9_text": "9. Consider this function...What should the MISSING LINE be to make this a correct recursive countdown?", // Truncated
                 "q9_op_a": "`countdown(n + 1)`", "q9_op_b": "`return n`", "q9_op_c": "`countdown(n)`", "q9_op_d": "`countdown(n - 1)`",
                 "q10_text": "10. Recursion often leads to code that is considered more _______ compared to an iterative solution, especially for problems with naturally recursive structures.",
                 "q10_op_a": "Efficient in terms of memory usage.", "q10_op_b": "Difficult to debug.", "q10_op_c": "Elegant or easier to read/understand (conceptually).", "q10_op_d": "Faster in execution speed.",
                 "lang_select_aria": "Select Language", "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá", "footer_text": "Part of the Road to Free Open AGI Project"
             },
             pt: {
                 "page_title": `Verifica√ß√£o de Conhecimento: M√≥dulo ${MODULE_ID} - Recurs√£o`,
                 "header_title": `Verifica√ß√£o: M√≥dulo ${MODULE_ID}`,
                 "return_button": "Voltar ao Painel",
                 "quiz_instructions_title": "Instru√ß√µes",
                 "quiz_instructions_p1": "Responda √†s 10 perguntas seguintes sobre **Recurs√£o**.",
                 "quiz_instructions_p2": "Voc√™ precisa responder corretamente a pelo menos <strong data-translate=\"quiz_pass_score\">6</strong> perguntas para passar.",
                 "quiz_instructions_p3": "Voc√™ pode refazer esta verifica√ß√£o quantas vezes precisar. Passar atualizar√° seu progresso no painel.",
                 "quiz_pass_score": "6",
                 "submit_button": "Enviar Respostas",
                 "retake_button": "Refazer Quiz",
                 "result_pass_message": "<i class='fas fa-check-circle result-icon'></i>Parab√©ns! Voc√™ passou. Seu progresso foi atualizado.",
                 "result_fail_message": "<i class='fas fa-times-circle result-icon'></i>Voc√™ n√£o passou desta vez. Continue tentando!",
                 "result_score_prefix": "Sua pontua√ß√£o:",
                 "result_score_suffix": "de 10.",
                 "q1_text": "1. Qual √© a caracter√≠stica fundamental de uma fun√ß√£o recursiva?",
                 "q1_op_a": "Usa um loop `for` para repetir c√≥digo.", "q1_op_b": "Chama a si mesma dentro de sua pr√≥pria defini√ß√£o.", "q1_op_c": "Deve sempre retornar um inteiro.", "q1_op_d": "S√≥ funciona com listas ou strings.",
                 "q2_text": "2. Qual √© o prop√≥sito de um \"caso base\" na recurs√£o?",
                 "q2_op_a": "Realizar o c√°lculo principal.", "q2_op_b": "Parar a recurs√£o e prevenir loops infinitos.", "q2_op_c": "Inicializar vari√°veis usadas na fun√ß√£o.", "q2_op_d": "Fazer a chamada recursiva para si mesma.",
                 "q3_text": "3. Considere a seguinte fun√ß√£o recursiva para calcular fatorial... Qual √© o resultado de `factorial(3)`?", // Truncated
                 "q3_op_a": "3", "q3_op_b": "1", "q3_op_c": "6", "q3_op_d": "0",
                 "q4_text": "4. Que problema potencial pode ocorrer se uma fun√ß√£o recursiva n√£o tiver um caso base adequado ou n√£o o atingir?",
                 "q4_op_a": "Erro de Sintaxe", "q4_op_b": "Recurs√£o infinita (levando a um Erro de Estouro de Pilha)", "q4_op_c": "TypeError", "q4_op_d": "A fun√ß√£o retornar√° `None` automaticamente.",
                 "q5_text": "5. No exemplo do fatorial (`return n * factorial(n - 1)`), qual parte representa o \"passo recursivo\"?",
                 "q5_op_a": "`n == 0`", "q5_op_b": "`return 1`", "q5_op_c": "`factorial(n - 1)`", "q5_op_d": "`return n * ...`",
                 "q6_text": "6. Qual destes problemas N√ÉO √© tipicamente adequado para uma solu√ß√£o recursiva?",
                 "q6_op_a": "Calcular a soma dos n√∫meros de 1 a N.", "q6_op_b": "Calcular fatoriais.", "q6_op_c": "Navegar em estruturas de dados tipo √°rvore.", "q6_op_d": "Gerar n√∫meros de Fibonacci.",
                 "q7_text": "7. O que \"Erro de Estouro de Pilha\" (Stack Overflow Error) tipicamente indica no contexto da recurs√£o?",
                 "q7_op_a": "O programa usou muito espa√ßo em disco.", "q7_op_b": "As chamadas recursivas foram muito profundas, esgotando a mem√≥ria da pilha de chamadas.", "q7_op_c": "Houve um erro ao ler a entrada do usu√°rio.", "q7_op_d": "Ocorreu uma divis√£o matem√°tica por zero.",
                 "q8_text": "8. Toda solu√ß√£o recursiva tamb√©m pode ser implementada usando...",
                 "q8_op_a": "Apenas declara√ß√µes `if/else`.", "q8_op_b": "Itera√ß√£o (loops como `for` ou `while`).", "q8_op_c": "Apenas dicion√°rios.", "q8_op_d": "Opera√ß√µes de leitura de arquivo.",
                 "q9_text": "9. Considere esta fun√ß√£o... Qual deve ser a LINHA FALTANDO para tornar esta uma contagem regressiva recursiva correta?", // Truncated
                 "q9_op_a": "`countdown(n + 1)`", "q9_op_b": "`return n`", "q9_op_c": "`countdown(n)`", "q9_op_d": "`countdown(n - 1)`",
                 "q10_text": "10. A recurs√£o frequentemente leva a um c√≥digo considerado mais _______ em compara√ß√£o com uma solu√ß√£o iterativa, especialmente para problemas com estruturas naturalmente recursivas.",
                 "q10_op_a": "Eficiente em termos de uso de mem√≥ria.", "q10_op_b": "Dif√≠cil de depurar.", "q10_op_c": "Elegante ou mais f√°cil de ler/entender (conceitualmente).", "q10_op_d": "R√°pido na velocidade de execu√ß√£o.",
                 "lang_select_aria": "Selecionar Idioma", "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá", "footer_text": "Parte do Projeto Road to Free Open AGI"
             },
             zh: {
                 "page_title": `Áü•ËØÜÊµãÈ™åÔºöÊ®°Âùó ${MODULE_ID} - ÈÄíÂΩí`,
                 "header_title": `Áü•ËØÜÊµãÈ™åÔºöÊ®°Âùó ${MODULE_ID}`,
                 "return_button": "ËøîÂõû‰ª™Ë°®Êùø",
                 "quiz_instructions_title": "ËØ¥Êòé",
                 "quiz_instructions_p1": "ÂõûÁ≠î‰ª•‰∏ãÂÖ≥‰∫é**ÈÄíÂΩí**ÁöÑ 10 ‰∏™ÈóÆÈ¢ò„ÄÇ",
                 "quiz_instructions_p2": "ÊÇ®ÈúÄË¶ÅËá≥Â∞ëÁ≠îÂØπ <strong data-translate=\"quiz_pass_score\">6</strong> ‰∏™ÈóÆÈ¢òÊâçËÉΩÈÄöËøá„ÄÇ",
                 "quiz_instructions_p3": "ÊÇ®ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂ§öÊ¨°ÈáçËØïÊ≠§ÊµãÈ™å„ÄÇÈÄöËøáÂêéÂ∞ÜÂú®‰ª™Ë°®Êùø‰∏äÊõ¥Êñ∞ÊÇ®ÁöÑËøõÂ∫¶„ÄÇ",
                 "quiz_pass_score": "6",
                 "submit_button": "Êèê‰∫§Á≠îÊ°à",
                 "retake_button": "ÈáçÊñ∞ÊµãÈ™å",
                 "result_pass_message": "<i class='fas fa-check-circle result-icon'></i>ÊÅ≠ÂñúÔºÅÊÇ®Â∑≤ÈÄöËøá„ÄÇÊÇ®ÁöÑËøõÂ∫¶Â∑≤Êõ¥Êñ∞„ÄÇ",
                 "result_fail_message": "<i class='fas fa-times-circle result-icon'></i>ÊÇ®ËøôÊ¨°Êú™ËÉΩÈÄöËøá„ÄÇËØ∑ÁªßÁª≠Âä™ÂäõÔºÅ",
                 "result_score_prefix": "ÊÇ®ÁöÑÂæóÂàÜÔºö",
                 "result_score_suffix": "/ 10„ÄÇ",
                 "q1_text": "1. ÈÄíÂΩíÂáΩÊï∞ÁöÑÂü∫Êú¨ÁâπÂæÅÊòØ‰ªÄ‰πàÔºü",
                 "q1_op_a": "ÂÆÉ‰ΩøÁî® `for` Âæ™ÁéØÊù•ÈáçÂ§ç‰ª£Á†Å„ÄÇ", "q1_op_b": "ÂÆÉÂú®Ëá™Â∑±ÁöÑÂÆö‰πâ‰∏≠Ë∞ÉÁî®Ëá™Ë∫´„ÄÇ", "q1_op_c": "ÂÆÉÂøÖÈ°ªÊÄªÊòØËøîÂõû‰∏Ä‰∏™Êï¥Êï∞„ÄÇ", "q1_op_d": "ÂÆÉÂè™ÈÄÇÁî®‰∫éÂàóË°®ÊàñÂ≠óÁ¨¶‰∏≤„ÄÇ",
                 "q2_text": "2. ÈÄíÂΩí‰∏≠‚ÄúÂü∫Êú¨ÊÉÖÂÜµ‚ÄùÔºàbase caseÔºâÁöÑÁõÆÁöÑÊòØ‰ªÄ‰πàÔºü",
                 "q2_op_a": "ÊâßË°å‰∏ªË¶ÅËÆ°ÁÆó„ÄÇ", "q2_op_b": "ÂÅúÊ≠¢ÈÄíÂΩíÂπ∂Èò≤Ê≠¢Êó†ÈôêÂæ™ÁéØ„ÄÇ", "q2_op_c": "ÂàùÂßãÂåñÂáΩÊï∞‰∏≠‰ΩøÁî®ÁöÑÂèòÈáè„ÄÇ", "q2_op_d": "ËøõË°åÂØπËá™Ë∫´ÁöÑÈÄíÂΩíË∞ÉÁî®„ÄÇ",
                 "q3_text": "3. ËÄÉËôë‰ª•‰∏ãËÆ°ÁÆóÈò∂‰πòÁöÑÈÄíÂΩíÂáΩÊï∞... `factorial(3)` ÁöÑÁªìÊûúÊòØ‰ªÄ‰πàÔºü", // Êà™Êñ≠
                 "q3_op_a": "3", "q3_op_b": "1", "q3_op_c": "6", "q3_op_d": "0",
                 "q4_text": "4. Â¶ÇÊûúÈÄíÂΩíÂáΩÊï∞Áº∫Â∞ëÊ≠£Á°ÆÁöÑÂü∫Êú¨ÊÉÖÂÜµÊàñÊú™ËÉΩËææÂà∞ÂÆÉÔºåÂèØËÉΩ‰ºöÂá∫Áé∞‰ªÄ‰πàÊΩúÂú®ÈóÆÈ¢òÔºü",
                 "q4_op_a": "ËØ≠Ê≥ïÈîôËØØ", "q4_op_b": "Êó†ÈôêÈÄíÂΩíÔºàÂØºËá¥Â†ÜÊ†àÊ∫¢Âá∫ÈîôËØØÔºâ", "q4_op_c": "Á±ªÂûãÈîôËØØ", "q4_op_d": "ÂáΩÊï∞Â∞ÜËá™Âä®ËøîÂõû `None`„ÄÇ",
                 "q5_text": "5. Âú®Èò∂‰πòÁ§∫‰æãÔºà`return n * factorial(n - 1)`Ôºâ‰∏≠ÔºåÂì™‰∏ÄÈÉ®ÂàÜ‰ª£Ë°®‚ÄúÈÄíÂΩíÊ≠•È™§‚ÄùÔºü",
                 "q5_op_a": "`n == 0`", "q5_op_b": "`return 1`", "q5_op_c": "`factorial(n - 1)`", "q5_op_d": "`return n * ...`",
                 "q6_text": "6. ‰ª•‰∏ãÂì™‰∏™ÈóÆÈ¢òÈÄöÂ∏∏‰∏çÂ§™ÈÄÇÂêà‰ΩøÁî®ÈÄíÂΩíËß£ÂÜ≥ÊñπÊ°àÔºü",
                 "q6_op_a": "ËÆ°ÁÆó‰ªé 1 Âà∞ N ÁöÑÊï∞Â≠ó‰πãÂíå„ÄÇ", "q6_op_b": "ËÆ°ÁÆóÈò∂‰πò„ÄÇ", "q6_op_c": "ÈÅçÂéÜÊ†ëÁä∂Êï∞ÊçÆÁªìÊûÑ„ÄÇ", "q6_op_d": "ÁîüÊàêÊñêÊ≥¢ÈÇ£Â•ëÊï∞Âàó„ÄÇ",
                 "q7_text": "7. Âú®ÈÄíÂΩíÁöÑ‰∏ä‰∏ãÊñá‰∏≠Ôºå‚ÄúÂ†ÜÊ†àÊ∫¢Âá∫ÈîôËØØ‚ÄùÔºàStack Overflow ErrorÔºâÈÄöÂ∏∏Ë°®Á§∫‰ªÄ‰πàÔºü",
                 "q7_op_a": "Á®ãÂ∫è‰ΩøÁî®‰∫ÜËøáÂ§öÁöÑÁ£ÅÁõòÁ©∫Èó¥„ÄÇ", "q7_op_b": "ÈÄíÂΩíË∞ÉÁî®ËøáÊ∑±ÔºåËÄóÂ∞Ω‰∫ÜË∞ÉÁî®Â†ÜÊ†àÂÜÖÂ≠ò„ÄÇ", "q7_op_c": "‰ªéÁî®Êà∑ËØªÂèñËæìÂÖ•Êó∂Âá∫Èîô„ÄÇ", "q7_op_d": "ÂèëÁîü‰∫ÜÊï∞Â≠¶‰∏äÁöÑÈô§Èõ∂ÈîôËØØ„ÄÇ",
                 "q8_text": "8. ÊØè‰∏™ÈÄíÂΩíËß£ÂÜ≥ÊñπÊ°à‰πüÂèØ‰ª•‰ΩøÁî®...Êù•ÂÆûÁé∞„ÄÇ",
                 "q8_op_a": "‰ªÖ `if/else` ËØ≠Âè•„ÄÇ", "q8_op_b": "Ëø≠‰ª£ÔºàÂ¶Ç `for` Êàñ `while` Âæ™ÁéØÔºâ„ÄÇ", "q8_op_c": "‰ªÖÂ≠óÂÖ∏„ÄÇ", "q8_op_d": "Êñá‰ª∂ËØªÂèñÊìç‰Ωú„ÄÇ",
                 "q9_text": "9. ËÄÉËôëËøô‰∏™ÂáΩÊï∞... Áº∫Â§±ÁöÑË°åÂ∫îËØ•ÊòØ‰ªÄ‰πàÊâçËÉΩ‰ΩøÂÖ∂Êàê‰∏∫Ê≠£Á°ÆÁöÑÈÄíÂΩíÂÄíËÆ°Êó∂Ôºü", // Êà™Êñ≠
                 "q9_op_a": "`countdown(n + 1)`", "q9_op_b": "`return n`", "q9_op_c": "`countdown(n)`", "q9_op_d": "`countdown(n - 1)`",
                 "q10_text": "10. ‰∏éËø≠‰ª£Ëß£ÂÜ≥ÊñπÊ°àÁõ∏ÊØîÔºåÈÄíÂΩíÈÄöÂ∏∏‰ºö‰∫ßÁîüË¢´ËÆ§‰∏∫Êõ¥ _______ ÁöÑ‰ª£Á†ÅÔºåÁâπÂà´ÊòØÂØπ‰∫éÂÖ∑ÊúâËá™ÁÑ∂ÈÄíÂΩíÁªìÊûÑÁöÑÈóÆÈ¢ò„ÄÇ",
                 "q10_op_a": "ÂÜÖÂ≠ò‰ΩøÁî®ÊïàÁéáÈ´ò„ÄÇ", "q10_op_b": "Èöæ‰ª•Ë∞ÉËØï„ÄÇ", "q10_op_c": "‰ºòÈõÖÊàñÊõ¥ÂÆπÊòìÈòÖËØª/ÁêÜËß£ÔºàÊ¶ÇÂøµ‰∏äÔºâ„ÄÇ", "q10_op_d": "ÊâßË°åÈÄüÂ∫¶Âø´„ÄÇ",
                 "lang_select_aria": "ÈÄâÊã©ËØ≠Ë®Ä", "lang_en": "üá¨üáß English", "lang_pt": "üáßüá∑ Portugu√™s", "lang_zh": "üá®üá≥ ‰∏≠Êñá", "footer_text": "ÈÄöÂæÄËá™Áî±ÂºÄÊîæAGI‰πãË∑ØÈ°πÁõÆÁöÑ‰∏ÄÈÉ®ÂàÜ"
             }
         };

        // --- Core JS Logic (Similar to Dashboard but adapted for Quiz) ---
        document.addEventListener('DOMContentLoaded', () => {
            const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1'; // Same key as dashboard
            const LANGUAGE_STORAGE_KEY = 'userLanguage';

            const quizForm = document.getElementById('quiz-form');
            const submitButton = document.getElementById('submit-button');
            const resultsArea = document.getElementById('results-area');
            const languageSelectElement = document.getElementById('languageSelect');

            let currentLang = 'en'; // Default language

             // --- Language Functions ---
             function getStoredLanguage() {
                const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY);
                if (storedLang && translations[storedLang]) return storedLang;
                 const browserLang = navigator.language || navigator.userLanguage;
                 if (browserLang.startsWith('pt')) return 'pt';
                 if (browserLang.startsWith('zh')) return 'zh';
                return 'en';
            }

            function getTranslation(key, lang, replacements = {}) {
                 let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`;
                 for (const placeholder in replacements) {
                     const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
                     text = text.replace(regex, replacements[placeholder]);
                 }
                 // Re-translate dynamic parts like the pass score
                 if (key === 'quiz_instructions_p2') {
                    text = text.replace(/<strong data-translate="quiz_pass_score">.*?<\/strong>/, `<strong data-translate="quiz_pass_score">${getTranslation('quiz_pass_score', lang)}</strong>`);
                 }
                 return text;
             }

             function translatePage(lang) {
                 currentLang = lang; // Update current language
                 if (!translations[lang]) lang = 'en'; // Fallback
                 document.documentElement.lang = lang;

                 document.querySelectorAll('[data-translate]').forEach(el => {
                     const key = el.getAttribute('data-translate');
                     const translation = getTranslation(key, lang);
                     if (el.tagName === 'TITLE') { document.title = translation; }
                      else if (el.dataset.translate === 'quiz_instructions_p2') { // Handle HTML in this specific translation
                        el.innerHTML = translation;
                      }
                      else if (translation.includes('<') && translation.includes('>')) { // Basic HTML handling
                        el.innerHTML = translation;
                      }
                      else { el.textContent = translation; }
                 });
                 document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                     const key = el.getAttribute('data-translate-placeholder');
                     el.setAttribute('placeholder', getTranslation(key, lang));
                 });
                  document.querySelectorAll('[data-translate-aria-label]').forEach(el => {
                     const key = el.getAttribute('data-translate-aria-label');
                     el.setAttribute('aria-label', getTranslation(key, lang));
                 });
                 // Update button text if already submitted
                 if (quizForm.classList.contains('submitted')) {
                     submitButton.textContent = getTranslation('retake_button', lang);
                 } else {
                     submitButton.textContent = getTranslation('submit_button', lang);
                 }
                 // Re-render results if already shown
                if (resultsArea.style.display !== 'none') {
                     const score = parseInt(resultsArea.dataset.score || '0');
                     displayResults(score); // Re-display with current language
                 }
             }

             function setLanguage(lang) {
                if (!translations[lang]) lang = 'en'; // Fallback
                localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
                if(languageSelectElement) languageSelectElement.value = lang;
                translatePage(lang);
             }

            // --- LocalStorage Functions ---
            function loadKnowledgeCheckStatus() {
                try {
                    const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY);
                    const parsed = storedStatus ? JSON.parse(storedStatus) : {};
                    return typeof parsed === 'object' && parsed !== null ? parsed : {};
                } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; }
            }

            function saveKnowledgeCheckStatus(statusObject) {
                try {
                    localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject));
                } catch (e) { console.error("Error saving KC status to localStorage:", e); }
            }

            // --- Quiz Logic ---
            function resetQuiz() {
                quizForm.reset(); // Clear selections
                resultsArea.style.display = 'none'; // Hide results
                resultsArea.className = ''; // Clear result classes
                resultsArea.innerHTML = ''; // Clear result content
                resultsArea.removeAttribute('data-score');
                quizForm.classList.remove('submitted'); // Remove submitted state
                submitButton.disabled = false;
                submitButton.textContent = getTranslation('submit_button', currentLang);

                // Remove highlighting classes
                 document.querySelectorAll('.options-list label').forEach(label => {
                     label.classList.remove('correct-answer', 'incorrect-answer', 'reveal-correct');
                     label.style.cursor = 'pointer'; // Restore cursor
                 });
                 document.querySelectorAll('.options-list input[type="radio"]').forEach(radio => {
                    radio.disabled = false; // Re-enable radios
                    radio.style.display = ''; // Make radios visible again
                 });
            }

            function highlightAnswers(userAnswers) {
                for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                    const questionIndex = i + 1;
                    const options = document.querySelectorAll(`input[name="q${questionIndex}"]`);
                    const correctAnswerValue = CORRECT_ANSWERS[i];
                    const userAnswerValue = userAnswers[i];

                    options.forEach(option => {
                        const label = option.nextElementSibling; // Get the label associated with the radio button
                        if (!label) return;

                        option.disabled = true; // Disable radio button
                        label.style.cursor = 'default'; // Change cursor

                        if (option.value === correctAnswerValue) {
                            // This is the correct option
                            if(userAnswerValue !== correctAnswerValue && userAnswerValue !== undefined){
                                // If user was wrong, reveal the correct one
                                label.classList.add('reveal-correct');
                            } else if (userAnswerValue === correctAnswerValue) {
                                // If user was correct, mark it as such
                                label.classList.add('correct-answer');
                            } else {
                                // If user didn't answer, just show the correct one subtly if needed, or do nothing
                                // Optional: Mark unselected correct answer if you want
                            }
                        } else if (option.value === userAnswerValue) {
                            // This is the incorrect option the user selected
                            label.classList.add('incorrect-answer');
                        }
                    });
                }
            }


             function displayResults(score) {
                 const isPass = score >= REQUIRED_SCORE;
                 resultsArea.innerHTML = `
                     <p><strong>${getTranslation('result_score_prefix', currentLang)}</strong> ${score} ${getTranslation('result_score_suffix', currentLang)}</p>
                     <p>${isPass ? getTranslation('result_pass_message', currentLang) : getTranslation('result_fail_message', currentLang)}</p>
                 `;
                 resultsArea.className = isPass ? 'pass' : 'fail'; // Apply pass/fail class
                 resultsArea.style.display = 'block'; // Show results
                 resultsArea.dataset.score = score; // Store score for potential re-translation
             }

            quizForm.addEventListener('submit', (event) => {
                event.preventDefault();

                if (quizForm.classList.contains('submitted')) {
                    resetQuiz();
                    return; // Exit after resetting for retake
                }

                let score = 0;
                const userAnswers = [];
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
                    const answerValue = selectedOption ? selectedOption.value : undefined;
                    userAnswers.push(answerValue);
                    if (answerValue === CORRECT_ANSWERS[i - 1]) {
                        score++;
                    }
                }

                quizForm.classList.add('submitted'); // Mark as submitted
                submitButton.textContent = getTranslation('retake_button', currentLang); // Change button text
                // submitButton.disabled = true; // Optionally disable until reset or for a short time

                highlightAnswers(userAnswers); // Highlight correct/incorrect answers
                displayResults(score); // Show the score and pass/fail message

                // Update localStorage only if passed
                if (score >= REQUIRED_SCORE) {
                    const currentStatus = loadKnowledgeCheckStatus();
                    currentStatus[MODULE_ID] = true; // Mark this module as complete
                    saveKnowledgeCheckStatus(currentStatus);
                }
            });

            // --- Language Switcher Setup ---
            if (languageSelectElement) {
                languageSelectElement.value = getStoredLanguage(); // Set initial value
                languageSelectElement.addEventListener('change', (e) => {
                    setLanguage(e.target.value);
                });
            }

            // --- Initial Setup ---
            setLanguage(getStoredLanguage()); // Set initial language and translate

        }); // End DOMContentLoaded
    </script>

</body>
</html>