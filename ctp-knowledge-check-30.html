<!DOCTYPE html>
<!-- Language set by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title set dynamically by JS -->
    <title data-translate="kc_page_title_template" data-module-id="30">Knowledge Check: Module 30</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Base Styles & Variables (COPIED FROM DASHBOARD) --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-page: #f0f2f5;
            --background-card: #ffffff;
            --background-sidebar: #ffffff; /* Used for quiz container bg */
            --background-header: linear-gradient(135deg, #0d6efd, #0a58ca);
            --text-light: #f8f9fa;
            --text-dark: #343a40;
            --text-muted: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --error-color: #dc3545;
            --info-color: #0dcaf0;
            --video-color: #fd7e14; /* Not used directly here, but kept for consistency */
            --check-color: #6f42c1; /* Used for passing state potentially */
            --certificate-color: #d63384; /* Used for language switcher */
            --progress-bg: #e9ecef;
            --progress-fill: var(--check-color);
            --border-color: #dee2e6;
            --border-radius: 8px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            --card-shadow-hover: 0 6px 18px rgba(0, 0, 0, 0.1); /* Not used directly */
            --transition-speed: 0.3s;
            --font-body: 'Roboto', sans-serif;
            --font-title: 'Orbitron', sans-serif;
            --sidebar-width: 260px; /* Not used directly */
             /* Colors for lang switcher */
             --lang-select-border: var(--certificate-color);
             --lang-select-bg: rgba(255, 255, 255, 0.1);
             --lang-select-bg-hover: rgba(255, 255, 255, 0.15);
             --lang-option-bg: var(--background-card);
             --lang-option-text: var(--text-dark);
             --lang-arrow-color: var(--certificate-color);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; font-size: 16px; }
        body {
            font-family: var(--font-body); line-height: 1.6;
            background-color: var(--background-page); color: var(--text-dark);
            min-height: 100vh; display: flex; flex-direction: column;
        }

        /* --- Simple Header for KC Page --- */
        .kc-header {
            background: var(--background-header);
            color: var(--text-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 1rem;
        }
        .kc-header h1 {
            font-family: var(--font-title);
            font-size: 1.6rem; /* Slightly smaller than dashboard */
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            order: 2; /* Center title */
            flex-grow: 1; /* Allow title to take space */
            text-align: center; /* Center title text */
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--text-light);
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.9rem;
            transition: background-color var(--transition-speed);
            order: 1; /* Button on the left */
        }
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }
        .back-button i { font-size: 1em; }

        /* Language Switcher Styles (Adapted for Header) */
        .language-switcher {
            min-width: 150px; /* Give it some space */
            order: 3; /* Switcher on the right */
        }
         #languageSelect {
            width: 100%;
            background: var(--lang-select-bg); /* Semi-transparent */
            color: var(--text-light); /* Light text */
            border: 1px solid var(--lang-select-border);
            border-radius: 5px;
            padding: 8px 35px 8px 15px;
            cursor: pointer;
            font-size: 0.9rem; /* Slightly smaller */
            font-weight: 500;
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23${encodeURIComponent(getComputedStyle(document.documentElement).getPropertyValue('--certificate-color').trim().substring(1))}%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 10px auto;
            transition: border-color 0.3s ease, background-color 0.3s ease;
         }
         #languageSelect:hover {
            background-color: var(--lang-select-bg-hover);
            border-color: #f06ac4; /* Lighter pink */
         }
         #languageSelect:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
         }
         #languageSelect option {
              background: var(--lang-option-bg);
              color: var(--lang-option-text);
              padding: 5px;
         }

        /* --- Main Content Area --- */
        .kc-main {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            flex-grow: 1;
            width: 100%;
        }

        /* --- Quiz Container Styling --- */
        .quiz-container {
            background-color: var(--background-card);
            border-radius: var(--border-radius);
            padding: 2rem 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .quiz-instructions {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.95rem;
            color: var(--text-muted);
        }
        .quiz-instructions p { margin-bottom: 0.5rem; }
        .quiz-instructions strong { color: var(--text-dark); }
        .quiz-instructions .pass-score { color: var(--check-color); font-weight: 700; }
        .quiz-instructions .retake-info { font-style: italic; }

        #quiz-form {
             margin-bottom: 2rem;
        }

        .question-container {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee; /* Lighter separator */
        }
        .question-container:last-of-type {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 1.2rem;
            font-size: 1.1rem;
            color: var(--text-dark);
        }
        .question-text .q-number {
            display: inline-block;
            background-color: var(--background-page);
            color: var(--primary-color);
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            margin-right: 10px;
            font-size: 0.9em;
        }
        .question-text code {
            background-color: #e9ecef; padding: 0.1em 0.4em; border-radius: 3px; font-size: 0.9em; color: #c7254e;
        }

        .answer-options { list-style: none; padding: 0; margin: 0; }

        .answer-option {
            margin-bottom: 0.8rem;
            position: relative;
        }
        .answer-option:last-child { margin-bottom: 0; }

        .answer-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none; /* Hide the actual radio button */
        }

        .answer-option label {
            display: block;
            padding: 0.8rem 1.2rem 0.8rem 3rem; /* Space for custom radio */
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            position: relative; /* Needed for pseudo-element */
            font-size: 0.95rem;
        }
        .answer-option label code {
             background-color: #dee2e6; padding: 0.1em 0.4em; border-radius: 3px; font-size: 0.9em; color: #c7254e;
        }

        /* Custom radio button */
        .answer-option label::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary-color);
            border-radius: 50%;
            background-color: #fff;
            transition: border-color 0.2s ease;
        }
        /* Custom radio button - checked state */
        .answer-option input[type="radio"]:checked + label::before {
            border-color: var(--primary-color);
        }
         /* Custom radio button - checked inner dot */
        .answer-option input[type="radio"]:checked + label::after {
            content: '';
            position: absolute;
            left: calc(1rem + 4px); /* Center inside the border */
            top: 50%;
            transform: translateY(-50%);
            width: 10px; /* Smaller dot */
            height: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
            transition: background-color 0.2s ease;
        }

        .answer-option label:hover {
            background-color: #e9ecef;
            border-color: var(--secondary-color);
        }
        .answer-option input[type="radio"]:checked + label {
            background-color: #e7f1ff;
            border-color: var(--primary-color);
        }
        .answer-option input[type="radio"]:focus + label {
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); /* Focus outline */
        }


        /* --- Submit Button --- */
        .submit-button {
            display: block;
            width: 100%;
            padding: 0.9rem 1.5rem;
            background-color: var(--check-color);
            color: var(--text-light);
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s ease;
            margin-top: 2.5rem;
        }
        .submit-button:hover {
            background-color: #5a34a0; /* Darker purple */
        }
         .submit-button:active {
            transform: scale(0.98);
         }
         .submit-button:disabled {
             background-color: var(--secondary-color);
             cursor: not-allowed;
             opacity: 0.7;
         }

        /* --- Results Area --- */
        #results-area {
            background-color: var(--background-page); /* Slightly different bg */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
        }
        #results-area h2 {
            font-family: var(--font-title);
            color: var(--text-dark);
            margin-bottom: 1rem;
        }
        .results-message {
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
        }
        .results-message.passed {
            background-color: #d1e7dd; /* Success background */
            color: #0f5132; /* Success text */
            border: 1px solid #badbcc;
        }
        .results-message.failed {
            background-color: #f8d7da; /* Error background */
            color: #842029; /* Error text */
            border: 1px solid #f5c2c7;
        }
        .results-message i { margin-right: 8px; }

        .results-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .results-buttons button,
        .results-buttons a {
            padding: 0.7rem 1.5rem;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            border: none;
            transition: background-color var(--transition-speed), opacity 0.2s;
        }
        #try-again-button {
            background-color: var(--accent-color);
            color: var(--text-dark);
        }
        #try-again-button:hover { background-color: #e0a800; }

        #back-to-dashboard-results-button {
            background-color: var(--secondary-color);
            color: var(--text-light);
        }
        #back-to-dashboard-results-button:hover { background-color: #5a6268; }


        /* --- Footer --- */
        footer {
            text-align: center; padding: 1.5rem; margin-top: auto; /* Pushes footer down */
            background-color: var(--background-card); border-top: 1px solid var(--border-color);
            color: var(--text-muted); font-size: 0.9rem;
        }

        /* --- Responsive Design Adjustments --- */
        @media (max-width: 768px) {
            html { font-size: 15px; }
            .kc-header h1 { font-size: 1.4rem; }
            .kc-main { padding: 0 1rem; margin: 1.5rem auto; }
            .quiz-container { padding: 1.5rem; }
            .question-text { font-size: 1rem; }
            .answer-option label { padding: 0.7rem 1rem 0.7rem 2.5rem; font-size: 0.9rem;}
             .answer-option label::before { left: 0.8rem; width: 16px; height: 16px; }
             .answer-option input[type="radio"]:checked + label::after { left: calc(0.8rem + 3px); width: 10px; height: 10px; } /* Adjust dot position */
            .submit-button { font-size: 1rem; padding: 0.8rem; }
            #results-area { padding: 1.5rem; }
            .results-message { font-size: 1.1rem; }
            .results-buttons button, .results-buttons a { width: 100%; text-align: center; } /* Stack buttons */
            .kc-header { padding: 1rem; flex-direction: column; } /* Stack header items */
            .kc-header h1 { order: 1; text-align: center; margin-bottom: 0.5rem;} /* Title first */
            .back-button { order: 2; margin-bottom: 0.5rem;} /* Back button second */
            .language-switcher { order: 3; width: 100%; max-width: 250px; margin: 0 auto;} /* Lang switcher last, centered */
        }
         @media (max-width: 576px) {
            html { font-size: 14px; }
             .quiz-container { padding: 1rem; }
             .quiz-instructions { font-size: 0.9rem; padding-bottom: 1rem; margin-bottom: 1.5rem; }
             .question-text { font-size: 0.95rem; margin-bottom: 1rem; }
             .answer-option { margin-bottom: 0.6rem; }
             .answer-option label { padding: 0.6rem 0.8rem 0.6rem 2.2rem; }
             .answer-option label::before { left: 0.6rem; }
             .answer-option input[type="radio"]:checked + label::after { left: calc(0.6rem + 3px); width: 9px; height: 9px;}
         }

    </style>
</head>
<body>

    <header class="kc-header">
        <a href="ctp-dashboard.html" class="back-button" data-translate="kc_back_button">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <!-- Title is dynamically set from <title> tag via JS -->
        <h1 id="kc-page-title">Knowledge Check</h1>
         <!-- Language Switcher Widget -->
         <div class="language-switcher">
            <select id="languageSelect" data-translate-aria-label="lang_select_aria" aria-label="Select Language">
                <option value="en" data-translate="lang_en">🇬🇧 English</option>
                <option value="pt" data-translate="lang_pt">🇧🇷 Português</option>
                <option value="zh" data-translate="lang_zh">🇨🇳 中文</option>
            </select>
        </div>
    </header>

    <main class="kc-main">
        <div class="quiz-container">

            <div class="quiz-instructions" data-translate="kc_instructions_template" data-pass-score="6" data-total-questions="10">
                <p>Answer the following 10 questions about this module.</p>
                <p>You need to answer at least <strong class="pass-score">6</strong> questions correctly to pass.</p>
                <p class="retake-info">You can retake this knowledge check as many times as you need.</p>
            </div>

            <form id="quiz-form">
                <!-- Questions will be loaded here by JavaScript -->
                <div id="questions-area">
                    <!-- Example Structure (repeated by JS): -->
                    <!--
                    <div class="question-container" data-question-id="q1">
                        <p class="question-text"><span class="q-number">1</span> <span class="q-text-content">Question text goes here?</span></p>
                        <ul class="answer-options">
                            <li class="answer-option">
                                <input type="radio" id="q1_opt1" name="q1" value="a" required>
                                <label for="q1_opt1">Option A</label>
                            </li>
                             <li class="answer-option">
                                <input type="radio" id="q1_opt2" name="q1" value="b">
                                <label for="q1_opt2">Option B</label>
                            </li>
                        </ul>
                    </div>
                    -->
                </div>

                <button type="submit" id="submit-button" class="submit-button" data-translate="kc_submit_button">Submit Answers</button>
            </form>

            <div id="results-area" style="display: none;">
                <h2 data-translate="kc_results_title">Results</h2>
                <div id="results-message" class="results-message">
                    <!-- Score and pass/fail message here -->
                </div>
                <div class="results-buttons">
                    <button type="button" id="try-again-button" data-translate="kc_try_again_button">Try Again</button>
                    <a href="ctp-dashboard.html" id="back-to-dashboard-results-button" data-translate="kc_return_dashboard_button">Return to Dashboard</a>
                </div>
            </div>

        </div><!-- /.quiz-container -->
    </main>

    <footer>
        <p data-translate="footer_text">Part of the Road to Free Open AGI Project</p>
    </footer>

    <script>
        // --- Configuration ---
        const CURRENT_MODULE_ID = 30; // <<< Set this for each knowledge check page
        const QUESTIONS_TO_PASS = 6;
        const KNOWLEDGE_CHECK_STORAGE_KEY = 'knowledgeCheckStatus_v1';
        const LANGUAGE_STORAGE_KEY = 'userLanguage';

        // --- Translations Object (Add specific KC keys) ---
        const translations = {
             en: {
                 "page_title_template": "Knowledge Check: Module {moduleId}", // Placeholder for module ID
                 "kc_page_title_template": "KC: Module {moduleId} - {moduleTitle}", // Placeholder for module ID and Title
                 "kc_back_button": "Back to Dashboard",
                 "kc_instructions_template": "<p>Answer the following {totalQuestions} questions about <strong>Module {moduleId}: {moduleTitle}</strong>.</p><p>You need to answer at least <strong class=\"pass-score\">{passScore}</strong> questions correctly to pass.</p><p class=\"retake-info\">You can retake this knowledge check as many times as you need.</p>",
                 "kc_submit_button": "Submit Answers",
                 "kc_results_title": "Results",
                 "kc_score_template": "You scored {score} out of {totalQuestions}.", // Placeholders
                 "kc_passed_message": "<i class='fas fa-check-circle'></i> Congratulations! You passed. Your progress has been updated.",
                 "kc_failed_message": "<i class='fas fa-times-circle'></i> You didn't pass this time. Keep trying!",
                 "kc_try_again_button": "Try Again",
                 "kc_return_dashboard_button": "Return to Dashboard",
                 "widget_lang_title": "Language", // Copied from dashboard
                 "lang_select_aria": "Select Language", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "Part of the Road to Free Open AGI Project", // Copied from dashboard
                 // --- Module 30 Specific Translations ---
                 "module_30_title": "Recursion Intro (Opt)",
                 "kc30_q1_text": "What is the fundamental characteristic of a recursive function?",
                 "kc30_q1_opt1": "It uses a `for` loop.",
                 "kc30_q1_opt2": "It calls itself.",
                 "kc30_q1_opt3": "It always returns `None`.",
                 "kc30_q1_opt4": "It takes exactly one argument.",
                 "kc30_q2_text": "What is the purpose of a 'base case' in recursion?",
                 "kc30_q2_opt1": "To start the recursion.",
                 "kc30_q2_opt2": "To perform the main calculation.",
                 "kc30_q2_opt3": "To stop the recursion and prevent infinite loops.",
                 "kc30_q2_opt4": "To define the function's parameters.",
                 "kc30_q3_text": "Consider the recursive function `def countdown(n): if n <= 0: print('Blastoff!'); else: print(n); countdown(n-1)`. What is the base case?",
                 "kc30_q3_opt1": "`print(n)`",
                 "kc30_q3_opt2": "`countdown(n-1)`",
                 "kc30_q3_opt3": "`n <= 0`",
                 "kc30_q3_opt4": "`print('Blastoff!')`",
                 "kc30_q4_text": "In the `countdown` function from the previous question, what is the recursive step?",
                 "kc30_q4_opt1": "The `if n <= 0:` condition.",
                 "kc30_q4_opt2": "The call `countdown(n-1)`.",
                 "kc30_q4_opt3": "The `print(n)` statement.",
                 "kc30_q4_opt4": "The `print('Blastoff!')` statement.",
                 "kc30_q5_text": "What happens if a recursive function lacks a proper base case or never reaches it?",
                 "kc30_q5_opt1": "It runs faster.",
                 "kc30_q5_opt2": "It automatically converts to an iterative loop.",
                 "kc30_q5_opt3": "It results in infinite recursion, likely causing a stack overflow error.",
                 "kc30_q5_opt4": "It returns 0 by default.",
                 "kc30_q6_text": "Which of these problems is commonly solved using recursion as a classic example?",
                 "kc30_q6_opt1": "Reading data from a file.",
                 "kc30_q6_opt2": "Calculating the factorial of a number.",
                 "kc30_q6_opt3": "Sorting a list using bubble sort.",
                 "kc30_q6_opt4": "Getting user input.",
                 "kc30_q7_text": "What does the 'recursive step' typically do?",
                 "kc30_q7_opt1": "Stops the function immediately.",
                 "kc30_q7_opt2": "Calls the function again with a modified argument that moves closer to the base case.",
                 "kc30_q7_opt3": "Prints the final result.",
                 "kc30_q7_opt4": "Defines the initial value.",
                 "kc30_q8_text": "Compared to iteration (loops), recursion can sometimes be...",
                 "kc30_q8_opt1": "More memory efficient due to fewer variables.",
                 "kc30_q8_opt2": "Easier to understand for simple counting tasks.",
                 "kc30_q8_opt3": "More elegant or intuitive for problems that are naturally recursive (like tree traversal), but potentially less efficient.",
                 "kc30_q8_opt4": "Impossible to implement in Python.",
                 "kc30_q9_text": "What is the 'call stack' primarily used for in the context of recursion?",
                 "kc30_q9_opt1": "Storing the base case value.",
                 "kc30_q9_opt2": "Keeping track of each function call's state (local variables, return address).",
                 "kc30_q9_opt3": "Counting the number of iterations.",
                 "kc30_q9_opt4": "Holding the final return value.",
                 "kc30_q10_text": "If `factorial(n)` calculates n!, what is `factorial(0)` based on the typical recursive definition where the base case is 0?",
                 "kc30_q10_opt1": "0",
                 "kc30_q10_opt2": "1",
                 "kc30_q10_opt3": "Undefined (error)",
                 "kc30_q10_opt4": "-1"
             },
             pt: {
                 "page_title_template": "Verificação: Módulo {moduleId}",
                 "kc_page_title_template": "VC: Módulo {moduleId} - {moduleTitle}",
                 "kc_back_button": "Voltar ao Painel",
                 "kc_instructions_template": "<p>Responda às {totalQuestions} perguntas seguintes sobre o <strong>Módulo {moduleId}: {moduleTitle}</strong>.</p><p>Você precisa responder corretamente a pelo menos <strong class=\"pass-score\">{passScore}</strong> perguntas para passar.</p><p class=\"retake-info\">Você pode refazer esta verificação quantas vezes precisar.</p>",
                 "kc_submit_button": "Enviar Respostas",
                 "kc_results_title": "Resultados",
                 "kc_score_template": "Você acertou {score} de {totalQuestions}.",
                 "kc_passed_message": "<i class='fas fa-check-circle'></i> Parabéns! Você passou. Seu progresso foi atualizado.",
                 "kc_failed_message": "<i class='fas fa-times-circle'></i> Você não passou desta vez. Continue tentando!",
                 "kc_try_again_button": "Tentar Novamente",
                 "kc_return_dashboard_button": "Voltar ao Painel",
                 "widget_lang_title": "Idioma", "lang_select_aria": "Selecionar Idioma", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "Parte do Projeto Road to Free Open AGI",
                 // --- Module 30 Specific Translations (PT) ---
                 "module_30_title": "Intro Recursão (Opc)",
                 "kc30_q1_text": "Qual é a característica fundamental de uma função recursiva?",
                 "kc30_q1_opt1": "Usa um loop `for`.",
                 "kc30_q1_opt2": "Chama a si mesma.",
                 "kc30_q1_opt3": "Sempre retorna `None`.",
                 "kc30_q1_opt4": "Recebe exatamente um argumento.",
                 "kc30_q2_text": "Qual é o propósito de um 'caso base' na recursão?",
                 "kc30_q2_opt1": "Iniciar a recursão.",
                 "kc30_q2_opt2": "Realizar o cálculo principal.",
                 "kc30_q2_opt3": "Parar a recursão e prevenir loops infinitos.",
                 "kc30_q2_opt4": "Definir os parâmetros da função.",
                 "kc30_q3_text": "Considere a função recursiva `def countdown(n): if n <= 0: print('Blastoff!'); else: print(n); countdown(n-1)`. Qual é o caso base?",
                 "kc30_q3_opt1": "`print(n)`",
                 "kc30_q3_opt2": "`countdown(n-1)`",
                 "kc30_q3_opt3": "`n <= 0`",
                 "kc30_q3_opt4": "`print('Blastoff!')`",
                 "kc30_q4_text": "Na função `countdown` da questão anterior, qual é o passo recursivo?",
                 "kc30_q4_opt1": "A condição `if n <= 0:`.",
                 "kc30_q4_opt2": "A chamada `countdown(n-1)`.",
                 "kc30_q4_opt3": "A instrução `print(n)`.",
                 "kc30_q4_opt4": "A instrução `print('Blastoff!')`.",
                 "kc30_q5_text": "O que acontece se uma função recursiva não tiver um caso base adequado ou nunca o alcançar?",
                 "kc30_q5_opt1": "Executa mais rápido.",
                 "kc30_q5_opt2": "Converte-se automaticamente para um loop iterativo.",
                 "kc30_q5_opt3": "Resulta em recursão infinita, provavelmente causando um erro de estouro de pilha (stack overflow).",
                 "kc30_q5_opt4": "Retorna 0 por padrão.",
                 "kc30_q6_text": "Qual destes problemas é comumente resolvido usando recursão como um exemplo clássico?",
                 "kc30_q6_opt1": "Ler dados de um arquivo.",
                 "kc30_q6_opt2": "Calcular o fatorial de um número.",
                 "kc30_q6_opt3": "Ordenar uma lista usando bubble sort.",
                 "kc30_q6_opt4": "Obter entrada do usuário.",
                 "kc30_q7_text": "O que o 'passo recursivo' tipicamente faz?",
                 "kc30_q7_opt1": "Para a função imediatamente.",
                 "kc30_q7_opt2": "Chama a função novamente com um argumento modificado que se aproxima do caso base.",
                 "kc30_q7_opt3": "Imprime o resultado final.",
                 "kc30_q7_opt4": "Define o valor inicial.",
                 "kc30_q8_text": "Comparada à iteração (loops), a recursão pode às vezes ser...",
                 "kc30_q8_opt1": "Mais eficiente em memória devido a menos variáveis.",
                 "kc30_q8_opt2": "Mais fácil de entender para tarefas simples de contagem.",
                 "kc30_q8_opt3": "Mais elegante ou intuitiva para problemas naturalmente recursivos (como travessia de árvores), mas potencialmente menos eficiente.",
                 "kc30_q8_opt4": "Impossível de implementar em Python.",
                 "kc30_q9_text": "Para que a 'pilha de chamadas' (call stack) é usada principalmente no contexto da recursão?",
                 "kc30_q9_opt1": "Armazenar o valor do caso base.",
                 "kc30_q9_opt2": "Manter o registro do estado de cada chamada de função (variáveis locais, endereço de retorno).",
                 "kc30_q9_opt3": "Contar o número de iterações.",
                 "kc30_q9_opt4": "Guardar o valor final de retorno.",
                 "kc30_q10_text": "Se `factorial(n)` calcula n!, qual é o valor de `factorial(0)` com base na definição recursiva típica onde o caso base é 0?",
                 "kc30_q10_opt1": "0",
                 "kc30_q10_opt2": "1",
                 "kc30_q10_opt3": "Indefinido (erro)",
                 "kc30_q10_opt4": "-1"
             },
             zh: {
                 "page_title_template": "知识测验: 模块 {moduleId}",
                 "kc_page_title_template": "知识测验: 模块 {moduleId} - {moduleTitle}",
                 "kc_back_button": "返回仪表板",
                 "kc_instructions_template": "<p>回答以下关于<strong>模块 {moduleId}: {moduleTitle}</strong> 的 {totalQuestions} 个问题。</p><p>您需要至少答对 <strong class=\"pass-score\">{passScore}</strong> 个问题才能通过。</p><p class=\"retake-info\">您可以根据需要多次重做此知识测验。</p>",
                 "kc_submit_button": "提交答案",
                 "kc_results_title": "结果",
                 "kc_score_template": "您的得分是 {score} / {totalQuestions}。",
                 "kc_passed_message": "<i class='fas fa-check-circle'></i> 恭喜！您已通过。您的进度已更新。",
                 "kc_failed_message": "<i class='fas fa-times-circle'></i> 您这次未能通过。请继续努力！",
                 "kc_try_again_button": "再试一次",
                 "kc_return_dashboard_button": "返回仪表板",
                 "widget_lang_title": "语言", "lang_select_aria": "选择语言", "lang_en": "🇬🇧 English", "lang_pt": "🇧🇷 Português", "lang_zh": "🇨🇳 中文",
                 "footer_text": "通往自由开放AGI之路项目的一部分",
                 // --- Module 30 Specific Translations (ZH) ---
                 "module_30_title": "递归简介 (选)",
                 "kc30_q1_text": "递归函数的基本特征是什么？",
                 "kc30_q1_opt1": "它使用 `for` 循环。",
                 "kc30_q1_opt2": "它调用自身。",
                 "kc30_q1_opt3": "它总是返回 `None`。",
                 "kc30_q1_opt4": "它只接受一个参数。",
                 "kc30_q2_text": "递归中‘基准情况’(base case)的目的是什么？",
                 "kc30_q2_opt1": "启动递归。",
                 "kc30_q2_opt2": "执行主要计算。",
                 "kc30_q2_opt3": "停止递归并防止无限循环。",
                 "kc30_q2_opt4": "定义函数的参数。",
                 "kc30_q3_text": "考虑递归函数 `def countdown(n): if n <= 0: print('Blastoff!'); else: print(n); countdown(n-1)`。哪个是基准情况？",
                 "kc30_q3_opt1": "`print(n)`",
                 "kc30_q3_opt2": "`countdown(n-1)`",
                 "kc30_q3_opt3": "`n <= 0`",
                 "kc30_q3_opt4": "`print('Blastoff!')`",
                 "kc30_q4_text": "在上一题的 `countdown` 函数中，哪个是递归步骤？",
                 "kc30_q4_opt1": "`if n <= 0:` 条件。",
                 "kc30_q4_opt2": "`countdown(n-1)` 调用。",
                 "kc30_q4_opt3": "`print(n)` 语句。",
                 "kc30_q4_opt4": "`print('Blastoff!')` 语句。",
                 "kc30_q5_text": "如果递归函数缺少正确的基准情况或永远达不到它，会发生什么？",
                 "kc30_q5_opt1": "它运行得更快。",
                 "kc30_q5_opt2": "它自动转换为迭代循环。",
                 "kc30_q5_opt3": "它导致无限递归，很可能引起栈溢出错误。",
                 "kc30_q5_opt4": "它默认返回 0。",
                 "kc30_q6_text": "以下哪个问题通常使用递归作为经典示例来解决？",
                 "kc30_q6_opt1": "从文件中读取数据。",
                 "kc30_q6_opt2": "计算一个数的阶乘。",
                 "kc30_q6_opt3": "使用冒泡排序对列表进行排序。",
                 "kc30_q6_opt4": "获取用户输入。",
                 "kc30_q7_text": "‘递归步骤’通常做什么？",
                 "kc30_q7_opt1": "立即停止函数。",
                 "kc30_q7_opt2": "使用修改后的、更接近基准情况的参数再次调用函数。",
                 "kc30_q7_opt3": "打印最终结果。",
                 "kc30_q7_opt4": "定义初始值。",
                 "kc30_q8_text": "与迭代（循环）相比，递归有时可能...",
                 "kc30_q8_opt1": "由于变量较少而更节省内存。",
                 "kc30_q8_opt2": "对于简单的计数任务更容易理解。",
                 "kc30_q8_opt3": "对于本身具有递归性质的问题（如树遍历）更优雅或直观，但可能效率较低。",
                 "kc30_q8_opt4": "在Python中无法实现。",
                 "kc30_q9_text": "在递归的上下文中，‘调用栈’(call stack)主要用于什么？",
                 "kc30_q9_opt1": "存储基准情况的值。",
                 "kc30_q9_opt2": "跟踪每次函数调用的状态（局部变量、返回地址）。",
                 "kc30_q9_opt3": "计算迭代次数。",
                 "kc30_q9_opt4": "保存最终的返回值。",
                 "kc30_q10_text": "如果 `factorial(n)` 计算 n!，并且基准情况是 0，那么根据典型的递归定义，`factorial(0)` 是多少？",
                 "kc30_q10_opt1": "0",
                 "kc30_q10_opt2": "1",
                 "kc30_q10_opt3": "未定义（错误）",
                 "kc30_q10_opt4": "-1"
             }
         };

        // --- Quiz Data for Module 30 ---
        const quizData = [
            { id: 'q1', text_key: 'kc30_q1_text', options: [ { value: 'a', text_key: 'kc30_q1_opt1'}, { value: 'b', text_key: 'kc30_q1_opt2'}, { value: 'c', text_key: 'kc30_q1_opt3'}, { value: 'd', text_key: 'kc30_q1_opt4'} ], correct_answer: 'b' },
            { id: 'q2', text_key: 'kc30_q2_text', options: [ { value: 'a', text_key: 'kc30_q2_opt1'}, { value: 'b', text_key: 'kc30_q2_opt2'}, { value: 'c', text_key: 'kc30_q2_opt3'}, { value: 'd', text_key: 'kc30_q2_opt4'} ], correct_answer: 'c' },
            { id: 'q3', text_key: 'kc30_q3_text', options: [ { value: 'a', text_key: 'kc30_q3_opt1'}, { value: 'b', text_key: 'kc30_q3_opt2'}, { value: 'c', text_key: 'kc30_q3_opt3'}, { value: 'd', text_key: 'kc30_q3_opt4'} ], correct_answer: 'c' },
            { id: 'q4', text_key: 'kc30_q4_text', options: [ { value: 'a', text_key: 'kc30_q4_opt1'}, { value: 'b', text_key: 'kc30_q4_opt2'}, { value: 'c', text_key: 'kc30_q4_opt3'}, { value: 'd', text_key: 'kc30_q4_opt4'} ], correct_answer: 'b' },
            { id: 'q5', text_key: 'kc30_q5_text', options: [ { value: 'a', text_key: 'kc30_q5_opt1'}, { value: 'b', text_key: 'kc30_q5_opt2'}, { value: 'c', text_key: 'kc30_q5_opt3'}, { value: 'd', text_key: 'kc30_q5_opt4'} ], correct_answer: 'c' },
            { id: 'q6', text_key: 'kc30_q6_text', options: [ { value: 'a', text_key: 'kc30_q6_opt1'}, { value: 'b', text_key: 'kc30_q6_opt2'}, { value: 'c', text_key: 'kc30_q6_opt3'}, { value: 'd', text_key: 'kc30_q6_opt4'} ], correct_answer: 'b' },
            { id: 'q7', text_key: 'kc30_q7_text', options: [ { value: 'a', text_key: 'kc30_q7_opt1'}, { value: 'b', text_key: 'kc30_q7_opt2'}, { value: 'c', text_key: 'kc30_q7_opt3'}, { value: 'd', text_key: 'kc30_q7_opt4'} ], correct_answer: 'b' },
            { id: 'q8', text_key: 'kc30_q8_text', options: [ { value: 'a', text_key: 'kc30_q8_opt1'}, { value: 'b', text_key: 'kc30_q8_opt2'}, { value: 'c', text_key: 'kc30_q8_opt3'}, { value: 'd', text_key: 'kc30_q8_opt4'} ], correct_answer: 'c' },
            { id: 'q9', text_key: 'kc30_q9_text', options: [ { value: 'a', text_key: 'kc30_q9_opt1'}, { value: 'b', text_key: 'kc30_q9_opt2'}, { value: 'c', text_key: 'kc30_q9_opt3'}, { value: 'd', text_key: 'kc30_q9_opt4'} ], correct_answer: 'b' },
            { id: 'q10', text_key: 'kc30_q10_text', options: [ { value: 'a', text_key: 'kc30_q10_opt1'}, { value: 'b', text_key: 'kc30_q10_opt2'}, { value: 'c', text_key: 'kc30_q10_opt3'}, { value: 'd', text_key: 'kc30_q10_opt4'} ], correct_answer: 'b' }
        ];
        const TOTAL_QUESTIONS = quizData.length;

        // --- DOM Elements ---
        const languageSelectElement = document.getElementById('languageSelect');
        const quizForm = document.getElementById('quiz-form');
        const questionsArea = document.getElementById('questions-area');
        const resultsArea = document.getElementById('results-area');
        const resultsMessage = document.getElementById('results-message');
        const tryAgainButton = document.getElementById('try-again-button');
        const pageTitleElement = document.querySelector('title');
        const headerTitleElement = document.getElementById('kc-page-title');
        const instructionsElement = document.querySelector('.quiz-instructions');
        const submitButton = document.getElementById('submit-button');

        // --- Translation Functions (Adapted from Dashboard) ---
        function getStoredLanguage() { /* ... (same as dashboard) ... */ const storedLang = localStorage.getItem(LANGUAGE_STORAGE_KEY); if (storedLang && translations[storedLang]) return storedLang; const browserLang = navigator.language || navigator.userLanguage; if (browserLang.startsWith('pt')) return 'pt'; if (browserLang.startsWith('zh')) return 'zh'; return 'en'; }
        function getTranslation(key, lang, replacements = {}) { /* ... (same as dashboard, handles replacements) ... */ let text = translations[lang]?.[key] ?? translations['en']?.[key] ?? `[${key}]`; const moduleTitleKey = `module_${CURRENT_MODULE_ID}_title`; const moduleTitle = translations[lang]?.[moduleTitleKey] ?? translations['en']?.[moduleTitleKey] ?? `Module ${CURRENT_MODULE_ID}`; replacements['moduleId'] = CURRENT_MODULE_ID; replacements['moduleTitle'] = moduleTitle; replacements['totalQuestions'] = TOTAL_QUESTIONS; replacements['passScore'] = QUESTIONS_TO_PASS; for (const placeholder in replacements) { const regex = new RegExp(`\\{${placeholder}\\}`, 'g'); text = text.replace(regex, replacements[placeholder]); } return text; }

        function translatePage(lang) {
            // Translate standard elements
            document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); const replacements = {}; // Add replacements if the element needs them (e.g., instructions) Array.from(el.attributes).forEach(attr => { if (attr.name.startsWith('data-') && attr.name !== 'data-translate') { replacements[attr.name.substring(5)] = attr.value; } }); const translation = getTranslation(key, lang, replacements); if (el.tagName === 'TITLE') { // Set page title document.title = translation; } else if (translation.includes('<') && translation.includes('>')) { el.innerHTML = translation; } else { el.textContent = translation; } });
            // Translate placeholders and aria-labels
            document.querySelectorAll('[data-translate-placeholder]').forEach(el => { const key = el.getAttribute('data-translate-placeholder'); el.setAttribute('placeholder', getTranslation(key, lang)); });
            document.querySelectorAll('[data-translate-aria-label]').forEach(el => { const key = el.getAttribute('data-translate-aria-label'); el.setAttribute('aria-label', getTranslation(key, lang)); });

             // Update dynamic titles
             const pageTitleTranslation = getTranslation('page_title_template', lang);
             pageTitleElement.textContent = pageTitleTranslation;
             const headerTitleTranslation = getTranslation('kc_page_title_template', lang);
             headerTitleElement.textContent = headerTitleTranslation;

              // Re-render quiz with new language
              renderQuiz(lang);
        }

         function setLanguage(lang) {
             if (!translations[lang]) lang = 'en'; // Fallback
             localStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
             document.documentElement.lang = lang;
             if (languageSelectElement) languageSelectElement.value = lang;
             translatePage(lang); // Translate static parts and re-render quiz
         }

        // --- LocalStorage Functions ---
        function loadKnowledgeCheckStatus() { try { const storedStatus = localStorage.getItem(KNOWLEDGE_CHECK_STORAGE_KEY); const parsed = storedStatus ? JSON.parse(storedStatus) : {}; return typeof parsed === 'object' && parsed !== null ? parsed : {}; } catch (e) { console.error("Error reading KC status from localStorage:", e); return {}; } }
        function saveKnowledgeCheckStatus(statusObject) { try { localStorage.setItem(KNOWLEDGE_CHECK_STORAGE_KEY, JSON.stringify(statusObject)); } catch (e) { console.error("Error saving KC status to localStorage:", e); } }

        // --- Quiz Rendering ---
        function renderQuiz(lang) {
            questionsArea.innerHTML = ''; // Clear previous questions
            quizData.forEach((q, index) => {
                const questionContainer = document.createElement('div');
                questionContainer.className = 'question-container';
                questionContainer.dataset.questionId = q.id;

                const questionTextP = document.createElement('p');
                questionTextP.className = 'question-text';

                const qNumberSpan = document.createElement('span');
                qNumberSpan.className = 'q-number';
                qNumberSpan.textContent = index + 1;

                const qTextSpan = document.createElement('span');
                qTextSpan.className = 'q-text-content';
                 // Use getTranslation for the question text
                 qTextSpan.innerHTML = getTranslation(q.text_key, lang); // Use innerHTML to allow <code> tags

                questionTextP.appendChild(qNumberSpan);
                questionTextP.appendChild(qTextSpan);

                const optionsList = document.createElement('ul');
                optionsList.className = 'answer-options';

                // Randomize options order
                const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(opt => {
                    const optionLi = document.createElement('li');
                    optionLi.className = 'answer-option';

                    const inputRadio = document.createElement('input');
                    inputRadio.type = 'radio';
                    inputRadio.id = `${q.id}_${opt.value}`;
                    inputRadio.name = q.id;
                    inputRadio.value = opt.value;
                    inputRadio.required = true; // Make selection mandatory

                    const label = document.createElement('label');
                    label.htmlFor = `${q.id}_${opt.value}`;
                     // Use getTranslation for the option text
                     label.innerHTML = getTranslation(opt.text_key, lang); // Use innerHTML

                    optionLi.appendChild(inputRadio);
                    optionLi.appendChild(label);
                    optionsList.appendChild(optionLi);
                });

                questionContainer.appendChild(questionTextP);
                questionContainer.appendChild(optionsList);
                questionsArea.appendChild(questionContainer);
            });
             // Ensure submit button is enabled when quiz is rendered/re-rendered
             if(submitButton) submitButton.disabled = false;
        }

        // --- Quiz Submission and Scoring ---
        function handleSubmit(event) {
            event.preventDefault();
            submitButton.disabled = true; // Prevent double submission

            let score = 0;
            quizData.forEach(q => {
                const selectedOption = quizForm.querySelector(`input[name="${q.id}"]:checked`);
                if (selectedOption && selectedOption.value === q.correct_answer) {
                    score++;
                }
            });

            const passed = score >= QUESTIONS_TO_PASS;
            const lang = getStoredLanguage();

            // Update localStorage if passed
            if (passed) {
                const currentStatus = loadKnowledgeCheckStatus();
                currentStatus[CURRENT_MODULE_ID] = true;
                saveKnowledgeCheckStatus(currentStatus);
            }

            // Display results
            const scoreText = getTranslation('kc_score_template', lang, { score: score, totalQuestions: TOTAL_QUESTIONS });
            const passFailText = getTranslation(passed ? 'kc_passed_message' : 'kc_failed_message', lang);

            resultsMessage.innerHTML = `${scoreText}<br>${passFailText}`;
            resultsMessage.className = `results-message ${passed ? 'passed' : 'failed'}`; // Apply class for styling

            quizForm.style.display = 'none';
            resultsArea.style.display = 'block';
            resultsArea.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Try Again Functionality ---
        function handleTryAgain() {
            resultsArea.style.display = 'none';
            quizForm.style.display = 'block';
            quizForm.reset(); // Clear selected answers
            submitButton.disabled = false; // Re-enable submit button
            renderQuiz(getStoredLanguage()); // Re-render to shuffle options
            quizForm.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial language and translate
            const initialLang = getStoredLanguage();
            if (languageSelectElement) languageSelectElement.value = initialLang;
            document.documentElement.lang = initialLang;
            translatePage(initialLang); // This will also call renderQuiz

            // Attach event listeners
            if (languageSelectElement) {
                 languageSelectElement.addEventListener('change', (e) => setLanguage(e.target.value));
            }
            if (quizForm) {
                 quizForm.addEventListener('submit', handleSubmit);
            }
            if (tryAgainButton) {
                 tryAgainButton.addEventListener('click', handleTryAgain);
            }
        });

    </script>

</body>
</html>
